<!DOCTYPE html>
<html lang="fr" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CADViewer - Conversion Cache</title>
    <script src="/settings/tailwind.js"></script>
    <link
      rel="shortcut icon"
      href="https://www.cadviewer.com/images/favicon.png"
      type="image/x-icon"
    />
    <link
      rel="icon"
      href="https://www.cadviewer.com/images/favicon.png"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="/settings/style.css" />
    <script src="/settings/vanilla-toast.js"></script>
    <script src="/settings/cache-stats.js"></script>
    <script src="/settings/icons.js"></script>
    <link rel="stylesheet" href="/settings/vanilla-toast.css" />
  </head>

  <body class="h-full">
    <div>
      <!-- Off-canvas menu for mobile, show/hide based on off-canvas menu state. -->
      <div class="relative z-50 lg:hidden" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-900/80"></div>

        <div class="fixed inset-0 flex">
          <div class="relative mr-16 flex w-full max-w-xs flex-1">
            <div class="absolute left-full top-0 flex w-16 justify-center pt-5">
              <button type="button" class="-m-2.5 p-2.5">
                <span class="sr-only">Fermer le menu</span>
                <svg
                  class="h-6 w-6 text-white"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  aria-hidden="true"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M6 18L18 6M6 6l12 12"
                  />
                </svg>
              </button>
            </div>

            <!-- Sidebar component -->
            <div
              class="flex grow flex-col gap-y-5 overflow-y-auto bg-white px-6 pb-4 h-full"
            >
              <div class="flex h-16 shrink-0 items-center">
                <img
                  class="h-8 w-auto"
                  src="https://www.cadviewer.com/images/cadviewer/cv-logo-smaller.png"
                  alt="CADViewer"
                />
              </div>
              <nav class="flex flex-1 flex-col">
                <ul role="list" class="flex flex-1 flex-col gap-y-7">
                  <li>
                    <ul role="list" class="-mx-2 space-y-1">
                      <li>
                        <a
                          href="/settings"
                          class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                        >
                          <svg
                            class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"
                            />
                          </svg>
                          Dashboard
                        </a>
                      </li>
                      <li>
                        <a
                          href="/settings/users"
                          class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                        >
                          <svg
                            class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"
                            />
                          </svg>
                          Users
                        </a>
                      </li>
                      <li>
                        <a
                          href="/settings/folders"
                          class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                        >
                          <svg
                            class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"
                            />
                          </svg>
                          Folders
                        </a>
                      </li>
                      <li>
                        <a
                          href="/settings/cache"
                          class="group flex gap-x-3 rounded-md bg-gray-50 p-2 text-sm font-semibold leading-6 text-orange-600"
                        >
                          <svg
                            class="h-6 w-6 shrink-0 text-orange-600"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m8.25 3v6.75m0 0l-3-3m3 3l3-3M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"
                            />
                          </svg>
                          Conversion Cache
                        </a>
                      </li>
                      <li>
                        <a
                          href="/settings/licences"
                          class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                        >
                          <svg
                            class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"
                            />
                          </svg>
                          Licences
                        </a>
                      </li>
                      <li>
                        <a
                          href="/settings/logs"
                          class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                            class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"
                            />
                          </svg>
                          Logs
                        </a>
                      </li>
                      <li>
                        <a
                          href="/settings/restapi-test"
                          class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                            class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z"
                            />
                          </svg>
                          Rest API Test
                        </a>
                      </li>
                      <li>
                        <a
                          href="/settings/config"
                          class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                            class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"
                            />
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
                            />
                          </svg>
                          Config
                        </a>
                      </li>
                      <li>
                        <a
                          href="/settings/doctor"
                          class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                        >
                          <svg
                            class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke-width="1.5"
                            stroke="currentColor"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z"
                            />
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z"
                            />
                          </svg>
                          CADViewer Doctor
                        </a>
                      </li>
                    </ul>
                  </li>
                  <li>
                    <div class="text-xs font-semibold leading-6 text-gray-400">
                      Useful Links
                    </div>
                    <ul role="list" class="-mx-2 mt-2 space-y-1">
                      <li>
                        <a
                          href="https://www.cadviewer.com/"
                          target="_blank"
                          class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                        >
                          <span
                            class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white text-[0.625rem] font-medium text-gray-400 group-hover:border-orange-600 group-hover:text-orange-600"
                            >C</span
                          >
                          <span class="truncate">CADViewer</span>
                        </a>
                      </li>
                      <li>
                        <a
                          href="https://www.tailormade.com/"
                          target="_blank"
                          class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                        >
                          <span
                            class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white text-[0.625rem] font-medium text-gray-400 group-hover:border-orange-600 group-hover:text-orange-600"
                            >T</span
                          >
                          <span class="truncate">Tailormade</span>
                        </a>
                      </li>
                      <li>
                        <a
                          href="https://store.cadviewer.com/"
                          target="_blank"
                          class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                        >
                          <span
                            class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white text-[0.625rem] font-medium text-gray-400 group-hover:border-orange-600 group-hover:text-orange-600"
                            >S</span
                          >
                          <span class="truncate">CADViewer Store</span>
                        </a>
                      </li>
                    </ul>
                  </li>
                </ul>
              </nav>
              <div class="mt-auto">
                <div class="bg-gray-100 rounded-lg p-3 shadow-sm mb-3">
                  <div class="flex justify-between items-center mb-2">
                    <div class="text-sm text-gray-600 font-medium">
                      Conversion Cache
                    </div>
                    <button
                      onclick="flushCache()"
                      class="text-xs bg-orange-600 text-white px-2 py-1 rounded hover:bg-orange-500"
                    >
                      Flush Cache
                    </button>
                  </div>
                  <div class="space-y-1">
                    <div class="flex justify-between items-center">
                      <span class="text-sm text-gray-500">Files:</span>
                      <span class="text-sm text-gray-800 cache-file-count"
                        >-</span
                      >
                    </div>
                    <div class="flex justify-between items-center">
                      <span class="text-sm text-gray-500">Size:</span>
                      <span class="text-sm text-gray-800 cache-size">-</span>
                    </div>
                  </div>
                </div>
                <div class="bg-gray-100 rounded-lg p-3 shadow-sm">
                  <div class="text-sm text-gray-600 font-medium">Version</div>
                  <div class="text-base text-gray-800">{version}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Static sidebar for desktop -->
      <div
        class="hidden lg:fixed lg:inset-y-0 lg:z-50 lg:flex lg:w-72 lg:flex-col"
      >
        <div
          class="flex grow flex-col gap-y-5 overflow-y-auto border-r border-gray-200 bg-white px-6 h-full pb-4"
        >
          <div class="flex h-16 shrink-0 items-center">
            <img
              class="h-12 w-auto"
              src="https://www.cadviewer.com/images/cadviewer/cv-logo-smaller.png"
              alt="CADViewer"
            />
          </div>
          <nav class="flex flex-1 flex-col">
            <ul role="list" class="flex flex-1 flex-col gap-y-7">
              <li>
                <ul role="list" class="-mx-2 space-y-1">
                  <li>
                    <a
                      href="/settings"
                      class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                    >
                      <svg
                        class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"
                        />
                      </svg>
                      Dashboard
                    </a>
                  </li>
                  <li>
                    <a
                      href="/settings/users"
                      class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                    >
                      <svg
                        class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"
                        />
                      </svg>
                      Users
                    </a>
                  </li>
                  <li>
                    <a
                      href="/settings/folders"
                      class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                    >
                      <svg
                        class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"
                        />
                      </svg>
                      Folders
                    </a>
                  </li>
                  <li>
                    <a
                      href="/settings/cache"
                      class="group flex gap-x-3 rounded-md bg-gray-50 p-2 text-sm font-semibold leading-6 text-orange-600"
                    >
                      <svg
                        class="h-6 w-6 shrink-0 text-orange-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m8.25 3v6.75m0 0l-3-3m3 3l3-3M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"
                        />
                      </svg>
                      Conversion Cache
                    </a>
                  </li>
                  <li>
                    <a
                      href="/settings/licences"
                      class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                    >
                      <svg
                        class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"
                        />
                      </svg>
                      Licences
                    </a>
                  </li>
                  <li>
                    <a
                      href="/settings/logs"
                      class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"
                        />
                      </svg>
                      Logs
                    </a>
                  </li>
                  <li>
                    <a
                      href="/settings/restapi-test"
                      class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z"
                        />
                      </svg>
                      Rest API Test
                    </a>
                  </li>
                  <li>
                    <a
                      href="/settings/config"
                      class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"
                        />
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
                        />
                      </svg>
                      Config
                    </a>
                  </li>
                  <li>
                    <a
                      href="/settings/doctor"
                      class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                    >
                      <svg
                        class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z"
                        />
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z"
                        />
                      </svg>
                      CADViewer Doctor
                    </a>
                  </li>
                </ul>
              </li>
              <li>
                <div class="text-xs font-semibold leading-6 text-gray-400">
                  Useful Links
                </div>
                <ul role="list" class="-mx-2 mt-2 space-y-1">
                  <li>
                    <a
                      href="https://www.cadviewer.com/"
                      target="_blank"
                      class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                    >
                      <span
                        class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white text-[0.625rem] font-medium text-gray-400 group-hover:border-orange-600 group-hover:text-orange-600"
                        >C</span
                      >
                      <span class="truncate">CADViewer</span>
                    </a>
                  </li>
                  <li>
                    <a
                      href="https://www.tailormade.com/"
                      target="_blank"
                      class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                    >
                      <span
                        class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white text-[0.625rem] font-medium text-gray-400 group-hover:border-orange-600 group-hover:text-orange-600"
                        >T</span
                      >
                      <span class="truncate">Tailormade</span>
                    </a>
                  </li>
                  <li>
                    <a
                      href="https://store.cadviewer.com/"
                      target="_blank"
                      class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600"
                    >
                      <span
                        class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white text-[0.625rem] font-medium text-gray-400 group-hover:border-orange-600 group-hover:text-orange-600"
                        >S</span
                      >
                      <span class="truncate">CADViewer Store</span>
                    </a>
                  </li>
                </ul>
              </li>
            </ul>
          </nav>
          <div class="mt-auto">
            <div class="bg-gray-100 rounded-lg p-3 shadow-sm mb-3">
              <div class="flex justify-between items-center mb-2">
                <div class="text-sm text-gray-600 font-medium">
                  Conversion Cache
                </div>
                <button
                  onclick="flushCache()"
                  class="text-xs bg-orange-600 text-white px-2 py-1 rounded hover:bg-orange-500"
                >
                  Flush Cache
                </button>
              </div>
              <div class="space-y-1">
                <div class="flex justify-between items-center">
                  <span class="text-sm text-gray-500">Files:</span>
                  <span class="text-sm text-gray-800 cache-file-count">-</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-gray-500">Size:</span>
                  <span class="text-sm text-gray-800 cache-size">-</span>
                </div>
              </div>
            </div>
            <div class="bg-gray-100 rounded-lg p-3 shadow-sm">
              <div class="text-sm text-gray-600 font-medium">Version</div>
              <div class="text-base text-gray-800">{version}</div>
            </div>
          </div>
        </div>
      </div>

      <div class="lg:pl-72">
        <div
          class="sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 bg-white px-4 sm:gap-x-6 sm:px-6 lg:px-8"
        >
          <button type="button" class="-m-2.5 p-2.5 text-gray-700 lg:hidden">
            <span class="sr-only">Open sidebar</span>
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              aria-hidden="true"
              data-slot="icon"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
              />
            </svg>
          </button>

          <!-- Separator -->
          <div class="h-6 w-px bg-gray-200 lg:hidden" aria-hidden="true"></div>
          <div class="flex items-center gap-x-4 justify-between w-full">
            <h1 class="text-xl font-semibold leading-6 text-gray-900">
              Conversion Cache
            </h1>
            <button
              onclick="fetchCachedFiles(1)"
              class="flex items-center gap-x-1.5 rounded-md bg-white px-3 py-2 border border-orange-600 text-sm font-semibold text-orange-600 shadow-sm ring-1 ring-inset ring-orange-600 hover:bg-gray-50"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="h-5 w-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"
                />
              </svg>
              Refresh Conversion Cache
            </button>
          </div>
        </div>

        <main class="px-4 sm:px-6 lg:px-8">
          <div class="py-4 flow-root">
            <ul
              role="list"
              id="cached-files-list"
              class="grid grid-cols-1 gap-x-4 gap-y-4 lg:grid-cols-4 xl:gap-x-4"
            ></ul>

            <!-- Ajout des contrôles de pagination -->
            <nav
              id="pagination-container"
              class="items-center justify-between border-t border-gray-200 px-4 sm:px-0 hidden mt-8"
            >
              <div class="-mt-px flex w-0 flex-1">
                <span
                  onclick="fetchCachedFiles(1)"
                  class="cursor-pointer inline-flex items-center border-t-2 border-transparent pr-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-orange-500"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="m18.75 4.5-7.5 7.5 7.5 7.5m-6-15L5.25 12l7.5 7.5"
                    />
                  </svg>
                </span>
                <span
                  onclick="fetchCachedFiles(currentPage - 1)"
                  class="cursor-pointer inline-flex items-center border-t-2 border-transparent pr-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-orange-500"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M15.75 19.5 8.25 12l7.5-7.5"
                    />
                  </svg>
                </span>
              </div>
              <div class="hidden md:-mt-px md:flex" id="pagination"></div>
              <div class="-mt-px flex w-0 flex-1 justify-end">
                <span
                  onclick="fetchCachedFiles(currentPage + 1)"
                  class="cursor-pointer inline-flex items-center border-t-2 border-transparent pl-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-orange-500"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="m8.25 4.5 7.5 7.5-7.5 7.5"
                    />
                  </svg>
                </span>
                <span
                  onclick="fetchCachedFiles(totalPages)"
                  class="cursor-pointer inline-flex items-center border-t-2 border-transparent pl-1 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-orange-500"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="m5.25 4.5 7.5 7.5-7.5 7.5m6-15 7.5 7.5-7.5 7.5"
                    />
                  </svg>
                </span>
              </div>
            </nav>
          </div>
        </main>
      </div>
    </div>

    <script>
      let currentPage = 1;
      let totalPages = 1;
      let itemsPerPage = 16;

      const fetchCachedFiles = async (page = 1) => {
        if (page > totalPages) {
          page = totalPages;
        } else if (page < 1) {
          page = 1;
        }
        try {
          const response = await fetch(
            `/settings/cache/files?page=${page}&limit=${itemsPerPage}`
          );
          const data = await response.json();
          renderCachedFiles(data.files);
          currentPage = data.pagination.currentPage;
          totalPages = data.pagination.totalPages;
          updatePagination(data.pagination);
        } catch (error) {
          console.error("Error fetching cached files:", error);
          vanillaToast.error(
            "An error occurred while fetching the cached files.",
            {
              duration: 5000,
            }
          );
        }
      };

      const updatePagination = ({ total, totalPages, currentPage, limit }) => {
        // render pagination
        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";

        const createPageLink = (i, currentPage) => {
          const a = document.createElement("span");
          a.href = "#";
          a.textContent = i;
          a.onclick = () => fetchCachedFiles(i);
          if (`${i}` === `${currentPage}`) {
            a.classList =
              "inline-flex items-center border-t-2 border-orange-500 px-4 pt-4 text-sm font-medium text-orange-600";
          } else {
            a.classList =
              "cursor-pointer inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700";
          }
          return a;
        };

        const createEllipsis = () => {
          const span = document.createElement("span");
          span.textContent = "...";
          span.classList =
            "inline-flex items-center border-t-2 border-transparent px-4 pt-4 text-sm font-medium text-gray-500";
          return span;
        };

        // Always show first page
        pagination.appendChild(createPageLink(1, currentPage));

        if (totalPages <= 8) {
          // Show all pages if 8 or fewer
          for (let i = 2; i <= totalPages; i++) {
            pagination.appendChild(createPageLink(i, currentPage));
          }
        } else {
          // Show limited pages with ellipsis
          if (currentPage > 4) {
            pagination.appendChild(createEllipsis());
          }

          // Show pages around current page
          for (
            let i = Math.max(2, currentPage - 2);
            i <= Math.min(page + 2, totalPages - 1);
            i++
          ) {
            pagination.appendChild(createPageLink(i, currentPage));
          }

          if (currentPage < totalPages - 3) {
            pagination.appendChild(createEllipsis());
          }

          // Always show last page
          pagination.appendChild(createPageLink(totalPages, currentPage));
        }
        document
          .getElementById("pagination-container")
          .classList.remove("hidden");
        document.getElementById("pagination-container").classList.add("flex");
      };

      const formatDate = (dateString) => {
        const options = {
          year: "numeric",
          month: "long",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        };
        return new Date(dateString).toLocaleDateString("en-US", options);
      };

      const formatFileSize = (bytes) => {
        const units = ["B", "KB", "MB", "GB"];
        let size = bytes;
        let unitIndex = 0;

        while (size >= 1024 && unitIndex < units.length - 1) {
          size /= 1024;
          unitIndex++;
        }

        return `${size.toFixed(1)} ${units[unitIndex]}`;
      };

      const toggleOptionsMenu = (buttonId) => {
        const menu = document.querySelector(`[aria-labelledby="${buttonId}"]`);
        const button = document.getElementById(buttonId);
        const isExpanded = button.getAttribute("aria-expanded") === "true";

        // Ferme tous les autres menus
        document.querySelectorAll('[role="menu"]').forEach((m) => {
          if (m !== menu) m.classList.add("hidden");
        });

        menu.classList.toggle("hidden");
        button.setAttribute("aria-expanded", !isExpanded);
      };

      const getFileIcon = (action) => {
        if (action === "JSON Data Extraction") {
          return jsonIcon;
        } else if (action === "DWG to SVG Conversion") {
          return svgIcon;
        } else if (action === "DWG to PDF Conversion") {
          return pdfIcon;
        } else if (action === "DWG file in multiple files") {
          return jsonIcon;
        } else if (action === "Display of DWG") {
          return dwgIcon;
        } else if (action === "Cache conversion") {
          return jsonIcon;
        } else if (action === "RL/TL Processing") {
          return jsonIcon;
        }
      };

      const renderCachedFiles = (files) => {
        const container = document.getElementById("cached-files-list");
        container.innerHTML = files
          .map(
            (file, index) => `
          <li class="overflow-hidden rounded-xl border border-gray-200">
            <div class="flex items-center gap-x-4 border-b border-gray-900/5 bg-gray-50 p-4">
              <figure class="size-10 flex-none rounded-lg bg-white object-cover ring-1 ring-gray-900/10 flex justify-center items-center">
                ${getFileIcon(file.action)}
              </figure>
              <div class="flex flex-col gap-y-1">
                <div class="flex gap-2 justify-between">
                  <div class="text-sm/6 font-medium text-gray-900">${
                    file.action
                  }</div>
                  <span class="rounded-md bg-orange-50 px-2 py-1 text-xs font-medium text-orange-700 ring-1 ring-inset ring-orange-600/10">
                      ${formatFileSize(file.size)}
                    </span>
                </div>
                <div class="text-sm text-gray-500">
                  <time datetime="${file.createdAt}">${formatDate(
              file.createdAt
            )}</time>
                </div>
              </div>
              <div class="relative ml-auto">
                <button
                  type="button"
                  class="-m-2.5 block p-2.5 text-gray-400 hover:text-gray-500"
                  id="options-menu-${index}-button"
                  aria-expanded="false"
                  aria-haspopup="true"
                  onclick="toggleOptionsMenu('options-menu-${index}-button')"
                >
                  <span class="sr-only">Ouvrir les options</span>
                  <svg class="size-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
                    <path d="M3 10a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM8.5 10a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM15.5 8.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z" />
                  </svg>
                </button>

                <div
                  class="absolute right-0 z-10 mt-0.5 w-32 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-gray-900/5 focus:outline-none hidden"
                  role="menu"
                  aria-orientation="vertical"
                  aria-labelledby="options-menu-${index}-button"
                  tabindex="-1"
                >
                 ${file.availableFormats
                   .map(
                     (format) => `
                    <a
                      href="#"
                      class="block px-3 py-1 text-sm/6 text-gray-900"
                      role="menuitem"
                      tabindex="-1"
                      onclick="viewFile('${format.id}', '${format.name}')"
                    >Display ${format.name} ${
                       format.id.includes(".rl.json") ? " RL" : ""
                     } <span class="sr-only">, File(s)</span></a>
                 `
                   )
                   .join("")}
                  <a
                    href="#"
                    class="block px-3 py-1 text-sm/6 text-gray-900"
                    role="menuitem"
                    tabindex="-1"
                    onclick="deleteFile('${file.name}')"
                  >Delete<span class="sr-only">, File(s)</span></a>
                </div>
              </div>
            </div>
            <dl class="-my-3 divide-y divide-gray-100 px-6 py-4 text-sm/6">
              <div class="flex justify-between gap-x-2 py-2">
                <dd class="text-gray-700 break-all">${file.goodFileName}</dd>
              </div>
              <div class="flex justify-between gap-x-2 py-2">
                <dt class="text-gray-500">Last Modified</dt>
                <dd class="text-gray-700">
                  <time datetime="${file.updatedAt}">${formatDate(
              file.updatedAt
            )}</time>
                </dd>
              </div>
              <div class="flex justify-between gap-x-2 py-2">
                <dt class="text-gray-500">Files</dt>
                <dd class="flex gap-2">
                  ${file.availableFormats
                    .map(
                      (format) => `
                    <span onclick="viewFile('${format.id}', '${
                        format.name
                      }')" class="rounded-md bg-${
                        format.color
                      }-50 px-2 py-1 text-xs font-medium text-${
                        format.color
                      }-700 ring-1 ring-inset ring-${
                        format.color
                      }-600/10 cursor-pointer">
                      ${format.name} ${
                        format.id.includes(".rl.json") ? " RL" : ""
                      }
                    </span>
                  `
                    )
                    .join("")}
                </dd>
              </div>
            </dl>
          </li>
        `
          )
          .join("");
      };

      const viewFile = async (fileId, fileType) => {
        // Implémentez la logique pour voir le fichier
        console.log("Voir le fichier:", fileId);
        console.log("Voir le fichier:", fileType);
        if (fileType === "SVG" || fileType === "SVGZ") {
          // open the file in a modal
          openModal(
            fileType + " File" + `: ${fileId}`,
            `<img src="/settings/cache/files/${fileId}" alt="SVG File" />`
          );
        } else if (fileType === "CSV") {
          // get the csv file content in json form from the server and construct a table with the data
          const response = await fetch(`/settings/cache/csv/${fileId}`);
          const data = await response.json();
          openModal(
            "CSV File" + `: ${fileId}`,
            `<table class="w-full border-collapse border border-gray-200">${data
              .map(
                (row, rowIndex) =>
                  `<tr class="${
                    rowIndex % 2 === 0 ? "bg-white" : "bg-gray-50"
                  }">${row
                    .map(
                      (cell) =>
                        `<td class="border border-gray-200 p-1">${cell}</td>`
                    )
                    .join("")}</tr>`
              )
              .join("")}</table>`
          );
        } else if (fileType === "PDF") {
          // display with iframe
          openModal(
            "PDF File" + `: ${fileId}`,
            `<iframe src="/settings/cache/files/${fileId}" class="w-full h-full min-h-[80vh]"></iframe>`
          );
        } else if (fileType === "JSON") {
          // display with iframe
          const response = await fetch(`/settings/cache/files/${fileId}`);
          const data = await response.text();
          try {
            const jsonData = JSON.parse(data);
            openModal(
              "JSON File" + `: ${fileId}`,
              `<pre>${JSON.stringify(jsonData, null, 2)}</pre>`
            );
          } catch (error) {
            console.error("Error parsing JSON:", error);
            openModal("JSON File" + `: ${fileId}`, `<pre>${data}</pre>`);
          }
        }
      };

      const openModal = (title, content) => {
        // create a modal and add the content to it then open it
        const modal = `<div class="relative z-50 modal" aria-labelledby="modal-title" role="dialog" aria-modal="true">
              <div class="fixed inset-0 bg-gray-500/75 transition-opacity" aria-hidden="true"></div>

              <div class="fixed inset-0 z-10 w-screen">
                <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                  <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-4 sm:w-full sm:max-w-4xl">
                    
                    <div class="px-4 py-5 border-b border-gray-200">
                      <h3 class="text-lg font-semibold text-gray-900" id="modal-title">${title}</h3>
                    </div>

                    <div class="px-4 py-4 max-h-[calc(100vh-200px)] overflow-y-auto">
                      ${content}
                    </div>

                    <div class="px-4 py-4 border-t border-gray-200 sm:flex sm:flex-row-reverse">
                      <button type="button" class="inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto close-button">Close</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;
        document.body.insertAdjacentHTML("beforeend", modal);
        // add a close button to the modal
        const closeButton = document.querySelector(".close-button");
        closeButton.addEventListener("click", () => {
          document.body.removeChild(document.querySelector(".modal"));
        });
      };

      const deleteFile = async (fileId) => {
        try {
          const response = await fetch(`/settings/cache/files/${fileId}`, {
            method: "DELETE",
          });

          if (response.ok) {
            vanillaToast.success("File deleted successfully.", {
              duration: 5000,
            });
            await fetchCachedFiles(1); // Rafraîchir la liste
          } else {
            vanillaToast.error("Failed to delete file.", {
              duration: 5000,
            });
          }
        } catch (error) {
          console.error("Error:", error);
          vanillaToast.error("An error occurred while deleting the file.", {
            duration: 5000,
          });
        }
      };

      // Initialisation
      document.addEventListener("DOMContentLoaded", () => fetchCachedFiles(1));

      // Ferme les menus d'options quand on clique ailleurs sur la page
      document.addEventListener("click", (event) => {
        const isOptionButton = event.target.closest(
          '[id^="options-menu-"][id$="-button"]'
        );
        const isOptionMenu = event.target.closest('[role="menu"]');

        if (!isOptionButton && !isOptionMenu) {
          document.querySelectorAll('[role="menu"]').forEach((menu) => {
            menu.classList.add("hidden");
          });
          document
            .querySelectorAll('[id^="options-menu-"][id$="-button"]')
            .forEach((button) => {
              button.setAttribute("aria-expanded", "false");
            });
        }
      });
    </script>
  </body>
</html>
