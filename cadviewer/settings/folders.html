<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CADViewer - Conversion server settings</title>
    <!-- Inclusion du CDN Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!--Favicon-->
    <link rel="shortcut icon" href="https://www.cadviewer.com/images/favicon.png" type="image/x-icon">
    <link rel="icon" href="https://www.cadviewer.com/images/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="/settings/style.css">
    <script src="/settings/vanilla-toast.js"></script>
    <script src="/settings/icons.js"></script>
    <link rel="stylesheet" href="/settings/vanilla-toast.css">
</head>

<body class="h-full">
<div>
    <!-- Off-canvas menu for mobile, show/hide based on off-canvas menu state. -->
    <div class="relative z-50 lg:hidden" role="dialog" aria-modal="true">

        <div class="fixed inset-0 bg-gray-900/80" aria-hidden="true"></div>

        <div class="fixed inset-0 flex">
            <div class="relative mr-16 flex w-full max-w-xs flex-1">
                <div class="absolute left-full top-0 flex w-16 justify-center pt-5">
                    <button type="button" class="-m-2.5 p-2.5">
                        <span class="sr-only">Close sidebar</span>
                        <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <!-- Sidebar component, swap this element with another sidebar if you like -->
                <div class="flex grow flex-col gap-y-5 overflow-y-auto bg-white px-6 pb-4 h-full">
                    <div class="flex h-16 shrink-0 items-center">
                        <img class="h-8 w-auto" src="https://www.cadviewer.com/images/cadviewer/cv-logo-smaller.png" alt="Your Company">
                    </div>
                    <nav class="flex flex-1 flex-col">
                        <ul role="list" class="flex flex-1 flex-col gap-y-7">
                            <li>
                                <ul role="list" class="-mx-2 space-y-1">
                                    <li>
                                        <!-- Current: "bg-gray-50 text-orange-600", Default: "text-gray-700 hover:text-orange-600 hover:bg-gray-50" -->
                                        <a href="/settings" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                            <svg class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                                            </svg>
                                            Home
                                        </a>
                                    </li>
                                    <li>
                                        <a href="/settings/users" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                            <svg class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
                                            </svg>
                                            Users
                                        </a>
                                    </li>
                                    <li>
                                        <a href="/settings/folders" class="group flex gap-x-3 rounded-md bg-gray-50 p-2 text-sm font-semibold leading-6 text-orange-600">
                                            <svg class="h-6 w-6 shrink-0 text-orange-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
                                            </svg>
                                            Folders
                                        </a>
                                    </li>
                                    <li>
                                        <a href="/settings/licences" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                            <svg class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75" />
                                            </svg>
                                            Licences
                                        </a>
                                    </li>
                                    <li>
                                        <a href="/settings/logs" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />
                                            </svg>
                                            Logs
                                        </a>
                                    </li>

                                    <li>
                                        <a href="/settings/restapi-test" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z" />
                                            </svg>
                                            Rest API Test
                                        </a>
                                    </li>

                                    <li>
                                        <a href="/settings/config" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                            </svg>
                                            Config
                                        </a>
                                    </li>
                                    <li>
                                        <a href="/settings/doctor" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                            <svg class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z" />
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z" />
                                            </svg>
                                            CADViewer Doctor
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <div class="text-xs font-semibold leading-6 text-gray-400">Useful Links</div>
                                <ul role="list" class="-mx-2 mt-2 space-y-1">
                                    <li>
                                        <!-- Current: "bg-gray-50 text-orange-600", Default: "text-gray-700 hover:text-orange-600 hover:bg-gray-50" -->
                                        <a href="https://www.cadviewer.com/" target="_blank" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                            <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white text-[0.625rem] font-medium text-gray-400 group-hover:border-orange-600 group-hover:text-orange-600">C</span>
                                            <span class="truncate">CADViewer</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://www.tailormade.com/" target="_blank" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                            <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white text-[0.625rem] font-medium text-gray-400 group-hover:border-orange-600 group-hover:text-orange-600">T</span>
                                            <span class="truncate">Tailormade</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://store.cadviewer.com/" target="_blank" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                            <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white text-[0.625rem] font-medium text-gray-400 group-hover:border-orange-600 group-hover:text-orange-600">S</span>
                                            <span class="truncate">CADViewer Store</span>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                    <div class="mt-auto">
                        <div class="bg-gray-100 rounded-lg p-3 shadow-sm">
                            <div class="text-sm text-gray-600 font-medium">Version</div>
                            <div class="text-base text-gray-800">{version}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Static sidebar for desktop -->
    <div class="hidden lg:fixed lg:inset-y-0 lg:z-50 lg:flex lg:w-72 lg:flex-col">
        <!-- Sidebar component, swap this element with another sidebar if you like -->
        <div class="flex grow flex-col gap-y-5 overflow-y-auto border-r border-gray-200 bg-white px-6 h-full pb-4">
            <div class="flex h-16 shrink-0 items-center">
                <img class="h-12 w-auto" src="https://www.cadviewer.com/images/cadviewer/cv-logo-smaller.png" alt="CADViewer">
            </div>
            <nav class="flex flex-1 flex-col">
                <ul role="list" class="flex flex-1 flex-col gap-y-7">
                    <li>
                        <ul role="list" class="-mx-2 space-y-1">
                            <li>
                                <!-- Current: "bg-gray-50 text-orange-600", Default: "text-gray-700 hover:text-orange-600 hover:bg-gray-50" -->
                                <a href="/settings" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                    <svg class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                                    </svg>
                                    Home
                                </a>
                            </li>
                            <li>
                                <a href="/settings/users" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                    <svg class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
                                    </svg>
                                    Users
                                </a>
                            </li>
                            <li>
                                <a href="/settings/folders" class="group flex gap-x-3 rounded-md bg-gray-50 p-2 text-sm font-semibold leading-6 text-orange-600">
                                    <svg class="h-6 w-6 shrink-0 text-orange-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
                                    </svg>
                                    Folders
                                </a>
                            </li>
                            <li>
                                <a href="/settings/licences" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                    <svg class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75" />
                                    </svg>
                                    Licences
                                </a>
                            </li>
                            <li>
                                <a href="/settings/logs" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />
                                    </svg>
                                    Logs
                                </a>
                            </li>

                            <li>
                                <a href="/settings/restapi-test" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z" />
                                    </svg>
                                    Rest API Test
                                </a>
                            </li>

                            <li>
                                <a href="/settings/config" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                    </svg>
                                    Config
                                </a>
                            </li>
                            <li>
                                <a href="/settings/doctor" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                    <svg class="h-6 w-6 shrink-0 text-gray-400 group-hover:text-orange-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z" />
                                    </svg>
                                    CADViewer Doctor
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <div class="text-xs font-semibold leading-6 text-gray-400">Useful Links</div>
                        <ul role="list" class="-mx-2 mt-2 space-y-1">
                            <li>
                                <!-- Current: "bg-gray-50 text-orange-600", Default: "text-gray-700 hover:text-orange-600 hover:bg-gray-50" -->
                                <a href="https://www.cadviewer.com/" target="_blank" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                    <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white text-[0.625rem] font-medium text-gray-400 group-hover:border-orange-600 group-hover:text-orange-600">C</span>
                                    <span class="truncate">CADViewer</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.tailormade.com/" target="_blank" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                    <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white text-[0.625rem] font-medium text-gray-400 group-hover:border-orange-600 group-hover:text-orange-600">T</span>
                                    <span class="truncate">Tailormade</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://store.cadviewer.com/" target="_blank" class="group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:bg-gray-50 hover:text-orange-600">
                                    <span class="flex h-6 w-6 shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white text-[0.625rem] font-medium text-gray-400 group-hover:border-orange-600 group-hover:text-orange-600">S</span>
                                    <span class="truncate">CADViewer Store</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
            <div class="mt-auto">
                <div class="bg-gray-100 rounded-lg p-3 shadow-sm">
                    <div class="text-sm text-gray-600 font-medium">Version</div>
                    <div class="text-base text-gray-800">{version}</div>
                </div>
            </div>
        </div>
    </div>

    <div class="lg:pl-72">
        <div class="sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 bg-white px-4 sm:gap-x-6 sm:px-6 lg:px-8">
            <button type="button" class="-m-2.5 p-2.5 text-gray-700 lg:hidden">
                <span class="sr-only">Open sidebar</span>
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>

            <!-- Separator -->
            <div class="h-6 w-px bg-gray-200 lg:hidden" aria-hidden="true"></div>
            <h1 class="text-xl font-semibold leading-6 text-gray-900">Folders</h1>
        </div>

        <main class="px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center">
                <nav class="py-4 flex-1" aria-label="Breadcrumb" id="breadcrumb">
                </nav>
                <button type="button" onclick="openModalUpload()" class="ml-1 rounded bg-orange-600 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600 min-w-16">
                    Upload
                </button>
                <button type="button" onclick="openModalNewFolder()" class="ml-1 rounded bg-orange-600 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600 min-w-16">
                    New folder
                </button>
            </div>
            <div class="grid grid-cols-5 gap-4 pb-4" id="folders-view">
            </div>
        </main>
    </div>
</div>
<div class="bg-black opacity-50 fixed top-0 bottom-0 left-0 right-0 hidden" style="z-index: 51" id="backdrop"></div>
<div id="modal" class="relative hidden" style="z-index: 500" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div id="modal-backdrop" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div id="modal-panel" class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 text-orange-600">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
                            </svg>

                        </div>
                        <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full">
                            <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Rename Folder</h3>
                            <div class="mt-2">
                                <div class="w-full">
                                    <label for="folder-name" class="block text-sm font-medium leading-6 text-gray-900" id="folder-name-label">Folder name</label>
                                    <div class="mt-2 w-full">
                                        <input type="text" name="value" id="folder-name" class="block w-full rounded-md border-0 p-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-orange-600 sm:text-sm sm:leading-6" placeholder="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <button type="button" id="modal-button-save" class="inline-flex w-full justify-center rounded-md bg-orange-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 sm:ml-3 sm:w-auto">Save</button>
                    <button type="button" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto" onclick="closeModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!--        Modal for add new folder -->
<div id="modal-new-folder" class="relative hidden" style="z-index: 500" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div id="modal-new-folder-backdrop" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div id="modal-new-folder-panel" class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 text-orange-600">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 10.5v6m3-3H9m4.06-7.19-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
                            </svg>
                        </div>
                        <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full">
                            <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-new-folder-title">Add new Folder</h3>
                            <div class="mt-2">
                                <div class="w-full">
                                    <label for="folder-name" class="block text-sm font-medium leading-6 text-gray-900" id="new-folder-name-label">Folder name</label>
                                    <div class="mt-2 w-full">
                                        <input type="text" name="value" id="new-folder-name" class="block w-full rounded-md border-0 p-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-orange-600 sm:text-sm sm:leading-6" placeholder="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <button type="button" id="modal-new-folder-button-save" class="inline-flex w-full justify-center rounded-md bg-orange-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 sm:ml-3 sm:w-auto">Save</button>
                    <button type="button" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto" onclick="closeModalNewFolder()">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!--        Upload files modal-->
<div id="modal-upload" class="relative hidden" style="z-index: 500" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div id="modal-upload-backdrop" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div id="modal-upload-panel" class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                    <div class="flex gap-2 items-center">
                        <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 text-orange-600">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
                            </svg>
                        </div>
                        <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-upload-title">Upload files</h3>
                    </div>
                    <div class="mt-4 text-center sm:mt-0 sm:text-left w-full">
                        <div class="mt-2">
                            <div class="w-full bg-gray-100 p-2">
                                <div id="dropzone" class="w-full max-w-xl mx-auto p-8 border-4 border-dashed border-gray-300 rounded-lg text-center transition-all duration-300 hover:border-orange-500">
                                    <input type="file" id="fileInput" multiple class="hidden" />
                                    <div id="dropText" class="text-gray-500">
                                        <p class="text-xl mb-4">Drag and Drop Files Here</p>
                                        <p class="text-sm mb-4">or</p>
                                        <button id="browseBtn" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">Browse Files</button>
                                    </div>
                                    <div id="fileList" class="mt-4 grid grid-cols-3 gap-2"></div>
                                    <div id="uploadStatus" class="mt-4 text-center"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <button type="button" id="uploadBtn" class="inline-flex w-full justify-center rounded-md bg-orange-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 sm:ml-3 sm:w-auto hidden">Upload</button>
                    <button type="button" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto" onclick="closeModalUpload()">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!--        Rest api action -->
<div id="modal-restapi" class="relative hidden" style="z-index: 500" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div id="modal-restapi-backdrop" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div id="modal-restapi-panel" class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-orange-100 sm:mx-0 sm:h-10 sm:w-10">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 text-orange-600">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
                            </svg>

                        </div>
                        <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full">
                            <div class="flex justify-between w-full mb-2">
                                <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-restapi-title"></h3>
                                <span class="text-red-500 cursor-pointer" onclick="closeModalRestApi()">Cancel</span>
                            </div>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500" id="modal-restapi-description"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <button type="button" id="edit-query" class="flex gap-2 items-center w-full justify-center rounded-md bg-orange-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 sm:ml-3 sm:w-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                        </svg>
                        Edit query
                    </button>
                    <button type="button" id="execute-directly" class="mt-3 flex gap-2 items-center w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z" />
                        </svg>
                        <span>Execute directly</span>
                        <svg id="execute-directly-loader" class="hidden animate-spin h-5 w-5 text-gray-900" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>


    let folders = [];
    let breadcrumbs = [{
        index: 0,
        path: "index",
        name: `
                    <svg class="w-5 h-5 shrink-0" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
                        <path fill-rule="evenodd" d="M9.293 2.293a1 1 0 0 1 1.414 0l7 7A1 1 0 0 1 17 11h-1v6a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-6H3a1 1 0 0 1-.707-1.707l7-7Z" clip-rule="evenodd" />
                    </svg>
                `,
    }];

    function renderBreadcrumb () {
        const breadcrumbView = document.getElementById('breadcrumb');

        breadcrumbView.innerHTML = `
                    <ol role="list" class="flex items-center space-x-4">
                        ${breadcrumbs.map((breadcrumb, index) => {
            if (index === 0) {
                return `
                    <li class="cursor-pointer">
                        <div>
                            <a href="#" onclick="openBreadcrumb(${index})" class="text-gray-400 hover:text-gray-500">
                                ${breadcrumb.name}
                            </a>
                        </div>
                    </li>`
            } else {
                return `
                    <li class="${index === breadcrumbs.length - 1 ? '' : 'cursor-pointer'}">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 shrink-0 text-gray-300" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                <path d="M5.555 17.776l8-16 .894.448-8 16-.894-.448z" />
                            </svg>
                            <a href="#" onclick="${index === breadcrumbs.length - 1 ? '' : `openBreadcrumb(${index})`}" class="ml-4 text-sm font-medium text-gray-500 hover:text-gray-700">${breadcrumb.name}</a>
                        </div>
                    </li>
                `
            }
        }).join('')}
                    </ol>
                `;
    }

    async function getFoldersList() {
        try {
            const response = await fetch('/settings/folders', {
                method: 'POST',
            });

            if (response.ok) {
                const data = await response.json();
                folders = data;
                if (breadcrumbs.length > 1) {
                    let tmpFolders = folders;
                    for (let i = 1; i < breadcrumbs.length; i++) {
                        tmpFolders = tmpFolders.find((folder)=>folder.path === breadcrumbs[i].path)?.sub_dirs ?? []
                    }
                    renderFolders(tmpFolders);
                } else {
                    renderFolders(folders);
                }
                renderBreadcrumb();
                return data;
            } else {
                vanillaToast.error('Failed to retrieve folders list.', {duration: 5000 });
            }
        } catch (error) {
            console.error('Error:', error);
            vanillaToast.error('An error occurred while getting folders list.', {duration: 5000 });
        }
    }

    function evaluateIcon (filename, is_dir) {
        if (is_dir)
            return dirIcon;
        else if (filename.toLocaleLowerCase().endsWith('.json'))
            return jsonIcon;
        else if (filename.toLocaleLowerCase().endsWith('.dwg'))
            return dwgIcon;
        else if (filename.toLocaleLowerCase().endsWith('.dxf'))
            return dxfIcon;
        else if (filename.toLocaleLowerCase().endsWith('.dwf'))
            return dwfIcon;
        else if (filename.toLocaleLowerCase().endsWith('.dgn'))
            return dgnIcon;
        else if (filename.toLocaleLowerCase().endsWith('.tiff'))
            return tiffIcon;
        else if (filename.toLocaleLowerCase().endsWith('.tif'))
            return tifIcon;
        else if (filename.toLocaleLowerCase().endsWith('.pdf'))
            return pdfIcon;
        else if (filename.toLocaleLowerCase().endsWith('.svg'))
            return svgIcon;
        else if (filename.toLocaleLowerCase().endsWith('.png') || filename.toLocaleLowerCase().endsWith('.jpg') || filename.toLocaleLowerCase().endsWith('.jpeg') || filename.toLocaleLowerCase().endsWith('.gif') || filename.toLocaleLowerCase().endsWith('.bmp'))
            return imgIcon;
        else if (filename.toLocaleLowerCase().endsWith('.xls') || filename.toLocaleLowerCase().endsWith('.xlsx') || filename.toLocaleLowerCase().endsWith('.csv'))
            return csvIcon;
        else
            return unkownIcon;
    }

    function openBreadcrumb (index) {
        breadcrumbs = breadcrumbs.slice(0, index + 1);
        let tmpFolders = folders;
        for (let i = 1; i < breadcrumbs.length; i++) {
            tmpFolders = tmpFolders.find((folder)=>folder.path === breadcrumbs[i].path)?.sub_dirs ?? []
        }
        renderFolders(tmpFolders);
        renderBreadcrumb();
    }

    function openFolder (folder, index, path) {
        breadcrumbs.push({index: index, name: folder, path});
        console.log(breadcrumbs, path)
        let tmpFolders = folders;
        for (let i = 1; i < breadcrumbs.length; i++) {
            tmpFolders = tmpFolders.find((folder)=>folder.path.replaceAll(`\\`, "") === breadcrumbs[i].path.replaceAll(`\\`, ""))?.sub_dirs ?? []
        }
        renderFolders(tmpFolders);
        renderBreadcrumb();
    }

    function renderFolders (tmpFolders) {
        const foldersView = document.getElementById('folders-view');

        let innerHTML = '';

        if (tmpFolders.length === 0) {
            foldersView.classList.remove('grid', 'grid-cols-5', 'gap-4', 'pb-4');
            innerHTML = `
                    <div class="w-full h-full flex justify-center items-center min-h-80" style="min-height: 500px; max-height: 80vh">
                        <div class="text-center">
                          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                          </svg>
                          <h3 class="mt-2 text-sm font-semibold text-gray-900">No files or folders</h3>
                          <p class="mt-1 text-sm text-gray-500">
                            You can add new files or folders by clicking on upload or create new folder button below.
                          </p>
                          <div class="mt-6 flex gap-2 justify-center">

                                <button type="button" onclick="openModalUpload()" class="ml-1 rounded bg-orange-600 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600 min-w-16">
                                    Upload
                                </button>
                                <button type="button" onclick="openModalNewFolder()" class="ml-1 rounded bg-orange-600 px-2 py-1 text-sm font-semibold text-white shadow-sm hover:bg-orange-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-600 min-w-16">
                                    New folder
                                </button>
                          </div>
                        </div>
                    </div>
                    `
        } else {
            foldersView.classList.add('grid', 'grid-cols-5', 'gap-4', 'pb-4');
        }

        function  renderFolderFile(folder, index) {
            folder.name = folder.name.toLocaleLowerCase();
            const folderInnerHTML = `
                <div onclick="${folder.isFolder ? `openFolder('${folder.name}', ${index}, '${folder.path}')` : null}" class="relative rounded-lg border border-muted bg-gray-0 shadow-sm transition-all ${folder.isFolder ? 'hover:-translate-y-1 hover:shadow-lg cursor-pointer' : ''} dark:bg-gray-50 p-4">
                    <div class="w-full flex justify-between">
                        <div class="mb-4 flex h-12 w-12 items-center justify-center rounded-xl bg-gray-100">
                            <figure class="h-10 w-10 flex justify-center items-center">
                                ${evaluateIcon(folder.name, folder.isFolder)}
                            </figure>
                        </div>
                        <div class="relative fileActionBlock">
                            <button class="inline-flex items-center justify-center active:enabled:translate-y-px focus:outline-none focus-visible:ring-[1.8px] focus-visible:ring-offset-2 ring-offset-background transition-colors duration-200 p-1 w-9 h-9 rounded hover:text-orange focus-visible:ring-orange-lighter"
                                type="button" title="More Options"
                                onclick="function(event){event.preventDefault()}">
                                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 256 256" class="h-[18px] w-[18px] text-gray-500" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM128,76a28,28,0,1,0-28-28A28,28,0,0,0,128,76Zm0,104a28,28,0,1,0,28,28A28,28,0,0,0,128,180Z"></path>
                                </svg>
                            </button>
                            <div  style="z-index: 52" class="absolute right-0 z-10 w-48 mt-2 origin-top-right bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none hidden">

                              ${
    !folder.isFolder ? `
                                  <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
                                    ${(folder.name.endsWith('.dwg') || folder.name.endsWith('.dxf') || folder.name.endsWith('.dwf') || folder.name.endsWith('.dgn') || folder.name.endsWith('.tiff') || folder.name.endsWith('.tif') || folder.name.endsWith('.svg')) ?
        `<a href="#" onclick="restApiActionClick('${folder.name}', '${folder.path}', 'jsonDataExtraction')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">JSON Data Extraction</a>` : ''
    }
                                    ${(folder.name.endsWith('.dwg') || folder.name.endsWith('.dxf') || folder.name.endsWith('.dwf')) || folder.name.endsWith('.dgn') || folder.name.endsWith('.tiff') || folder.name.endsWith('.tif') ?
        `<a href="#" onclick="restApiActionClick('${folder.name}', '${folder.path}', 'dwgToSvg')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">DWG to SVG Conversion</a>` : ''
    }
                                    ${(folder.name.endsWith('.dwg') || folder.name.endsWith('.dxf') || folder.name.endsWith('.dwf') || folder.name.endsWith('.dgn') || folder.name.endsWith('.tiff') || folder.name.endsWith('.tif') || folder.name.endsWith('.svg')) ?
        `<a href="#" onclick="restApiActionClick('${folder.name}', '${folder.path}', 'dwgToPdf')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">DWG to PDF Conversion</a>` : ''
    }
                                    ${(folder.name.endsWith('.dwg') || folder.name.endsWith('.dxf') || folder.name.endsWith('.dwf') || folder.name.endsWith('.dgn') || folder.name.endsWith('.tiff') || folder.name.endsWith('.tif') || folder.name.endsWith('.svg')) ?
        `<a href="#" onclick="restApiActionClick('${folder.name}', '${folder.path}', 'displayDwg')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">Display  DWG</a>` : ''
    }
                                    ${(folder.name.endsWith('.dwg') || folder.name.endsWith('.dxf') || folder.name.endsWith('.dwf') || folder.name.endsWith('.dgn') || folder.name.endsWith('.tiff') || folder.name.endsWith('.tif') || folder.name.endsWith('.svg')) ?
        `<a href="#" onclick="restApiActionClick('${folder.name}', '${folder.path}', 'dwgToMultiple')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">DWG file in multiple files</a>` : ''
    }
                                    <a href="#" onclick="downloadFile('${folder.path}')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">Download</a>
                                    <a href="#" onclick="openModal(event, '${folder.path}', false)" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">Rename</a>
                                    <a href="#" onclick="deleteFileFolder('${folder.path}')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">Delete</a>
                                  </div>
                                ` : `
                                  <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
                                    <a href="#" onclick="openModal(event, '${folder.path}', true)" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">Rename</a>
                                    <a href="#" onclick="deleteFileFolder('${folder.path}')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">Delete</a>
                                  </div>
                                `
}
                            </div>
                        </div>
                    </div>
                    <div class="">
                        <h3 class="text-gray-900 font-bold text-base mb-2 break-all">${folder.name}</h3>
                        <p class="text-gray-700 text-base">
                            ${folder.isFolder ? `${folder.formatedSize}  ${folder.sub_dirs.length} files/dirs` : `${folder.formatedSize}`}
                        </p>
                    </div>
                </div>
            `
            innerHTML += folderInnerHTML;
        }

        const folders = tmpFolders.filter((folder) => folder.isFolder);
        folders.sort((a, b) => a.name.toLowerCase().localeCompare(b.name.toLowerCase()))
            .forEach(renderFolderFile);

        const files = tmpFolders.filter((folder) => !folder.isFolder);
        files.sort((a, b) => a.name.toLowerCase().localeCompare(b.name.toLowerCase()))
            .forEach(renderFolderFile);

        foldersView.innerHTML = innerHTML;
        document.querySelectorAll('.fileActionBlock').forEach((block) => {
            block.querySelector('button').addEventListener('click', (event) => {
                event.stopPropagation();
                block.querySelector('.hidden').classList.toggle('hidden');
                document.querySelector("#backdrop").classList.remove("hidden");
            });
        });
    }

    function closeBackdrop () {
        document.querySelector("#backdrop").classList.add("hidden");
        document.querySelectorAll('.fileActionBlock>div').forEach((block) => {
            block.classList.add('hidden');
        });
    }

    function deleteFileFolder (path) {
        closeBackdrop();
        // delete file/folder from post endpoint "/folders/delete"
        fetch('/settings/folders/delete', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({path: path}),
        }).then((response) => {
            if (response.ok) {
                getFoldersList();
                vanillaToast.success('File/Folder deleted successfully.', {duration: 5000 });
            } else {
                throw new Error('Error deleting file/folder');
            }
        })
            .catch(error => {
                console.error('Error deleting file/folder:', error);
                vanillaToast.error('Error deleting file/folder');
            });
    }

    function downloadFile (path) {
        closeBackdrop();
        // download file from post endpoint "/folders/download"
        fetch('/settings/folders/download', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({path: path}),
        }).then((response) => {
            if (response.ok) {
                return response.blob();
            } else {
                throw new Error('Error downloading file');
            }
        }).then((blob) => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = path.split('/').pop();
            document.body.appendChild(a);
            a.click();
            a.remove();
            window.URL.revokeObjectURL(url);
            vanillaToast.success('File downloaded successfully.', {duration: 5000 });
        })
            .catch(error => {
                console.error('Error downloading file:', error);
                vanillaToast.error('Error downloading file');
            });
    }

    function closeModalUpload() {
        document.body.classList.remove('overflow-hidden');
        document.querySelector('html').classList.remove('overflow-hidden');
        document.querySelector('body').classList.remove('overflow-hidden');
        document.getElementById('modal-upload').classList.add('hidden');
        document.getElementById('modal-upload-backdrop').classList.remove('opacity-100');
        document.getElementById('modal-upload-backdrop').classList.add('opacity-0');
        document.getElementById('modal-upload-panel').classList.remove('opacity-100', 'translate-y-0', 'sm:scale-100');
        document.getElementById('modal-upload-panel').classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
    }


    function closeModal() {
        document.body.classList.remove('overflow-hidden');
        document.querySelector('html').classList.remove('overflow-hidden');
        document.querySelector('body').classList.remove('overflow-hidden');
        document.getElementById('modal').classList.add('hidden');
        document.getElementById('modal-backdrop').classList.remove('opacity-100');
        document.getElementById('modal-backdrop').classList.add('opacity-0');
        document.getElementById('modal-panel').classList.remove('opacity-100', 'translate-y-0', 'sm:scale-100');
        document.getElementById('modal-panel').classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
    }

    function closeModalNewFolder() {
        document.body.classList.remove('overflow-hidden');
        document.querySelector('html').classList.remove('overflow-hidden');
        document.querySelector('body').classList.remove('overflow-hidden');
        document.getElementById('modal-new-folder').classList.add('hidden');
        document.getElementById('modal-new-folder-backdrop').classList.remove('opacity-100');
        document.getElementById('modal-new-folder-backdrop').classList.add('opacity-0');
        document.getElementById('modal-new-folder-panel').classList.remove('opacity-100', 'translate-y-0', 'sm:scale-100');
        document.getElementById('modal-new-folder-panel').classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
    }

    function openModalUpload() {

        // Initialize the dropzone
        const dropzone = new FileDropzone({
            path: breadcrumbs.map((breadcrumb, index) => index === 0 ? "/" : breadcrumb.name).join('/'),
            maxFiles: 5,
            maxFileSize: 10 * 1024 * 1024, // 10MB
            allowedTypes: ['image/*', 'application/pdf', '*']
        });

        document.body.classList.add('overflow-hidden');
        document.querySelector('html').classList.add('overflow-hidden');
        document.querySelector('body').classList.add('overflow-hidden');
        document.getElementById('modal-upload').classList.remove('hidden');
        document.getElementById('modal-upload-backdrop').classList.remove('opacity-0');
        document.getElementById('modal-upload-backdrop').classList.add('opacity-100');
        document.getElementById('modal-upload-panel').classList.remove('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
        document.getElementById('modal-upload-panel').classList.add('opacity-100', 'translate-y-0', 'sm:scale-100');
    }

    function openModalNewFolder() {
        document.getElementById('modal-new-folder-button-save').onclick = async () => {
            const folderName = document.getElementById('new-folder-name').value;
            const path = breadcrumbs.map((breadcrumb, index) => index === 0 ? "/" : breadcrumb.name).join('/');

            try {
                const response = await fetch('/settings/folders/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ folderName, path }),
                });

                if (response.ok) {
                    closeModalNewFolder();
                    vanillaToast.success('Folder created successfully.', {duration: 5000 });
                    await getFoldersList();
                } else {
                    vanillaToast.error('Failed to create folder.', {duration: 5000 });
                }
            } catch (error) {
                console.error('Error:', error);
                vanillaToast.error('An error occurred while creating folder.', {duration: 5000 });
            }
        }

        document.getElementById('new-folder-name').value = '';
        document.body.classList.add('overflow-hidden');
        document.querySelector('html').classList.add('overflow-hidden');
        document.querySelector('body').classList.add('overflow-hidden');
        document.getElementById('modal-new-folder').classList.remove('hidden');
        document.getElementById('modal-new-folder-backdrop').classList.remove('opacity-0');
        document.getElementById('modal-new-folder-backdrop').classList.add('opacity-100');
        document.getElementById('modal-new-folder-panel').classList.remove('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
        document.getElementById('modal-new-folder-panel').classList.add('opacity-100', 'translate-y-0', 'sm:scale-100');
    }

    function openModal(event, path, isFolder) {
        event.preventDefault();
        event.stopPropagation();
        closeBackdrop();
        document.getElementById('modal-button-save').onclick = async () => {
            const newValue = document.getElementById('folder-name').value;

            try {
                const response = await fetch('/settings/folders/update', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ newName: newValue, isFolder, path }),
                });

                if (response.ok) {
                    closeModal();
                    await getFoldersList();
                    vanillaToast.success(isFolder ? 'Folder renamed successfully.' : 'File renamed successfully.', {duration: 5000 });
                } else {
                    vanillaToast.error(isFolder ? 'Failed to rename folder.' : 'Failed to rename file.', {duration: 5000 });
                }
            } catch (error) {
                console.error('Error:', error);
                vanillaToast.error(isFolder ? 'An error occurred while renaming folder.' : 'An error occurred while renaming file.', {duration: 5000 });
            }
        }

        document.getElementById('modal-title').innerText = isFolder ? `Rename Folder - ${path.split("/").pop()}` : `Rename File - ${path.split("/").pop()}`;
        document.getElementById('folder-name').value = path.split("/").pop();
        document.getElementById('folder-name-label').innerText = isFolder ? 'Folder Name' : 'File Name';
        document.body.classList.add('overflow-hidden');
        document.querySelector('html').classList.add('overflow-hidden');
        document.querySelector('body').classList.add('overflow-hidden');
        document.getElementById('modal').classList.remove('hidden');
        document.getElementById('modal-backdrop').classList.remove('opacity-0');
        document.getElementById('modal-backdrop').classList.add('opacity-100');
        document.getElementById('modal-panel').classList.remove('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
        document.getElementById('modal-panel').classList.add('opacity-100', 'translate-y-0', 'sm:scale-100');
    }

    // closeModal();

    // on document load
    document.addEventListener('DOMContentLoaded', () => {
        getFoldersList();
    });


    document.querySelector("#backdrop").onclick = function() {
        closeBackdrop();
    }

    class FileDropzone {
        constructor(options = {}) {
            this.dropzone = document.getElementById('dropzone');
            this.fileInput = document.getElementById('fileInput');
            this.browseBtn = document.getElementById('browseBtn');
            this.dropText = document.getElementById('dropText');
            this.fileList = document.getElementById('fileList');
            this.uploadBtn = document.getElementById('uploadBtn');
            this.uploadStatus = document.getElementById('uploadStatus');

            this.path = options.path || '/';
            this.apiUrl = options.apiUrl || '/settings/folders/upload'; // Default upload endpoint
            this.maxFiles = options.maxFiles || 10;
            this.maxFileSize = options.maxFileSize || 5 * 1024 * 1024; // 5MB default
            this.allowedTypes = options.allowedTypes || ['image/*', 'application/pdf'];

            this.files = [];
            this.initEventListeners();
        }

        initEventListeners() {
            // Drag events
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                this.dropzone.addEventListener(eventName, this.preventDefaults, false);
            });

            this.dropzone.addEventListener('dragenter', this.highlight.bind(this));
            this.dropzone.addEventListener('dragover', this.highlight.bind(this));
            this.dropzone.addEventListener('dragleave', this.unhighlight.bind(this));
            this.dropzone.addEventListener('drop', this.handleDrop.bind(this));

            // Click events
            this.browseBtn.addEventListener('click', () => this.fileInput.click());
            this.fileInput.addEventListener('change', this.handleFiles.bind(this));

            // Upload button
            this.uploadBtn.addEventListener('click', this.uploadFiles.bind(this));
        }

        preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        highlight(e) {
            this.dropzone.classList.add('border-orange-500', 'bg-orange-50');
        }

        unhighlight(e) {
            this.dropzone.classList.remove('border-orange-500', 'bg-orange-50');
        }

        handleDrop(e) {
            this.unhighlight();
            const droppedFiles = e.dataTransfer.files;
            this.addFiles(droppedFiles);
        }

        handleFiles(e) {
            const selectedFiles = e.target.files;
            this.addFiles(selectedFiles);
        }

        addFiles(newFiles) {
            const filesArray = Array.from(newFiles);
            const validFiles = filesArray.filter(file => this.validateFile(file));

            const remainingSlots = this.maxFiles - this.files.length;
            const filesToAdd = validFiles.slice(0, remainingSlots);

            this.files.push(...filesToAdd);
            this.updateFileList();
        }

        validateFile(file) {
            const validType = this.allowedTypes.some(type =>
                file.type.match(new RegExp(type.replace('*', '.*')))
            );

            if (!validType) {
                alert(`Invalid file type: ${file.name}`);
                return false;
            }

            if (file.size > this.maxFileSize) {
                alert(`File too large: ${file.name}`);
                return false;
            }

            return true;
        }

        updateFileList() {
            this.fileList.innerHTML = '';
            this.files.forEach((file, index) => {
                const fileElement = document.createElement('div');
                fileElement.classList.add(
                    'bg-white', 'p-2', 'rounded', 'shadow',
                    'flex', 'items-center', 'justify-between'
                );

                const fileName = document.createElement('span');
                fileName.textContent = file.name;
                fileName.classList.add('text-sm', 'truncate', 'mr-2');

                const removeBtn = document.createElement('button');
                removeBtn.textContent = '';
                removeBtn.classList.add(
                    'text-red-500', 'hover:text-red-700',
                    'font-bold', 'text-sm', 'px-1'
                );
                removeBtn.addEventListener('click', () => {
                    this.removeFile(index);
                });

                fileElement.appendChild(fileName);
                fileElement.appendChild(removeBtn);
                this.fileList.appendChild(fileElement);
            });

            // Update or hide dropText and show/hide upload button
            this.dropText.style.display = this.files.length > 0 ? 'none' : 'block';
            this.uploadBtn.style.display = this.files.length > 0 ? 'block' : 'none';
        }

        removeFile(index) {
            this.files.splice(index, 1);
            this.updateFileList();
            this.fileInput.value = ''; // Reset file input
        }

        // Optional method to get files for upload
        getFiles() {
            return this.files;
        }

        async uploadFiles() {
            // Disable upload button during upload
            this.uploadBtn.disabled = true;
            this.uploadBtn.textContent = 'Uploading...';
            this.uploadStatus.textContent = '';

            // Create FormData
            const formData = new FormData();
            formData.append('path', this.path);
            this.files.forEach((file, index) => {
                formData.append('files', file, file.name);
            });

            try {
                const response = await fetch(this.apiUrl, {
                    method: 'POST',
                    body: formData
                    // Note: Do not set Content-Type header, let browser set it automatically
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                // Success handling
                this.uploadStatus.textContent = 'Upload Successful!';
                this.uploadStatus.classList.add('text-green-600');

                // Optional: clear files after successful upload
                this.files = [];
                this.updateFileList();
                closeModalUpload();
                await getFoldersList();
            } catch (error) {
                // Error handling
                console.error('Upload failed:', error);
                this.uploadStatus.textContent = `Upload Failed: ${error.message}`;
                this.uploadStatus.classList.add('text-red-600');
            } finally {
                // Re-enable upload button
                this.uploadBtn.disabled = false;
                this.uploadBtn.textContent = 'Upload Files';
            }
        }
    }

    function closeModalRestApi() {
        document.body.classList.remove('overflow-hidden');
        document.querySelector('html').classList.remove('overflow-hidden');
        document.querySelector('body').classList.remove('overflow-hidden');
        document.getElementById('modal-restapi').classList.add('hidden');
        document.getElementById('modal-restapi-backdrop').classList.remove('opacity-100');
        document.getElementById('modal-restapi-backdrop').classList.add('opacity-0');
        document.getElementById('modal-restapi-panel').classList.remove('opacity-100', 'translate-y-0', 'sm:scale-100');
        document.getElementById('modal-restapi-panel').classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
    }

    /**
     Code from rest-api.html
     */
    const jsonParamsDefault = {
        "action": "data_extraction",
        "converter": "LinkList 2025",
        "version": "V25.00",
        "contentType": "file",
        "contentResponse": "stream",
        "contentFormat": "DWG",
        "contentUsername": "",
        "contentPassword": "",
        "userLabel": "fromMyApp",
        "leaveStreamOnServer": 0,
        "contentLocation": `${window.location.origin}/content/drawings/dwg/1st floor plan.dwg`,
        "parameters": [
            {"paramName": "json", "paramValue": ""},
            {"paramName": "blocks", "paramValue": ""}
        ]
    };
    const svgParamsDefault = {
        "action": "svg_creation",
        "converter": "AutoXchange AX2025",
        "version": "V25.00",
        "contentType": "file",
        "contentResponse": "stream",
        "contentFormat": "DWG",
        "contentUsername": "",
        "contentPassword": "",
        "userLabel": "fromMyApp",
        "leaveStreamOnServer": 0,
        "contentLocation": `${window.location.origin}/content/drawings/dwg/1st floor plan.dwg`,
        "parameters": [
            {"paramName": "f", "paramValue": "svg"},
            {"paramName": "model", "paramValue": ""},
            {"paramName": "hlall", "paramValue": ""}
        ]
    };
    const pdfParamsDefault = {
        "action":"svg_creation",
        "converter":"AutoXchange AX2025",
        "version":"V25.00",
        "contentType":"file",
        "contentResponse":"stream",
        "contentFormat":"DWG",
        "contentUsername":"",
        "contentPassword":"",
        "userLabel":"fromMyApp",
        "leaveStreamOnServer":0,
        "contentLocation": `${window.location.origin}/content/drawings/dwg/1st floor plan.dwg`,
        "parameters":[
            {"paramName":"f","paramValue":"pdf"},
            {"paramName":"model","paramValue":""}
        ]
    };
    const displayDwgParamsDefault = {
        "action":"cadviewer_display",
        "converter":"AutoXchange AX2025",
        "version":"V25.00",
        "contentType":"file",
        "contentResponse":"stream",
        "contentFormat":"DWG",
        "contentUsername":"",
        "contentPassword":"",
        "userLabel":"fromMyApp",
        "leaveStreamOnServer":0,
        "contentLocation": `${window.location.origin}/content/drawings/dwg/1st floor plan.dwg`,
        "parameters":[
            {"paramName":"f", "paramValue":"svg"},
            {"paramName":"model", "paramValue":""},
            {"paramName":"hlall", "paramValue":""}
        ]
    }
    const splittingDwgParamsDefault = {
        "action":"data_extraction",
        "converter":"LinkList 2025",
        "version":"V25.00",
        "contentType":"file",
        "contentResponse":"stream",
        "contentFormat":"DWG",
        "contentUsername":"",
        "contentPassword":"",
        "userLabel":"fromMyApp",
        "leaveStreamOnServer":0,
        "contentLocation":"http://localhost:3000/content/drawings/dwg/1st floor plan.dwg",
        "parameters":[
            {
                "paramName":"splity",
                "paramValue":""
            }
        ]
    }

    function downloadBlob (blob, filename) {
        // Create a URL for the blob
        const url = window.URL.createObjectURL(blob);

        // Create a temporary anchor element
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;  // Specify the file name for the download

        // Append the anchor to the document and trigger a click
        document.body.appendChild(a);
        a.click();

        // Remove the anchor from the document
        document.body.removeChild(a);

        // Revoke the object URL to release memory
        window.URL.revokeObjectURL(url);
    }

    // get the blob of the url with fetch and download it
    function downloadLink (url, filename) {
        fetch(url)
            .then(response => response.blob())
            .then(blob => {
                downloadBlob(blob, filename);
            });
    }

    async function call_server_post(data_object, tms_rest_api_url_pw) {

        const api_data = JSON.stringify(data_object);
        console.log(api_data);
        let status = "Unknown";

        const filelist_data = {
            'request': api_data
        };

        const response = await fetch(tms_rest_api_url_pw, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(filelist_data)
        });
        status = response.status;
        const Api_response = await response.json();
        console.log("call_server_post - SERVER RESPONSE POST: " + JSON.stringify(Api_response));

        let conversion_result = "";

        try {
            conversion_result = JSON.parse(Api_response);
        } catch (err) {
            console.log("Do not parse, so this is JSON:(" + err + ")");
            conversion_result = Api_response;
        }

        let RESTcontent = conversion_result.contentStreamData;

        // 9.46.3 remove garbage
        RESTcontent = RESTcontent.replaceAll("//", "/");
        RESTcontent = RESTcontent.replaceAll(":/", "://");

        console.log("call_server_post: " + RESTcontent);

        // Post Processing the return data
        // window.open(RESTcontent);
        return {status, "response": Api_response};
    }
    /** End of that code*/


    async function loadActionContentLocationParams(actionName, contentLocation) {
        try {
            const response = await fetch("/settings/restapi-test/parameters/search", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    actionName, contentLocation
                }),
            });
            let data = await response.json();
            if (response.status === 200) {
                return data["parameters"];
            } else {
                console.error('Error:', data);
                vanillaToast.error('An error occurred while loading parameters.', {duration: 5000 });
                return [];
            }
        } catch (error) {
            console.error('Error:', error);
            vanillaToast.error('An error occurred while loading parameters.', {duration: 5000 });
            return [];
        }
    }


    function restApiActionClick (filename, path, action) {
        closeBackdrop();
        // list action: jsonDataExtraction, dwgToSvg, dwgToPdf, displayDwg, dwgToMultiple

        let title = '';
        switch (action) {
            case 'jsonDataExtraction':
                title = 'JSON Data Extraction';
                break;
            case 'dwgToSvg':
                title = 'DWG to SVG Conversion';
                break;
            case 'dwgToPdf':
                title = 'DWG to PDF Conversion';
                break;
            case 'displayDwg':
                title = 'Display DWG';
                break;
            case 'dwgToMultiple':
                title = 'DWG file in multiple files';
                break;
            default:
                title = 'Action';
                break;
        }

        let description = '';
        switch (action) {
            case 'jsonDataExtraction':
                description = 'Test POST Conversion Server - JSON Data Extraction';
                break;
            case 'dwgToSvg':
                description = 'Test POST Conversion Server - DWG to SVG Conversion';
                break;
            case 'dwgToPdf':
                description = 'Test POST Conversion Server - DWG to PDF Conversion';
                break;
            case 'displayDwg':
                description = 'CADViewer Display of DWG';
                break;
            case 'dwgToMultiple':
                description = 'Splitting of modelspace DWG file in multiple files';
                break;
            default:
                description = 'Action';
                break;
        }

        document.getElementById('modal-restapi-title').innerText = title;
        document.getElementById('modal-restapi-description').innerText = description;

        // enable button
        document.getElementById('execute-directly').disabled = false;
        document.getElementById('edit-query').disabled = false;

        const jsonParams = jsonParamsDefault;
        const svgParams = svgParamsDefault;
        const pdfParams = pdfParamsDefault;
        const displayDwgParams = displayDwgParamsDefault;
        const splittingDwgParams = splittingDwgParamsDefault;

        loadActionContentLocationParams(action, path).then((params) => {
            if (params.length > 0) {
                switch (action) {
                    case 'jsonDataExtraction':
                        jsonParams.parameters = params;
                        break;
                    case 'dwgToSvg':
                        svgParams.parameters = params;
                        break;
                    case 'dwgToPdf':
                        pdfParams.parameters = params;
                        break;
                    case 'displayDwg':
                        displayDwgParams.parameters = params;
                        break;
                    case 'dwgToMultiple':
                        splittingDwgParams.parameters = params;
                        break;
                    default:
                        break;
                }
            }
        });

        document.getElementById('execute-directly').onclick = async () => {
            // enable button
            jsonParams.contentLocation = path;
            svgParams.contentLocation = path;
            pdfParams.contentLocation = path;
            displayDwgParams.contentLocation = path;
            splittingDwgParams.contentLocation = path;

            document.getElementById('execute-directly').disabled = true;
            document.getElementById('edit-query').disabled = true;
            document.getElementById('execute-directly-loader').classList.remove('hidden');

            switch (action) {
                case 'jsonDataExtraction':
                    const {response} = await call_server_post(jsonParams, `${window.location.origin}/callapiconversion`);
                    if (response.contentStreamData && response.tempFile) {
                        downloadLink(response.contentStreamData, response.tempFile);
                        vanillaToast.success('JSON data extracted successfully.', {duration: 5000 });
                    } else {
                        vanillaToast.error('Failed to extract JSON data.', {duration: 5000 });
                    }
                    break;
                case 'dwgToSvg':
                    const {response: responseSvg} = await call_server_post(svgParams, `${window.location.origin}/callapiconversion`);
                    if (responseSvg.contentStreamData && responseSvg.tempFile) {
                        downloadLink(responseSvg.contentStreamData, responseSvg.tempFile);
                        vanillaToast.success('DWG converted to SVG successfully.', {duration: 5000 });
                    } else {
                        vanillaToast.error('Failed to convert DWG to SVG.', {duration: 5000 });
                    }
                    break;
                case 'dwgToPdf':
                    const {response: responsePdf} = await call_server_post(pdfParams, `${window.location.origin}/callapiconversion`);
                    if (responsePdf.contentStreamData && responsePdf.tempFile) {
                        downloadLink(responsePdf.contentStreamData, responsePdf.tempFile);
                        vanillaToast.success('DWG converted to PDF successfully.', {duration: 5000 });
                    } else {
                        vanillaToast.error('Failed to convert DWG to PDF.', {duration: 5000 });
                    }
                    break;
                case 'displayDwg':
                    const {response: responseDisplayDwg} = await call_server_post(displayDwgParams, `${window.location.origin}/callapiconversion`);
                    if (responseDisplayDwg.contentStreamData && responseDisplayDwg.tempFile) {
                        window.open(responseDisplayDwg.contentStreamData, '_blank');
                        vanillaToast.success('DWG displayed successfully.', {duration: 5000 });
                    } else {
                        vanillaToast.error('Failed to display DWG.', {duration: 5000 });
                    }
                    break;
                case 'dwgToMultiple':
                    const {response: responseSplittingDwg} = await call_server_post(splittingDwgParams, `${window.location.origin}/callapiconversion`);
                    if (responseSplittingDwg.contentStreamData && responseSplittingDwg.tempFile) {
                        window.open(responseSplittingDwg.contentStreamData, '_blank');
                        vanillaToast.success('DWG splitted successfully.', {duration: 5000 });
                    } else {
                        vanillaToast.error('Failed to split DWG.', {duration: 5000 });
                    }
                    break;
                default:
                    vanillaToast.error('Action not found.', {duration: 5000 });
                    break;
            }

            closeModalRestApi();
            document.getElementById('execute-directly-loader').classList.add('hidden');
        }

        document.getElementById('edit-query').onclick = async () => {
            const url = new URL(window.location.origin + "/settings/restapi-test" + "?path=" + path + "&action=" + action);
            // open in new tab
            window.open(url, '_blank');
            closeModalRestApi();
        }

        document.body.classList.add('overflow-hidden');
        document.querySelector('html').classList.add('overflow-hidden');
        document.querySelector('body').classList.add('overflow-hidden');
        document.getElementById('modal-restapi').classList.remove('hidden');
        document.getElementById('modal-restapi-backdrop').classList.remove('opacity-0');
        document.getElementById('modal-restapi-backdrop').classList.add('opacity-100');
        document.getElementById('modal-restapi-panel').classList.remove('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
        document.getElementById('modal-restapi-panel').classList.add('opacity-100', 'translate-y-0', 'sm:scale-100');
    }


    // document.getElementById('refresh').addEventListener('click', () => {
    //     getFoldersList();
    // });

</script>
</body>
</html>
