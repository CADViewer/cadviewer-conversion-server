const a15_0x3c94ef=a15_0x55ba;function a15_0x55ba(_0x5145ad,_0xd424a){const _0x498d13=a15_0x498d();return a15_0x55ba=function(_0x55ba49,_0x4f0ebb){_0x55ba49=_0x55ba49-0x1a9;let _0x53b761=_0x498d13[_0x55ba49];return _0x53b761;},a15_0x55ba(_0x5145ad,_0xd424a);}(function(_0x317303,_0x265a3b){const _0xc25f8b=a15_0x55ba,_0x3a72a5=_0x317303();while(!![]){try{const _0x227fca=parseInt(_0xc25f8b(0x1d4))/0x1+-parseInt(_0xc25f8b(0x1be))/0x2*(parseInt(_0xc25f8b(0x1ac))/0x3)+-parseInt(_0xc25f8b(0x1ca))/0x4+-parseInt(_0xc25f8b(0x1ad))/0x5+-parseInt(_0xc25f8b(0x1d5))/0x6*(-parseInt(_0xc25f8b(0x1d9))/0x7)+-parseInt(_0xc25f8b(0x1d3))/0x8+parseInt(_0xc25f8b(0x1b7))/0x9*(parseInt(_0xc25f8b(0x1dd))/0xa);if(_0x227fca===_0x265a3b)break;else _0x3a72a5['push'](_0x3a72a5['shift']());}catch(_0x2d1a99){_0x3a72a5['push'](_0x3a72a5['shift']());}}}(a15_0x498d,0x76df5));const fs=require('fs'),path=require(a15_0x3c94ef(0x1e1)),config=require('../CADViewer_config.json'),verifyTokenOptional=require('../libs/jwt')[a15_0x3c94ef(0x1cf)],show_folders=![],express=require(a15_0x3c94ef(0x1b5)),router=express['Router'](),conn=require(a15_0x3c94ef(0x1bb)),{randomUUID}=require(a15_0x3c94ef(0x1b0)),dir='./uploads';!fs[a15_0x3c94ef(0x1bc)](dir)&&fs[a15_0x3c94ef(0x1e0)](dir);const sortFoldersFirst=(_0xc6cb5,_0x3fcc5c)=>{const _0x11a957=a15_0x3c94ef;if(_0xc6cb5['children']&&!_0x3fcc5c[_0x11a957(0x1bd)])return-0x1;else return!_0xc6cb5[_0x11a957(0x1bd)]&&_0x3fcc5c[_0x11a957(0x1bd)]?0x1:0x0;},listFolderStructure=(_0x199965,_0x36c6ad='')=>{const _0x3a88bb=a15_0x3c94ef,_0xaed3d5=fs[_0x3a88bb(0x1db)](_0x199965),_0x3d624a=[];return _0xaed3d5[_0x3a88bb(0x1c4)](_0x13cdef=>{const _0x344007=_0x3a88bb,_0x8d066f=path[_0x344007(0x1c0)](_0x199965,_0x13cdef),_0x2b467c=fs['statSync'](_0x8d066f);if(_0x2b467c[_0x344007(0x1de)]()){if(config['cvjs_debug']&&show_folders)console[_0x344007(0x1d2)](_0x36c6ad+'└──\x20'+_0x13cdef);const _0x228fc5=listFolderStructure(_0x8d066f,_0x36c6ad+_0x344007(0x1ab));_0x3d624a['push']({'name':_0x13cdef,'path':_0x8d066f,'size':_0x2b467c[_0x344007(0x1ba)],'created':_0x2b467c[_0x344007(0x1c9)],'modified':_0x2b467c[_0x344007(0x1bf)],'isFolder':!![],'children':_0x228fc5});}else{_0x3d624a[_0x344007(0x1c8)]({'name':_0x13cdef,'path':_0x8d066f,'size':_0x2b467c['size'],'created':_0x2b467c[_0x344007(0x1c9)],'modified':_0x2b467c[_0x344007(0x1bf)],'isFolder':![]});if(config[_0x344007(0x1df)]&&show_folders)console[_0x344007(0x1d2)](_0x36c6ad+'├──\x20'+_0x13cdef);}}),_0x3d624a[_0x3a88bb(0x1d6)](sortFoldersFirst);};function a15_0x498d(){const _0x5aa0c1=['path','json','resolve','main','CADViewer_config.json','readFileSync','false','filename','\x20\x20\x20','3dZwQgc','1766460VSdnaC','length','cvhs_debug:','crypto','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','execute','email','MY\x20FOLDER','express','promise','30771FWYGmM','role','get','size','../libs/mysql','existsSync','children','622114TtHFBc','mtime','join','Invalid\x20user','\x20show_folders:','parse','forEach','exports','status','user','push','birthtime','1504436PXKfVZ','utf8','folderLocation','in\x20listFolderStructure\x20folderLocation=','./uploads/','verifyTokenOptional','folder_name','send','log','2099400kykyUp','686177dUwHpf','12mjayep','sort','admin','query','1577023WYFGcL','loginFeatureEnabled','readdirSync','Error!\x20Something\x20went\x20wrong.','1910JyjOhG','isDirectory','cvjs_debug','mkdirSync'];a15_0x498d=function(){return _0x5aa0c1;};return a15_0x498d();}router[a15_0x3c94ef(0x1b9)]('',verifyTokenOptional,async(_0x179584,_0x6a8a3b)=>{const _0x26e883=a15_0x3c94ef,_0x587eb2=path[_0x26e883(0x1c0)](path['dirname'](require[_0x26e883(0x1e4)][_0x26e883(0x1aa)]),_0x26e883(0x1e5)),_0x870db1=JSON[_0x26e883(0x1c3)](fs[_0x26e883(0x1e6)](_0x587eb2,_0x26e883(0x1cb))),_0x12fc6f=_0x179584[_0x26e883(0x1d8)][_0x26e883(0x1da)];let _0x2d6ccf=_0x870db1['folderLocationDemoUser'];_0x12fc6f===_0x26e883(0x1a9)&&(_0x2d6ccf=_0x870db1[_0x26e883(0x1cc)]);console[_0x26e883(0x1d2)](_0x26e883(0x1cd)+_0x2d6ccf+_0x26e883(0x1c2)+show_folders+_0x26e883(0x1af)+config['cvjs_debug']);if(_0x179584[_0x26e883(0x1c7)]){let _0x481704;try{const [_0x35d77]=await conn[_0x26e883(0x1b6)]()[_0x26e883(0x1b2)](_0x26e883(0x1b1),[_0x179584['user'][_0x26e883(0x1b3)]]);_0x35d77[_0x26e883(0x1ae)]>0x0&&(_0x481704=_0x35d77[0x0]);}catch(_0x5d6465){console[_0x26e883(0x1d2)]({'err':_0x5d6465}),_0x6a8a3b[_0x26e883(0x1c6)](0x1f4)[_0x26e883(0x1e2)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x481704){_0x6a8a3b[_0x26e883(0x1c6)](0x191)[_0x26e883(0x1e2)]({'error':_0x26e883(0x1c1)});return;}_0x481704[_0x26e883(0x1b8)]===_0x26e883(0x1d7)&&(_0x2d6ccf=_0x870db1[_0x26e883(0x1cc)]);let _0x27fffd=_0x481704[_0x26e883(0x1d0)];if(!_0x27fffd){_0x27fffd=randomUUID();try{await conn[_0x26e883(0x1b6)]()[_0x26e883(0x1b2)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x27fffd,_0x179584['user'][_0x26e883(0x1b3)]]);}catch(_0x1bb0eb){console[_0x26e883(0x1d2)]({'err':_0x1bb0eb}),_0x6a8a3b[_0x26e883(0x1c6)](0x1f4)[_0x26e883(0x1e2)]({'error':_0x26e883(0x1dc)});return;}}const _0x5dd296=_0x26e883(0x1ce)+_0x27fffd;!fs[_0x26e883(0x1bc)](_0x5dd296)&&fs[_0x26e883(0x1e0)](_0x5dd296);const _0x569011=path[_0x26e883(0x1e3)](_0x5dd296),_0x16cdec=listFolderStructure(_0x569011);!fs[_0x26e883(0x1bc)](_0x2d6ccf)&&fs[_0x26e883(0x1e0)](_0x2d6ccf),dirs=[{'own':!![],'name':_0x26e883(0x1b4),'path':_0x5dd296,'isFolder':!![],'children':_0x16cdec},...listFolderStructure(_0x2d6ccf)],_0x6a8a3b[_0x26e883(0x1d1)](dirs);}else!fs[_0x26e883(0x1bc)](_0x2d6ccf)&&fs[_0x26e883(0x1e0)](_0x2d6ccf),_0x6a8a3b['send'](listFolderStructure(_0x2d6ccf));}),module[a15_0x3c94ef(0x1c5)]=router;