const a16_0x2152be=a16_0x1c0c;function a16_0x1c0c(_0x512f65,_0x194c23){const _0x208da1=a16_0x208d();return a16_0x1c0c=function(_0x1c0cc1,_0x4c1651){_0x1c0cc1=_0x1c0cc1-0xa5;let _0x337be4=_0x208da1[_0x1c0cc1];return _0x337be4;},a16_0x1c0c(_0x512f65,_0x194c23);}(function(_0x3841ed,_0x2b41ed){const _0x552653=a16_0x1c0c,_0x45fb5b=_0x3841ed();while(!![]){try{const _0x34933b=parseInt(_0x552653(0xba))/0x1+parseInt(_0x552653(0xcc))/0x2*(parseInt(_0x552653(0xc6))/0x3)+parseInt(_0x552653(0xc2))/0x4+parseInt(_0x552653(0xcd))/0x5*(-parseInt(_0x552653(0xd8))/0x6)+parseInt(_0x552653(0xd3))/0x7+-parseInt(_0x552653(0xce))/0x8+parseInt(_0x552653(0xde))/0x9*(parseInt(_0x552653(0xb3))/0xa);if(_0x34933b===_0x2b41ed)break;else _0x45fb5b['push'](_0x45fb5b['shift']());}catch(_0x27cf9d){_0x45fb5b['push'](_0x45fb5b['shift']());}}}(a16_0x208d,0xd7b31));const fs=require('fs'),path=require(a16_0x2152be(0xa5)),config=require('../CADViewer_config.json'),verifyTokenOptional=require('../libs/jwt')[a16_0x2152be(0xc7)],show_folders=![],express=require(a16_0x2152be(0xb1)),router=express[a16_0x2152be(0xa8)](),conn=require(a16_0x2152be(0xc1)),{randomUUID}=require('crypto'),dir=a16_0x2152be(0xd2);!fs['existsSync'](dir)&&fs[a16_0x2152be(0xab)](dir);const sortFoldersFirst=(_0x58ab30,_0x5f3159)=>{const _0x27ff81=a16_0x2152be;if(_0x58ab30['children']&&!_0x5f3159[_0x27ff81(0xd9)])return-0x1;else return!_0x58ab30[_0x27ff81(0xd9)]&&_0x5f3159[_0x27ff81(0xd9)]?0x1:0x0;},listFolderStructure=(_0x3c4b2b,_0x41ba5b='')=>{const _0x3e41cb=a16_0x2152be,_0x5e09e2=fs['readdirSync'](_0x3c4b2b),_0x41628f=[];return _0x5e09e2['forEach'](_0x826651=>{const _0x464440=a16_0x1c0c,_0x4850b8=path[_0x464440(0xad)](_0x3c4b2b,_0x826651),_0x55ba79=fs[_0x464440(0xc9)](_0x4850b8);if(_0x55ba79[_0x464440(0xb8)]()){if(config[_0x464440(0xbe)]&&show_folders)console['log'](_0x41ba5b+'└──\x20'+_0x826651);const _0x31b546=listFolderStructure(_0x4850b8,_0x41ba5b+_0x464440(0xa6));_0x41628f[_0x464440(0xc5)]({'name':_0x826651,'path':_0x4850b8,'size':_0x55ba79[_0x464440(0xc0)],'created':_0x55ba79[_0x464440(0xd6)],'modified':_0x55ba79['mtime'],'isFolder':!![],'children':_0x31b546});}else{_0x41628f[_0x464440(0xc5)]({'name':_0x826651,'path':_0x4850b8,'size':_0x55ba79[_0x464440(0xc0)],'created':_0x55ba79['birthtime'],'modified':_0x55ba79[_0x464440(0xc4)],'isFolder':![]});if(config[_0x464440(0xbe)]&&show_folders)console['log'](_0x41ba5b+'├──\x20'+_0x826651);}}),_0x41628f[_0x3e41cb(0xc3)](sortFoldersFirst);};router[a16_0x2152be(0xb9)]('',verifyTokenOptional,async(_0x558acb,_0x5f3010)=>{const _0x51fadc=a16_0x2152be,_0x3103f1=path[_0x51fadc(0xad)](path['dirname'](require['main'][_0x51fadc(0xbf)]),_0x51fadc(0xb5)),_0x20ab94=JSON[_0x51fadc(0xa7)](fs[_0x51fadc(0xd0)](_0x3103f1,_0x51fadc(0xac))),_0x5f4f2e=_0x558acb[_0x51fadc(0xd1)][_0x51fadc(0xcb)];let _0x557c6c=_0x20ab94[_0x51fadc(0xd5)];_0x5f4f2e===_0x51fadc(0xbb)&&(_0x557c6c=_0x20ab94[_0x51fadc(0xdc)]);console[_0x51fadc(0xdd)](_0x51fadc(0xb2)+_0x557c6c+'\x20show_folders:'+show_folders+'cvhs_debug:'+config['cvjs_debug']);if(_0x558acb[_0x51fadc(0xb6)]){let _0x3627a7;try{const [_0x5d18ce]=await conn[_0x51fadc(0xbc)]()[_0x51fadc(0xae)](_0x51fadc(0xb4),[_0x558acb[_0x51fadc(0xb6)][_0x51fadc(0xb7)]]);_0x5d18ce[_0x51fadc(0xa9)]>0x0&&(_0x3627a7=_0x5d18ce[0x0]);}catch(_0x179f4e){console[_0x51fadc(0xdd)]({'err':_0x179f4e}),_0x5f3010[_0x51fadc(0xbd)](0x1f4)[_0x51fadc(0xdb)]({'error':_0x51fadc(0xd4)});return;}if(!_0x3627a7){_0x5f3010[_0x51fadc(0xbd)](0x191)['json']({'error':_0x51fadc(0xda)});return;}_0x3627a7[_0x51fadc(0xb0)]===_0x51fadc(0xd7)&&(_0x557c6c=_0x20ab94[_0x51fadc(0xdc)]);let _0x43aad1=_0x3627a7[_0x51fadc(0xaf)];if(!_0x43aad1){_0x43aad1=randomUUID();try{await conn['promise']()['execute']('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x43aad1,_0x558acb['user']['email']]);}catch(_0x302ea2){console[_0x51fadc(0xdd)]({'err':_0x302ea2}),_0x5f3010[_0x51fadc(0xbd)](0x1f4)['json']({'error':_0x51fadc(0xd4)});return;}}const _0xaf26c0=_0x51fadc(0xc8)+_0x43aad1;!fs[_0x51fadc(0xaa)](_0xaf26c0)&&fs['mkdirSync'](_0xaf26c0);const _0x1a46c6=path[_0x51fadc(0xcf)](_0xaf26c0),_0x344475=listFolderStructure(_0x1a46c6);!fs[_0x51fadc(0xaa)](_0x557c6c)&&fs['mkdirSync'](_0x557c6c),dirs=[{'own':!![],'name':_0x51fadc(0xdf),'path':_0xaf26c0,'isFolder':!![],'children':_0x344475},...listFolderStructure(_0x557c6c)],_0x5f3010['send'](dirs);}else!fs[_0x51fadc(0xaa)](_0x557c6c)&&fs['mkdirSync'](_0x557c6c),_0x5f3010['send'](listFolderStructure(_0x557c6c));}),module[a16_0x2152be(0xca)]=router;function a16_0x208d(){const _0x3ac46b=['push','12wseuzW','verifyTokenOptional','./uploads/','statSync','exports','loginFeatureEnabled','244934zbGdLR','50kUZuLW','10432760wGWfiJ','resolve','readFileSync','query','./uploads','6990725xDIEKU','Error!\x20Something\x20went\x20wrong.','folderLocationDemoUser','birthtime','admin','284910LDsmsf','children','Invalid\x20user','json','folderLocation','log','99kBazuj','MY\x20FOLDER','path','\x20\x20\x20','parse','Router','length','existsSync','mkdirSync','utf8','join','execute','folder_name','role','express','in\x20listFolderStructure\x20folderLocation=','149290QfkTYv','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','CADViewer_config.json','user','email','isDirectory','get','376176Npzvno','false','promise','status','cvjs_debug','filename','size','../libs/mysql','2534048qEQBHm','sort','mtime'];a16_0x208d=function(){return _0x3ac46b;};return a16_0x208d();}