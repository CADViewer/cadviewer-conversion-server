const a15_0x473a08=a15_0x2763;(function(_0x575032,_0x30521a){const _0xbe20ed=a15_0x2763,_0x47d7c1=_0x575032();while(!![]){try{const _0x34d0fe=-parseInt(_0xbe20ed(0x12a))/0x1+-parseInt(_0xbe20ed(0x131))/0x2*(parseInt(_0xbe20ed(0x119))/0x3)+parseInt(_0xbe20ed(0x128))/0x4+parseInt(_0xbe20ed(0x10a))/0x5*(-parseInt(_0xbe20ed(0x120))/0x6)+-parseInt(_0xbe20ed(0x11e))/0x7+parseInt(_0xbe20ed(0x136))/0x8+parseInt(_0xbe20ed(0x129))/0x9;if(_0x34d0fe===_0x30521a)break;else _0x47d7c1['push'](_0x47d7c1['shift']());}catch(_0xfb193){_0x47d7c1['push'](_0x47d7c1['shift']());}}}(a15_0x41ce,0xad2db));function a15_0x2763(_0x4e878e,_0x7f7b60){const _0x41ce34=a15_0x41ce();return a15_0x2763=function(_0x2763c6,_0xfd45ba){_0x2763c6=_0x2763c6-0x109;let _0x161ca7=_0x41ce34[_0x2763c6];return _0x161ca7;},a15_0x2763(_0x4e878e,_0x7f7b60);}const fs=require('fs'),path=require('path'),config=require(a15_0x473a08(0x11f)),verifyTokenOptional=require(a15_0x473a08(0x12e))[a15_0x473a08(0x126)],show_folders=![],express=require(a15_0x473a08(0x117)),router=express['Router'](),conn=require(a15_0x473a08(0x113)),{randomUUID}=require('crypto'),dir=a15_0x473a08(0x123);function a15_0x41ce(){const _0x446a83=['readFileSync','status','join','Error!\x20Something\x20went\x20wrong.','5393040JtrdbF','folder_name','existsSync','log','length','├──\x20','CADViewer_config.json','in\x20listFolderStructure\x20folderLocation=','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','push','2344835qqmZvU','./uploads/','isDirectory','\x20\x20\x20','Invalid\x20user','forEach','execute','\x20show_folders:','children','../libs/mysql','promise','resolve','dirname','express','user','6nczuHG','mkdirSync','mtime','size','admin','7299593CZnFPe','../CADViewer_config.json','12PnQAjf','main','cvjs_debug','./uploads','folderLocationDemoUser','birthtime','verifyTokenOptional','parse','3485524mRkxrT','16863840TZIPke','616061JCLvpf','email','query','exports','../libs/jwt','folderLocation','└──\x20','113138iodlpM'];a15_0x41ce=function(){return _0x446a83;};return a15_0x41ce();}!fs[a15_0x473a08(0x138)](dir)&&fs['mkdirSync'](dir);const sortFoldersFirst=(_0x5efbf6,_0x38cf73)=>{const _0xc9c31f=a15_0x473a08;if(_0x5efbf6['children']&&!_0x38cf73[_0xc9c31f(0x112)])return-0x1;else return!_0x5efbf6[_0xc9c31f(0x112)]&&_0x38cf73[_0xc9c31f(0x112)]?0x1:0x0;},listFolderStructure=(_0x1bd515,_0x2e0cfe='')=>{const _0x4e0f12=a15_0x473a08,_0x34aa62=fs['readdirSync'](_0x1bd515),_0x1860cf=[];return _0x34aa62[_0x4e0f12(0x10f)](_0x340036=>{const _0x1ff9ba=_0x4e0f12,_0x49f159=path[_0x1ff9ba(0x134)](_0x1bd515,_0x340036),_0x206a90=fs['statSync'](_0x49f159);if(_0x206a90[_0x1ff9ba(0x10c)]()){if(config[_0x1ff9ba(0x122)]&&show_folders)console['log'](_0x2e0cfe+_0x1ff9ba(0x130)+_0x340036);const _0x36da5e=listFolderStructure(_0x49f159,_0x2e0cfe+_0x1ff9ba(0x10d));_0x1860cf[_0x1ff9ba(0x109)]({'name':_0x340036,'path':_0x49f159,'size':_0x206a90[_0x1ff9ba(0x11c)],'created':_0x206a90[_0x1ff9ba(0x125)],'modified':_0x206a90['mtime'],'isFolder':!![],'children':_0x36da5e});}else{_0x1860cf[_0x1ff9ba(0x109)]({'name':_0x340036,'path':_0x49f159,'size':_0x206a90[_0x1ff9ba(0x11c)],'created':_0x206a90[_0x1ff9ba(0x125)],'modified':_0x206a90[_0x1ff9ba(0x11b)],'isFolder':![]});if(config['cvjs_debug']&&show_folders)console['log'](_0x2e0cfe+_0x1ff9ba(0x13b)+_0x340036);}}),_0x1860cf['sort'](sortFoldersFirst);};router['get']('',verifyTokenOptional,async(_0x1e5420,_0x568111)=>{const _0x4a1ac8=a15_0x473a08,_0x35b7bf=path[_0x4a1ac8(0x134)](path[_0x4a1ac8(0x116)](require[_0x4a1ac8(0x121)]['filename']),_0x4a1ac8(0x13c)),_0x3b0f98=JSON[_0x4a1ac8(0x127)](fs[_0x4a1ac8(0x132)](_0x35b7bf,'utf8')),_0x2245e3=_0x1e5420[_0x4a1ac8(0x12c)]['loginFeatureEnabled'];let _0x4bd4e1=_0x3b0f98[_0x4a1ac8(0x124)];_0x2245e3==='false'&&(_0x4bd4e1=_0x3b0f98['folderLocation']);console[_0x4a1ac8(0x139)](_0x4a1ac8(0x13d)+_0x4bd4e1+_0x4a1ac8(0x111)+show_folders+'cvhs_debug:'+config[_0x4a1ac8(0x122)]);if(_0x1e5420[_0x4a1ac8(0x118)]){let _0x3c5b87;try{const [_0x16fd1a]=await conn[_0x4a1ac8(0x114)]()[_0x4a1ac8(0x110)](_0x4a1ac8(0x13e),[_0x1e5420[_0x4a1ac8(0x118)][_0x4a1ac8(0x12b)]]);_0x16fd1a[_0x4a1ac8(0x13a)]>0x0&&(_0x3c5b87=_0x16fd1a[0x0]);}catch(_0x357083){console[_0x4a1ac8(0x139)]({'err':_0x357083}),_0x568111[_0x4a1ac8(0x133)](0x1f4)['json']({'error':_0x4a1ac8(0x135)});return;}if(!_0x3c5b87){_0x568111[_0x4a1ac8(0x133)](0x191)['json']({'error':_0x4a1ac8(0x10e)});return;}_0x3c5b87['role']===_0x4a1ac8(0x11d)&&(_0x4bd4e1=_0x3b0f98[_0x4a1ac8(0x12f)]);let _0x1f2a42=_0x3c5b87[_0x4a1ac8(0x137)];if(!_0x1f2a42){_0x1f2a42=randomUUID();try{await conn[_0x4a1ac8(0x114)]()[_0x4a1ac8(0x110)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x1f2a42,_0x1e5420['user'][_0x4a1ac8(0x12b)]]);}catch(_0x254083){console[_0x4a1ac8(0x139)]({'err':_0x254083}),_0x568111[_0x4a1ac8(0x133)](0x1f4)['json']({'error':_0x4a1ac8(0x135)});return;}}const _0x99b333=_0x4a1ac8(0x10b)+_0x1f2a42;!fs[_0x4a1ac8(0x138)](_0x99b333)&&fs['mkdirSync'](_0x99b333);const _0x8e0991=path[_0x4a1ac8(0x115)](_0x99b333),_0x5a5d35=listFolderStructure(_0x8e0991);!fs['existsSync'](_0x4bd4e1)&&fs[_0x4a1ac8(0x11a)](_0x4bd4e1),dirs=[{'own':!![],'name':'MY\x20FOLDER','path':_0x99b333,'isFolder':!![],'children':_0x5a5d35},...listFolderStructure(_0x4bd4e1)],_0x568111['send'](dirs);}else!fs[_0x4a1ac8(0x138)](_0x4bd4e1)&&fs['mkdirSync'](_0x4bd4e1),_0x568111['send'](listFolderStructure(_0x4bd4e1));}),module[a15_0x473a08(0x12d)]=router;