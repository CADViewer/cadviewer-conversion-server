const a16_0x7018d1=a16_0x395d;function a16_0x116c(){const _0x35a5b8=['219252VviGaj','statSync','email','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','main','../libs/jwt','get','log','13dgJVUb','birthtime','length','./uploads','1198304VoUkKE','join','verifyTokenOptional','crypto','send','dirname','utf8','loginFeatureEnabled','cvhs_debug:','\x20\x20\x20','cvjs_debug','size','execute','Router','filename','admin','existsSync','Error!\x20Something\x20went\x20wrong.','\x20show_folders:','sort','push','550272PsHgpo','mtime','../CADViewer_config.json','7pcEwez','901815EbReWi','5732820qWggJO','promise','../libs/mysql','resolve','└──\x20','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','exports','120813ccPBms','mkdirSync','parse','children','json','query','folderLocation','folderLocationDemoUser','2836RsvNGz','role','user','status','Invalid\x20user','readFileSync','isDirectory','forEach','path'];a16_0x116c=function(){return _0x35a5b8;};return a16_0x116c();}(function(_0x34b4c3,_0x58761a){const _0x44061f=a16_0x395d,_0x324220=_0x34b4c3();while(!![]){try{const _0x41b96a=-parseInt(_0x44061f(0x158))/0x1*(-parseInt(_0x44061f(0x147))/0x2)+-parseInt(_0x44061f(0x13f))/0x3+-parseInt(_0x44061f(0x171))/0x4+-parseInt(_0x44061f(0x137))/0x5+parseInt(_0x44061f(0x150))/0x6*(-parseInt(_0x44061f(0x136))/0x7)+-parseInt(_0x44061f(0x15c))/0x8+parseInt(_0x44061f(0x138))/0x9;if(_0x41b96a===_0x58761a)break;else _0x324220['push'](_0x324220['shift']());}catch(_0x3639cb){_0x324220['push'](_0x324220['shift']());}}}(a16_0x116c,0x1b122));function a16_0x395d(_0x3657c1,_0x110063){const _0x116c09=a16_0x116c();return a16_0x395d=function(_0x395dbf,_0x471fd3){_0x395dbf=_0x395dbf-0x135;let _0x39c181=_0x116c09[_0x395dbf];return _0x39c181;},a16_0x395d(_0x3657c1,_0x110063);}const fs=require('fs'),path=require(a16_0x7018d1(0x14f)),config=require(a16_0x7018d1(0x135)),verifyTokenOptional=require(a16_0x7018d1(0x155))[a16_0x7018d1(0x15e)],show_folders=![],express=require('express'),router=express[a16_0x7018d1(0x169)](),conn=require(a16_0x7018d1(0x13a)),{randomUUID}=require(a16_0x7018d1(0x15f)),dir=a16_0x7018d1(0x15b);!fs[a16_0x7018d1(0x16c)](dir)&&fs[a16_0x7018d1(0x140)](dir);const sortFoldersFirst=(_0xe96506,_0xb43f40)=>{const _0x3ac58f=a16_0x7018d1;if(_0xe96506[_0x3ac58f(0x142)]&&!_0xb43f40[_0x3ac58f(0x142)])return-0x1;else return!_0xe96506[_0x3ac58f(0x142)]&&_0xb43f40['children']?0x1:0x0;},listFolderStructure=(_0x3e9bdb,_0x31c0c9='')=>{const _0x5e9e52=a16_0x7018d1,_0x527d1d=fs['readdirSync'](_0x3e9bdb),_0x2bf620=[];return _0x527d1d[_0x5e9e52(0x14e)](_0x4f1506=>{const _0x5775da=_0x5e9e52,_0x573544=path[_0x5775da(0x15d)](_0x3e9bdb,_0x4f1506),_0x538c12=fs[_0x5775da(0x151)](_0x573544);if(_0x538c12[_0x5775da(0x14d)]()){if(config[_0x5775da(0x166)]&&show_folders)console[_0x5775da(0x157)](_0x31c0c9+_0x5775da(0x13c)+_0x4f1506);const _0x458a07=listFolderStructure(_0x573544,_0x31c0c9+_0x5775da(0x165));_0x2bf620[_0x5775da(0x170)]({'name':_0x4f1506,'path':_0x573544,'size':_0x538c12[_0x5775da(0x167)],'created':_0x538c12['birthtime'],'modified':_0x538c12['mtime'],'isFolder':!![],'children':_0x458a07});}else{_0x2bf620[_0x5775da(0x170)]({'name':_0x4f1506,'path':_0x573544,'size':_0x538c12['size'],'created':_0x538c12[_0x5775da(0x159)],'modified':_0x538c12[_0x5775da(0x172)],'isFolder':![]});if(config[_0x5775da(0x166)]&&show_folders)console[_0x5775da(0x157)](_0x31c0c9+'├──\x20'+_0x4f1506);}}),_0x2bf620[_0x5e9e52(0x16f)](sortFoldersFirst);};router[a16_0x7018d1(0x156)]('',verifyTokenOptional,async(_0x346808,_0x17c4f9)=>{const _0x1fed2d=a16_0x7018d1,_0x48bdfe=path[_0x1fed2d(0x15d)](path[_0x1fed2d(0x161)](require[_0x1fed2d(0x154)][_0x1fed2d(0x16a)]),'CADViewer_config.json'),_0x3aa382=JSON[_0x1fed2d(0x141)](fs[_0x1fed2d(0x14c)](_0x48bdfe,_0x1fed2d(0x162))),_0x5ec171=_0x346808[_0x1fed2d(0x144)][_0x1fed2d(0x163)];let _0xe0658d=_0x3aa382[_0x1fed2d(0x146)];_0x5ec171==='false'&&(_0xe0658d=_0x3aa382[_0x1fed2d(0x145)]);console[_0x1fed2d(0x157)]('in\x20listFolderStructure\x20folderLocation='+_0xe0658d+_0x1fed2d(0x16e)+show_folders+_0x1fed2d(0x164)+config[_0x1fed2d(0x166)]);if(_0x346808[_0x1fed2d(0x149)]){let _0x1c5b4e;try{const [_0x5df9dc]=await conn['promise']()[_0x1fed2d(0x168)](_0x1fed2d(0x153),[_0x346808[_0x1fed2d(0x149)][_0x1fed2d(0x152)]]);_0x5df9dc[_0x1fed2d(0x15a)]>0x0&&(_0x1c5b4e=_0x5df9dc[0x0]);}catch(_0x4fa05f){console[_0x1fed2d(0x157)]({'err':_0x4fa05f}),_0x17c4f9[_0x1fed2d(0x14a)](0x1f4)[_0x1fed2d(0x143)]({'error':_0x1fed2d(0x16d)});return;}if(!_0x1c5b4e){_0x17c4f9[_0x1fed2d(0x14a)](0x191)['json']({'error':_0x1fed2d(0x14b)});return;}_0x1c5b4e[_0x1fed2d(0x148)]===_0x1fed2d(0x16b)&&(_0xe0658d=_0x3aa382['folderLocation']);let _0x3a125c=_0x1c5b4e['folder_name'];if(!_0x3a125c){_0x3a125c=randomUUID();try{await conn[_0x1fed2d(0x139)]()[_0x1fed2d(0x168)](_0x1fed2d(0x13d),[_0x3a125c,_0x346808[_0x1fed2d(0x149)]['email']]);}catch(_0x591825){console['log']({'err':_0x591825}),_0x17c4f9[_0x1fed2d(0x14a)](0x1f4)['json']({'error':_0x1fed2d(0x16d)});return;}}const _0x42ac99='./uploads/'+_0x3a125c;!fs[_0x1fed2d(0x16c)](_0x42ac99)&&fs[_0x1fed2d(0x140)](_0x42ac99);const _0x3bb5ea=path[_0x1fed2d(0x13b)](_0x42ac99),_0x2e8680=listFolderStructure(_0x3bb5ea);!fs[_0x1fed2d(0x16c)](_0xe0658d)&&fs[_0x1fed2d(0x140)](_0xe0658d),dirs=[{'own':!![],'name':'MY\x20FOLDER','path':_0x42ac99,'isFolder':!![],'children':_0x2e8680},...listFolderStructure(_0xe0658d)],_0x17c4f9['send'](dirs);}else!fs[_0x1fed2d(0x16c)](_0xe0658d)&&fs['mkdirSync'](_0xe0658d),_0x17c4f9[_0x1fed2d(0x160)](listFolderStructure(_0xe0658d));}),module[a16_0x7018d1(0x13e)]=router;