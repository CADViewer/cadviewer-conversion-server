const a15_0x6bed4b=a15_0x576e;(function(_0xd1af9b,_0x2e6784){const _0xff1f68=a15_0x576e,_0x11ec44=_0xd1af9b();while(!![]){try{const _0x44a3bb=-parseInt(_0xff1f68(0x12d))/0x1*(parseInt(_0xff1f68(0x10c))/0x2)+parseInt(_0xff1f68(0x129))/0x3+parseInt(_0xff1f68(0x113))/0x4+parseInt(_0xff1f68(0xfb))/0x5*(-parseInt(_0xff1f68(0x120))/0x6)+parseInt(_0xff1f68(0x10a))/0x7+-parseInt(_0xff1f68(0x101))/0x8*(-parseInt(_0xff1f68(0x11d))/0x9)+-parseInt(_0xff1f68(0x11b))/0xa;if(_0x44a3bb===_0x2e6784)break;else _0x11ec44['push'](_0x11ec44['shift']());}catch(_0x5eeace){_0x11ec44['push'](_0x11ec44['shift']());}}}(a15_0x4357,0x75bba));const fs=require('fs'),path=require(a15_0x6bed4b(0x123)),config=require('../CADViewer_config.json'),verifyTokenOptional=require(a15_0x6bed4b(0x122))[a15_0x6bed4b(0x102)],show_folders=![],express=require(a15_0x6bed4b(0x103)),router=express[a15_0x6bed4b(0x11c)](),conn=require(a15_0x6bed4b(0xf2)),{randomUUID}=require('crypto'),dir=a15_0x6bed4b(0x10e);function a15_0x576e(_0x2599ca,_0x162177){const _0x4357aa=a15_0x4357();return a15_0x576e=function(_0x576ed9,_0x4663e8){_0x576ed9=_0x576ed9-0xf2;let _0x24851f=_0x4357aa[_0x576ed9];return _0x24851f;},a15_0x576e(_0x2599ca,_0x162177);}!fs['existsSync'](dir)&&fs[a15_0x6bed4b(0xfc)](dir);function a15_0x4357(){const _0x5332ce=['cvhs_debug:','push','log','user','loginFeatureEnabled','readdirSync','54300ttspRh','Router','135hsiEUq','cvjs_debug','email','74742IcpQZv','utf8','../libs/jwt','path','promise','admin','role','filename','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','749085egxokH','\x20show_folders:','Invalid\x20user','in\x20listFolderStructure\x20folderLocation=','192KyJyBA','birthtime','Error!\x20Something\x20went\x20wrong.','get','readFileSync','../libs/mysql','mtime','MY\x20FOLDER','children','resolve','CADViewer_config.json','folderLocationDemoUser','exports','forEach','255NHJwQL','mkdirSync','send','size','├──\x20','folder_name','235000XWGBHL','verifyTokenOptional','express','status','query','length','sort','execute','json','5508706tuvrdk','main','7490iBVsJV','└──\x20','./uploads','isDirectory','join','folderLocation','dirname','1458932Bqnvhp','existsSync'];a15_0x4357=function(){return _0x5332ce;};return a15_0x4357();}const sortFoldersFirst=(_0x5aa020,_0x593913)=>{const _0x10f1a6=a15_0x6bed4b;if(_0x5aa020['children']&&!_0x593913[_0x10f1a6(0xf5)])return-0x1;else return!_0x5aa020[_0x10f1a6(0xf5)]&&_0x593913[_0x10f1a6(0xf5)]?0x1:0x0;},listFolderStructure=(_0x571d7c,_0x1d3e83='')=>{const _0x16a198=a15_0x6bed4b,_0x2033b5=fs[_0x16a198(0x11a)](_0x571d7c),_0x227900=[];return _0x2033b5[_0x16a198(0xfa)](_0x3655d4=>{const _0x279637=_0x16a198,_0x2a3a03=path[_0x279637(0x110)](_0x571d7c,_0x3655d4),_0x4a4ded=fs['statSync'](_0x2a3a03);if(_0x4a4ded[_0x279637(0x10f)]()){if(config[_0x279637(0x11e)]&&show_folders)console[_0x279637(0x117)](_0x1d3e83+_0x279637(0x10d)+_0x3655d4);const _0x5e6e83=listFolderStructure(_0x2a3a03,_0x1d3e83+'\x20\x20\x20');_0x227900[_0x279637(0x116)]({'name':_0x3655d4,'path':_0x2a3a03,'size':_0x4a4ded[_0x279637(0xfe)],'created':_0x4a4ded[_0x279637(0x12e)],'modified':_0x4a4ded[_0x279637(0xf3)],'isFolder':!![],'children':_0x5e6e83});}else{_0x227900[_0x279637(0x116)]({'name':_0x3655d4,'path':_0x2a3a03,'size':_0x4a4ded['size'],'created':_0x4a4ded[_0x279637(0x12e)],'modified':_0x4a4ded[_0x279637(0xf3)],'isFolder':![]});if(config[_0x279637(0x11e)]&&show_folders)console['log'](_0x1d3e83+_0x279637(0xff)+_0x3655d4);}}),_0x227900[_0x16a198(0x107)](sortFoldersFirst);};router[a15_0x6bed4b(0x130)]('',verifyTokenOptional,async(_0x4c14a9,_0x22675c)=>{const _0x1f70fb=a15_0x6bed4b,_0x29a950=path[_0x1f70fb(0x110)](path[_0x1f70fb(0x112)](require[_0x1f70fb(0x10b)][_0x1f70fb(0x127)]),_0x1f70fb(0xf7)),_0x8369e7=JSON['parse'](fs[_0x1f70fb(0x131)](_0x29a950,_0x1f70fb(0x121))),_0x55604f=_0x4c14a9[_0x1f70fb(0x105)][_0x1f70fb(0x119)];let _0x1acf99=_0x8369e7[_0x1f70fb(0xf8)];_0x55604f==='false'&&(_0x1acf99=_0x8369e7[_0x1f70fb(0x111)]);console['log'](_0x1f70fb(0x12c)+_0x1acf99+_0x1f70fb(0x12a)+show_folders+_0x1f70fb(0x115)+config[_0x1f70fb(0x11e)]);if(_0x4c14a9[_0x1f70fb(0x118)]){let _0x538179;try{const [_0x495d73]=await conn['promise']()[_0x1f70fb(0x108)](_0x1f70fb(0x128),[_0x4c14a9['user'][_0x1f70fb(0x11f)]]);_0x495d73[_0x1f70fb(0x106)]>0x0&&(_0x538179=_0x495d73[0x0]);}catch(_0x470347){console[_0x1f70fb(0x117)]({'err':_0x470347}),_0x22675c[_0x1f70fb(0x104)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x538179){_0x22675c[_0x1f70fb(0x104)](0x191)[_0x1f70fb(0x109)]({'error':_0x1f70fb(0x12b)});return;}_0x538179[_0x1f70fb(0x126)]===_0x1f70fb(0x125)&&(_0x1acf99=_0x8369e7[_0x1f70fb(0x111)]);let _0x5a4b74=_0x538179[_0x1f70fb(0x100)];if(!_0x5a4b74){_0x5a4b74=randomUUID();try{await conn[_0x1f70fb(0x124)]()[_0x1f70fb(0x108)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x5a4b74,_0x4c14a9[_0x1f70fb(0x118)][_0x1f70fb(0x11f)]]);}catch(_0x1cfe8c){console[_0x1f70fb(0x117)]({'err':_0x1cfe8c}),_0x22675c[_0x1f70fb(0x104)](0x1f4)[_0x1f70fb(0x109)]({'error':_0x1f70fb(0x12f)});return;}}const _0x5949c6='./uploads/'+_0x5a4b74;!fs[_0x1f70fb(0x114)](_0x5949c6)&&fs[_0x1f70fb(0xfc)](_0x5949c6);const _0x155f9b=path[_0x1f70fb(0xf6)](_0x5949c6),_0x438355=listFolderStructure(_0x155f9b);!fs['existsSync'](_0x1acf99)&&fs[_0x1f70fb(0xfc)](_0x1acf99),dirs=[{'own':!![],'name':_0x1f70fb(0xf4),'path':_0x5949c6,'isFolder':!![],'children':_0x438355},...listFolderStructure(_0x1acf99)],_0x22675c[_0x1f70fb(0xfd)](dirs);}else!fs[_0x1f70fb(0x114)](_0x1acf99)&&fs[_0x1f70fb(0xfc)](_0x1acf99),_0x22675c['send'](listFolderStructure(_0x1acf99));}),module[a15_0x6bed4b(0xf9)]=router;