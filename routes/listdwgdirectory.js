const a15_0x142cbf=a15_0x2dbf;function a15_0x2dbf(_0xcc294f,_0x13cfe9){const _0x34da28=a15_0x34da();return a15_0x2dbf=function(_0x2dbf64,_0x5a9597){_0x2dbf64=_0x2dbf64-0x1a0;let _0x3ad3bc=_0x34da28[_0x2dbf64];return _0x3ad3bc;},a15_0x2dbf(_0xcc294f,_0x13cfe9);}(function(_0x533988,_0x26ab5b){const _0x2f4802=a15_0x2dbf,_0x360f0c=_0x533988();while(!![]){try{const _0x2d7c13=parseInt(_0x2f4802(0x1ce))/0x1*(parseInt(_0x2f4802(0x1bf))/0x2)+parseInt(_0x2f4802(0x1c4))/0x3+-parseInt(_0x2f4802(0x1c7))/0x4+-parseInt(_0x2f4802(0x1bc))/0x5*(-parseInt(_0x2f4802(0x1c0))/0x6)+parseInt(_0x2f4802(0x1a7))/0x7+parseInt(_0x2f4802(0x1cd))/0x8*(parseInt(_0x2f4802(0x1b2))/0x9)+-parseInt(_0x2f4802(0x1a0))/0xa*(parseInt(_0x2f4802(0x1a8))/0xb);if(_0x2d7c13===_0x26ab5b)break;else _0x360f0c['push'](_0x360f0c['shift']());}catch(_0x3d976d){_0x360f0c['push'](_0x360f0c['shift']());}}}(a15_0x34da,0x87719));const fs=require('fs'),path=require(a15_0x142cbf(0x1ad)),config=require('../CADViewer_config.json'),verifyTokenOptional=require('../libs/jwt')[a15_0x142cbf(0x1c9)],show_folders=![],express=require(a15_0x142cbf(0x1be)),router=express[a15_0x142cbf(0x1ac)](),conn=require(a15_0x142cbf(0x1c8)),{randomUUID}=require(a15_0x142cbf(0x1d6)),dir='./uploads';!fs[a15_0x142cbf(0x1b0)](dir)&&fs['mkdirSync'](dir);const sortFoldersFirst=(_0x34ea03,_0x1c688d)=>{const _0x5c82a1=a15_0x142cbf;if(_0x34ea03[_0x5c82a1(0x1db)]&&!_0x1c688d[_0x5c82a1(0x1db)])return-0x1;else return!_0x34ea03[_0x5c82a1(0x1db)]&&_0x1c688d[_0x5c82a1(0x1db)]?0x1:0x0;},listFolderStructure=(_0x56c263,_0x524992='')=>{const _0x2ad3b5=a15_0x142cbf,_0x15287d=fs[_0x2ad3b5(0x1dd)](_0x56c263),_0x424c3b=[];return _0x15287d['forEach'](_0xd070ea=>{const _0x463d95=_0x2ad3b5,_0x205388=path[_0x463d95(0x1b4)](_0x56c263,_0xd070ea),_0x2b283f=fs[_0x463d95(0x1c2)](_0x205388);if(_0x2b283f[_0x463d95(0x1a5)]()){if(config[_0x463d95(0x1d0)]&&show_folders)console['log'](_0x524992+_0x463d95(0x1d5)+_0xd070ea);const _0x5eb05f=listFolderStructure(_0x205388,_0x524992+_0x463d95(0x1d4));_0x424c3b[_0x463d95(0x1d3)]({'name':_0xd070ea,'path':_0x205388,'size':_0x2b283f[_0x463d95(0x1b9)],'created':_0x2b283f[_0x463d95(0x1ab)],'modified':_0x2b283f[_0x463d95(0x1b8)],'isFolder':!![],'children':_0x5eb05f});}else{_0x424c3b[_0x463d95(0x1d3)]({'name':_0xd070ea,'path':_0x205388,'size':_0x2b283f['size'],'created':_0x2b283f['birthtime'],'modified':_0x2b283f[_0x463d95(0x1b8)],'isFolder':![]});if(config['cvjs_debug']&&show_folders)console['log'](_0x524992+_0x463d95(0x1dc)+_0xd070ea);}}),_0x424c3b['sort'](sortFoldersFirst);};router[a15_0x142cbf(0x1c5)]('',verifyTokenOptional,async(_0x407695,_0x51b5ba)=>{const _0x40f36d=a15_0x142cbf,_0xb4b2ea=path['join'](path['dirname'](require[_0x40f36d(0x1b1)][_0x40f36d(0x1ba)]),_0x40f36d(0x1a3)),_0x4f4a5d=JSON[_0x40f36d(0x1bd)](fs[_0x40f36d(0x1a9)](_0xb4b2ea,_0x40f36d(0x1bb))),_0xaaa2d6=_0x407695['query'][_0x40f36d(0x1d7)];let _0x2c13d4=_0x4f4a5d[_0x40f36d(0x1c6)];_0xaaa2d6===_0x40f36d(0x1a4)&&(_0x2c13d4=_0x4f4a5d['folderLocation']);console[_0x40f36d(0x1cb)]('in\x20listFolderStructure\x20folderLocation='+_0x2c13d4+_0x40f36d(0x1df)+show_folders+_0x40f36d(0x1d1)+config[_0x40f36d(0x1d0)]);if(_0x407695[_0x40f36d(0x1d9)]){let _0x2627f0;try{const [_0x4a2d22]=await conn[_0x40f36d(0x1d2)]()[_0x40f36d(0x1de)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x407695['user'][_0x40f36d(0x1aa)]]);_0x4a2d22[_0x40f36d(0x1cc)]>0x0&&(_0x2627f0=_0x4a2d22[0x0]);}catch(_0x9ea0f5){console['log']({'err':_0x9ea0f5}),_0x51b5ba[_0x40f36d(0x1da)](0x1f4)['json']({'error':_0x40f36d(0x1c1)});return;}if(!_0x2627f0){_0x51b5ba[_0x40f36d(0x1da)](0x191)[_0x40f36d(0x1d8)]({'error':_0x40f36d(0x1b3)});return;}_0x2627f0[_0x40f36d(0x1af)]===_0x40f36d(0x1ae)&&(_0x2c13d4=_0x4f4a5d[_0x40f36d(0x1a1)]);let _0x4f20db=_0x2627f0[_0x40f36d(0x1cf)];if(!_0x4f20db){_0x4f20db=randomUUID();try{await conn[_0x40f36d(0x1d2)]()[_0x40f36d(0x1de)](_0x40f36d(0x1c3),[_0x4f20db,_0x407695[_0x40f36d(0x1d9)]['email']]);}catch(_0x1ec2b1){console['log']({'err':_0x1ec2b1}),_0x51b5ba['status'](0x1f4)[_0x40f36d(0x1d8)]({'error':_0x40f36d(0x1c1)});return;}}const _0x5c598d=_0x40f36d(0x1a2)+_0x4f20db;!fs[_0x40f36d(0x1b0)](_0x5c598d)&&fs[_0x40f36d(0x1b5)](_0x5c598d);const _0x4768c3=path[_0x40f36d(0x1ca)](_0x5c598d),_0x4bc3f2=listFolderStructure(_0x4768c3);!fs[_0x40f36d(0x1b0)](_0x2c13d4)&&fs[_0x40f36d(0x1b5)](_0x2c13d4),dirs=[{'own':!![],'name':_0x40f36d(0x1b7),'path':_0x5c598d,'isFolder':!![],'children':_0x4bc3f2},...listFolderStructure(_0x2c13d4)],_0x51b5ba[_0x40f36d(0x1a6)](dirs);}else!fs['existsSync'](_0x2c13d4)&&fs['mkdirSync'](_0x2c13d4),_0x51b5ba[_0x40f36d(0x1a6)](listFolderStructure(_0x2c13d4));}),module[a15_0x142cbf(0x1b6)]=router;function a15_0x34da(){const _0x789fbd=['admin','role','existsSync','main','333KkSiHf','Invalid\x20user','join','mkdirSync','exports','MY\x20FOLDER','mtime','size','filename','utf8','1377295vEEanJ','parse','express','1070996crTvHn','18AzeaLb','Error!\x20Something\x20went\x20wrong.','statSync','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','695457qzBagc','get','folderLocationDemoUser','311080BJLWSw','../libs/mysql','verifyTokenOptional','resolve','log','length','115000TTabzc','1jBRMQT','folder_name','cvjs_debug','cvhs_debug:','promise','push','\x20\x20\x20','└──\x20','crypto','loginFeatureEnabled','json','user','status','children','├──\x20','readdirSync','execute','\x20show_folders:','755410ofYtmy','folderLocation','./uploads/','CADViewer_config.json','false','isDirectory','send','4883669LORfLw','319wXJBsc','readFileSync','email','birthtime','Router','path'];a15_0x34da=function(){return _0x789fbd;};return a15_0x34da();}