const a15_0x57e9b5=a15_0x4393;(function(_0x2bcf72,_0x4bb89f){const _0x200240=a15_0x4393,_0x1a2f8b=_0x2bcf72();while(!![]){try{const _0x2f7e44=-parseInt(_0x200240(0x12b))/0x1*(parseInt(_0x200240(0x114))/0x2)+parseInt(_0x200240(0x122))/0x3+parseInt(_0x200240(0x134))/0x4*(-parseInt(_0x200240(0x118))/0x5)+-parseInt(_0x200240(0x12d))/0x6+parseInt(_0x200240(0x124))/0x7*(parseInt(_0x200240(0x138))/0x8)+parseInt(_0x200240(0x14a))/0x9*(-parseInt(_0x200240(0x116))/0xa)+parseInt(_0x200240(0x12a))/0xb*(parseInt(_0x200240(0x115))/0xc);if(_0x2f7e44===_0x4bb89f)break;else _0x1a2f8b['push'](_0x1a2f8b['shift']());}catch(_0x597b34){_0x1a2f8b['push'](_0x1a2f8b['shift']());}}}(a15_0x1801,0x5f4fd));const fs=require('fs'),path=require('path'),config=require('../CADViewer_config.json'),verifyTokenOptional=require(a15_0x57e9b5(0x129))[a15_0x57e9b5(0x136)],show_folders=![],express=require(a15_0x57e9b5(0x143)),router=express['Router'](),conn=require(a15_0x57e9b5(0x12f)),{randomUUID}=require('crypto'),dir=a15_0x57e9b5(0x132);function a15_0x4393(_0x40da86,_0x269e4d){const _0x1801c8=a15_0x1801();return a15_0x4393=function(_0x43930d,_0x37c260){_0x43930d=_0x43930d-0x113;let _0x2619ec=_0x1801c8[_0x43930d];return _0x2619ec;},a15_0x4393(_0x40da86,_0x269e4d);}!fs[a15_0x57e9b5(0x14b)](dir)&&fs[a15_0x57e9b5(0x137)](dir);const sortFoldersFirst=(_0x401aca,_0xf227eb)=>{const _0xfac3b5=a15_0x57e9b5;if(_0x401aca[_0xfac3b5(0x145)]&&!_0xf227eb[_0xfac3b5(0x145)])return-0x1;else return!_0x401aca['children']&&_0xf227eb[_0xfac3b5(0x145)]?0x1:0x0;},listFolderStructure=(_0x21aee5,_0x4713aa='')=>{const _0xf16aa7=a15_0x57e9b5,_0x3b84d4=fs['readdirSync'](_0x21aee5),_0x354a11=[];return _0x3b84d4[_0xf16aa7(0x131)](_0x4c4434=>{const _0x208cb4=_0xf16aa7,_0x5bd989=path[_0x208cb4(0x119)](_0x21aee5,_0x4c4434),_0x9bf260=fs['statSync'](_0x5bd989);if(_0x9bf260['isDirectory']()){if(config[_0x208cb4(0x14f)]&&show_folders)console[_0x208cb4(0x11b)](_0x4713aa+'└──\x20'+_0x4c4434);const _0x2e789a=listFolderStructure(_0x5bd989,_0x4713aa+_0x208cb4(0x11f));_0x354a11[_0x208cb4(0x120)]({'name':_0x4c4434,'path':_0x5bd989,'size':_0x9bf260[_0x208cb4(0x142)],'created':_0x9bf260[_0x208cb4(0x13c)],'modified':_0x9bf260['mtime'],'isFolder':!![],'children':_0x2e789a});}else{_0x354a11[_0x208cb4(0x120)]({'name':_0x4c4434,'path':_0x5bd989,'size':_0x9bf260[_0x208cb4(0x142)],'created':_0x9bf260['birthtime'],'modified':_0x9bf260['mtime'],'isFolder':![]});if(config[_0x208cb4(0x14f)]&&show_folders)console[_0x208cb4(0x11b)](_0x4713aa+'├──\x20'+_0x4c4434);}}),_0x354a11[_0xf16aa7(0x12c)](sortFoldersFirst);};router[a15_0x57e9b5(0x147)]('',verifyTokenOptional,async(_0x14c93e,_0x27c6a0)=>{const _0x424b09=a15_0x57e9b5,_0x177cb4=path[_0x424b09(0x119)](path[_0x424b09(0x13b)](require[_0x424b09(0x148)][_0x424b09(0x117)]),_0x424b09(0x13a)),_0x24b9d2=JSON['parse'](fs[_0x424b09(0x149)](_0x177cb4,_0x424b09(0x14d))),_0x3feb36=_0x14c93e[_0x424b09(0x123)][_0x424b09(0x146)];let _0x4d281a=_0x24b9d2[_0x424b09(0x135)];_0x3feb36===_0x424b09(0x14e)&&(_0x4d281a=_0x24b9d2[_0x424b09(0x113)]);console[_0x424b09(0x11b)](_0x424b09(0x130)+_0x4d281a+'\x20show_folders:'+show_folders+'cvhs_debug:'+config[_0x424b09(0x14f)]);if(_0x14c93e['user']){let _0x15aab4;try{const [_0x1e0894]=await conn[_0x424b09(0x125)]()[_0x424b09(0x121)](_0x424b09(0x13e),[_0x14c93e[_0x424b09(0x127)]['email']]);_0x1e0894[_0x424b09(0x13d)]>0x0&&(_0x15aab4=_0x1e0894[0x0]);}catch(_0x21696e){console[_0x424b09(0x11b)]({'err':_0x21696e}),_0x27c6a0[_0x424b09(0x144)](0x1f4)[_0x424b09(0x139)]({'error':_0x424b09(0x141)});return;}if(!_0x15aab4){_0x27c6a0[_0x424b09(0x144)](0x191)['json']({'error':_0x424b09(0x140)});return;}_0x15aab4[_0x424b09(0x11a)]===_0x424b09(0x133)&&(_0x4d281a=_0x24b9d2['folderLocation']);let _0x5884ae=_0x15aab4[_0x424b09(0x11c)];if(!_0x5884ae){_0x5884ae=randomUUID();try{await conn[_0x424b09(0x125)]()[_0x424b09(0x121)](_0x424b09(0x13f),[_0x5884ae,_0x14c93e[_0x424b09(0x127)][_0x424b09(0x14c)]]);}catch(_0x3f1ba6){console[_0x424b09(0x11b)]({'err':_0x3f1ba6}),_0x27c6a0[_0x424b09(0x144)](0x1f4)[_0x424b09(0x139)]({'error':_0x424b09(0x141)});return;}}const _0x4a3fe2=_0x424b09(0x12e)+_0x5884ae;!fs[_0x424b09(0x14b)](_0x4a3fe2)&&fs[_0x424b09(0x137)](_0x4a3fe2);const _0x33015d=path[_0x424b09(0x126)](_0x4a3fe2),_0x1f7675=listFolderStructure(_0x33015d);!fs[_0x424b09(0x14b)](_0x4d281a)&&fs['mkdirSync'](_0x4d281a),dirs=[{'own':!![],'name':_0x424b09(0x11d),'path':_0x4a3fe2,'isFolder':!![],'children':_0x1f7675},...listFolderStructure(_0x4d281a)],_0x27c6a0[_0x424b09(0x128)](dirs);}else!fs[_0x424b09(0x14b)](_0x4d281a)&&fs['mkdirSync'](_0x4d281a),_0x27c6a0[_0x424b09(0x128)](listFolderStructure(_0x4d281a));}),module[a15_0x57e9b5(0x11e)]=router;function a15_0x1801(){const _0x1d575d=['Error!\x20Something\x20went\x20wrong.','size','express','status','children','loginFeatureEnabled','get','main','readFileSync','9rUfsae','existsSync','email','utf8','false','cvjs_debug','folderLocation','2kpUPlN','251832xCrZef','323630ZRaLOe','filename','205ZjRkNS','join','role','log','folder_name','MY\x20FOLDER','exports','\x20\x20\x20','push','execute','1592400RkiQIr','query','7VVMLya','promise','resolve','user','send','../libs/jwt','88GksqpM','119169jdYTKy','sort','2284614JgeulO','./uploads/','../libs/mysql','in\x20listFolderStructure\x20folderLocation=','forEach','./uploads','admin','44036SxbSkn','folderLocationDemoUser','verifyTokenOptional','mkdirSync','5403032QmwLGC','json','CADViewer_config.json','dirname','birthtime','length','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','Invalid\x20user'];a15_0x1801=function(){return _0x1d575d;};return a15_0x1801();}