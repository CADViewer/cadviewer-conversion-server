const a16_0x1868ef=a16_0x1be0;(function(_0x4df5cd,_0x57e0b3){const _0x8182=a16_0x1be0,_0x4db111=_0x4df5cd();while(!![]){try{const _0x5c073b=parseInt(_0x8182(0x1cb))/0x1+-parseInt(_0x8182(0x1f0))/0x2+parseInt(_0x8182(0x1cf))/0x3+parseInt(_0x8182(0x1cc))/0x4+-parseInt(_0x8182(0x1f3))/0x5*(-parseInt(_0x8182(0x1ca))/0x6)+-parseInt(_0x8182(0x1f9))/0x7+parseInt(_0x8182(0x1d5))/0x8*(-parseInt(_0x8182(0x1ec))/0x9);if(_0x5c073b===_0x57e0b3)break;else _0x4db111['push'](_0x4db111['shift']());}catch(_0x139749){_0x4db111['push'](_0x4db111['shift']());}}}(a16_0x2c73,0x34d59));const fs=require('fs'),path=require(a16_0x1868ef(0x1df)),config=require(a16_0x1868ef(0x1e7)),verifyTokenOptional=require('../libs/jwt')[a16_0x1868ef(0x1dd)],show_folders=![],express=require(a16_0x1868ef(0x1e9)),router=express[a16_0x1868ef(0x1c4)](),conn=require(a16_0x1868ef(0x1d2)),{randomUUID}=require(a16_0x1868ef(0x1fc)),dir=a16_0x1868ef(0x1db);function a16_0x1be0(_0x4bab7c,_0x4a0b8a){const _0x2c7311=a16_0x2c73();return a16_0x1be0=function(_0x1be09e,_0xc30da5){_0x1be09e=_0x1be09e-0x1c1;let _0x382f41=_0x2c7311[_0x1be09e];return _0x382f41;},a16_0x1be0(_0x4bab7c,_0x4a0b8a);}function a16_0x2c73(){const _0x56615f=['isDirectory','resolve','crypto','admin','folderLocation','statSync','Router','\x20\x20\x20','main','forEach','mtime','json','516ZywPfU','201706ugnXer','933528WwYMRj','\x20show_folders:','user','1141638lxPgdl','MY\x20FOLDER','sort','../libs/mysql','size','children','12424PAtkCK','push','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','email','false','log','./uploads','birthtime','verifyTokenOptional','utf8','path','parse','get','└──\x20','join','cvjs_debug','filename','send','../CADViewer_config.json','status','express','exports','./uploads/','4482iFUIeN','promise','folderLocationDemoUser','existsSync','109294VJLeaq','dirname','CADViewer_config.json','21940WkVUmm','readdirSync','loginFeatureEnabled','Error!\x20Something\x20went\x20wrong.','length','mkdirSync','1039864buuRPz'];a16_0x2c73=function(){return _0x56615f;};return a16_0x2c73();}!fs[a16_0x1868ef(0x1ef)](dir)&&fs['mkdirSync'](dir);const sortFoldersFirst=(_0x2c884e,_0x28c95f)=>{const _0x2895a7=a16_0x1868ef;if(_0x2c884e['children']&&!_0x28c95f[_0x2895a7(0x1d4)])return-0x1;else return!_0x2c884e[_0x2895a7(0x1d4)]&&_0x28c95f['children']?0x1:0x0;},listFolderStructure=(_0x2e3f2d,_0x51c499='')=>{const _0x121791=a16_0x1868ef,_0x55802e=fs[_0x121791(0x1f4)](_0x2e3f2d),_0x13ff62=[];return _0x55802e[_0x121791(0x1c7)](_0x50bd22=>{const _0x1c12bf=_0x121791,_0xcd2083=path[_0x1c12bf(0x1e3)](_0x2e3f2d,_0x50bd22),_0x4cd577=fs[_0x1c12bf(0x1c3)](_0xcd2083);if(_0x4cd577[_0x1c12bf(0x1fa)]()){if(config['cvjs_debug']&&show_folders)console['log'](_0x51c499+_0x1c12bf(0x1e2)+_0x50bd22);const _0x3c0a12=listFolderStructure(_0xcd2083,_0x51c499+_0x1c12bf(0x1c5));_0x13ff62[_0x1c12bf(0x1d6)]({'name':_0x50bd22,'path':_0xcd2083,'size':_0x4cd577[_0x1c12bf(0x1d3)],'created':_0x4cd577[_0x1c12bf(0x1dc)],'modified':_0x4cd577[_0x1c12bf(0x1c8)],'isFolder':!![],'children':_0x3c0a12});}else{_0x13ff62[_0x1c12bf(0x1d6)]({'name':_0x50bd22,'path':_0xcd2083,'size':_0x4cd577['size'],'created':_0x4cd577[_0x1c12bf(0x1dc)],'modified':_0x4cd577['mtime'],'isFolder':![]});if(config[_0x1c12bf(0x1e4)]&&show_folders)console[_0x1c12bf(0x1da)](_0x51c499+'├──\x20'+_0x50bd22);}}),_0x13ff62[_0x121791(0x1d1)](sortFoldersFirst);};router[a16_0x1868ef(0x1e1)]('',verifyTokenOptional,async(_0x1cbee0,_0x1f108d)=>{const _0x3343e1=a16_0x1868ef,_0x209f0d=path[_0x3343e1(0x1e3)](path[_0x3343e1(0x1f1)](require[_0x3343e1(0x1c6)][_0x3343e1(0x1e5)]),_0x3343e1(0x1f2)),_0x50a44c=JSON[_0x3343e1(0x1e0)](fs['readFileSync'](_0x209f0d,_0x3343e1(0x1de))),_0x3eff78=_0x1cbee0['query'][_0x3343e1(0x1f5)];let _0x5e1285=_0x50a44c[_0x3343e1(0x1ee)];_0x3eff78===_0x3343e1(0x1d9)&&(_0x5e1285=_0x50a44c['folderLocation']);console[_0x3343e1(0x1da)]('in\x20listFolderStructure\x20folderLocation='+_0x5e1285+_0x3343e1(0x1cd)+show_folders+'cvhs_debug:'+config[_0x3343e1(0x1e4)]);if(_0x1cbee0[_0x3343e1(0x1ce)]){let _0x4bf816;try{const [_0x43e3d7]=await conn['promise']()['execute'](_0x3343e1(0x1d7),[_0x1cbee0[_0x3343e1(0x1ce)][_0x3343e1(0x1d8)]]);_0x43e3d7[_0x3343e1(0x1f7)]>0x0&&(_0x4bf816=_0x43e3d7[0x0]);}catch(_0x217a26){console['log']({'err':_0x217a26}),_0x1f108d[_0x3343e1(0x1e8)](0x1f4)[_0x3343e1(0x1c9)]({'error':_0x3343e1(0x1f6)});return;}if(!_0x4bf816){_0x1f108d[_0x3343e1(0x1e8)](0x191)['json']({'error':'Invalid\x20user'});return;}_0x4bf816['role']===_0x3343e1(0x1c1)&&(_0x5e1285=_0x50a44c[_0x3343e1(0x1c2)]);let _0x470214=_0x4bf816['folder_name'];if(!_0x470214){_0x470214=randomUUID();try{await conn[_0x3343e1(0x1ed)]()['execute']('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x470214,_0x1cbee0[_0x3343e1(0x1ce)][_0x3343e1(0x1d8)]]);}catch(_0x52dbec){console[_0x3343e1(0x1da)]({'err':_0x52dbec}),_0x1f108d['status'](0x1f4)[_0x3343e1(0x1c9)]({'error':_0x3343e1(0x1f6)});return;}}const _0x46736e=_0x3343e1(0x1eb)+_0x470214;!fs[_0x3343e1(0x1ef)](_0x46736e)&&fs['mkdirSync'](_0x46736e);const _0x3e825c=path[_0x3343e1(0x1fb)](_0x46736e),_0x227cae=listFolderStructure(_0x3e825c);!fs[_0x3343e1(0x1ef)](_0x5e1285)&&fs[_0x3343e1(0x1f8)](_0x5e1285),dirs=[{'own':!![],'name':_0x3343e1(0x1d0),'path':_0x46736e,'isFolder':!![],'children':_0x227cae},...listFolderStructure(_0x5e1285)],_0x1f108d[_0x3343e1(0x1e6)](dirs);}else!fs[_0x3343e1(0x1ef)](_0x5e1285)&&fs['mkdirSync'](_0x5e1285),_0x1f108d[_0x3343e1(0x1e6)](listFolderStructure(_0x5e1285));}),module[a16_0x1868ef(0x1ea)]=router;