function a15_0x4418(){const _0x383318=['folderLocationDemoUser','false','express','9133870jSVhcG','folderLocation','4WHhTVg','promise','user','cvjs_debug','children','2394936fszZMc','7kEzOcR','567284gkLsTz','filename','11PeUdkk','mtime','email','loginFeatureEnabled','./uploads','join','845vezZpn','84054DcUsrB','40793376VfoJZZ','execute','../CADViewer_config.json','log','readFileSync','sort','length','birthtime','15882rvGEQJ','readdirSync','main','├──\x20','\x20show_folders:','3221408qqBzvP','statSync','in\x20listFolderStructure\x20folderLocation=','folder_name','admin','mkdirSync','status','size','dirname','Error!\x20Something\x20went\x20wrong.','resolve','isDirectory','utf8','Router','send','crypto','60sMWnOc','../libs/mysql','json','\x20\x20\x20','existsSync'];a15_0x4418=function(){return _0x383318;};return a15_0x4418();}const a15_0x85f862=a15_0x1c13;(function(_0x5f36a8,_0x46ccc7){const _0x1b9686=a15_0x1c13,_0x446357=_0x5f36a8();while(!![]){try{const _0x4983c4=parseInt(_0x1b9686(0x9f))/0x1*(-parseInt(_0x1b9686(0x98))/0x2)+-parseInt(_0x1b9686(0x70))/0x3*(parseInt(_0x1b9686(0x8e))/0x4)+-parseInt(_0x1b9686(0x6f))/0x5*(parseInt(_0x1b9686(0x79))/0x6)+-parseInt(_0x1b9686(0x9e))/0x7*(-parseInt(_0x1b9686(0x7e))/0x8)+-parseInt(_0x1b9686(0x9d))/0x9+-parseInt(_0x1b9686(0x96))/0xa+-parseInt(_0x1b9686(0xa1))/0xb*(-parseInt(_0x1b9686(0x71))/0xc);if(_0x4983c4===_0x46ccc7)break;else _0x446357['push'](_0x446357['shift']());}catch(_0x4c8fde){_0x446357['push'](_0x446357['shift']());}}}(a15_0x4418,0x977a4));const fs=require('fs'),path=require('path'),config=require(a15_0x85f862(0x73)),verifyTokenOptional=require('../libs/jwt')['verifyTokenOptional'],show_folders=![],express=require(a15_0x85f862(0x95)),router=express[a15_0x85f862(0x8b)](),conn=require(a15_0x85f862(0x8f)),{randomUUID}=require(a15_0x85f862(0x8d)),dir=a15_0x85f862(0x6d);!fs[a15_0x85f862(0x92)](dir)&&fs[a15_0x85f862(0x83)](dir);const sortFoldersFirst=(_0x2268a0,_0x5c950f)=>{const _0x6d77c4=a15_0x85f862;if(_0x2268a0[_0x6d77c4(0x9c)]&&!_0x5c950f[_0x6d77c4(0x9c)])return-0x1;else return!_0x2268a0[_0x6d77c4(0x9c)]&&_0x5c950f[_0x6d77c4(0x9c)]?0x1:0x0;},listFolderStructure=(_0x3a38a9,_0x2075ce='')=>{const _0x63f432=a15_0x85f862,_0x5d5562=fs[_0x63f432(0x7a)](_0x3a38a9),_0x3e3b5a=[];return _0x5d5562['forEach'](_0xb15809=>{const _0x71b9f1=_0x63f432,_0xcbe033=path[_0x71b9f1(0x6e)](_0x3a38a9,_0xb15809),_0x43ae7d=fs[_0x71b9f1(0x7f)](_0xcbe033);if(_0x43ae7d[_0x71b9f1(0x89)]()){if(config[_0x71b9f1(0x9b)]&&show_folders)console[_0x71b9f1(0x74)](_0x2075ce+'└──\x20'+_0xb15809);const _0x443004=listFolderStructure(_0xcbe033,_0x2075ce+_0x71b9f1(0x91));_0x3e3b5a['push']({'name':_0xb15809,'path':_0xcbe033,'size':_0x43ae7d[_0x71b9f1(0x85)],'created':_0x43ae7d[_0x71b9f1(0x78)],'modified':_0x43ae7d[_0x71b9f1(0xa2)],'isFolder':!![],'children':_0x443004});}else{_0x3e3b5a['push']({'name':_0xb15809,'path':_0xcbe033,'size':_0x43ae7d[_0x71b9f1(0x85)],'created':_0x43ae7d[_0x71b9f1(0x78)],'modified':_0x43ae7d[_0x71b9f1(0xa2)],'isFolder':![]});if(config[_0x71b9f1(0x9b)]&&show_folders)console['log'](_0x2075ce+_0x71b9f1(0x7c)+_0xb15809);}}),_0x3e3b5a[_0x63f432(0x76)](sortFoldersFirst);};function a15_0x1c13(_0x4f4fb5,_0x46ee82){const _0x4418b7=a15_0x4418();return a15_0x1c13=function(_0x1c13f9,_0x5593b1){_0x1c13f9=_0x1c13f9-0x6c;let _0x7c5c8b=_0x4418b7[_0x1c13f9];return _0x7c5c8b;},a15_0x1c13(_0x4f4fb5,_0x46ee82);}router['get']('',verifyTokenOptional,async(_0x57335b,_0x2a86b8)=>{const _0x14d9b9=a15_0x85f862,_0xdd62fd=path[_0x14d9b9(0x6e)](path[_0x14d9b9(0x86)](require[_0x14d9b9(0x7b)][_0x14d9b9(0xa0)]),'CADViewer_config.json'),_0xbd6434=JSON['parse'](fs[_0x14d9b9(0x75)](_0xdd62fd,_0x14d9b9(0x8a))),_0x6fb4fa=_0x57335b['query'][_0x14d9b9(0x6c)];let _0x3ab208=_0xbd6434[_0x14d9b9(0x93)];_0x6fb4fa===_0x14d9b9(0x94)&&(_0x3ab208=_0xbd6434[_0x14d9b9(0x97)]);console[_0x14d9b9(0x74)](_0x14d9b9(0x80)+_0x3ab208+_0x14d9b9(0x7d)+show_folders+'cvhs_debug:'+config[_0x14d9b9(0x9b)]);if(_0x57335b[_0x14d9b9(0x9a)]){let _0x325025;try{const [_0x53a89c]=await conn[_0x14d9b9(0x99)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x57335b[_0x14d9b9(0x9a)][_0x14d9b9(0xa3)]]);_0x53a89c[_0x14d9b9(0x77)]>0x0&&(_0x325025=_0x53a89c[0x0]);}catch(_0x323d72){console[_0x14d9b9(0x74)]({'err':_0x323d72}),_0x2a86b8['status'](0x1f4)['json']({'error':_0x14d9b9(0x87)});return;}if(!_0x325025){_0x2a86b8[_0x14d9b9(0x84)](0x191)[_0x14d9b9(0x90)]({'error':'Invalid\x20user'});return;}_0x325025['role']===_0x14d9b9(0x82)&&(_0x3ab208=_0xbd6434[_0x14d9b9(0x97)]);let _0x3b35c0=_0x325025[_0x14d9b9(0x81)];if(!_0x3b35c0){_0x3b35c0=randomUUID();try{await conn['promise']()[_0x14d9b9(0x72)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x3b35c0,_0x57335b[_0x14d9b9(0x9a)]['email']]);}catch(_0x1e8466){console[_0x14d9b9(0x74)]({'err':_0x1e8466}),_0x2a86b8[_0x14d9b9(0x84)](0x1f4)[_0x14d9b9(0x90)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x3ba02d='./uploads/'+_0x3b35c0;!fs[_0x14d9b9(0x92)](_0x3ba02d)&&fs['mkdirSync'](_0x3ba02d);const _0x35f952=path[_0x14d9b9(0x88)](_0x3ba02d),_0x3a95fb=listFolderStructure(_0x35f952);!fs[_0x14d9b9(0x92)](_0x3ab208)&&fs[_0x14d9b9(0x83)](_0x3ab208),dirs=[{'own':!![],'name':'MY\x20FOLDER','path':_0x3ba02d,'isFolder':!![],'children':_0x3a95fb},...listFolderStructure(_0x3ab208)],_0x2a86b8[_0x14d9b9(0x8c)](dirs);}else!fs[_0x14d9b9(0x92)](_0x3ab208)&&fs[_0x14d9b9(0x83)](_0x3ab208),_0x2a86b8[_0x14d9b9(0x8c)](listFolderStructure(_0x3ab208));}),module['exports']=router;