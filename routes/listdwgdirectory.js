const a15_0x155d44=a15_0x6d33;(function(_0x4bb6c3,_0x42e08f){const _0x41b913=a15_0x6d33,_0x22f950=_0x4bb6c3();while(!![]){try{const _0x5f2397=-parseInt(_0x41b913(0x161))/0x1*(parseInt(_0x41b913(0x182))/0x2)+-parseInt(_0x41b913(0x17c))/0x3+parseInt(_0x41b913(0x15f))/0x4+-parseInt(_0x41b913(0x172))/0x5+-parseInt(_0x41b913(0x15c))/0x6*(-parseInt(_0x41b913(0x168))/0x7)+parseInt(_0x41b913(0x16f))/0x8+-parseInt(_0x41b913(0x170))/0x9;if(_0x5f2397===_0x42e08f)break;else _0x22f950['push'](_0x22f950['shift']());}catch(_0x26ff51){_0x22f950['push'](_0x22f950['shift']());}}}(a15_0xd331,0x4f9e6));const fs=require('fs'),path=require(a15_0x155d44(0x166)),config=require(a15_0x155d44(0x174)),verifyTokenOptional=require('../libs/jwt')[a15_0x155d44(0x179)],show_folders=![],express=require(a15_0x155d44(0x155)),router=express['Router'](),conn=require('../libs/mysql'),{randomUUID}=require(a15_0x155d44(0x165)),dir='./uploads';!fs[a15_0x155d44(0x154)](dir)&&fs[a15_0x155d44(0x14c)](dir);function a15_0x6d33(_0x20cadd,_0x5c19e7){const _0xd33125=a15_0xd331();return a15_0x6d33=function(_0x6d3389,_0x267092){_0x6d3389=_0x6d3389-0x14a;let _0x18ffd8=_0xd33125[_0x6d3389];return _0x18ffd8;},a15_0x6d33(_0x20cadd,_0x5c19e7);}const sortFoldersFirst=(_0x4ffedc,_0x3c93f3)=>{const _0x34bb74=a15_0x155d44;if(_0x4ffedc[_0x34bb74(0x17e)]&&!_0x3c93f3[_0x34bb74(0x17e)])return-0x1;else return!_0x4ffedc['children']&&_0x3c93f3['children']?0x1:0x0;},listFolderStructure=(_0x2d03a3,_0x7738a6='')=>{const _0x2589b1=a15_0x155d44,_0x349efe=fs['readdirSync'](_0x2d03a3),_0x2c0145=[];return _0x349efe[_0x2589b1(0x14f)](_0x272137=>{const _0x120ad8=_0x2589b1,_0x22878d=path[_0x120ad8(0x17f)](_0x2d03a3,_0x272137),_0x153ff7=fs[_0x120ad8(0x171)](_0x22878d);if(_0x153ff7[_0x120ad8(0x180)]()){if(config[_0x120ad8(0x16d)]&&show_folders)console['log'](_0x7738a6+_0x120ad8(0x160)+_0x272137);const _0x47b130=listFolderStructure(_0x22878d,_0x7738a6+'\x20\x20\x20');_0x2c0145[_0x120ad8(0x158)]({'name':_0x272137,'path':_0x22878d,'size':_0x153ff7[_0x120ad8(0x181)],'created':_0x153ff7['birthtime'],'modified':_0x153ff7[_0x120ad8(0x163)],'isFolder':!![],'children':_0x47b130});}else{_0x2c0145[_0x120ad8(0x158)]({'name':_0x272137,'path':_0x22878d,'size':_0x153ff7[_0x120ad8(0x181)],'created':_0x153ff7[_0x120ad8(0x14b)],'modified':_0x153ff7[_0x120ad8(0x163)],'isFolder':![]});if(config[_0x120ad8(0x16d)]&&show_folders)console[_0x120ad8(0x150)](_0x7738a6+_0x120ad8(0x151)+_0x272137);}}),_0x2c0145[_0x2589b1(0x15e)](sortFoldersFirst);};function a15_0xd331(){const _0x4d372c=['MY\x20FOLDER','main','existsSync','express','json','user','push','folder_name','cvhs_debug:','status','33162qJTXEK','./uploads/','sort','1066568vfQzJr','└──\x20','1lwGuWG','admin','mtime','\x20show_folders:','crypto','path','in\x20listFolderStructure\x20folderLocation=','707eJZFwo','promise','folderLocation','parse','send','cvjs_debug','execute','2663864EDEmGv','878058FyOSmA','statSync','371840uHcGqc','Error!\x20Something\x20went\x20wrong.','../CADViewer_config.json','loginFeatureEnabled','readFileSync','false','get','verifyTokenOptional','query','utf8','1159068cPTanS','dirname','children','join','isDirectory','size','546896JzKgzX','email','folderLocationDemoUser','resolve','birthtime','mkdirSync','exports','CADViewer_config.json','forEach','log','├──\x20'];a15_0xd331=function(){return _0x4d372c;};return a15_0xd331();}router[a15_0x155d44(0x178)]('',verifyTokenOptional,async(_0xcd4346,_0x36a258)=>{const _0x2a79a5=a15_0x155d44,_0x59cb16=path[_0x2a79a5(0x17f)](path[_0x2a79a5(0x17d)](require[_0x2a79a5(0x153)]['filename']),_0x2a79a5(0x14e)),_0x43d36f=JSON[_0x2a79a5(0x16b)](fs[_0x2a79a5(0x176)](_0x59cb16,_0x2a79a5(0x17b))),_0x5b9f57=_0xcd4346[_0x2a79a5(0x17a)][_0x2a79a5(0x175)];let _0x5f5547=_0x43d36f[_0x2a79a5(0x184)];_0x5b9f57===_0x2a79a5(0x177)&&(_0x5f5547=_0x43d36f[_0x2a79a5(0x16a)]);console[_0x2a79a5(0x150)](_0x2a79a5(0x167)+_0x5f5547+_0x2a79a5(0x164)+show_folders+_0x2a79a5(0x15a)+config[_0x2a79a5(0x16d)]);if(_0xcd4346[_0x2a79a5(0x157)]){let _0x3fd2b0;try{const [_0x15af54]=await conn[_0x2a79a5(0x169)]()[_0x2a79a5(0x16e)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0xcd4346['user'][_0x2a79a5(0x183)]]);_0x15af54['length']>0x0&&(_0x3fd2b0=_0x15af54[0x0]);}catch(_0xe6dcd7){console[_0x2a79a5(0x150)]({'err':_0xe6dcd7}),_0x36a258[_0x2a79a5(0x15b)](0x1f4)[_0x2a79a5(0x156)]({'error':_0x2a79a5(0x173)});return;}if(!_0x3fd2b0){_0x36a258[_0x2a79a5(0x15b)](0x191)[_0x2a79a5(0x156)]({'error':'Invalid\x20user'});return;}_0x3fd2b0['role']===_0x2a79a5(0x162)&&(_0x5f5547=_0x43d36f[_0x2a79a5(0x16a)]);let _0x9665a6=_0x3fd2b0[_0x2a79a5(0x159)];if(!_0x9665a6){_0x9665a6=randomUUID();try{await conn[_0x2a79a5(0x169)]()['execute']('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x9665a6,_0xcd4346[_0x2a79a5(0x157)][_0x2a79a5(0x183)]]);}catch(_0x22b7c7){console[_0x2a79a5(0x150)]({'err':_0x22b7c7}),_0x36a258[_0x2a79a5(0x15b)](0x1f4)[_0x2a79a5(0x156)]({'error':_0x2a79a5(0x173)});return;}}const _0x38f771=_0x2a79a5(0x15d)+_0x9665a6;!fs[_0x2a79a5(0x154)](_0x38f771)&&fs['mkdirSync'](_0x38f771);const _0x5bb6ad=path[_0x2a79a5(0x14a)](_0x38f771),_0x4ec5c8=listFolderStructure(_0x5bb6ad);!fs[_0x2a79a5(0x154)](_0x5f5547)&&fs[_0x2a79a5(0x14c)](_0x5f5547),dirs=[{'own':!![],'name':_0x2a79a5(0x152),'path':_0x38f771,'isFolder':!![],'children':_0x4ec5c8},...listFolderStructure(_0x5f5547)],_0x36a258[_0x2a79a5(0x16c)](dirs);}else!fs[_0x2a79a5(0x154)](_0x5f5547)&&fs[_0x2a79a5(0x14c)](_0x5f5547),_0x36a258[_0x2a79a5(0x16c)](listFolderStructure(_0x5f5547));}),module[a15_0x155d44(0x14d)]=router;