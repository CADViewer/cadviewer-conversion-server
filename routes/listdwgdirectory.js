const a15_0x4e1f7d=a15_0x2cdf;(function(_0x1c67cf,_0x3b33b1){const _0x284724=a15_0x2cdf,_0x16b148=_0x1c67cf();while(!![]){try{const _0x191208=parseInt(_0x284724(0x210))/0x1+parseInt(_0x284724(0x208))/0x2+-parseInt(_0x284724(0x1fb))/0x3+parseInt(_0x284724(0x20e))/0x4+-parseInt(_0x284724(0x1ee))/0x5+parseInt(_0x284724(0x1ed))/0x6+parseInt(_0x284724(0x20c))/0x7*(parseInt(_0x284724(0x1e1))/0x8);if(_0x191208===_0x3b33b1)break;else _0x16b148['push'](_0x16b148['shift']());}catch(_0x1d8c62){_0x16b148['push'](_0x16b148['shift']());}}}(a15_0x4f25,0xe358c));const fs=require('fs'),path=require(a15_0x4e1f7d(0x1e6)),config=require(a15_0x4e1f7d(0x1e4)),verifyTokenOptional=require('../libs/jwt')['verifyTokenOptional'],show_folders=![],express=require(a15_0x4e1f7d(0x1ff)),router=express[a15_0x4e1f7d(0x20d)](),conn=require(a15_0x4e1f7d(0x1fc)),{randomUUID}=require('crypto'),dir='./uploads';!fs[a15_0x4e1f7d(0x207)](dir)&&fs['mkdirSync'](dir);function a15_0x4f25(){const _0x2542ef=['query','status','existsSync','258144XpnnxC','Invalid\x20user','CADViewer_config.json','main','1799GQTEcp','Router','5067504GcCdoQ','in\x20listFolderStructure\x20folderLocation=','152850VNuWwA','birthtime','isDirectory','loginFeatureEnabled','exports','readFileSync','Error!\x20Something\x20went\x20wrong.','├──\x20','mkdirSync','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','6832qiKWPg','email','execute','../CADViewer_config.json','user','path','cvjs_debug','get','folderLocationDemoUser','length','dirname','mtime','4197792FEBhsV','7220760ajmRYF','children','json','push','folderLocation','false','promise','role','folder_name','forEach','MY\x20FOLDER','sort','utf8','277632kKgftb','../libs/mysql','send','./uploads/','express','size','\x20\x20\x20','log','\x20show_folders:','└──\x20'];a15_0x4f25=function(){return _0x2542ef;};return a15_0x4f25();}const sortFoldersFirst=(_0x4acfb1,_0x43ed62)=>{const _0x31c4ca=a15_0x4e1f7d;if(_0x4acfb1[_0x31c4ca(0x1ef)]&&!_0x43ed62[_0x31c4ca(0x1ef)])return-0x1;else return!_0x4acfb1[_0x31c4ca(0x1ef)]&&_0x43ed62[_0x31c4ca(0x1ef)]?0x1:0x0;},listFolderStructure=(_0x1974fd,_0x4485a9='')=>{const _0x583b58=a15_0x4e1f7d,_0x1e96f7=fs['readdirSync'](_0x1974fd),_0x2d0135=[];return _0x1e96f7[_0x583b58(0x1f7)](_0x2c724b=>{const _0x251380=_0x583b58,_0x9c6266=path['join'](_0x1974fd,_0x2c724b),_0xa3affe=fs['statSync'](_0x9c6266);if(_0xa3affe[_0x251380(0x212)]()){if(config[_0x251380(0x1e7)]&&show_folders)console[_0x251380(0x202)](_0x4485a9+_0x251380(0x204)+_0x2c724b);const _0x10d363=listFolderStructure(_0x9c6266,_0x4485a9+_0x251380(0x201));_0x2d0135[_0x251380(0x1f1)]({'name':_0x2c724b,'path':_0x9c6266,'size':_0xa3affe[_0x251380(0x200)],'created':_0xa3affe['birthtime'],'modified':_0xa3affe['mtime'],'isFolder':!![],'children':_0x10d363});}else{_0x2d0135[_0x251380(0x1f1)]({'name':_0x2c724b,'path':_0x9c6266,'size':_0xa3affe[_0x251380(0x200)],'created':_0xa3affe[_0x251380(0x211)],'modified':_0xa3affe[_0x251380(0x1ec)],'isFolder':![]});if(config['cvjs_debug']&&show_folders)console['log'](_0x4485a9+_0x251380(0x1de)+_0x2c724b);}}),_0x2d0135[_0x583b58(0x1f9)](sortFoldersFirst);};function a15_0x2cdf(_0x18b077,_0x119518){const _0x4f2577=a15_0x4f25();return a15_0x2cdf=function(_0x2cdff9,_0x2d13eb){_0x2cdff9=_0x2cdff9-0x1db;let _0x35c92a=_0x4f2577[_0x2cdff9];return _0x35c92a;},a15_0x2cdf(_0x18b077,_0x119518);}router[a15_0x4e1f7d(0x1e8)]('',verifyTokenOptional,async(_0x2b17be,_0x421e79)=>{const _0x1409ea=a15_0x4e1f7d,_0xeb3084=path['join'](path[_0x1409ea(0x1eb)](require[_0x1409ea(0x20b)]['filename']),_0x1409ea(0x20a)),_0x1cc2b8=JSON['parse'](fs[_0x1409ea(0x1dc)](_0xeb3084,_0x1409ea(0x1fa))),_0x4b941a=_0x2b17be[_0x1409ea(0x205)][_0x1409ea(0x213)];let _0xd5012f=_0x1cc2b8[_0x1409ea(0x1e9)];_0x4b941a===_0x1409ea(0x1f3)&&(_0xd5012f=_0x1cc2b8[_0x1409ea(0x1f2)]);console[_0x1409ea(0x202)](_0x1409ea(0x20f)+_0xd5012f+_0x1409ea(0x203)+show_folders+'cvhs_debug:'+config[_0x1409ea(0x1e7)]);if(_0x2b17be[_0x1409ea(0x1e5)]){let _0x21f566;try{const [_0x2742dd]=await conn[_0x1409ea(0x1f4)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x2b17be['user'][_0x1409ea(0x1e2)]]);_0x2742dd[_0x1409ea(0x1ea)]>0x0&&(_0x21f566=_0x2742dd[0x0]);}catch(_0x44f7b4){console[_0x1409ea(0x202)]({'err':_0x44f7b4}),_0x421e79[_0x1409ea(0x206)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x21f566){_0x421e79[_0x1409ea(0x206)](0x191)[_0x1409ea(0x1f0)]({'error':_0x1409ea(0x209)});return;}_0x21f566[_0x1409ea(0x1f5)]==='admin'&&(_0xd5012f=_0x1cc2b8[_0x1409ea(0x1f2)]);let _0x157c80=_0x21f566[_0x1409ea(0x1f6)];if(!_0x157c80){_0x157c80=randomUUID();try{await conn[_0x1409ea(0x1f4)]()[_0x1409ea(0x1e3)](_0x1409ea(0x1e0),[_0x157c80,_0x2b17be[_0x1409ea(0x1e5)][_0x1409ea(0x1e2)]]);}catch(_0x909788){console[_0x1409ea(0x202)]({'err':_0x909788}),_0x421e79['status'](0x1f4)['json']({'error':_0x1409ea(0x1dd)});return;}}const _0x253b01=_0x1409ea(0x1fe)+_0x157c80;!fs['existsSync'](_0x253b01)&&fs['mkdirSync'](_0x253b01);const _0x3f4053=path['resolve'](_0x253b01),_0x27bd89=listFolderStructure(_0x3f4053);!fs[_0x1409ea(0x207)](_0xd5012f)&&fs[_0x1409ea(0x1df)](_0xd5012f),dirs=[{'own':!![],'name':_0x1409ea(0x1f8),'path':_0x253b01,'isFolder':!![],'children':_0x27bd89},...listFolderStructure(_0xd5012f)],_0x421e79[_0x1409ea(0x1fd)](dirs);}else!fs['existsSync'](_0xd5012f)&&fs[_0x1409ea(0x1df)](_0xd5012f),_0x421e79[_0x1409ea(0x1fd)](listFolderStructure(_0xd5012f));}),module[a15_0x4e1f7d(0x1db)]=router;