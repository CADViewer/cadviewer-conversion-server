const a15_0x1b4de3=a15_0x4a9c;function a15_0x23b8(){const _0x18a3e4=['147380ryUMxd','MY\x20FOLDER','Invalid\x20user','8wQRLlq','./uploads/','3271532ziKrUr','join','2314430ebQFCR','log','\x20show_folders:','children','4sWjGzD','113006aIaJeP','statSync','birthtime','├──\x20','status','crypto','folderLocationDemoUser','email','path','3195486mcmDAS','size','Router','949881owJfai','cvjs_debug','execute','exports','filename','promise','main','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','Error!\x20Something\x20went\x20wrong.','get','false','push','query','mtime','existsSync','verifyTokenOptional','dirname','json','in\x20listFolderStructure\x20folderLocation=','906493VFnLbg','../CADViewer_config.json','parse','folderLocation','express','utf8','mkdirSync','../libs/jwt','11qnaQnh','sort','36sKXvkx','user','isDirectory','send','\x20\x20\x20','CADViewer_config.json'];a15_0x23b8=function(){return _0x18a3e4;};return a15_0x23b8();}(function(_0x5ab83f,_0x5ca2d8){const _0x3bbc92=a15_0x4a9c,_0xfd6671=_0x5ab83f();while(!![]){try{const _0x31b309=parseInt(_0x3bbc92(0x7a))/0x1*(parseInt(_0x3bbc92(0x8e))/0x2)+parseInt(_0x3bbc92(0x9a))/0x3*(-parseInt(_0x3bbc92(0x8d))/0x4)+parseInt(_0x3bbc92(0x89))/0x5+-parseInt(_0x3bbc92(0x97))/0x6+parseInt(_0x3bbc92(0xad))/0x7*(-parseInt(_0x3bbc92(0x85))/0x8)+parseInt(_0x3bbc92(0x7c))/0x9*(parseInt(_0x3bbc92(0x82))/0xa)+parseInt(_0x3bbc92(0x87))/0xb;if(_0x31b309===_0x5ca2d8)break;else _0xfd6671['push'](_0xfd6671['shift']());}catch(_0x39ae0a){_0xfd6671['push'](_0xfd6671['shift']());}}}(a15_0x23b8,0x70cfc));function a15_0x4a9c(_0xb3144a,_0x111001){const _0x23b87f=a15_0x23b8();return a15_0x4a9c=function(_0x4a9c6b,_0x5173f9){_0x4a9c6b=_0x4a9c6b-0x77;let _0x1af918=_0x23b87f[_0x4a9c6b];return _0x1af918;},a15_0x4a9c(_0xb3144a,_0x111001);}const fs=require('fs'),path=require(a15_0x1b4de3(0x96)),config=require(a15_0x1b4de3(0xae)),verifyTokenOptional=require(a15_0x1b4de3(0x79))[a15_0x1b4de3(0xa9)],show_folders=![],express=require(a15_0x1b4de3(0xb1)),router=express[a15_0x1b4de3(0x99)](),conn=require('../libs/mysql'),{randomUUID}=require(a15_0x1b4de3(0x93)),dir='./uploads';!fs[a15_0x1b4de3(0xa8)](dir)&&fs[a15_0x1b4de3(0x78)](dir);const sortFoldersFirst=(_0x5b9b3f,_0xf904eb)=>{const _0x3a8105=a15_0x1b4de3;if(_0x5b9b3f[_0x3a8105(0x8c)]&&!_0xf904eb[_0x3a8105(0x8c)])return-0x1;else return!_0x5b9b3f[_0x3a8105(0x8c)]&&_0xf904eb[_0x3a8105(0x8c)]?0x1:0x0;},listFolderStructure=(_0x1d5541,_0x1a934c='')=>{const _0x2a4bad=a15_0x1b4de3,_0xc60340=fs['readdirSync'](_0x1d5541),_0x1d494b=[];return _0xc60340['forEach'](_0x53ac35=>{const _0x3813da=a15_0x4a9c,_0x52f461=path[_0x3813da(0x88)](_0x1d5541,_0x53ac35),_0x407cd6=fs[_0x3813da(0x8f)](_0x52f461);if(_0x407cd6[_0x3813da(0x7e)]()){if(config['cvjs_debug']&&show_folders)console[_0x3813da(0x8a)](_0x1a934c+'└──\x20'+_0x53ac35);const _0x424dee=listFolderStructure(_0x52f461,_0x1a934c+_0x3813da(0x80));_0x1d494b[_0x3813da(0xa5)]({'name':_0x53ac35,'path':_0x52f461,'size':_0x407cd6[_0x3813da(0x98)],'created':_0x407cd6[_0x3813da(0x90)],'modified':_0x407cd6[_0x3813da(0xa7)],'isFolder':!![],'children':_0x424dee});}else{_0x1d494b[_0x3813da(0xa5)]({'name':_0x53ac35,'path':_0x52f461,'size':_0x407cd6[_0x3813da(0x98)],'created':_0x407cd6[_0x3813da(0x90)],'modified':_0x407cd6[_0x3813da(0xa7)],'isFolder':![]});if(config[_0x3813da(0x9b)]&&show_folders)console['log'](_0x1a934c+_0x3813da(0x91)+_0x53ac35);}}),_0x1d494b[_0x2a4bad(0x7b)](sortFoldersFirst);};router[a15_0x1b4de3(0xa3)]('',verifyTokenOptional,async(_0x425785,_0x50178c)=>{const _0x5aefd9=a15_0x1b4de3,_0x188ce7=path[_0x5aefd9(0x88)](path[_0x5aefd9(0xaa)](require[_0x5aefd9(0xa0)][_0x5aefd9(0x9e)]),_0x5aefd9(0x81)),_0x5f2a2e=JSON[_0x5aefd9(0xaf)](fs['readFileSync'](_0x188ce7,_0x5aefd9(0x77))),_0x4b9c94=_0x425785[_0x5aefd9(0xa6)]['loginFeatureEnabled'];let _0x104625=_0x5f2a2e[_0x5aefd9(0x94)];_0x4b9c94===_0x5aefd9(0xa4)&&(_0x104625=_0x5f2a2e[_0x5aefd9(0xb0)]);console[_0x5aefd9(0x8a)](_0x5aefd9(0xac)+_0x104625+_0x5aefd9(0x8b)+show_folders+'cvhs_debug:'+config['cvjs_debug']);if(_0x425785[_0x5aefd9(0x7d)]){let _0x32c691;try{const [_0xe5003e]=await conn[_0x5aefd9(0x9f)]()[_0x5aefd9(0x9c)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x425785[_0x5aefd9(0x7d)][_0x5aefd9(0x95)]]);_0xe5003e['length']>0x0&&(_0x32c691=_0xe5003e[0x0]);}catch(_0x2ee381){console[_0x5aefd9(0x8a)]({'err':_0x2ee381}),_0x50178c[_0x5aefd9(0x92)](0x1f4)['json']({'error':_0x5aefd9(0xa2)});return;}if(!_0x32c691){_0x50178c[_0x5aefd9(0x92)](0x191)[_0x5aefd9(0xab)]({'error':_0x5aefd9(0x84)});return;}_0x32c691['role']==='admin'&&(_0x104625=_0x5f2a2e['folderLocation']);let _0x300b7d=_0x32c691['folder_name'];if(!_0x300b7d){_0x300b7d=randomUUID();try{await conn[_0x5aefd9(0x9f)]()[_0x5aefd9(0x9c)](_0x5aefd9(0xa1),[_0x300b7d,_0x425785[_0x5aefd9(0x7d)][_0x5aefd9(0x95)]]);}catch(_0x27d6f8){console[_0x5aefd9(0x8a)]({'err':_0x27d6f8}),_0x50178c[_0x5aefd9(0x92)](0x1f4)['json']({'error':_0x5aefd9(0xa2)});return;}}const _0x24c16f=_0x5aefd9(0x86)+_0x300b7d;!fs[_0x5aefd9(0xa8)](_0x24c16f)&&fs[_0x5aefd9(0x78)](_0x24c16f);const _0x22d31c=path['resolve'](_0x24c16f),_0x485f3c=listFolderStructure(_0x22d31c);!fs[_0x5aefd9(0xa8)](_0x104625)&&fs[_0x5aefd9(0x78)](_0x104625),dirs=[{'own':!![],'name':_0x5aefd9(0x83),'path':_0x24c16f,'isFolder':!![],'children':_0x485f3c},...listFolderStructure(_0x104625)],_0x50178c[_0x5aefd9(0x7f)](dirs);}else!fs[_0x5aefd9(0xa8)](_0x104625)&&fs['mkdirSync'](_0x104625),_0x50178c[_0x5aefd9(0x7f)](listFolderStructure(_0x104625));}),module[a15_0x1b4de3(0x9d)]=router;