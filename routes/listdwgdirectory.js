const a15_0x3b4474=a15_0x16aa;(function(_0x288038,_0x42177e){const _0x2e3d91=a15_0x16aa,_0x2d9a14=_0x288038();while(!![]){try{const _0x18bd69=parseInt(_0x2e3d91(0x107))/0x1+-parseInt(_0x2e3d91(0x101))/0x2*(parseInt(_0x2e3d91(0xf0))/0x3)+-parseInt(_0x2e3d91(0xe8))/0x4+-parseInt(_0x2e3d91(0xe5))/0x5+-parseInt(_0x2e3d91(0x10f))/0x6+parseInt(_0x2e3d91(0xfa))/0x7+parseInt(_0x2e3d91(0x105))/0x8;if(_0x18bd69===_0x42177e)break;else _0x2d9a14['push'](_0x2d9a14['shift']());}catch(_0x18876e){_0x2d9a14['push'](_0x2d9a14['shift']());}}}(a15_0x565d,0xe520e));const fs=require('fs'),path=require(a15_0x3b4474(0xe2)),config=require(a15_0x3b4474(0x118)),verifyTokenOptional=require('../libs/jwt')[a15_0x3b4474(0xfe)],show_folders=![],express=require('express'),router=express[a15_0x3b4474(0x10e)](),conn=require(a15_0x3b4474(0xf3)),{randomUUID}=require(a15_0x3b4474(0x114)),dir=a15_0x3b4474(0x108);function a15_0x16aa(_0x32aee7,_0x46e348){const _0x565d18=a15_0x565d();return a15_0x16aa=function(_0x16aae2,_0x5b94ae){_0x16aae2=_0x16aae2-0xe1;let _0x6d7674=_0x565d18[_0x16aae2];return _0x6d7674;},a15_0x16aa(_0x32aee7,_0x46e348);}function a15_0x565d(){const _0x3b54c5=['3147270XAagyA','size','birthtime','670780ncCRRF','status','forEach','loginFeatureEnabled','readdirSync','exports','get','user','21gYOIKn','push','false','../libs/mysql','filename','length','join','readFileSync','folderLocation','execute','2219945sWVHeS','send','sort','isDirectory','verifyTokenOptional','json','query','250728OYmrMk','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','mkdirSync','mtime','21828760uTysAq','resolve','1227663MzLCYv','./uploads','CADViewer_config.json','\x20show_folders:','\x20\x20\x20','admin','children','Router','9961116SEtuqr','├──\x20','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','└──\x20','role','crypto','log','main','Invalid\x20user','../CADViewer_config.json','folder_name','cvjs_debug','path','folderLocationDemoUser','existsSync'];a15_0x565d=function(){return _0x3b54c5;};return a15_0x565d();}!fs[a15_0x3b4474(0xe4)](dir)&&fs[a15_0x3b4474(0x103)](dir);const sortFoldersFirst=(_0x1bdfa2,_0x126c96)=>{const _0x50cb65=a15_0x3b4474;if(_0x1bdfa2[_0x50cb65(0x10d)]&&!_0x126c96[_0x50cb65(0x10d)])return-0x1;else return!_0x1bdfa2[_0x50cb65(0x10d)]&&_0x126c96[_0x50cb65(0x10d)]?0x1:0x0;},listFolderStructure=(_0x1560ef,_0x1c26d9='')=>{const _0x2ac736=a15_0x3b4474,_0x5b1b35=fs[_0x2ac736(0xec)](_0x1560ef),_0x546ba7=[];return _0x5b1b35[_0x2ac736(0xea)](_0x2a73a3=>{const _0x5225d7=_0x2ac736,_0x1cbafd=path[_0x5225d7(0xf6)](_0x1560ef,_0x2a73a3),_0x278b28=fs['statSync'](_0x1cbafd);if(_0x278b28[_0x5225d7(0xfd)]()){if(config[_0x5225d7(0xe1)]&&show_folders)console['log'](_0x1c26d9+_0x5225d7(0x112)+_0x2a73a3);const _0x2c5bb2=listFolderStructure(_0x1cbafd,_0x1c26d9+_0x5225d7(0x10b));_0x546ba7[_0x5225d7(0xf1)]({'name':_0x2a73a3,'path':_0x1cbafd,'size':_0x278b28[_0x5225d7(0xe6)],'created':_0x278b28[_0x5225d7(0xe7)],'modified':_0x278b28[_0x5225d7(0x104)],'isFolder':!![],'children':_0x2c5bb2});}else{_0x546ba7['push']({'name':_0x2a73a3,'path':_0x1cbafd,'size':_0x278b28[_0x5225d7(0xe6)],'created':_0x278b28[_0x5225d7(0xe7)],'modified':_0x278b28[_0x5225d7(0x104)],'isFolder':![]});if(config[_0x5225d7(0xe1)]&&show_folders)console[_0x5225d7(0x115)](_0x1c26d9+_0x5225d7(0x110)+_0x2a73a3);}}),_0x546ba7[_0x2ac736(0xfc)](sortFoldersFirst);};router[a15_0x3b4474(0xee)]('',verifyTokenOptional,async(_0x3a7c53,_0xf58288)=>{const _0x3fcd8c=a15_0x3b4474,_0x1b7441=path[_0x3fcd8c(0xf6)](path['dirname'](require[_0x3fcd8c(0x116)][_0x3fcd8c(0xf4)]),_0x3fcd8c(0x109)),_0x5c93e3=JSON['parse'](fs[_0x3fcd8c(0xf7)](_0x1b7441,'utf8')),_0x427952=_0x3a7c53[_0x3fcd8c(0x100)][_0x3fcd8c(0xeb)];let _0x3838e2=_0x5c93e3[_0x3fcd8c(0xe3)];_0x427952===_0x3fcd8c(0xf2)&&(_0x3838e2=_0x5c93e3[_0x3fcd8c(0xf8)]);console[_0x3fcd8c(0x115)]('in\x20listFolderStructure\x20folderLocation='+_0x3838e2+_0x3fcd8c(0x10a)+show_folders+'cvhs_debug:'+config[_0x3fcd8c(0xe1)]);if(_0x3a7c53['user']){let _0x2132e1;try{const [_0x26c80c]=await conn['promise']()[_0x3fcd8c(0xf9)](_0x3fcd8c(0x102),[_0x3a7c53[_0x3fcd8c(0xef)]['email']]);_0x26c80c[_0x3fcd8c(0xf5)]>0x0&&(_0x2132e1=_0x26c80c[0x0]);}catch(_0x417bd7){console['log']({'err':_0x417bd7}),_0xf58288[_0x3fcd8c(0xe9)](0x1f4)[_0x3fcd8c(0xff)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x2132e1){_0xf58288[_0x3fcd8c(0xe9)](0x191)['json']({'error':_0x3fcd8c(0x117)});return;}_0x2132e1[_0x3fcd8c(0x113)]===_0x3fcd8c(0x10c)&&(_0x3838e2=_0x5c93e3['folderLocation']);let _0x5d6066=_0x2132e1[_0x3fcd8c(0x119)];if(!_0x5d6066){_0x5d6066=randomUUID();try{await conn['promise']()[_0x3fcd8c(0xf9)](_0x3fcd8c(0x111),[_0x5d6066,_0x3a7c53['user']['email']]);}catch(_0x2ac3d4){console['log']({'err':_0x2ac3d4}),_0xf58288[_0x3fcd8c(0xe9)](0x1f4)[_0x3fcd8c(0xff)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x30e0d9='./uploads/'+_0x5d6066;!fs[_0x3fcd8c(0xe4)](_0x30e0d9)&&fs['mkdirSync'](_0x30e0d9);const _0x5909b9=path[_0x3fcd8c(0x106)](_0x30e0d9),_0x224cd5=listFolderStructure(_0x5909b9);!fs[_0x3fcd8c(0xe4)](_0x3838e2)&&fs[_0x3fcd8c(0x103)](_0x3838e2),dirs=[{'own':!![],'name':'MY\x20FOLDER','path':_0x30e0d9,'isFolder':!![],'children':_0x224cd5},...listFolderStructure(_0x3838e2)],_0xf58288[_0x3fcd8c(0xfb)](dirs);}else!fs['existsSync'](_0x3838e2)&&fs['mkdirSync'](_0x3838e2),_0xf58288['send'](listFolderStructure(_0x3838e2));}),module[a15_0x3b4474(0xed)]=router;