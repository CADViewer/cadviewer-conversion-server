function a15_0x21a5(){const _0x44e19f=['json','../libs/mysql','execute','416oYdwRG','push','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','utf8','24IIYfbS','1240145wPaEyG','cvjs_debug','3444315lUfAMx','size','query','└──\x20','send','loginFeatureEnabled','readFileSync','sort','\x20\x20\x20','children','forEach','path','../CADViewer_config.json','Router','resolve','../libs/jwt','├──\x20','mtime','./uploads/','CADViewer_config.json','515682LuioQn','readdirSync','role','log','promise','folderLocation','main','isDirectory','folder_name','Error!\x20Something\x20went\x20wrong.','4486935gtEhDD','582746cWyAip','in\x20listFolderStructure\x20folderLocation=','parse','email','status','5566364NgiAbl','MY\x20FOLDER','get','false','./uploads','existsSync','2089129eoKfvC','user','length','folderLocationDemoUser','Invalid\x20user','mkdirSync'];a15_0x21a5=function(){return _0x44e19f;};return a15_0x21a5();}const a15_0x49d848=a15_0x374e;(function(_0x89f94,_0x364156){const _0x3672e2=a15_0x374e,_0x2bb259=_0x89f94();while(!![]){try{const _0x2b4588=parseInt(_0x3672e2(0x137))/0x1+parseInt(_0x3672e2(0x158))/0x2+parseInt(_0x3672e2(0x139))/0x3+parseInt(_0x3672e2(0x15d))/0x4+parseInt(_0x3672e2(0x157))/0x5+parseInt(_0x3672e2(0x136))/0x6*(-parseInt(_0x3672e2(0x129))/0x7)+parseInt(_0x3672e2(0x132))/0x8*(-parseInt(_0x3672e2(0x14d))/0x9);if(_0x2b4588===_0x364156)break;else _0x2bb259['push'](_0x2bb259['shift']());}catch(_0x27418d){_0x2bb259['push'](_0x2bb259['shift']());}}}(a15_0x21a5,0xc22b5));const fs=require('fs'),path=require(a15_0x49d848(0x144)),config=require(a15_0x49d848(0x145)),verifyTokenOptional=require(a15_0x49d848(0x148))['verifyTokenOptional'],show_folders=![],express=require('express'),router=express[a15_0x49d848(0x146)](),conn=require(a15_0x49d848(0x130)),{randomUUID}=require('crypto'),dir=a15_0x49d848(0x127);function a15_0x374e(_0x288d52,_0x57a299){const _0x21a5d8=a15_0x21a5();return a15_0x374e=function(_0x374e69,_0x2f297c){_0x374e69=_0x374e69-0x126;let _0x10c81e=_0x21a5d8[_0x374e69];return _0x10c81e;},a15_0x374e(_0x288d52,_0x57a299);}!fs['existsSync'](dir)&&fs[a15_0x49d848(0x12e)](dir);const sortFoldersFirst=(_0x1cff8e,_0x4d69eb)=>{const _0x18e0ca=a15_0x49d848;if(_0x1cff8e['children']&&!_0x4d69eb[_0x18e0ca(0x142)])return-0x1;else return!_0x1cff8e[_0x18e0ca(0x142)]&&_0x4d69eb[_0x18e0ca(0x142)]?0x1:0x0;},listFolderStructure=(_0x4a004a,_0x5bc694='')=>{const _0x36fbfd=a15_0x49d848,_0x544dcf=fs[_0x36fbfd(0x14e)](_0x4a004a),_0x41cffa=[];return _0x544dcf[_0x36fbfd(0x143)](_0x37f28a=>{const _0x1ec583=_0x36fbfd,_0x455765=path['join'](_0x4a004a,_0x37f28a),_0x2c53b7=fs['statSync'](_0x455765);if(_0x2c53b7[_0x1ec583(0x154)]()){if(config[_0x1ec583(0x138)]&&show_folders)console[_0x1ec583(0x150)](_0x5bc694+_0x1ec583(0x13c)+_0x37f28a);const _0x5a9825=listFolderStructure(_0x455765,_0x5bc694+_0x1ec583(0x141));_0x41cffa['push']({'name':_0x37f28a,'path':_0x455765,'size':_0x2c53b7[_0x1ec583(0x13a)],'created':_0x2c53b7['birthtime'],'modified':_0x2c53b7['mtime'],'isFolder':!![],'children':_0x5a9825});}else{_0x41cffa[_0x1ec583(0x133)]({'name':_0x37f28a,'path':_0x455765,'size':_0x2c53b7[_0x1ec583(0x13a)],'created':_0x2c53b7['birthtime'],'modified':_0x2c53b7[_0x1ec583(0x14a)],'isFolder':![]});if(config[_0x1ec583(0x138)]&&show_folders)console['log'](_0x5bc694+_0x1ec583(0x149)+_0x37f28a);}}),_0x41cffa[_0x36fbfd(0x140)](sortFoldersFirst);};router[a15_0x49d848(0x15f)]('',verifyTokenOptional,async(_0x3ad074,_0xa40f32)=>{const _0x22535f=a15_0x49d848,_0x5ccc18=path['join'](path['dirname'](require[_0x22535f(0x153)]['filename']),_0x22535f(0x14c)),_0x58c1bc=JSON[_0x22535f(0x15a)](fs[_0x22535f(0x13f)](_0x5ccc18,_0x22535f(0x135))),_0x509497=_0x3ad074[_0x22535f(0x13b)][_0x22535f(0x13e)];let _0xf6aabb=_0x58c1bc[_0x22535f(0x12c)];_0x509497===_0x22535f(0x126)&&(_0xf6aabb=_0x58c1bc[_0x22535f(0x152)]);console[_0x22535f(0x150)](_0x22535f(0x159)+_0xf6aabb+'\x20show_folders:'+show_folders+'cvhs_debug:'+config['cvjs_debug']);if(_0x3ad074[_0x22535f(0x12a)]){let _0x57e8fa;try{const [_0x426f7d]=await conn['promise']()[_0x22535f(0x131)](_0x22535f(0x134),[_0x3ad074['user'][_0x22535f(0x15b)]]);_0x426f7d[_0x22535f(0x12b)]>0x0&&(_0x57e8fa=_0x426f7d[0x0]);}catch(_0x1d65d2){console['log']({'err':_0x1d65d2}),_0xa40f32[_0x22535f(0x15c)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x57e8fa){_0xa40f32[_0x22535f(0x15c)](0x191)[_0x22535f(0x12f)]({'error':_0x22535f(0x12d)});return;}_0x57e8fa[_0x22535f(0x14f)]==='admin'&&(_0xf6aabb=_0x58c1bc['folderLocation']);let _0x5ef6d2=_0x57e8fa[_0x22535f(0x155)];if(!_0x5ef6d2){_0x5ef6d2=randomUUID();try{await conn[_0x22535f(0x151)]()['execute']('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x5ef6d2,_0x3ad074['user'][_0x22535f(0x15b)]]);}catch(_0x715205){console[_0x22535f(0x150)]({'err':_0x715205}),_0xa40f32[_0x22535f(0x15c)](0x1f4)[_0x22535f(0x12f)]({'error':_0x22535f(0x156)});return;}}const _0x364e5d=_0x22535f(0x14b)+_0x5ef6d2;!fs[_0x22535f(0x128)](_0x364e5d)&&fs[_0x22535f(0x12e)](_0x364e5d);const _0x4f8f58=path[_0x22535f(0x147)](_0x364e5d),_0x3437e3=listFolderStructure(_0x4f8f58);!fs[_0x22535f(0x128)](_0xf6aabb)&&fs[_0x22535f(0x12e)](_0xf6aabb),dirs=[{'own':!![],'name':_0x22535f(0x15e),'path':_0x364e5d,'isFolder':!![],'children':_0x3437e3},...listFolderStructure(_0xf6aabb)],_0xa40f32[_0x22535f(0x13d)](dirs);}else!fs['existsSync'](_0xf6aabb)&&fs[_0x22535f(0x12e)](_0xf6aabb),_0xa40f32[_0x22535f(0x13d)](listFolderStructure(_0xf6aabb));}),module['exports']=router;