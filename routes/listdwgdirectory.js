const a15_0x4603e9=a15_0x379a;function a15_0x5b31(){const _0x29d1c0=['./uploads','Error!\x20Something\x20went\x20wrong.','sort','readFileSync','statSync','loginFeatureEnabled','./uploads/','size','execute','\x20\x20\x20','existsSync','\x20show_folders:','exports','62907jqendM','cvhs_debug:','send','../CADViewer_config.json','role','isDirectory','7FexOha','promise','log','8142162xpFwgD','length','user','├──\x20','Invalid\x20user','../libs/jwt','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','mtime','json','24579cCWhrT','cvjs_debug','crypto','parse','6970040IzMKnJ','status','4008cpxmaE','└──\x20','dirname','folderLocation','268OlJMPr','1794846xnjfVx','35387tIFKIt','join','verifyTokenOptional','readdirSync','children','resolve','../libs/mysql','push','4276032fZQdAM','mkdirSync','express','1510irRypV','birthtime','query','forEach','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','1ddTJMN','email'];a15_0x5b31=function(){return _0x29d1c0;};return a15_0x5b31();}(function(_0x479a60,_0x2d24cf){const _0x4473ee=a15_0x379a,_0x2deaf0=_0x479a60();while(!![]){try{const _0x688ca7=parseInt(_0x4473ee(0xa5))/0x1*(parseInt(_0x4473ee(0xd1))/0x2)+-parseInt(_0x4473ee(0xb4))/0x3*(-parseInt(_0x4473ee(0xd0))/0x4)+-parseInt(_0x4473ee(0xca))/0x5+-parseInt(_0x4473ee(0xbd))/0x6*(parseInt(_0x4473ee(0xba))/0x7)+parseInt(_0x4473ee(0xda))/0x8+parseInt(_0x4473ee(0xc6))/0x9*(-parseInt(_0x4473ee(0xdd))/0xa)+-parseInt(_0x4473ee(0xd2))/0xb*(-parseInt(_0x4473ee(0xcc))/0xc);if(_0x688ca7===_0x2d24cf)break;else _0x2deaf0['push'](_0x2deaf0['shift']());}catch(_0x222af6){_0x2deaf0['push'](_0x2deaf0['shift']());}}}(a15_0x5b31,0xb6988));const fs=require('fs'),path=require('path'),config=require(a15_0x4603e9(0xb7)),verifyTokenOptional=require(a15_0x4603e9(0xc2))[a15_0x4603e9(0xd4)],show_folders=![],express=require(a15_0x4603e9(0xdc)),router=express['Router'](),conn=require(a15_0x4603e9(0xd8)),{randomUUID}=require(a15_0x4603e9(0xc8)),dir=a15_0x4603e9(0xa7);function a15_0x379a(_0x5d727d,_0x3de467){const _0x5b314b=a15_0x5b31();return a15_0x379a=function(_0x379a5e,_0x4a04d4){_0x379a5e=_0x379a5e-0xa1;let _0x5251c7=_0x5b314b[_0x379a5e];return _0x5251c7;},a15_0x379a(_0x5d727d,_0x3de467);}!fs['existsSync'](dir)&&fs[a15_0x4603e9(0xdb)](dir);const sortFoldersFirst=(_0x2f78d2,_0x330d18)=>{const _0x45ae42=a15_0x4603e9;if(_0x2f78d2[_0x45ae42(0xd6)]&&!_0x330d18[_0x45ae42(0xd6)])return-0x1;else return!_0x2f78d2[_0x45ae42(0xd6)]&&_0x330d18[_0x45ae42(0xd6)]?0x1:0x0;},listFolderStructure=(_0x32f476,_0x26d6f1='')=>{const _0x4e0586=a15_0x4603e9,_0x260d08=fs[_0x4e0586(0xd5)](_0x32f476),_0x8a3778=[];return _0x260d08[_0x4e0586(0xa3)](_0xb1d06f=>{const _0x4c6a88=_0x4e0586,_0x137f30=path[_0x4c6a88(0xd3)](_0x32f476,_0xb1d06f),_0x8ec932=fs[_0x4c6a88(0xab)](_0x137f30);if(_0x8ec932[_0x4c6a88(0xb9)]()){if(config[_0x4c6a88(0xc7)]&&show_folders)console[_0x4c6a88(0xbc)](_0x26d6f1+_0x4c6a88(0xcd)+_0xb1d06f);const _0x44e465=listFolderStructure(_0x137f30,_0x26d6f1+_0x4c6a88(0xb0));_0x8a3778['push']({'name':_0xb1d06f,'path':_0x137f30,'size':_0x8ec932[_0x4c6a88(0xae)],'created':_0x8ec932[_0x4c6a88(0xa1)],'modified':_0x8ec932[_0x4c6a88(0xc4)],'isFolder':!![],'children':_0x44e465});}else{_0x8a3778[_0x4c6a88(0xd9)]({'name':_0xb1d06f,'path':_0x137f30,'size':_0x8ec932[_0x4c6a88(0xae)],'created':_0x8ec932[_0x4c6a88(0xa1)],'modified':_0x8ec932[_0x4c6a88(0xc4)],'isFolder':![]});if(config[_0x4c6a88(0xc7)]&&show_folders)console['log'](_0x26d6f1+_0x4c6a88(0xc0)+_0xb1d06f);}}),_0x8a3778[_0x4e0586(0xa9)](sortFoldersFirst);};router['get']('',verifyTokenOptional,async(_0x13c4ea,_0x4e6997)=>{const _0x270d46=a15_0x4603e9,_0x3157c3=path[_0x270d46(0xd3)](path[_0x270d46(0xce)](require['main']['filename']),'CADViewer_config.json'),_0x2a91b0=JSON[_0x270d46(0xc9)](fs[_0x270d46(0xaa)](_0x3157c3,'utf8')),_0x1bc282=_0x13c4ea[_0x270d46(0xa2)][_0x270d46(0xac)];let _0x340869=_0x2a91b0['folderLocationDemoUser'];_0x1bc282==='false'&&(_0x340869=_0x2a91b0[_0x270d46(0xcf)]);console['log']('in\x20listFolderStructure\x20folderLocation='+_0x340869+_0x270d46(0xb2)+show_folders+_0x270d46(0xb5)+config[_0x270d46(0xc7)]);if(_0x13c4ea[_0x270d46(0xbf)]){let _0x36a386;try{const [_0x3ec0bd]=await conn[_0x270d46(0xbb)]()[_0x270d46(0xaf)](_0x270d46(0xc3),[_0x13c4ea[_0x270d46(0xbf)][_0x270d46(0xa6)]]);_0x3ec0bd[_0x270d46(0xbe)]>0x0&&(_0x36a386=_0x3ec0bd[0x0]);}catch(_0x3f573a){console[_0x270d46(0xbc)]({'err':_0x3f573a}),_0x4e6997[_0x270d46(0xcb)](0x1f4)[_0x270d46(0xc5)]({'error':_0x270d46(0xa8)});return;}if(!_0x36a386){_0x4e6997[_0x270d46(0xcb)](0x191)[_0x270d46(0xc5)]({'error':_0x270d46(0xc1)});return;}_0x36a386[_0x270d46(0xb8)]==='admin'&&(_0x340869=_0x2a91b0[_0x270d46(0xcf)]);let _0x2da634=_0x36a386['folder_name'];if(!_0x2da634){_0x2da634=randomUUID();try{await conn['promise']()[_0x270d46(0xaf)](_0x270d46(0xa4),[_0x2da634,_0x13c4ea[_0x270d46(0xbf)][_0x270d46(0xa6)]]);}catch(_0x218ebf){console[_0x270d46(0xbc)]({'err':_0x218ebf}),_0x4e6997['status'](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x3ce38f=_0x270d46(0xad)+_0x2da634;!fs['existsSync'](_0x3ce38f)&&fs['mkdirSync'](_0x3ce38f);const _0x326138=path[_0x270d46(0xd7)](_0x3ce38f),_0x19f625=listFolderStructure(_0x326138);!fs[_0x270d46(0xb1)](_0x340869)&&fs[_0x270d46(0xdb)](_0x340869),dirs=[{'own':!![],'name':'MY\x20FOLDER','path':_0x3ce38f,'isFolder':!![],'children':_0x19f625},...listFolderStructure(_0x340869)],_0x4e6997['send'](dirs);}else!fs[_0x270d46(0xb1)](_0x340869)&&fs['mkdirSync'](_0x340869),_0x4e6997[_0x270d46(0xb6)](listFolderStructure(_0x340869));}),module[a15_0x4603e9(0xb3)]=router;