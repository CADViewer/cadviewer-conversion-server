const a15_0x546446=a15_0x361d;(function(_0x1e023b,_0x324c79){const _0x5784e7=a15_0x361d,_0x1710c2=_0x1e023b();while(!![]){try{const _0x5ddf60=-parseInt(_0x5784e7(0x1ee))/0x1+-parseInt(_0x5784e7(0x1d4))/0x2*(-parseInt(_0x5784e7(0x1e3))/0x3)+parseInt(_0x5784e7(0x1e0))/0x4*(-parseInt(_0x5784e7(0x1de))/0x5)+-parseInt(_0x5784e7(0x1cf))/0x6+parseInt(_0x5784e7(0x1d0))/0x7+parseInt(_0x5784e7(0x1fe))/0x8+parseInt(_0x5784e7(0x1ef))/0x9*(parseInt(_0x5784e7(0x1f2))/0xa);if(_0x5ddf60===_0x324c79)break;else _0x1710c2['push'](_0x1710c2['shift']());}catch(_0x4387f5){_0x1710c2['push'](_0x1710c2['shift']());}}}(a15_0x559f,0x346c5));function a15_0x559f(){const _0x3bd51e=['existsSync','784sPNCDs','CADViewer_config.json','└──\x20','369717gDKTti','size','verifyTokenOptional','send','forEach','folder_name','cvhs_debug:','dirname','utf8','execute','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','380200bVNDvk','9PyvFon','false','mtime','1362610namkIm','Router','birthtime','query','../libs/mysql','folderLocation','promise','../CADViewer_config.json','exports','./uploads','\x20\x20\x20','sort','2920280JDEeOH','log','loginFeatureEnabled','isDirectory','status','express','children','\x20show_folders:','push','cvjs_debug','Error!\x20Something\x20went\x20wrong.','├──\x20','resolve','./uploads/','694284YsGqnX','1616636BYEVRQ','main','join','user','2ZWScFA','readFileSync','parse','MY\x20FOLDER','mkdirSync','folderLocationDemoUser','path','json','crypto','get','3695BOhmqa'];a15_0x559f=function(){return _0x3bd51e;};return a15_0x559f();}const fs=require('fs'),path=require(a15_0x546446(0x1da)),config=require(a15_0x546446(0x1f9)),verifyTokenOptional=require('../libs/jwt')[a15_0x546446(0x1e5)],show_folders=![],express=require(a15_0x546446(0x1c6)),router=express[a15_0x546446(0x1f3)](),conn=require(a15_0x546446(0x1f6)),{randomUUID}=require(a15_0x546446(0x1dc)),dir=a15_0x546446(0x1fb);function a15_0x361d(_0x1f0e73,_0x33612f){const _0x559f28=a15_0x559f();return a15_0x361d=function(_0x361d65,_0x3f85ea){_0x361d65=_0x361d65-0x1c6;let _0x3714cd=_0x559f28[_0x361d65];return _0x3714cd;},a15_0x361d(_0x1f0e73,_0x33612f);}!fs['existsSync'](dir)&&fs[a15_0x546446(0x1d8)](dir);const sortFoldersFirst=(_0x109ae9,_0x2e9aad)=>{const _0x33f91f=a15_0x546446;if(_0x109ae9[_0x33f91f(0x1c7)]&&!_0x2e9aad[_0x33f91f(0x1c7)])return-0x1;else return!_0x109ae9['children']&&_0x2e9aad[_0x33f91f(0x1c7)]?0x1:0x0;},listFolderStructure=(_0x59a34d,_0x382c1e='')=>{const _0x21591d=a15_0x546446,_0x1a3b71=fs['readdirSync'](_0x59a34d),_0x25b5f4=[];return _0x1a3b71[_0x21591d(0x1e7)](_0x3b841b=>{const _0x13c00a=_0x21591d,_0x2fec3f=path['join'](_0x59a34d,_0x3b841b),_0xb80f2e=fs['statSync'](_0x2fec3f);if(_0xb80f2e[_0x13c00a(0x201)]()){if(config['cvjs_debug']&&show_folders)console[_0x13c00a(0x1ff)](_0x382c1e+_0x13c00a(0x1e2)+_0x3b841b);const _0x995187=listFolderStructure(_0x2fec3f,_0x382c1e+_0x13c00a(0x1fc));_0x25b5f4[_0x13c00a(0x1c9)]({'name':_0x3b841b,'path':_0x2fec3f,'size':_0xb80f2e[_0x13c00a(0x1e4)],'created':_0xb80f2e['birthtime'],'modified':_0xb80f2e[_0x13c00a(0x1f1)],'isFolder':!![],'children':_0x995187});}else{_0x25b5f4['push']({'name':_0x3b841b,'path':_0x2fec3f,'size':_0xb80f2e[_0x13c00a(0x1e4)],'created':_0xb80f2e[_0x13c00a(0x1f4)],'modified':_0xb80f2e['mtime'],'isFolder':![]});if(config[_0x13c00a(0x1ca)]&&show_folders)console[_0x13c00a(0x1ff)](_0x382c1e+_0x13c00a(0x1cc)+_0x3b841b);}}),_0x25b5f4[_0x21591d(0x1fd)](sortFoldersFirst);};router[a15_0x546446(0x1dd)]('',verifyTokenOptional,async(_0x5d4265,_0x5151fd)=>{const _0x2fa589=a15_0x546446,_0x45e077=path[_0x2fa589(0x1d2)](path[_0x2fa589(0x1ea)](require[_0x2fa589(0x1d1)]['filename']),_0x2fa589(0x1e1)),_0x2a5625=JSON[_0x2fa589(0x1d6)](fs[_0x2fa589(0x1d5)](_0x45e077,_0x2fa589(0x1eb))),_0x14b30e=_0x5d4265[_0x2fa589(0x1f5)][_0x2fa589(0x200)];let _0x634589=_0x2a5625[_0x2fa589(0x1d9)];_0x14b30e===_0x2fa589(0x1f0)&&(_0x634589=_0x2a5625['folderLocation']);console['log']('in\x20listFolderStructure\x20folderLocation='+_0x634589+_0x2fa589(0x1c8)+show_folders+_0x2fa589(0x1e9)+config[_0x2fa589(0x1ca)]);if(_0x5d4265[_0x2fa589(0x1d3)]){let _0x5ce025;try{const [_0x108655]=await conn[_0x2fa589(0x1f8)]()[_0x2fa589(0x1ec)](_0x2fa589(0x1ed),[_0x5d4265[_0x2fa589(0x1d3)]['email']]);_0x108655['length']>0x0&&(_0x5ce025=_0x108655[0x0]);}catch(_0x50c0d1){console[_0x2fa589(0x1ff)]({'err':_0x50c0d1}),_0x5151fd[_0x2fa589(0x202)](0x1f4)[_0x2fa589(0x1db)]({'error':_0x2fa589(0x1cb)});return;}if(!_0x5ce025){_0x5151fd[_0x2fa589(0x202)](0x191)['json']({'error':'Invalid\x20user'});return;}_0x5ce025['role']==='admin'&&(_0x634589=_0x2a5625[_0x2fa589(0x1f7)]);let _0x362291=_0x5ce025[_0x2fa589(0x1e8)];if(!_0x362291){_0x362291=randomUUID();try{await conn[_0x2fa589(0x1f8)]()[_0x2fa589(0x1ec)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x362291,_0x5d4265[_0x2fa589(0x1d3)]['email']]);}catch(_0x713d8){console[_0x2fa589(0x1ff)]({'err':_0x713d8}),_0x5151fd['status'](0x1f4)['json']({'error':_0x2fa589(0x1cb)});return;}}const _0x118582=_0x2fa589(0x1ce)+_0x362291;!fs[_0x2fa589(0x1df)](_0x118582)&&fs[_0x2fa589(0x1d8)](_0x118582);const _0x872874=path[_0x2fa589(0x1cd)](_0x118582),_0x2f9397=listFolderStructure(_0x872874);!fs[_0x2fa589(0x1df)](_0x634589)&&fs[_0x2fa589(0x1d8)](_0x634589),dirs=[{'own':!![],'name':_0x2fa589(0x1d7),'path':_0x118582,'isFolder':!![],'children':_0x2f9397},...listFolderStructure(_0x634589)],_0x5151fd[_0x2fa589(0x1e6)](dirs);}else!fs[_0x2fa589(0x1df)](_0x634589)&&fs[_0x2fa589(0x1d8)](_0x634589),_0x5151fd['send'](listFolderStructure(_0x634589));}),module[a15_0x546446(0x1fa)]=router;