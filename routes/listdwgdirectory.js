const a15_0x50ed3d=a15_0x5a50;(function(_0x269c38,_0x1fb79e){const _0x60e450=a15_0x5a50,_0x40d040=_0x269c38();while(!![]){try{const _0x4e92af=-parseInt(_0x60e450(0xd2))/0x1+-parseInt(_0x60e450(0xe1))/0x2+-parseInt(_0x60e450(0xfc))/0x3*(parseInt(_0x60e450(0x102))/0x4)+-parseInt(_0x60e450(0xfd))/0x5+parseInt(_0x60e450(0xd7))/0x6+parseInt(_0x60e450(0x106))/0x7*(-parseInt(_0x60e450(0xed))/0x8)+-parseInt(_0x60e450(0xf1))/0x9*(-parseInt(_0x60e450(0xec))/0xa);if(_0x4e92af===_0x1fb79e)break;else _0x40d040['push'](_0x40d040['shift']());}catch(_0x42c652){_0x40d040['push'](_0x40d040['shift']());}}}(a15_0xdbe8,0xf3481));function a15_0x5a50(_0x18cedf,_0x504c21){const _0xdbe8c4=a15_0xdbe8();return a15_0x5a50=function(_0x5a502d,_0x283126){_0x5a502d=_0x5a502d-0xca;let _0x1ea93a=_0xdbe8c4[_0x5a502d];return _0x1ea93a;},a15_0x5a50(_0x18cedf,_0x504c21);}function a15_0xdbe8(){const _0x52af9d=['\x20show_folders:','exports','user','./uploads','forEach','get','Router','filename','├──\x20','2640320diZDBP','712JDhARh','sort','CADViewer_config.json','../libs/mysql','162tHohCu','json','mkdirSync','execute','send','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','existsSync','promise','Invalid\x20user','mtime','isDirectory','1823943jjyfSc','7485185MmdwJG','resolve','readdirSync','parse','folderLocationDemoUser','12lIDbRD','utf8','status','admin','10507TvVcnq','cvjs_debug','path','\x20\x20\x20','verifyTokenOptional','dirname','join','in\x20listFolderStructure\x20folderLocation=','main','614883iFfEyt','MY\x20FOLDER','folder_name','log','birthtime','10679856kHZFgC','../CADViewer_config.json','express','false','cvhs_debug:','length','./uploads/','push','folderLocation','children','2933238CdTGGQ','size'];a15_0xdbe8=function(){return _0x52af9d;};return a15_0xdbe8();}const fs=require('fs'),path=require(a15_0x50ed3d(0xcb)),config=require(a15_0x50ed3d(0xd8)),verifyTokenOptional=require('../libs/jwt')[a15_0x50ed3d(0xcd)],show_folders=![],express=require(a15_0x50ed3d(0xd9)),router=express[a15_0x50ed3d(0xe9)](),conn=require(a15_0x50ed3d(0xf0)),{randomUUID}=require('crypto'),dir=a15_0x50ed3d(0xe6);!fs[a15_0x50ed3d(0xf7)](dir)&&fs[a15_0x50ed3d(0xf3)](dir);const sortFoldersFirst=(_0x31381e,_0xdd70b2)=>{const _0x564c9c=a15_0x50ed3d;if(_0x31381e['children']&&!_0xdd70b2[_0x564c9c(0xe0)])return-0x1;else return!_0x31381e[_0x564c9c(0xe0)]&&_0xdd70b2[_0x564c9c(0xe0)]?0x1:0x0;},listFolderStructure=(_0x2c5b56,_0x55d0ba='')=>{const _0x52d74e=a15_0x50ed3d,_0x12e024=fs[_0x52d74e(0xff)](_0x2c5b56),_0x8439d1=[];return _0x12e024[_0x52d74e(0xe7)](_0x18fb1b=>{const _0x1bfdb7=_0x52d74e,_0x5d912f=path[_0x1bfdb7(0xcf)](_0x2c5b56,_0x18fb1b),_0x256987=fs['statSync'](_0x5d912f);if(_0x256987[_0x1bfdb7(0xfb)]()){if(config['cvjs_debug']&&show_folders)console[_0x1bfdb7(0xd5)](_0x55d0ba+'└──\x20'+_0x18fb1b);const _0x4a0577=listFolderStructure(_0x5d912f,_0x55d0ba+_0x1bfdb7(0xcc));_0x8439d1[_0x1bfdb7(0xde)]({'name':_0x18fb1b,'path':_0x5d912f,'size':_0x256987[_0x1bfdb7(0xe2)],'created':_0x256987[_0x1bfdb7(0xd6)],'modified':_0x256987[_0x1bfdb7(0xfa)],'isFolder':!![],'children':_0x4a0577});}else{_0x8439d1[_0x1bfdb7(0xde)]({'name':_0x18fb1b,'path':_0x5d912f,'size':_0x256987['size'],'created':_0x256987[_0x1bfdb7(0xd6)],'modified':_0x256987[_0x1bfdb7(0xfa)],'isFolder':![]});if(config[_0x1bfdb7(0xca)]&&show_folders)console[_0x1bfdb7(0xd5)](_0x55d0ba+_0x1bfdb7(0xeb)+_0x18fb1b);}}),_0x8439d1[_0x52d74e(0xee)](sortFoldersFirst);};router[a15_0x50ed3d(0xe8)]('',verifyTokenOptional,async(_0x5bddcd,_0x205238)=>{const _0x29328d=a15_0x50ed3d,_0x1f4a5e=path[_0x29328d(0xcf)](path[_0x29328d(0xce)](require[_0x29328d(0xd1)][_0x29328d(0xea)]),_0x29328d(0xef)),_0x186d07=JSON[_0x29328d(0x100)](fs['readFileSync'](_0x1f4a5e,_0x29328d(0x103))),_0x5691fa=_0x5bddcd['query']['loginFeatureEnabled'];let _0x349a90=_0x186d07[_0x29328d(0x101)];_0x5691fa===_0x29328d(0xda)&&(_0x349a90=_0x186d07['folderLocation']);console[_0x29328d(0xd5)](_0x29328d(0xd0)+_0x349a90+_0x29328d(0xe3)+show_folders+_0x29328d(0xdb)+config[_0x29328d(0xca)]);if(_0x5bddcd[_0x29328d(0xe5)]){let _0x4e1140;try{const [_0x5626d6]=await conn['promise']()[_0x29328d(0xf4)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x5bddcd[_0x29328d(0xe5)]['email']]);_0x5626d6[_0x29328d(0xdc)]>0x0&&(_0x4e1140=_0x5626d6[0x0]);}catch(_0x237abd){console['log']({'err':_0x237abd}),_0x205238['status'](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x4e1140){_0x205238['status'](0x191)[_0x29328d(0xf2)]({'error':_0x29328d(0xf9)});return;}_0x4e1140['role']===_0x29328d(0x105)&&(_0x349a90=_0x186d07[_0x29328d(0xdf)]);let _0x264675=_0x4e1140[_0x29328d(0xd4)];if(!_0x264675){_0x264675=randomUUID();try{await conn[_0x29328d(0xf8)]()[_0x29328d(0xf4)](_0x29328d(0xf6),[_0x264675,_0x5bddcd[_0x29328d(0xe5)]['email']]);}catch(_0x3cfdbd){console[_0x29328d(0xd5)]({'err':_0x3cfdbd}),_0x205238[_0x29328d(0x104)](0x1f4)[_0x29328d(0xf2)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x32444b=_0x29328d(0xdd)+_0x264675;!fs[_0x29328d(0xf7)](_0x32444b)&&fs[_0x29328d(0xf3)](_0x32444b);const _0x52e5c6=path[_0x29328d(0xfe)](_0x32444b),_0x48bcb4=listFolderStructure(_0x52e5c6);!fs[_0x29328d(0xf7)](_0x349a90)&&fs['mkdirSync'](_0x349a90),dirs=[{'own':!![],'name':_0x29328d(0xd3),'path':_0x32444b,'isFolder':!![],'children':_0x48bcb4},...listFolderStructure(_0x349a90)],_0x205238['send'](dirs);}else!fs['existsSync'](_0x349a90)&&fs['mkdirSync'](_0x349a90),_0x205238[_0x29328d(0xf5)](listFolderStructure(_0x349a90));}),module[a15_0x50ed3d(0xe4)]=router;