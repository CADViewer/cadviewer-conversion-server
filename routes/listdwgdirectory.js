const a15_0x2dfc16=a15_0x21fc;(function(_0xd5bc60,_0x5d4e8d){const _0x36d8dd=a15_0x21fc,_0x1c636=_0xd5bc60();while(!![]){try{const _0x4ad925=parseInt(_0x36d8dd(0x15f))/0x1*(-parseInt(_0x36d8dd(0x159))/0x2)+parseInt(_0x36d8dd(0x137))/0x3+parseInt(_0x36d8dd(0x15a))/0x4*(parseInt(_0x36d8dd(0x130))/0x5)+-parseInt(_0x36d8dd(0x152))/0x6+parseInt(_0x36d8dd(0x14f))/0x7*(parseInt(_0x36d8dd(0x167))/0x8)+parseInt(_0x36d8dd(0x147))/0x9+-parseInt(_0x36d8dd(0x14a))/0xa*(parseInt(_0x36d8dd(0x153))/0xb);if(_0x4ad925===_0x5d4e8d)break;else _0x1c636['push'](_0x1c636['shift']());}catch(_0x3af412){_0x1c636['push'](_0x1c636['shift']());}}}(a15_0x26bd,0x64290));function a15_0x21fc(_0x1c39ac,_0x3e94d6){const _0x26bded=a15_0x26bd();return a15_0x21fc=function(_0x21fc22,_0x1fa938){_0x21fc22=_0x21fc22-0x12f;let _0x23e30c=_0x26bded[_0x21fc22];return _0x23e30c;},a15_0x21fc(_0x1c39ac,_0x3e94d6);}function a15_0x26bd(){const _0x50506f=['3vvbpkE','dirname','exports','children','mkdirSync','join','log','readdirSync','8nBGtMc','\x20\x20\x20','├──\x20','5LxiCRK','in\x20listFolderStructure\x20folderLocation=','└──\x20','json','push','main','execute','2210289BeznnJ','birthtime','length','../libs/jwt','send','query','Error!\x20Something\x20went\x20wrong.','user','Invalid\x20user','statSync','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','./uploads','filename','status','sort','false','843372cUSFbM','readFileSync','role','4270OQZYBi','../libs/mysql','email','size','forEach','3242463mRaUuk','folderLocationDemoUser','parse','2185008PYince','11396LJHVZj','cvjs_debug','isDirectory','mtime','MY\x20FOLDER','verifyTokenOptional','305606qzMvSJ','1526100xErQNX','promise','folderLocation','CADViewer_config.json','existsSync'];a15_0x26bd=function(){return _0x50506f;};return a15_0x26bd();}const fs=require('fs'),path=require('path'),config=require('../CADViewer_config.json'),verifyTokenOptional=require(a15_0x2dfc16(0x13a))[a15_0x2dfc16(0x158)],show_folders=![],express=require('express'),router=express['Router'](),conn=require(a15_0x2dfc16(0x14b)),{randomUUID}=require('crypto'),dir=a15_0x2dfc16(0x142);!fs[a15_0x2dfc16(0x15e)](dir)&&fs['mkdirSync'](dir);const sortFoldersFirst=(_0x182d3a,_0xe8b20)=>{const _0x57360e=a15_0x2dfc16;if(_0x182d3a[_0x57360e(0x162)]&&!_0xe8b20[_0x57360e(0x162)])return-0x1;else return!_0x182d3a[_0x57360e(0x162)]&&_0xe8b20[_0x57360e(0x162)]?0x1:0x0;},listFolderStructure=(_0x61a23d,_0x597b09='')=>{const _0x576657=a15_0x2dfc16,_0x141b95=fs[_0x576657(0x166)](_0x61a23d),_0x3df64a=[];return _0x141b95[_0x576657(0x14e)](_0x83031a=>{const _0x2878ff=_0x576657,_0x9118a3=path[_0x2878ff(0x164)](_0x61a23d,_0x83031a),_0x1f8c7a=fs[_0x2878ff(0x140)](_0x9118a3);if(_0x1f8c7a[_0x2878ff(0x155)]()){if(config[_0x2878ff(0x154)]&&show_folders)console['log'](_0x597b09+_0x2878ff(0x132)+_0x83031a);const _0x30615a=listFolderStructure(_0x9118a3,_0x597b09+_0x2878ff(0x168));_0x3df64a[_0x2878ff(0x134)]({'name':_0x83031a,'path':_0x9118a3,'size':_0x1f8c7a['size'],'created':_0x1f8c7a['birthtime'],'modified':_0x1f8c7a[_0x2878ff(0x156)],'isFolder':!![],'children':_0x30615a});}else{_0x3df64a['push']({'name':_0x83031a,'path':_0x9118a3,'size':_0x1f8c7a[_0x2878ff(0x14d)],'created':_0x1f8c7a[_0x2878ff(0x138)],'modified':_0x1f8c7a[_0x2878ff(0x156)],'isFolder':![]});if(config['cvjs_debug']&&show_folders)console['log'](_0x597b09+_0x2878ff(0x12f)+_0x83031a);}}),_0x3df64a[_0x576657(0x145)](sortFoldersFirst);};router['get']('',verifyTokenOptional,async(_0x2d88fe,_0x4f2b8c)=>{const _0x2ca67c=a15_0x2dfc16,_0x3fbe1f=path[_0x2ca67c(0x164)](path[_0x2ca67c(0x160)](require[_0x2ca67c(0x135)][_0x2ca67c(0x143)]),_0x2ca67c(0x15d)),_0x617369=JSON[_0x2ca67c(0x151)](fs[_0x2ca67c(0x148)](_0x3fbe1f,'utf8')),_0x291bd0=_0x2d88fe[_0x2ca67c(0x13c)]['loginFeatureEnabled'];let _0x139bad=_0x617369[_0x2ca67c(0x150)];_0x291bd0===_0x2ca67c(0x146)&&(_0x139bad=_0x617369[_0x2ca67c(0x15c)]);console['log'](_0x2ca67c(0x131)+_0x139bad+'\x20show_folders:'+show_folders+'cvhs_debug:'+config['cvjs_debug']);if(_0x2d88fe['user']){let _0x2a0373;try{const [_0x597396]=await conn[_0x2ca67c(0x15b)]()[_0x2ca67c(0x136)](_0x2ca67c(0x141),[_0x2d88fe[_0x2ca67c(0x13e)]['email']]);_0x597396[_0x2ca67c(0x139)]>0x0&&(_0x2a0373=_0x597396[0x0]);}catch(_0x181f6d){console[_0x2ca67c(0x165)]({'err':_0x181f6d}),_0x4f2b8c[_0x2ca67c(0x144)](0x1f4)[_0x2ca67c(0x133)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x2a0373){_0x4f2b8c[_0x2ca67c(0x144)](0x191)[_0x2ca67c(0x133)]({'error':_0x2ca67c(0x13f)});return;}_0x2a0373[_0x2ca67c(0x149)]==='admin'&&(_0x139bad=_0x617369['folderLocation']);let _0x8579e4=_0x2a0373['folder_name'];if(!_0x8579e4){_0x8579e4=randomUUID();try{await conn[_0x2ca67c(0x15b)]()['execute']('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x8579e4,_0x2d88fe['user'][_0x2ca67c(0x14c)]]);}catch(_0x3c2f69){console[_0x2ca67c(0x165)]({'err':_0x3c2f69}),_0x4f2b8c['status'](0x1f4)[_0x2ca67c(0x133)]({'error':_0x2ca67c(0x13d)});return;}}const _0x29ee5f='./uploads/'+_0x8579e4;!fs['existsSync'](_0x29ee5f)&&fs['mkdirSync'](_0x29ee5f);const _0x2607ee=path['resolve'](_0x29ee5f),_0x38dd74=listFolderStructure(_0x2607ee);!fs[_0x2ca67c(0x15e)](_0x139bad)&&fs[_0x2ca67c(0x163)](_0x139bad),dirs=[{'own':!![],'name':_0x2ca67c(0x157),'path':_0x29ee5f,'isFolder':!![],'children':_0x38dd74},...listFolderStructure(_0x139bad)],_0x4f2b8c[_0x2ca67c(0x13b)](dirs);}else!fs[_0x2ca67c(0x15e)](_0x139bad)&&fs[_0x2ca67c(0x163)](_0x139bad),_0x4f2b8c[_0x2ca67c(0x13b)](listFolderStructure(_0x139bad));}),module[a15_0x2dfc16(0x161)]=router;