const a15_0x5a41d0=a15_0x1b76;function a15_0x539a(){const _0x9980a=['parse','status','exports','execute','mkdirSync','children','1008294rnCLqR','Invalid\x20user','false','size','6241023auBUSZ','5162832narqiM','express','folder_name','admin','../CADViewer_config.json','forEach','./uploads','sort','Error!\x20Something\x20went\x20wrong.','925687DJtkHr','mtime','cvjs_debug','../libs/jwt','push','promise','join','log','isDirectory','dirname','4431GtzYZZ','Router','verifyTokenOptional','email','folderLocation','\x20show_folders:','user','length','74PeIwYY','readdirSync','└──\x20','existsSync','in\x20listFolderStructure\x20folderLocation=','MY\x20FOLDER','1285664skQYPM','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','json','cvhs_debug:','1977288pzvwph','crypto','send','5ZJYmim','CADViewer_config.json','loginFeatureEnabled','statSync','query'];a15_0x539a=function(){return _0x9980a;};return a15_0x539a();}(function(_0x2c7ad8,_0x274d26){const _0x5ac579=a15_0x1b76,_0x2b8bb6=_0x2c7ad8();while(!![]){try{const _0x461de2=-parseInt(_0x5ac579(0x1e2))/0x1*(parseInt(_0x5ac579(0x1ea))/0x2)+-parseInt(_0x5ac579(0x202))/0x3+-parseInt(_0x5ac579(0x1f0))/0x4*(-parseInt(_0x5ac579(0x1f7))/0x5)+parseInt(_0x5ac579(0x1f4))/0x6+parseInt(_0x5ac579(0x210))/0x7+-parseInt(_0x5ac579(0x207))/0x8+parseInt(_0x5ac579(0x206))/0x9;if(_0x461de2===_0x274d26)break;else _0x2b8bb6['push'](_0x2b8bb6['shift']());}catch(_0x54f904){_0x2b8bb6['push'](_0x2b8bb6['shift']());}}}(a15_0x539a,0x50df5));const fs=require('fs'),path=require('path'),config=require(a15_0x5a41d0(0x20b)),verifyTokenOptional=require(a15_0x5a41d0(0x213))[a15_0x5a41d0(0x1e4)],show_folders=![],express=require(a15_0x5a41d0(0x208)),router=express[a15_0x5a41d0(0x1e3)](),conn=require('../libs/mysql'),{randomUUID}=require(a15_0x5a41d0(0x1f5)),dir=a15_0x5a41d0(0x20d);function a15_0x1b76(_0x5f7734,_0x161f3e){const _0x539ae8=a15_0x539a();return a15_0x1b76=function(_0x1b76c4,_0x1f71af){_0x1b76c4=_0x1b76c4-0x1dd;let _0x1ade7e=_0x539ae8[_0x1b76c4];return _0x1ade7e;},a15_0x1b76(_0x5f7734,_0x161f3e);}!fs[a15_0x5a41d0(0x1ed)](dir)&&fs[a15_0x5a41d0(0x200)](dir);const sortFoldersFirst=(_0x26ef2b,_0x4bdd3d)=>{const _0x44eac1=a15_0x5a41d0;if(_0x26ef2b[_0x44eac1(0x201)]&&!_0x4bdd3d[_0x44eac1(0x201)])return-0x1;else return!_0x26ef2b[_0x44eac1(0x201)]&&_0x4bdd3d['children']?0x1:0x0;},listFolderStructure=(_0x1c1a63,_0x4cdeb1='')=>{const _0x2f5b42=a15_0x5a41d0,_0x472974=fs[_0x2f5b42(0x1eb)](_0x1c1a63),_0x142d8b=[];return _0x472974[_0x2f5b42(0x20c)](_0x3435bc=>{const _0x5d9b10=_0x2f5b42,_0x4fda25=path[_0x5d9b10(0x1de)](_0x1c1a63,_0x3435bc),_0x42ccd6=fs[_0x5d9b10(0x1fa)](_0x4fda25);if(_0x42ccd6[_0x5d9b10(0x1e0)]()){if(config['cvjs_debug']&&show_folders)console[_0x5d9b10(0x1df)](_0x4cdeb1+_0x5d9b10(0x1ec)+_0x3435bc);const _0x4bf986=listFolderStructure(_0x4fda25,_0x4cdeb1+'\x20\x20\x20');_0x142d8b[_0x5d9b10(0x214)]({'name':_0x3435bc,'path':_0x4fda25,'size':_0x42ccd6[_0x5d9b10(0x205)],'created':_0x42ccd6['birthtime'],'modified':_0x42ccd6['mtime'],'isFolder':!![],'children':_0x4bf986});}else{_0x142d8b[_0x5d9b10(0x214)]({'name':_0x3435bc,'path':_0x4fda25,'size':_0x42ccd6[_0x5d9b10(0x205)],'created':_0x42ccd6['birthtime'],'modified':_0x42ccd6[_0x5d9b10(0x211)],'isFolder':![]});if(config['cvjs_debug']&&show_folders)console['log'](_0x4cdeb1+'├──\x20'+_0x3435bc);}}),_0x142d8b[_0x2f5b42(0x20e)](sortFoldersFirst);};router['get']('',verifyTokenOptional,async(_0xbd5992,_0xbb537f)=>{const _0x529992=a15_0x5a41d0,_0x2370df=path[_0x529992(0x1de)](path[_0x529992(0x1e1)](require['main']['filename']),_0x529992(0x1f8)),_0x2c6b65=JSON[_0x529992(0x1fc)](fs['readFileSync'](_0x2370df,'utf8')),_0x22d989=_0xbd5992[_0x529992(0x1fb)][_0x529992(0x1f9)];let _0x1f85fa=_0x2c6b65['folderLocationDemoUser'];_0x22d989===_0x529992(0x204)&&(_0x1f85fa=_0x2c6b65[_0x529992(0x1e6)]);console[_0x529992(0x1df)](_0x529992(0x1ee)+_0x1f85fa+_0x529992(0x1e7)+show_folders+_0x529992(0x1f3)+config[_0x529992(0x212)]);if(_0xbd5992[_0x529992(0x1e8)]){let _0x2c2e2f;try{const [_0x2d52d2]=await conn[_0x529992(0x1dd)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0xbd5992[_0x529992(0x1e8)][_0x529992(0x1e5)]]);_0x2d52d2[_0x529992(0x1e9)]>0x0&&(_0x2c2e2f=_0x2d52d2[0x0]);}catch(_0x1ee999){console[_0x529992(0x1df)]({'err':_0x1ee999}),_0xbb537f['status'](0x1f4)[_0x529992(0x1f2)]({'error':_0x529992(0x20f)});return;}if(!_0x2c2e2f){_0xbb537f[_0x529992(0x1fd)](0x191)['json']({'error':_0x529992(0x203)});return;}_0x2c2e2f['role']===_0x529992(0x20a)&&(_0x1f85fa=_0x2c6b65[_0x529992(0x1e6)]);let _0x1d4a83=_0x2c2e2f[_0x529992(0x209)];if(!_0x1d4a83){_0x1d4a83=randomUUID();try{await conn['promise']()[_0x529992(0x1ff)](_0x529992(0x1f1),[_0x1d4a83,_0xbd5992[_0x529992(0x1e8)][_0x529992(0x1e5)]]);}catch(_0x90e40d){console[_0x529992(0x1df)]({'err':_0x90e40d}),_0xbb537f[_0x529992(0x1fd)](0x1f4)[_0x529992(0x1f2)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x3c0a92='./uploads/'+_0x1d4a83;!fs[_0x529992(0x1ed)](_0x3c0a92)&&fs[_0x529992(0x200)](_0x3c0a92);const _0xe87e4b=path['resolve'](_0x3c0a92),_0x3e0ff9=listFolderStructure(_0xe87e4b);!fs[_0x529992(0x1ed)](_0x1f85fa)&&fs[_0x529992(0x200)](_0x1f85fa),dirs=[{'own':!![],'name':_0x529992(0x1ef),'path':_0x3c0a92,'isFolder':!![],'children':_0x3e0ff9},...listFolderStructure(_0x1f85fa)],_0xbb537f[_0x529992(0x1f6)](dirs);}else!fs[_0x529992(0x1ed)](_0x1f85fa)&&fs[_0x529992(0x200)](_0x1f85fa),_0xbb537f[_0x529992(0x1f6)](listFolderStructure(_0x1f85fa));}),module[a15_0x5a41d0(0x1fe)]=router;