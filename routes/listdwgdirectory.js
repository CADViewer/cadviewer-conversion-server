const a15_0x220160=a15_0x2716;(function(_0x1f9368,_0x32d376){const _0x383d1e=a15_0x2716,_0xf63bfe=_0x1f9368();while(!![]){try{const _0x4e021b=parseInt(_0x383d1e(0x16b))/0x1+parseInt(_0x383d1e(0x15b))/0x2+-parseInt(_0x383d1e(0x17c))/0x3*(parseInt(_0x383d1e(0x179))/0x4)+-parseInt(_0x383d1e(0x156))/0x5+-parseInt(_0x383d1e(0x172))/0x6*(-parseInt(_0x383d1e(0x158))/0x7)+-parseInt(_0x383d1e(0x16f))/0x8+-parseInt(_0x383d1e(0x167))/0x9*(-parseInt(_0x383d1e(0x174))/0xa);if(_0x4e021b===_0x32d376)break;else _0xf63bfe['push'](_0xf63bfe['shift']());}catch(_0x1e6282){_0xf63bfe['push'](_0xf63bfe['shift']());}}}(a15_0x9262,0x5f298));const fs=require('fs'),path=require(a15_0x220160(0x14a)),config=require(a15_0x220160(0x178)),verifyTokenOptional=require(a15_0x220160(0x165))[a15_0x220160(0x16a)],show_folders=![],express=require('express'),router=express[a15_0x220160(0x161)](),conn=require(a15_0x220160(0x162)),{randomUUID}=require(a15_0x220160(0x15f)),dir='./uploads';!fs['existsSync'](dir)&&fs[a15_0x220160(0x177)](dir);const sortFoldersFirst=(_0x50f3c7,_0x54929a)=>{const _0x4845e4=a15_0x220160;if(_0x50f3c7[_0x4845e4(0x153)]&&!_0x54929a[_0x4845e4(0x153)])return-0x1;else return!_0x50f3c7[_0x4845e4(0x153)]&&_0x54929a['children']?0x1:0x0;},listFolderStructure=(_0x20d2b4,_0x3d4750='')=>{const _0x1f62da=a15_0x220160,_0x22a193=fs[_0x1f62da(0x17a)](_0x20d2b4),_0x4dae8f=[];return _0x22a193['forEach'](_0x55fee7=>{const _0x12760b=_0x1f62da,_0x18661b=path[_0x12760b(0x14b)](_0x20d2b4,_0x55fee7),_0x48528f=fs[_0x12760b(0x17e)](_0x18661b);if(_0x48528f[_0x12760b(0x181)]()){if(config['cvjs_debug']&&show_folders)console['log'](_0x3d4750+'└──\x20'+_0x55fee7);const _0x1a2b12=listFolderStructure(_0x18661b,_0x3d4750+'\x20\x20\x20');_0x4dae8f[_0x12760b(0x17d)]({'name':_0x55fee7,'path':_0x18661b,'size':_0x48528f[_0x12760b(0x17b)],'created':_0x48528f[_0x12760b(0x154)],'modified':_0x48528f['mtime'],'isFolder':!![],'children':_0x1a2b12});}else{_0x4dae8f[_0x12760b(0x17d)]({'name':_0x55fee7,'path':_0x18661b,'size':_0x48528f[_0x12760b(0x17b)],'created':_0x48528f[_0x12760b(0x154)],'modified':_0x48528f['mtime'],'isFolder':![]});if(config[_0x12760b(0x14e)]&&show_folders)console['log'](_0x3d4750+'├──\x20'+_0x55fee7);}}),_0x4dae8f[_0x1f62da(0x170)](sortFoldersFirst);};function a15_0x2716(_0x3ba3f9,_0x421ab4){const _0x926202=a15_0x9262();return a15_0x2716=function(_0x271621,_0x3cc239){_0x271621=_0x271621-0x147;let _0x1368af=_0x926202[_0x271621];return _0x1368af;},a15_0x2716(_0x3ba3f9,_0x421ab4);}router[a15_0x220160(0x149)]('',verifyTokenOptional,async(_0x535b73,_0x145514)=>{const _0x210f52=a15_0x220160,_0x37d493=path['join'](path[_0x210f52(0x15e)](require[_0x210f52(0x169)][_0x210f52(0x148)]),_0x210f52(0x164)),_0x49d867=JSON[_0x210f52(0x14c)](fs['readFileSync'](_0x37d493,'utf8')),_0x271f22=_0x535b73[_0x210f52(0x151)][_0x210f52(0x16c)];let _0x48bc07=_0x49d867[_0x210f52(0x155)];_0x271f22===_0x210f52(0x17f)&&(_0x48bc07=_0x49d867['folderLocation']);console[_0x210f52(0x180)](_0x210f52(0x168)+_0x48bc07+_0x210f52(0x150)+show_folders+_0x210f52(0x15a)+config['cvjs_debug']);if(_0x535b73['user']){let _0x3fa938;try{const [_0x415803]=await conn[_0x210f52(0x173)]()[_0x210f52(0x160)](_0x210f52(0x159),[_0x535b73[_0x210f52(0x166)][_0x210f52(0x175)]]);_0x415803[_0x210f52(0x16d)]>0x0&&(_0x3fa938=_0x415803[0x0]);}catch(_0x41c970){console[_0x210f52(0x180)]({'err':_0x41c970}),_0x145514['status'](0x1f4)['json']({'error':_0x210f52(0x14f)});return;}if(!_0x3fa938){_0x145514['status'](0x191)[_0x210f52(0x163)]({'error':_0x210f52(0x147)});return;}_0x3fa938[_0x210f52(0x176)]==='admin'&&(_0x48bc07=_0x49d867['folderLocation']);let _0x6fcb17=_0x3fa938[_0x210f52(0x15d)];if(!_0x6fcb17){_0x6fcb17=randomUUID();try{await conn[_0x210f52(0x173)]()[_0x210f52(0x160)](_0x210f52(0x15c),[_0x6fcb17,_0x535b73[_0x210f52(0x166)][_0x210f52(0x175)]]);}catch(_0x560885){console['log']({'err':_0x560885}),_0x145514[_0x210f52(0x14d)](0x1f4)['json']({'error':_0x210f52(0x14f)});return;}}const _0x931f33='./uploads/'+_0x6fcb17;!fs[_0x210f52(0x152)](_0x931f33)&&fs[_0x210f52(0x177)](_0x931f33);const _0xee91e5=path[_0x210f52(0x157)](_0x931f33),_0x4e0b96=listFolderStructure(_0xee91e5);!fs[_0x210f52(0x152)](_0x48bc07)&&fs[_0x210f52(0x177)](_0x48bc07),dirs=[{'own':!![],'name':_0x210f52(0x171),'path':_0x931f33,'isFolder':!![],'children':_0x4e0b96},...listFolderStructure(_0x48bc07)],_0x145514[_0x210f52(0x16e)](dirs);}else!fs['existsSync'](_0x48bc07)&&fs[_0x210f52(0x177)](_0x48bc07),_0x145514['send'](listFolderStructure(_0x48bc07));}),module['exports']=router;function a15_0x9262(){const _0x34a573=['108112DITAyX','readdirSync','size','84vwZgBt','push','statSync','false','log','isDirectory','Invalid\x20user','filename','get','path','join','parse','status','cvjs_debug','Error!\x20Something\x20went\x20wrong.','\x20show_folders:','query','existsSync','children','birthtime','folderLocationDemoUser','3786450bGeFtz','resolve','1981YzIkCD','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','cvhs_debug:','1498878ubCiiS','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','folder_name','dirname','crypto','execute','Router','../libs/mysql','json','CADViewer_config.json','../libs/jwt','user','45HZvhmj','in\x20listFolderStructure\x20folderLocation=','main','verifyTokenOptional','189427JtYWpH','loginFeatureEnabled','length','send','5873712LUrOSk','sort','MY\x20FOLDER','5262nbmWlN','promise','2902030NnsXFu','email','role','mkdirSync','../CADViewer_config.json'];a15_0x9262=function(){return _0x34a573;};return a15_0x9262();}