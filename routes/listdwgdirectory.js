const a15_0x2fce0b=a15_0x3560;function a15_0x4003(){const _0x338eb8=['user','./uploads/','express','forEach','admin','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','6611157vjgzzf','\x20show_folders:','push','cvjs_debug','size','Error!\x20Something\x20went\x20wrong.','mtime','10TopsnN','main','in\x20listFolderStructure\x20folderLocation=','json','3ZURVEm','resolve','└──\x20','dirname','parse','721878wtkqvK','crypto','folder_name','MY\x20FOLDER','../libs/jwt','CADViewer_config.json','28AGQhsr','join','6013337pEtUhh','get','readFileSync','4899245szOmle','4432420OjLYAt','../CADViewer_config.json','mkdirSync','readdirSync','email','existsSync','4585XVVODM','cvhs_debug:','log','folderLocationDemoUser','\x20\x20\x20','length','statSync','sort','folderLocation','exports','role','loginFeatureEnabled','path','birthtime','verifyTokenOptional','./uploads','isDirectory','157008QZnoPh','filename','children','294WHQtYW','send'];a15_0x4003=function(){return _0x338eb8;};return a15_0x4003();}(function(_0x436802,_0xcc146c){const _0x45f11f=a15_0x3560,_0x372393=_0x436802();while(!![]){try{const _0x1c9481=-parseInt(_0x45f11f(0x1e1))/0x1*(-parseInt(_0x45f11f(0x1f5))/0x2)+parseInt(_0x45f11f(0x1ca))/0x3*(parseInt(_0x45f11f(0x1db))/0x4)+-parseInt(_0x45f11f(0x1da))/0x5+parseInt(_0x45f11f(0x1cf))/0x6+-parseInt(_0x45f11f(0x1d5))/0x7*(parseInt(_0x45f11f(0x1f2))/0x8)+parseInt(_0x45f11f(0x1fd))/0x9*(-parseInt(_0x45f11f(0x1c6))/0xa)+parseInt(_0x45f11f(0x1d7))/0xb;if(_0x1c9481===_0xcc146c)break;else _0x372393['push'](_0x372393['shift']());}catch(_0x513db8){_0x372393['push'](_0x372393['shift']());}}}(a15_0x4003,0xa031a));const fs=require('fs'),path=require(a15_0x2fce0b(0x1ed)),config=require(a15_0x2fce0b(0x1dc)),verifyTokenOptional=require(a15_0x2fce0b(0x1d3))[a15_0x2fce0b(0x1ef)],show_folders=![],express=require(a15_0x2fce0b(0x1f9)),router=express['Router'](),conn=require('../libs/mysql'),{randomUUID}=require(a15_0x2fce0b(0x1d0)),dir=a15_0x2fce0b(0x1f0);!fs[a15_0x2fce0b(0x1e0)](dir)&&fs['mkdirSync'](dir);function a15_0x3560(_0x2b107c,_0x368a7b){const _0x4003b0=a15_0x4003();return a15_0x3560=function(_0x356078,_0x34ebe3){_0x356078=_0x356078-0x1c0;let _0x1d55a9=_0x4003b0[_0x356078];return _0x1d55a9;},a15_0x3560(_0x2b107c,_0x368a7b);}const sortFoldersFirst=(_0x6b588e,_0x40b109)=>{const _0x153d94=a15_0x2fce0b;if(_0x6b588e['children']&&!_0x40b109['children'])return-0x1;else return!_0x6b588e[_0x153d94(0x1f4)]&&_0x40b109[_0x153d94(0x1f4)]?0x1:0x0;},listFolderStructure=(_0x24c195,_0x54fa3f='')=>{const _0xf3d331=a15_0x2fce0b,_0xc4562=fs[_0xf3d331(0x1de)](_0x24c195),_0x24c813=[];return _0xc4562[_0xf3d331(0x1fa)](_0x3aa12f=>{const _0x5836e4=_0xf3d331,_0x255ed0=path[_0x5836e4(0x1d6)](_0x24c195,_0x3aa12f),_0x1ffbc3=fs[_0x5836e4(0x1e7)](_0x255ed0);if(_0x1ffbc3[_0x5836e4(0x1f1)]()){if(config['cvjs_debug']&&show_folders)console[_0x5836e4(0x1e3)](_0x54fa3f+_0x5836e4(0x1cc)+_0x3aa12f);const _0x2201b9=listFolderStructure(_0x255ed0,_0x54fa3f+_0x5836e4(0x1e5));_0x24c813['push']({'name':_0x3aa12f,'path':_0x255ed0,'size':_0x1ffbc3[_0x5836e4(0x1c3)],'created':_0x1ffbc3['birthtime'],'modified':_0x1ffbc3[_0x5836e4(0x1c5)],'isFolder':!![],'children':_0x2201b9});}else{_0x24c813[_0x5836e4(0x1c1)]({'name':_0x3aa12f,'path':_0x255ed0,'size':_0x1ffbc3[_0x5836e4(0x1c3)],'created':_0x1ffbc3[_0x5836e4(0x1ee)],'modified':_0x1ffbc3[_0x5836e4(0x1c5)],'isFolder':![]});if(config['cvjs_debug']&&show_folders)console[_0x5836e4(0x1e3)](_0x54fa3f+'├──\x20'+_0x3aa12f);}}),_0x24c813[_0xf3d331(0x1e8)](sortFoldersFirst);};router[a15_0x2fce0b(0x1d8)]('',verifyTokenOptional,async(_0x4e3d8f,_0x3e0254)=>{const _0x3485f1=a15_0x2fce0b,_0x42f5ec=path[_0x3485f1(0x1d6)](path[_0x3485f1(0x1cd)](require[_0x3485f1(0x1c7)][_0x3485f1(0x1f3)]),_0x3485f1(0x1d4)),_0x3e70b8=JSON[_0x3485f1(0x1ce)](fs[_0x3485f1(0x1d9)](_0x42f5ec,'utf8')),_0x4db671=_0x4e3d8f['query'][_0x3485f1(0x1ec)];let _0x3eaf5e=_0x3e70b8[_0x3485f1(0x1e4)];_0x4db671==='false'&&(_0x3eaf5e=_0x3e70b8[_0x3485f1(0x1e9)]);console['log'](_0x3485f1(0x1c8)+_0x3eaf5e+_0x3485f1(0x1c0)+show_folders+_0x3485f1(0x1e2)+config[_0x3485f1(0x1c2)]);if(_0x4e3d8f['user']){let _0xad7a4d;try{const [_0x4d3a73]=await conn['promise']()['execute'](_0x3485f1(0x1fc),[_0x4e3d8f[_0x3485f1(0x1f7)]['email']]);_0x4d3a73[_0x3485f1(0x1e6)]>0x0&&(_0xad7a4d=_0x4d3a73[0x0]);}catch(_0x2bc54a){console['log']({'err':_0x2bc54a}),_0x3e0254['status'](0x1f4)[_0x3485f1(0x1c9)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0xad7a4d){_0x3e0254['status'](0x191)[_0x3485f1(0x1c9)]({'error':'Invalid\x20user'});return;}_0xad7a4d[_0x3485f1(0x1eb)]===_0x3485f1(0x1fb)&&(_0x3eaf5e=_0x3e70b8[_0x3485f1(0x1e9)]);let _0x3ca825=_0xad7a4d[_0x3485f1(0x1d1)];if(!_0x3ca825){_0x3ca825=randomUUID();try{await conn['promise']()['execute']('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x3ca825,_0x4e3d8f['user'][_0x3485f1(0x1df)]]);}catch(_0x174316){console['log']({'err':_0x174316}),_0x3e0254['status'](0x1f4)[_0x3485f1(0x1c9)]({'error':_0x3485f1(0x1c4)});return;}}const _0x13f21c=_0x3485f1(0x1f8)+_0x3ca825;!fs[_0x3485f1(0x1e0)](_0x13f21c)&&fs[_0x3485f1(0x1dd)](_0x13f21c);const _0x279d2f=path[_0x3485f1(0x1cb)](_0x13f21c),_0x39fdda=listFolderStructure(_0x279d2f);!fs['existsSync'](_0x3eaf5e)&&fs[_0x3485f1(0x1dd)](_0x3eaf5e),dirs=[{'own':!![],'name':_0x3485f1(0x1d2),'path':_0x13f21c,'isFolder':!![],'children':_0x39fdda},...listFolderStructure(_0x3eaf5e)],_0x3e0254[_0x3485f1(0x1f6)](dirs);}else!fs['existsSync'](_0x3eaf5e)&&fs[_0x3485f1(0x1dd)](_0x3eaf5e),_0x3e0254['send'](listFolderStructure(_0x3eaf5e));}),module[a15_0x2fce0b(0x1ea)]=router;