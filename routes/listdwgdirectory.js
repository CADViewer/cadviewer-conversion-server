const a15_0x28d425=a15_0x4eb4;(function(_0x38254a,_0x2334fb){const _0x4b41e6=a15_0x4eb4,_0x528a81=_0x38254a();while(!![]){try{const _0x4c4734=parseInt(_0x4b41e6(0x147))/0x1+-parseInt(_0x4b41e6(0x13e))/0x2+-parseInt(_0x4b41e6(0x141))/0x3*(parseInt(_0x4b41e6(0x128))/0x4)+-parseInt(_0x4b41e6(0x151))/0x5+parseInt(_0x4b41e6(0x13f))/0x6*(-parseInt(_0x4b41e6(0x159))/0x7)+parseInt(_0x4b41e6(0x12e))/0x8*(parseInt(_0x4b41e6(0x12a))/0x9)+parseInt(_0x4b41e6(0x14c))/0xa*(parseInt(_0x4b41e6(0x14d))/0xb);if(_0x4c4734===_0x2334fb)break;else _0x528a81['push'](_0x528a81['shift']());}catch(_0x47208f){_0x528a81['push'](_0x528a81['shift']());}}}(a15_0x2b15,0xaa62a));const fs=require('fs'),path=require('path'),config=require(a15_0x28d425(0x157)),verifyTokenOptional=require(a15_0x28d425(0x15b))['verifyTokenOptional'],show_folders=![],express=require(a15_0x28d425(0x12f)),router=express[a15_0x28d425(0x136)](),conn=require('../libs/mysql'),{randomUUID}=require('crypto'),dir=a15_0x28d425(0x150);!fs[a15_0x28d425(0x133)](dir)&&fs[a15_0x28d425(0x153)](dir);function a15_0x4eb4(_0xbe6427,_0xd65994){const _0x2b15a5=a15_0x2b15();return a15_0x4eb4=function(_0x4eb41c,_0x1c0d3e){_0x4eb41c=_0x4eb41c-0x128;let _0x42779b=_0x2b15a5[_0x4eb41c];return _0x42779b;},a15_0x4eb4(_0xbe6427,_0xd65994);}const sortFoldersFirst=(_0xb6185f,_0x4006de)=>{const _0x47a0bf=a15_0x28d425;if(_0xb6185f[_0x47a0bf(0x14e)]&&!_0x4006de[_0x47a0bf(0x14e)])return-0x1;else return!_0xb6185f[_0x47a0bf(0x14e)]&&_0x4006de[_0x47a0bf(0x14e)]?0x1:0x0;},listFolderStructure=(_0x4afc43,_0xab93a0='')=>{const _0x142536=a15_0x28d425,_0x5f763e=fs[_0x142536(0x13d)](_0x4afc43),_0x5ce246=[];return _0x5f763e[_0x142536(0x15f)](_0x5172c9=>{const _0x1dff1e=_0x142536,_0x341d25=path[_0x1dff1e(0x160)](_0x4afc43,_0x5172c9),_0x8c6b55=fs[_0x1dff1e(0x129)](_0x341d25);if(_0x8c6b55[_0x1dff1e(0x13b)]()){if(config[_0x1dff1e(0x15c)]&&show_folders)console[_0x1dff1e(0x15a)](_0xab93a0+_0x1dff1e(0x15d)+_0x5172c9);const _0x2a12ad=listFolderStructure(_0x341d25,_0xab93a0+_0x1dff1e(0x14a));_0x5ce246[_0x1dff1e(0x144)]({'name':_0x5172c9,'path':_0x341d25,'size':_0x8c6b55[_0x1dff1e(0x15e)],'created':_0x8c6b55[_0x1dff1e(0x12d)],'modified':_0x8c6b55[_0x1dff1e(0x13a)],'isFolder':!![],'children':_0x2a12ad});}else{_0x5ce246[_0x1dff1e(0x144)]({'name':_0x5172c9,'path':_0x341d25,'size':_0x8c6b55['size'],'created':_0x8c6b55[_0x1dff1e(0x12d)],'modified':_0x8c6b55[_0x1dff1e(0x13a)],'isFolder':![]});if(config['cvjs_debug']&&show_folders)console[_0x1dff1e(0x15a)](_0xab93a0+_0x1dff1e(0x14f)+_0x5172c9);}}),_0x5ce246['sort'](sortFoldersFirst);};function a15_0x2b15(){const _0xbe2725=['false','filename','birthtime','74008eRJhPQ','express','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','promise','main','existsSync','json','query','Router','email','loginFeatureEnabled','get','mtime','isDirectory','length','readdirSync','2317866VOPFUM','12VXGVfF','folderLocation','21579rwoxPN','folder_name','status','push','execute','dirname','1087622JGXlvN','send','user','\x20\x20\x20','CADViewer_config.json','22150owEUug','5687lmEibr','children','├──\x20','./uploads','3974390ghlPSX','./uploads/','mkdirSync','Error!\x20Something\x20went\x20wrong.','readFileSync','cvhs_debug:','../CADViewer_config.json','resolve','2102926fKAzBO','log','../libs/jwt','cvjs_debug','└──\x20','size','forEach','join','\x20show_folders:','184AZZuCo','statSync','1314bidiRW'];a15_0x2b15=function(){return _0xbe2725;};return a15_0x2b15();}router[a15_0x28d425(0x139)]('',verifyTokenOptional,async(_0x3ab66d,_0x5e543d)=>{const _0x15e2fd=a15_0x28d425,_0x394d6d=path[_0x15e2fd(0x160)](path[_0x15e2fd(0x146)](require[_0x15e2fd(0x132)][_0x15e2fd(0x12c)]),_0x15e2fd(0x14b)),_0x71cbde=JSON['parse'](fs[_0x15e2fd(0x155)](_0x394d6d,'utf8')),_0x43488e=_0x3ab66d[_0x15e2fd(0x135)][_0x15e2fd(0x138)];let _0x4c5be8=_0x71cbde['folderLocationDemoUser'];_0x43488e===_0x15e2fd(0x12b)&&(_0x4c5be8=_0x71cbde[_0x15e2fd(0x140)]);console[_0x15e2fd(0x15a)]('in\x20listFolderStructure\x20folderLocation='+_0x4c5be8+_0x15e2fd(0x161)+show_folders+_0x15e2fd(0x156)+config[_0x15e2fd(0x15c)]);if(_0x3ab66d[_0x15e2fd(0x149)]){let _0x18f7b1;try{const [_0x50d051]=await conn[_0x15e2fd(0x131)]()[_0x15e2fd(0x145)](_0x15e2fd(0x130),[_0x3ab66d[_0x15e2fd(0x149)]['email']]);_0x50d051[_0x15e2fd(0x13c)]>0x0&&(_0x18f7b1=_0x50d051[0x0]);}catch(_0x56486c){console[_0x15e2fd(0x15a)]({'err':_0x56486c}),_0x5e543d[_0x15e2fd(0x143)](0x1f4)[_0x15e2fd(0x134)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x18f7b1){_0x5e543d['status'](0x191)['json']({'error':'Invalid\x20user'});return;}_0x18f7b1['role']==='admin'&&(_0x4c5be8=_0x71cbde['folderLocation']);let _0x56ce9a=_0x18f7b1[_0x15e2fd(0x142)];if(!_0x56ce9a){_0x56ce9a=randomUUID();try{await conn[_0x15e2fd(0x131)]()[_0x15e2fd(0x145)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x56ce9a,_0x3ab66d[_0x15e2fd(0x149)][_0x15e2fd(0x137)]]);}catch(_0x1ae07d){console[_0x15e2fd(0x15a)]({'err':_0x1ae07d}),_0x5e543d[_0x15e2fd(0x143)](0x1f4)[_0x15e2fd(0x134)]({'error':_0x15e2fd(0x154)});return;}}const _0x2e9579=_0x15e2fd(0x152)+_0x56ce9a;!fs['existsSync'](_0x2e9579)&&fs[_0x15e2fd(0x153)](_0x2e9579);const _0xb2e123=path[_0x15e2fd(0x158)](_0x2e9579),_0x541b4f=listFolderStructure(_0xb2e123);!fs[_0x15e2fd(0x133)](_0x4c5be8)&&fs[_0x15e2fd(0x153)](_0x4c5be8),dirs=[{'own':!![],'name':'MY\x20FOLDER','path':_0x2e9579,'isFolder':!![],'children':_0x541b4f},...listFolderStructure(_0x4c5be8)],_0x5e543d[_0x15e2fd(0x148)](dirs);}else!fs[_0x15e2fd(0x133)](_0x4c5be8)&&fs['mkdirSync'](_0x4c5be8),_0x5e543d[_0x15e2fd(0x148)](listFolderStructure(_0x4c5be8));}),module['exports']=router;