const a1_0x2ad44f=a1_0x1fcd;function a1_0x1fcd(_0x44da00,_0x489d13){const _0x51c06d=a1_0x51c0();return a1_0x1fcd=function(_0x1fcdc1,_0x1b0a44){_0x1fcdc1=_0x1fcdc1-0x7c;let _0x1e89fc=_0x51c06d[_0x1fcdc1];return _0x1e89fc;},a1_0x1fcd(_0x44da00,_0x489d13);}(function(_0x59ca33,_0x23381b){const _0x5a258a=a1_0x1fcd,_0x4d9940=_0x59ca33();while(!![]){try{const _0xe3e543=parseInt(_0x5a258a(0x93))/0x1+-parseInt(_0x5a258a(0x99))/0x2+parseInt(_0x5a258a(0x7d))/0x3*(parseInt(_0x5a258a(0x97))/0x4)+-parseInt(_0x5a258a(0x88))/0x5*(-parseInt(_0x5a258a(0xa6))/0x6)+-parseInt(_0x5a258a(0x95))/0x7+-parseInt(_0x5a258a(0xa8))/0x8+parseInt(_0x5a258a(0xa1))/0x9*(parseInt(_0x5a258a(0xb5))/0xa);if(_0xe3e543===_0x23381b)break;else _0x4d9940['push'](_0x4d9940['shift']());}catch(_0x15eb3b){_0x4d9940['push'](_0x4d9940['shift']());}}}(a1_0x51c0,0xb603b));const jwt=require(a1_0x2ad44f(0x84)),bcrypt=require(a1_0x2ad44f(0x7c)),config=require('../CADViewer_config.json'),conn=require('../libs/mysql.js'),multer=require(a1_0x2ad44f(0xb6)),fs=require('fs'),verifyToken=require(a1_0x2ad44f(0x8a))[a1_0x2ad44f(0x9d)];!fs['existsSync']('./avatars')&&fs[a1_0x2ad44f(0x9e)](a1_0x2ad44f(0x8d));function a1_0x51c0(){const _0xcdc44d=['SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','post','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','10HYSgpr','multer','first_name','/login','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','bcrypt','6WIfjOo','last_name','express','avatars/','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','username','jwtSecretKey','jsonwebtoken','file','compare','body','25RqJNVu','Error!\x20Something\x20went\x20wrong.','../libs/jwt','single','hash','./avatars','24h','avatar','diskStorage','avatar_url','status','427386SYyNtX','path','3519803dqwFsI','/update-user-info','2085940aVGJif','execute','144192OINbid','length','promise','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','verifyToken','mkdirSync','/update-password','json','5677884nXhfoB','renameSync','avatars','log','user','676614NsZXyL','exports','10756968FYsUhk','crypto','ServerUrl','email','sign','crypted_password','Invalid\x20password','role','User\x20already\x20exists','Invalid\x20email\x20or\x20password'];a1_0x51c0=function(){return _0xcdc44d;};return a1_0x51c0();}const express=require(a1_0x2ad44f(0x7f)),router=express['Router'](),{randomUUID}=require(a1_0x2ad44f(0xa9)),storage=multer[a1_0x2ad44f(0x90)]({'destination':function(_0x1afdb1,_0x379129,_0x593ec2){const _0x2d7c0b=a1_0x2ad44f;_0x593ec2(null,_0x2d7c0b(0xa3));}}),upload=multer({'storage':storage});router[a1_0x2ad44f(0xb3)](a1_0x2ad44f(0xb8),async(_0x1d09bd,_0xd4c9ad,_0x298668)=>{const _0x137cb0=a1_0x2ad44f;let {email:_0x4f148e,password:_0x5a05b2}=_0x1d09bd[_0x137cb0(0x87)];console['log']({'email':_0x4f148e,'password':_0x5a05b2});let _0x29e4bf;try{const [_0x2db9b7]=await conn['promise']()['execute'](_0x137cb0(0x9c),[_0x4f148e]);_0x2db9b7[_0x137cb0(0x9a)]>0x0&&(_0x29e4bf=_0x2db9b7[0x0]);}catch(_0x42502e){console[_0x137cb0(0xa4)]({'err':_0x42502e}),_0xd4c9ad[_0x137cb0(0x92)](0x1f4)[_0x137cb0(0xa0)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}console[_0x137cb0(0xa4)](_0x29e4bf),console['log'](_0x5a05b2),console[_0x137cb0(0xa4)](_0x29e4bf[_0x137cb0(0xad)]);if(!_0x29e4bf||!await bcrypt[_0x137cb0(0x86)](_0x5a05b2,_0x29e4bf[_0x137cb0(0xad)])){_0xd4c9ad[_0x137cb0(0x92)](0x191)[_0x137cb0(0xa0)]({'error':_0x137cb0(0xb1)});return;}let _0x4ccaf6;try{_0x4ccaf6=jwt[_0x137cb0(0xac)]({'userId':_0x29e4bf['id'],'email':_0x29e4bf['email']},config[_0x137cb0(0x83)],{'expiresIn':_0x137cb0(0x8e)});}catch(_0x48068e){console[_0x137cb0(0xa4)](_0x48068e),_0xd4c9ad[_0x137cb0(0x92)](0x1f4)[_0x137cb0(0xa0)]({'error':_0x137cb0(0x89)});return;}_0xd4c9ad[_0x137cb0(0x92)](0xc8)[_0x137cb0(0xa0)]({'success':!![],'data':{'userId':_0x29e4bf['id'],'username':_0x29e4bf['username'],'first_name':_0x29e4bf[_0x137cb0(0xb7)],'last_name':_0x29e4bf[_0x137cb0(0x7e)],'email':_0x29e4bf[_0x137cb0(0xab)],'avatar_url':_0x29e4bf[_0x137cb0(0x91)],'id':_0x29e4bf['id'],'role':_0x29e4bf[_0x137cb0(0xaf)],'token':_0x4ccaf6}});}),router[a1_0x2ad44f(0xb3)]('/signup',async(_0x49cc1,_0xadead3,_0x1beb4c)=>{const _0x32b32d=a1_0x2ad44f,{username:_0x4405cc,email:_0x10ed95,password:_0x261645}=_0x49cc1[_0x32b32d(0x87)],[_0x3827eb]=await conn[_0x32b32d(0x9b)]()[_0x32b32d(0x98)](_0x32b32d(0x81),[_0x10ed95]);if(_0x3827eb[_0x32b32d(0x9a)]>0x0){_0xadead3[_0x32b32d(0x92)](0x1a6)[_0x32b32d(0xa0)]({'error':_0x32b32d(0xb0)});return;}const _0x31999b=await bcrypt[_0x32b32d(0x8c)](_0x261645,0xa);try{const [_0x332dc3]=await conn[_0x32b32d(0x9b)]()[_0x32b32d(0x98)](_0x32b32d(0xb9),[_0x4405cc,_0x10ed95,_0x31999b,_0x32b32d(0xa5)]);if(_0x332dc3['insertId']){const [_0x57ad25]=await conn[_0x32b32d(0x9b)]()[_0x32b32d(0x98)](_0x32b32d(0xb2),[_0x332dc3['insertId']]);_0x57ad25[_0x32b32d(0x9a)]>0x0&&(newUser=_0x57ad25[0x0]);}}catch{_0xadead3[_0x32b32d(0x92)](0x1f4)[_0x32b32d(0xa0)]({'error':_0x32b32d(0x89)});return;}let _0xd961b8;try{_0xd961b8=jwt[_0x32b32d(0xac)]({'userId':newUser['id'],'email':newUser[_0x32b32d(0xab)]},config[_0x32b32d(0x83)],{'expiresIn':_0x32b32d(0x8e)});}catch(_0x130e20){_0xadead3[_0x32b32d(0x92)](0x1f4)[_0x32b32d(0xa0)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0xadead3['status'](0xc9)[_0x32b32d(0xa0)]({'success':!![],'data':{'userId':newUser['id'],'username':newUser[_0x32b32d(0x82)],'first_name':newUser[_0x32b32d(0xb7)],'last_name':newUser[_0x32b32d(0x7e)],'email':newUser[_0x32b32d(0xab)],'avatar_url':newUser[_0x32b32d(0x91)],'id':newUser['id'],'role':newUser[_0x32b32d(0xaf)],'token':_0xd961b8}});}),router[a1_0x2ad44f(0xb3)](a1_0x2ad44f(0x9f),verifyToken,async(_0x304db5,_0x48b9a4,_0x3578bb)=>{const _0x2efbef=a1_0x2ad44f,{current_password:_0x1b58a2,new_password:_0x457c79}=_0x304db5[_0x2efbef(0x87)];console['log']({'body':_0x304db5[_0x2efbef(0x87)]});const _0x3ceeba=_0x304db5[_0x2efbef(0xa5)][_0x2efbef(0xab)];let _0x329dd2;try{const [_0x120dc7]=await conn['promise']()[_0x2efbef(0x98)](_0x2efbef(0x81),[_0x3ceeba]);if(_0x120dc7[_0x2efbef(0x9a)]>0x0){_0x329dd2=_0x120dc7[0x0];if(!await bcrypt[_0x2efbef(0x86)](_0x1b58a2,_0x329dd2[_0x2efbef(0xad)])){_0x48b9a4[_0x2efbef(0x92)](0x191)[_0x2efbef(0xa0)]({'error':_0x2efbef(0xae)});return;}const _0x484976=await bcrypt['hash'](_0x457c79,0xa);await conn[_0x2efbef(0x9b)]()[_0x2efbef(0x98)]('UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x484976,_0x3ceeba]),_0x48b9a4[_0x2efbef(0x92)](0xc8)['json']({'success':!![]});}}catch(_0x5501c0){console[_0x2efbef(0xa4)]({'err':_0x5501c0}),_0x48b9a4['status'](0x1f4)[_0x2efbef(0xa0)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router[a1_0x2ad44f(0xb3)](a1_0x2ad44f(0x96),upload[a1_0x2ad44f(0x8b)](a1_0x2ad44f(0x8f)),verifyToken,async(_0x185499,_0x7640f3,_0x30e69f)=>{const _0xc1ae78=a1_0x2ad44f,{username:_0x170835,first_name:_0x2d57ac,last_name:_0x49e3f4}=_0x185499[_0xc1ae78(0x87)],_0x3ec810=_0x185499[_0xc1ae78(0xa5)]['email'];let _0x1811c9;try{const [_0x390336]=await conn['promise']()[_0xc1ae78(0x98)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x3ec810]);_0x390336['length']>0x0&&(_0x1811c9=_0x390336[0x0]);}catch(_0x5ae5dd){console[_0xc1ae78(0xa4)]({'err':_0x5ae5dd}),_0x7640f3[_0xc1ae78(0x92)](0x1f4)['json']({'error':_0xc1ae78(0x89)});return;}if(!_0x1811c9){_0x7640f3[_0xc1ae78(0x92)](0x191)['json']({'error':'Invalid\x20user'});return;}console[_0xc1ae78(0xa4)]({'req':_0x185499[_0xc1ae78(0x87)]});let _0x226277=_0x1811c9[_0xc1ae78(0x91)];if(_0x185499['file']){const _0x3dc672=_0xc1ae78(0x80)+randomUUID()+'.png';fs[_0xc1ae78(0xa2)](_0x185499[_0xc1ae78(0x85)][_0xc1ae78(0x94)],'./'+_0x3dc672),_0x226277=config[_0xc1ae78(0xaa)]+'/'+_0x3dc672;}try{await conn[_0xc1ae78(0x9b)]()[_0xc1ae78(0x98)](_0xc1ae78(0xb4),[_0x170835,_0x2d57ac,_0x49e3f4,_0x226277,_0x3ec810]);let _0x3d4ce1;try{_0x3d4ce1=jwt[_0xc1ae78(0xac)]({'userId':_0x1811c9['id'],'email':_0x1811c9[_0xc1ae78(0xab)]},config['jwtSecretKey'],{'expiresIn':_0xc1ae78(0x8e)});}catch(_0x43d0af){console[_0xc1ae78(0xa4)](_0x43d0af),_0x7640f3[_0xc1ae78(0x92)](0x1f4)['json']({'error':_0xc1ae78(0x89)});return;}_0x7640f3[_0xc1ae78(0x92)](0xc8)[_0xc1ae78(0xa0)]({'success':!![],'data':{'userId':_0x1811c9['id'],'username':_0x170835,'first_name':_0x2d57ac,'last_name':_0x49e3f4,'email':_0x1811c9[_0xc1ae78(0xab)],'avatar_url':_0x226277,'token':_0x3d4ce1}});}catch(_0xae5cc8){console[_0xc1ae78(0xa4)]({'err':_0xae5cc8}),_0x7640f3[_0xc1ae78(0x92)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module[a1_0x2ad44f(0xa7)]=router;