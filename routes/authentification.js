function a1_0x39c7(){const _0x3c2980=['log','ServerUrl','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)','execute','path','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','promise','/update-password','.png','length','avatar_url','frontendUrl','insertId','Invalid\x20password','../libs/jwt','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','Error!\x20Something\x20went\x20wrong.','<p>Welcome\x20to\x20CADViewer</p>','Invalid\x20user','message','Invalid\x20email\x20or\x20password','Welcome\x20to\x20CADViewer','file','express','User\x20already\x20exists','/login','./avatars','8rbxjYS','44avsXAt','4093662jgcZMo','sign','single','261DheOBx','2190190mAiWXH','24h','multer','1IAgNRd','compare','mkdirSync','../libs/mysql.js','last_name','transporter','jsonwebtoken','exports','renameSync','username','crypted_password','stack','../CADViewer_config.json','body','avatar','5571848mZqDpX','jwtSecretKey','status','2118915BQYsru','email','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','Router','hash','/validate-email/','role','first_name','7SJveEq','existsSync','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','avatars/','verifyToken','Email\x20validated\x20successfully','1164146GPFUos','enableEmailVerification','/update-user-info','===================error===================','json','post','/signup','user','3071352cshLeB','../libs/mail','53160PbPvYr','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20'];a1_0x39c7=function(){return _0x3c2980;};return a1_0x39c7();}function a1_0x281d(_0x5d0f6d,_0xfea14b){const _0x39c721=a1_0x39c7();return a1_0x281d=function(_0x281d0a,_0x56908a){_0x281d0a=_0x281d0a-0x185;let _0x30c5f2=_0x39c721[_0x281d0a];return _0x30c5f2;},a1_0x281d(_0x5d0f6d,_0xfea14b);}const a1_0x1d5c14=a1_0x281d;(function(_0x5b4e1e,_0x2412e4){const _0x3fbebc=a1_0x281d,_0x34d857=_0x5b4e1e();while(!![]){try{const _0x2e378d=parseInt(_0x3fbebc(0x193))/0x1*(parseInt(_0x3fbebc(0x1b3))/0x2)+-parseInt(_0x3fbebc(0x1a5))/0x3+parseInt(_0x3fbebc(0x18a))/0x4*(parseInt(_0x3fbebc(0x190))/0x5)+-parseInt(_0x3fbebc(0x18c))/0x6+-parseInt(_0x3fbebc(0x1ad))/0x7*(parseInt(_0x3fbebc(0x1a2))/0x8)+-parseInt(_0x3fbebc(0x18f))/0x9*(-parseInt(_0x3fbebc(0x1bd))/0xa)+-parseInt(_0x3fbebc(0x18b))/0xb*(-parseInt(_0x3fbebc(0x1bb))/0xc);if(_0x2e378d===_0x2412e4)break;else _0x34d857['push'](_0x34d857['shift']());}catch(_0x1b0c45){_0x34d857['push'](_0x34d857['shift']());}}}(a1_0x39c7,0x8687a));const jwt=require(a1_0x1d5c14(0x199)),bcrypt=require('bcrypt'),config=require(a1_0x1d5c14(0x19f)),conn=require(a1_0x1d5c14(0x196)),multer=require(a1_0x1d5c14(0x192)),fs=require('fs'),verifyToken=require(a1_0x1d5c14(0x1cd))[a1_0x1d5c14(0x1b1)];!fs[a1_0x1d5c14(0x1ae)](a1_0x1d5c14(0x189))&&fs[a1_0x1d5c14(0x195)](a1_0x1d5c14(0x189));const express=require(a1_0x1d5c14(0x186)),router=express[a1_0x1d5c14(0x1a8)](),{randomUUID}=require('crypto'),storage=multer['diskStorage']({'destination':function(_0x295777,_0x2d0adb,_0x1e07cf){_0x1e07cf(null,'avatars');}}),upload=multer({'storage':storage});router[a1_0x1d5c14(0x1b8)](a1_0x1d5c14(0x188),async(_0x28e7e7,_0xb859a8,_0x21481c)=>{const _0x2da585=a1_0x1d5c14;let {email:_0x5ee9d6,password:_0x3e3064}=_0x28e7e7[_0x2da585(0x1a0)];console[_0x2da585(0x1bf)]({'email':_0x5ee9d6,'password':_0x3e3064});let _0x33672a;try{const [_0x5e5531]=await conn[_0x2da585(0x1c5)]()[_0x2da585(0x1c2)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?',[_0x5ee9d6]);_0x5e5531[_0x2da585(0x1c8)]>0x0&&(_0x33672a=_0x5e5531[0x0]);}catch(_0xc65731){console[_0x2da585(0x1bf)]({'err':_0xc65731}),_0xb859a8[_0x2da585(0x1a4)](0x1f4)[_0x2da585(0x1b7)]({'error':_0x2da585(0x1d2)});return;}if(!_0x33672a||!await bcrypt['compare'](_0x3e3064,_0x33672a?.[_0x2da585(0x19d)])){_0xb859a8['status'](0x191)['json']({'error':_0x2da585(0x1d6)});return;}let _0xb59249;try{_0xb59249=jwt[_0x2da585(0x18d)]({'userId':_0x33672a['id'],'email':_0x33672a[_0x2da585(0x1a6)]},config[_0x2da585(0x1a3)],{'expiresIn':_0x2da585(0x191)});}catch(_0x1e1cec){console['log'](_0x1e1cec),_0xb859a8[_0x2da585(0x1a4)](0x1f4)['json']({'error':_0x2da585(0x1d2)});return;}_0xb859a8[_0x2da585(0x1a4)](0xc8)[_0x2da585(0x1b7)]({'success':!![],'data':{'userId':_0x33672a['id'],'username':_0x33672a['username'],'first_name':_0x33672a[_0x2da585(0x1ac)],'last_name':_0x33672a['last_name'],'email':_0x33672a[_0x2da585(0x1a6)],'avatar_url':_0x33672a[_0x2da585(0x1c9)],'id':_0x33672a['id'],'role':_0x33672a[_0x2da585(0x1ab)],'token':_0xb59249}});}),router[a1_0x1d5c14(0x1b8)](a1_0x1d5c14(0x1b9),async(_0x23fb0e,_0xde9bf6,_0x17fc4a)=>{const _0x28443e=a1_0x1d5c14,{username:_0xd0ffed,email:_0x8f0587,password:_0x4429a6}=_0x23fb0e['body'],[_0x12e4db]=await conn[_0x28443e(0x1c5)]()['execute'](_0x28443e(0x1d0),[_0x8f0587]);if(_0x12e4db[_0x28443e(0x1c8)]>0x0){_0xde9bf6[_0x28443e(0x1a4)](0x1a6)[_0x28443e(0x1b7)]({'error':_0x28443e(0x187)});return;}const _0x44f5a9=await bcrypt[_0x28443e(0x1a9)](_0x4429a6,0xa);let _0x2dbc90=null,_0x3a35a3=0x1;config['enableEmailVerification']&&(_0x2dbc90=randomUUID(),_0x3a35a3=0x0);let _0x1e22e9;try{const _0x4bca4d=randomUUID(),_0x5ab961='./uploads/'+_0x4bca4d;fs[_0x28443e(0x195)](_0x5ab961);const [_0x468255]=await conn['promise']()[_0x28443e(0x1c2)](_0x28443e(0x1c1),[_0xd0ffed,_0x8f0587,_0x44f5a9,'demo_user',_0x3a35a3,_0x2dbc90,_0x4bca4d]);if(_0x468255[_0x28443e(0x1cb)]){const [_0x173d0e]=await conn[_0x28443e(0x1c5)]()['execute'](_0x28443e(0x1ce),[_0x468255[_0x28443e(0x1cb)]]);_0x173d0e['length']>0x0&&(_0x1e22e9=_0x173d0e[0x0]);}}catch{_0xde9bf6[_0x28443e(0x1a4)](0x1f4)[_0x28443e(0x1b7)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x4931e5;try{_0x4931e5=jwt['sign']({'userId':_0x1e22e9['id'],'email':_0x1e22e9[_0x28443e(0x1a6)]},config[_0x28443e(0x1a3)],{'expiresIn':_0x28443e(0x191)});}catch(_0x5b9b4f){_0xde9bf6[_0x28443e(0x1a4)](0x1f4)[_0x28443e(0x1b7)]({'error':_0x28443e(0x1d2)});return;}const _0xcaaba4=require(_0x28443e(0x1bc))[_0x28443e(0x198)];let _0x430acb=_0x28443e(0x1d3);if(config[_0x28443e(0x1b4)]){const _0x2b0d4f=config[_0x28443e(0x1ca)]+_0x28443e(0x1aa)+_0x2dbc90;_0x430acb=_0x28443e(0x1c4)+_0x2b0d4f+'\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>'+_0x2b0d4f+_0x28443e(0x1be);const _0x1648db={'from':config['smtpFrom'],'to':_0x1e22e9[_0x28443e(0x1a6)],'subject':'Welcome\x20to\x20CADViewer','text':_0x28443e(0x1d7),'html':_0x430acb};try{await _0xcaaba4['sendMail'](_0x1648db);}catch(_0x533b64){console[_0x28443e(0x1bf)](_0x28443e(0x1b6)),console[_0x28443e(0x1bf)](_0x533b64),_0xde9bf6['status'](0x1f4)[_0x28443e(0x1b7)]({'error':_0x28443e(0x1a7),'stack':_0x533b64[_0x28443e(0x19e)],'message':_0x533b64[_0x28443e(0x1d5)]});return;}_0xde9bf6[_0x28443e(0x1a4)](0xc8)['json']({'success':!![],'message':'Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account'});return;}_0xde9bf6[_0x28443e(0x1a4)](0xc9)[_0x28443e(0x1b7)]({'success':!![],'data':{'userId':_0x1e22e9['id'],'username':_0x1e22e9[_0x28443e(0x19c)],'first_name':_0x1e22e9['first_name'],'last_name':_0x1e22e9[_0x28443e(0x197)],'email':_0x1e22e9[_0x28443e(0x1a6)],'avatar_url':_0x1e22e9['avatar_url'],'id':_0x1e22e9['id'],'role':_0x1e22e9[_0x28443e(0x1ab)],'token':_0x4931e5,'is_enabled':_0x1e22e9['is_enabled']}});}),router['post']('/validate-email/:token',async(_0x2dd285,_0x1f36e0)=>{const _0x5ed5c2=a1_0x1d5c14;try{const {token:_0x395a9}=_0x2dd285['params'],[_0x5cbe88]=await conn['promise']()['execute'](_0x5ed5c2(0x1af),[_0x395a9]);if(_0x5cbe88['length']===0x0){_0x1f36e0[_0x5ed5c2(0x1a4)](0x194)['json']({'error':'Invalid\x20validation\x20token'});return;}await conn[_0x5ed5c2(0x1c5)]()[_0x5ed5c2(0x1c2)]('UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?',[_0x395a9]);const _0x4858f6=jwt[_0x5ed5c2(0x18d)]({'id':_0x5cbe88[0x0]['id'],'email':_0x5cbe88[0x0][_0x5ed5c2(0x1a6)]},config[_0x5ed5c2(0x1a3)],{'expiresIn':_0x5ed5c2(0x191)});_0x1f36e0[_0x5ed5c2(0x1a4)](0xc8)[_0x5ed5c2(0x1b7)]({'success':!![],'message':_0x5ed5c2(0x1b2),'data':{'userId':_0x5cbe88[0x0]['id'],'username':_0x5cbe88[0x0][_0x5ed5c2(0x19c)],'first_name':_0x5cbe88[0x0][_0x5ed5c2(0x1ac)],'last_name':_0x5cbe88[0x0][_0x5ed5c2(0x197)],'email':_0x5cbe88[0x0][_0x5ed5c2(0x1a6)],'avatar_url':_0x5cbe88[0x0]['avatar_url'],'id':_0x5cbe88[0x0]['id'],'role':_0x5cbe88[0x0][_0x5ed5c2(0x1ab)],'token':_0x4858f6,'is_enabled':0x1}});}catch(_0x39cf19){console[_0x5ed5c2(0x1bf)](_0x5ed5c2(0x1b6)),console['log'](_0x39cf19),_0x1f36e0[_0x5ed5c2(0x1a4)](0x1f4)[_0x5ed5c2(0x1b7)]({'error':_0x5ed5c2(0x1d2),'stack':_0x39cf19['stack'],'message':_0x39cf19[_0x5ed5c2(0x1d5)]});}}),router[a1_0x1d5c14(0x1b8)](a1_0x1d5c14(0x1c6),verifyToken,async(_0x2c60fe,_0xc97fc5,_0x41eaf1)=>{const _0x577d51=a1_0x1d5c14,{current_password:_0x17b9a3,new_password:_0x38c3d1}=_0x2c60fe[_0x577d51(0x1a0)];console[_0x577d51(0x1bf)]({'body':_0x2c60fe[_0x577d51(0x1a0)]});const _0x1d6006=_0x2c60fe[_0x577d51(0x1ba)][_0x577d51(0x1a6)];let _0x1b53a4;try{const [_0x5cb473]=await conn[_0x577d51(0x1c5)]()[_0x577d51(0x1c2)](_0x577d51(0x1d0),[_0x1d6006]);if(_0x5cb473['length']>0x0){_0x1b53a4=_0x5cb473[0x0];if(!await bcrypt[_0x577d51(0x194)](_0x17b9a3,_0x1b53a4[_0x577d51(0x19d)])){_0xc97fc5[_0x577d51(0x1a4)](0x191)[_0x577d51(0x1b7)]({'error':_0x577d51(0x1cc)});return;}const _0x14c610=await bcrypt[_0x577d51(0x1a9)](_0x38c3d1,0xa);await conn[_0x577d51(0x1c5)]()[_0x577d51(0x1c2)](_0x577d51(0x1cf),[_0x14c610,_0x1d6006]),_0xc97fc5[_0x577d51(0x1a4)](0xc8)[_0x577d51(0x1b7)]({'success':!![]});}}catch(_0x15885c){console['log']({'err':_0x15885c}),_0xc97fc5['status'](0x1f4)[_0x577d51(0x1b7)]({'error':_0x577d51(0x1d2)});return;}}),router[a1_0x1d5c14(0x1b8)](a1_0x1d5c14(0x1b5),upload[a1_0x1d5c14(0x18e)](a1_0x1d5c14(0x1a1)),verifyToken,async(_0x3d8af3,_0x9f020d,_0x369056)=>{const _0x4d9c15=a1_0x1d5c14,{username:_0x1101b7,first_name:_0x4da50b,last_name:_0x175c3e}=_0x3d8af3[_0x4d9c15(0x1a0)],_0xac168c=_0x3d8af3['user'][_0x4d9c15(0x1a6)];let _0x2c9696;try{const [_0x292c8d]=await conn[_0x4d9c15(0x1c5)]()[_0x4d9c15(0x1c2)](_0x4d9c15(0x1d0),[_0xac168c]);_0x292c8d[_0x4d9c15(0x1c8)]>0x0&&(_0x2c9696=_0x292c8d[0x0]);}catch(_0x2f4ec7){console[_0x4d9c15(0x1bf)]({'err':_0x2f4ec7}),_0x9f020d[_0x4d9c15(0x1a4)](0x1f4)[_0x4d9c15(0x1b7)]({'error':_0x4d9c15(0x1d2)});return;}if(!_0x2c9696){_0x9f020d[_0x4d9c15(0x1a4)](0x191)[_0x4d9c15(0x1b7)]({'error':_0x4d9c15(0x1d4)});return;}console[_0x4d9c15(0x1bf)]({'req':_0x3d8af3[_0x4d9c15(0x1a0)]});let _0x24267d=_0x2c9696[_0x4d9c15(0x1c9)];if(_0x3d8af3[_0x4d9c15(0x185)]){const _0x137975=_0x4d9c15(0x1b0)+randomUUID()+_0x4d9c15(0x1c7);fs[_0x4d9c15(0x19b)](_0x3d8af3['file'][_0x4d9c15(0x1c3)],'./'+_0x137975),_0x24267d=config[_0x4d9c15(0x1c0)]+'/'+_0x137975;}try{await conn[_0x4d9c15(0x1c5)]()['execute'](_0x4d9c15(0x1d1),[_0x1101b7,_0x4da50b,_0x175c3e,_0x24267d,_0xac168c]);let _0x15c812;try{_0x15c812=jwt[_0x4d9c15(0x18d)]({'userId':_0x2c9696['id'],'email':_0x2c9696['email']},config[_0x4d9c15(0x1a3)],{'expiresIn':_0x4d9c15(0x191)});}catch(_0x4d7e48){console[_0x4d9c15(0x1bf)](_0x4d7e48),_0x9f020d['status'](0x1f4)['json']({'error':_0x4d9c15(0x1d2)});return;}_0x9f020d[_0x4d9c15(0x1a4)](0xc8)[_0x4d9c15(0x1b7)]({'success':!![],'data':{'userId':_0x2c9696['id'],'username':_0x1101b7,'first_name':_0x4da50b,'last_name':_0x175c3e,'email':_0x2c9696[_0x4d9c15(0x1a6)],'avatar_url':_0x24267d,'token':_0x15c812}});}catch(_0x27cef9){console[_0x4d9c15(0x1bf)]({'err':_0x27cef9}),_0x9f020d['status'](0x1f4)[_0x4d9c15(0x1b7)]({'error':_0x4d9c15(0x1d2)});return;}}),module[a1_0x1d5c14(0x19a)]=router;