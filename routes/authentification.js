const a1_0x193b41=a1_0x33be;(function(_0x3f9cee,_0xf41ddf){const _0x186569=a1_0x33be,_0x12a47c=_0x3f9cee();while(!![]){try{const _0x558bd6=-parseInt(_0x186569(0xcc))/0x1+-parseInt(_0x186569(0xd0))/0x2*(-parseInt(_0x186569(0xcf))/0x3)+-parseInt(_0x186569(0xf1))/0x4+parseInt(_0x186569(0xf5))/0x5+-parseInt(_0x186569(0x108))/0x6*(-parseInt(_0x186569(0xdf))/0x7)+-parseInt(_0x186569(0xda))/0x8+parseInt(_0x186569(0xd7))/0x9;if(_0x558bd6===_0xf41ddf)break;else _0x12a47c['push'](_0x12a47c['shift']());}catch(_0x3f2c7a){_0x12a47c['push'](_0x12a47c['shift']());}}}(a1_0x4d47,0xece3b));const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x193b41(0x107)),config=require(a1_0x193b41(0x10d)),conn=require(a1_0x193b41(0xfa)),multer=require(a1_0x193b41(0x109)),fs=require('fs'),verifyToken=require(a1_0x193b41(0x105))[a1_0x193b41(0xcd)];function a1_0x4d47(){const _0x283bb5=['./avatars','execute','.png','Invalid\x20password','avatar','/validate-email/:token','last_name','crypted_password','2125080uJefJy','Error!\x20Something\x20went\x20wrong.','enableEmailVerification','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','3779380IzbhaD','Router','file','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','express','../libs/mysql.js','message','transporter','sendMail','body','avatar_url','../libs/mail','/validate-email/','exports','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','log','../libs/jwt','hash','bcrypt','108utxNar','multer','params','<p>Welcome\x20to\x20CADViewer</p>','smtpFrom','../CADViewer_config.json','Invalid\x20email\x20or\x20password','./uploads/','compare','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','username','/login','Email\x20validated\x20successfully','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','role','User\x20already\x20exists','diskStorage','email','json','promise','is_enabled','first_name','single','jwtSecretKey','567774rZHhEO','verifyToken','length','416868IRYHHS','22jjpKTw','status','sign','mkdirSync','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','24h','/signup','11414916fwPizh','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','user','14830648TbunTm','frontendUrl','post','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','Invalid\x20user','144067newYtj','insertId','stack','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','avatars/','Welcome\x20to\x20CADViewer','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)','===================error===================','Invalid\x20validation\x20token','existsSync'];a1_0x4d47=function(){return _0x283bb5;};return a1_0x4d47();}!fs[a1_0x193b41(0xe8)](a1_0x193b41(0xe9))&&fs['mkdirSync'](a1_0x193b41(0xe9));const express=require(a1_0x193b41(0xf9)),router=express[a1_0x193b41(0xf6)](),{randomUUID}=require('crypto'),storage=multer[a1_0x193b41(0x118)]({'destination':function(_0x4facb5,_0x1016b8,_0x3375e5){_0x3375e5(null,'avatars');}}),upload=multer({'storage':storage});function a1_0x33be(_0x5d8194,_0x175691){const _0x4d4733=a1_0x4d47();return a1_0x33be=function(_0x33bec5,_0xcf6a40){_0x33bec5=_0x33bec5-0xcc;let _0x33d22e=_0x4d4733[_0x33bec5];return _0x33d22e;},a1_0x33be(_0x5d8194,_0x175691);}router[a1_0x193b41(0xdc)](a1_0x193b41(0x113),async(_0x2921c0,_0x3f8840,_0xba6720)=>{const _0x442c8a=a1_0x193b41;let {email:_0x17293f,password:_0x2373b1}=_0x2921c0['body'];console['log']({'email':_0x17293f,'password':_0x2373b1});let _0x298b62;try{const [_0x5aeff5]=await conn[_0x442c8a(0x11b)]()[_0x442c8a(0xea)](_0x442c8a(0xd4),[_0x17293f]);_0x5aeff5['length']>0x0&&(_0x298b62=_0x5aeff5[0x0]);}catch(_0x1c1c01){console[_0x442c8a(0x104)]({'err':_0x1c1c01}),_0x3f8840['status'](0x1f4)['json']({'error':_0x442c8a(0xf2)});return;}console[_0x442c8a(0x104)](_0x298b62),console[_0x442c8a(0x104)](_0x2373b1),console[_0x442c8a(0x104)](_0x298b62['crypted_password']);if(!_0x298b62||!await bcrypt['compare'](_0x2373b1,_0x298b62[_0x442c8a(0xf0)])){_0x3f8840[_0x442c8a(0xd1)](0x191)['json']({'error':_0x442c8a(0x10e)});return;}let _0xa8af3f;try{_0xa8af3f=jwt[_0x442c8a(0xd2)]({'userId':_0x298b62['id'],'email':_0x298b62[_0x442c8a(0x119)]},config[_0x442c8a(0x11f)],{'expiresIn':_0x442c8a(0xd5)});}catch(_0x539178){console['log'](_0x539178),_0x3f8840['status'](0x1f4)[_0x442c8a(0x11a)]({'error':_0x442c8a(0xf2)});return;}_0x3f8840[_0x442c8a(0xd1)](0xc8)[_0x442c8a(0x11a)]({'success':!![],'data':{'userId':_0x298b62['id'],'username':_0x298b62[_0x442c8a(0x112)],'first_name':_0x298b62[_0x442c8a(0x11d)],'last_name':_0x298b62[_0x442c8a(0xef)],'email':_0x298b62[_0x442c8a(0x119)],'avatar_url':_0x298b62['avatar_url'],'id':_0x298b62['id'],'role':_0x298b62[_0x442c8a(0x116)],'token':_0xa8af3f}});}),router[a1_0x193b41(0xdc)](a1_0x193b41(0xd6),async(_0x3ef5f6,_0x5253fd,_0x44bdf7)=>{const _0x441487=a1_0x193b41,{username:_0x304aec,email:_0x2d68bc,password:_0x165641}=_0x3ef5f6['body'],[_0x58b6bd]=await conn[_0x441487(0x11b)]()['execute'](_0x441487(0x111),[_0x2d68bc]);if(_0x58b6bd[_0x441487(0xce)]>0x0){_0x5253fd[_0x441487(0xd1)](0x1a6)['json']({'error':_0x441487(0x117)});return;}const _0x55c5d5=await bcrypt[_0x441487(0x106)](_0x165641,0xa);let _0x39944c=null,_0x1dc7c2=0x1;config[_0x441487(0xf3)]&&(_0x39944c=randomUUID(),_0x1dc7c2=0x0);let _0x17c1f9;try{const _0x290d4e=randomUUID(),_0x332d17=_0x441487(0x10f)+_0x290d4e;fs[_0x441487(0xd3)](_0x332d17);const [_0x5ea60a]=await conn[_0x441487(0x11b)]()[_0x441487(0xea)](_0x441487(0xe5),[_0x304aec,_0x2d68bc,_0x55c5d5,'demo_user',_0x1dc7c2,_0x39944c,_0x290d4e]);if(_0x5ea60a['insertId']){const [_0x4fe6f6]=await conn[_0x441487(0x11b)]()[_0x441487(0xea)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0x5ea60a[_0x441487(0xe0)]]);_0x4fe6f6['length']>0x0&&(_0x17c1f9=_0x4fe6f6[0x0]);}}catch{_0x5253fd[_0x441487(0xd1)](0x1f4)[_0x441487(0x11a)]({'error':_0x441487(0xf2)});return;}let _0x115124;try{_0x115124=jwt[_0x441487(0xd2)]({'userId':_0x17c1f9['id'],'email':_0x17c1f9['email']},config[_0x441487(0x11f)],{'expiresIn':_0x441487(0xd5)});}catch(_0x2027b5){_0x5253fd[_0x441487(0xd1)](0x1f4)[_0x441487(0x11a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}const _0x479c53=require(_0x441487(0x100))[_0x441487(0xfc)];let _0x4cdad5=_0x441487(0x10b);if(config['enableEmailVerification']){const _0x39da38=config[_0x441487(0xdb)]+_0x441487(0x101)+_0x39944c;_0x4cdad5=_0x441487(0xf8)+_0x39da38+'\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>'+_0x39da38+_0x441487(0xdd);const _0x5b42b6={'from':config[_0x441487(0x10c)],'to':_0x17c1f9[_0x441487(0x119)],'subject':_0x441487(0xe4),'text':_0x441487(0xe4),'html':_0x4cdad5};try{await _0x479c53[_0x441487(0xfd)](_0x5b42b6);}catch(_0x5d89ca){console[_0x441487(0x104)](_0x441487(0xe6)),console[_0x441487(0x104)](_0x5d89ca),_0x5253fd[_0x441487(0xd1)](0x1f4)[_0x441487(0x11a)]({'error':_0x441487(0xf4),'stack':_0x5d89ca[_0x441487(0xe1)],'message':_0x5d89ca['message']});return;}_0x5253fd['status'](0xc8)['json']({'success':!![],'message':_0x441487(0x103)});return;}_0x5253fd[_0x441487(0xd1)](0xc9)[_0x441487(0x11a)]({'success':!![],'data':{'userId':_0x17c1f9['id'],'username':_0x17c1f9['username'],'first_name':_0x17c1f9[_0x441487(0x11d)],'last_name':_0x17c1f9[_0x441487(0xef)],'email':_0x17c1f9[_0x441487(0x119)],'avatar_url':_0x17c1f9['avatar_url'],'id':_0x17c1f9['id'],'role':_0x17c1f9['role'],'token':_0x115124,'is_enabled':_0x17c1f9[_0x441487(0x11c)]}});}),router[a1_0x193b41(0xdc)](a1_0x193b41(0xee),async(_0x1272f8,_0x4f57e7)=>{const _0x19898a=a1_0x193b41;try{const {token:_0x4a37fb}=_0x1272f8[_0x19898a(0x10a)],[_0x358037]=await conn[_0x19898a(0x11b)]()['execute'](_0x19898a(0xd8),[_0x4a37fb]);if(_0x358037[_0x19898a(0xce)]===0x0){_0x4f57e7[_0x19898a(0xd1)](0x194)[_0x19898a(0x11a)]({'error':_0x19898a(0xe7)});return;}await conn['promise']()['execute'](_0x19898a(0xe2),[_0x4a37fb]);const _0x4e9452=jwt[_0x19898a(0xd2)]({'id':_0x358037[0x0]['id'],'email':_0x358037[0x0][_0x19898a(0x119)]},config[_0x19898a(0x11f)],{'expiresIn':_0x19898a(0xd5)});_0x4f57e7['status'](0xc8)[_0x19898a(0x11a)]({'success':!![],'message':_0x19898a(0x114),'data':{'userId':_0x358037[0x0]['id'],'username':_0x358037[0x0][_0x19898a(0x112)],'first_name':_0x358037[0x0]['first_name'],'last_name':_0x358037[0x0][_0x19898a(0xef)],'email':_0x358037[0x0][_0x19898a(0x119)],'avatar_url':_0x358037[0x0][_0x19898a(0xff)],'id':_0x358037[0x0]['id'],'role':_0x358037[0x0][_0x19898a(0x116)],'token':_0x4e9452,'is_enabled':0x1}});}catch(_0x2d84ab){console[_0x19898a(0x104)]('===================error==================='),console[_0x19898a(0x104)](_0x2d84ab),_0x4f57e7[_0x19898a(0xd1)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.','stack':_0x2d84ab['stack'],'message':_0x2d84ab[_0x19898a(0xfb)]});}}),router[a1_0x193b41(0xdc)]('/update-password',verifyToken,async(_0x29077a,_0x40596e,_0x3b9cae)=>{const _0x415837=a1_0x193b41,{current_password:_0x1720ef,new_password:_0x914d6}=_0x29077a[_0x415837(0xfe)];console[_0x415837(0x104)]({'body':_0x29077a[_0x415837(0xfe)]});const _0x4b3643=_0x29077a[_0x415837(0xd9)][_0x415837(0x119)];let _0x112bad;try{const [_0x41f81d]=await conn[_0x415837(0x11b)]()['execute'](_0x415837(0x111),[_0x4b3643]);if(_0x41f81d[_0x415837(0xce)]>0x0){_0x112bad=_0x41f81d[0x0];if(!await bcrypt[_0x415837(0x110)](_0x1720ef,_0x112bad[_0x415837(0xf0)])){_0x40596e['status'](0x191)[_0x415837(0x11a)]({'error':_0x415837(0xec)});return;}const _0x2397f8=await bcrypt[_0x415837(0x106)](_0x914d6,0xa);await conn[_0x415837(0x11b)]()['execute'](_0x415837(0x115),[_0x2397f8,_0x4b3643]),_0x40596e[_0x415837(0xd1)](0xc8)['json']({'success':!![]});}}catch(_0x52bcfc){console['log']({'err':_0x52bcfc}),_0x40596e[_0x415837(0xd1)](0x1f4)[_0x415837(0x11a)]({'error':_0x415837(0xf2)});return;}}),router[a1_0x193b41(0xdc)]('/update-user-info',upload[a1_0x193b41(0x11e)](a1_0x193b41(0xed)),verifyToken,async(_0x48c537,_0x32ff52,_0x4f2972)=>{const _0x15051a=a1_0x193b41,{username:_0x3739e6,first_name:_0x3e979d,last_name:_0x4dd200}=_0x48c537[_0x15051a(0xfe)],_0x2bfcab=_0x48c537[_0x15051a(0xd9)][_0x15051a(0x119)];let _0x445363;try{const [_0x2a0f92]=await conn['promise']()['execute'](_0x15051a(0x111),[_0x2bfcab]);_0x2a0f92[_0x15051a(0xce)]>0x0&&(_0x445363=_0x2a0f92[0x0]);}catch(_0x1bc210){console[_0x15051a(0x104)]({'err':_0x1bc210}),_0x32ff52[_0x15051a(0xd1)](0x1f4)[_0x15051a(0x11a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x445363){_0x32ff52[_0x15051a(0xd1)](0x191)[_0x15051a(0x11a)]({'error':_0x15051a(0xde)});return;}console[_0x15051a(0x104)]({'req':_0x48c537['body']});let _0xb9a674=_0x445363['avatar_url'];if(_0x48c537[_0x15051a(0xf7)]){const _0x4f0d74=_0x15051a(0xe3)+randomUUID()+_0x15051a(0xeb);fs['renameSync'](_0x48c537[_0x15051a(0xf7)]['path'],'./'+_0x4f0d74),_0xb9a674=config['ServerUrl']+'/'+_0x4f0d74;}try{await conn[_0x15051a(0x11b)]()[_0x15051a(0xea)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x3739e6,_0x3e979d,_0x4dd200,_0xb9a674,_0x2bfcab]);let _0x37d309;try{_0x37d309=jwt[_0x15051a(0xd2)]({'userId':_0x445363['id'],'email':_0x445363[_0x15051a(0x119)]},config[_0x15051a(0x11f)],{'expiresIn':'24h'});}catch(_0x560327){console[_0x15051a(0x104)](_0x560327),_0x32ff52['status'](0x1f4)[_0x15051a(0x11a)]({'error':_0x15051a(0xf2)});return;}_0x32ff52[_0x15051a(0xd1)](0xc8)[_0x15051a(0x11a)]({'success':!![],'data':{'userId':_0x445363['id'],'username':_0x3739e6,'first_name':_0x3e979d,'last_name':_0x4dd200,'email':_0x445363[_0x15051a(0x119)],'avatar_url':_0xb9a674,'token':_0x37d309}});}catch(_0x27050a){console[_0x15051a(0x104)]({'err':_0x27050a}),_0x32ff52[_0x15051a(0xd1)](0x1f4)['json']({'error':_0x15051a(0xf2)});return;}}),module[a1_0x193b41(0x102)]=router;