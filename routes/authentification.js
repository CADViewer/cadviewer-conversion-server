const a1_0x4729a5=a1_0x2e8c;(function(_0x39ad4c,_0x3f5d2c){const _0x2f3259=a1_0x2e8c,_0x3eab89=_0x39ad4c();while(!![]){try{const _0x1403c9=parseInt(_0x2f3259(0x121))/0x1*(-parseInt(_0x2f3259(0x128))/0x2)+-parseInt(_0x2f3259(0x122))/0x3*(-parseInt(_0x2f3259(0x145))/0x4)+-parseInt(_0x2f3259(0x11c))/0x5*(-parseInt(_0x2f3259(0x14f))/0x6)+parseInt(_0x2f3259(0x118))/0x7*(parseInt(_0x2f3259(0x147))/0x8)+parseInt(_0x2f3259(0x11f))/0x9*(parseInt(_0x2f3259(0x111))/0xa)+parseInt(_0x2f3259(0x12c))/0xb*(-parseInt(_0x2f3259(0x138))/0xc)+-parseInt(_0x2f3259(0x133))/0xd;if(_0x1403c9===_0x3f5d2c)break;else _0x3eab89['push'](_0x3eab89['shift']());}catch(_0x232330){_0x3eab89['push'](_0x3eab89['shift']());}}}(a1_0x18f2,0x3b792));const jwt=require(a1_0x4729a5(0x114)),bcrypt=require('bcrypt'),config=require('../CADViewer_config.json'),conn=require(a1_0x4729a5(0x120)),multer=require(a1_0x4729a5(0x116)),fs=require('fs'),verifyToken=require(a1_0x4729a5(0x143))[a1_0x4729a5(0x117)];!fs['existsSync'](a1_0x4729a5(0x146))&&fs[a1_0x4729a5(0x141)]('./avatars');const express=require(a1_0x4729a5(0x125)),router=express[a1_0x4729a5(0x11a)](),{randomUUID}=require(a1_0x4729a5(0x135)),storage=multer[a1_0x4729a5(0x13f)]({'destination':function(_0x4d951d,_0x24737d,_0x13b6bb){const _0x2db218=a1_0x4729a5;_0x13b6bb(null,_0x2db218(0x137));}}),upload=multer({'storage':storage});function a1_0x18f2(){const _0x34026e=['../libs/mysql.js','1cvegzl','12pPTREj','avatar','last_name','express','avatar_url','Invalid\x20password','191502NMClFG','file','log','user','220748iPgFCg','hash','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','compare','length','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','479544nYjgTl','24h','crypto','username','avatars','168sWDhwB','Invalid\x20user','avatars/','Error!\x20Something\x20went\x20wrong.','/update-password','promise','insertId','diskStorage','/signup','mkdirSync','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','../libs/jwt','role','301844SIwrLI','./avatars','24wmrUNt','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','jwtSecretKey','Invalid\x20email\x20or\x20password','ServerUrl','body','exports','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','6TcJXVY','post','execute','json','first_name','2326690KEvcvi','renameSync','sign','jsonwebtoken','status','multer','verifyToken','133ChqBMR','crypted_password','Router','/update-user-info','613115nhdsTh','email','/login','9MbYTyq'];a1_0x18f2=function(){return _0x34026e;};return a1_0x18f2();}function a1_0x2e8c(_0x204828,_0x3c4c59){const _0x18f271=a1_0x18f2();return a1_0x2e8c=function(_0x2e8caa,_0x3b3b4e){_0x2e8caa=_0x2e8caa-0x111;let _0x9089d4=_0x18f271[_0x2e8caa];return _0x9089d4;},a1_0x2e8c(_0x204828,_0x3c4c59);}router[a1_0x4729a5(0x150)](a1_0x4729a5(0x11e),async(_0x313df0,_0x140d98,_0x37663b)=>{const _0x58a8c5=a1_0x4729a5;let {email:_0xbc4690,password:_0x266e40}=_0x313df0[_0x58a8c5(0x14c)];console['log']({'email':_0xbc4690,'password':_0x266e40});let _0x4095ad;try{const [_0x460d5]=await conn[_0x58a8c5(0x13d)]()['execute'](_0x58a8c5(0x132),[_0xbc4690]);_0x460d5['length']>0x0&&(_0x4095ad=_0x460d5[0x0]);}catch(_0x3a3855){console[_0x58a8c5(0x12a)]({'err':_0x3a3855}),_0x140d98[_0x58a8c5(0x115)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x4095ad||!await bcrypt[_0x58a8c5(0x12f)](_0x266e40,_0x4095ad['crypted_password'])){_0x140d98[_0x58a8c5(0x115)](0x191)[_0x58a8c5(0x152)]({'error':_0x58a8c5(0x14a)});return;}let _0x57e312;try{_0x57e312=jwt[_0x58a8c5(0x113)]({'userId':_0x4095ad['id'],'email':_0x4095ad[_0x58a8c5(0x11d)]},config[_0x58a8c5(0x149)],{'expiresIn':_0x58a8c5(0x134)});}catch(_0x1dc20c){console[_0x58a8c5(0x12a)](_0x1dc20c),_0x140d98[_0x58a8c5(0x115)](0x1f4)[_0x58a8c5(0x152)]({'error':_0x58a8c5(0x13b)});return;}_0x140d98[_0x58a8c5(0x115)](0xc8)[_0x58a8c5(0x152)]({'success':!![],'data':{'userId':_0x4095ad['id'],'username':_0x4095ad[_0x58a8c5(0x136)],'first_name':_0x4095ad[_0x58a8c5(0x153)],'last_name':_0x4095ad[_0x58a8c5(0x124)],'email':_0x4095ad[_0x58a8c5(0x11d)],'avatar_url':_0x4095ad['avatar_url'],'id':_0x4095ad['id'],'role':_0x4095ad[_0x58a8c5(0x144)],'token':_0x57e312}});}),router[a1_0x4729a5(0x150)](a1_0x4729a5(0x140),async(_0x483cd1,_0x1347e3,_0x4c727c)=>{const _0x316d26=a1_0x4729a5,{username:_0x5b17cc,email:_0x3d0135,password:_0x335042}=_0x483cd1['body'],[_0xa59e14]=await conn['promise']()[_0x316d26(0x151)](_0x316d26(0x131),[_0x3d0135]);if(_0xa59e14[_0x316d26(0x130)]>0x0){_0x1347e3[_0x316d26(0x115)](0x1a6)[_0x316d26(0x152)]({'error':'User\x20already\x20exists'});return;}const _0x222ad7=await bcrypt[_0x316d26(0x12d)](_0x335042,0xa);try{const [_0x585c8b]=await conn[_0x316d26(0x13d)]()[_0x316d26(0x151)](_0x316d26(0x148),[_0x5b17cc,_0x3d0135,_0x222ad7,_0x316d26(0x12b)]);if(_0x585c8b[_0x316d26(0x13e)]){const [_0x2d1a06]=await conn['promise']()[_0x316d26(0x151)](_0x316d26(0x14e),[_0x585c8b[_0x316d26(0x13e)]]);_0x2d1a06[_0x316d26(0x130)]>0x0&&(newUser=_0x2d1a06[0x0]);}}catch{_0x1347e3['status'](0x1f4)[_0x316d26(0x152)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0xaf9e4e;try{_0xaf9e4e=jwt[_0x316d26(0x113)]({'userId':newUser['id'],'email':newUser[_0x316d26(0x11d)]},config[_0x316d26(0x149)],{'expiresIn':_0x316d26(0x134)});}catch(_0x29af19){_0x1347e3[_0x316d26(0x115)](0x1f4)[_0x316d26(0x152)]({'error':_0x316d26(0x13b)});return;}_0x1347e3['status'](0xc9)[_0x316d26(0x152)]({'success':!![],'data':{'userId':newUser['id'],'username':newUser[_0x316d26(0x136)],'first_name':newUser[_0x316d26(0x153)],'last_name':newUser['last_name'],'email':newUser[_0x316d26(0x11d)],'avatar_url':newUser[_0x316d26(0x126)],'token':_0xaf9e4e}});}),router[a1_0x4729a5(0x150)](a1_0x4729a5(0x13c),verifyToken,async(_0x18fca7,_0x1fee9f,_0x34e14e)=>{const _0x4db83b=a1_0x4729a5,{current_password:_0x2d5d2e,new_password:_0x3f1d08}=_0x18fca7[_0x4db83b(0x14c)];console['log']({'body':_0x18fca7[_0x4db83b(0x14c)]});const _0x12f527=_0x18fca7[_0x4db83b(0x12b)]['email'];let _0x548f5b;try{const [_0x20c086]=await conn[_0x4db83b(0x13d)]()[_0x4db83b(0x151)](_0x4db83b(0x131),[_0x12f527]);if(_0x20c086['length']>0x0){_0x548f5b=_0x20c086[0x0];if(!await bcrypt[_0x4db83b(0x12f)](_0x2d5d2e,_0x548f5b[_0x4db83b(0x119)])){_0x1fee9f[_0x4db83b(0x115)](0x191)[_0x4db83b(0x152)]({'error':_0x4db83b(0x127)});return;}const _0x5cf64a=await bcrypt[_0x4db83b(0x12d)](_0x3f1d08,0xa);await conn[_0x4db83b(0x13d)]()[_0x4db83b(0x151)](_0x4db83b(0x12e),[_0x5cf64a,_0x12f527]),_0x1fee9f[_0x4db83b(0x115)](0xc8)[_0x4db83b(0x152)]({'success':!![]});}}catch(_0xf1c139){console[_0x4db83b(0x12a)]({'err':_0xf1c139}),_0x1fee9f[_0x4db83b(0x115)](0x1f4)[_0x4db83b(0x152)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router['post'](a1_0x4729a5(0x11b),upload['single'](a1_0x4729a5(0x123)),verifyToken,async(_0x186ddc,_0xa7d5ea,_0x818ac0)=>{const _0x27da24=a1_0x4729a5,{username:_0x585887,first_name:_0x4cf638,last_name:_0x10d062}=_0x186ddc['body'],_0x10fbab=_0x186ddc[_0x27da24(0x12b)][_0x27da24(0x11d)];let _0x3777c7;try{const [_0x2e3d03]=await conn['promise']()['execute'](_0x27da24(0x131),[_0x10fbab]);_0x2e3d03[_0x27da24(0x130)]>0x0&&(_0x3777c7=_0x2e3d03[0x0]);}catch(_0x43ac3f){console[_0x27da24(0x12a)]({'err':_0x43ac3f}),_0xa7d5ea[_0x27da24(0x115)](0x1f4)[_0x27da24(0x152)]({'error':_0x27da24(0x13b)});return;}if(!_0x3777c7){_0xa7d5ea['status'](0x191)['json']({'error':_0x27da24(0x139)});return;}console[_0x27da24(0x12a)]({'req':_0x186ddc[_0x27da24(0x14c)]});let _0x42c900=_0x3777c7[_0x27da24(0x126)];if(_0x186ddc[_0x27da24(0x129)]){const _0x3a8ac6=_0x27da24(0x13a)+randomUUID()+'.png';fs[_0x27da24(0x112)](_0x186ddc[_0x27da24(0x129)]['path'],'./'+_0x3a8ac6),_0x42c900=config[_0x27da24(0x14b)]+'/'+_0x3a8ac6;}try{await conn['promise']()[_0x27da24(0x151)](_0x27da24(0x142),[_0x585887,_0x4cf638,_0x10d062,_0x42c900,_0x10fbab]);let _0x5e7366;try{_0x5e7366=jwt[_0x27da24(0x113)]({'userId':_0x3777c7['id'],'email':_0x3777c7[_0x27da24(0x11d)]},config[_0x27da24(0x149)],{'expiresIn':_0x27da24(0x134)});}catch(_0x28dd72){console[_0x27da24(0x12a)](_0x28dd72),_0xa7d5ea[_0x27da24(0x115)](0x1f4)[_0x27da24(0x152)]({'error':_0x27da24(0x13b)});return;}_0xa7d5ea[_0x27da24(0x115)](0xc8)[_0x27da24(0x152)]({'success':!![],'data':{'userId':_0x3777c7['id'],'username':_0x585887,'first_name':_0x4cf638,'last_name':_0x10d062,'email':_0x3777c7[_0x27da24(0x11d)],'avatar_url':_0x42c900,'token':_0x5e7366}});}catch(_0x2aeeee){console[_0x27da24(0x12a)]({'err':_0x2aeeee}),_0xa7d5ea['status'](0x1f4)[_0x27da24(0x152)]({'error':_0x27da24(0x13b)});return;}}),module[a1_0x4729a5(0x14d)]=router;