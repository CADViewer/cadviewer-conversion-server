const a1_0x53f353=a1_0x53b3;function a1_0x53b3(_0x46d260,_0x39cc7f){const _0x5184a0=a1_0x5184();return a1_0x53b3=function(_0x53b3bd,_0x21e00b){_0x53b3bd=_0x53b3bd-0x122;let _0x239ef8=_0x5184a0[_0x53b3bd];return _0x239ef8;},a1_0x53b3(_0x46d260,_0x39cc7f);}function a1_0x5184(){const _0x3a2560=['verifyToken','avatar','email','1486205Injlgs','893571DRHtov','/signup','966267EuRVqu','crypted_password','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','avatar_url','438000KGwiSA','/update-user-info','mkdirSync','Router','last_name','existsSync','diskStorage','User\x20already\x20exists','1112684jwCxIT','6eMASiG','.png','../libs/mysql.js','status','log','compare','sign','jwtSecretKey','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','insertId','body','json','Invalid\x20user','username','length','Error!\x20Something\x20went\x20wrong.','promise','27380gzbNEg','./avatars','crypto','Invalid\x20email\x20or\x20password','hash','first_name','jsonwebtoken','execute','../libs/jwt','610712urUluW','24h','express','path','role','post','user','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','8oiTyeO','Invalid\x20password','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','ServerUrl'];a1_0x5184=function(){return _0x3a2560;};return a1_0x5184();}(function(_0x521360,_0x369e56){const _0x4a0810=a1_0x53b3,_0xf19d58=_0x521360();while(!![]){try{const _0x10e939=parseInt(_0x4a0810(0x157))/0x1+parseInt(_0x4a0810(0x126))/0x2+parseInt(_0x4a0810(0x151))/0x3*(-parseInt(_0x4a0810(0x149))/0x4)+-parseInt(_0x4a0810(0x138))/0x5*(parseInt(_0x4a0810(0x127))/0x6)+-parseInt(_0x4a0810(0x150))/0x7+parseInt(_0x4a0810(0x141))/0x8+parseInt(_0x4a0810(0x153))/0x9;if(_0x10e939===_0x369e56)break;else _0xf19d58['push'](_0xf19d58['shift']());}catch(_0x1ab0e9){_0xf19d58['push'](_0xf19d58['shift']());}}}(a1_0x5184,0x58ffb));const jwt=require(a1_0x53f353(0x13e)),bcrypt=require('bcrypt'),config=require('../CADViewer_config.json'),conn=require(a1_0x53f353(0x129)),multer=require('multer'),fs=require('fs'),verifyToken=require(a1_0x53f353(0x140))[a1_0x53f353(0x14d)];!fs[a1_0x53f353(0x123)](a1_0x53f353(0x139))&&fs[a1_0x53f353(0x159)](a1_0x53f353(0x139));const express=require(a1_0x53f353(0x143)),router=express[a1_0x53f353(0x15a)](),{randomUUID}=require(a1_0x53f353(0x13a)),storage=multer[a1_0x53f353(0x124)]({'destination':function(_0x201fc7,_0x6c4c34,_0x5aa2f0){_0x5aa2f0(null,'avatars');}}),upload=multer({'storage':storage});router[a1_0x53f353(0x146)]('/login',async(_0x1611d8,_0x45609c,_0x43d6f8)=>{const _0x571006=a1_0x53f353;let {email:_0x4b5368,password:_0x2621ef}=_0x1611d8[_0x571006(0x131)];console[_0x571006(0x12b)]({'email':_0x4b5368,'password':_0x2621ef});let _0xeac45;try{const [_0x18c6cb]=await conn[_0x571006(0x137)]()[_0x571006(0x13f)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?',[_0x4b5368]);_0x18c6cb['length']>0x0&&(_0xeac45=_0x18c6cb[0x0]);}catch(_0x425e35){console[_0x571006(0x12b)]({'err':_0x425e35}),_0x45609c['status'](0x1f4)[_0x571006(0x132)]({'error':_0x571006(0x136)});return;}console['log'](_0xeac45),console[_0x571006(0x12b)](_0x2621ef),console[_0x571006(0x12b)](_0xeac45[_0x571006(0x154)]);if(!_0xeac45||!await bcrypt[_0x571006(0x12c)](_0x2621ef,_0xeac45[_0x571006(0x154)])){_0x45609c['status'](0x191)[_0x571006(0x132)]({'error':_0x571006(0x13b)});return;}let _0x569fd1;try{_0x569fd1=jwt[_0x571006(0x12d)]({'userId':_0xeac45['id'],'email':_0xeac45['email']},config[_0x571006(0x12e)],{'expiresIn':_0x571006(0x142)});}catch(_0x4c087a){console[_0x571006(0x12b)](_0x4c087a),_0x45609c[_0x571006(0x12a)](0x1f4)[_0x571006(0x132)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x45609c['status'](0xc8)[_0x571006(0x132)]({'success':!![],'data':{'userId':_0xeac45['id'],'username':_0xeac45[_0x571006(0x134)],'first_name':_0xeac45['first_name'],'last_name':_0xeac45[_0x571006(0x122)],'email':_0xeac45[_0x571006(0x14f)],'avatar_url':_0xeac45[_0x571006(0x156)],'id':_0xeac45['id'],'role':_0xeac45[_0x571006(0x145)],'token':_0x569fd1}});}),router['post'](a1_0x53f353(0x152),async(_0x19abb7,_0x10d972,_0x1527b3)=>{const _0x14ecfe=a1_0x53f353,{username:_0x4daf22,email:_0x4e8e22,password:_0xaba509}=_0x19abb7[_0x14ecfe(0x131)],[_0x493186]=await conn[_0x14ecfe(0x137)]()['execute'](_0x14ecfe(0x148),[_0x4e8e22]);if(_0x493186['length']>0x0){_0x10d972[_0x14ecfe(0x12a)](0x1a6)['json']({'error':_0x14ecfe(0x125)});return;}const _0x3d1659=await bcrypt[_0x14ecfe(0x13c)](_0xaba509,0xa);try{const [_0x40c495]=await conn[_0x14ecfe(0x137)]()[_0x14ecfe(0x13f)](_0x14ecfe(0x12f),[_0x4daf22,_0x4e8e22,_0x3d1659,_0x14ecfe(0x147)]);if(_0x40c495[_0x14ecfe(0x130)]){const [_0x3cddcf]=await conn[_0x14ecfe(0x137)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0x40c495[_0x14ecfe(0x130)]]);_0x3cddcf[_0x14ecfe(0x135)]>0x0&&(newUser=_0x3cddcf[0x0]);}}catch{_0x10d972['status'](0x1f4)['json']({'error':_0x14ecfe(0x136)});return;}let _0x37701f;try{_0x37701f=jwt[_0x14ecfe(0x12d)]({'userId':newUser['id'],'email':newUser['email']},config[_0x14ecfe(0x12e)],{'expiresIn':_0x14ecfe(0x142)});}catch(_0x2212a4){_0x10d972[_0x14ecfe(0x12a)](0x1f4)[_0x14ecfe(0x132)]({'error':_0x14ecfe(0x136)});return;}_0x10d972[_0x14ecfe(0x12a)](0xc9)[_0x14ecfe(0x132)]({'success':!![],'data':{'userId':newUser['id'],'username':newUser[_0x14ecfe(0x134)],'first_name':newUser[_0x14ecfe(0x13d)],'last_name':newUser[_0x14ecfe(0x122)],'email':newUser[_0x14ecfe(0x14f)],'avatar_url':newUser['avatar_url'],'id':newUser['id'],'role':newUser['role'],'token':_0x37701f}});}),router[a1_0x53f353(0x146)]('/update-password',verifyToken,async(_0x5e7c45,_0x5a526c,_0x529bd6)=>{const _0xfd3cee=a1_0x53f353,{current_password:_0x21dc0b,new_password:_0x3febc8}=_0x5e7c45['body'];console[_0xfd3cee(0x12b)]({'body':_0x5e7c45[_0xfd3cee(0x131)]});const _0x148cf7=_0x5e7c45[_0xfd3cee(0x147)][_0xfd3cee(0x14f)];let _0x5cb72b;try{const [_0x2b84b6]=await conn[_0xfd3cee(0x137)]()[_0xfd3cee(0x13f)](_0xfd3cee(0x148),[_0x148cf7]);if(_0x2b84b6[_0xfd3cee(0x135)]>0x0){_0x5cb72b=_0x2b84b6[0x0];if(!await bcrypt[_0xfd3cee(0x12c)](_0x21dc0b,_0x5cb72b['crypted_password'])){_0x5a526c[_0xfd3cee(0x12a)](0x191)[_0xfd3cee(0x132)]({'error':_0xfd3cee(0x14a)});return;}const _0x14ec69=await bcrypt[_0xfd3cee(0x13c)](_0x3febc8,0xa);await conn[_0xfd3cee(0x137)]()[_0xfd3cee(0x13f)](_0xfd3cee(0x14b),[_0x14ec69,_0x148cf7]),_0x5a526c[_0xfd3cee(0x12a)](0xc8)['json']({'success':!![]});}}catch(_0x1b2059){console['log']({'err':_0x1b2059}),_0x5a526c[_0xfd3cee(0x12a)](0x1f4)[_0xfd3cee(0x132)]({'error':_0xfd3cee(0x136)});return;}}),router[a1_0x53f353(0x146)](a1_0x53f353(0x158),upload['single'](a1_0x53f353(0x14e)),verifyToken,async(_0x27546e,_0xbcbde8,_0x3eba37)=>{const _0x130667=a1_0x53f353,{username:_0x3f20b8,first_name:_0xfc308,last_name:_0x381043}=_0x27546e['body'],_0xc1056d=_0x27546e[_0x130667(0x147)][_0x130667(0x14f)];let _0x25a2c2;try{const [_0x3c5c6c]=await conn[_0x130667(0x137)]()[_0x130667(0x13f)](_0x130667(0x148),[_0xc1056d]);_0x3c5c6c[_0x130667(0x135)]>0x0&&(_0x25a2c2=_0x3c5c6c[0x0]);}catch(_0xf87bf1){console[_0x130667(0x12b)]({'err':_0xf87bf1}),_0xbcbde8['status'](0x1f4)[_0x130667(0x132)]({'error':_0x130667(0x136)});return;}if(!_0x25a2c2){_0xbcbde8['status'](0x191)['json']({'error':_0x130667(0x133)});return;}console[_0x130667(0x12b)]({'req':_0x27546e['body']});let _0x5b4574=_0x25a2c2[_0x130667(0x156)];if(_0x27546e['file']){const _0x35c520='avatars/'+randomUUID()+_0x130667(0x128);fs['renameSync'](_0x27546e['file'][_0x130667(0x144)],'./'+_0x35c520),_0x5b4574=config[_0x130667(0x14c)]+'/'+_0x35c520;}try{await conn[_0x130667(0x137)]()['execute'](_0x130667(0x155),[_0x3f20b8,_0xfc308,_0x381043,_0x5b4574,_0xc1056d]);let _0x274005;try{_0x274005=jwt[_0x130667(0x12d)]({'userId':_0x25a2c2['id'],'email':_0x25a2c2[_0x130667(0x14f)]},config['jwtSecretKey'],{'expiresIn':_0x130667(0x142)});}catch(_0x3a864b){console[_0x130667(0x12b)](_0x3a864b),_0xbcbde8['status'](0x1f4)[_0x130667(0x132)]({'error':_0x130667(0x136)});return;}_0xbcbde8[_0x130667(0x12a)](0xc8)[_0x130667(0x132)]({'success':!![],'data':{'userId':_0x25a2c2['id'],'username':_0x3f20b8,'first_name':_0xfc308,'last_name':_0x381043,'email':_0x25a2c2['email'],'avatar_url':_0x5b4574,'token':_0x274005}});}catch(_0x24e347){console[_0x130667(0x12b)]({'err':_0x24e347}),_0xbcbde8[_0x130667(0x12a)](0x1f4)[_0x130667(0x132)]({'error':_0x130667(0x136)});return;}}),module['exports']=router;