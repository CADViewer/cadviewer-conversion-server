const a1_0x4a724e=a1_0x5a21;function a1_0x7d4b(){const _0x300f8a=['jwtSecretKey','sendMail','bcrypt','first_name','avatars/','transporter','/validate-email/:token','user','ServerUrl','avatar','352ckCYHI','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)','===================error===================','stack','last_name','8769747xINAjm','json','file','Welcome\x20to\x20CADViewer','execute','mkdirSync','express','/update-user-info','role','compare','Invalid\x20email\x20or\x20password','path','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','/validate-email/','copyFileSync','../CADViewer_config.json','single','3356760BmJLIG','Error!\x20Something\x20went\x20wrong.','<p>Welcome\x20to\x20CADViewer</p>','status','verifyToken','690354lGfYCj','post','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','.png','exports','6740432hLauHC','hash','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','is_enabled','message','email','avatars','log','502502yCIuls','promise','./uploads/','demo_user','User\x20already\x20exists','./avatars','body','Invalid\x20user','12KJDxZg','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','enableEmailVerification','Invalid\x20password','crypted_password','198999iOjIIz','avatar_url','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','Invalid\x20validation\x20token','smtpFrom','3721131bGVvtk','Email\x20validated\x20successfully','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','params','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','24h','sign','insertId','length','username'];a1_0x7d4b=function(){return _0x300f8a;};return a1_0x7d4b();}(function(_0x3da5f2,_0x16bc8d){const _0x4610cc=a1_0x5a21,_0x3b244c=_0x3da5f2();while(!![]){try{const _0x1725fd=parseInt(_0x4610cc(0x212))/0x1+parseInt(_0x4610cc(0x205))/0x2+-parseInt(_0x4610cc(0x217))/0x3+-parseInt(_0x4610cc(0x1fd))/0x4+parseInt(_0x4610cc(0x1f3))/0x5*(parseInt(_0x4610cc(0x20d))/0x6)+-parseInt(_0x4610cc(0x231))/0x7+-parseInt(_0x4610cc(0x22c))/0x8*(-parseInt(_0x4610cc(0x1f8))/0x9);if(_0x1725fd===_0x16bc8d)break;else _0x3b244c['push'](_0x3b244c['shift']());}catch(_0x34bc56){_0x3b244c['push'](_0x3b244c['shift']());}}}(a1_0x7d4b,0xf1a10));const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x4a724e(0x224)),config=require(a1_0x4a724e(0x1f1)),conn=require('../libs/mysql.js'),multer=require('multer'),fs=require('fs'),verifyToken=require('../libs/jwt')[a1_0x4a724e(0x1f7)];function a1_0x5a21(_0x12cd94,_0x1cfe0f){const _0x7d4b1f=a1_0x7d4b();return a1_0x5a21=function(_0x5a2144,_0x914d29){_0x5a2144=_0x5a2144-0x1eb;let _0xc2416d=_0x7d4b1f[_0x5a2144];return _0xc2416d;},a1_0x5a21(_0x12cd94,_0x1cfe0f);}!fs['existsSync'](a1_0x4a724e(0x20a))&&fs[a1_0x4a724e(0x236)]('./avatars');const express=require(a1_0x4a724e(0x237)),router=express['Router'](),{randomUUID}=require('crypto'),storage=multer['diskStorage']({'destination':function(_0x341193,_0x3c473a,_0x25837f){const _0x44b86a=a1_0x4a724e;_0x25837f(null,_0x44b86a(0x203));}}),upload=multer({'storage':storage});router[a1_0x4a724e(0x1f9)]('/login',async(_0x10b74e,_0x2d8236,_0x1a54fe)=>{const _0x1f44b3=a1_0x4a724e;let {email:_0x4a1b66,password:_0x5a7b8f}=_0x10b74e[_0x1f44b3(0x20b)];console[_0x1f44b3(0x204)]({'email':_0x4a1b66,'password':_0x5a7b8f});let _0xa600a1;try{const [_0x3f4b71]=await conn[_0x1f44b3(0x206)]()[_0x1f44b3(0x235)](_0x1f44b3(0x1fa),[_0x4a1b66]);_0x3f4b71[_0x1f44b3(0x220)]>0x0&&(_0xa600a1=_0x3f4b71[0x0]);}catch(_0x1c13b3){console['log']({'err':_0x1c13b3}),_0x2d8236['status'](0x1f4)[_0x1f44b3(0x232)]({'error':_0x1f44b3(0x1f4)});return;}if(!_0xa600a1||!await bcrypt[_0x1f44b3(0x1eb)](_0x5a7b8f,_0xa600a1?.[_0x1f44b3(0x211)])){_0x2d8236['status'](0x191)[_0x1f44b3(0x232)]({'error':_0x1f44b3(0x1ec)});return;}let _0x37aa6;try{_0x37aa6=jwt[_0x1f44b3(0x21e)]({'userId':_0xa600a1['id'],'email':_0xa600a1['email']},config[_0x1f44b3(0x222)],{'expiresIn':'24h'});}catch(_0x3e0a62){console['log'](_0x3e0a62),_0x2d8236[_0x1f44b3(0x1f6)](0x1f4)[_0x1f44b3(0x232)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x2d8236[_0x1f44b3(0x1f6)](0xc8)[_0x1f44b3(0x232)]({'success':!![],'data':{'userId':_0xa600a1['id'],'username':_0xa600a1[_0x1f44b3(0x221)],'first_name':_0xa600a1[_0x1f44b3(0x225)],'last_name':_0xa600a1['last_name'],'email':_0xa600a1['email'],'avatar_url':_0xa600a1[_0x1f44b3(0x213)],'id':_0xa600a1['id'],'role':_0xa600a1['role'],'token':_0x37aa6}});}),router[a1_0x4a724e(0x1f9)]('/signup',async(_0x58dbae,_0x1c750d,_0x170404)=>{const _0x1d5cb7=a1_0x4a724e,{username:_0x16cd7f,email:_0x235f0c,password:_0x3ca464}=_0x58dbae[_0x1d5cb7(0x20b)],[_0x335840]=await conn['promise']()[_0x1d5cb7(0x235)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x235f0c]);if(_0x335840[_0x1d5cb7(0x220)]>0x0){_0x1c750d[_0x1d5cb7(0x1f6)](0x1a6)[_0x1d5cb7(0x232)]({'error':_0x1d5cb7(0x209)});return;}const _0x2dc66f=await bcrypt[_0x1d5cb7(0x1fe)](_0x3ca464,0xa);let _0x141d22=null,_0x4c372c=0x1;config[_0x1d5cb7(0x20f)]&&(_0x141d22=randomUUID(),_0x4c372c=0x0);let _0x2261b1;try{const _0x41862b=randomUUID(),_0x37a5a3=_0x1d5cb7(0x207)+_0x41862b;fs[_0x1d5cb7(0x236)](_0x37a5a3);const [_0x5eb1e8]=await conn[_0x1d5cb7(0x206)]()['execute'](_0x1d5cb7(0x22d),[_0x16cd7f,_0x235f0c,_0x2dc66f,_0x1d5cb7(0x208),_0x4c372c,_0x141d22,_0x41862b]);if(_0x5eb1e8[_0x1d5cb7(0x21f)]){const [_0x889c49]=await conn[_0x1d5cb7(0x206)]()['execute'](_0x1d5cb7(0x214),[_0x5eb1e8[_0x1d5cb7(0x21f)]]);_0x889c49[_0x1d5cb7(0x220)]>0x0&&(_0x2261b1=_0x889c49[0x0]);}}catch{_0x1c750d['status'](0x1f4)[_0x1d5cb7(0x232)]({'error':_0x1d5cb7(0x1f4)});return;}let _0x3902a3;try{_0x3902a3=jwt[_0x1d5cb7(0x21e)]({'userId':_0x2261b1['id'],'email':_0x2261b1[_0x1d5cb7(0x202)]},config['jwtSecretKey'],{'expiresIn':_0x1d5cb7(0x21d)});}catch(_0x5d2696){_0x1c750d['status'](0x1f4)[_0x1d5cb7(0x232)]({'error':_0x1d5cb7(0x1f4)});return;}const _0x4bf604=require('../libs/mail')[_0x1d5cb7(0x227)];let _0x231648=_0x1d5cb7(0x1f5);if(config[_0x1d5cb7(0x20f)]){const _0x32cf79=config['frontendUrl']+_0x1d5cb7(0x1ef)+_0x141d22;_0x231648='\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22'+_0x32cf79+'\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>'+_0x32cf79+_0x1d5cb7(0x1ee);const _0x15fad5={'from':config[_0x1d5cb7(0x216)],'to':_0x2261b1['email'],'subject':_0x1d5cb7(0x234),'text':'Welcome\x20to\x20CADViewer','html':_0x231648};try{await _0x4bf604[_0x1d5cb7(0x223)](_0x15fad5);}catch(_0x2fc126){console[_0x1d5cb7(0x204)](_0x1d5cb7(0x22e)),console[_0x1d5cb7(0x204)](_0x2fc126),_0x1c750d['status'](0x1f4)[_0x1d5cb7(0x232)]({'error':_0x1d5cb7(0x21b),'stack':_0x2fc126[_0x1d5cb7(0x22f)],'message':_0x2fc126[_0x1d5cb7(0x201)]});return;}_0x1c750d[_0x1d5cb7(0x1f6)](0xc8)[_0x1d5cb7(0x232)]({'success':!![],'message':_0x1d5cb7(0x1ff)});return;}_0x1c750d[_0x1d5cb7(0x1f6)](0xc9)[_0x1d5cb7(0x232)]({'success':!![],'data':{'userId':_0x2261b1['id'],'username':_0x2261b1[_0x1d5cb7(0x221)],'first_name':_0x2261b1[_0x1d5cb7(0x225)],'last_name':_0x2261b1[_0x1d5cb7(0x230)],'email':_0x2261b1[_0x1d5cb7(0x202)],'avatar_url':_0x2261b1[_0x1d5cb7(0x213)],'id':_0x2261b1['id'],'role':_0x2261b1[_0x1d5cb7(0x239)],'token':_0x3902a3,'is_enabled':_0x2261b1[_0x1d5cb7(0x200)]}});}),router['post'](a1_0x4a724e(0x228),async(_0x50b6a4,_0x53feaf)=>{const _0x25b82f=a1_0x4a724e;try{const {token:_0xc32eb4}=_0x50b6a4[_0x25b82f(0x21a)],[_0x47c689]=await conn['promise']()[_0x25b82f(0x235)](_0x25b82f(0x20e),[_0xc32eb4]);if(_0x47c689[_0x25b82f(0x220)]===0x0){_0x53feaf['status'](0x194)[_0x25b82f(0x232)]({'error':_0x25b82f(0x215)});return;}await conn[_0x25b82f(0x206)]()[_0x25b82f(0x235)](_0x25b82f(0x219),[_0xc32eb4]);const _0x88195e=jwt[_0x25b82f(0x21e)]({'id':_0x47c689[0x0]['id'],'email':_0x47c689[0x0][_0x25b82f(0x202)]},config['jwtSecretKey'],{'expiresIn':_0x25b82f(0x21d)});_0x53feaf[_0x25b82f(0x1f6)](0xc8)[_0x25b82f(0x232)]({'success':!![],'message':_0x25b82f(0x218),'data':{'userId':_0x47c689[0x0]['id'],'username':_0x47c689[0x0][_0x25b82f(0x221)],'first_name':_0x47c689[0x0][_0x25b82f(0x225)],'last_name':_0x47c689[0x0]['last_name'],'email':_0x47c689[0x0][_0x25b82f(0x202)],'avatar_url':_0x47c689[0x0][_0x25b82f(0x213)],'id':_0x47c689[0x0]['id'],'role':_0x47c689[0x0][_0x25b82f(0x239)],'token':_0x88195e,'is_enabled':0x1}});}catch(_0x36f6b0){console[_0x25b82f(0x204)](_0x25b82f(0x22e)),console[_0x25b82f(0x204)](_0x36f6b0),_0x53feaf[_0x25b82f(0x1f6)](0x1f4)['json']({'error':_0x25b82f(0x1f4),'stack':_0x36f6b0['stack'],'message':_0x36f6b0['message']});}}),router[a1_0x4a724e(0x1f9)]('/update-password',verifyToken,async(_0xfc652a,_0xc94fff,_0x530592)=>{const _0x5d3820=a1_0x4a724e,{current_password:_0x3cd8dc,new_password:_0x3166a0}=_0xfc652a['body'];console[_0x5d3820(0x204)]({'body':_0xfc652a['body']});const _0x1adfc7=_0xfc652a[_0x5d3820(0x229)][_0x5d3820(0x202)];let _0x497fb5;try{const [_0x4dc45b]=await conn[_0x5d3820(0x206)]()[_0x5d3820(0x235)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x1adfc7]);if(_0x4dc45b[_0x5d3820(0x220)]>0x0){_0x497fb5=_0x4dc45b[0x0];if(!await bcrypt['compare'](_0x3cd8dc,_0x497fb5[_0x5d3820(0x211)])){_0xc94fff[_0x5d3820(0x1f6)](0x191)['json']({'error':_0x5d3820(0x210)});return;}const _0x1c874f=await bcrypt[_0x5d3820(0x1fe)](_0x3166a0,0xa);await conn['promise']()[_0x5d3820(0x235)](_0x5d3820(0x21c),[_0x1c874f,_0x1adfc7]),_0xc94fff[_0x5d3820(0x1f6)](0xc8)[_0x5d3820(0x232)]({'success':!![]});}}catch(_0x2288aa){console[_0x5d3820(0x204)]({'err':_0x2288aa}),_0xc94fff['status'](0x1f4)[_0x5d3820(0x232)]({'error':_0x5d3820(0x1f4)});return;}}),router['post'](a1_0x4a724e(0x238),upload[a1_0x4a724e(0x1f2)](a1_0x4a724e(0x22b)),verifyToken,async(_0x2c6546,_0x12f008,_0x3aeb1a)=>{const _0x4031ad=a1_0x4a724e,{username:_0x2a7abf,first_name:_0x525ba2,last_name:_0x5bd6d9}=_0x2c6546[_0x4031ad(0x20b)],_0x3d0886=_0x2c6546[_0x4031ad(0x229)][_0x4031ad(0x202)];let _0x27909b;try{const [_0x4caa55]=await conn[_0x4031ad(0x206)]()[_0x4031ad(0x235)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x3d0886]);_0x4caa55[_0x4031ad(0x220)]>0x0&&(_0x27909b=_0x4caa55[0x0]);}catch(_0x4ff222){console[_0x4031ad(0x204)]({'err':_0x4ff222}),_0x12f008[_0x4031ad(0x1f6)](0x1f4)[_0x4031ad(0x232)]({'error':_0x4031ad(0x1f4)});return;}if(!_0x27909b){_0x12f008['status'](0x191)[_0x4031ad(0x232)]({'error':_0x4031ad(0x20c)});return;}console[_0x4031ad(0x204)]({'req':_0x2c6546['body']});let _0x3cc6a7=_0x27909b[_0x4031ad(0x213)];if(_0x2c6546[_0x4031ad(0x233)]){const _0x5c8406=_0x4031ad(0x226)+randomUUID()+_0x4031ad(0x1fb);fs[_0x4031ad(0x1f0)](_0x2c6546[_0x4031ad(0x233)][_0x4031ad(0x1ed)],'./'+_0x5c8406),fs['unlinkSync'](_0x2c6546[_0x4031ad(0x233)]['path']),_0x3cc6a7=config[_0x4031ad(0x22a)]+'/'+_0x5c8406;}try{await conn[_0x4031ad(0x206)]()[_0x4031ad(0x235)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x2a7abf,_0x525ba2,_0x5bd6d9,_0x3cc6a7,_0x3d0886]);let _0x2ab1e8;try{_0x2ab1e8=jwt[_0x4031ad(0x21e)]({'userId':_0x27909b['id'],'email':_0x27909b[_0x4031ad(0x202)]},config['jwtSecretKey'],{'expiresIn':_0x4031ad(0x21d)});}catch(_0xd03248){console[_0x4031ad(0x204)](_0xd03248),_0x12f008[_0x4031ad(0x1f6)](0x1f4)[_0x4031ad(0x232)]({'error':_0x4031ad(0x1f4)});return;}_0x12f008[_0x4031ad(0x1f6)](0xc8)['json']({'success':!![],'data':{'userId':_0x27909b['id'],'username':_0x2a7abf,'first_name':_0x525ba2,'last_name':_0x5bd6d9,'email':_0x27909b[_0x4031ad(0x202)],'avatar_url':_0x3cc6a7,'token':_0x2ab1e8}});}catch(_0x226993){console[_0x4031ad(0x204)]({'err':_0x226993}),_0x12f008[_0x4031ad(0x1f6)](0x1f4)[_0x4031ad(0x232)]({'error':_0x4031ad(0x1f4)});return;}}),module[a1_0x4a724e(0x1fc)]=router;