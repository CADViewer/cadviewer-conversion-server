function a1_0x56e6(_0x3b3df2,_0x5ebb16){const _0x183ef6=a1_0x183e();return a1_0x56e6=function(_0x56e699,_0x3d1144){_0x56e699=_0x56e699-0x194;let _0x197b58=_0x183ef6[_0x56e699];return _0x197b58;},a1_0x56e6(_0x3b3df2,_0x5ebb16);}const a1_0x746ab=a1_0x56e6;function a1_0x183e(){const _0x19f021=['Router','path','ServerUrl','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','json','error','enableEmailVerification','insertId','role','615495oxWbtM','/update-password','file','region','recaptchaEnabled','recaptchaSecretKey','../libs/mysql.js','/validate-email/:token','avatars/','last_name','Invalid\x20password','data','name','status','97030upuqwl','callbackMethod_gatewayUrl','message','Error!\x20Something\x20went\x20wrong.','avatar_url','body','post','stack','first_name','crypted_password','verifyToken','jsonwebtoken','===================error===================','single','bcrypt','148oBmFIZ','log','email','7myoQBg','5338984IeCkDX','https://www.google.com/recaptcha/api/siteverify','execute','10NYRoTu','../libs/email-utils','Error\x20parsing\x20geolocation\x20data:','languages','city','5529078rynzmw','8cGAzjf','user','Error\x20during\x20reCAPTCHA\x20verification.','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','params','callbackMethod_gatewayUrl_flag','Error\x20during\x20user\x20creation:','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','1756044ymueQv','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','User\x20already\x20exists','/update-user-info','21219308OOoQGu','is_enabled','diskStorage','promise','mkdirSync','113355ZPTOtx','axios','code','success','demo_user','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','avatars','compare','24h','jwtSecretKey','./avatars','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','unlinkSync','existsSync','length','sign','crypto','express','Invalid\x20validation\x20token','username','copyFileSync','hash','./uploads/','reCAPTCHA\x20verification\x20error:','country_name','../libs/jwt','/signup'];a1_0x183e=function(){return _0x19f021;};return a1_0x183e();}(function(_0x3b1410,_0x5d85a5){const _0x1f9118=a1_0x56e6,_0xec33ac=_0x3b1410();while(!![]){try{const _0x2b40e5=parseInt(_0x1f9118(0x1d4))/0x1+parseInt(_0x1f9118(0x19d))/0x2*(-parseInt(_0x1f9118(0x1af))/0x3)+-parseInt(_0x1f9118(0x1f1))/0x4*(-parseInt(_0x1f9118(0x1e2))/0x5)+parseInt(_0x1f9118(0x19c))/0x6*(parseInt(_0x1f9118(0x1f4))/0x7)+parseInt(_0x1f9118(0x194))/0x8+-parseInt(_0x1f9118(0x1a6))/0x9*(parseInt(_0x1f9118(0x197))/0xa)+-parseInt(_0x1f9118(0x1aa))/0xb;if(_0x2b40e5===_0x5d85a5)break;else _0xec33ac['push'](_0xec33ac['shift']());}catch(_0x354ede){_0xec33ac['push'](_0xec33ac['shift']());}}}(a1_0x183e,0x9dfcf));const jwt=require(a1_0x746ab(0x1ed)),bcrypt=require(a1_0x746ab(0x1f0)),config=require('../CADViewer_config.json'),conn=require(a1_0x746ab(0x1da)),multer=require('multer'),fs=require('fs'),verifyToken=require(a1_0x746ab(0x1c9))[a1_0x746ab(0x1ec)],{sendWelcomeEmail}=require(a1_0x746ab(0x198)),axios=require(a1_0x746ab(0x1b0));!fs[a1_0x746ab(0x1bd)]('./avatars')&&fs[a1_0x746ab(0x1ae)](a1_0x746ab(0x1ba));const express=require(a1_0x746ab(0x1c1)),router=express[a1_0x746ab(0x1cb)](),{randomUUID}=require(a1_0x746ab(0x1c0)),storage=multer[a1_0x746ab(0x1ac)]({'destination':function(_0xeba0ff,_0x583789,_0x5d5c66){const _0x45c3cb=a1_0x746ab;_0x5d5c66(null,_0x45c3cb(0x1b6));}}),upload=multer({'storage':storage});router[a1_0x746ab(0x1e8)]('/login',async(_0x291f65,_0x121a0a,_0x2ce162)=>{const _0x59ea7f=a1_0x746ab;let {email:_0x297d00,password:_0x42405d}=_0x291f65[_0x59ea7f(0x1e7)];console[_0x59ea7f(0x1f2)]({'email':_0x297d00,'password':_0x42405d});let _0x469a39;try{const [_0x3ad59a]=await conn[_0x59ea7f(0x1ad)]()[_0x59ea7f(0x196)](_0x59ea7f(0x1a0),[_0x297d00]);_0x3ad59a[_0x59ea7f(0x1be)]>0x0&&(_0x469a39=_0x3ad59a[0x0]);}catch(_0x2668d5){console[_0x59ea7f(0x1f2)]({'err':_0x2668d5}),_0x121a0a[_0x59ea7f(0x1e1)](0x1f4)[_0x59ea7f(0x1cf)]({'error':_0x59ea7f(0x1e5)});return;}if(!_0x469a39||!await bcrypt[_0x59ea7f(0x1b7)](_0x42405d,_0x469a39?.[_0x59ea7f(0x1eb)])){_0x121a0a[_0x59ea7f(0x1e1)](0x191)[_0x59ea7f(0x1cf)]({'error':'Invalid\x20email\x20or\x20password'});return;}let _0x24a4bf;try{_0x24a4bf=jwt['sign']({'userId':_0x469a39['id'],'email':_0x469a39[_0x59ea7f(0x1f3)]},config[_0x59ea7f(0x1b9)],{'expiresIn':_0x59ea7f(0x1b8)});}catch(_0x5a9d76){console['log'](_0x5a9d76),_0x121a0a['status'](0x1f4)['json']({'error':_0x59ea7f(0x1e5)});return;}_0x121a0a[_0x59ea7f(0x1e1)](0xc8)[_0x59ea7f(0x1cf)]({'success':!![],'data':{'userId':_0x469a39['id'],'username':_0x469a39[_0x59ea7f(0x1c3)],'first_name':_0x469a39[_0x59ea7f(0x1ea)],'last_name':_0x469a39[_0x59ea7f(0x1dd)],'email':_0x469a39['email'],'avatar_url':_0x469a39[_0x59ea7f(0x1e6)],'id':_0x469a39['id'],'role':_0x469a39[_0x59ea7f(0x1d3)],'token':_0x24a4bf}});}),router[a1_0x746ab(0x1e8)](a1_0x746ab(0x1ca),async(_0x4ac224,_0x57abda,_0x1a852a)=>{const _0x1b8394=a1_0x746ab,{username:_0x25d32a,email:_0x154239,password:_0x17c6ce,geolocation:_0x5d3431,recaptchaToken:_0xc29b8d}=_0x4ac224[_0x1b8394(0x1e7)];if(config[_0x1b8394(0x1d8)]){if(!_0xc29b8d)return _0x57abda[_0x1b8394(0x1e1)](0x190)['json']({'error':_0x1b8394(0x1a1)});try{const _0x38a436=await axios[_0x1b8394(0x1e8)](_0x1b8394(0x195),null,{'params':{'secret':config[_0x1b8394(0x1d9)],'response':_0xc29b8d}});if(!_0x38a436['data'][_0x1b8394(0x1b2)])return _0x57abda[_0x1b8394(0x1e1)](0x190)[_0x1b8394(0x1cf)]({'error':_0x1b8394(0x1a1),'recaptchaErrors':_0x38a436[_0x1b8394(0x1df)]['error-codes']});}catch(_0x19188d){return console[_0x1b8394(0x1d0)](_0x1b8394(0x1c7),_0x19188d),_0x57abda[_0x1b8394(0x1e1)](0x1f4)[_0x1b8394(0x1cf)]({'error':_0x1b8394(0x19f)});}}const [_0xf80f68]=await conn[_0x1b8394(0x1ad)]()[_0x1b8394(0x196)](_0x1b8394(0x1bb),[_0x154239]);if(_0xf80f68[_0x1b8394(0x1be)]>0x0){_0x57abda[_0x1b8394(0x1e1)](0x1a6)[_0x1b8394(0x1cf)]({'error':_0x1b8394(0x1a8)});return;}const _0x5048c7=await bcrypt[_0x1b8394(0x1c5)](_0x17c6ce,0xa);let _0x2087e5=null,_0x53a3e2=0x1;config['enableEmailVerification']&&(_0x2087e5=randomUUID(),_0x53a3e2=0x0);let _0x187081=null,_0x225a94=null,_0x34b9e5=null,_0x200b24=null,_0x29cc79=null,_0x6a1f5d=null;if(_0x5d3431)try{const _0x540029=_0x5d3431;_0x187081=_0x540029[_0x1b8394(0x19b)]||null,_0x225a94=_0x540029[_0x1b8394(0x1d7)]||null,_0x34b9e5=_0x540029[_0x1b8394(0x1c8)]||null,_0x540029[_0x1b8394(0x19a)]&&_0x540029['languages'][_0x1b8394(0x1be)]>0x0&&(_0x200b24=_0x540029['languages'][0x0][_0x1b8394(0x1b1)]||null,_0x29cc79=_0x540029[_0x1b8394(0x19a)][0x0][_0x1b8394(0x1e0)]||null),_0x540029['time_zone']&&(_0x6a1f5d=_0x540029['time_zone']['name']||null);}catch(_0xea8add){console[_0x1b8394(0x1f2)](_0x1b8394(0x199),_0xea8add);}let _0x1c0998;try{const _0x11e90a=randomUUID(),_0x1e76a3=_0x1b8394(0x1c6)+_0x11e90a;fs[_0x1b8394(0x1ae)](_0x1e76a3);const [_0x420b78]=await conn['promise']()[_0x1b8394(0x196)]('INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)',[_0x25d32a,_0x154239,_0x5048c7,_0x1b8394(0x1b3),_0x53a3e2,_0x2087e5,_0x11e90a,_0x187081,_0x225a94,_0x34b9e5,_0x200b24,_0x29cc79,_0x6a1f5d]);if(_0x420b78[_0x1b8394(0x1d2)]){const [_0xd177fa]=await conn['promise']()[_0x1b8394(0x196)](_0x1b8394(0x1a5),[_0x420b78[_0x1b8394(0x1d2)]]);_0xd177fa['length']>0x0&&(_0x1c0998=_0xd177fa[0x0]);}}catch(_0x2028c6){console[_0x1b8394(0x1f2)](_0x1b8394(0x1a4),_0x2028c6),_0x57abda[_0x1b8394(0x1e1)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x59d6c7;try{_0x59d6c7=jwt[_0x1b8394(0x1bf)]({'userId':_0x1c0998['id'],'email':_0x1c0998[_0x1b8394(0x1f3)]},config[_0x1b8394(0x1b9)],{'expiresIn':'24h'});}catch(_0x37d73b){_0x57abda['status'](0x1f4)[_0x1b8394(0x1cf)]({'error':_0x1b8394(0x1e5)});return;}if(config[_0x1b8394(0x1d1)]){try{await sendWelcomeEmail(_0x1c0998,_0x2087e5);}catch(_0xef7c12){console[_0x1b8394(0x1f2)](_0x1b8394(0x1ee)),console[_0x1b8394(0x1f2)](_0xef7c12);}_0x57abda[_0x1b8394(0x1e1)](0xc8)[_0x1b8394(0x1cf)]({'success':!![],'message':_0x1b8394(0x1a7)});return;}_0x57abda['status'](0xc9)[_0x1b8394(0x1cf)]({'success':!![],'data':{'userId':_0x1c0998['id'],'username':_0x1c0998[_0x1b8394(0x1c3)],'first_name':_0x1c0998['first_name'],'last_name':_0x1c0998['last_name'],'email':_0x1c0998[_0x1b8394(0x1f3)],'avatar_url':_0x1c0998[_0x1b8394(0x1e6)],'id':_0x1c0998['id'],'role':_0x1c0998[_0x1b8394(0x1d3)],'token':_0x59d6c7,'is_enabled':_0x1c0998[_0x1b8394(0x1ab)]}});}),router[a1_0x746ab(0x1e8)](a1_0x746ab(0x1db),async(_0x2bda79,_0x2992b0)=>{const _0x2c4057=a1_0x746ab;try{const {token:_0xb5bc72}=_0x2bda79[_0x2c4057(0x1a2)],[_0xeb6c54]=await conn[_0x2c4057(0x1ad)]()['execute'](_0x2c4057(0x1ce),[_0xb5bc72]);if(_0xeb6c54[_0x2c4057(0x1be)]===0x0){_0x2992b0['status'](0x194)[_0x2c4057(0x1cf)]({'error':_0x2c4057(0x1c2)});return;}await conn['promise']()[_0x2c4057(0x196)](_0x2c4057(0x1b5),[_0xb5bc72]);const _0x467ce6=jwt[_0x2c4057(0x1bf)]({'id':_0xeb6c54[0x0]['id'],'email':_0xeb6c54[0x0]['email']},config[_0x2c4057(0x1b9)],{'expiresIn':_0x2c4057(0x1b8)});_0x2992b0[_0x2c4057(0x1e1)](0xc8)[_0x2c4057(0x1cf)]({'success':!![],'message':'Email\x20validated\x20successfully','data':{'userId':_0xeb6c54[0x0]['id'],'username':_0xeb6c54[0x0][_0x2c4057(0x1c3)],'first_name':_0xeb6c54[0x0][_0x2c4057(0x1ea)],'last_name':_0xeb6c54[0x0]['last_name'],'email':_0xeb6c54[0x0]['email'],'avatar_url':_0xeb6c54[0x0][_0x2c4057(0x1e6)],'id':_0xeb6c54[0x0]['id'],'role':_0xeb6c54[0x0][_0x2c4057(0x1d3)],'token':_0x467ce6,'is_enabled':0x1}});}catch(_0x19db16){console[_0x2c4057(0x1f2)]('===================error==================='),console[_0x2c4057(0x1f2)](_0x19db16),_0x2992b0[_0x2c4057(0x1e1)](0x1f4)[_0x2c4057(0x1cf)]({'error':_0x2c4057(0x1e5),'stack':_0x19db16[_0x2c4057(0x1e9)],'message':_0x19db16[_0x2c4057(0x1e4)]});}}),router[a1_0x746ab(0x1e8)](a1_0x746ab(0x1d5),verifyToken,async(_0x3ff8de,_0x55a827,_0x466c2d)=>{const _0x13d4a9=a1_0x746ab,{current_password:_0x13ecb,new_password:_0x1b9e99}=_0x3ff8de[_0x13d4a9(0x1e7)];console[_0x13d4a9(0x1f2)]({'body':_0x3ff8de[_0x13d4a9(0x1e7)]});const _0x5981e6=_0x3ff8de[_0x13d4a9(0x19e)][_0x13d4a9(0x1f3)];let _0x27fa5c;try{const [_0x1eb9ca]=await conn[_0x13d4a9(0x1ad)]()[_0x13d4a9(0x196)](_0x13d4a9(0x1bb),[_0x5981e6]);if(_0x1eb9ca[_0x13d4a9(0x1be)]>0x0){_0x27fa5c=_0x1eb9ca[0x0];if(!await bcrypt[_0x13d4a9(0x1b7)](_0x13ecb,_0x27fa5c[_0x13d4a9(0x1eb)])){_0x55a827[_0x13d4a9(0x1e1)](0x191)['json']({'error':_0x13d4a9(0x1de)});return;}const _0x40d786=await bcrypt[_0x13d4a9(0x1c5)](_0x1b9e99,0xa);await conn[_0x13d4a9(0x1ad)]()[_0x13d4a9(0x196)](_0x13d4a9(0x1b4),[_0x40d786,_0x5981e6]),_0x55a827['status'](0xc8)[_0x13d4a9(0x1cf)]({'success':!![]});}}catch(_0x400f53){console['log']({'err':_0x400f53}),_0x55a827[_0x13d4a9(0x1e1)](0x1f4)[_0x13d4a9(0x1cf)]({'error':_0x13d4a9(0x1e5)});return;}}),router[a1_0x746ab(0x1e8)](a1_0x746ab(0x1a9),upload[a1_0x746ab(0x1ef)]('avatar'),verifyToken,async(_0x32b014,_0x324fb8,_0x553646)=>{const _0x3cf942=a1_0x746ab,{username:_0x481a44,first_name:_0x13fd90,last_name:_0x4fdc39}=_0x32b014['body'],_0x21b532=_0x32b014['user']['email'];let _0x42524e;try{const [_0x50ad41]=await conn['promise']()[_0x3cf942(0x196)](_0x3cf942(0x1bb),[_0x21b532]);_0x50ad41['length']>0x0&&(_0x42524e=_0x50ad41[0x0]);}catch(_0x453cd1){console[_0x3cf942(0x1f2)]({'err':_0x453cd1}),_0x324fb8[_0x3cf942(0x1e1)](0x1f4)[_0x3cf942(0x1cf)]({'error':_0x3cf942(0x1e5)});return;}if(!_0x42524e){_0x324fb8[_0x3cf942(0x1e1)](0x191)[_0x3cf942(0x1cf)]({'error':'Invalid\x20user'});return;}console[_0x3cf942(0x1f2)]({'req':_0x32b014[_0x3cf942(0x1e7)]});let _0x54f422=_0x42524e['avatar_url'];if(_0x32b014['file']){const _0x38d890=_0x3cf942(0x1dc)+randomUUID()+'.png';fs[_0x3cf942(0x1c4)](_0x32b014[_0x3cf942(0x1d6)][_0x3cf942(0x1cc)],'./'+_0x38d890),fs[_0x3cf942(0x1bc)](_0x32b014[_0x3cf942(0x1d6)][_0x3cf942(0x1cc)]),config[_0x3cf942(0x1a3)]?_0x54f422=config[_0x3cf942(0x1e3)]+'/'+_0x38d890:_0x54f422=config[_0x3cf942(0x1cd)]+'/'+_0x38d890;}try{await conn[_0x3cf942(0x1ad)]()['execute']('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x481a44,_0x13fd90,_0x4fdc39,_0x54f422,_0x21b532]);let _0x1184f2;try{_0x1184f2=jwt[_0x3cf942(0x1bf)]({'userId':_0x42524e['id'],'email':_0x42524e[_0x3cf942(0x1f3)]},config[_0x3cf942(0x1b9)],{'expiresIn':_0x3cf942(0x1b8)});}catch(_0x55b6bd){console[_0x3cf942(0x1f2)](_0x55b6bd),_0x324fb8[_0x3cf942(0x1e1)](0x1f4)[_0x3cf942(0x1cf)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x324fb8[_0x3cf942(0x1e1)](0xc8)[_0x3cf942(0x1cf)]({'success':!![],'data':{'userId':_0x42524e['id'],'username':_0x481a44,'first_name':_0x13fd90,'last_name':_0x4fdc39,'email':_0x42524e['email'],'avatar_url':_0x54f422,'token':_0x1184f2}});}catch(_0x536c33){console[_0x3cf942(0x1f2)]({'err':_0x536c33}),_0x324fb8[_0x3cf942(0x1e1)](0x1f4)[_0x3cf942(0x1cf)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module['exports']=router;