function a1_0x3622(){const _0x4064df=['execute','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','is_enabled','.png','sendMail','bcrypt','../libs/mysql.js','avatar_url','path','21210pekxSm','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','hash','role','body','jwtSecretKey','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','sign','===================error===================','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','ServerUrl','1995230mEWCeF','1426375iDmdTr','slice','9HQzKqK','params','/signup','Welcome\x20to\x20CADViewer','promise','demo_user','Invalid\x20email\x20or\x20password','crypto','User\x20already\x20exists','24h','../libs/jwt','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','json','single','email','../CADViewer_config.json','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','smtpFrom','message','file','avatar','unlinkSync','length','crypted_password','/validate-email/:token','3015664PIHowe','/update-user-info','1081932SRCdht','avatars','exports','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','enableEmailVerification','114akqAPb','Error!\x20Something\x20went\x20wrong.','last_name','verifyToken','first_name','endsWith','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','7zYfazF','/login','log','831066rRCtXE','./avatars','Invalid\x20password','compare','mkdirSync','Invalid\x20user','frontendUrl','post','165792UituSd','status','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)'];a1_0x3622=function(){return _0x4064df;};return a1_0x3622();}const a1_0x38ee52=a1_0x41f5;(function(_0x4eb7ae,_0x3555c4){const _0x35ad2f=a1_0x41f5,_0x17997e=_0x4eb7ae();while(!![]){try{const _0xbd9c9d=-parseInt(_0x35ad2f(0x128))/0x1+-parseInt(_0x35ad2f(0x134))/0x2*(-parseInt(_0x35ad2f(0x116))/0x3)+parseInt(_0x35ad2f(0x111))/0x4+-parseInt(_0x35ad2f(0x141))/0x5+-parseInt(_0x35ad2f(0x120))/0x6+parseInt(_0x35ad2f(0x11d))/0x7*(parseInt(_0x35ad2f(0x10f))/0x8)+-parseInt(_0x35ad2f(0x143))/0x9*(parseInt(_0x35ad2f(0x140))/0xa);if(_0xbd9c9d===_0x3555c4)break;else _0x17997e['push'](_0x17997e['shift']());}catch(_0xa3feda){_0x17997e['push'](_0x17997e['shift']());}}}(a1_0x3622,0x3fcd2));function a1_0x41f5(_0x3be5be,_0xe5eb32){const _0x362205=a1_0x3622();return a1_0x41f5=function(_0x41f5bd,_0x390f75){_0x41f5bd=_0x41f5bd-0x10c;let _0x450916=_0x362205[_0x41f5bd];return _0x450916;},a1_0x41f5(_0x3be5be,_0xe5eb32);}const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x38ee52(0x130)),config=require(a1_0x38ee52(0x152)),conn=require(a1_0x38ee52(0x131)),multer=require('multer'),fs=require('fs'),verifyToken=require(a1_0x38ee52(0x14d))[a1_0x38ee52(0x119)];!fs['existsSync'](a1_0x38ee52(0x121))&&fs[a1_0x38ee52(0x124)](a1_0x38ee52(0x121));const express=require('express'),router=express['Router'](),{randomUUID}=require(a1_0x38ee52(0x14a)),storage=multer['diskStorage']({'destination':function(_0x5095a6,_0x1ed3f0,_0x1bc75f){const _0x2807a3=a1_0x38ee52;_0x1bc75f(null,_0x2807a3(0x112));}}),upload=multer({'storage':storage});router[a1_0x38ee52(0x127)](a1_0x38ee52(0x11e),async(_0x37f97d,_0x537985,_0x4f1d08)=>{const _0x775191=a1_0x38ee52;let {email:_0x162bbc,password:_0x557b61}=_0x37f97d['body'];console[_0x775191(0x11f)]({'email':_0x162bbc,'password':_0x557b61});let _0x322dcb;try{const [_0x2e2eed]=await conn['promise']()[_0x775191(0x12b)](_0x775191(0x13b),[_0x162bbc]);_0x2e2eed[_0x775191(0x10c)]>0x0&&(_0x322dcb=_0x2e2eed[0x0]);}catch(_0x18d21c){console[_0x775191(0x11f)]({'err':_0x18d21c}),_0x537985[_0x775191(0x129)](0x1f4)[_0x775191(0x14f)]({'error':_0x775191(0x117)});return;}if(!_0x322dcb||!await bcrypt[_0x775191(0x123)](_0x557b61,_0x322dcb?.[_0x775191(0x10d)])){_0x537985[_0x775191(0x129)](0x191)['json']({'error':_0x775191(0x149)});return;}let _0x1ef6a7;try{_0x1ef6a7=jwt[_0x775191(0x13c)]({'userId':_0x322dcb['id'],'email':_0x322dcb[_0x775191(0x151)]},config[_0x775191(0x139)],{'expiresIn':'24h'});}catch(_0x49c3ca){console[_0x775191(0x11f)](_0x49c3ca),_0x537985[_0x775191(0x129)](0x1f4)[_0x775191(0x14f)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x537985[_0x775191(0x129)](0xc8)[_0x775191(0x14f)]({'success':!![],'data':{'userId':_0x322dcb['id'],'username':_0x322dcb['username'],'first_name':_0x322dcb[_0x775191(0x11a)],'last_name':_0x322dcb['last_name'],'email':_0x322dcb['email'],'avatar_url':_0x322dcb[_0x775191(0x132)],'id':_0x322dcb['id'],'role':_0x322dcb[_0x775191(0x137)],'token':_0x1ef6a7}});}),router['post'](a1_0x38ee52(0x145),async(_0x1af83e,_0x5cb3f9,_0x451a16)=>{const _0x56497c=a1_0x38ee52,{username:_0x5ae665,email:_0x30028c,password:_0x349516}=_0x1af83e['body'],[_0x1af867]=await conn[_0x56497c(0x147)]()[_0x56497c(0x12b)](_0x56497c(0x13e),[_0x30028c]);if(_0x1af867[_0x56497c(0x10c)]>0x0){_0x5cb3f9['status'](0x1a6)['json']({'error':_0x56497c(0x14b)});return;}const _0x40a7c7=await bcrypt[_0x56497c(0x136)](_0x349516,0xa);let _0x2f92d7=null,_0x4b124f=0x1;config[_0x56497c(0x115)]&&(_0x2f92d7=randomUUID(),_0x4b124f=0x0);let _0xc62f42;try{const _0x3e2895=randomUUID(),_0x594718='./uploads/'+_0x3e2895;fs[_0x56497c(0x124)](_0x594718);const [_0x7114c1]=await conn[_0x56497c(0x147)]()[_0x56497c(0x12b)](_0x56497c(0x12a),[_0x5ae665,_0x30028c,_0x40a7c7,_0x56497c(0x148),_0x4b124f,_0x2f92d7,_0x3e2895]);if(_0x7114c1['insertId']){const [_0x3481c3]=await conn[_0x56497c(0x147)]()[_0x56497c(0x12b)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0x7114c1['insertId']]);_0x3481c3[_0x56497c(0x10c)]>0x0&&(_0xc62f42=_0x3481c3[0x0]);}}catch{_0x5cb3f9[_0x56497c(0x129)](0x1f4)[_0x56497c(0x14f)]({'error':_0x56497c(0x117)});return;}let _0x253f3a;try{_0x253f3a=jwt['sign']({'userId':_0xc62f42['id'],'email':_0xc62f42[_0x56497c(0x151)]},config['jwtSecretKey'],{'expiresIn':'24h'});}catch(_0x1a2553){_0x5cb3f9[_0x56497c(0x129)](0x1f4)['json']({'error':_0x56497c(0x117)});return;}const _0x4ae128=require('../libs/mail')['transporter'];let _0x317580='<p>Welcome\x20to\x20CADViewer</p>';if(config['enableEmailVerification']){var _0x5922d6=config[_0x56497c(0x126)];_0x5922d6[_0x56497c(0x11b)]('/')&&(_0x5922d6=_0x5922d6[_0x56497c(0x142)](0x0,-0x1));const _0x389896=_0x5922d6+'/validate-email/'+_0x2f92d7;_0x317580=_0x56497c(0x11c)+_0x389896+_0x56497c(0x153)+_0x389896+_0x56497c(0x14e);const _0x5a3046={'from':config[_0x56497c(0x154)],'to':_0xc62f42[_0x56497c(0x151)],'subject':_0x56497c(0x146),'text':_0x56497c(0x146),'html':_0x317580};try{await _0x4ae128[_0x56497c(0x12f)](_0x5a3046);}catch(_0x2d3634){console['log'](_0x56497c(0x13d)),console[_0x56497c(0x11f)](_0x2d3634),_0x5cb3f9[_0x56497c(0x129)](0x1f4)[_0x56497c(0x14f)]({'error':_0x56497c(0x135),'stack':_0x2d3634['stack'],'message':_0x2d3634[_0x56497c(0x155)]});return;}_0x5cb3f9['status'](0xc8)[_0x56497c(0x14f)]({'success':!![],'message':_0x56497c(0x13a)});return;}_0x5cb3f9[_0x56497c(0x129)](0xc9)['json']({'success':!![],'data':{'userId':_0xc62f42['id'],'username':_0xc62f42['username'],'first_name':_0xc62f42[_0x56497c(0x11a)],'last_name':_0xc62f42[_0x56497c(0x118)],'email':_0xc62f42[_0x56497c(0x151)],'avatar_url':_0xc62f42[_0x56497c(0x132)],'id':_0xc62f42['id'],'role':_0xc62f42[_0x56497c(0x137)],'token':_0x253f3a,'is_enabled':_0xc62f42[_0x56497c(0x12d)]}});}),router[a1_0x38ee52(0x127)](a1_0x38ee52(0x10e),async(_0x1527a1,_0xd0db82)=>{const _0x331dd2=a1_0x38ee52;try{const {token:_0x2896b4}=_0x1527a1[_0x331dd2(0x144)],[_0x4ce1a2]=await conn['promise']()[_0x331dd2(0x12b)](_0x331dd2(0x114),[_0x2896b4]);if(_0x4ce1a2[_0x331dd2(0x10c)]===0x0){_0xd0db82[_0x331dd2(0x129)](0x194)[_0x331dd2(0x14f)]({'error':'Invalid\x20validation\x20token'});return;}await conn['promise']()[_0x331dd2(0x12b)]('UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?',[_0x2896b4]);const _0x2ce76c=jwt[_0x331dd2(0x13c)]({'id':_0x4ce1a2[0x0]['id'],'email':_0x4ce1a2[0x0][_0x331dd2(0x151)]},config['jwtSecretKey'],{'expiresIn':_0x331dd2(0x14c)});_0xd0db82['status'](0xc8)[_0x331dd2(0x14f)]({'success':!![],'message':'Email\x20validated\x20successfully','data':{'userId':_0x4ce1a2[0x0]['id'],'username':_0x4ce1a2[0x0]['username'],'first_name':_0x4ce1a2[0x0]['first_name'],'last_name':_0x4ce1a2[0x0][_0x331dd2(0x118)],'email':_0x4ce1a2[0x0][_0x331dd2(0x151)],'avatar_url':_0x4ce1a2[0x0][_0x331dd2(0x132)],'id':_0x4ce1a2[0x0]['id'],'role':_0x4ce1a2[0x0][_0x331dd2(0x137)],'token':_0x2ce76c,'is_enabled':0x1}});}catch(_0x2b3dcd){console[_0x331dd2(0x11f)](_0x331dd2(0x13d)),console[_0x331dd2(0x11f)](_0x2b3dcd),_0xd0db82[_0x331dd2(0x129)](0x1f4)[_0x331dd2(0x14f)]({'error':_0x331dd2(0x117),'stack':_0x2b3dcd['stack'],'message':_0x2b3dcd[_0x331dd2(0x155)]});}}),router[a1_0x38ee52(0x127)]('/update-password',verifyToken,async(_0x32501a,_0x1f557d,_0x5201be)=>{const _0x9c6abf=a1_0x38ee52,{current_password:_0x44f399,new_password:_0x3ea555}=_0x32501a[_0x9c6abf(0x138)];console[_0x9c6abf(0x11f)]({'body':_0x32501a[_0x9c6abf(0x138)]});const _0x153ed5=_0x32501a['user'][_0x9c6abf(0x151)];let _0x4cb833;try{const [_0x4456c0]=await conn['promise']()['execute'](_0x9c6abf(0x13e),[_0x153ed5]);if(_0x4456c0[_0x9c6abf(0x10c)]>0x0){_0x4cb833=_0x4456c0[0x0];if(!await bcrypt[_0x9c6abf(0x123)](_0x44f399,_0x4cb833[_0x9c6abf(0x10d)])){_0x1f557d['status'](0x191)[_0x9c6abf(0x14f)]({'error':_0x9c6abf(0x122)});return;}const _0x2d757b=await bcrypt[_0x9c6abf(0x136)](_0x3ea555,0xa);await conn[_0x9c6abf(0x147)]()['execute'](_0x9c6abf(0x12c),[_0x2d757b,_0x153ed5]),_0x1f557d[_0x9c6abf(0x129)](0xc8)[_0x9c6abf(0x14f)]({'success':!![]});}}catch(_0x223f04){console[_0x9c6abf(0x11f)]({'err':_0x223f04}),_0x1f557d[_0x9c6abf(0x129)](0x1f4)[_0x9c6abf(0x14f)]({'error':_0x9c6abf(0x117)});return;}}),router['post'](a1_0x38ee52(0x110),upload[a1_0x38ee52(0x150)](a1_0x38ee52(0x157)),verifyToken,async(_0x33439c,_0x59dade,_0x4f7844)=>{const _0x352dcd=a1_0x38ee52,{username:_0x339a77,first_name:_0x2b5a96,last_name:_0x115566}=_0x33439c[_0x352dcd(0x138)],_0x197cc9=_0x33439c['user']['email'];let _0x2c43f6;try{const [_0x5dd307]=await conn['promise']()[_0x352dcd(0x12b)](_0x352dcd(0x13e),[_0x197cc9]);_0x5dd307['length']>0x0&&(_0x2c43f6=_0x5dd307[0x0]);}catch(_0x64cf31){console[_0x352dcd(0x11f)]({'err':_0x64cf31}),_0x59dade[_0x352dcd(0x129)](0x1f4)[_0x352dcd(0x14f)]({'error':_0x352dcd(0x117)});return;}if(!_0x2c43f6){_0x59dade[_0x352dcd(0x129)](0x191)[_0x352dcd(0x14f)]({'error':_0x352dcd(0x125)});return;}console[_0x352dcd(0x11f)]({'req':_0x33439c[_0x352dcd(0x138)]});let _0x1f921f=_0x2c43f6[_0x352dcd(0x132)];if(_0x33439c[_0x352dcd(0x156)]){const _0x1b8e28='avatars/'+randomUUID()+_0x352dcd(0x12e);fs['copyFileSync'](_0x33439c[_0x352dcd(0x156)][_0x352dcd(0x133)],'./'+_0x1b8e28),fs[_0x352dcd(0x158)](_0x33439c[_0x352dcd(0x156)][_0x352dcd(0x133)]),_0x1f921f=config[_0x352dcd(0x13f)]+'/'+_0x1b8e28;}try{await conn[_0x352dcd(0x147)]()[_0x352dcd(0x12b)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x339a77,_0x2b5a96,_0x115566,_0x1f921f,_0x197cc9]);let _0x53d72e;try{_0x53d72e=jwt[_0x352dcd(0x13c)]({'userId':_0x2c43f6['id'],'email':_0x2c43f6['email']},config['jwtSecretKey'],{'expiresIn':_0x352dcd(0x14c)});}catch(_0x5a29e9){console[_0x352dcd(0x11f)](_0x5a29e9),_0x59dade[_0x352dcd(0x129)](0x1f4)[_0x352dcd(0x14f)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x59dade[_0x352dcd(0x129)](0xc8)[_0x352dcd(0x14f)]({'success':!![],'data':{'userId':_0x2c43f6['id'],'username':_0x339a77,'first_name':_0x2b5a96,'last_name':_0x115566,'email':_0x2c43f6[_0x352dcd(0x151)],'avatar_url':_0x1f921f,'token':_0x53d72e}});}catch(_0x47669e){console['log']({'err':_0x47669e}),_0x59dade[_0x352dcd(0x129)](0x1f4)[_0x352dcd(0x14f)]({'error':_0x352dcd(0x117)});return;}}),module[a1_0x38ee52(0x113)]=router;