function a1_0xda30(){const _0xd7b218=['crypted_password','24h','../CADViewer_config.json','stack','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','post','frontendUrl','demo_user','avatar_url','5208528zjgfPA','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','bcrypt','user','../libs/jwt','/signup','file','./uploads/','avatars/','./avatars','jwtSecretKey','crypto','enableEmailVerification','57741PwckDe','first_name','username','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','jsonwebtoken','verifyToken','mkdirSync','/validate-email/','../libs/mail','log','7325628lLCFWP','/validate-email/:token','last_name','21224Ttqyuq','status','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','execute','Welcome\x20to\x20CADViewer','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','length','32dKNzAa','single','email','===================error===================','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','Invalid\x20validation\x20token','promise','Error!\x20Something\x20went\x20wrong.','transporter','diskStorage','express','/update-password','4872488XHwwnJ','/login','5391113ZJkkwp','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','Email\x20validated\x20successfully','sign','/update-user-info','exports','body','4353675RiSUIs','role','renameSync','../libs/mysql.js','multer','Invalid\x20user','avatars','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','path','Invalid\x20password','insertId','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','message','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','hash','json'];a1_0xda30=function(){return _0xd7b218;};return a1_0xda30();}const a1_0x9c213a=a1_0x4dc6;(function(_0x566c,_0x554e89){const _0x326be1=a1_0x4dc6,_0x3dbd89=_0x566c();while(!![]){try{const _0x251dee=-parseInt(_0x326be1(0x1b9))/0x1*(parseInt(_0x326be1(0x170))/0x2)+-parseInt(_0x326be1(0x1ac))/0x3+parseInt(_0x326be1(0x17c))/0x4+parseInt(_0x326be1(0x185))/0x5+-parseInt(_0x326be1(0x1b6))/0x6+parseInt(_0x326be1(0x17e))/0x7+-parseInt(_0x326be1(0x19f))/0x8;if(_0x251dee===_0x554e89)break;else _0x3dbd89['push'](_0x3dbd89['shift']());}catch(_0x312bff){_0x3dbd89['push'](_0x3dbd89['shift']());}}}(a1_0xda30,0x995d5));const jwt=require(a1_0x9c213a(0x1b0)),bcrypt=require(a1_0x9c213a(0x1a1)),config=require(a1_0x9c213a(0x198)),conn=require(a1_0x9c213a(0x188)),multer=require(a1_0x9c213a(0x189)),fs=require('fs'),verifyToken=require(a1_0x9c213a(0x1a3))[a1_0x9c213a(0x1b1)];!fs['existsSync']('./avatars')&&fs[a1_0x9c213a(0x1b2)](a1_0x9c213a(0x1a8));function a1_0x4dc6(_0x2b3bf4,_0x2851f7){const _0xda308c=a1_0xda30();return a1_0x4dc6=function(_0x4dc6ac,_0x91deef){_0x4dc6ac=_0x4dc6ac-0x16c;let _0x236885=_0xda308c[_0x4dc6ac];return _0x236885;},a1_0x4dc6(_0x2b3bf4,_0x2851f7);}const express=require(a1_0x9c213a(0x17a)),router=express['Router'](),{randomUUID}=require(a1_0x9c213a(0x1aa)),storage=multer[a1_0x9c213a(0x179)]({'destination':function(_0x406d02,_0x32952c,_0x4480cb){const _0x143f05=a1_0x9c213a;_0x4480cb(null,_0x143f05(0x18b));}}),upload=multer({'storage':storage});router[a1_0x9c213a(0x19b)](a1_0x9c213a(0x17d),async(_0x2a5533,_0x14f10a,_0x5f2834)=>{const _0x182855=a1_0x9c213a;let {email:_0x460108,password:_0x442c31}=_0x2a5533[_0x182855(0x184)];console[_0x182855(0x1b5)]({'email':_0x460108,'password':_0x442c31});let _0x5c3fcd;try{const [_0x5b4219]=await conn[_0x182855(0x176)]()['execute'](_0x182855(0x1bb),[_0x460108]);_0x5b4219[_0x182855(0x16f)]>0x0&&(_0x5c3fcd=_0x5b4219[0x0]);}catch(_0x40984f){console[_0x182855(0x1b5)]({'err':_0x40984f}),_0x14f10a[_0x182855(0x1ba)](0x1f4)[_0x182855(0x195)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}console[_0x182855(0x1b5)](_0x5c3fcd),console[_0x182855(0x1b5)](_0x442c31),console['log'](_0x5c3fcd[_0x182855(0x196)]);if(!_0x5c3fcd||!await bcrypt['compare'](_0x442c31,_0x5c3fcd[_0x182855(0x196)])){_0x14f10a[_0x182855(0x1ba)](0x191)[_0x182855(0x195)]({'error':'Invalid\x20email\x20or\x20password'});return;}let _0x20864f;try{_0x20864f=jwt[_0x182855(0x181)]({'userId':_0x5c3fcd['id'],'email':_0x5c3fcd[_0x182855(0x172)]},config['jwtSecretKey'],{'expiresIn':'24h'});}catch(_0x3e9e8c){console[_0x182855(0x1b5)](_0x3e9e8c),_0x14f10a['status'](0x1f4)[_0x182855(0x195)]({'error':_0x182855(0x177)});return;}_0x14f10a['status'](0xc8)['json']({'success':!![],'data':{'userId':_0x5c3fcd['id'],'username':_0x5c3fcd[_0x182855(0x1ae)],'first_name':_0x5c3fcd['first_name'],'last_name':_0x5c3fcd[_0x182855(0x1b8)],'email':_0x5c3fcd['email'],'avatar_url':_0x5c3fcd[_0x182855(0x19e)],'id':_0x5c3fcd['id'],'role':_0x5c3fcd['role'],'token':_0x20864f}});}),router[a1_0x9c213a(0x19b)](a1_0x9c213a(0x1a4),async(_0xae2e1f,_0x2a8f82,_0x1d103b)=>{const _0x208cd1=a1_0x9c213a,{username:_0x366fd6,email:_0x56ac17,password:_0x585cd1}=_0xae2e1f[_0x208cd1(0x184)],[_0x40ed33]=await conn[_0x208cd1(0x176)]()[_0x208cd1(0x16c)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x56ac17]);if(_0x40ed33[_0x208cd1(0x16f)]>0x0){_0x2a8f82[_0x208cd1(0x1ba)](0x1a6)[_0x208cd1(0x195)]({'error':'User\x20already\x20exists'});return;}const _0x1f8592=await bcrypt[_0x208cd1(0x194)](_0x585cd1,0xa);let _0x4a40e4=null,_0x35a63b=0x1;config[_0x208cd1(0x1ab)]&&(_0x4a40e4=randomUUID(),_0x35a63b=0x0);let _0x263e3a;try{const _0x4655bd=randomUUID(),_0x5473c9=_0x208cd1(0x1a6)+_0x4655bd;fs[_0x208cd1(0x1b2)](_0x5473c9);const [_0x1e79e3]=await conn['promise']()[_0x208cd1(0x16c)](_0x208cd1(0x18c),[_0x366fd6,_0x56ac17,_0x1f8592,_0x208cd1(0x19d),_0x35a63b,_0x4a40e4,_0x4655bd]);if(_0x1e79e3[_0x208cd1(0x190)]){const [_0x27ceeb]=await conn[_0x208cd1(0x176)]()[_0x208cd1(0x16c)](_0x208cd1(0x17f),[_0x1e79e3[_0x208cd1(0x190)]]);_0x27ceeb[_0x208cd1(0x16f)]>0x0&&(_0x263e3a=_0x27ceeb[0x0]);}}catch{_0x2a8f82['status'](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x34f11c;try{_0x34f11c=jwt['sign']({'userId':_0x263e3a['id'],'email':_0x263e3a[_0x208cd1(0x172)]},config['jwtSecretKey'],{'expiresIn':_0x208cd1(0x197)});}catch(_0x3eac36){_0x2a8f82['status'](0x1f4)[_0x208cd1(0x195)]({'error':_0x208cd1(0x177)});return;}const _0x418f47=require(_0x208cd1(0x1b4))[_0x208cd1(0x178)];let _0x25ca63='<p>Welcome\x20to\x20CADViewer</p>';if(config[_0x208cd1(0x1ab)]){const _0x95e516=config[_0x208cd1(0x19c)]+_0x208cd1(0x1b3)+_0x4a40e4;_0x25ca63=_0x208cd1(0x193)+_0x95e516+_0x208cd1(0x174)+_0x95e516+_0x208cd1(0x19a);const _0x399659={'from':config['smtpFrom'],'to':_0x263e3a[_0x208cd1(0x172)],'subject':'Welcome\x20to\x20CADViewer','text':_0x208cd1(0x16d),'html':_0x25ca63};try{await _0x418f47['sendMail'](_0x399659);}catch(_0x590dfd){console['log'](_0x208cd1(0x173)),console[_0x208cd1(0x1b5)](_0x590dfd),_0x2a8f82[_0x208cd1(0x1ba)](0x1f4)['json']({'error':_0x208cd1(0x1af),'stack':_0x590dfd[_0x208cd1(0x199)],'message':_0x590dfd[_0x208cd1(0x192)]});return;}_0x2a8f82[_0x208cd1(0x1ba)](0xc8)[_0x208cd1(0x195)]({'success':!![],'message':_0x208cd1(0x18d)});return;}_0x2a8f82[_0x208cd1(0x1ba)](0xc9)[_0x208cd1(0x195)]({'success':!![],'data':{'userId':_0x263e3a['id'],'username':_0x263e3a[_0x208cd1(0x1ae)],'first_name':_0x263e3a['first_name'],'last_name':_0x263e3a[_0x208cd1(0x1b8)],'email':_0x263e3a[_0x208cd1(0x172)],'avatar_url':_0x263e3a[_0x208cd1(0x19e)],'id':_0x263e3a['id'],'role':_0x263e3a[_0x208cd1(0x186)],'token':_0x34f11c,'is_enabled':_0x263e3a['is_enabled']}});}),router['post'](a1_0x9c213a(0x1b7),async(_0x3dcb04,_0x2270c0)=>{const _0x5f56cb=a1_0x9c213a;try{const {token:_0x3b71ce}=_0x3dcb04['params'],[_0x29b051]=await conn[_0x5f56cb(0x176)]()[_0x5f56cb(0x16c)](_0x5f56cb(0x16e),[_0x3b71ce]);if(_0x29b051[_0x5f56cb(0x16f)]===0x0){_0x2270c0[_0x5f56cb(0x1ba)](0x194)[_0x5f56cb(0x195)]({'error':_0x5f56cb(0x175)});return;}await conn['promise']()['execute'](_0x5f56cb(0x1a0),[_0x3b71ce]);const _0x36e059=jwt['sign']({'id':_0x29b051[0x0]['id'],'email':_0x29b051[0x0][_0x5f56cb(0x172)]},config[_0x5f56cb(0x1a9)],{'expiresIn':_0x5f56cb(0x197)});_0x2270c0[_0x5f56cb(0x1ba)](0xc8)['json']({'success':!![],'message':_0x5f56cb(0x180),'data':{'userId':_0x29b051[0x0]['id'],'username':_0x29b051[0x0][_0x5f56cb(0x1ae)],'first_name':_0x29b051[0x0][_0x5f56cb(0x1ad)],'last_name':_0x29b051[0x0][_0x5f56cb(0x1b8)],'email':_0x29b051[0x0][_0x5f56cb(0x172)],'avatar_url':_0x29b051[0x0][_0x5f56cb(0x19e)],'id':_0x29b051[0x0]['id'],'role':_0x29b051[0x0]['role'],'token':_0x36e059,'is_enabled':0x1}});}catch(_0x1545ef){console['log'](_0x5f56cb(0x173)),console[_0x5f56cb(0x1b5)](_0x1545ef),_0x2270c0['status'](0x1f4)[_0x5f56cb(0x195)]({'error':_0x5f56cb(0x177),'stack':_0x1545ef[_0x5f56cb(0x199)],'message':_0x1545ef[_0x5f56cb(0x192)]});}}),router[a1_0x9c213a(0x19b)](a1_0x9c213a(0x17b),verifyToken,async(_0x504f4b,_0x3f1a54,_0x3186b5)=>{const _0x115e3c=a1_0x9c213a,{current_password:_0x57acf3,new_password:_0x423573}=_0x504f4b[_0x115e3c(0x184)];console['log']({'body':_0x504f4b[_0x115e3c(0x184)]});const _0x162bab=_0x504f4b['user'][_0x115e3c(0x172)];let _0x317f37;try{const [_0x5aaa92]=await conn[_0x115e3c(0x176)]()[_0x115e3c(0x16c)](_0x115e3c(0x191),[_0x162bab]);if(_0x5aaa92[_0x115e3c(0x16f)]>0x0){_0x317f37=_0x5aaa92[0x0];if(!await bcrypt['compare'](_0x57acf3,_0x317f37[_0x115e3c(0x196)])){_0x3f1a54['status'](0x191)['json']({'error':_0x115e3c(0x18f)});return;}const _0x13dd8e=await bcrypt[_0x115e3c(0x194)](_0x423573,0xa);await conn[_0x115e3c(0x176)]()['execute']('UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x13dd8e,_0x162bab]),_0x3f1a54[_0x115e3c(0x1ba)](0xc8)[_0x115e3c(0x195)]({'success':!![]});}}catch(_0x2842f6){console[_0x115e3c(0x1b5)]({'err':_0x2842f6}),_0x3f1a54[_0x115e3c(0x1ba)](0x1f4)['json']({'error':_0x115e3c(0x177)});return;}}),router[a1_0x9c213a(0x19b)](a1_0x9c213a(0x182),upload[a1_0x9c213a(0x171)]('avatar'),verifyToken,async(_0x5eeb02,_0x4b51c2,_0xeb37d7)=>{const _0x1153fe=a1_0x9c213a,{username:_0x55fbd6,first_name:_0x39093a,last_name:_0x30827e}=_0x5eeb02[_0x1153fe(0x184)],_0x491539=_0x5eeb02[_0x1153fe(0x1a2)][_0x1153fe(0x172)];let _0x37959f;try{const [_0x218739]=await conn['promise']()[_0x1153fe(0x16c)](_0x1153fe(0x191),[_0x491539]);_0x218739[_0x1153fe(0x16f)]>0x0&&(_0x37959f=_0x218739[0x0]);}catch(_0x4eab05){console['log']({'err':_0x4eab05}),_0x4b51c2[_0x1153fe(0x1ba)](0x1f4)[_0x1153fe(0x195)]({'error':_0x1153fe(0x177)});return;}if(!_0x37959f){_0x4b51c2['status'](0x191)[_0x1153fe(0x195)]({'error':_0x1153fe(0x18a)});return;}console[_0x1153fe(0x1b5)]({'req':_0x5eeb02[_0x1153fe(0x184)]});let _0x384281=_0x37959f[_0x1153fe(0x19e)];if(_0x5eeb02['file']){const _0x2ab3f9=_0x1153fe(0x1a7)+randomUUID()+'.png';fs[_0x1153fe(0x187)](_0x5eeb02[_0x1153fe(0x1a5)][_0x1153fe(0x18e)],'./'+_0x2ab3f9),_0x384281=config['ServerUrl']+'/'+_0x2ab3f9;}try{await conn[_0x1153fe(0x176)]()['execute']('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x55fbd6,_0x39093a,_0x30827e,_0x384281,_0x491539]);let _0x29a561;try{_0x29a561=jwt[_0x1153fe(0x181)]({'userId':_0x37959f['id'],'email':_0x37959f['email']},config[_0x1153fe(0x1a9)],{'expiresIn':'24h'});}catch(_0x47c6be){console['log'](_0x47c6be),_0x4b51c2[_0x1153fe(0x1ba)](0x1f4)[_0x1153fe(0x195)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x4b51c2[_0x1153fe(0x1ba)](0xc8)[_0x1153fe(0x195)]({'success':!![],'data':{'userId':_0x37959f['id'],'username':_0x55fbd6,'first_name':_0x39093a,'last_name':_0x30827e,'email':_0x37959f[_0x1153fe(0x172)],'avatar_url':_0x384281,'token':_0x29a561}});}catch(_0x119859){console[_0x1153fe(0x1b5)]({'err':_0x119859}),_0x4b51c2[_0x1153fe(0x1ba)](0x1f4)['json']({'error':_0x1153fe(0x177)});return;}}),module[a1_0x9c213a(0x183)]=router;