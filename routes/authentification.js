const a1_0x386544=a1_0x2244;(function(_0x33d34c,_0x4e1e82){const _0x7ebc21=a1_0x2244,_0x114e3e=_0x33d34c();while(!![]){try{const _0x4fdafa=-parseInt(_0x7ebc21(0x141))/0x1*(-parseInt(_0x7ebc21(0x140))/0x2)+parseInt(_0x7ebc21(0x130))/0x3+-parseInt(_0x7ebc21(0x109))/0x4*(parseInt(_0x7ebc21(0x148))/0x5)+-parseInt(_0x7ebc21(0x135))/0x6+-parseInt(_0x7ebc21(0x115))/0x7*(parseInt(_0x7ebc21(0x14c))/0x8)+-parseInt(_0x7ebc21(0x121))/0x9*(parseInt(_0x7ebc21(0x10e))/0xa)+parseInt(_0x7ebc21(0x149))/0xb;if(_0x4fdafa===_0x4e1e82)break;else _0x114e3e['push'](_0x114e3e['shift']());}catch(_0x3965b2){_0x114e3e['push'](_0x114e3e['shift']());}}}(a1_0x6c67,0x6db7f));function a1_0x6c67(){const _0x55fa4d=['express','avatars/','Welcome\x20to\x20CADViewer','avatar_url','1222536sVIIRG','jwtSecretKey','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','user','smtpFrom','username','Invalid\x20email\x20or\x20password','message','json','path','copyFileSync','25192ZsiNmE','20FSHaAi','24h','diskStorage','avatars','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','../libs/mysql.js','/validate-email/:token','19905HbklSI','27782909yGNePS','stack','multer','640904YFJbwL','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','/signup','enableEmailVerification','existsSync','is_enabled','sign','../libs/jwt','log','hash','unlinkSync','/update-user-info','execute','===================error===================','.png','776MotyDP','role','Email\x20validated\x20successfully','Invalid\x20password','/validate-email/','90igLLto','bcrypt','promise','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','length','post','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','56GxYLtZ','avatar','mkdirSync','status','verifyToken','email','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','crypted_password','demo_user','exports','ServerUrl','first_name','846162dorOUA','/login','../CADViewer_config.json','last_name','sendMail','compare','crypto','body','./avatars','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','transporter','Error!\x20Something\x20went\x20wrong.','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','file','../libs/mail','404712nKdiwt'];a1_0x6c67=function(){return _0x55fa4d;};return a1_0x6c67();}const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x386544(0x10f)),config=require(a1_0x386544(0x123)),conn=require(a1_0x386544(0x146)),multer=require(a1_0x386544(0x14b)),fs=require('fs'),verifyToken=require(a1_0x386544(0x101))[a1_0x386544(0x119)];!fs[a1_0x386544(0x151)](a1_0x386544(0x129))&&fs[a1_0x386544(0x117)](a1_0x386544(0x129));const express=require(a1_0x386544(0x131)),router=express['Router'](),{randomUUID}=require(a1_0x386544(0x127)),storage=multer[a1_0x386544(0x143)]({'destination':function(_0x59d486,_0x19bc7d,_0x1e8d38){const _0xa9ef47=a1_0x386544;_0x1e8d38(null,_0xa9ef47(0x144));}}),upload=multer({'storage':storage});function a1_0x2244(_0x47f0b5,_0x15d055){const _0x6c6753=a1_0x6c67();return a1_0x2244=function(_0x224470,_0x3ebad9){_0x224470=_0x224470-0x100;let _0x2b0606=_0x6c6753[_0x224470];return _0x2b0606;},a1_0x2244(_0x47f0b5,_0x15d055);}router[a1_0x386544(0x113)](a1_0x386544(0x122),async(_0x438207,_0x2b6c04,_0x21d2b0)=>{const _0x401a3a=a1_0x386544;let {email:_0x3b0ea8,password:_0x49bee9}=_0x438207[_0x401a3a(0x128)];console[_0x401a3a(0x102)]({'email':_0x3b0ea8,'password':_0x49bee9});let _0x529b59;try{const [_0xbd120f]=await conn[_0x401a3a(0x110)]()[_0x401a3a(0x106)](_0x401a3a(0x12a),[_0x3b0ea8]);_0xbd120f[_0x401a3a(0x112)]>0x0&&(_0x529b59=_0xbd120f[0x0]);}catch(_0x47c047){console['log']({'err':_0x47c047}),_0x2b6c04[_0x401a3a(0x118)](0x1f4)[_0x401a3a(0x13d)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x529b59||!await bcrypt[_0x401a3a(0x126)](_0x49bee9,_0x529b59?.['crypted_password'])){_0x2b6c04[_0x401a3a(0x118)](0x191)[_0x401a3a(0x13d)]({'error':_0x401a3a(0x13b)});return;}let _0x144c8f;try{_0x144c8f=jwt[_0x401a3a(0x100)]({'userId':_0x529b59['id'],'email':_0x529b59['email']},config['jwtSecretKey'],{'expiresIn':_0x401a3a(0x142)});}catch(_0x5b5e6a){console[_0x401a3a(0x102)](_0x5b5e6a),_0x2b6c04[_0x401a3a(0x118)](0x1f4)['json']({'error':_0x401a3a(0x12c)});return;}_0x2b6c04[_0x401a3a(0x118)](0xc8)[_0x401a3a(0x13d)]({'success':!![],'data':{'userId':_0x529b59['id'],'username':_0x529b59[_0x401a3a(0x13a)],'first_name':_0x529b59['first_name'],'last_name':_0x529b59[_0x401a3a(0x124)],'email':_0x529b59[_0x401a3a(0x11a)],'avatar_url':_0x529b59['avatar_url'],'id':_0x529b59['id'],'role':_0x529b59['role'],'token':_0x144c8f}});}),router[a1_0x386544(0x113)](a1_0x386544(0x14f),async(_0x98a295,_0x1e1457,_0x4a5dc9)=>{const _0x285ced=a1_0x386544,{username:_0x464650,email:_0x275e3e,password:_0x3dbc69}=_0x98a295[_0x285ced(0x128)],[_0x1ec57a]=await conn[_0x285ced(0x110)]()[_0x285ced(0x106)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x275e3e]);if(_0x1ec57a[_0x285ced(0x112)]>0x0){_0x1e1457[_0x285ced(0x118)](0x1a6)[_0x285ced(0x13d)]({'error':'User\x20already\x20exists'});return;}const _0x18949b=await bcrypt[_0x285ced(0x103)](_0x3dbc69,0xa);let _0x5bcf6e=null,_0xc4c60b=0x1;config[_0x285ced(0x150)]&&(_0x5bcf6e=randomUUID(),_0xc4c60b=0x0);let _0x17a392;try{const _0x446c2d=randomUUID(),_0x4620d1='./uploads/'+_0x446c2d;fs[_0x285ced(0x117)](_0x4620d1);const [_0x2a8ba0]=await conn['promise']()[_0x285ced(0x106)]('INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)',[_0x464650,_0x275e3e,_0x18949b,_0x285ced(0x11d),_0xc4c60b,_0x5bcf6e,_0x446c2d]);if(_0x2a8ba0['insertId']){const [_0x189c77]=await conn[_0x285ced(0x110)]()[_0x285ced(0x106)](_0x285ced(0x14e),[_0x2a8ba0['insertId']]);_0x189c77[_0x285ced(0x112)]>0x0&&(_0x17a392=_0x189c77[0x0]);}}catch{_0x1e1457[_0x285ced(0x118)](0x1f4)[_0x285ced(0x13d)]({'error':_0x285ced(0x12c)});return;}let _0x1b272f;try{_0x1b272f=jwt[_0x285ced(0x100)]({'userId':_0x17a392['id'],'email':_0x17a392[_0x285ced(0x11a)]},config[_0x285ced(0x136)],{'expiresIn':'24h'});}catch(_0x3abe81){_0x1e1457[_0x285ced(0x118)](0x1f4)['json']({'error':_0x285ced(0x12c)});return;}const _0x2a1508=require(_0x285ced(0x12f))[_0x285ced(0x12b)];let _0x4c4620='<p>Welcome\x20to\x20CADViewer</p>';if(config[_0x285ced(0x150)]){const _0x218df9=config['frontendUrl']+_0x285ced(0x10d)+_0x5bcf6e;_0x4c4620=_0x285ced(0x11b)+_0x218df9+_0x285ced(0x114)+_0x218df9+_0x285ced(0x14d);const _0x57e27f={'from':config[_0x285ced(0x139)],'to':_0x17a392[_0x285ced(0x11a)],'subject':_0x285ced(0x133),'text':_0x285ced(0x133),'html':_0x4c4620};try{await _0x2a1508[_0x285ced(0x125)](_0x57e27f);}catch(_0x2ad4a5){console[_0x285ced(0x102)](_0x285ced(0x107)),console[_0x285ced(0x102)](_0x2ad4a5),_0x1e1457[_0x285ced(0x118)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','stack':_0x2ad4a5['stack'],'message':_0x2ad4a5[_0x285ced(0x13c)]});return;}_0x1e1457[_0x285ced(0x118)](0xc8)['json']({'success':!![],'message':'Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account'});return;}_0x1e1457[_0x285ced(0x118)](0xc9)[_0x285ced(0x13d)]({'success':!![],'data':{'userId':_0x17a392['id'],'username':_0x17a392[_0x285ced(0x13a)],'first_name':_0x17a392[_0x285ced(0x120)],'last_name':_0x17a392['last_name'],'email':_0x17a392[_0x285ced(0x11a)],'avatar_url':_0x17a392['avatar_url'],'id':_0x17a392['id'],'role':_0x17a392[_0x285ced(0x10a)],'token':_0x1b272f,'is_enabled':_0x17a392[_0x285ced(0x152)]}});}),router[a1_0x386544(0x113)](a1_0x386544(0x147),async(_0x33e5e2,_0x306a09)=>{const _0x529245=a1_0x386544;try{const {token:_0x10c750}=_0x33e5e2['params'],[_0x2080bf]=await conn[_0x529245(0x110)]()[_0x529245(0x106)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?',[_0x10c750]);if(_0x2080bf[_0x529245(0x112)]===0x0){_0x306a09[_0x529245(0x118)](0x194)['json']({'error':'Invalid\x20validation\x20token'});return;}await conn[_0x529245(0x110)]()[_0x529245(0x106)](_0x529245(0x12d),[_0x10c750]);const _0x2d8362=jwt['sign']({'id':_0x2080bf[0x0]['id'],'email':_0x2080bf[0x0][_0x529245(0x11a)]},config[_0x529245(0x136)],{'expiresIn':_0x529245(0x142)});_0x306a09[_0x529245(0x118)](0xc8)[_0x529245(0x13d)]({'success':!![],'message':_0x529245(0x10b),'data':{'userId':_0x2080bf[0x0]['id'],'username':_0x2080bf[0x0][_0x529245(0x13a)],'first_name':_0x2080bf[0x0][_0x529245(0x120)],'last_name':_0x2080bf[0x0][_0x529245(0x124)],'email':_0x2080bf[0x0][_0x529245(0x11a)],'avatar_url':_0x2080bf[0x0][_0x529245(0x134)],'id':_0x2080bf[0x0]['id'],'role':_0x2080bf[0x0][_0x529245(0x10a)],'token':_0x2d8362,'is_enabled':0x1}});}catch(_0x5128da){console[_0x529245(0x102)](_0x529245(0x107)),console[_0x529245(0x102)](_0x5128da),_0x306a09[_0x529245(0x118)](0x1f4)[_0x529245(0x13d)]({'error':'Error!\x20Something\x20went\x20wrong.','stack':_0x5128da[_0x529245(0x14a)],'message':_0x5128da[_0x529245(0x13c)]});}}),router[a1_0x386544(0x113)]('/update-password',verifyToken,async(_0x441a25,_0x39f703,_0x3a6f27)=>{const _0x79f04a=a1_0x386544,{current_password:_0x3f4e0a,new_password:_0x57f9b7}=_0x441a25[_0x79f04a(0x128)];console[_0x79f04a(0x102)]({'body':_0x441a25['body']});const _0x1fcd88=_0x441a25[_0x79f04a(0x138)]['email'];let _0xe225cf;try{const [_0x4d605a]=await conn[_0x79f04a(0x110)]()[_0x79f04a(0x106)](_0x79f04a(0x137),[_0x1fcd88]);if(_0x4d605a[_0x79f04a(0x112)]>0x0){_0xe225cf=_0x4d605a[0x0];if(!await bcrypt[_0x79f04a(0x126)](_0x3f4e0a,_0xe225cf[_0x79f04a(0x11c)])){_0x39f703[_0x79f04a(0x118)](0x191)[_0x79f04a(0x13d)]({'error':_0x79f04a(0x10c)});return;}const _0x421502=await bcrypt['hash'](_0x57f9b7,0xa);await conn['promise']()[_0x79f04a(0x106)](_0x79f04a(0x145),[_0x421502,_0x1fcd88]),_0x39f703[_0x79f04a(0x118)](0xc8)['json']({'success':!![]});}}catch(_0x1f592f){console[_0x79f04a(0x102)]({'err':_0x1f592f}),_0x39f703['status'](0x1f4)[_0x79f04a(0x13d)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router[a1_0x386544(0x113)](a1_0x386544(0x105),upload['single'](a1_0x386544(0x116)),verifyToken,async(_0x5aff89,_0x97b221,_0x3c451e)=>{const _0x448efb=a1_0x386544,{username:_0x31562d,first_name:_0x17d848,last_name:_0x10e1c8}=_0x5aff89['body'],_0x3f0704=_0x5aff89[_0x448efb(0x138)][_0x448efb(0x11a)];let _0x25cf4e;try{const [_0x418519]=await conn[_0x448efb(0x110)]()[_0x448efb(0x106)](_0x448efb(0x137),[_0x3f0704]);_0x418519[_0x448efb(0x112)]>0x0&&(_0x25cf4e=_0x418519[0x0]);}catch(_0x3195fc){console[_0x448efb(0x102)]({'err':_0x3195fc}),_0x97b221[_0x448efb(0x118)](0x1f4)[_0x448efb(0x13d)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x25cf4e){_0x97b221['status'](0x191)[_0x448efb(0x13d)]({'error':'Invalid\x20user'});return;}console[_0x448efb(0x102)]({'req':_0x5aff89[_0x448efb(0x128)]});let _0x993e68=_0x25cf4e[_0x448efb(0x134)];if(_0x5aff89[_0x448efb(0x12e)]){const _0x5836b1=_0x448efb(0x132)+randomUUID()+_0x448efb(0x108);fs[_0x448efb(0x13f)](_0x5aff89[_0x448efb(0x12e)][_0x448efb(0x13e)],'./'+_0x5836b1),fs[_0x448efb(0x104)](_0x5aff89['file'][_0x448efb(0x13e)]),_0x993e68=config[_0x448efb(0x11f)]+'/'+_0x5836b1;}try{await conn[_0x448efb(0x110)]()[_0x448efb(0x106)](_0x448efb(0x111),[_0x31562d,_0x17d848,_0x10e1c8,_0x993e68,_0x3f0704]);let _0xcc650b;try{_0xcc650b=jwt['sign']({'userId':_0x25cf4e['id'],'email':_0x25cf4e[_0x448efb(0x11a)]},config[_0x448efb(0x136)],{'expiresIn':_0x448efb(0x142)});}catch(_0x27e955){console[_0x448efb(0x102)](_0x27e955),_0x97b221[_0x448efb(0x118)](0x1f4)[_0x448efb(0x13d)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x97b221[_0x448efb(0x118)](0xc8)[_0x448efb(0x13d)]({'success':!![],'data':{'userId':_0x25cf4e['id'],'username':_0x31562d,'first_name':_0x17d848,'last_name':_0x10e1c8,'email':_0x25cf4e[_0x448efb(0x11a)],'avatar_url':_0x993e68,'token':_0xcc650b}});}catch(_0x2b96ce){console[_0x448efb(0x102)]({'err':_0x2b96ce}),_0x97b221['status'](0x1f4)[_0x448efb(0x13d)]({'error':_0x448efb(0x12c)});return;}}),module[a1_0x386544(0x11e)]=router;