function a1_0x44cd(){const _0xa7479d=['languages','Invalid\x20validation\x20token','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','4483896SarBoQ','status','callbackMethod_gatewayUrl_flag','time_zone','demo_user','../CADViewer_config.json','bcrypt','verifyToken','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','27UXjUfr','promise','./avatars','147319hhLzsU','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','insertId','code','axios','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','../libs/mysql.js','13gAJUCA','5VglJKI','is_enabled','post','body','jsonwebtoken','username','6919Cbnmat','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','path','country_name','data','crypto','3QKcKnY','avatar','execute','reCAPTCHA\x20verification\x20error:','sign','7MypNym','city','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','user','params','first_name','compare','length','Invalid\x20email\x20or\x20password','Email\x20validated\x20successfully','https://www.google.com/recaptcha/api/siteverify','stack','unlinkSync','24h','Router','4128690EGlVMC','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','Error\x20parsing\x20geolocation\x20data:','name','copyFileSync','file','/login','role','===================error===================','/signup','region','success','mkdirSync','19570VTeAdQ','last_name','log','/update-password','recaptchaSecretKey','message','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','avatars','avatar_url','email','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','hash','callbackMethod_gatewayUrl','13512Rokgje','Error!\x20Something\x20went\x20wrong.','json','../libs/jwt','19817546FmZxHS','../libs/email-utils','2589068tdFqcY','crypted_password','User\x20already\x20exists','jwtSecretKey','enableEmailVerification','single','error','diskStorage','10EqtlND','multer'];a1_0x44cd=function(){return _0xa7479d;};return a1_0x44cd();}const a1_0x46c430=a1_0x4ea1;(function(_0x17032b,_0x3ef3ed){const _0x4e6ff2=a1_0x4ea1,_0x18f7c9=_0x17032b();while(!![]){try{const _0x1d0af9=-parseInt(_0x4e6ff2(0xa2))/0x1*(parseInt(_0x4e6ff2(0xf2))/0x2)+-parseInt(_0x4e6ff2(0xb6))/0x3*(-parseInt(_0x4e6ff2(0xea))/0x4)+parseInt(_0x4e6ff2(0xaa))/0x5*(-parseInt(_0x4e6ff2(0xca))/0x6)+-parseInt(_0x4e6ff2(0xbb))/0x7*(-parseInt(_0x4e6ff2(0xf7))/0x8)+-parseInt(_0x4e6ff2(0x9f))/0x9*(-parseInt(_0x4e6ff2(0xd7))/0xa)+-parseInt(_0x4e6ff2(0xb0))/0xb*(parseInt(_0x4e6ff2(0xe4))/0xc)+parseInt(_0x4e6ff2(0xa9))/0xd*(parseInt(_0x4e6ff2(0xe8))/0xe);if(_0x1d0af9===_0x3ef3ed)break;else _0x18f7c9['push'](_0x18f7c9['shift']());}catch(_0x4f8241){_0x18f7c9['push'](_0x18f7c9['shift']());}}}(a1_0x44cd,0x79248));function a1_0x4ea1(_0x186fb4,_0xc6c998){const _0x44cdb1=a1_0x44cd();return a1_0x4ea1=function(_0x4ea1ef,_0x30a521){_0x4ea1ef=_0x4ea1ef-0x98;let _0x4f5be1=_0x44cdb1[_0x4ea1ef];return _0x4f5be1;},a1_0x4ea1(_0x186fb4,_0xc6c998);}const jwt=require(a1_0x46c430(0xae)),bcrypt=require(a1_0x46c430(0x9c)),config=require(a1_0x46c430(0x9b)),conn=require(a1_0x46c430(0xa8)),multer=require(a1_0x46c430(0xf3)),fs=require('fs'),verifyToken=require(a1_0x46c430(0xe7))[a1_0x46c430(0x9d)],{sendWelcomeEmail}=require(a1_0x46c430(0xe9)),axios=require(a1_0x46c430(0xa6));!fs['existsSync'](a1_0x46c430(0xa1))&&fs[a1_0x46c430(0xd6)](a1_0x46c430(0xa1));const express=require('express'),router=express[a1_0x46c430(0xc9)](),{randomUUID}=require(a1_0x46c430(0xb5)),storage=multer[a1_0x46c430(0xf1)]({'destination':function(_0x17f1b8,_0x48263,_0x1d34ff){const _0x217df1=a1_0x46c430;_0x1d34ff(null,_0x217df1(0xde));}}),upload=multer({'storage':storage});router[a1_0x46c430(0xac)](a1_0x46c430(0xd0),async(_0x53327c,_0x3137e4,_0x4e0e73)=>{const _0x155d7c=a1_0x46c430;let {email:_0x2d8732,password:_0x3886b1}=_0x53327c[_0x155d7c(0xad)];console[_0x155d7c(0xd9)]({'email':_0x2d8732,'password':_0x3886b1});let _0x2f762e;try{const [_0x5e1f60]=await conn[_0x155d7c(0xa0)]()[_0x155d7c(0xb8)](_0x155d7c(0xbd),[_0x2d8732]);_0x5e1f60[_0x155d7c(0xc2)]>0x0&&(_0x2f762e=_0x5e1f60[0x0]);}catch(_0x1bbe3a){console[_0x155d7c(0xd9)]({'err':_0x1bbe3a}),_0x3137e4[_0x155d7c(0xf8)](0x1f4)[_0x155d7c(0xe6)]({'error':_0x155d7c(0xe5)});return;}if(!_0x2f762e||!await bcrypt['compare'](_0x3886b1,_0x2f762e?.[_0x155d7c(0xeb)])){_0x3137e4['status'](0x191)[_0x155d7c(0xe6)]({'error':_0x155d7c(0xc3)});return;}let _0x5451f7;try{_0x5451f7=jwt[_0x155d7c(0xba)]({'userId':_0x2f762e['id'],'email':_0x2f762e[_0x155d7c(0xe0)]},config[_0x155d7c(0xed)],{'expiresIn':_0x155d7c(0xc8)});}catch(_0xc23aba){console[_0x155d7c(0xd9)](_0xc23aba),_0x3137e4[_0x155d7c(0xf8)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x3137e4[_0x155d7c(0xf8)](0xc8)['json']({'success':!![],'data':{'userId':_0x2f762e['id'],'username':_0x2f762e[_0x155d7c(0xaf)],'first_name':_0x2f762e[_0x155d7c(0xc0)],'last_name':_0x2f762e[_0x155d7c(0xd8)],'email':_0x2f762e['email'],'avatar_url':_0x2f762e[_0x155d7c(0xdf)],'id':_0x2f762e['id'],'role':_0x2f762e[_0x155d7c(0xd1)],'token':_0x5451f7}});}),router['post'](a1_0x46c430(0xd3),async(_0x31fd28,_0x45379b,_0x3de258)=>{const _0x17b7c0=a1_0x46c430,{username:_0x25c505,email:_0x3b59c3,password:_0x286229,geolocation:_0x375147,recaptchaToken:_0xa9e39d}=_0x31fd28[_0x17b7c0(0xad)];if(config['recaptchaEnabled']){if(!_0xa9e39d)return _0x45379b[_0x17b7c0(0xf8)](0x190)[_0x17b7c0(0xe6)]({'error':_0x17b7c0(0xa7)});try{const _0x3ca7b4=await axios['post'](_0x17b7c0(0xc5),null,{'params':{'secret':config[_0x17b7c0(0xdb)],'response':_0xa9e39d}});if(!_0x3ca7b4[_0x17b7c0(0xb4)][_0x17b7c0(0xd5)])return _0x45379b[_0x17b7c0(0xf8)](0x190)['json']({'error':_0x17b7c0(0xa7),'recaptchaErrors':_0x3ca7b4[_0x17b7c0(0xb4)]['error-codes']});}catch(_0x493376){return console[_0x17b7c0(0xf0)](_0x17b7c0(0xb9),_0x493376),_0x45379b[_0x17b7c0(0xf8)](0x1f4)['json']({'error':'Error\x20during\x20reCAPTCHA\x20verification.'});}}const [_0x4915ae]=await conn[_0x17b7c0(0xa0)]()[_0x17b7c0(0xb8)](_0x17b7c0(0xe1),[_0x3b59c3]);if(_0x4915ae[_0x17b7c0(0xc2)]>0x0){_0x45379b['status'](0x1a6)[_0x17b7c0(0xe6)]({'error':_0x17b7c0(0xec)});return;}const _0x3c65ae=await bcrypt[_0x17b7c0(0xe2)](_0x286229,0xa);let _0x562410=null,_0x36dbbe=0x1;config[_0x17b7c0(0xee)]&&(_0x562410=randomUUID(),_0x36dbbe=0x0);let _0x7fe1ff=null,_0x4731d3=null,_0x3cf6f6=null,_0x459b2c=null,_0x527d56=null,_0x525c0e=null;if(_0x375147)try{const _0x5e7118=_0x375147;_0x7fe1ff=_0x5e7118[_0x17b7c0(0xbc)]||null,_0x4731d3=_0x5e7118[_0x17b7c0(0xd4)]||null,_0x3cf6f6=_0x5e7118[_0x17b7c0(0xb3)]||null,_0x5e7118[_0x17b7c0(0xf4)]&&_0x5e7118[_0x17b7c0(0xf4)][_0x17b7c0(0xc2)]>0x0&&(_0x459b2c=_0x5e7118['languages'][0x0][_0x17b7c0(0xa5)]||null,_0x527d56=_0x5e7118[_0x17b7c0(0xf4)][0x0][_0x17b7c0(0xcd)]||null),_0x5e7118[_0x17b7c0(0x99)]&&(_0x525c0e=_0x5e7118[_0x17b7c0(0x99)][_0x17b7c0(0xcd)]||null);}catch(_0x49b142){console['log'](_0x17b7c0(0xcc),_0x49b142);}let _0x1be8b7;try{const _0x55d960=randomUUID(),_0x465c86='./uploads/'+_0x55d960;fs['mkdirSync'](_0x465c86);const [_0x426c2e]=await conn[_0x17b7c0(0xa0)]()[_0x17b7c0(0xb8)]('INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)',[_0x25c505,_0x3b59c3,_0x3c65ae,_0x17b7c0(0x9a),_0x36dbbe,_0x562410,_0x55d960,_0x7fe1ff,_0x4731d3,_0x3cf6f6,_0x459b2c,_0x527d56,_0x525c0e]);if(_0x426c2e[_0x17b7c0(0xa4)]){const [_0x213f0d]=await conn[_0x17b7c0(0xa0)]()[_0x17b7c0(0xb8)](_0x17b7c0(0xb1),[_0x426c2e[_0x17b7c0(0xa4)]]);_0x213f0d[_0x17b7c0(0xc2)]>0x0&&(_0x1be8b7=_0x213f0d[0x0]);}}catch(_0x585758){console['log']('Error\x20during\x20user\x20creation:',_0x585758),_0x45379b['status'](0x1f4)[_0x17b7c0(0xe6)]({'error':_0x17b7c0(0xe5)});return;}let _0x116b9a;try{_0x116b9a=jwt[_0x17b7c0(0xba)]({'userId':_0x1be8b7['id'],'email':_0x1be8b7[_0x17b7c0(0xe0)]},config[_0x17b7c0(0xed)],{'expiresIn':_0x17b7c0(0xc8)});}catch(_0x487524){_0x45379b[_0x17b7c0(0xf8)](0x1f4)[_0x17b7c0(0xe6)]({'error':_0x17b7c0(0xe5)});return;}if(config[_0x17b7c0(0xee)]){try{await sendWelcomeEmail(_0x1be8b7,_0x562410);}catch(_0x3fb57c){console[_0x17b7c0(0xd9)](_0x17b7c0(0xd2)),console[_0x17b7c0(0xd9)](_0x3fb57c);}_0x45379b['status'](0xc8)['json']({'success':!![],'message':_0x17b7c0(0xf6)});return;}_0x45379b[_0x17b7c0(0xf8)](0xc9)[_0x17b7c0(0xe6)]({'success':!![],'data':{'userId':_0x1be8b7['id'],'username':_0x1be8b7[_0x17b7c0(0xaf)],'first_name':_0x1be8b7['first_name'],'last_name':_0x1be8b7[_0x17b7c0(0xd8)],'email':_0x1be8b7[_0x17b7c0(0xe0)],'avatar_url':_0x1be8b7['avatar_url'],'id':_0x1be8b7['id'],'role':_0x1be8b7[_0x17b7c0(0xd1)],'token':_0x116b9a,'is_enabled':_0x1be8b7[_0x17b7c0(0xab)]}});}),router[a1_0x46c430(0xac)]('/validate-email/:token',async(_0x45ca4e,_0x151ba2)=>{const _0x5ce868=a1_0x46c430;try{const {token:_0x5e161c}=_0x45ca4e[_0x5ce868(0xbf)],[_0x3e8c3d]=await conn[_0x5ce868(0xa0)]()['execute'](_0x5ce868(0x9e),[_0x5e161c]);if(_0x3e8c3d[_0x5ce868(0xc2)]===0x0){_0x151ba2[_0x5ce868(0xf8)](0x194)[_0x5ce868(0xe6)]({'error':_0x5ce868(0xf5)});return;}await conn[_0x5ce868(0xa0)]()[_0x5ce868(0xb8)](_0x5ce868(0xa3),[_0x5e161c]);const _0x4277e1=jwt[_0x5ce868(0xba)]({'id':_0x3e8c3d[0x0]['id'],'email':_0x3e8c3d[0x0][_0x5ce868(0xe0)]},config['jwtSecretKey'],{'expiresIn':_0x5ce868(0xc8)});_0x151ba2[_0x5ce868(0xf8)](0xc8)[_0x5ce868(0xe6)]({'success':!![],'message':_0x5ce868(0xc4),'data':{'userId':_0x3e8c3d[0x0]['id'],'username':_0x3e8c3d[0x0][_0x5ce868(0xaf)],'first_name':_0x3e8c3d[0x0][_0x5ce868(0xc0)],'last_name':_0x3e8c3d[0x0][_0x5ce868(0xd8)],'email':_0x3e8c3d[0x0][_0x5ce868(0xe0)],'avatar_url':_0x3e8c3d[0x0][_0x5ce868(0xdf)],'id':_0x3e8c3d[0x0]['id'],'role':_0x3e8c3d[0x0][_0x5ce868(0xd1)],'token':_0x4277e1,'is_enabled':0x1}});}catch(_0x34edc6){console[_0x5ce868(0xd9)](_0x5ce868(0xd2)),console['log'](_0x34edc6),_0x151ba2[_0x5ce868(0xf8)](0x1f4)[_0x5ce868(0xe6)]({'error':_0x5ce868(0xe5),'stack':_0x34edc6[_0x5ce868(0xc6)],'message':_0x34edc6[_0x5ce868(0xdc)]});}}),router['post'](a1_0x46c430(0xda),verifyToken,async(_0x598b2f,_0x1446bd,_0x316a3b)=>{const _0x4e8df1=a1_0x46c430,{current_password:_0x3b05a3,new_password:_0x209956}=_0x598b2f['body'];console[_0x4e8df1(0xd9)]({'body':_0x598b2f[_0x4e8df1(0xad)]});const _0x3e9f3e=_0x598b2f['user'][_0x4e8df1(0xe0)];let _0x54e639;try{const [_0x4899c8]=await conn['promise']()[_0x4e8df1(0xb8)](_0x4e8df1(0xe1),[_0x3e9f3e]);if(_0x4899c8[_0x4e8df1(0xc2)]>0x0){_0x54e639=_0x4899c8[0x0];if(!await bcrypt[_0x4e8df1(0xc1)](_0x3b05a3,_0x54e639[_0x4e8df1(0xeb)])){_0x1446bd[_0x4e8df1(0xf8)](0x191)['json']({'error':'Invalid\x20password'});return;}const _0xf15748=await bcrypt['hash'](_0x209956,0xa);await conn['promise']()[_0x4e8df1(0xb8)](_0x4e8df1(0xcb),[_0xf15748,_0x3e9f3e]),_0x1446bd['status'](0xc8)[_0x4e8df1(0xe6)]({'success':!![]});}}catch(_0x5667ee){console[_0x4e8df1(0xd9)]({'err':_0x5667ee}),_0x1446bd[_0x4e8df1(0xf8)](0x1f4)[_0x4e8df1(0xe6)]({'error':_0x4e8df1(0xe5)});return;}}),router[a1_0x46c430(0xac)]('/update-user-info',upload[a1_0x46c430(0xef)](a1_0x46c430(0xb7)),verifyToken,async(_0xafc378,_0x22cb91,_0x5572d1)=>{const _0x29d1eb=a1_0x46c430,{username:_0x1def7a,first_name:_0x5d8ae9,last_name:_0x2acdd1}=_0xafc378[_0x29d1eb(0xad)],_0xd06571=_0xafc378[_0x29d1eb(0xbe)][_0x29d1eb(0xe0)];let _0xb11eb;try{const [_0x2446b8]=await conn[_0x29d1eb(0xa0)]()['execute'](_0x29d1eb(0xe1),[_0xd06571]);_0x2446b8[_0x29d1eb(0xc2)]>0x0&&(_0xb11eb=_0x2446b8[0x0]);}catch(_0xd806c7){console[_0x29d1eb(0xd9)]({'err':_0xd806c7}),_0x22cb91[_0x29d1eb(0xf8)](0x1f4)[_0x29d1eb(0xe6)]({'error':_0x29d1eb(0xe5)});return;}if(!_0xb11eb){_0x22cb91[_0x29d1eb(0xf8)](0x191)[_0x29d1eb(0xe6)]({'error':'Invalid\x20user'});return;}console[_0x29d1eb(0xd9)]({'req':_0xafc378['body']});let _0x43329e=_0xb11eb[_0x29d1eb(0xdf)];if(_0xafc378['file']){const _0x3efaa5='avatars/'+randomUUID()+'.png';fs[_0x29d1eb(0xce)](_0xafc378[_0x29d1eb(0xcf)]['path'],'./'+_0x3efaa5),fs[_0x29d1eb(0xc7)](_0xafc378[_0x29d1eb(0xcf)][_0x29d1eb(0xb2)]),config[_0x29d1eb(0x98)]?_0x43329e=config[_0x29d1eb(0xe3)]+'/'+_0x3efaa5:_0x43329e=config['ServerUrl']+'/'+_0x3efaa5;}try{await conn[_0x29d1eb(0xa0)]()[_0x29d1eb(0xb8)](_0x29d1eb(0xdd),[_0x1def7a,_0x5d8ae9,_0x2acdd1,_0x43329e,_0xd06571]);let _0x636830;try{_0x636830=jwt[_0x29d1eb(0xba)]({'userId':_0xb11eb['id'],'email':_0xb11eb['email']},config[_0x29d1eb(0xed)],{'expiresIn':_0x29d1eb(0xc8)});}catch(_0x3b5277){console[_0x29d1eb(0xd9)](_0x3b5277),_0x22cb91[_0x29d1eb(0xf8)](0x1f4)[_0x29d1eb(0xe6)]({'error':_0x29d1eb(0xe5)});return;}_0x22cb91[_0x29d1eb(0xf8)](0xc8)['json']({'success':!![],'data':{'userId':_0xb11eb['id'],'username':_0x1def7a,'first_name':_0x5d8ae9,'last_name':_0x2acdd1,'email':_0xb11eb[_0x29d1eb(0xe0)],'avatar_url':_0x43329e,'token':_0x636830}});}catch(_0x304ef0){console[_0x29d1eb(0xd9)]({'err':_0x304ef0}),_0x22cb91['status'](0x1f4)[_0x29d1eb(0xe6)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module['exports']=router;