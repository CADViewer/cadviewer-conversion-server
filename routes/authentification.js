function a1_0x4f85(){const _0x2157fa=['avatar_url','first_name','response','../libs/mail','log','22451370IdaYjG','verifyToken','Router','21RAWzWt','./avatars','enableEmailVerification','avatars/','smtpFrom','1087593wkOspA','sign','frontendUrl','single','1842mqpWuv','.png','post','hash','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','path','jwtSecretKey','5144696ONaQyK','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','params','User\x20already\x20exists','existsSync','/validate-email/','Welcome\x20to\x20CADViewer','email','length','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','username','diskStorage','avatar','1563ZlXbFP','exports','transporter','file','express','jsonwebtoken','11855XGrLjh','user','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','/update-password','Email\x20validated\x20successfully','insertId','Invalid\x20password','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','json','1886luBvmx','promise','last_name','body','compare','/validate-email/:token','mkdirSync','role','/login','execute','Error!\x20Something\x20went\x20wrong.','Email\x20sent:\x20','crypted_password','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','Invalid\x20email\x20or\x20password','ServerUrl','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','4081624aSwmUy','14223978KZlRSd','status','24h','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?'];a1_0x4f85=function(){return _0x2157fa;};return a1_0x4f85();}function a1_0x3440(_0x2ca01e,_0x35afde){const _0x4f855b=a1_0x4f85();return a1_0x3440=function(_0x344009,_0x76ec10){_0x344009=_0x344009-0x1bb;let _0x1424ab=_0x4f855b[_0x344009];return _0x1424ab;},a1_0x3440(_0x2ca01e,_0x35afde);}const a1_0x2f2bd0=a1_0x3440;(function(_0x3f13f3,_0x1b1225){const _0x6587d5=a1_0x3440,_0x4091cf=_0x3f13f3();while(!![]){try{const _0xd62217=parseInt(_0x6587d5(0x1e4))/0x1*(parseInt(_0x6587d5(0x1f3))/0x2)+parseInt(_0x6587d5(0x1cc))/0x3+parseInt(_0x6587d5(0x204))/0x4+parseInt(_0x6587d5(0x1ea))/0x5*(parseInt(_0x6587d5(0x1d0))/0x6)+parseInt(_0x6587d5(0x1c7))/0x7*(-parseInt(_0x6587d5(0x1d7))/0x8)+parseInt(_0x6587d5(0x1bb))/0x9+-parseInt(_0x6587d5(0x1c4))/0xa;if(_0xd62217===_0x1b1225)break;else _0x4091cf['push'](_0x4091cf['shift']());}catch(_0x26f761){_0x4091cf['push'](_0x4091cf['shift']());}}}(a1_0x4f85,0xf1e43));const jwt=require(a1_0x2f2bd0(0x1e9)),bcrypt=require('bcrypt'),config=require('../CADViewer_config.json'),conn=require('../libs/mysql.js'),multer=require('multer'),fs=require('fs'),verifyToken=require('../libs/jwt')[a1_0x2f2bd0(0x1c5)];!fs[a1_0x2f2bd0(0x1db)](a1_0x2f2bd0(0x1c8))&&fs[a1_0x2f2bd0(0x1f9)](a1_0x2f2bd0(0x1c8));const express=require(a1_0x2f2bd0(0x1e8)),router=express[a1_0x2f2bd0(0x1c6)](),{randomUUID}=require('crypto'),storage=multer[a1_0x2f2bd0(0x1e2)]({'destination':function(_0x11c63c,_0x42fe42,_0x8fc90a){_0x8fc90a(null,'avatars');}}),upload=multer({'storage':storage});router['post'](a1_0x2f2bd0(0x1fb),async(_0x21d1e0,_0x399171,_0xd61403)=>{const _0x179ee0=a1_0x2f2bd0;let {email:_0x4c9531,password:_0x4e6ad2}=_0x21d1e0[_0x179ee0(0x1f6)];console[_0x179ee0(0x1c3)]({'email':_0x4c9531,'password':_0x4e6ad2});let _0x23792e;try{const [_0x1b9234]=await conn['promise']()[_0x179ee0(0x1fc)](_0x179ee0(0x1d8),[_0x4c9531]);_0x1b9234['length']>0x0&&(_0x23792e=_0x1b9234[0x0]);}catch(_0x4c6db6){console[_0x179ee0(0x1c3)]({'err':_0x4c6db6}),_0x399171[_0x179ee0(0x1bc)](0x1f4)[_0x179ee0(0x1f2)]({'error':_0x179ee0(0x1fd)});return;}console[_0x179ee0(0x1c3)](_0x23792e),console[_0x179ee0(0x1c3)](_0x4e6ad2),console['log'](_0x23792e[_0x179ee0(0x1ff)]);if(!_0x23792e||!await bcrypt['compare'](_0x4e6ad2,_0x23792e[_0x179ee0(0x1ff)])){_0x399171['status'](0x191)[_0x179ee0(0x1f2)]({'error':_0x179ee0(0x201)});return;}let _0x3f8812;try{_0x3f8812=jwt['sign']({'userId':_0x23792e['id'],'email':_0x23792e['email']},config['jwtSecretKey'],{'expiresIn':_0x179ee0(0x1bd)});}catch(_0x4eb41b){console['log'](_0x4eb41b),_0x399171[_0x179ee0(0x1bc)](0x1f4)[_0x179ee0(0x1f2)]({'error':_0x179ee0(0x1fd)});return;}_0x399171[_0x179ee0(0x1bc)](0xc8)['json']({'success':!![],'data':{'userId':_0x23792e['id'],'username':_0x23792e[_0x179ee0(0x1e1)],'first_name':_0x23792e[_0x179ee0(0x1c0)],'last_name':_0x23792e[_0x179ee0(0x1f5)],'email':_0x23792e[_0x179ee0(0x1de)],'avatar_url':_0x23792e[_0x179ee0(0x1bf)],'id':_0x23792e['id'],'role':_0x23792e['role'],'token':_0x3f8812}});}),router['post']('/signup',async(_0x5e0a56,_0x2e9f96,_0xa114fd)=>{const _0x4d127d=a1_0x2f2bd0,{username:_0x1a1823,email:_0x65088c,password:_0x3f1e95}=_0x5e0a56[_0x4d127d(0x1f6)],[_0x27a47b]=await conn[_0x4d127d(0x1f4)]()[_0x4d127d(0x1fc)](_0x4d127d(0x1e0),[_0x65088c]);if(_0x27a47b['length']>0x0){_0x2e9f96['status'](0x1a6)[_0x4d127d(0x1f2)]({'error':_0x4d127d(0x1da)});return;}const _0x24ce70=await bcrypt[_0x4d127d(0x1d3)](_0x3f1e95,0xa);let _0x5d2997=null,_0x278ff8=0x1;config[_0x4d127d(0x1c9)]&&(_0x5d2997=randomUUID(),_0x278ff8=0x0);let _0x204ffa;try{const [_0x2e747b]=await conn[_0x4d127d(0x1f4)]()[_0x4d127d(0x1fc)]('INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)',[_0x1a1823,_0x65088c,_0x24ce70,_0x4d127d(0x1eb),_0x278ff8,_0x5d2997]);if(_0x2e747b[_0x4d127d(0x1ef)]){const [_0x41ebf7]=await conn['promise']()['execute'](_0x4d127d(0x1be),[_0x2e747b[_0x4d127d(0x1ef)]]);_0x41ebf7[_0x4d127d(0x1df)]>0x0&&(_0x204ffa=_0x41ebf7[0x0]);}}catch{_0x2e9f96[_0x4d127d(0x1bc)](0x1f4)[_0x4d127d(0x1f2)]({'error':_0x4d127d(0x1fd)});return;}let _0x3ca3e3;try{_0x3ca3e3=jwt[_0x4d127d(0x1cd)]({'userId':_0x204ffa['id'],'email':_0x204ffa[_0x4d127d(0x1de)]},config[_0x4d127d(0x1d6)],{'expiresIn':_0x4d127d(0x1bd)});}catch(_0x23cd12){_0x2e9f96[_0x4d127d(0x1bc)](0x1f4)[_0x4d127d(0x1f2)]({'error':_0x4d127d(0x1fd)});return;}const _0x5d7524=require(_0x4d127d(0x1c2))[_0x4d127d(0x1e6)];let _0x597664='<p>Welcome\x20to\x20CADViewer</p>';if(config[_0x4d127d(0x1c9)]){const _0x10eab2=config[_0x4d127d(0x1ce)]+_0x4d127d(0x1dc)+_0x5d2997;_0x597664=_0x4d127d(0x200)+_0x10eab2+_0x4d127d(0x203)+_0x10eab2+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20';const _0x417896={'from':config[_0x4d127d(0x1cb)],'to':_0x204ffa[_0x4d127d(0x1de)],'subject':_0x4d127d(0x1dd),'text':'Welcome\x20to\x20CADViewer','html':_0x597664};_0x5d7524['sendMail'](_0x417896,(_0x4f3f6a,_0x1c0a8e)=>{const _0x19405b=_0x4d127d;_0x4f3f6a?console[_0x19405b(0x1c3)](_0x4f3f6a):console[_0x19405b(0x1c3)](_0x19405b(0x1fe)+_0x1c0a8e[_0x19405b(0x1c1)]);}),_0x2e9f96['status'](0xc8)[_0x4d127d(0x1f2)]({'success':!![],'message':'Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account'});return;}_0x2e9f96[_0x4d127d(0x1bc)](0xc9)[_0x4d127d(0x1f2)]({'success':!![],'data':{'userId':_0x204ffa['id'],'username':_0x204ffa[_0x4d127d(0x1e1)],'first_name':_0x204ffa[_0x4d127d(0x1c0)],'last_name':_0x204ffa[_0x4d127d(0x1f5)],'email':_0x204ffa[_0x4d127d(0x1de)],'avatar_url':_0x204ffa['avatar_url'],'id':_0x204ffa['id'],'role':_0x204ffa[_0x4d127d(0x1fa)],'token':_0x3ca3e3,'is_enabled':_0x204ffa['is_enabled']}});}),router[a1_0x2f2bd0(0x1d2)](a1_0x2f2bd0(0x1f8),async(_0x52d1d1,_0x5ed0fe)=>{const _0x33258e=a1_0x2f2bd0;try{const {token:_0x4c332b}=_0x52d1d1[_0x33258e(0x1d9)],[_0x5d9efd]=await conn[_0x33258e(0x1f4)]()[_0x33258e(0x1fc)](_0x33258e(0x1ec),[_0x4c332b]);if(_0x5d9efd['length']===0x0){_0x5ed0fe[_0x33258e(0x1bc)](0x194)[_0x33258e(0x1f2)]({'error':'Invalid\x20validation\x20token'});return;}await conn[_0x33258e(0x1f4)]()['execute']('UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL\x20WHERE\x20`validation_token`\x20=\x20?',[_0x4c332b]);const _0x5549ac=jwt['sign']({'id':_0x5d9efd[0x0]['id'],'email':_0x5d9efd[0x0][_0x33258e(0x1de)]},config[_0x33258e(0x1d6)],{'expiresIn':_0x33258e(0x1bd)});_0x5ed0fe[_0x33258e(0x1bc)](0xc8)[_0x33258e(0x1f2)]({'success':!![],'message':_0x33258e(0x1ee),'data':{'userId':_0x5d9efd[0x0]['id'],'username':_0x5d9efd[0x0][_0x33258e(0x1e1)],'first_name':_0x5d9efd[0x0]['first_name'],'last_name':_0x5d9efd[0x0]['last_name'],'email':_0x5d9efd[0x0][_0x33258e(0x1de)],'avatar_url':_0x5d9efd[0x0][_0x33258e(0x1bf)],'id':_0x5d9efd[0x0]['id'],'role':_0x5d9efd[0x0][_0x33258e(0x1fa)],'token':_0x5549ac,'is_enabled':0x1}});}catch(_0x224b6b){console[_0x33258e(0x1c3)](_0x224b6b),_0x5ed0fe[_0x33258e(0x1bc)](0x1f4)[_0x33258e(0x1f2)]({'error':_0x33258e(0x1fd)});}}),router[a1_0x2f2bd0(0x1d2)](a1_0x2f2bd0(0x1ed),verifyToken,async(_0x555247,_0x75efd8,_0x1300f0)=>{const _0x488620=a1_0x2f2bd0,{current_password:_0xd7f213,new_password:_0x35c911}=_0x555247[_0x488620(0x1f6)];console['log']({'body':_0x555247[_0x488620(0x1f6)]});const _0x4c3ecf=_0x555247[_0x488620(0x1eb)][_0x488620(0x1de)];let _0x589b2d;try{const [_0x4207e6]=await conn[_0x488620(0x1f4)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x4c3ecf]);if(_0x4207e6['length']>0x0){_0x589b2d=_0x4207e6[0x0];if(!await bcrypt[_0x488620(0x1f7)](_0xd7f213,_0x589b2d[_0x488620(0x1ff)])){_0x75efd8[_0x488620(0x1bc)](0x191)[_0x488620(0x1f2)]({'error':_0x488620(0x1f0)});return;}const _0x59f9e2=await bcrypt[_0x488620(0x1d3)](_0x35c911,0xa);await conn[_0x488620(0x1f4)]()[_0x488620(0x1fc)](_0x488620(0x1d4),[_0x59f9e2,_0x4c3ecf]),_0x75efd8[_0x488620(0x1bc)](0xc8)[_0x488620(0x1f2)]({'success':!![]});}}catch(_0x1e0283){console[_0x488620(0x1c3)]({'err':_0x1e0283}),_0x75efd8[_0x488620(0x1bc)](0x1f4)[_0x488620(0x1f2)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router['post']('/update-user-info',upload[a1_0x2f2bd0(0x1cf)](a1_0x2f2bd0(0x1e3)),verifyToken,async(_0x2d970b,_0x78b2a5,_0x1cbe11)=>{const _0x3c341a=a1_0x2f2bd0,{username:_0x76bd56,first_name:_0x384a99,last_name:_0x21f387}=_0x2d970b[_0x3c341a(0x1f6)],_0x30fa0c=_0x2d970b[_0x3c341a(0x1eb)][_0x3c341a(0x1de)];let _0x32436f;try{const [_0x4f41ff]=await conn['promise']()[_0x3c341a(0x1fc)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x30fa0c]);_0x4f41ff[_0x3c341a(0x1df)]>0x0&&(_0x32436f=_0x4f41ff[0x0]);}catch(_0x147d76){console[_0x3c341a(0x1c3)]({'err':_0x147d76}),_0x78b2a5[_0x3c341a(0x1bc)](0x1f4)[_0x3c341a(0x1f2)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x32436f){_0x78b2a5[_0x3c341a(0x1bc)](0x191)[_0x3c341a(0x1f2)]({'error':'Invalid\x20user'});return;}console[_0x3c341a(0x1c3)]({'req':_0x2d970b[_0x3c341a(0x1f6)]});let _0x29ba02=_0x32436f[_0x3c341a(0x1bf)];if(_0x2d970b[_0x3c341a(0x1e7)]){const _0x464f8e=_0x3c341a(0x1ca)+randomUUID()+_0x3c341a(0x1d1);fs['renameSync'](_0x2d970b[_0x3c341a(0x1e7)][_0x3c341a(0x1d5)],'./'+_0x464f8e),_0x29ba02=config[_0x3c341a(0x202)]+'/'+_0x464f8e;}try{await conn['promise']()[_0x3c341a(0x1fc)](_0x3c341a(0x1f1),[_0x76bd56,_0x384a99,_0x21f387,_0x29ba02,_0x30fa0c]);let _0x2bdc7c;try{_0x2bdc7c=jwt[_0x3c341a(0x1cd)]({'userId':_0x32436f['id'],'email':_0x32436f[_0x3c341a(0x1de)]},config[_0x3c341a(0x1d6)],{'expiresIn':_0x3c341a(0x1bd)});}catch(_0x5d5c38){console[_0x3c341a(0x1c3)](_0x5d5c38),_0x78b2a5[_0x3c341a(0x1bc)](0x1f4)[_0x3c341a(0x1f2)]({'error':_0x3c341a(0x1fd)});return;}_0x78b2a5['status'](0xc8)[_0x3c341a(0x1f2)]({'success':!![],'data':{'userId':_0x32436f['id'],'username':_0x76bd56,'first_name':_0x384a99,'last_name':_0x21f387,'email':_0x32436f[_0x3c341a(0x1de)],'avatar_url':_0x29ba02,'token':_0x2bdc7c}});}catch(_0x5cefd1){console['log']({'err':_0x5cefd1}),_0x78b2a5[_0x3c341a(0x1bc)](0x1f4)[_0x3c341a(0x1f2)]({'error':_0x3c341a(0x1fd)});return;}}),module[a1_0x2f2bd0(0x1e5)]=router;