const a1_0x25514b=a1_0x8adf;function a1_0x8adf(_0x25bfb5,_0x35a5d1){const _0xd73580=a1_0xd735();return a1_0x8adf=function(_0x8adf8f,_0x41e866){_0x8adf8f=_0x8adf8f-0x1d0;let _0x539467=_0xd73580[_0x8adf8f];return _0x539467;},a1_0x8adf(_0x25bfb5,_0x35a5d1);}(function(_0x12d8d9,_0x2a020e){const _0x5da127=a1_0x8adf,_0x3ef7ba=_0x12d8d9();while(!![]){try{const _0x2281a5=-parseInt(_0x5da127(0x20a))/0x1+-parseInt(_0x5da127(0x1f3))/0x2*(-parseInt(_0x5da127(0x1e7))/0x3)+parseInt(_0x5da127(0x1fe))/0x4+parseInt(_0x5da127(0x1f8))/0x5+parseInt(_0x5da127(0x207))/0x6+-parseInt(_0x5da127(0x1ec))/0x7+-parseInt(_0x5da127(0x1da))/0x8;if(_0x2281a5===_0x2a020e)break;else _0x3ef7ba['push'](_0x3ef7ba['shift']());}catch(_0x2e03f0){_0x3ef7ba['push'](_0x3ef7ba['shift']());}}}(a1_0xd735,0x25c0f));const jwt=require(a1_0x25514b(0x204)),bcrypt=require(a1_0x25514b(0x1db)),config=require('../CADViewer_config.json'),conn=require('../libs/mysql.js'),multer=require(a1_0x25514b(0x1f9)),fs=require('fs'),verifyToken=require(a1_0x25514b(0x1d4))[a1_0x25514b(0x20c)];!fs['existsSync'](a1_0x25514b(0x1e5))&&fs[a1_0x25514b(0x1e4)](a1_0x25514b(0x1e5));const express=require(a1_0x25514b(0x20b)),router=express[a1_0x25514b(0x206)](),{randomUUID}=require(a1_0x25514b(0x1e1)),storage=multer[a1_0x25514b(0x1e0)]({'destination':function(_0x21a767,_0x5d3e4a,_0x3c92e0){_0x3c92e0(null,'avatars');}}),upload=multer({'storage':storage});function a1_0xd735(){const _0x5adacd=['INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','/update-password','log','diskStorage','crypto','avatars/','/update-user-info','mkdirSync','./avatars','/signup','280503sXIYul','email','24h','hash','insertId','34384zCkrnc','ServerUrl','status','path','Invalid\x20password','file','json','6yLirPi','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','/login','first_name','jwtSecretKey','1393445izDEBt','multer','avatar','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','Error!\x20Something\x20went\x20wrong.','compare','1043524PZsXTP','post','body','sign','last_name','length','jsonwebtoken','role','Router','1627998ojbMDG','User\x20already\x20exists','username','235512bHLZvX','express','verifyToken','avatar_url','exports','crypted_password','renameSync','single','../libs/jwt','execute','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','.png','user','5570744bwWfVe','bcrypt','promise'];a1_0xd735=function(){return _0x5adacd;};return a1_0xd735();}router[a1_0x25514b(0x1ff)](a1_0x25514b(0x1f5),async(_0x475fb4,_0x50ae1f,_0x9f1553)=>{const _0x4db88e=a1_0x25514b;let {email:_0x3281cc,password:_0x3ef78b}=_0x475fb4['body'];console['log']({'email':_0x3281cc,'password':_0x3ef78b});let _0x3bd41a;try{const [_0x42af76]=await conn['promise']()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?',[_0x3281cc]);_0x42af76[_0x4db88e(0x203)]>0x0&&(_0x3bd41a=_0x42af76[0x0]);}catch(_0x43788d){console['log']({'err':_0x43788d}),_0x50ae1f[_0x4db88e(0x1ee)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}console['log'](_0x3bd41a),console[_0x4db88e(0x1df)](_0x3ef78b),console[_0x4db88e(0x1df)](_0x3bd41a[_0x4db88e(0x1d1)]);if(!_0x3bd41a||!await bcrypt['compare'](_0x3ef78b,_0x3bd41a['crypted_password'])){_0x50ae1f[_0x4db88e(0x1ee)](0x191)[_0x4db88e(0x1f2)]({'error':'Invalid\x20email\x20or\x20password'});return;}let _0x4199d3;try{_0x4199d3=jwt[_0x4db88e(0x201)]({'userId':_0x3bd41a['id'],'email':_0x3bd41a['email']},config[_0x4db88e(0x1f7)],{'expiresIn':_0x4db88e(0x1e9)});}catch(_0x20cf78){console['log'](_0x20cf78),_0x50ae1f['status'](0x1f4)[_0x4db88e(0x1f2)]({'error':_0x4db88e(0x1fc)});return;}_0x50ae1f[_0x4db88e(0x1ee)](0xc8)[_0x4db88e(0x1f2)]({'success':!![],'data':{'userId':_0x3bd41a['id'],'username':_0x3bd41a[_0x4db88e(0x209)],'first_name':_0x3bd41a[_0x4db88e(0x1f6)],'last_name':_0x3bd41a[_0x4db88e(0x202)],'email':_0x3bd41a[_0x4db88e(0x1e8)],'avatar_url':_0x3bd41a['avatar_url'],'id':_0x3bd41a['id'],'role':_0x3bd41a[_0x4db88e(0x205)],'token':_0x4199d3}});}),router[a1_0x25514b(0x1ff)](a1_0x25514b(0x1e6),async(_0x11b313,_0x129718,_0x8ffd2e)=>{const _0x8136f7=a1_0x25514b,{username:_0x32e5db,email:_0x273d77,password:_0x2655a4}=_0x11b313[_0x8136f7(0x200)],[_0x559bfb]=await conn[_0x8136f7(0x1dc)]()[_0x8136f7(0x1d5)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x273d77]);if(_0x559bfb[_0x8136f7(0x203)]>0x0){_0x129718[_0x8136f7(0x1ee)](0x1a6)[_0x8136f7(0x1f2)]({'error':_0x8136f7(0x208)});return;}const _0x277766=await bcrypt[_0x8136f7(0x1ea)](_0x2655a4,0xa);try{const [_0x10e6d9]=await conn['promise']()[_0x8136f7(0x1d5)](_0x8136f7(0x1dd),[_0x32e5db,_0x273d77,_0x277766,_0x8136f7(0x1d9)]);if(_0x10e6d9[_0x8136f7(0x1eb)]){const [_0x1e77cf]=await conn[_0x8136f7(0x1dc)]()[_0x8136f7(0x1d5)](_0x8136f7(0x1d7),[_0x10e6d9[_0x8136f7(0x1eb)]]);_0x1e77cf[_0x8136f7(0x203)]>0x0&&(newUser=_0x1e77cf[0x0]);}}catch{_0x129718['status'](0x1f4)[_0x8136f7(0x1f2)]({'error':_0x8136f7(0x1fc)});return;}let _0x1059af;try{_0x1059af=jwt['sign']({'userId':newUser['id'],'email':newUser['email']},config['jwtSecretKey'],{'expiresIn':_0x8136f7(0x1e9)});}catch(_0x15fa36){_0x129718[_0x8136f7(0x1ee)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x129718['status'](0xc9)['json']({'success':!![],'data':{'userId':newUser['id'],'username':newUser['username'],'first_name':newUser[_0x8136f7(0x1f6)],'last_name':newUser['last_name'],'email':newUser[_0x8136f7(0x1e8)],'avatar_url':newUser[_0x8136f7(0x20d)],'id':newUser['id'],'role':newUser['role'],'token':_0x1059af}});}),router[a1_0x25514b(0x1ff)](a1_0x25514b(0x1de),verifyToken,async(_0x175d5f,_0xcdd855,_0x119c97)=>{const _0x5130e0=a1_0x25514b,{current_password:_0x33f960,new_password:_0x172c73}=_0x175d5f[_0x5130e0(0x200)];console[_0x5130e0(0x1df)]({'body':_0x175d5f[_0x5130e0(0x200)]});const _0x54ab26=_0x175d5f[_0x5130e0(0x1d9)][_0x5130e0(0x1e8)];let _0x559619;try{const [_0x9eda76]=await conn[_0x5130e0(0x1dc)]()[_0x5130e0(0x1d5)](_0x5130e0(0x1f4),[_0x54ab26]);if(_0x9eda76[_0x5130e0(0x203)]>0x0){_0x559619=_0x9eda76[0x0];if(!await bcrypt[_0x5130e0(0x1fd)](_0x33f960,_0x559619['crypted_password'])){_0xcdd855[_0x5130e0(0x1ee)](0x191)[_0x5130e0(0x1f2)]({'error':_0x5130e0(0x1f0)});return;}const _0xe97086=await bcrypt['hash'](_0x172c73,0xa);await conn[_0x5130e0(0x1dc)]()[_0x5130e0(0x1d5)](_0x5130e0(0x1fb),[_0xe97086,_0x54ab26]),_0xcdd855[_0x5130e0(0x1ee)](0xc8)['json']({'success':!![]});}}catch(_0x1e1812){console[_0x5130e0(0x1df)]({'err':_0x1e1812}),_0xcdd855[_0x5130e0(0x1ee)](0x1f4)['json']({'error':_0x5130e0(0x1fc)});return;}}),router[a1_0x25514b(0x1ff)](a1_0x25514b(0x1e3),upload[a1_0x25514b(0x1d3)](a1_0x25514b(0x1fa)),verifyToken,async(_0x16f30a,_0x214edf,_0x6fbd42)=>{const _0x3d2372=a1_0x25514b,{username:_0x310240,first_name:_0x20b095,last_name:_0x2f0686}=_0x16f30a['body'],_0x2256d5=_0x16f30a[_0x3d2372(0x1d9)][_0x3d2372(0x1e8)];let _0x25dfc0;try{const [_0x24f49a]=await conn['promise']()[_0x3d2372(0x1d5)](_0x3d2372(0x1f4),[_0x2256d5]);_0x24f49a['length']>0x0&&(_0x25dfc0=_0x24f49a[0x0]);}catch(_0x2c24b9){console[_0x3d2372(0x1df)]({'err':_0x2c24b9}),_0x214edf[_0x3d2372(0x1ee)](0x1f4)[_0x3d2372(0x1f2)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x25dfc0){_0x214edf[_0x3d2372(0x1ee)](0x191)[_0x3d2372(0x1f2)]({'error':'Invalid\x20user'});return;}console[_0x3d2372(0x1df)]({'req':_0x16f30a[_0x3d2372(0x200)]});let _0x5f48d9=_0x25dfc0['avatar_url'];if(_0x16f30a['file']){const _0x3fad45=_0x3d2372(0x1e2)+randomUUID()+_0x3d2372(0x1d8);fs[_0x3d2372(0x1d2)](_0x16f30a[_0x3d2372(0x1f1)][_0x3d2372(0x1ef)],'./'+_0x3fad45),_0x5f48d9=config[_0x3d2372(0x1ed)]+'/'+_0x3fad45;}try{await conn[_0x3d2372(0x1dc)]()['execute'](_0x3d2372(0x1d6),[_0x310240,_0x20b095,_0x2f0686,_0x5f48d9,_0x2256d5]);let _0x5ae084;try{_0x5ae084=jwt[_0x3d2372(0x201)]({'userId':_0x25dfc0['id'],'email':_0x25dfc0[_0x3d2372(0x1e8)]},config['jwtSecretKey'],{'expiresIn':_0x3d2372(0x1e9)});}catch(_0x5cca16){console[_0x3d2372(0x1df)](_0x5cca16),_0x214edf[_0x3d2372(0x1ee)](0x1f4)[_0x3d2372(0x1f2)]({'error':_0x3d2372(0x1fc)});return;}_0x214edf['status'](0xc8)[_0x3d2372(0x1f2)]({'success':!![],'data':{'userId':_0x25dfc0['id'],'username':_0x310240,'first_name':_0x20b095,'last_name':_0x2f0686,'email':_0x25dfc0['email'],'avatar_url':_0x5f48d9,'token':_0x5ae084}});}catch(_0x2cbd75){console[_0x3d2372(0x1df)]({'err':_0x2cbd75}),_0x214edf['status'](0x1f4)[_0x3d2372(0x1f2)]({'error':_0x3d2372(0x1fc)});return;}}),module[a1_0x25514b(0x1d0)]=router;