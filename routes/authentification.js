const a1_0x5be23e=a1_0x568c;function a1_0x568c(_0x551561,_0xe5f1aa){const _0x5a0583=a1_0x5a05();return a1_0x568c=function(_0x568c78,_0x5859d7){_0x568c78=_0x568c78-0x181;let _0x1e6e3e=_0x5a0583[_0x568c78];return _0x1e6e3e;},a1_0x568c(_0x551561,_0xe5f1aa);}(function(_0x32c79f,_0x530831){const _0x2b84cd=a1_0x568c,_0x5252e6=_0x32c79f();while(!![]){try{const _0x36bb97=-parseInt(_0x2b84cd(0x18d))/0x1+-parseInt(_0x2b84cd(0x1bc))/0x2+-parseInt(_0x2b84cd(0x19d))/0x3+-parseInt(_0x2b84cd(0x1cc))/0x4*(-parseInt(_0x2b84cd(0x1c3))/0x5)+parseInt(_0x2b84cd(0x1ab))/0x6*(-parseInt(_0x2b84cd(0x1cd))/0x7)+-parseInt(_0x2b84cd(0x1a7))/0x8*(parseInt(_0x2b84cd(0x182))/0x9)+parseInt(_0x2b84cd(0x186))/0xa;if(_0x36bb97===_0x530831)break;else _0x5252e6['push'](_0x5252e6['shift']());}catch(_0x5ec4be){_0x5252e6['push'](_0x5252e6['shift']());}}}(a1_0x5a05,0x1f226));const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x5be23e(0x1a9)),config=require(a1_0x5be23e(0x1ba)),conn=require(a1_0x5be23e(0x190)),multer=require('multer'),fs=require('fs'),verifyToken=require(a1_0x5be23e(0x19f))[a1_0x5be23e(0x1a2)];!fs[a1_0x5be23e(0x1bd)]('./avatars')&&fs[a1_0x5be23e(0x195)](a1_0x5be23e(0x1c2));function a1_0x5a05(){const _0x2343f7=['1888952SMCCBY','Email\x20validated\x20successfully','bcrypt','Welcome\x20to\x20CADViewer','12ykWCnN','path','jwtSecretKey','crypto','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','sendMail','sign','last_name','/signup','===================error===================','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','log','length','avatars','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','../CADViewer_config.json','is_enabled','310374NvPFAG','existsSync','demo_user','enableEmailVerification','User\x20already\x20exists','crypted_password','./avatars','65ToelZE','compare','file','.png','body','/update-password','frontendUrl','Invalid\x20email\x20or\x20password','Router','13152IfrvjO','11123wYWUyr','/update-user-info','9eeIkJW','post','promise','execute','7817970OIwQuA','avatar','../libs/mail','./uploads/','status','Error!\x20Something\x20went\x20wrong.','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','51853kSizSl','message','json','../libs/mysql.js','email','avatar_url','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','<p>Welcome\x20to\x20CADViewer</p>','mkdirSync','ServerUrl','username','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','role','express','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','smtpFrom','752034oTJvPm','24h','../libs/jwt','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','first_name','verifyToken','stack','hash','insertId','/validate-email/'];a1_0x5a05=function(){return _0x2343f7;};return a1_0x5a05();}const express=require(a1_0x5be23e(0x19a)),router=express[a1_0x5be23e(0x1cb)](),{randomUUID}=require(a1_0x5be23e(0x1ae)),storage=multer['diskStorage']({'destination':function(_0x2c5090,_0x26a852,_0x14c9e6){const _0x92af6=a1_0x5be23e;_0x14c9e6(null,_0x92af6(0x1b8));}}),upload=multer({'storage':storage});router[a1_0x5be23e(0x183)]('/login',async(_0x17a3ec,_0x5a60df,_0x14a015)=>{const _0x2994d6=a1_0x5be23e;let {email:_0x2bfd39,password:_0x5cc8f8}=_0x17a3ec[_0x2994d6(0x1c7)];console['log']({'email':_0x2bfd39,'password':_0x5cc8f8});let _0x45bd1b;try{const [_0x2a55ec]=await conn['promise']()[_0x2994d6(0x185)](_0x2994d6(0x19b),[_0x2bfd39]);_0x2a55ec[_0x2994d6(0x1b7)]>0x0&&(_0x45bd1b=_0x2a55ec[0x0]);}catch(_0x2e4a26){console[_0x2994d6(0x1b6)]({'err':_0x2e4a26}),_0x5a60df[_0x2994d6(0x18a)](0x1f4)['json']({'error':_0x2994d6(0x18b)});return;}if(!_0x45bd1b||!await bcrypt[_0x2994d6(0x1c4)](_0x5cc8f8,_0x45bd1b?.[_0x2994d6(0x1c1)])){_0x5a60df[_0x2994d6(0x18a)](0x191)[_0x2994d6(0x18f)]({'error':_0x2994d6(0x1ca)});return;}let _0x36d696;try{_0x36d696=jwt[_0x2994d6(0x1b1)]({'userId':_0x45bd1b['id'],'email':_0x45bd1b[_0x2994d6(0x191)]},config[_0x2994d6(0x1ad)],{'expiresIn':'24h'});}catch(_0x2d0908){console['log'](_0x2d0908),_0x5a60df[_0x2994d6(0x18a)](0x1f4)[_0x2994d6(0x18f)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x5a60df[_0x2994d6(0x18a)](0xc8)[_0x2994d6(0x18f)]({'success':!![],'data':{'userId':_0x45bd1b['id'],'username':_0x45bd1b[_0x2994d6(0x197)],'first_name':_0x45bd1b[_0x2994d6(0x1a1)],'last_name':_0x45bd1b[_0x2994d6(0x1b2)],'email':_0x45bd1b[_0x2994d6(0x191)],'avatar_url':_0x45bd1b[_0x2994d6(0x192)],'id':_0x45bd1b['id'],'role':_0x45bd1b['role'],'token':_0x36d696}});}),router[a1_0x5be23e(0x183)](a1_0x5be23e(0x1b3),async(_0x5b0f60,_0x5a74a2,_0x97a0dc)=>{const _0x2658d7=a1_0x5be23e,{username:_0x192ce7,email:_0x46397a,password:_0x50cf87}=_0x5b0f60[_0x2658d7(0x1c7)],[_0x507405]=await conn['promise']()[_0x2658d7(0x185)](_0x2658d7(0x1af),[_0x46397a]);if(_0x507405[_0x2658d7(0x1b7)]>0x0){_0x5a74a2['status'](0x1a6)[_0x2658d7(0x18f)]({'error':_0x2658d7(0x1c0)});return;}const _0x198a8d=await bcrypt['hash'](_0x50cf87,0xa);let _0x2f62ce=null,_0x27dbed=0x1;config[_0x2658d7(0x1bf)]&&(_0x2f62ce=randomUUID(),_0x27dbed=0x0);let _0x278fa4;try{const _0x40de4d=randomUUID(),_0x2a1e82=_0x2658d7(0x189)+_0x40de4d;fs[_0x2658d7(0x195)](_0x2a1e82);const [_0x13106f]=await conn[_0x2658d7(0x184)]()[_0x2658d7(0x185)]('INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)',[_0x192ce7,_0x46397a,_0x198a8d,_0x2658d7(0x1be),_0x27dbed,_0x2f62ce,_0x40de4d]);if(_0x13106f[_0x2658d7(0x1a5)]){const [_0x139376]=await conn[_0x2658d7(0x184)]()[_0x2658d7(0x185)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0x13106f[_0x2658d7(0x1a5)]]);_0x139376[_0x2658d7(0x1b7)]>0x0&&(_0x278fa4=_0x139376[0x0]);}}catch{_0x5a74a2[_0x2658d7(0x18a)](0x1f4)[_0x2658d7(0x18f)]({'error':_0x2658d7(0x18b)});return;}let _0x29bd0a;try{_0x29bd0a=jwt[_0x2658d7(0x1b1)]({'userId':_0x278fa4['id'],'email':_0x278fa4['email']},config[_0x2658d7(0x1ad)],{'expiresIn':'24h'});}catch(_0x97c3ff){_0x5a74a2[_0x2658d7(0x18a)](0x1f4)[_0x2658d7(0x18f)]({'error':_0x2658d7(0x18b)});return;}const _0x25b1cc=require(_0x2658d7(0x188))['transporter'];let _0x4f4590=_0x2658d7(0x194);if(config[_0x2658d7(0x1bf)]){const _0xe87129=config[_0x2658d7(0x1c9)]+_0x2658d7(0x1a6)+_0x2f62ce;_0x4f4590='\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22'+_0xe87129+_0x2658d7(0x18c)+_0xe87129+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20';const _0xbcb331={'from':config[_0x2658d7(0x19c)],'to':_0x278fa4[_0x2658d7(0x191)],'subject':_0x2658d7(0x1aa),'text':_0x2658d7(0x1aa),'html':_0x4f4590};try{await _0x25b1cc[_0x2658d7(0x1b0)](_0xbcb331);}catch(_0x3fadf0){console[_0x2658d7(0x1b6)](_0x2658d7(0x1b4)),console[_0x2658d7(0x1b6)](_0x3fadf0),_0x5a74a2[_0x2658d7(0x18a)](0x1f4)['json']({'error':_0x2658d7(0x198),'stack':_0x3fadf0[_0x2658d7(0x1a3)],'message':_0x3fadf0[_0x2658d7(0x18e)]});return;}_0x5a74a2[_0x2658d7(0x18a)](0xc8)[_0x2658d7(0x18f)]({'success':!![],'message':'Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account'});return;}_0x5a74a2['status'](0xc9)['json']({'success':!![],'data':{'userId':_0x278fa4['id'],'username':_0x278fa4[_0x2658d7(0x197)],'first_name':_0x278fa4[_0x2658d7(0x1a1)],'last_name':_0x278fa4[_0x2658d7(0x1b2)],'email':_0x278fa4[_0x2658d7(0x191)],'avatar_url':_0x278fa4[_0x2658d7(0x192)],'id':_0x278fa4['id'],'role':_0x278fa4[_0x2658d7(0x199)],'token':_0x29bd0a,'is_enabled':_0x278fa4[_0x2658d7(0x1bb)]}});}),router[a1_0x5be23e(0x183)]('/validate-email/:token',async(_0x1bd650,_0x258986)=>{const _0x37d8a1=a1_0x5be23e;try{const {token:_0x306cce}=_0x1bd650['params'],[_0x2cec23]=await conn[_0x37d8a1(0x184)]()[_0x37d8a1(0x185)](_0x37d8a1(0x1b9),[_0x306cce]);if(_0x2cec23[_0x37d8a1(0x1b7)]===0x0){_0x258986[_0x37d8a1(0x18a)](0x194)[_0x37d8a1(0x18f)]({'error':'Invalid\x20validation\x20token'});return;}await conn[_0x37d8a1(0x184)]()[_0x37d8a1(0x185)](_0x37d8a1(0x1b5),[_0x306cce]);const _0x1dae9c=jwt[_0x37d8a1(0x1b1)]({'id':_0x2cec23[0x0]['id'],'email':_0x2cec23[0x0][_0x37d8a1(0x191)]},config[_0x37d8a1(0x1ad)],{'expiresIn':_0x37d8a1(0x19e)});_0x258986[_0x37d8a1(0x18a)](0xc8)[_0x37d8a1(0x18f)]({'success':!![],'message':_0x37d8a1(0x1a8),'data':{'userId':_0x2cec23[0x0]['id'],'username':_0x2cec23[0x0][_0x37d8a1(0x197)],'first_name':_0x2cec23[0x0][_0x37d8a1(0x1a1)],'last_name':_0x2cec23[0x0]['last_name'],'email':_0x2cec23[0x0][_0x37d8a1(0x191)],'avatar_url':_0x2cec23[0x0][_0x37d8a1(0x192)],'id':_0x2cec23[0x0]['id'],'role':_0x2cec23[0x0]['role'],'token':_0x1dae9c,'is_enabled':0x1}});}catch(_0x1ec0cd){console[_0x37d8a1(0x1b6)](_0x37d8a1(0x1b4)),console[_0x37d8a1(0x1b6)](_0x1ec0cd),_0x258986[_0x37d8a1(0x18a)](0x1f4)[_0x37d8a1(0x18f)]({'error':_0x37d8a1(0x18b),'stack':_0x1ec0cd['stack'],'message':_0x1ec0cd[_0x37d8a1(0x18e)]});}}),router[a1_0x5be23e(0x183)](a1_0x5be23e(0x1c8),verifyToken,async(_0x59fb59,_0x211841,_0x5aa85b)=>{const _0x36698f=a1_0x5be23e,{current_password:_0x525915,new_password:_0x479557}=_0x59fb59[_0x36698f(0x1c7)];console[_0x36698f(0x1b6)]({'body':_0x59fb59[_0x36698f(0x1c7)]});const _0x4ff102=_0x59fb59['user'][_0x36698f(0x191)];let _0x575b2e;try{const [_0x3fe924]=await conn[_0x36698f(0x184)]()[_0x36698f(0x185)](_0x36698f(0x1af),[_0x4ff102]);if(_0x3fe924[_0x36698f(0x1b7)]>0x0){_0x575b2e=_0x3fe924[0x0];if(!await bcrypt[_0x36698f(0x1c4)](_0x525915,_0x575b2e[_0x36698f(0x1c1)])){_0x211841[_0x36698f(0x18a)](0x191)['json']({'error':'Invalid\x20password'});return;}const _0x3978c2=await bcrypt[_0x36698f(0x1a4)](_0x479557,0xa);await conn[_0x36698f(0x184)]()[_0x36698f(0x185)](_0x36698f(0x193),[_0x3978c2,_0x4ff102]),_0x211841[_0x36698f(0x18a)](0xc8)[_0x36698f(0x18f)]({'success':!![]});}}catch(_0x43d142){console[_0x36698f(0x1b6)]({'err':_0x43d142}),_0x211841[_0x36698f(0x18a)](0x1f4)[_0x36698f(0x18f)]({'error':_0x36698f(0x18b)});return;}}),router[a1_0x5be23e(0x183)](a1_0x5be23e(0x181),upload['single'](a1_0x5be23e(0x187)),verifyToken,async(_0x2638b7,_0x22cbbc,_0x2ddcad)=>{const _0x31a1f7=a1_0x5be23e,{username:_0x4c5c90,first_name:_0x38c2b3,last_name:_0x1d10bf}=_0x2638b7[_0x31a1f7(0x1c7)],_0x837472=_0x2638b7['user'][_0x31a1f7(0x191)];let _0x378066;try{const [_0x1d933c]=await conn['promise']()[_0x31a1f7(0x185)](_0x31a1f7(0x1af),[_0x837472]);_0x1d933c['length']>0x0&&(_0x378066=_0x1d933c[0x0]);}catch(_0x2c1a28){console['log']({'err':_0x2c1a28}),_0x22cbbc['status'](0x1f4)[_0x31a1f7(0x18f)]({'error':_0x31a1f7(0x18b)});return;}if(!_0x378066){_0x22cbbc[_0x31a1f7(0x18a)](0x191)[_0x31a1f7(0x18f)]({'error':'Invalid\x20user'});return;}console['log']({'req':_0x2638b7['body']});let _0x336a08=_0x378066[_0x31a1f7(0x192)];if(_0x2638b7['file']){const _0x142ce2='avatars/'+randomUUID()+_0x31a1f7(0x1c6);fs['copyFileSync'](_0x2638b7[_0x31a1f7(0x1c5)][_0x31a1f7(0x1ac)],'./'+_0x142ce2),fs['unlinkSync'](_0x2638b7[_0x31a1f7(0x1c5)]['path']),_0x336a08=config[_0x31a1f7(0x196)]+'/'+_0x142ce2;}try{await conn[_0x31a1f7(0x184)]()[_0x31a1f7(0x185)](_0x31a1f7(0x1a0),[_0x4c5c90,_0x38c2b3,_0x1d10bf,_0x336a08,_0x837472]);let _0x2a145a;try{_0x2a145a=jwt[_0x31a1f7(0x1b1)]({'userId':_0x378066['id'],'email':_0x378066[_0x31a1f7(0x191)]},config[_0x31a1f7(0x1ad)],{'expiresIn':_0x31a1f7(0x19e)});}catch(_0x21cb6a){console[_0x31a1f7(0x1b6)](_0x21cb6a),_0x22cbbc[_0x31a1f7(0x18a)](0x1f4)[_0x31a1f7(0x18f)]({'error':_0x31a1f7(0x18b)});return;}_0x22cbbc[_0x31a1f7(0x18a)](0xc8)['json']({'success':!![],'data':{'userId':_0x378066['id'],'username':_0x4c5c90,'first_name':_0x38c2b3,'last_name':_0x1d10bf,'email':_0x378066[_0x31a1f7(0x191)],'avatar_url':_0x336a08,'token':_0x2a145a}});}catch(_0x5f3c4f){console['log']({'err':_0x5f3c4f}),_0x22cbbc[_0x31a1f7(0x18a)](0x1f4)[_0x31a1f7(0x18f)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module['exports']=router;