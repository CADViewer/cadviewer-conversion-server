const a1_0x36ca91=a1_0x661e;function a1_0x661e(_0xe793fc,_0x149546){const _0x170667=a1_0x1706();return a1_0x661e=function(_0x661eca,_0xa6f5ca){_0x661eca=_0x661eca-0x153;let _0x24e4af=_0x170667[_0x661eca];return _0x24e4af;},a1_0x661e(_0xe793fc,_0x149546);}(function(_0x56377c,_0x1b93d2){const _0x12a00b=a1_0x661e,_0x114bb7=_0x56377c();while(!![]){try{const _0x36a251=parseInt(_0x12a00b(0x17c))/0x1*(parseInt(_0x12a00b(0x188))/0x2)+parseInt(_0x12a00b(0x18c))/0x3*(-parseInt(_0x12a00b(0x198))/0x4)+parseInt(_0x12a00b(0x16a))/0x5+-parseInt(_0x12a00b(0x16b))/0x6+-parseInt(_0x12a00b(0x19c))/0x7*(-parseInt(_0x12a00b(0x1ac))/0x8)+-parseInt(_0x12a00b(0x161))/0x9+-parseInt(_0x12a00b(0x1a2))/0xa;if(_0x36a251===_0x1b93d2)break;else _0x114bb7['push'](_0x114bb7['shift']());}catch(_0x122b8b){_0x114bb7['push'](_0x114bb7['shift']());}}}(a1_0x1706,0x79bbe));function a1_0x1706(){const _0x59831c=['json','Error!\x20Something\x20went\x20wrong.','copyFileSync','jsonwebtoken','file','avatars/','name','3896055jyQylq','data','avatar_url','first_name','callbackMethod_gatewayUrl_flag','Invalid\x20user','jwtSecretKey','callbackMethod_gatewayUrl','/update-password','1364165AGkEzo','96246LePVzK','body','enableEmailVerification','https://www.google.com/recaptcha/api/siteverify','role','Error\x20during\x20user\x20creation:','express','user','success','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','last_name','===================error===================','Invalid\x20password','stack','/signup','city','verifyToken','5744oWtFrd','Invalid\x20email\x20or\x20password','mkdirSync','time_zone','.png','insertId','crypted_password','crypto','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','296uHPcRQ','avatar','code','recaptchaEnabled','2110344SxJTKO','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','params','path','post','compare','Email\x20validated\x20successfully','error-codes','ServerUrl','Router','log','./uploads/','4KQETgz','single','Error\x20during\x20reCAPTCHA\x20verification.','./avatars','3008446aMggWa','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','/update-user-info','email','message','diskStorage','3314950qKKmRB','../libs/mysql.js','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','region','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','status','hash','../CADViewer_config.json','length','reCAPTCHA\x20verification\x20error:','16itwxZB','24h','../libs/jwt','demo_user','Invalid\x20validation\x20token','languages','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','is_enabled','../libs/email-utils','promise','username','execute','axios','unlinkSync','sign'];a1_0x1706=function(){return _0x59831c;};return a1_0x1706();}const jwt=require(a1_0x36ca91(0x15d)),bcrypt=require('bcrypt'),config=require(a1_0x36ca91(0x1a9)),conn=require(a1_0x36ca91(0x1a3)),multer=require('multer'),fs=require('fs'),verifyToken=require(a1_0x36ca91(0x1ae))[a1_0x36ca91(0x17b)],{sendWelcomeEmail}=require(a1_0x36ca91(0x153)),axios=require(a1_0x36ca91(0x157));!fs['existsSync'](a1_0x36ca91(0x19b))&&fs['mkdirSync'](a1_0x36ca91(0x19b));const express=require(a1_0x36ca91(0x171)),router=express[a1_0x36ca91(0x195)](),{randomUUID}=require(a1_0x36ca91(0x183)),storage=multer[a1_0x36ca91(0x1a1)]({'destination':function(_0x1fd073,_0x4e1538,_0x469023){_0x469023(null,'avatars');}}),upload=multer({'storage':storage});router['post']('/login',async(_0xc6ae4e,_0x14fe76,_0x4eecb7)=>{const _0x4fb0de=a1_0x36ca91;let {email:_0x3d1556,password:_0x1a6d4c}=_0xc6ae4e[_0x4fb0de(0x16c)];console[_0x4fb0de(0x196)]({'email':_0x3d1556,'password':_0x1a6d4c});let _0x37dabf;try{const [_0x5c23c2]=await conn['promise']()[_0x4fb0de(0x156)](_0x4fb0de(0x19d),[_0x3d1556]);_0x5c23c2['length']>0x0&&(_0x37dabf=_0x5c23c2[0x0]);}catch(_0x384c48){console[_0x4fb0de(0x196)]({'err':_0x384c48}),_0x14fe76[_0x4fb0de(0x1a7)](0x1f4)[_0x4fb0de(0x15a)]({'error':_0x4fb0de(0x15b)});return;}if(!_0x37dabf||!await bcrypt[_0x4fb0de(0x191)](_0x1a6d4c,_0x37dabf?.[_0x4fb0de(0x182)])){_0x14fe76[_0x4fb0de(0x1a7)](0x191)[_0x4fb0de(0x15a)]({'error':_0x4fb0de(0x17d)});return;}let _0x400232;try{_0x400232=jwt[_0x4fb0de(0x159)]({'userId':_0x37dabf['id'],'email':_0x37dabf['email']},config[_0x4fb0de(0x167)],{'expiresIn':'24h'});}catch(_0x5e077f){console[_0x4fb0de(0x196)](_0x5e077f),_0x14fe76[_0x4fb0de(0x1a7)](0x1f4)[_0x4fb0de(0x15a)]({'error':_0x4fb0de(0x15b)});return;}_0x14fe76[_0x4fb0de(0x1a7)](0xc8)[_0x4fb0de(0x15a)]({'success':!![],'data':{'userId':_0x37dabf['id'],'username':_0x37dabf[_0x4fb0de(0x155)],'first_name':_0x37dabf[_0x4fb0de(0x164)],'last_name':_0x37dabf[_0x4fb0de(0x175)],'email':_0x37dabf[_0x4fb0de(0x19f)],'avatar_url':_0x37dabf[_0x4fb0de(0x163)],'id':_0x37dabf['id'],'role':_0x37dabf[_0x4fb0de(0x16f)],'token':_0x400232}});}),router[a1_0x36ca91(0x190)](a1_0x36ca91(0x179),async(_0x511d32,_0x2a1bdb,_0x4ebf14)=>{const _0x2adc48=a1_0x36ca91,{username:_0x1d422f,email:_0x566567,password:_0xb450e0,geolocation:_0x31b453,recaptchaToken:_0x47a8a6}=_0x511d32[_0x2adc48(0x16c)];if(config[_0x2adc48(0x18b)]){if(!_0x47a8a6)return _0x2a1bdb[_0x2adc48(0x1a7)](0x190)[_0x2adc48(0x15a)]({'error':_0x2adc48(0x1b2)});try{const _0x431608=await axios['post'](_0x2adc48(0x16e),null,{'params':{'secret':config['recaptchaSecretKey'],'response':_0x47a8a6}});if(!_0x431608['data'][_0x2adc48(0x173)])return _0x2a1bdb[_0x2adc48(0x1a7)](0x190)[_0x2adc48(0x15a)]({'error':'reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','recaptchaErrors':_0x431608[_0x2adc48(0x162)][_0x2adc48(0x193)]});}catch(_0x1eb525){return console['error'](_0x2adc48(0x1ab),_0x1eb525),_0x2a1bdb[_0x2adc48(0x1a7)](0x1f4)[_0x2adc48(0x15a)]({'error':_0x2adc48(0x19a)});}}const [_0x468324]=await conn['promise']()['execute'](_0x2adc48(0x174),[_0x566567]);if(_0x468324[_0x2adc48(0x1aa)]>0x0){_0x2a1bdb[_0x2adc48(0x1a7)](0x1a6)[_0x2adc48(0x15a)]({'error':'User\x20already\x20exists'});return;}const _0x29806a=await bcrypt['hash'](_0xb450e0,0xa);let _0x85ec7b=null,_0x287829=0x1;config[_0x2adc48(0x16d)]&&(_0x85ec7b=randomUUID(),_0x287829=0x0);let _0x250d7c=null,_0x481169=null,_0x474f9d=null,_0x4e1941=null,_0x3dcf15=null,_0x124e51=null;if(_0x31b453)try{const _0x5ebb78=_0x31b453;_0x250d7c=_0x5ebb78[_0x2adc48(0x17a)]||null,_0x481169=_0x5ebb78[_0x2adc48(0x1a5)]||null,_0x474f9d=_0x5ebb78['country_name']||null,_0x5ebb78[_0x2adc48(0x1b1)]&&_0x5ebb78[_0x2adc48(0x1b1)][_0x2adc48(0x1aa)]>0x0&&(_0x4e1941=_0x5ebb78[_0x2adc48(0x1b1)][0x0][_0x2adc48(0x18a)]||null,_0x3dcf15=_0x5ebb78['languages'][0x0]['name']||null),_0x5ebb78[_0x2adc48(0x17f)]&&(_0x124e51=_0x5ebb78[_0x2adc48(0x17f)][_0x2adc48(0x160)]||null);}catch(_0x22eead){console['log']('Error\x20parsing\x20geolocation\x20data:',_0x22eead);}let _0x10a041;try{const _0x25a6ff=randomUUID(),_0x5a8be9=_0x2adc48(0x197)+_0x25a6ff;fs[_0x2adc48(0x17e)](_0x5a8be9);const [_0x259e67]=await conn['promise']()[_0x2adc48(0x156)](_0x2adc48(0x185),[_0x1d422f,_0x566567,_0x29806a,_0x2adc48(0x1af),_0x287829,_0x85ec7b,_0x25a6ff,_0x250d7c,_0x481169,_0x474f9d,_0x4e1941,_0x3dcf15,_0x124e51]);if(_0x259e67[_0x2adc48(0x181)]){const [_0x2d993a]=await conn[_0x2adc48(0x154)]()[_0x2adc48(0x156)](_0x2adc48(0x184),[_0x259e67['insertId']]);_0x2d993a['length']>0x0&&(_0x10a041=_0x2d993a[0x0]);}}catch(_0xe09eb6){console['log'](_0x2adc48(0x170),_0xe09eb6),_0x2a1bdb['status'](0x1f4)[_0x2adc48(0x15a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x488678;try{_0x488678=jwt[_0x2adc48(0x159)]({'userId':_0x10a041['id'],'email':_0x10a041['email']},config[_0x2adc48(0x167)],{'expiresIn':_0x2adc48(0x1ad)});}catch(_0x8ce3d){_0x2a1bdb[_0x2adc48(0x1a7)](0x1f4)[_0x2adc48(0x15a)]({'error':_0x2adc48(0x15b)});return;}if(config['enableEmailVerification']){try{await sendWelcomeEmail(_0x10a041,_0x85ec7b);}catch(_0x225580){console[_0x2adc48(0x196)]('===================error==================='),console['log'](_0x225580);}_0x2a1bdb[_0x2adc48(0x1a7)](0xc8)[_0x2adc48(0x15a)]({'success':!![],'message':_0x2adc48(0x1a4)});return;}_0x2a1bdb['status'](0xc9)[_0x2adc48(0x15a)]({'success':!![],'data':{'userId':_0x10a041['id'],'username':_0x10a041['username'],'first_name':_0x10a041['first_name'],'last_name':_0x10a041[_0x2adc48(0x175)],'email':_0x10a041[_0x2adc48(0x19f)],'avatar_url':_0x10a041['avatar_url'],'id':_0x10a041['id'],'role':_0x10a041[_0x2adc48(0x16f)],'token':_0x488678,'is_enabled':_0x10a041[_0x2adc48(0x1b3)]}});}),router[a1_0x36ca91(0x190)]('/validate-email/:token',async(_0x42f55b,_0x1e0b91)=>{const _0x256db0=a1_0x36ca91;try{const {token:_0x4f6dd6}=_0x42f55b[_0x256db0(0x18e)],[_0x5911b9]=await conn[_0x256db0(0x154)]()[_0x256db0(0x156)](_0x256db0(0x186),[_0x4f6dd6]);if(_0x5911b9[_0x256db0(0x1aa)]===0x0){_0x1e0b91['status'](0x194)[_0x256db0(0x15a)]({'error':_0x256db0(0x1b0)});return;}await conn[_0x256db0(0x154)]()[_0x256db0(0x156)](_0x256db0(0x18d),[_0x4f6dd6]);const _0x593af6=jwt[_0x256db0(0x159)]({'id':_0x5911b9[0x0]['id'],'email':_0x5911b9[0x0]['email']},config['jwtSecretKey'],{'expiresIn':_0x256db0(0x1ad)});_0x1e0b91[_0x256db0(0x1a7)](0xc8)[_0x256db0(0x15a)]({'success':!![],'message':_0x256db0(0x192),'data':{'userId':_0x5911b9[0x0]['id'],'username':_0x5911b9[0x0][_0x256db0(0x155)],'first_name':_0x5911b9[0x0][_0x256db0(0x164)],'last_name':_0x5911b9[0x0]['last_name'],'email':_0x5911b9[0x0][_0x256db0(0x19f)],'avatar_url':_0x5911b9[0x0][_0x256db0(0x163)],'id':_0x5911b9[0x0]['id'],'role':_0x5911b9[0x0]['role'],'token':_0x593af6,'is_enabled':0x1}});}catch(_0x77696d){console[_0x256db0(0x196)](_0x256db0(0x176)),console[_0x256db0(0x196)](_0x77696d),_0x1e0b91[_0x256db0(0x1a7)](0x1f4)[_0x256db0(0x15a)]({'error':_0x256db0(0x15b),'stack':_0x77696d[_0x256db0(0x178)],'message':_0x77696d[_0x256db0(0x1a0)]});}}),router[a1_0x36ca91(0x190)](a1_0x36ca91(0x169),verifyToken,async(_0x4ba85c,_0x496b95,_0x57c8bd)=>{const _0x27f05a=a1_0x36ca91,{current_password:_0x2dc79a,new_password:_0xdc7313}=_0x4ba85c['body'];console[_0x27f05a(0x196)]({'body':_0x4ba85c[_0x27f05a(0x16c)]});const _0xb7de08=_0x4ba85c[_0x27f05a(0x172)][_0x27f05a(0x19f)];let _0x418b44;try{const [_0x13df70]=await conn[_0x27f05a(0x154)]()[_0x27f05a(0x156)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0xb7de08]);if(_0x13df70['length']>0x0){_0x418b44=_0x13df70[0x0];if(!await bcrypt['compare'](_0x2dc79a,_0x418b44['crypted_password'])){_0x496b95[_0x27f05a(0x1a7)](0x191)['json']({'error':_0x27f05a(0x177)});return;}const _0x2f6b8b=await bcrypt[_0x27f05a(0x1a8)](_0xdc7313,0xa);await conn[_0x27f05a(0x154)]()[_0x27f05a(0x156)](_0x27f05a(0x187),[_0x2f6b8b,_0xb7de08]),_0x496b95[_0x27f05a(0x1a7)](0xc8)[_0x27f05a(0x15a)]({'success':!![]});}}catch(_0x1ae078){console[_0x27f05a(0x196)]({'err':_0x1ae078}),_0x496b95[_0x27f05a(0x1a7)](0x1f4)[_0x27f05a(0x15a)]({'error':_0x27f05a(0x15b)});return;}}),router['post'](a1_0x36ca91(0x19e),upload[a1_0x36ca91(0x199)](a1_0x36ca91(0x189)),verifyToken,async(_0x123def,_0xa65c88,_0x1836d6)=>{const _0x588cd9=a1_0x36ca91,{username:_0x419c5a,first_name:_0x3f09b4,last_name:_0x4ca995}=_0x123def[_0x588cd9(0x16c)],_0x51515d=_0x123def['user'][_0x588cd9(0x19f)];let _0x5a4f21;try{const [_0x470c27]=await conn[_0x588cd9(0x154)]()[_0x588cd9(0x156)](_0x588cd9(0x174),[_0x51515d]);_0x470c27[_0x588cd9(0x1aa)]>0x0&&(_0x5a4f21=_0x470c27[0x0]);}catch(_0x3afb3b){console[_0x588cd9(0x196)]({'err':_0x3afb3b}),_0xa65c88[_0x588cd9(0x1a7)](0x1f4)[_0x588cd9(0x15a)]({'error':_0x588cd9(0x15b)});return;}if(!_0x5a4f21){_0xa65c88[_0x588cd9(0x1a7)](0x191)[_0x588cd9(0x15a)]({'error':_0x588cd9(0x166)});return;}console[_0x588cd9(0x196)]({'req':_0x123def[_0x588cd9(0x16c)]});let _0x2383d5=_0x5a4f21[_0x588cd9(0x163)];if(_0x123def[_0x588cd9(0x15e)]){const _0x4e673c=_0x588cd9(0x15f)+randomUUID()+_0x588cd9(0x180);fs[_0x588cd9(0x15c)](_0x123def[_0x588cd9(0x15e)][_0x588cd9(0x18f)],'./'+_0x4e673c),fs[_0x588cd9(0x158)](_0x123def[_0x588cd9(0x15e)][_0x588cd9(0x18f)]),config[_0x588cd9(0x165)]?_0x2383d5=config[_0x588cd9(0x168)]+'/'+_0x4e673c:_0x2383d5=config[_0x588cd9(0x194)]+'/'+_0x4e673c;}try{await conn[_0x588cd9(0x154)]()[_0x588cd9(0x156)](_0x588cd9(0x1a6),[_0x419c5a,_0x3f09b4,_0x4ca995,_0x2383d5,_0x51515d]);let _0x2a9d49;try{_0x2a9d49=jwt[_0x588cd9(0x159)]({'userId':_0x5a4f21['id'],'email':_0x5a4f21[_0x588cd9(0x19f)]},config[_0x588cd9(0x167)],{'expiresIn':_0x588cd9(0x1ad)});}catch(_0x5e5abe){console['log'](_0x5e5abe),_0xa65c88[_0x588cd9(0x1a7)](0x1f4)[_0x588cd9(0x15a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0xa65c88[_0x588cd9(0x1a7)](0xc8)[_0x588cd9(0x15a)]({'success':!![],'data':{'userId':_0x5a4f21['id'],'username':_0x419c5a,'first_name':_0x3f09b4,'last_name':_0x4ca995,'email':_0x5a4f21[_0x588cd9(0x19f)],'avatar_url':_0x2383d5,'token':_0x2a9d49}});}catch(_0x10993f){console['log']({'err':_0x10993f}),_0xa65c88[_0x588cd9(0x1a7)](0x1f4)['json']({'error':_0x588cd9(0x15b)});return;}}),module['exports']=router;