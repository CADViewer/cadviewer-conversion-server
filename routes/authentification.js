function a1_0x1329(_0x5145a5,_0x3d0e91){const _0x1fd0f9=a1_0x1fd0();return a1_0x1329=function(_0x1329a5,_0x4480b0){_0x1329a5=_0x1329a5-0xc9;let _0x35ec96=_0x1fd0f9[_0x1329a5];return _0x35ec96;},a1_0x1329(_0x5145a5,_0x3d0e91);}const a1_0x41b6a2=a1_0x1329;(function(_0x5a1b96,_0x85e4c4){const _0xc5a5cd=a1_0x1329,_0x497343=_0x5a1b96();while(!![]){try{const _0x316827=parseInt(_0xc5a5cd(0x101))/0x1*(parseInt(_0xc5a5cd(0xe5))/0x2)+parseInt(_0xc5a5cd(0x126))/0x3+parseInt(_0xc5a5cd(0xd7))/0x4*(parseInt(_0xc5a5cd(0xe8))/0x5)+parseInt(_0xc5a5cd(0xcb))/0x6*(parseInt(_0xc5a5cd(0x114))/0x7)+-parseInt(_0xc5a5cd(0xdd))/0x8*(parseInt(_0xc5a5cd(0x129))/0x9)+-parseInt(_0xc5a5cd(0xd2))/0xa*(-parseInt(_0xc5a5cd(0x105))/0xb)+-parseInt(_0xc5a5cd(0xd0))/0xc*(parseInt(_0xc5a5cd(0xee))/0xd);if(_0x316827===_0x85e4c4)break;else _0x497343['push'](_0x497343['shift']());}catch(_0x2d5a19){_0x497343['push'](_0x497343['shift']());}}}(a1_0x1fd0,0x871f0));function a1_0x1fd0(){const _0x2d9227=['Error\x20parsing\x20geolocation\x20data:','Error\x20during\x20reCAPTCHA\x20verification.','enableEmailVerification','exports','crypto','log','avatar','username','24h','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','hash','Error\x20during\x20user\x20creation:','Invalid\x20validation\x20token','city','data','3143193MNfBwQ','./uploads/','../libs/email-utils','98631zVVqyL','===================error===================','execute','118578bflUeV','mkdirSync','avatars','languages','file','33989784IdbIiT','jwtSecretKey','2960HrDeQA','insertId','time_zone','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','demo_user','91480aguAJa','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','Error!\x20Something\x20went\x20wrong.','Invalid\x20user','User\x20already\x20exists','compare','136IprZGG','path','single','bcrypt','message','avatar_url','callbackMethod_gatewayUrl','last_name','549166MYezue','./avatars','crypted_password','45xEmmPq','error-codes','sign','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','https://www.google.com/recaptcha/api/siteverify','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','13WaziLU','Invalid\x20password','diskStorage','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','error','../libs/mysql.js','body','callbackMethod_gatewayUrl_flag','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','Router','express','reCAPTCHA\x20verification\x20error:','user','role','name','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','Email\x20validated\x20successfully','/update-password','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','3WLpMhF','copyFileSync','status','stack','25443bQtZuo','.png','post','length','recaptchaEnabled','../CADViewer_config.json','promise','json','avatars/','/login','existsSync','email','code','ServerUrl','params','287XbtXYA','success','multer'];a1_0x1fd0=function(){return _0x2d9227;};return a1_0x1fd0();}const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x41b6a2(0xe0)),config=require(a1_0x41b6a2(0x10a)),conn=require(a1_0x41b6a2(0xf3)),multer=require(a1_0x41b6a2(0x116)),fs=require('fs'),verifyToken=require('../libs/jwt')['verifyToken'],{sendWelcomeEmail}=require(a1_0x41b6a2(0x128)),axios=require('axios');!fs[a1_0x41b6a2(0x10f)]('./avatars')&&fs[a1_0x41b6a2(0xcc)](a1_0x41b6a2(0xe6));const express=require(a1_0x41b6a2(0xf8)),router=express[a1_0x41b6a2(0xf7)](),{randomUUID}=require(a1_0x41b6a2(0x11b)),storage=multer[a1_0x41b6a2(0xf0)]({'destination':function(_0x2c13f5,_0x5c540b,_0x326413){const _0x1fe9ac=a1_0x41b6a2;_0x326413(null,_0x1fe9ac(0xcd));}}),upload=multer({'storage':storage});router[a1_0x41b6a2(0x107)](a1_0x41b6a2(0x10e),async(_0x483def,_0x38be7d,_0x46f40f)=>{const _0x47d2ed=a1_0x41b6a2;let {email:_0x598fcc,password:_0x11fe88}=_0x483def['body'];console['log']({'email':_0x598fcc,'password':_0x11fe88});let _0x346815;try{const [_0x235129]=await conn[_0x47d2ed(0x10b)]()[_0x47d2ed(0xca)](_0x47d2ed(0xeb),[_0x598fcc]);_0x235129[_0x47d2ed(0x108)]>0x0&&(_0x346815=_0x235129[0x0]);}catch(_0xb37aaf){console[_0x47d2ed(0x11c)]({'err':_0xb37aaf}),_0x38be7d[_0x47d2ed(0x103)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x346815||!await bcrypt[_0x47d2ed(0xdc)](_0x11fe88,_0x346815?.[_0x47d2ed(0xe7)])){_0x38be7d[_0x47d2ed(0x103)](0x191)[_0x47d2ed(0x10c)]({'error':'Invalid\x20email\x20or\x20password'});return;}let _0x2e4fa9;try{_0x2e4fa9=jwt[_0x47d2ed(0xea)]({'userId':_0x346815['id'],'email':_0x346815[_0x47d2ed(0x110)]},config['jwtSecretKey'],{'expiresIn':'24h'});}catch(_0x2c989b){console[_0x47d2ed(0x11c)](_0x2c989b),_0x38be7d[_0x47d2ed(0x103)](0x1f4)[_0x47d2ed(0x10c)]({'error':_0x47d2ed(0xd9)});return;}_0x38be7d[_0x47d2ed(0x103)](0xc8)[_0x47d2ed(0x10c)]({'success':!![],'data':{'userId':_0x346815['id'],'username':_0x346815[_0x47d2ed(0x11e)],'first_name':_0x346815['first_name'],'last_name':_0x346815[_0x47d2ed(0xe4)],'email':_0x346815[_0x47d2ed(0x110)],'avatar_url':_0x346815[_0x47d2ed(0xe2)],'id':_0x346815['id'],'role':_0x346815[_0x47d2ed(0xfb)],'token':_0x2e4fa9}});}),router[a1_0x41b6a2(0x107)]('/signup',async(_0xb0a47b,_0x5e0592,_0x238f62)=>{const _0x8a0ad0=a1_0x41b6a2,{username:_0x2776d6,email:_0x405838,password:_0x58db5b,geolocation:_0x5577df,recaptchaToken:_0xe95294}=_0xb0a47b[_0x8a0ad0(0xf4)];if(config[_0x8a0ad0(0x109)]){if(!_0xe95294)return _0x5e0592[_0x8a0ad0(0x103)](0x190)[_0x8a0ad0(0x10c)]({'error':_0x8a0ad0(0xed)});try{const _0x2b91f4=await axios[_0x8a0ad0(0x107)](_0x8a0ad0(0xec),null,{'params':{'secret':config['recaptchaSecretKey'],'response':_0xe95294}});if(!_0x2b91f4[_0x8a0ad0(0x125)][_0x8a0ad0(0x115)])return _0x5e0592[_0x8a0ad0(0x103)](0x190)[_0x8a0ad0(0x10c)]({'error':_0x8a0ad0(0xed),'recaptchaErrors':_0x2b91f4[_0x8a0ad0(0x125)][_0x8a0ad0(0xe9)]});}catch(_0x12e0ed){return console[_0x8a0ad0(0xf2)](_0x8a0ad0(0xf9),_0x12e0ed),_0x5e0592['status'](0x1f4)['json']({'error':_0x8a0ad0(0x118)});}}const [_0xb2b065]=await conn[_0x8a0ad0(0x10b)]()[_0x8a0ad0(0xca)](_0x8a0ad0(0xf6),[_0x405838]);if(_0xb2b065[_0x8a0ad0(0x108)]>0x0){_0x5e0592[_0x8a0ad0(0x103)](0x1a6)[_0x8a0ad0(0x10c)]({'error':_0x8a0ad0(0xdb)});return;}const _0x2e7e5a=await bcrypt[_0x8a0ad0(0x121)](_0x58db5b,0xa);let _0x372ed0=null,_0x14a1b2=0x1;config[_0x8a0ad0(0x119)]&&(_0x372ed0=randomUUID(),_0x14a1b2=0x0);let _0x16cb39=null,_0x20eb81=null,_0x4d04e6=null,_0xb53135=null,_0x588dda=null,_0xa561f7=null;if(_0x5577df)try{const _0x26c303=_0x5577df;_0x16cb39=_0x26c303[_0x8a0ad0(0x124)]||null,_0x20eb81=_0x26c303['region']||null,_0x4d04e6=_0x26c303['country_name']||null,_0x26c303[_0x8a0ad0(0xce)]&&_0x26c303['languages'][_0x8a0ad0(0x108)]>0x0&&(_0xb53135=_0x26c303['languages'][0x0][_0x8a0ad0(0x111)]||null,_0x588dda=_0x26c303[_0x8a0ad0(0xce)][0x0][_0x8a0ad0(0xfc)]||null),_0x26c303[_0x8a0ad0(0xd4)]&&(_0xa561f7=_0x26c303['time_zone'][_0x8a0ad0(0xfc)]||null);}catch(_0x2bd3ae){console[_0x8a0ad0(0x11c)](_0x8a0ad0(0x117),_0x2bd3ae);}let _0x146816;try{const _0x560a4d=randomUUID(),_0x537c0a=_0x8a0ad0(0x127)+_0x560a4d;fs['mkdirSync'](_0x537c0a);const [_0x5625ea]=await conn[_0x8a0ad0(0x10b)]()[_0x8a0ad0(0xca)](_0x8a0ad0(0xd8),[_0x2776d6,_0x405838,_0x2e7e5a,_0x8a0ad0(0xd6),_0x14a1b2,_0x372ed0,_0x560a4d,_0x16cb39,_0x20eb81,_0x4d04e6,_0xb53135,_0x588dda,_0xa561f7]);if(_0x5625ea[_0x8a0ad0(0xd3)]){const [_0x2141af]=await conn[_0x8a0ad0(0x10b)]()[_0x8a0ad0(0xca)](_0x8a0ad0(0xd5),[_0x5625ea['insertId']]);_0x2141af[_0x8a0ad0(0x108)]>0x0&&(_0x146816=_0x2141af[0x0]);}}catch(_0xc8400b){console[_0x8a0ad0(0x11c)](_0x8a0ad0(0x122),_0xc8400b),_0x5e0592[_0x8a0ad0(0x103)](0x1f4)[_0x8a0ad0(0x10c)]({'error':_0x8a0ad0(0xd9)});return;}let _0x283ea7;try{_0x283ea7=jwt[_0x8a0ad0(0xea)]({'userId':_0x146816['id'],'email':_0x146816['email']},config['jwtSecretKey'],{'expiresIn':_0x8a0ad0(0x11f)});}catch(_0x529af0){_0x5e0592['status'](0x1f4)['json']({'error':_0x8a0ad0(0xd9)});return;}if(config[_0x8a0ad0(0x119)]){try{await sendWelcomeEmail(_0x146816,_0x372ed0);}catch(_0xabf7f9){console['log'](_0x8a0ad0(0xc9)),console[_0x8a0ad0(0x11c)](_0xabf7f9);}_0x5e0592[_0x8a0ad0(0x103)](0xc8)[_0x8a0ad0(0x10c)]({'success':!![],'message':_0x8a0ad0(0x120)});return;}_0x5e0592[_0x8a0ad0(0x103)](0xc9)['json']({'success':!![],'data':{'userId':_0x146816['id'],'username':_0x146816[_0x8a0ad0(0x11e)],'first_name':_0x146816['first_name'],'last_name':_0x146816[_0x8a0ad0(0xe4)],'email':_0x146816[_0x8a0ad0(0x110)],'avatar_url':_0x146816[_0x8a0ad0(0xe2)],'id':_0x146816['id'],'role':_0x146816['role'],'token':_0x283ea7,'is_enabled':_0x146816['is_enabled']}});}),router['post']('/validate-email/:token',async(_0x45a75e,_0x21de5c)=>{const _0x1fc9f2=a1_0x41b6a2;try{const {token:_0x29afe4}=_0x45a75e[_0x1fc9f2(0x113)],[_0xadfae]=await conn[_0x1fc9f2(0x10b)]()[_0x1fc9f2(0xca)](_0x1fc9f2(0xfd),[_0x29afe4]);if(_0xadfae[_0x1fc9f2(0x108)]===0x0){_0x21de5c['status'](0x194)[_0x1fc9f2(0x10c)]({'error':_0x1fc9f2(0x123)});return;}await conn[_0x1fc9f2(0x10b)]()['execute'](_0x1fc9f2(0xf1),[_0x29afe4]);const _0x1413a1=jwt['sign']({'id':_0xadfae[0x0]['id'],'email':_0xadfae[0x0][_0x1fc9f2(0x110)]},config[_0x1fc9f2(0xd1)],{'expiresIn':_0x1fc9f2(0x11f)});_0x21de5c[_0x1fc9f2(0x103)](0xc8)[_0x1fc9f2(0x10c)]({'success':!![],'message':_0x1fc9f2(0xfe),'data':{'userId':_0xadfae[0x0]['id'],'username':_0xadfae[0x0][_0x1fc9f2(0x11e)],'first_name':_0xadfae[0x0]['first_name'],'last_name':_0xadfae[0x0]['last_name'],'email':_0xadfae[0x0][_0x1fc9f2(0x110)],'avatar_url':_0xadfae[0x0][_0x1fc9f2(0xe2)],'id':_0xadfae[0x0]['id'],'role':_0xadfae[0x0]['role'],'token':_0x1413a1,'is_enabled':0x1}});}catch(_0x5971d6){console[_0x1fc9f2(0x11c)](_0x1fc9f2(0xc9)),console['log'](_0x5971d6),_0x21de5c[_0x1fc9f2(0x103)](0x1f4)[_0x1fc9f2(0x10c)]({'error':'Error!\x20Something\x20went\x20wrong.','stack':_0x5971d6[_0x1fc9f2(0x104)],'message':_0x5971d6[_0x1fc9f2(0xe1)]});}}),router['post'](a1_0x41b6a2(0xff),verifyToken,async(_0x4f9a2e,_0x403466,_0x30cc14)=>{const _0x48ae08=a1_0x41b6a2,{current_password:_0x5daa8e,new_password:_0x351659}=_0x4f9a2e['body'];console[_0x48ae08(0x11c)]({'body':_0x4f9a2e[_0x48ae08(0xf4)]});const _0x2cb4e9=_0x4f9a2e[_0x48ae08(0xfa)][_0x48ae08(0x110)];let _0x25dcfa;try{const [_0x1559dc]=await conn[_0x48ae08(0x10b)]()['execute'](_0x48ae08(0xf6),[_0x2cb4e9]);if(_0x1559dc[_0x48ae08(0x108)]>0x0){_0x25dcfa=_0x1559dc[0x0];if(!await bcrypt[_0x48ae08(0xdc)](_0x5daa8e,_0x25dcfa[_0x48ae08(0xe7)])){_0x403466['status'](0x191)[_0x48ae08(0x10c)]({'error':_0x48ae08(0xef)});return;}const _0x51e0fe=await bcrypt[_0x48ae08(0x121)](_0x351659,0xa);await conn['promise']()[_0x48ae08(0xca)]('UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x51e0fe,_0x2cb4e9]),_0x403466['status'](0xc8)[_0x48ae08(0x10c)]({'success':!![]});}}catch(_0x11552a){console[_0x48ae08(0x11c)]({'err':_0x11552a}),_0x403466[_0x48ae08(0x103)](0x1f4)['json']({'error':_0x48ae08(0xd9)});return;}}),router[a1_0x41b6a2(0x107)]('/update-user-info',upload[a1_0x41b6a2(0xdf)](a1_0x41b6a2(0x11d)),verifyToken,async(_0x509de5,_0x29c7c3,_0x1bcd00)=>{const _0x3125a7=a1_0x41b6a2,{username:_0x492a0b,first_name:_0x26fc89,last_name:_0x125598}=_0x509de5[_0x3125a7(0xf4)],_0x58d4c2=_0x509de5[_0x3125a7(0xfa)][_0x3125a7(0x110)];let _0x476736;try{const [_0x44d737]=await conn[_0x3125a7(0x10b)]()[_0x3125a7(0xca)](_0x3125a7(0xf6),[_0x58d4c2]);_0x44d737[_0x3125a7(0x108)]>0x0&&(_0x476736=_0x44d737[0x0]);}catch(_0x485125){console[_0x3125a7(0x11c)]({'err':_0x485125}),_0x29c7c3[_0x3125a7(0x103)](0x1f4)['json']({'error':_0x3125a7(0xd9)});return;}if(!_0x476736){_0x29c7c3[_0x3125a7(0x103)](0x191)[_0x3125a7(0x10c)]({'error':_0x3125a7(0xda)});return;}console[_0x3125a7(0x11c)]({'req':_0x509de5[_0x3125a7(0xf4)]});let _0xa13b95=_0x476736[_0x3125a7(0xe2)];if(_0x509de5[_0x3125a7(0xcf)]){const _0x246c8c=_0x3125a7(0x10d)+randomUUID()+_0x3125a7(0x106);fs[_0x3125a7(0x102)](_0x509de5[_0x3125a7(0xcf)]['path'],'./'+_0x246c8c),fs['unlinkSync'](_0x509de5[_0x3125a7(0xcf)][_0x3125a7(0xde)]),config[_0x3125a7(0xf5)]?_0xa13b95=config[_0x3125a7(0xe3)]+'/'+_0x246c8c:_0xa13b95=config[_0x3125a7(0x112)]+'/'+_0x246c8c;}try{await conn[_0x3125a7(0x10b)]()[_0x3125a7(0xca)](_0x3125a7(0x100),[_0x492a0b,_0x26fc89,_0x125598,_0xa13b95,_0x58d4c2]);let _0x33bd92;try{_0x33bd92=jwt[_0x3125a7(0xea)]({'userId':_0x476736['id'],'email':_0x476736[_0x3125a7(0x110)]},config[_0x3125a7(0xd1)],{'expiresIn':_0x3125a7(0x11f)});}catch(_0x45dcda){console[_0x3125a7(0x11c)](_0x45dcda),_0x29c7c3[_0x3125a7(0x103)](0x1f4)[_0x3125a7(0x10c)]({'error':_0x3125a7(0xd9)});return;}_0x29c7c3[_0x3125a7(0x103)](0xc8)[_0x3125a7(0x10c)]({'success':!![],'data':{'userId':_0x476736['id'],'username':_0x492a0b,'first_name':_0x26fc89,'last_name':_0x125598,'email':_0x476736[_0x3125a7(0x110)],'avatar_url':_0xa13b95,'token':_0x33bd92}});}catch(_0x495808){console[_0x3125a7(0x11c)]({'err':_0x495808}),_0x29c7c3[_0x3125a7(0x103)](0x1f4)[_0x3125a7(0x10c)]({'error':_0x3125a7(0xd9)});return;}}),module[a1_0x41b6a2(0x11a)]=router;