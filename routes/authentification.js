const a1_0x1ff4cc=a1_0xaa0e;(function(_0x2d6224,_0x5500a3){const _0x333a7e=a1_0xaa0e,_0x5132e4=_0x2d6224();while(!![]){try{const _0x110633=-parseInt(_0x333a7e(0x115))/0x1+parseInt(_0x333a7e(0x10d))/0x2*(-parseInt(_0x333a7e(0x133))/0x3)+parseInt(_0x333a7e(0x100))/0x4+-parseInt(_0x333a7e(0x118))/0x5*(parseInt(_0x333a7e(0x142))/0x6)+-parseInt(_0x333a7e(0x14c))/0x7*(parseInt(_0x333a7e(0x13b))/0x8)+-parseInt(_0x333a7e(0x122))/0x9*(parseInt(_0x333a7e(0x101))/0xa)+-parseInt(_0x333a7e(0x14b))/0xb*(-parseInt(_0x333a7e(0x11f))/0xc);if(_0x110633===_0x5500a3)break;else _0x5132e4['push'](_0x5132e4['shift']());}catch(_0x4f8a8f){_0x5132e4['push'](_0x5132e4['shift']());}}}(a1_0x5582,0x9d278));const jwt=require(a1_0x1ff4cc(0x143)),bcrypt=require(a1_0x1ff4cc(0x147)),config=require(a1_0x1ff4cc(0x102)),conn=require(a1_0x1ff4cc(0x13f)),multer=require(a1_0x1ff4cc(0x128)),fs=require('fs'),verifyToken=require('../libs/jwt')[a1_0x1ff4cc(0x141)];!fs[a1_0x1ff4cc(0x148)]('./avatars')&&fs[a1_0x1ff4cc(0x139)]('./avatars');const express=require(a1_0x1ff4cc(0x138)),router=express[a1_0x1ff4cc(0x127)](),{randomUUID}=require('crypto'),storage=multer[a1_0x1ff4cc(0x126)]({'destination':function(_0x5809f1,_0x3d3ae1,_0x27df7a){const _0x347219=a1_0x1ff4cc;_0x27df7a(null,_0x347219(0x14a));}}),upload=multer({'storage':storage});router[a1_0x1ff4cc(0xfa)](a1_0x1ff4cc(0x105),async(_0x168e93,_0x389f05,_0x3f6264)=>{const _0x51f4c7=a1_0x1ff4cc;let {email:_0x53203a,password:_0x2a06c5}=_0x168e93['body'];console[_0x51f4c7(0x11b)]({'email':_0x53203a,'password':_0x2a06c5});let _0x174da5;try{const [_0x239d68]=await conn['promise']()[_0x51f4c7(0x14e)](_0x51f4c7(0x104),[_0x53203a]);_0x239d68[_0x51f4c7(0x103)]>0x0&&(_0x174da5=_0x239d68[0x0]);}catch(_0x21d67a){console[_0x51f4c7(0x11b)]({'err':_0x21d67a}),_0x389f05[_0x51f4c7(0xfc)](0x1f4)[_0x51f4c7(0x107)]({'error':_0x51f4c7(0x129)});return;}if(!_0x174da5||!await bcrypt[_0x51f4c7(0x11a)](_0x2a06c5,_0x174da5?.[_0x51f4c7(0x123)])){_0x389f05[_0x51f4c7(0xfc)](0x191)[_0x51f4c7(0x107)]({'error':_0x51f4c7(0x150)});return;}let _0x396e83;try{_0x396e83=jwt[_0x51f4c7(0x114)]({'userId':_0x174da5['id'],'email':_0x174da5[_0x51f4c7(0x12c)]},config['jwtSecretKey'],{'expiresIn':_0x51f4c7(0x130)});}catch(_0x35cb3a){console[_0x51f4c7(0x11b)](_0x35cb3a),_0x389f05[_0x51f4c7(0xfc)](0x1f4)[_0x51f4c7(0x107)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x389f05[_0x51f4c7(0xfc)](0xc8)[_0x51f4c7(0x107)]({'success':!![],'data':{'userId':_0x174da5['id'],'username':_0x174da5[_0x51f4c7(0xfe)],'first_name':_0x174da5['first_name'],'last_name':_0x174da5[_0x51f4c7(0x10c)],'email':_0x174da5[_0x51f4c7(0x12c)],'avatar_url':_0x174da5[_0x51f4c7(0x12e)],'id':_0x174da5['id'],'role':_0x174da5[_0x51f4c7(0x12b)],'token':_0x396e83}});}),router['post'](a1_0x1ff4cc(0x119),async(_0x3101a3,_0x4a8be0,_0x197f85)=>{const _0x4c5908=a1_0x1ff4cc,{username:_0x52a72d,email:_0x49ab78,password:_0x3f9c91}=_0x3101a3[_0x4c5908(0x109)],[_0x428b47]=await conn[_0x4c5908(0x140)]()[_0x4c5908(0x14e)](_0x4c5908(0x134),[_0x49ab78]);if(_0x428b47[_0x4c5908(0x103)]>0x0){_0x4a8be0['status'](0x1a6)[_0x4c5908(0x107)]({'error':_0x4c5908(0x13a)});return;}const _0x2a54b8=await bcrypt[_0x4c5908(0x145)](_0x3f9c91,0xa);let _0x211de0=null,_0x5080fd=0x1;config[_0x4c5908(0x120)]&&(_0x211de0=randomUUID(),_0x5080fd=0x0);let _0xb1c22e;try{const _0x54d432=randomUUID(),_0x5b7fdf='./uploads/'+_0x54d432;fs[_0x4c5908(0x139)](_0x5b7fdf);const [_0x25c668]=await conn[_0x4c5908(0x140)]()[_0x4c5908(0x14e)]('INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)',[_0x52a72d,_0x49ab78,_0x2a54b8,_0x4c5908(0x146),_0x5080fd,_0x211de0,_0x54d432]);if(_0x25c668['insertId']){const [_0x234b6a]=await conn['promise']()['execute'](_0x4c5908(0xfd),[_0x25c668[_0x4c5908(0x108)]]);_0x234b6a[_0x4c5908(0x103)]>0x0&&(_0xb1c22e=_0x234b6a[0x0]);}}catch{_0x4a8be0[_0x4c5908(0xfc)](0x1f4)[_0x4c5908(0x107)]({'error':_0x4c5908(0x129)});return;}let _0x3ea44d;try{_0x3ea44d=jwt[_0x4c5908(0x114)]({'userId':_0xb1c22e['id'],'email':_0xb1c22e['email']},config[_0x4c5908(0x144)],{'expiresIn':'24h'});}catch(_0xe76471){_0x4a8be0[_0x4c5908(0xfc)](0x1f4)[_0x4c5908(0x107)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}const _0x27e727=require('../libs/mail')[_0x4c5908(0x10f)];let _0x179a8c=_0x4c5908(0x124);if(config[_0x4c5908(0x120)]){var _0x1c085d=config[_0x4c5908(0xff)];_0x1c085d[_0x4c5908(0x11d)]('/')&&(_0x1c085d=_0x1c085d['slice'](0x0,-0x1));const _0xd415e9=_0x1c085d+_0x4c5908(0x135)+_0x211de0;_0x179a8c='\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22'+_0xd415e9+'\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>'+_0xd415e9+_0x4c5908(0x12d);const _0x472484={'from':config[_0x4c5908(0x137)],'to':_0xb1c22e['email'],'subject':_0x4c5908(0x13d),'text':_0x4c5908(0x13d),'html':_0x179a8c};try{await _0x27e727['sendMail'](_0x472484);}catch(_0x4716aa){console[_0x4c5908(0x11b)]('===================error==================='),console[_0x4c5908(0x11b)](_0x4716aa),_0x4a8be0[_0x4c5908(0xfc)](0x1f4)[_0x4c5908(0x107)]({'error':_0x4c5908(0x121),'stack':_0x4716aa[_0x4c5908(0x131)],'message':_0x4716aa[_0x4c5908(0x117)]});return;}_0x4a8be0[_0x4c5908(0xfc)](0xc8)[_0x4c5908(0x107)]({'success':!![],'message':_0x4c5908(0x14f)});return;}_0x4a8be0[_0x4c5908(0xfc)](0xc9)[_0x4c5908(0x107)]({'success':!![],'data':{'userId':_0xb1c22e['id'],'username':_0xb1c22e[_0x4c5908(0xfe)],'first_name':_0xb1c22e[_0x4c5908(0x136)],'last_name':_0xb1c22e[_0x4c5908(0x10c)],'email':_0xb1c22e[_0x4c5908(0x12c)],'avatar_url':_0xb1c22e[_0x4c5908(0x12e)],'id':_0xb1c22e['id'],'role':_0xb1c22e[_0x4c5908(0x12b)],'token':_0x3ea44d,'is_enabled':_0xb1c22e[_0x4c5908(0xfb)]}});}),router[a1_0x1ff4cc(0xfa)](a1_0x1ff4cc(0x13e),async(_0x3a5911,_0x3f8473)=>{const _0x25dd12=a1_0x1ff4cc;try{const {token:_0x2fdd38}=_0x3a5911[_0x25dd12(0x110)],[_0x48a729]=await conn['promise']()[_0x25dd12(0x14e)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?',[_0x2fdd38]);if(_0x48a729[_0x25dd12(0x103)]===0x0){_0x3f8473['status'](0x194)['json']({'error':_0x25dd12(0x12a)});return;}await conn[_0x25dd12(0x140)]()[_0x25dd12(0x14e)](_0x25dd12(0x12f),[_0x2fdd38]);const _0x53dcfd=jwt['sign']({'id':_0x48a729[0x0]['id'],'email':_0x48a729[0x0][_0x25dd12(0x12c)]},config[_0x25dd12(0x144)],{'expiresIn':_0x25dd12(0x130)});_0x3f8473[_0x25dd12(0xfc)](0xc8)[_0x25dd12(0x107)]({'success':!![],'message':_0x25dd12(0x116),'data':{'userId':_0x48a729[0x0]['id'],'username':_0x48a729[0x0][_0x25dd12(0xfe)],'first_name':_0x48a729[0x0][_0x25dd12(0x136)],'last_name':_0x48a729[0x0][_0x25dd12(0x10c)],'email':_0x48a729[0x0][_0x25dd12(0x12c)],'avatar_url':_0x48a729[0x0][_0x25dd12(0x12e)],'id':_0x48a729[0x0]['id'],'role':_0x48a729[0x0][_0x25dd12(0x12b)],'token':_0x53dcfd,'is_enabled':0x1}});}catch(_0x194ea1){console[_0x25dd12(0x11b)](_0x25dd12(0x10a)),console['log'](_0x194ea1),_0x3f8473['status'](0x1f4)[_0x25dd12(0x107)]({'error':_0x25dd12(0x129),'stack':_0x194ea1['stack'],'message':_0x194ea1['message']});}}),router[a1_0x1ff4cc(0xfa)](a1_0x1ff4cc(0x10b),verifyToken,async(_0x883fac,_0x598893,_0x5d18bd)=>{const _0x35f160=a1_0x1ff4cc,{current_password:_0x2368b8,new_password:_0x44e39f}=_0x883fac[_0x35f160(0x109)];console[_0x35f160(0x11b)]({'body':_0x883fac['body']});const _0x16a192=_0x883fac[_0x35f160(0x111)]['email'];let _0x84183b;try{const [_0x1b0cea]=await conn[_0x35f160(0x140)]()[_0x35f160(0x14e)](_0x35f160(0x134),[_0x16a192]);if(_0x1b0cea[_0x35f160(0x103)]>0x0){_0x84183b=_0x1b0cea[0x0];if(!await bcrypt[_0x35f160(0x11a)](_0x2368b8,_0x84183b[_0x35f160(0x123)])){_0x598893[_0x35f160(0xfc)](0x191)[_0x35f160(0x107)]({'error':_0x35f160(0x125)});return;}const _0x4dd752=await bcrypt[_0x35f160(0x145)](_0x44e39f,0xa);await conn[_0x35f160(0x140)]()[_0x35f160(0x14e)](_0x35f160(0x10e),[_0x4dd752,_0x16a192]),_0x598893[_0x35f160(0xfc)](0xc8)['json']({'success':!![]});}}catch(_0x400492){console[_0x35f160(0x11b)]({'err':_0x400492}),_0x598893[_0x35f160(0xfc)](0x1f4)[_0x35f160(0x107)]({'error':_0x35f160(0x129)});return;}}),router[a1_0x1ff4cc(0xfa)]('/update-user-info',upload[a1_0x1ff4cc(0x11c)](a1_0x1ff4cc(0x132)),verifyToken,async(_0x187cf7,_0x3687db,_0x48ffa9)=>{const _0x45a7f5=a1_0x1ff4cc,{username:_0x56a97b,first_name:_0x497b51,last_name:_0x1367bb}=_0x187cf7[_0x45a7f5(0x109)],_0x3b633c=_0x187cf7[_0x45a7f5(0x111)][_0x45a7f5(0x12c)];let _0x56907a;try{const [_0x43abb2]=await conn[_0x45a7f5(0x140)]()[_0x45a7f5(0x14e)](_0x45a7f5(0x134),[_0x3b633c]);_0x43abb2[_0x45a7f5(0x103)]>0x0&&(_0x56907a=_0x43abb2[0x0]);}catch(_0x4fd336){console[_0x45a7f5(0x11b)]({'err':_0x4fd336}),_0x3687db[_0x45a7f5(0xfc)](0x1f4)[_0x45a7f5(0x107)]({'error':_0x45a7f5(0x129)});return;}if(!_0x56907a){_0x3687db[_0x45a7f5(0xfc)](0x191)['json']({'error':_0x45a7f5(0x112)});return;}console[_0x45a7f5(0x11b)]({'req':_0x187cf7[_0x45a7f5(0x109)]});let _0x40467d=_0x56907a[_0x45a7f5(0x12e)];if(_0x187cf7[_0x45a7f5(0x113)]){const _0x37f7b7='avatars/'+randomUUID()+_0x45a7f5(0x13c);fs[_0x45a7f5(0x11e)](_0x187cf7[_0x45a7f5(0x113)]['path'],'./'+_0x37f7b7),fs['unlinkSync'](_0x187cf7[_0x45a7f5(0x113)][_0x45a7f5(0x14d)]),_0x40467d=config[_0x45a7f5(0x106)]+'/'+_0x37f7b7;}try{await conn[_0x45a7f5(0x140)]()[_0x45a7f5(0x14e)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x56a97b,_0x497b51,_0x1367bb,_0x40467d,_0x3b633c]);let _0xbdc36e;try{_0xbdc36e=jwt['sign']({'userId':_0x56907a['id'],'email':_0x56907a[_0x45a7f5(0x12c)]},config[_0x45a7f5(0x144)],{'expiresIn':_0x45a7f5(0x130)});}catch(_0x83b350){console[_0x45a7f5(0x11b)](_0x83b350),_0x3687db['status'](0x1f4)[_0x45a7f5(0x107)]({'error':_0x45a7f5(0x129)});return;}_0x3687db[_0x45a7f5(0xfc)](0xc8)[_0x45a7f5(0x107)]({'success':!![],'data':{'userId':_0x56907a['id'],'username':_0x56a97b,'first_name':_0x497b51,'last_name':_0x1367bb,'email':_0x56907a['email'],'avatar_url':_0x40467d,'token':_0xbdc36e}});}catch(_0x164c9e){console[_0x45a7f5(0x11b)]({'err':_0x164c9e}),_0x3687db[_0x45a7f5(0xfc)](0x1f4)[_0x45a7f5(0x107)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module[a1_0x1ff4cc(0x149)]=router;function a1_0xaa0e(_0x795df6,_0x1bb20c){const _0x558259=a1_0x5582();return a1_0xaa0e=function(_0xaa0e4,_0x3b7fea){_0xaa0e4=_0xaa0e4-0xfa;let _0x1281fc=_0x558259[_0xaa0e4];return _0x1281fc;},a1_0xaa0e(_0x795df6,_0x1bb20c);}function a1_0x5582(){const _0x34ff1b=['24h','stack','avatar','97869iGYwqm','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','/validate-email/','first_name','smtpFrom','express','mkdirSync','User\x20already\x20exists','136fdBTqb','.png','Welcome\x20to\x20CADViewer','/validate-email/:token','../libs/mysql.js','promise','verifyToken','167022SEuGVc','jsonwebtoken','jwtSecretKey','hash','demo_user','bcrypt','existsSync','exports','avatars','6314528AsNNps','103271zPJxKt','path','execute','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','Invalid\x20email\x20or\x20password','post','is_enabled','status','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','username','frontendUrl','137752srxrqV','7019570fATpdb','../CADViewer_config.json','length','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','/login','ServerUrl','json','insertId','body','===================error===================','/update-password','last_name','36bnvErP','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','transporter','params','user','Invalid\x20user','file','sign','42385WjFTBf','Email\x20validated\x20successfully','message','225rdRNrE','/signup','compare','log','single','endsWith','copyFileSync','72UaNJrR','enableEmailVerification','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','9xaAfow','crypted_password','<p>Welcome\x20to\x20CADViewer</p>','Invalid\x20password','diskStorage','Router','multer','Error!\x20Something\x20went\x20wrong.','Invalid\x20validation\x20token','role','email','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','avatar_url','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?'];a1_0x5582=function(){return _0x34ff1b;};return a1_0x5582();}