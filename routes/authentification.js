const a1_0x456dca=a1_0x5620;function a1_0x4535(){const _0x4a501b=['</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','sendMail','express','3bfQGOD','first_name','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','52254kVKeef','role','params','existsSync','message','===================error===================','execute','393951mPeMVE','stack','./uploads/','Error!\x20Something\x20went\x20wrong.','endsWith','body','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','frontendUrl','mkdirSync','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','<p>Welcome\x20to\x20CADViewer</p>','enableEmailVerification','smtpFrom','multer','json','length','710RiRqZg','status','email','demo_user','jwtSecretKey','log','username','user','Invalid\x20password','exports','hash','/validate-email/','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','file','24h','slice','compare','single','/update-user-info','avatar_url','crypto','insertId','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','is_enabled','post','55TAVyWv','/update-password','sign','Invalid\x20user','/signup','crypted_password','transporter','./avatars','1076154KmEhNq','868872MiGPaO','../libs/mail','../CADViewer_config.json','avatars','Router','Welcome\x20to\x20CADViewer','438576bqhrAc','21oMOyoC','1173388HqhbCF','../libs/jwt','Invalid\x20email\x20or\x20password','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','../libs/mysql.js','path','Email\x20validated\x20successfully','1902300XptFze','promise','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','5ssntsu','ServerUrl','last_name','unlinkSync'];a1_0x4535=function(){return _0x4a501b;};return a1_0x4535();}(function(_0x2d6018,_0x2f5360){const _0x304d87=a1_0x5620,_0xfcc1b2=_0x2d6018();while(!![]){try{const _0xe8050c=-parseInt(_0x304d87(0x1d6))/0x1+parseInt(_0x304d87(0x1b8))/0x2+-parseInt(_0x304d87(0x1cc))/0x3*(-parseInt(_0x304d87(0x1ba))/0x4)+-parseInt(_0x304d87(0x1c5))/0x5*(-parseInt(_0x304d87(0x1b1))/0x6)+parseInt(_0x304d87(0x1b9))/0x7*(parseInt(_0x304d87(0x1b2))/0x8)+parseInt(_0x304d87(0x1cf))/0x9*(parseInt(_0x304d87(0x1e6))/0xa)+-parseInt(_0x304d87(0x1a9))/0xb*(parseInt(_0x304d87(0x1c1))/0xc);if(_0xe8050c===_0x2f5360)break;else _0xfcc1b2['push'](_0xfcc1b2['shift']());}catch(_0x509294){_0xfcc1b2['push'](_0xfcc1b2['shift']());}}}(a1_0x4535,0x3b70f));const jwt=require('jsonwebtoken'),bcrypt=require('bcrypt'),config=require(a1_0x456dca(0x1b4)),conn=require(a1_0x456dca(0x1be)),multer=require(a1_0x456dca(0x1e3)),fs=require('fs'),verifyToken=require(a1_0x456dca(0x1bb))['verifyToken'];function a1_0x5620(_0x28ebbb,_0x4ad50c){const _0x453528=a1_0x4535();return a1_0x5620=function(_0x562010,_0x57d16e){_0x562010=_0x562010-0x19c;let _0x1cfc6c=_0x453528[_0x562010];return _0x1cfc6c;},a1_0x5620(_0x28ebbb,_0x4ad50c);}!fs[a1_0x456dca(0x1d2)](a1_0x456dca(0x1b0))&&fs[a1_0x456dca(0x1de)]('./avatars');const express=require(a1_0x456dca(0x1cb)),router=express[a1_0x456dca(0x1b6)](),{randomUUID}=require(a1_0x456dca(0x1a4)),storage=multer['diskStorage']({'destination':function(_0x2f25b9,_0x66eb22,_0x198d05){const _0x1e1525=a1_0x456dca;_0x198d05(null,_0x1e1525(0x1b5));}}),upload=multer({'storage':storage});router['post']('/login',async(_0x43c642,_0x10fca3,_0x302611)=>{const _0x2504a2=a1_0x456dca;let {email:_0x1dd0a3,password:_0x402d1c}=_0x43c642['body'];console['log']({'email':_0x1dd0a3,'password':_0x402d1c});let _0x44e6f6;try{const [_0x444071]=await conn[_0x2504a2(0x1c2)]()[_0x2504a2(0x1d5)](_0x2504a2(0x1a6),[_0x1dd0a3]);_0x444071[_0x2504a2(0x1e5)]>0x0&&(_0x44e6f6=_0x444071[0x0]);}catch(_0x1dcf94){console[_0x2504a2(0x1eb)]({'err':_0x1dcf94}),_0x10fca3[_0x2504a2(0x1e7)](0x1f4)[_0x2504a2(0x1e4)]({'error':_0x2504a2(0x1d9)});return;}if(!_0x44e6f6||!await bcrypt[_0x2504a2(0x1a0)](_0x402d1c,_0x44e6f6?.[_0x2504a2(0x1ae)])){_0x10fca3[_0x2504a2(0x1e7)](0x191)['json']({'error':_0x2504a2(0x1bc)});return;}let _0x7d59f7;try{_0x7d59f7=jwt[_0x2504a2(0x1ab)]({'userId':_0x44e6f6['id'],'email':_0x44e6f6[_0x2504a2(0x1e8)]},config[_0x2504a2(0x1ea)],{'expiresIn':_0x2504a2(0x19e)});}catch(_0x393626){console[_0x2504a2(0x1eb)](_0x393626),_0x10fca3[_0x2504a2(0x1e7)](0x1f4)[_0x2504a2(0x1e4)]({'error':_0x2504a2(0x1d9)});return;}_0x10fca3[_0x2504a2(0x1e7)](0xc8)[_0x2504a2(0x1e4)]({'success':!![],'data':{'userId':_0x44e6f6['id'],'username':_0x44e6f6[_0x2504a2(0x1ec)],'first_name':_0x44e6f6['first_name'],'last_name':_0x44e6f6['last_name'],'email':_0x44e6f6[_0x2504a2(0x1e8)],'avatar_url':_0x44e6f6[_0x2504a2(0x1a3)],'id':_0x44e6f6['id'],'role':_0x44e6f6[_0x2504a2(0x1d0)],'token':_0x7d59f7}});}),router[a1_0x456dca(0x1a8)](a1_0x456dca(0x1ad),async(_0x58697,_0x12cd50,_0x32a5ff)=>{const _0x2b7765=a1_0x456dca,{username:_0x346a01,email:_0x5e438b,password:_0x3c5e96}=_0x58697[_0x2b7765(0x1db)],[_0x29f04a]=await conn[_0x2b7765(0x1c2)]()[_0x2b7765(0x1d5)](_0x2b7765(0x1dc),[_0x5e438b]);if(_0x29f04a[_0x2b7765(0x1e5)]>0x0){_0x12cd50[_0x2b7765(0x1e7)](0x1a6)['json']({'error':'User\x20already\x20exists'});return;}const _0x371700=await bcrypt['hash'](_0x3c5e96,0xa);let _0x2874ae=null,_0x198bbb=0x1;config[_0x2b7765(0x1e1)]&&(_0x2874ae=randomUUID(),_0x198bbb=0x0);let _0x549c83;try{const _0x47c3d2=randomUUID(),_0x2d1ac1=_0x2b7765(0x1d8)+_0x47c3d2;fs[_0x2b7765(0x1de)](_0x2d1ac1);const [_0x4162bf]=await conn[_0x2b7765(0x1c2)]()[_0x2b7765(0x1d5)]('INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)',[_0x346a01,_0x5e438b,_0x371700,_0x2b7765(0x1e9),_0x198bbb,_0x2874ae,_0x47c3d2]);if(_0x4162bf[_0x2b7765(0x1a5)]){const [_0x2192bd]=await conn[_0x2b7765(0x1c2)]()[_0x2b7765(0x1d5)](_0x2b7765(0x1c4),[_0x4162bf[_0x2b7765(0x1a5)]]);_0x2192bd['length']>0x0&&(_0x549c83=_0x2192bd[0x0]);}}catch{_0x12cd50[_0x2b7765(0x1e7)](0x1f4)[_0x2b7765(0x1e4)]({'error':_0x2b7765(0x1d9)});return;}let _0x39f59d;try{_0x39f59d=jwt[_0x2b7765(0x1ab)]({'userId':_0x549c83['id'],'email':_0x549c83[_0x2b7765(0x1e8)]},config[_0x2b7765(0x1ea)],{'expiresIn':_0x2b7765(0x19e)});}catch(_0x344750){_0x12cd50['status'](0x1f4)['json']({'error':_0x2b7765(0x1d9)});return;}const _0x3aa265=require(_0x2b7765(0x1b3))[_0x2b7765(0x1af)];let _0x34ffb2=_0x2b7765(0x1e0);if(config[_0x2b7765(0x1e1)]){var _0x35774c=config[_0x2b7765(0x1dd)];_0x35774c[_0x2b7765(0x1da)]('/')&&(_0x35774c=_0x35774c[_0x2b7765(0x19f)](0x0,-0x1));const _0x2ea251=_0x35774c+_0x2b7765(0x1f1)+_0x2874ae;_0x34ffb2=_0x2b7765(0x1c3)+_0x2ea251+'\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>'+_0x2ea251+_0x2b7765(0x1c9);const _0x49b71a={'from':config[_0x2b7765(0x1e2)],'to':_0x549c83[_0x2b7765(0x1e8)],'subject':_0x2b7765(0x1b7),'text':_0x2b7765(0x1b7),'html':_0x34ffb2};try{await _0x3aa265[_0x2b7765(0x1ca)](_0x49b71a);}catch(_0x5a4a7){console[_0x2b7765(0x1eb)](_0x2b7765(0x1d4)),console[_0x2b7765(0x1eb)](_0x5a4a7),_0x12cd50[_0x2b7765(0x1e7)](0x1f4)[_0x2b7765(0x1e4)]({'error':'Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','stack':_0x5a4a7['stack'],'message':_0x5a4a7[_0x2b7765(0x1d3)]});return;}_0x12cd50[_0x2b7765(0x1e7)](0xc8)['json']({'success':!![],'message':_0x2b7765(0x1ce)});return;}_0x12cd50['status'](0xc9)[_0x2b7765(0x1e4)]({'success':!![],'data':{'userId':_0x549c83['id'],'username':_0x549c83['username'],'first_name':_0x549c83[_0x2b7765(0x1cd)],'last_name':_0x549c83[_0x2b7765(0x1c7)],'email':_0x549c83[_0x2b7765(0x1e8)],'avatar_url':_0x549c83[_0x2b7765(0x1a3)],'id':_0x549c83['id'],'role':_0x549c83[_0x2b7765(0x1d0)],'token':_0x39f59d,'is_enabled':_0x549c83[_0x2b7765(0x1a7)]}});}),router[a1_0x456dca(0x1a8)]('/validate-email/:token',async(_0x502fa0,_0x23cfb6)=>{const _0x3f47cf=a1_0x456dca;try{const {token:_0x35d58e}=_0x502fa0[_0x3f47cf(0x1d1)],[_0x2e61aa]=await conn[_0x3f47cf(0x1c2)]()['execute'](_0x3f47cf(0x1bd),[_0x35d58e]);if(_0x2e61aa[_0x3f47cf(0x1e5)]===0x0){_0x23cfb6[_0x3f47cf(0x1e7)](0x194)[_0x3f47cf(0x1e4)]({'error':'Invalid\x20validation\x20token'});return;}await conn[_0x3f47cf(0x1c2)]()[_0x3f47cf(0x1d5)]('UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?',[_0x35d58e]);const _0x2a8492=jwt[_0x3f47cf(0x1ab)]({'id':_0x2e61aa[0x0]['id'],'email':_0x2e61aa[0x0][_0x3f47cf(0x1e8)]},config[_0x3f47cf(0x1ea)],{'expiresIn':_0x3f47cf(0x19e)});_0x23cfb6[_0x3f47cf(0x1e7)](0xc8)[_0x3f47cf(0x1e4)]({'success':!![],'message':_0x3f47cf(0x1c0),'data':{'userId':_0x2e61aa[0x0]['id'],'username':_0x2e61aa[0x0]['username'],'first_name':_0x2e61aa[0x0][_0x3f47cf(0x1cd)],'last_name':_0x2e61aa[0x0]['last_name'],'email':_0x2e61aa[0x0][_0x3f47cf(0x1e8)],'avatar_url':_0x2e61aa[0x0]['avatar_url'],'id':_0x2e61aa[0x0]['id'],'role':_0x2e61aa[0x0][_0x3f47cf(0x1d0)],'token':_0x2a8492,'is_enabled':0x1}});}catch(_0x43b176){console[_0x3f47cf(0x1eb)]('===================error==================='),console['log'](_0x43b176),_0x23cfb6[_0x3f47cf(0x1e7)](0x1f4)[_0x3f47cf(0x1e4)]({'error':_0x3f47cf(0x1d9),'stack':_0x43b176[_0x3f47cf(0x1d7)],'message':_0x43b176[_0x3f47cf(0x1d3)]});}}),router['post'](a1_0x456dca(0x1aa),verifyToken,async(_0x117ab2,_0x24c43e,_0x728f18)=>{const _0x3fbc55=a1_0x456dca,{current_password:_0x299208,new_password:_0x20431d}=_0x117ab2[_0x3fbc55(0x1db)];console[_0x3fbc55(0x1eb)]({'body':_0x117ab2[_0x3fbc55(0x1db)]});const _0x3c0b1a=_0x117ab2[_0x3fbc55(0x1ed)][_0x3fbc55(0x1e8)];let _0x5b03be;try{const [_0x35fc37]=await conn['promise']()['execute'](_0x3fbc55(0x1dc),[_0x3c0b1a]);if(_0x35fc37[_0x3fbc55(0x1e5)]>0x0){_0x5b03be=_0x35fc37[0x0];if(!await bcrypt[_0x3fbc55(0x1a0)](_0x299208,_0x5b03be['crypted_password'])){_0x24c43e[_0x3fbc55(0x1e7)](0x191)['json']({'error':_0x3fbc55(0x1ee)});return;}const _0x3e6e2b=await bcrypt[_0x3fbc55(0x1f0)](_0x20431d,0xa);await conn[_0x3fbc55(0x1c2)]()[_0x3fbc55(0x1d5)](_0x3fbc55(0x19c),[_0x3e6e2b,_0x3c0b1a]),_0x24c43e[_0x3fbc55(0x1e7)](0xc8)[_0x3fbc55(0x1e4)]({'success':!![]});}}catch(_0x2f841a){console[_0x3fbc55(0x1eb)]({'err':_0x2f841a}),_0x24c43e['status'](0x1f4)[_0x3fbc55(0x1e4)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router[a1_0x456dca(0x1a8)](a1_0x456dca(0x1a2),upload[a1_0x456dca(0x1a1)]('avatar'),verifyToken,async(_0x59e173,_0x378f82,_0x5f53e5)=>{const _0x151bc8=a1_0x456dca,{username:_0xdfe268,first_name:_0x32c0ab,last_name:_0x292630}=_0x59e173[_0x151bc8(0x1db)],_0x1c4221=_0x59e173[_0x151bc8(0x1ed)][_0x151bc8(0x1e8)];let _0x480d96;try{const [_0x245022]=await conn[_0x151bc8(0x1c2)]()[_0x151bc8(0x1d5)](_0x151bc8(0x1dc),[_0x1c4221]);_0x245022[_0x151bc8(0x1e5)]>0x0&&(_0x480d96=_0x245022[0x0]);}catch(_0x4cc0bb){console[_0x151bc8(0x1eb)]({'err':_0x4cc0bb}),_0x378f82[_0x151bc8(0x1e7)](0x1f4)[_0x151bc8(0x1e4)]({'error':_0x151bc8(0x1d9)});return;}if(!_0x480d96){_0x378f82['status'](0x191)[_0x151bc8(0x1e4)]({'error':_0x151bc8(0x1ac)});return;}console[_0x151bc8(0x1eb)]({'req':_0x59e173['body']});let _0x112624=_0x480d96[_0x151bc8(0x1a3)];if(_0x59e173[_0x151bc8(0x19d)]){const _0x58f4fe='avatars/'+randomUUID()+'.png';fs['copyFileSync'](_0x59e173[_0x151bc8(0x19d)]['path'],'./'+_0x58f4fe),fs[_0x151bc8(0x1c8)](_0x59e173[_0x151bc8(0x19d)][_0x151bc8(0x1bf)]),_0x112624=config[_0x151bc8(0x1c6)]+'/'+_0x58f4fe;}try{await conn[_0x151bc8(0x1c2)]()['execute'](_0x151bc8(0x1df),[_0xdfe268,_0x32c0ab,_0x292630,_0x112624,_0x1c4221]);let _0x4d2dc1;try{_0x4d2dc1=jwt[_0x151bc8(0x1ab)]({'userId':_0x480d96['id'],'email':_0x480d96[_0x151bc8(0x1e8)]},config[_0x151bc8(0x1ea)],{'expiresIn':'24h'});}catch(_0x23a3aa){console[_0x151bc8(0x1eb)](_0x23a3aa),_0x378f82[_0x151bc8(0x1e7)](0x1f4)[_0x151bc8(0x1e4)]({'error':_0x151bc8(0x1d9)});return;}_0x378f82[_0x151bc8(0x1e7)](0xc8)[_0x151bc8(0x1e4)]({'success':!![],'data':{'userId':_0x480d96['id'],'username':_0xdfe268,'first_name':_0x32c0ab,'last_name':_0x292630,'email':_0x480d96[_0x151bc8(0x1e8)],'avatar_url':_0x112624,'token':_0x4d2dc1}});}catch(_0x416006){console['log']({'err':_0x416006}),_0x378f82[_0x151bc8(0x1e7)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module[a1_0x456dca(0x1ef)]=router;