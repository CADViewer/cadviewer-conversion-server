const a1_0x4ff668=a1_0x5507;(function(_0x30cf52,_0x4a2455){const _0x560837=a1_0x5507,_0x48781e=_0x30cf52();while(!![]){try{const _0x43bcae=-parseInt(_0x560837(0x94))/0x1*(-parseInt(_0x560837(0x8c))/0x2)+parseInt(_0x560837(0xc3))/0x3*(-parseInt(_0x560837(0x77))/0x4)+parseInt(_0x560837(0xca))/0x5+parseInt(_0x560837(0xac))/0x6+parseInt(_0x560837(0x88))/0x7*(parseInt(_0x560837(0xab))/0x8)+parseInt(_0x560837(0x8a))/0x9+-parseInt(_0x560837(0x9e))/0xa;if(_0x43bcae===_0x4a2455)break;else _0x48781e['push'](_0x48781e['shift']());}catch(_0x2c84ed){_0x48781e['push'](_0x48781e['shift']());}}}(a1_0x55f0,0x615ac));const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x4ff668(0x78)),config=require(a1_0x4ff668(0xcb)),conn=require(a1_0x4ff668(0x8d)),multer=require(a1_0x4ff668(0x83)),fs=require('fs'),verifyToken=require(a1_0x4ff668(0xbc))['verifyToken'],{sendWelcomeEmail}=require(a1_0x4ff668(0xce)),axios=require('axios');!fs['existsSync']('./avatars')&&fs['mkdirSync'](a1_0x4ff668(0xc6));function a1_0x5507(_0x4bc433,_0x315d93){const _0x55f044=a1_0x55f0();return a1_0x5507=function(_0x5507e2,_0x37a092){_0x5507e2=_0x5507e2-0x77;let _0x4bec24=_0x55f044[_0x5507e2];return _0x4bec24;},a1_0x5507(_0x4bc433,_0x315d93);}const express=require(a1_0x4ff668(0x79)),router=express[a1_0x4ff668(0xcc)](),{randomUUID}=require('crypto'),storage=multer[a1_0x4ff668(0xb9)]({'destination':function(_0x1698b2,_0xa215f3,_0xd0cb37){const _0x34c6f7=a1_0x4ff668;_0xd0cb37(null,_0x34c6f7(0xa2));}}),upload=multer({'storage':storage});router[a1_0x4ff668(0x8b)](a1_0x4ff668(0x96),async(_0x5bfb0b,_0x53f158,_0x1d55e2)=>{const _0x44d617=a1_0x4ff668;let {email:_0x3a550b,password:_0x2a8b62}=_0x5bfb0b[_0x44d617(0xb6)];console[_0x44d617(0xb4)]({'email':_0x3a550b,'password':_0x2a8b62});let _0x31e948;try{const [_0x56b069]=await conn['promise']()[_0x44d617(0xc2)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?',[_0x3a550b]);_0x56b069[_0x44d617(0xb1)]>0x0&&(_0x31e948=_0x56b069[0x0]);}catch(_0x979710){console[_0x44d617(0xb4)]({'err':_0x979710}),_0x53f158['status'](0x1f4)[_0x44d617(0xa7)]({'error':_0x44d617(0x7e)});return;}if(!_0x31e948||!await bcrypt[_0x44d617(0x90)](_0x2a8b62,_0x31e948?.[_0x44d617(0xba)])){_0x53f158['status'](0x191)[_0x44d617(0xa7)]({'error':_0x44d617(0x89)});return;}let _0x426d14;try{_0x426d14=jwt[_0x44d617(0x91)]({'userId':_0x31e948['id'],'email':_0x31e948[_0x44d617(0xa9)]},config['jwtSecretKey'],{'expiresIn':_0x44d617(0xc9)});}catch(_0x1cef79){console['log'](_0x1cef79),_0x53f158[_0x44d617(0x9f)](0x1f4)[_0x44d617(0xa7)]({'error':_0x44d617(0x7e)});return;}_0x53f158[_0x44d617(0x9f)](0xc8)['json']({'success':!![],'data':{'userId':_0x31e948['id'],'username':_0x31e948['username'],'first_name':_0x31e948[_0x44d617(0x92)],'last_name':_0x31e948[_0x44d617(0xc0)],'email':_0x31e948['email'],'avatar_url':_0x31e948[_0x44d617(0x87)],'id':_0x31e948['id'],'role':_0x31e948[_0x44d617(0x93)],'token':_0x426d14}});}),router['post'](a1_0x4ff668(0xad),async(_0x35a661,_0x10f21a,_0x50788d)=>{const _0x459a25=a1_0x4ff668,{username:_0x40adb0,email:_0x4523a5,password:_0x233120,geolocation:_0x164547,recaptchaToken:_0x23b024}=_0x35a661['body'];if(config[_0x459a25(0xa0)]){if(!_0x23b024)return _0x10f21a[_0x459a25(0x9f)](0x190)[_0x459a25(0xa7)]({'error':_0x459a25(0x7d)});try{const _0x16a52f=await axios[_0x459a25(0x8b)](_0x459a25(0xcd),null,{'params':{'secret':config[_0x459a25(0x7a)],'response':_0x23b024}});if(!_0x16a52f[_0x459a25(0xbe)][_0x459a25(0xb8)])return _0x10f21a[_0x459a25(0x9f)](0x190)[_0x459a25(0xa7)]({'error':'reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','recaptchaErrors':_0x16a52f[_0x459a25(0xbe)][_0x459a25(0xaf)]});}catch(_0x55444a){return console[_0x459a25(0xb7)](_0x459a25(0x9a),_0x55444a),_0x10f21a[_0x459a25(0x9f)](0x1f4)[_0x459a25(0xa7)]({'error':'Error\x20during\x20reCAPTCHA\x20verification.'});}}const [_0x5266f6]=await conn[_0x459a25(0x9b)]()['execute'](_0x459a25(0xa1),[_0x4523a5]);if(_0x5266f6[_0x459a25(0xb1)]>0x0){_0x10f21a['status'](0x1a6)[_0x459a25(0xa7)]({'error':'User\x20already\x20exists'});return;}const _0x1d4dab=await bcrypt[_0x459a25(0xae)](_0x233120,0xa);let _0x22f1ab=null,_0x7274af=0x1;config[_0x459a25(0xcf)]&&(_0x22f1ab=randomUUID(),_0x7274af=0x0);let _0x338b01=null,_0x5e88a2=null,_0x1d3f87=null,_0x550ba5=null,_0x45febc=null,_0x1b1c74=null;if(_0x164547)try{const _0x65bf01=_0x164547;_0x338b01=_0x65bf01[_0x459a25(0x9d)]||null,_0x5e88a2=_0x65bf01['region']||null,_0x1d3f87=_0x65bf01[_0x459a25(0xa8)]||null,_0x65bf01['languages']&&_0x65bf01['languages'][_0x459a25(0xb1)]>0x0&&(_0x550ba5=_0x65bf01['languages'][0x0][_0x459a25(0xa4)]||null,_0x45febc=_0x65bf01[_0x459a25(0x98)][0x0][_0x459a25(0xc4)]||null),_0x65bf01[_0x459a25(0x99)]&&(_0x1b1c74=_0x65bf01[_0x459a25(0x99)]['name']||null);}catch(_0x511d0b){console[_0x459a25(0xb4)](_0x459a25(0xaa),_0x511d0b);}let _0x481dc0;try{const _0x2cfcb7=randomUUID(),_0x4c9b6e=_0x459a25(0xa5)+_0x2cfcb7;fs[_0x459a25(0xb5)](_0x4c9b6e);const [_0x35342c]=await conn[_0x459a25(0x9b)]()[_0x459a25(0xc2)](_0x459a25(0x7c),[_0x40adb0,_0x4523a5,_0x1d4dab,'demo_user',_0x7274af,_0x22f1ab,_0x2cfcb7,_0x338b01,_0x5e88a2,_0x1d3f87,_0x550ba5,_0x45febc,_0x1b1c74]);if(_0x35342c['insertId']){const [_0x2cf421]=await conn[_0x459a25(0x9b)]()[_0x459a25(0xc2)](_0x459a25(0xa6),[_0x35342c[_0x459a25(0x82)]]);_0x2cf421[_0x459a25(0xb1)]>0x0&&(_0x481dc0=_0x2cf421[0x0]);}}catch(_0x32f534){console[_0x459a25(0xb4)](_0x459a25(0xc7),_0x32f534),_0x10f21a['status'](0x1f4)[_0x459a25(0xa7)]({'error':_0x459a25(0x7e)});return;}let _0x266a42;try{_0x266a42=jwt[_0x459a25(0x91)]({'userId':_0x481dc0['id'],'email':_0x481dc0[_0x459a25(0xa9)]},config[_0x459a25(0xbf)],{'expiresIn':_0x459a25(0xc9)});}catch(_0x46b64e){_0x10f21a[_0x459a25(0x9f)](0x1f4)[_0x459a25(0xa7)]({'error':_0x459a25(0x7e)});return;}if(config[_0x459a25(0xcf)]){try{await sendWelcomeEmail(_0x481dc0,_0x22f1ab);}catch(_0x1b0031){console[_0x459a25(0xb4)](_0x459a25(0xc5)),console[_0x459a25(0xb4)](_0x1b0031);}_0x10f21a['status'](0xc8)[_0x459a25(0xa7)]({'success':!![],'message':_0x459a25(0xa3)});return;}_0x10f21a['status'](0xc9)[_0x459a25(0xa7)]({'success':!![],'data':{'userId':_0x481dc0['id'],'username':_0x481dc0['username'],'first_name':_0x481dc0[_0x459a25(0x92)],'last_name':_0x481dc0[_0x459a25(0xc0)],'email':_0x481dc0['email'],'avatar_url':_0x481dc0['avatar_url'],'id':_0x481dc0['id'],'role':_0x481dc0['role'],'token':_0x266a42,'is_enabled':_0x481dc0['is_enabled']}});}),router['post'](a1_0x4ff668(0x81),async(_0x5bb90a,_0x573718)=>{const _0x429cd2=a1_0x4ff668;try{const {token:_0x246fb2}=_0x5bb90a[_0x429cd2(0xb2)],[_0x2655b0]=await conn['promise']()[_0x429cd2(0xc2)](_0x429cd2(0x8e),[_0x246fb2]);if(_0x2655b0['length']===0x0){_0x573718[_0x429cd2(0x9f)](0x194)['json']({'error':'Invalid\x20validation\x20token'});return;}await conn[_0x429cd2(0x9b)]()['execute'](_0x429cd2(0x8f),[_0x246fb2]);const _0x3d141a=jwt[_0x429cd2(0x91)]({'id':_0x2655b0[0x0]['id'],'email':_0x2655b0[0x0][_0x429cd2(0xa9)]},config[_0x429cd2(0xbf)],{'expiresIn':_0x429cd2(0xc9)});_0x573718[_0x429cd2(0x9f)](0xc8)[_0x429cd2(0xa7)]({'success':!![],'message':_0x429cd2(0x95),'data':{'userId':_0x2655b0[0x0]['id'],'username':_0x2655b0[0x0]['username'],'first_name':_0x2655b0[0x0][_0x429cd2(0x92)],'last_name':_0x2655b0[0x0][_0x429cd2(0xc0)],'email':_0x2655b0[0x0][_0x429cd2(0xa9)],'avatar_url':_0x2655b0[0x0][_0x429cd2(0x87)],'id':_0x2655b0[0x0]['id'],'role':_0x2655b0[0x0][_0x429cd2(0x93)],'token':_0x3d141a,'is_enabled':0x1}});}catch(_0x561d5d){console[_0x429cd2(0xb4)]('===================error==================='),console[_0x429cd2(0xb4)](_0x561d5d),_0x573718['status'](0x1f4)['json']({'error':_0x429cd2(0x7e),'stack':_0x561d5d[_0x429cd2(0x7b)],'message':_0x561d5d[_0x429cd2(0x84)]});}}),router[a1_0x4ff668(0x8b)](a1_0x4ff668(0xbb),verifyToken,async(_0xc80436,_0x57c7c5,_0x2baed0)=>{const _0x2ea3ca=a1_0x4ff668,{current_password:_0x2ed580,new_password:_0x105a4b}=_0xc80436['body'];console[_0x2ea3ca(0xb4)]({'body':_0xc80436[_0x2ea3ca(0xb6)]});const _0x16b80f=_0xc80436[_0x2ea3ca(0xbd)]['email'];let _0xb75abd;try{const [_0x134980]=await conn[_0x2ea3ca(0x9b)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x16b80f]);if(_0x134980['length']>0x0){_0xb75abd=_0x134980[0x0];if(!await bcrypt[_0x2ea3ca(0x90)](_0x2ed580,_0xb75abd['crypted_password'])){_0x57c7c5[_0x2ea3ca(0x9f)](0x191)[_0x2ea3ca(0xa7)]({'error':'Invalid\x20password'});return;}const _0xba8dae=await bcrypt[_0x2ea3ca(0xae)](_0x105a4b,0xa);await conn['promise']()[_0x2ea3ca(0xc2)]('UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0xba8dae,_0x16b80f]),_0x57c7c5[_0x2ea3ca(0x9f)](0xc8)[_0x2ea3ca(0xa7)]({'success':!![]});}}catch(_0x1c0ff8){console[_0x2ea3ca(0xb4)]({'err':_0x1c0ff8}),_0x57c7c5[_0x2ea3ca(0x9f)](0x1f4)[_0x2ea3ca(0xa7)]({'error':_0x2ea3ca(0x7e)});return;}}),router[a1_0x4ff668(0x8b)](a1_0x4ff668(0xb3),upload[a1_0x4ff668(0x80)]('avatar'),verifyToken,async(_0x536934,_0x345319,_0x2d757e)=>{const _0x2d0bc1=a1_0x4ff668,{username:_0x4a4478,first_name:_0x527c70,last_name:_0x210132}=_0x536934[_0x2d0bc1(0xb6)],_0x21d8c6=_0x536934[_0x2d0bc1(0xbd)]['email'];let _0x3fd33c;try{const [_0x2c9869]=await conn[_0x2d0bc1(0x9b)]()['execute'](_0x2d0bc1(0xa1),[_0x21d8c6]);_0x2c9869[_0x2d0bc1(0xb1)]>0x0&&(_0x3fd33c=_0x2c9869[0x0]);}catch(_0x1d87a8){console[_0x2d0bc1(0xb4)]({'err':_0x1d87a8}),_0x345319[_0x2d0bc1(0x9f)](0x1f4)[_0x2d0bc1(0xa7)]({'error':_0x2d0bc1(0x7e)});return;}if(!_0x3fd33c){_0x345319['status'](0x191)[_0x2d0bc1(0xa7)]({'error':_0x2d0bc1(0x86)});return;}console[_0x2d0bc1(0xb4)]({'req':_0x536934[_0x2d0bc1(0xb6)]});let _0x522b65=_0x3fd33c[_0x2d0bc1(0x87)];if(_0x536934[_0x2d0bc1(0xc1)]){const _0x57b938=_0x2d0bc1(0x9c)+randomUUID()+'.png';fs[_0x2d0bc1(0xc8)](_0x536934[_0x2d0bc1(0xc1)][_0x2d0bc1(0x97)],'./'+_0x57b938),fs[_0x2d0bc1(0x7f)](_0x536934['file'][_0x2d0bc1(0x97)]),config[_0x2d0bc1(0x85)]?_0x522b65=config['callbackMethod_gatewayUrl']+'/'+_0x57b938:_0x522b65=config[_0x2d0bc1(0xb0)]+'/'+_0x57b938;}try{await conn[_0x2d0bc1(0x9b)]()[_0x2d0bc1(0xc2)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x4a4478,_0x527c70,_0x210132,_0x522b65,_0x21d8c6]);let _0xa79cbd;try{_0xa79cbd=jwt[_0x2d0bc1(0x91)]({'userId':_0x3fd33c['id'],'email':_0x3fd33c['email']},config['jwtSecretKey'],{'expiresIn':'24h'});}catch(_0x4d8c35){console[_0x2d0bc1(0xb4)](_0x4d8c35),_0x345319[_0x2d0bc1(0x9f)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x345319[_0x2d0bc1(0x9f)](0xc8)[_0x2d0bc1(0xa7)]({'success':!![],'data':{'userId':_0x3fd33c['id'],'username':_0x4a4478,'first_name':_0x527c70,'last_name':_0x210132,'email':_0x3fd33c[_0x2d0bc1(0xa9)],'avatar_url':_0x522b65,'token':_0xa79cbd}});}catch(_0x580dca){console['log']({'err':_0x580dca}),_0x345319[_0x2d0bc1(0x9f)](0x1f4)[_0x2d0bc1(0xa7)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module['exports']=router;function a1_0x55f0(){const _0x556d79=['https://www.google.com/recaptcha/api/siteverify','../libs/email-utils','enableEmailVerification','2334468bbwLla','bcrypt','express','recaptchaSecretKey','stack','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','Error!\x20Something\x20went\x20wrong.','unlinkSync','single','/validate-email/:token','insertId','multer','message','callbackMethod_gatewayUrl_flag','Invalid\x20user','avatar_url','1381366BWRBFb','Invalid\x20email\x20or\x20password','4126833tyKHhc','post','169906crccqg','../libs/mysql.js','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','compare','sign','first_name','role','1WMeSIO','Email\x20validated\x20successfully','/login','path','languages','time_zone','reCAPTCHA\x20verification\x20error:','promise','avatars/','city','5013560ptFoOj','status','recaptchaEnabled','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','avatars','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','code','./uploads/','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','json','country_name','email','Error\x20parsing\x20geolocation\x20data:','8xykOXe','216768TcGQyh','/signup','hash','error-codes','ServerUrl','length','params','/update-user-info','log','mkdirSync','body','error','success','diskStorage','crypted_password','/update-password','../libs/jwt','user','data','jwtSecretKey','last_name','file','execute','3oCeAvT','name','===================error===================','./avatars','Error\x20during\x20user\x20creation:','copyFileSync','24h','3533905sWntnA','../CADViewer_config.json','Router'];a1_0x55f0=function(){return _0x556d79;};return a1_0x55f0();}