const a1_0x3a184e=a1_0x49f9;(function(_0x46d360,_0x431ace){const _0x1ae7f2=a1_0x49f9,_0x34fce8=_0x46d360();while(!![]){try{const _0x44192e=-parseInt(_0x1ae7f2(0x23c))/0x1*(-parseInt(_0x1ae7f2(0x1f2))/0x2)+parseInt(_0x1ae7f2(0x22c))/0x3+parseInt(_0x1ae7f2(0x1fd))/0x4*(parseInt(_0x1ae7f2(0x1fc))/0x5)+parseInt(_0x1ae7f2(0x237))/0x6*(-parseInt(_0x1ae7f2(0x245))/0x7)+parseInt(_0x1ae7f2(0x234))/0x8*(parseInt(_0x1ae7f2(0x213))/0x9)+parseInt(_0x1ae7f2(0x225))/0xa*(-parseInt(_0x1ae7f2(0x21a))/0xb)+parseInt(_0x1ae7f2(0x20d))/0xc*(-parseInt(_0x1ae7f2(0x229))/0xd);if(_0x44192e===_0x431ace)break;else _0x34fce8['push'](_0x34fce8['shift']());}catch(_0x223895){_0x34fce8['push'](_0x34fce8['shift']());}}}(a1_0x3348,0x7b527));function a1_0x3348(){const _0x592978=['UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','stack','20052dffaab','/login','crypto','express','single','User\x20already\x20exists','4645737iSpkic','length','diskStorage','jsonwebtoken','execute','crypted_password','multer','20207XHOuai','verifyToken','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','username','Invalid\x20email\x20or\x20password','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)','role','enableEmailVerification','file','json','2180pyWLqv','Email\x20validated\x20successfully','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','hash','6643yIofaL','./avatars','avatars','1632933KeVzyS','message','avatar_url','path','Error!\x20Something\x20went\x20wrong.','body','last_name','email','8XDQgeI','compare','smtpFrom','24ESNlRW','unlinkSync','avatar','sign','/signup','34747TICwiR','post','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','mkdirSync','../libs/mail','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','./uploads/','frontendUrl','bcrypt','111307YMrUNE','sendMail','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','/validate-email/:token','34wMNTcG','user','Invalid\x20user','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','demo_user','status','is_enabled','Router','transporter','Invalid\x20validation\x20token','625DcAdPS','5500HjPZsi','insertId','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','.png','===================error===================','/update-user-info','jwtSecretKey','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','24h','promise','first_name','../libs/mysql.js','log','avatars/'];a1_0x3348=function(){return _0x592978;};return a1_0x3348();}const jwt=require(a1_0x3a184e(0x216)),bcrypt=require(a1_0x3a184e(0x244)),config=require('../CADViewer_config.json'),conn=require(a1_0x3a184e(0x208)),multer=require(a1_0x3a184e(0x219)),fs=require('fs'),verifyToken=require('../libs/jwt')[a1_0x3a184e(0x21b)];function a1_0x49f9(_0x512e6a,_0x412d0a){const _0x3348d5=a1_0x3348();return a1_0x49f9=function(_0x49f9be,_0x309637){_0x49f9be=_0x49f9be-0x1f1;let _0x2b3530=_0x3348d5[_0x49f9be];return _0x2b3530;},a1_0x49f9(_0x512e6a,_0x412d0a);}!fs['existsSync'](a1_0x3a184e(0x22a))&&fs[a1_0x3a184e(0x23f)](a1_0x3a184e(0x22a));const express=require(a1_0x3a184e(0x210)),router=express[a1_0x3a184e(0x1f9)](),{randomUUID}=require(a1_0x3a184e(0x20f)),storage=multer[a1_0x3a184e(0x215)]({'destination':function(_0x22670e,_0x320739,_0x2c80a0){const _0x77b226=a1_0x3a184e;_0x2c80a0(null,_0x77b226(0x22b));}}),upload=multer({'storage':storage});router[a1_0x3a184e(0x23d)](a1_0x3a184e(0x20e),async(_0x11bb2a,_0x2492f7,_0x340867)=>{const _0x348a86=a1_0x3a184e;let {email:_0x522971,password:_0x1b0c57}=_0x11bb2a[_0x348a86(0x231)];console[_0x348a86(0x209)]({'email':_0x522971,'password':_0x1b0c57});let _0x224618;try{const [_0x59a887]=await conn[_0x348a86(0x206)]()[_0x348a86(0x217)](_0x348a86(0x21d),[_0x522971]);_0x59a887['length']>0x0&&(_0x224618=_0x59a887[0x0]);}catch(_0xea193a){console[_0x348a86(0x209)]({'err':_0xea193a}),_0x2492f7[_0x348a86(0x1f7)](0x1f4)[_0x348a86(0x224)]({'error':_0x348a86(0x230)});return;}if(!_0x224618||!await bcrypt['compare'](_0x1b0c57,_0x224618?.[_0x348a86(0x218)])){_0x2492f7['status'](0x191)[_0x348a86(0x224)]({'error':_0x348a86(0x21f)});return;}let _0x2e7030;try{_0x2e7030=jwt[_0x348a86(0x23a)]({'userId':_0x224618['id'],'email':_0x224618['email']},config[_0x348a86(0x203)],{'expiresIn':'24h'});}catch(_0x3a1264){console['log'](_0x3a1264),_0x2492f7[_0x348a86(0x1f7)](0x1f4)[_0x348a86(0x224)]({'error':_0x348a86(0x230)});return;}_0x2492f7['status'](0xc8)[_0x348a86(0x224)]({'success':!![],'data':{'userId':_0x224618['id'],'username':_0x224618['username'],'first_name':_0x224618[_0x348a86(0x207)],'last_name':_0x224618['last_name'],'email':_0x224618[_0x348a86(0x233)],'avatar_url':_0x224618[_0x348a86(0x22e)],'id':_0x224618['id'],'role':_0x224618[_0x348a86(0x221)],'token':_0x2e7030}});}),router[a1_0x3a184e(0x23d)](a1_0x3a184e(0x23b),async(_0x174b40,_0x55baeb,_0x37f909)=>{const _0x5eea87=a1_0x3a184e,{username:_0x5e7d60,email:_0x563920,password:_0x4bdefb}=_0x174b40[_0x5eea87(0x231)],[_0x9b4057]=await conn[_0x5eea87(0x206)]()[_0x5eea87(0x217)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x563920]);if(_0x9b4057[_0x5eea87(0x214)]>0x0){_0x55baeb[_0x5eea87(0x1f7)](0x1a6)['json']({'error':_0x5eea87(0x212)});return;}const _0xcbaba9=await bcrypt['hash'](_0x4bdefb,0xa);let _0xa44168=null,_0xe599d=0x1;config[_0x5eea87(0x222)]&&(_0xa44168=randomUUID(),_0xe599d=0x0);let _0xe4a0bb;try{const _0x34a262=randomUUID(),_0x5e1cec=_0x5eea87(0x242)+_0x34a262;fs[_0x5eea87(0x23f)](_0x5e1cec);const [_0x157e8e]=await conn[_0x5eea87(0x206)]()[_0x5eea87(0x217)](_0x5eea87(0x220),[_0x5e7d60,_0x563920,_0xcbaba9,_0x5eea87(0x1f6),_0xe599d,_0xa44168,_0x34a262]);if(_0x157e8e[_0x5eea87(0x1fe)]){const [_0x5f21b6]=await conn[_0x5eea87(0x206)]()[_0x5eea87(0x217)](_0x5eea87(0x21c),[_0x157e8e[_0x5eea87(0x1fe)]]);_0x5f21b6[_0x5eea87(0x214)]>0x0&&(_0xe4a0bb=_0x5f21b6[0x0]);}}catch{_0x55baeb[_0x5eea87(0x1f7)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x2c0d13;try{_0x2c0d13=jwt[_0x5eea87(0x23a)]({'userId':_0xe4a0bb['id'],'email':_0xe4a0bb[_0x5eea87(0x233)]},config['jwtSecretKey'],{'expiresIn':_0x5eea87(0x205)});}catch(_0xb45bcd){_0x55baeb['status'](0x1f4)[_0x5eea87(0x224)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}const _0x4730e3=require(_0x5eea87(0x240))[_0x5eea87(0x1fa)];let _0x3e2272='<p>Welcome\x20to\x20CADViewer</p>';if(config[_0x5eea87(0x222)]){var _0x16054f=config[_0x5eea87(0x243)];_0x16054f['endsWith']('/')&&(_0x16054f=_0x16054f['slice'](0x0,-0x1));const _0x196556=_0x16054f+'/validate-email/'+_0xa44168;_0x3e2272=_0x5eea87(0x23e)+_0x196556+_0x5eea87(0x241)+_0x196556+_0x5eea87(0x1f5);const _0x14dda5={'from':config[_0x5eea87(0x236)],'to':_0xe4a0bb[_0x5eea87(0x233)],'subject':'Welcome\x20to\x20CADViewer','text':'Welcome\x20to\x20CADViewer','html':_0x3e2272};try{await _0x4730e3[_0x5eea87(0x246)](_0x14dda5);}catch(_0x4f3a29){console[_0x5eea87(0x209)]('===================error==================='),console[_0x5eea87(0x209)](_0x4f3a29),_0x55baeb[_0x5eea87(0x1f7)](0x1f4)[_0x5eea87(0x224)]({'error':'Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','stack':_0x4f3a29[_0x5eea87(0x20c)],'message':_0x4f3a29[_0x5eea87(0x22d)]});return;}_0x55baeb[_0x5eea87(0x1f7)](0xc8)[_0x5eea87(0x224)]({'success':!![],'message':_0x5eea87(0x247)});return;}_0x55baeb[_0x5eea87(0x1f7)](0xc9)[_0x5eea87(0x224)]({'success':!![],'data':{'userId':_0xe4a0bb['id'],'username':_0xe4a0bb[_0x5eea87(0x21e)],'first_name':_0xe4a0bb[_0x5eea87(0x207)],'last_name':_0xe4a0bb[_0x5eea87(0x232)],'email':_0xe4a0bb[_0x5eea87(0x233)],'avatar_url':_0xe4a0bb[_0x5eea87(0x22e)],'id':_0xe4a0bb['id'],'role':_0xe4a0bb[_0x5eea87(0x221)],'token':_0x2c0d13,'is_enabled':_0xe4a0bb[_0x5eea87(0x1f8)]}});}),router[a1_0x3a184e(0x23d)](a1_0x3a184e(0x1f1),async(_0x58302b,_0x2fdfb4)=>{const _0x77f159=a1_0x3a184e;try{const {token:_0x3b980a}=_0x58302b['params'],[_0x435a03]=await conn[_0x77f159(0x206)]()[_0x77f159(0x217)](_0x77f159(0x204),[_0x3b980a]);if(_0x435a03['length']===0x0){_0x2fdfb4[_0x77f159(0x1f7)](0x194)['json']({'error':_0x77f159(0x1fb)});return;}await conn[_0x77f159(0x206)]()['execute']('UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?',[_0x3b980a]);const _0x12edd5=jwt[_0x77f159(0x23a)]({'id':_0x435a03[0x0]['id'],'email':_0x435a03[0x0][_0x77f159(0x233)]},config[_0x77f159(0x203)],{'expiresIn':_0x77f159(0x205)});_0x2fdfb4[_0x77f159(0x1f7)](0xc8)[_0x77f159(0x224)]({'success':!![],'message':_0x77f159(0x226),'data':{'userId':_0x435a03[0x0]['id'],'username':_0x435a03[0x0][_0x77f159(0x21e)],'first_name':_0x435a03[0x0][_0x77f159(0x207)],'last_name':_0x435a03[0x0][_0x77f159(0x232)],'email':_0x435a03[0x0][_0x77f159(0x233)],'avatar_url':_0x435a03[0x0][_0x77f159(0x22e)],'id':_0x435a03[0x0]['id'],'role':_0x435a03[0x0][_0x77f159(0x221)],'token':_0x12edd5,'is_enabled':0x1}});}catch(_0x4b6919){console['log'](_0x77f159(0x201)),console[_0x77f159(0x209)](_0x4b6919),_0x2fdfb4[_0x77f159(0x1f7)](0x1f4)[_0x77f159(0x224)]({'error':_0x77f159(0x230),'stack':_0x4b6919['stack'],'message':_0x4b6919['message']});}}),router[a1_0x3a184e(0x23d)]('/update-password',verifyToken,async(_0x44119a,_0x51d7c5,_0xce8e6c)=>{const _0x267793=a1_0x3a184e,{current_password:_0x4063aa,new_password:_0x1a3f8f}=_0x44119a[_0x267793(0x231)];console[_0x267793(0x209)]({'body':_0x44119a[_0x267793(0x231)]});const _0x4a9fdd=_0x44119a['user'][_0x267793(0x233)];let _0x3fe861;try{const [_0xf3bb06]=await conn[_0x267793(0x206)]()[_0x267793(0x217)](_0x267793(0x1ff),[_0x4a9fdd]);if(_0xf3bb06['length']>0x0){_0x3fe861=_0xf3bb06[0x0];if(!await bcrypt[_0x267793(0x235)](_0x4063aa,_0x3fe861['crypted_password'])){_0x51d7c5['status'](0x191)['json']({'error':'Invalid\x20password'});return;}const _0x257c9c=await bcrypt[_0x267793(0x228)](_0x1a3f8f,0xa);await conn[_0x267793(0x206)]()[_0x267793(0x217)](_0x267793(0x227),[_0x257c9c,_0x4a9fdd]),_0x51d7c5['status'](0xc8)[_0x267793(0x224)]({'success':!![]});}}catch(_0xa744a9){console[_0x267793(0x209)]({'err':_0xa744a9}),_0x51d7c5[_0x267793(0x1f7)](0x1f4)['json']({'error':_0x267793(0x230)});return;}}),router['post'](a1_0x3a184e(0x202),upload[a1_0x3a184e(0x211)](a1_0x3a184e(0x239)),verifyToken,async(_0x4ec044,_0x22157b,_0x303ef6)=>{const _0x3ac3de=a1_0x3a184e,{username:_0x494e08,first_name:_0x16d81a,last_name:_0x191c83}=_0x4ec044[_0x3ac3de(0x231)],_0x5e2639=_0x4ec044[_0x3ac3de(0x1f3)][_0x3ac3de(0x233)];let _0x30acc7;try{const [_0x26e96f]=await conn['promise']()[_0x3ac3de(0x217)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x5e2639]);_0x26e96f[_0x3ac3de(0x214)]>0x0&&(_0x30acc7=_0x26e96f[0x0]);}catch(_0x114ff0){console['log']({'err':_0x114ff0}),_0x22157b['status'](0x1f4)[_0x3ac3de(0x224)]({'error':_0x3ac3de(0x230)});return;}if(!_0x30acc7){_0x22157b[_0x3ac3de(0x1f7)](0x191)[_0x3ac3de(0x224)]({'error':_0x3ac3de(0x1f4)});return;}console['log']({'req':_0x4ec044[_0x3ac3de(0x231)]});let _0x513d49=_0x30acc7[_0x3ac3de(0x22e)];if(_0x4ec044[_0x3ac3de(0x223)]){const _0x5e3a72=_0x3ac3de(0x20a)+randomUUID()+_0x3ac3de(0x200);fs['copyFileSync'](_0x4ec044['file'][_0x3ac3de(0x22f)],'./'+_0x5e3a72),fs[_0x3ac3de(0x238)](_0x4ec044[_0x3ac3de(0x223)][_0x3ac3de(0x22f)]),_0x513d49=config['ServerUrl']+'/'+_0x5e3a72;}try{await conn[_0x3ac3de(0x206)]()['execute'](_0x3ac3de(0x20b),[_0x494e08,_0x16d81a,_0x191c83,_0x513d49,_0x5e2639]);let _0x2b232d;try{_0x2b232d=jwt[_0x3ac3de(0x23a)]({'userId':_0x30acc7['id'],'email':_0x30acc7['email']},config[_0x3ac3de(0x203)],{'expiresIn':_0x3ac3de(0x205)});}catch(_0x1023aa){console[_0x3ac3de(0x209)](_0x1023aa),_0x22157b[_0x3ac3de(0x1f7)](0x1f4)['json']({'error':_0x3ac3de(0x230)});return;}_0x22157b[_0x3ac3de(0x1f7)](0xc8)[_0x3ac3de(0x224)]({'success':!![],'data':{'userId':_0x30acc7['id'],'username':_0x494e08,'first_name':_0x16d81a,'last_name':_0x191c83,'email':_0x30acc7[_0x3ac3de(0x233)],'avatar_url':_0x513d49,'token':_0x2b232d}});}catch(_0xdc5896){console[_0x3ac3de(0x209)]({'err':_0xdc5896}),_0x22157b[_0x3ac3de(0x1f7)](0x1f4)[_0x3ac3de(0x224)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module['exports']=router;