const a1_0x1c9732=a1_0x5a0b;(function(_0x247248,_0x549a1a){const _0x128023=a1_0x5a0b,_0xa00009=_0x247248();while(!![]){try{const _0x317a12=-parseInt(_0x128023(0xdd))/0x1*(parseInt(_0x128023(0xdf))/0x2)+parseInt(_0x128023(0xd4))/0x3*(parseInt(_0x128023(0xbd))/0x4)+parseInt(_0x128023(0xbf))/0x5+-parseInt(_0x128023(0xde))/0x6+-parseInt(_0x128023(0xe9))/0x7+parseInt(_0x128023(0xe4))/0x8+parseInt(_0x128023(0xe0))/0x9*(-parseInt(_0x128023(0xed))/0xa);if(_0x317a12===_0x549a1a)break;else _0xa00009['push'](_0xa00009['shift']());}catch(_0x198c95){_0xa00009['push'](_0xa00009['shift']());}}}(a1_0x4699,0xe09f3));function a1_0x5a0b(_0x58e4d9,_0xc09b7d){const _0x46991d=a1_0x4699();return a1_0x5a0b=function(_0x5a0baa,_0x53162a){_0x5a0baa=_0x5a0baa-0xb2;let _0x1f842f=_0x46991d[_0x5a0baa];return _0x1f842f;},a1_0x5a0b(_0x58e4d9,_0xc09b7d);}const jwt=require(a1_0x1c9732(0xb8)),bcrypt=require(a1_0x1c9732(0xd3)),config=require(a1_0x1c9732(0xe8)),conn=require('../libs/mysql.js'),multer=require(a1_0x1c9732(0xea)),fs=require('fs'),verifyToken=require(a1_0x1c9732(0xc3))[a1_0x1c9732(0xd7)];function a1_0x4699(){const _0xf42fe1=['path','508252xatyAV','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','5366360voDEOU','Error!\x20Something\x20went\x20wrong.','jwtSecretKey','Invalid\x20user','../libs/jwt','log','first_name','avatar','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','mkdirSync','existsSync','crypted_password','hash','compare','json','insertId','avatar_url','express','body','promise','bcrypt','42ZSCWdx','length','user','verifyToken','status','avatars','email','/update-password','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','677278OGIFgp','7822236BZERWL','2CGsnxP','675RkhMJe','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','User\x20already\x20exists','execute','13838440MJuJIt','renameSync','file','/update-user-info','../CADViewer_config.json','11149593zxWjOm','multer','Router','24h','11750zxfdYW','role','sign','single','ServerUrl','last_name','username','exports','post','/signup','/login','crypto','jsonwebtoken','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','./avatars','avatars/'];a1_0x4699=function(){return _0xf42fe1;};return a1_0x4699();}!fs[a1_0x1c9732(0xc9)](a1_0x1c9732(0xba))&&fs[a1_0x1c9732(0xc8)](a1_0x1c9732(0xba));const express=require(a1_0x1c9732(0xd0)),router=express[a1_0x1c9732(0xeb)](),{randomUUID}=require(a1_0x1c9732(0xb7)),storage=multer['diskStorage']({'destination':function(_0xeceb6e,_0x1133c1,_0x53ed8e){const _0x284e8=a1_0x1c9732;_0x53ed8e(null,_0x284e8(0xd9));}}),upload=multer({'storage':storage});router['post'](a1_0x1c9732(0xb6),async(_0x232b88,_0x504b8f,_0x1256a2)=>{const _0x41a89e=a1_0x1c9732;let {email:_0xa2a58e,password:_0x4cdb79}=_0x232b88[_0x41a89e(0xd1)];console[_0x41a89e(0xc4)]({'email':_0xa2a58e,'password':_0x4cdb79});let _0x1abfd3;try{const [_0x2999aa]=await conn[_0x41a89e(0xd2)]()['execute'](_0x41a89e(0xe1),[_0xa2a58e]);_0x2999aa[_0x41a89e(0xd5)]>0x0&&(_0x1abfd3=_0x2999aa[0x0]);}catch(_0x150683){console[_0x41a89e(0xc4)]({'err':_0x150683}),_0x504b8f[_0x41a89e(0xd8)](0x1f4)[_0x41a89e(0xcd)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}console[_0x41a89e(0xc4)](_0x1abfd3),console['log'](_0x4cdb79),console[_0x41a89e(0xc4)](_0x1abfd3[_0x41a89e(0xca)]);if(!_0x1abfd3||!await bcrypt[_0x41a89e(0xcc)](_0x4cdb79,_0x1abfd3[_0x41a89e(0xca)])){_0x504b8f[_0x41a89e(0xd8)](0x191)[_0x41a89e(0xcd)]({'error':'Invalid\x20email\x20or\x20password'});return;}let _0x26ca04;try{_0x26ca04=jwt[_0x41a89e(0xef)]({'userId':_0x1abfd3['id'],'email':_0x1abfd3[_0x41a89e(0xda)]},config[_0x41a89e(0xc1)],{'expiresIn':_0x41a89e(0xec)});}catch(_0x1c9869){console['log'](_0x1c9869),_0x504b8f[_0x41a89e(0xd8)](0x1f4)[_0x41a89e(0xcd)]({'error':_0x41a89e(0xc0)});return;}_0x504b8f[_0x41a89e(0xd8)](0xc8)[_0x41a89e(0xcd)]({'success':!![],'data':{'userId':_0x1abfd3['id'],'username':_0x1abfd3['username'],'first_name':_0x1abfd3[_0x41a89e(0xc5)],'last_name':_0x1abfd3[_0x41a89e(0xf2)],'email':_0x1abfd3[_0x41a89e(0xda)],'avatar_url':_0x1abfd3['avatar_url'],'id':_0x1abfd3['id'],'role':_0x1abfd3[_0x41a89e(0xee)],'token':_0x26ca04}});}),router['post'](a1_0x1c9732(0xb5),async(_0x415f81,_0x465ac5,_0x15486c)=>{const _0x47ddf2=a1_0x1c9732,{username:_0x19e075,email:_0x10d32e,password:_0x455903}=_0x415f81[_0x47ddf2(0xd1)],[_0x5a4cd4]=await conn['promise']()['execute'](_0x47ddf2(0xc7),[_0x10d32e]);if(_0x5a4cd4[_0x47ddf2(0xd5)]>0x0){_0x465ac5['status'](0x1a6)[_0x47ddf2(0xcd)]({'error':_0x47ddf2(0xe2)});return;}const _0x560585=await bcrypt[_0x47ddf2(0xcb)](_0x455903,0xa);try{const [_0xb89257]=await conn[_0x47ddf2(0xd2)]()[_0x47ddf2(0xe3)](_0x47ddf2(0xb9),[_0x19e075,_0x10d32e,_0x560585,_0x47ddf2(0xd6)]);if(_0xb89257[_0x47ddf2(0xce)]){const [_0xede841]=await conn['promise']()[_0x47ddf2(0xe3)](_0x47ddf2(0xdc),[_0xb89257[_0x47ddf2(0xce)]]);_0xede841[_0x47ddf2(0xd5)]>0x0&&(newUser=_0xede841[0x0]);}}catch{_0x465ac5[_0x47ddf2(0xd8)](0x1f4)[_0x47ddf2(0xcd)]({'error':_0x47ddf2(0xc0)});return;}let _0x1e2575;try{_0x1e2575=jwt[_0x47ddf2(0xef)]({'userId':newUser['id'],'email':newUser['email']},config['jwtSecretKey'],{'expiresIn':_0x47ddf2(0xec)});}catch(_0x2e96dd){_0x465ac5[_0x47ddf2(0xd8)](0x1f4)[_0x47ddf2(0xcd)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x465ac5[_0x47ddf2(0xd8)](0xc9)[_0x47ddf2(0xcd)]({'success':!![],'data':{'userId':newUser['id'],'username':newUser[_0x47ddf2(0xb2)],'first_name':newUser[_0x47ddf2(0xc5)],'last_name':newUser[_0x47ddf2(0xf2)],'email':newUser[_0x47ddf2(0xda)],'avatar_url':newUser[_0x47ddf2(0xcf)],'id':newUser['id'],'role':newUser[_0x47ddf2(0xee)],'token':_0x1e2575}});}),router[a1_0x1c9732(0xb4)](a1_0x1c9732(0xdb),verifyToken,async(_0x50f251,_0x692983,_0x2812a0)=>{const _0x246e66=a1_0x1c9732,{current_password:_0x234f4b,new_password:_0x4889c0}=_0x50f251['body'];console[_0x246e66(0xc4)]({'body':_0x50f251[_0x246e66(0xd1)]});const _0x1d6265=_0x50f251[_0x246e66(0xd6)]['email'];let _0x41d312;try{const [_0x4e2d4c]=await conn[_0x246e66(0xd2)]()[_0x246e66(0xe3)](_0x246e66(0xc7),[_0x1d6265]);if(_0x4e2d4c[_0x246e66(0xd5)]>0x0){_0x41d312=_0x4e2d4c[0x0];if(!await bcrypt[_0x246e66(0xcc)](_0x234f4b,_0x41d312[_0x246e66(0xca)])){_0x692983[_0x246e66(0xd8)](0x191)[_0x246e66(0xcd)]({'error':'Invalid\x20password'});return;}const _0x4576a9=await bcrypt[_0x246e66(0xcb)](_0x4889c0,0xa);await conn[_0x246e66(0xd2)]()[_0x246e66(0xe3)](_0x246e66(0xbe),[_0x4576a9,_0x1d6265]),_0x692983[_0x246e66(0xd8)](0xc8)[_0x246e66(0xcd)]({'success':!![]});}}catch(_0x4dbb5d){console[_0x246e66(0xc4)]({'err':_0x4dbb5d}),_0x692983[_0x246e66(0xd8)](0x1f4)['json']({'error':_0x246e66(0xc0)});return;}}),router[a1_0x1c9732(0xb4)](a1_0x1c9732(0xe7),upload[a1_0x1c9732(0xf0)](a1_0x1c9732(0xc6)),verifyToken,async(_0x10bd23,_0x5eb8ea,_0x1ab489)=>{const _0x2390c0=a1_0x1c9732,{username:_0x437207,first_name:_0x398ebb,last_name:_0x2798ba}=_0x10bd23[_0x2390c0(0xd1)],_0x1fff71=_0x10bd23[_0x2390c0(0xd6)]['email'];let _0x4443dd;try{const [_0x3d89a6]=await conn[_0x2390c0(0xd2)]()['execute'](_0x2390c0(0xc7),[_0x1fff71]);_0x3d89a6[_0x2390c0(0xd5)]>0x0&&(_0x4443dd=_0x3d89a6[0x0]);}catch(_0x23dd8c){console[_0x2390c0(0xc4)]({'err':_0x23dd8c}),_0x5eb8ea[_0x2390c0(0xd8)](0x1f4)[_0x2390c0(0xcd)]({'error':_0x2390c0(0xc0)});return;}if(!_0x4443dd){_0x5eb8ea['status'](0x191)[_0x2390c0(0xcd)]({'error':_0x2390c0(0xc2)});return;}console[_0x2390c0(0xc4)]({'req':_0x10bd23[_0x2390c0(0xd1)]});let _0x592fdd=_0x4443dd[_0x2390c0(0xcf)];if(_0x10bd23[_0x2390c0(0xe6)]){const _0x329a2b=_0x2390c0(0xbb)+randomUUID()+'.png';fs[_0x2390c0(0xe5)](_0x10bd23[_0x2390c0(0xe6)][_0x2390c0(0xbc)],'./'+_0x329a2b),_0x592fdd=config[_0x2390c0(0xf1)]+'/'+_0x329a2b;}try{await conn[_0x2390c0(0xd2)]()['execute']('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x437207,_0x398ebb,_0x2798ba,_0x592fdd,_0x1fff71]);let _0x1d4d2a;try{_0x1d4d2a=jwt['sign']({'userId':_0x4443dd['id'],'email':_0x4443dd[_0x2390c0(0xda)]},config[_0x2390c0(0xc1)],{'expiresIn':_0x2390c0(0xec)});}catch(_0x4a2055){console['log'](_0x4a2055),_0x5eb8ea[_0x2390c0(0xd8)](0x1f4)['json']({'error':_0x2390c0(0xc0)});return;}_0x5eb8ea[_0x2390c0(0xd8)](0xc8)['json']({'success':!![],'data':{'userId':_0x4443dd['id'],'username':_0x437207,'first_name':_0x398ebb,'last_name':_0x2798ba,'email':_0x4443dd[_0x2390c0(0xda)],'avatar_url':_0x592fdd,'token':_0x1d4d2a}});}catch(_0x5c7e32){console[_0x2390c0(0xc4)]({'err':_0x5c7e32}),_0x5eb8ea[_0x2390c0(0xd8)](0x1f4)['json']({'error':_0x2390c0(0xc0)});return;}}),module[a1_0x1c9732(0xb3)]=router;