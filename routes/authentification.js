function a1_0x2407(){const _0x2e4e22=['../libs/mysql.js','/validate-email/','Router','first_name','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','Error!\x20Something\x20went\x20wrong.','role','message','.png','enableEmailVerification','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','Invalid\x20validation\x20token','transporter','/login','126ubCjfA','file','/signup','log','status','user','body','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)','jwtSecretKey','execute','140478DFqvAd','621093FMAqHf','avatar_url','mkdirSync','avatar','express','username','./uploads/','../libs/jwt','single','insertId','/update-user-info','is_enabled','crypted_password','ServerUrl','<p>Welcome\x20to\x20CADViewer</p>','1694980TeYJZK','promise','email','avatars','bcrypt','post','json','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','../CADViewer_config.json','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','jsonwebtoken','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','213152CvvFOp','User\x20already\x20exists','sign','115Vwemgn','verifyToken','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','9316NGIvEg','length','24h','diskStorage','../libs/mail','./avatars','Welcome\x20to\x20CADViewer','path','demo_user','Invalid\x20email\x20or\x20password','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','last_name','avatars/','120HaPVIH','6305IpwlrD','Email\x20validated\x20successfully','1711116VqrOWL','===================error===================','hash','crypto','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','multer','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','sendMail','compare'];a1_0x2407=function(){return _0x2e4e22;};return a1_0x2407();}const a1_0x42343e=a1_0x22f1;function a1_0x22f1(_0x961fd5,_0x27debb){const _0x24074f=a1_0x2407();return a1_0x22f1=function(_0x22f13e,_0x5be8f8){_0x22f13e=_0x22f13e-0x1eb;let _0x110631=_0x24074f[_0x22f13e];return _0x110631;},a1_0x22f1(_0x961fd5,_0x27debb);}(function(_0x38ad82,_0x5982a1){const _0x25df3d=a1_0x22f1,_0x53dfac=_0x38ad82();while(!![]){try{const _0x5d68a6=-parseInt(_0x25df3d(0x233))/0x1*(-parseInt(_0x25df3d(0x232))/0x2)+parseInt(_0x25df3d(0x203))/0x3+parseInt(_0x25df3d(0x225))/0x4*(parseInt(_0x25df3d(0x221))/0x5)+-parseInt(_0x25df3d(0x202))/0x6*(parseInt(_0x25df3d(0x1f8))/0x7)+parseInt(_0x25df3d(0x21e))/0x8+-parseInt(_0x25df3d(0x235))/0x9+parseInt(_0x25df3d(0x212))/0xa;if(_0x5d68a6===_0x5982a1)break;else _0x53dfac['push'](_0x53dfac['shift']());}catch(_0x44e1c4){_0x53dfac['push'](_0x53dfac['shift']());}}}(a1_0x2407,0x368fa));const jwt=require(a1_0x42343e(0x21c)),bcrypt=require(a1_0x42343e(0x216)),config=require(a1_0x42343e(0x21a)),conn=require(a1_0x42343e(0x23e)),multer=require(a1_0x42343e(0x23a)),fs=require('fs'),verifyToken=require(a1_0x42343e(0x20a))[a1_0x42343e(0x222)];!fs['existsSync'](a1_0x42343e(0x22a))&&fs[a1_0x42343e(0x205)](a1_0x42343e(0x22a));const express=require(a1_0x42343e(0x207)),router=express[a1_0x42343e(0x1eb)](),{randomUUID}=require(a1_0x42343e(0x238)),storage=multer[a1_0x42343e(0x228)]({'destination':function(_0x327b52,_0x4d522a,_0x349d6a){const _0x3c33d7=a1_0x42343e;_0x349d6a(null,_0x3c33d7(0x215));}}),upload=multer({'storage':storage});router[a1_0x42343e(0x217)](a1_0x42343e(0x1f7),async(_0x3f6bef,_0x180d30,_0x2a7e87)=>{const _0x3f61cb=a1_0x42343e;let {email:_0x3f1376,password:_0x46d41c}=_0x3f6bef[_0x3f61cb(0x1fe)];console[_0x3f61cb(0x1fb)]({'email':_0x3f1376,'password':_0x46d41c});let _0x3c6871;try{const [_0x3a6f18]=await conn[_0x3f61cb(0x213)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?',[_0x3f1376]);_0x3a6f18[_0x3f61cb(0x226)]>0x0&&(_0x3c6871=_0x3a6f18[0x0]);}catch(_0x2281db){console[_0x3f61cb(0x1fb)]({'err':_0x2281db}),_0x180d30[_0x3f61cb(0x1fc)](0x1f4)[_0x3f61cb(0x218)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x3c6871||!await bcrypt[_0x3f61cb(0x23d)](_0x46d41c,_0x3c6871?.[_0x3f61cb(0x20f)])){_0x180d30[_0x3f61cb(0x1fc)](0x191)[_0x3f61cb(0x218)]({'error':_0x3f61cb(0x22e)});return;}let _0x47ca3e;try{_0x47ca3e=jwt[_0x3f61cb(0x220)]({'userId':_0x3c6871['id'],'email':_0x3c6871[_0x3f61cb(0x214)]},config[_0x3f61cb(0x200)],{'expiresIn':'24h'});}catch(_0x531089){console[_0x3f61cb(0x1fb)](_0x531089),_0x180d30['status'](0x1f4)[_0x3f61cb(0x218)]({'error':_0x3f61cb(0x1ee)});return;}_0x180d30[_0x3f61cb(0x1fc)](0xc8)['json']({'success':!![],'data':{'userId':_0x3c6871['id'],'username':_0x3c6871['username'],'first_name':_0x3c6871[_0x3f61cb(0x1ec)],'last_name':_0x3c6871['last_name'],'email':_0x3c6871['email'],'avatar_url':_0x3c6871[_0x3f61cb(0x204)],'id':_0x3c6871['id'],'role':_0x3c6871['role'],'token':_0x47ca3e}});}),router[a1_0x42343e(0x217)](a1_0x42343e(0x1fa),async(_0x5a1bce,_0xff53ba,_0x5d91a3)=>{const _0x3bff93=a1_0x42343e,{username:_0x57b4f3,email:_0x9dc14,password:_0x2caa86}=_0x5a1bce[_0x3bff93(0x1fe)],[_0x11d3ad]=await conn[_0x3bff93(0x213)]()[_0x3bff93(0x201)](_0x3bff93(0x1f4),[_0x9dc14]);if(_0x11d3ad[_0x3bff93(0x226)]>0x0){_0xff53ba['status'](0x1a6)[_0x3bff93(0x218)]({'error':_0x3bff93(0x21f)});return;}const _0x3a6e3e=await bcrypt[_0x3bff93(0x237)](_0x2caa86,0xa);let _0x160c96=null,_0x238d45=0x1;config[_0x3bff93(0x1f2)]&&(_0x160c96=randomUUID(),_0x238d45=0x0);let _0x56a813;try{const _0x3971d0=randomUUID(),_0x142369=_0x3bff93(0x209)+_0x3971d0;fs[_0x3bff93(0x205)](_0x142369);const [_0x2a76df]=await conn['promise']()['execute'](_0x3bff93(0x1ff),[_0x57b4f3,_0x9dc14,_0x3a6e3e,_0x3bff93(0x22d),_0x238d45,_0x160c96,_0x3971d0]);if(_0x2a76df[_0x3bff93(0x20c)]){const [_0x4e6e1e]=await conn[_0x3bff93(0x213)]()[_0x3bff93(0x201)](_0x3bff93(0x239),[_0x2a76df[_0x3bff93(0x20c)]]);_0x4e6e1e[_0x3bff93(0x226)]>0x0&&(_0x56a813=_0x4e6e1e[0x0]);}}catch{_0xff53ba[_0x3bff93(0x1fc)](0x1f4)[_0x3bff93(0x218)]({'error':_0x3bff93(0x1ee)});return;}let _0x23a2af;try{_0x23a2af=jwt['sign']({'userId':_0x56a813['id'],'email':_0x56a813[_0x3bff93(0x214)]},config[_0x3bff93(0x200)],{'expiresIn':_0x3bff93(0x227)});}catch(_0x33e5f1){_0xff53ba[_0x3bff93(0x1fc)](0x1f4)[_0x3bff93(0x218)]({'error':_0x3bff93(0x1ee)});return;}const _0x4fb447=require(_0x3bff93(0x229))[_0x3bff93(0x1f6)];let _0x1d8aa7=_0x3bff93(0x211);if(config[_0x3bff93(0x1f2)]){const _0x192f33=config['frontendUrl']+_0x3bff93(0x23f)+_0x160c96;_0x1d8aa7=_0x3bff93(0x219)+_0x192f33+_0x3bff93(0x1ed)+_0x192f33+_0x3bff93(0x21d);const _0x6c2f74={'from':config['smtpFrom'],'to':_0x56a813[_0x3bff93(0x214)],'subject':_0x3bff93(0x22b),'text':_0x3bff93(0x22b),'html':_0x1d8aa7};try{await _0x4fb447[_0x3bff93(0x23c)](_0x6c2f74);}catch(_0x3ed3b1){console[_0x3bff93(0x1fb)](_0x3bff93(0x236)),console[_0x3bff93(0x1fb)](_0x3ed3b1),_0xff53ba[_0x3bff93(0x1fc)](0x1f4)[_0x3bff93(0x218)]({'error':_0x3bff93(0x223),'stack':_0x3ed3b1['stack'],'message':_0x3ed3b1[_0x3bff93(0x1f0)]});return;}_0xff53ba[_0x3bff93(0x1fc)](0xc8)[_0x3bff93(0x218)]({'success':!![],'message':_0x3bff93(0x22f)});return;}_0xff53ba[_0x3bff93(0x1fc)](0xc9)[_0x3bff93(0x218)]({'success':!![],'data':{'userId':_0x56a813['id'],'username':_0x56a813[_0x3bff93(0x208)],'first_name':_0x56a813[_0x3bff93(0x1ec)],'last_name':_0x56a813[_0x3bff93(0x230)],'email':_0x56a813[_0x3bff93(0x214)],'avatar_url':_0x56a813[_0x3bff93(0x204)],'id':_0x56a813['id'],'role':_0x56a813[_0x3bff93(0x1ef)],'token':_0x23a2af,'is_enabled':_0x56a813[_0x3bff93(0x20e)]}});}),router[a1_0x42343e(0x217)]('/validate-email/:token',async(_0x3f6ba4,_0x1cbe36)=>{const _0xd86e6f=a1_0x42343e;try{const {token:_0x348aa2}=_0x3f6ba4['params'],[_0x585f4d]=await conn[_0xd86e6f(0x213)]()['execute'](_0xd86e6f(0x224),[_0x348aa2]);if(_0x585f4d[_0xd86e6f(0x226)]===0x0){_0x1cbe36[_0xd86e6f(0x1fc)](0x194)[_0xd86e6f(0x218)]({'error':_0xd86e6f(0x1f5)});return;}await conn[_0xd86e6f(0x213)]()['execute'](_0xd86e6f(0x21b),[_0x348aa2]);const _0xf16773=jwt['sign']({'id':_0x585f4d[0x0]['id'],'email':_0x585f4d[0x0][_0xd86e6f(0x214)]},config[_0xd86e6f(0x200)],{'expiresIn':_0xd86e6f(0x227)});_0x1cbe36['status'](0xc8)[_0xd86e6f(0x218)]({'success':!![],'message':_0xd86e6f(0x234),'data':{'userId':_0x585f4d[0x0]['id'],'username':_0x585f4d[0x0][_0xd86e6f(0x208)],'first_name':_0x585f4d[0x0][_0xd86e6f(0x1ec)],'last_name':_0x585f4d[0x0][_0xd86e6f(0x230)],'email':_0x585f4d[0x0][_0xd86e6f(0x214)],'avatar_url':_0x585f4d[0x0][_0xd86e6f(0x204)],'id':_0x585f4d[0x0]['id'],'role':_0x585f4d[0x0][_0xd86e6f(0x1ef)],'token':_0xf16773,'is_enabled':0x1}});}catch(_0x3a8d6e){console[_0xd86e6f(0x1fb)](_0xd86e6f(0x236)),console['log'](_0x3a8d6e),_0x1cbe36[_0xd86e6f(0x1fc)](0x1f4)[_0xd86e6f(0x218)]({'error':_0xd86e6f(0x1ee),'stack':_0x3a8d6e['stack'],'message':_0x3a8d6e[_0xd86e6f(0x1f0)]});}}),router[a1_0x42343e(0x217)]('/update-password',verifyToken,async(_0x3c64fc,_0x10a975,_0x29e224)=>{const _0x4ef1af=a1_0x42343e,{current_password:_0x3c451e,new_password:_0x59552a}=_0x3c64fc['body'];console[_0x4ef1af(0x1fb)]({'body':_0x3c64fc[_0x4ef1af(0x1fe)]});const _0x2e1c37=_0x3c64fc[_0x4ef1af(0x1fd)][_0x4ef1af(0x214)];let _0x38acad;try{const [_0x236e96]=await conn[_0x4ef1af(0x213)]()[_0x4ef1af(0x201)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x2e1c37]);if(_0x236e96[_0x4ef1af(0x226)]>0x0){_0x38acad=_0x236e96[0x0];if(!await bcrypt[_0x4ef1af(0x23d)](_0x3c451e,_0x38acad[_0x4ef1af(0x20f)])){_0x10a975[_0x4ef1af(0x1fc)](0x191)[_0x4ef1af(0x218)]({'error':'Invalid\x20password'});return;}const _0x268b1e=await bcrypt[_0x4ef1af(0x237)](_0x59552a,0xa);await conn[_0x4ef1af(0x213)]()['execute'](_0x4ef1af(0x23b),[_0x268b1e,_0x2e1c37]),_0x10a975[_0x4ef1af(0x1fc)](0xc8)['json']({'success':!![]});}}catch(_0x17d5f8){console['log']({'err':_0x17d5f8}),_0x10a975[_0x4ef1af(0x1fc)](0x1f4)['json']({'error':_0x4ef1af(0x1ee)});return;}}),router[a1_0x42343e(0x217)](a1_0x42343e(0x20d),upload[a1_0x42343e(0x20b)](a1_0x42343e(0x206)),verifyToken,async(_0x2b15f7,_0x5a8240,_0x37274a)=>{const _0x3799a2=a1_0x42343e,{username:_0x19e89a,first_name:_0x5c103c,last_name:_0x3d7173}=_0x2b15f7['body'],_0x55622b=_0x2b15f7['user'][_0x3799a2(0x214)];let _0x5b8302;try{const [_0x4f13a9]=await conn['promise']()['execute'](_0x3799a2(0x1f4),[_0x55622b]);_0x4f13a9['length']>0x0&&(_0x5b8302=_0x4f13a9[0x0]);}catch(_0x5b686a){console[_0x3799a2(0x1fb)]({'err':_0x5b686a}),_0x5a8240[_0x3799a2(0x1fc)](0x1f4)[_0x3799a2(0x218)]({'error':_0x3799a2(0x1ee)});return;}if(!_0x5b8302){_0x5a8240[_0x3799a2(0x1fc)](0x191)[_0x3799a2(0x218)]({'error':'Invalid\x20user'});return;}console[_0x3799a2(0x1fb)]({'req':_0x2b15f7[_0x3799a2(0x1fe)]});let _0x303c20=_0x5b8302['avatar_url'];if(_0x2b15f7['file']){const _0x3c8572=_0x3799a2(0x231)+randomUUID()+_0x3799a2(0x1f1);fs['renameSync'](_0x2b15f7[_0x3799a2(0x1f9)][_0x3799a2(0x22c)],'./'+_0x3c8572),_0x303c20=config[_0x3799a2(0x210)]+'/'+_0x3c8572;}try{await conn[_0x3799a2(0x213)]()[_0x3799a2(0x201)](_0x3799a2(0x1f3),[_0x19e89a,_0x5c103c,_0x3d7173,_0x303c20,_0x55622b]);let _0x4873bb;try{_0x4873bb=jwt[_0x3799a2(0x220)]({'userId':_0x5b8302['id'],'email':_0x5b8302['email']},config[_0x3799a2(0x200)],{'expiresIn':_0x3799a2(0x227)});}catch(_0x1607b6){console[_0x3799a2(0x1fb)](_0x1607b6),_0x5a8240[_0x3799a2(0x1fc)](0x1f4)[_0x3799a2(0x218)]({'error':_0x3799a2(0x1ee)});return;}_0x5a8240[_0x3799a2(0x1fc)](0xc8)[_0x3799a2(0x218)]({'success':!![],'data':{'userId':_0x5b8302['id'],'username':_0x19e89a,'first_name':_0x5c103c,'last_name':_0x3d7173,'email':_0x5b8302[_0x3799a2(0x214)],'avatar_url':_0x303c20,'token':_0x4873bb}});}catch(_0x242f7a){console[_0x3799a2(0x1fb)]({'err':_0x242f7a}),_0x5a8240['status'](0x1f4)[_0x3799a2(0x218)]({'error':_0x3799a2(0x1ee)});return;}}),module['exports']=router;