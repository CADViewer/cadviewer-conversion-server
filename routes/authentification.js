const a1_0x381635=a1_0x4176;function a1_0x4176(_0x1d6fa2,_0x377941){const _0x457994=a1_0x4579();return a1_0x4176=function(_0x41763e,_0x1baf21){_0x41763e=_0x41763e-0x174;let _0x1fa9df=_0x457994[_0x41763e];return _0x1fa9df;},a1_0x4176(_0x1d6fa2,_0x377941);}(function(_0x118b07,_0x2ac3bd){const _0x1292ef=a1_0x4176,_0x324d22=_0x118b07();while(!![]){try{const _0x2da2aa=-parseInt(_0x1292ef(0x19d))/0x1*(-parseInt(_0x1292ef(0x1c1))/0x2)+parseInt(_0x1292ef(0x1a0))/0x3+parseInt(_0x1292ef(0x1b4))/0x4+parseInt(_0x1292ef(0x1be))/0x5*(parseInt(_0x1292ef(0x1af))/0x6)+-parseInt(_0x1292ef(0x184))/0x7*(parseInt(_0x1292ef(0x1ac))/0x8)+parseInt(_0x1292ef(0x18b))/0x9+parseInt(_0x1292ef(0x19e))/0xa*(-parseInt(_0x1292ef(0x1c2))/0xb);if(_0x2da2aa===_0x2ac3bd)break;else _0x324d22['push'](_0x324d22['shift']());}catch(_0x30bb36){_0x324d22['push'](_0x324d22['shift']());}}}(a1_0x4579,0x2a3b5));const jwt=require(a1_0x381635(0x18a)),bcrypt=require(a1_0x381635(0x1c3)),config=require(a1_0x381635(0x1b5)),conn=require(a1_0x381635(0x1c5)),multer=require(a1_0x381635(0x197)),fs=require('fs'),verifyToken=require(a1_0x381635(0x1b6))['verifyToken'];!fs['existsSync'](a1_0x381635(0x19b))&&fs['mkdirSync'](a1_0x381635(0x19b));const express=require(a1_0x381635(0x1b2)),router=express['Router'](),{randomUUID}=require(a1_0x381635(0x1ae)),storage=multer[a1_0x381635(0x1a4)]({'destination':function(_0x3761ff,_0x6f8c9a,_0x32dc82){const _0x2a162f=a1_0x381635;_0x32dc82(null,_0x2a162f(0x189));}}),upload=multer({'storage':storage});router[a1_0x381635(0x174)](a1_0x381635(0x17a),async(_0x307f39,_0x5d4502,_0x170b90)=>{const _0x553f78=a1_0x381635;let {email:_0x10526c,password:_0xf08a3e}=_0x307f39[_0x553f78(0x1bb)];console[_0x553f78(0x1a9)]({'email':_0x10526c,'password':_0xf08a3e});let _0x2cc868;try{const [_0x52df4e]=await conn[_0x553f78(0x1bf)]()['execute'](_0x553f78(0x17b),[_0x10526c]);_0x52df4e[_0x553f78(0x1bd)]>0x0&&(_0x2cc868=_0x52df4e[0x0]);}catch(_0x5b3c09){console[_0x553f78(0x1a9)]({'err':_0x5b3c09}),_0x5d4502['status'](0x1f4)[_0x553f78(0x1a3)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x2cc868||!await bcrypt[_0x553f78(0x17d)](_0xf08a3e,_0x2cc868?.['crypted_password'])){_0x5d4502[_0x553f78(0x1ab)](0x191)[_0x553f78(0x1a3)]({'error':_0x553f78(0x1c0)});return;}let _0x52e67b;try{_0x52e67b=jwt[_0x553f78(0x1bc)]({'userId':_0x2cc868['id'],'email':_0x2cc868[_0x553f78(0x1b3)]},config[_0x553f78(0x1a7)],{'expiresIn':_0x553f78(0x1aa)});}catch(_0x5e1645){console[_0x553f78(0x1a9)](_0x5e1645),_0x5d4502[_0x553f78(0x1ab)](0x1f4)[_0x553f78(0x1a3)]({'error':_0x553f78(0x1a6)});return;}_0x5d4502[_0x553f78(0x1ab)](0xc8)[_0x553f78(0x1a3)]({'success':!![],'data':{'userId':_0x2cc868['id'],'username':_0x2cc868[_0x553f78(0x194)],'first_name':_0x2cc868[_0x553f78(0x175)],'last_name':_0x2cc868[_0x553f78(0x192)],'email':_0x2cc868[_0x553f78(0x1b3)],'avatar_url':_0x2cc868[_0x553f78(0x1b9)],'id':_0x2cc868['id'],'role':_0x2cc868[_0x553f78(0x19a)],'token':_0x52e67b}});}),router['post'](a1_0x381635(0x185),async(_0x2c6af9,_0x3d3812,_0x26ed79)=>{const _0x5192dd=a1_0x381635,{username:_0x47d91a,email:_0x5a05f9,password:_0xf50d4a}=_0x2c6af9[_0x5192dd(0x1bb)],[_0x5718bd]=await conn['promise']()['execute'](_0x5192dd(0x1a2),[_0x5a05f9]);if(_0x5718bd[_0x5192dd(0x1bd)]>0x0){_0x3d3812[_0x5192dd(0x1ab)](0x1a6)[_0x5192dd(0x1a3)]({'error':_0x5192dd(0x191)});return;}const _0x4e2f23=await bcrypt[_0x5192dd(0x181)](_0xf50d4a,0xa);let _0x245ce2=null,_0x476d38=0x1;config['enableEmailVerification']&&(_0x245ce2=randomUUID(),_0x476d38=0x0);let _0x134679;try{const _0x2ba88c=randomUUID(),_0x186109='./uploads/'+_0x2ba88c;fs['mkdirSync'](_0x186109);const [_0x37dbf3]=await conn['promise']()['execute'](_0x5192dd(0x1ba),[_0x47d91a,_0x5a05f9,_0x4e2f23,'demo_user',_0x476d38,_0x245ce2,_0x2ba88c]);if(_0x37dbf3['insertId']){const [_0x47c7ec]=await conn['promise']()[_0x5192dd(0x177)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0x37dbf3[_0x5192dd(0x18e)]]);_0x47c7ec[_0x5192dd(0x1bd)]>0x0&&(_0x134679=_0x47c7ec[0x0]);}}catch{_0x3d3812[_0x5192dd(0x1ab)](0x1f4)[_0x5192dd(0x1a3)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x2faee8;try{_0x2faee8=jwt[_0x5192dd(0x1bc)]({'userId':_0x134679['id'],'email':_0x134679[_0x5192dd(0x1b3)]},config[_0x5192dd(0x1a7)],{'expiresIn':_0x5192dd(0x1aa)});}catch(_0x40be8a){_0x3d3812[_0x5192dd(0x1ab)](0x1f4)[_0x5192dd(0x1a3)]({'error':_0x5192dd(0x1a6)});return;}const _0x516f1c=require(_0x5192dd(0x190))[_0x5192dd(0x1a1)];let _0x1a669a=_0x5192dd(0x183);if(config['enableEmailVerification']){const _0x106c68=config['frontendUrl']+'/validate-email/'+_0x245ce2;_0x1a669a=_0x5192dd(0x186)+_0x106c68+_0x5192dd(0x1c4)+_0x106c68+_0x5192dd(0x1b0);const _0x47a59f={'from':config[_0x5192dd(0x1b1)],'to':_0x134679[_0x5192dd(0x1b3)],'subject':_0x5192dd(0x17f),'text':_0x5192dd(0x17f),'html':_0x1a669a};try{await _0x516f1c[_0x5192dd(0x198)](_0x47a59f);}catch(_0x2362cb){console['log'](_0x5192dd(0x195)),console[_0x5192dd(0x1a9)](_0x2362cb),_0x3d3812[_0x5192dd(0x1ab)](0x1f4)[_0x5192dd(0x1a3)]({'error':_0x5192dd(0x1a5),'stack':_0x2362cb[_0x5192dd(0x1ad)],'message':_0x2362cb[_0x5192dd(0x19c)]});return;}_0x3d3812[_0x5192dd(0x1ab)](0xc8)[_0x5192dd(0x1a3)]({'success':!![],'message':_0x5192dd(0x17c)});return;}_0x3d3812['status'](0xc9)[_0x5192dd(0x1a3)]({'success':!![],'data':{'userId':_0x134679['id'],'username':_0x134679[_0x5192dd(0x194)],'first_name':_0x134679['first_name'],'last_name':_0x134679[_0x5192dd(0x192)],'email':_0x134679[_0x5192dd(0x1b3)],'avatar_url':_0x134679[_0x5192dd(0x1b9)],'id':_0x134679['id'],'role':_0x134679[_0x5192dd(0x19a)],'token':_0x2faee8,'is_enabled':_0x134679[_0x5192dd(0x196)]}});}),router[a1_0x381635(0x174)](a1_0x381635(0x176),async(_0x125968,_0x288efc)=>{const _0x1c36e8=a1_0x381635;try{const {token:_0x133469}=_0x125968[_0x1c36e8(0x180)],[_0x5cccf1]=await conn[_0x1c36e8(0x1bf)]()[_0x1c36e8(0x177)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?',[_0x133469]);if(_0x5cccf1['length']===0x0){_0x288efc[_0x1c36e8(0x1ab)](0x194)['json']({'error':'Invalid\x20validation\x20token'});return;}await conn[_0x1c36e8(0x1bf)]()[_0x1c36e8(0x177)](_0x1c36e8(0x1b8),[_0x133469]);const _0x2202de=jwt['sign']({'id':_0x5cccf1[0x0]['id'],'email':_0x5cccf1[0x0][_0x1c36e8(0x1b3)]},config[_0x1c36e8(0x1a7)],{'expiresIn':_0x1c36e8(0x1aa)});_0x288efc[_0x1c36e8(0x1ab)](0xc8)['json']({'success':!![],'message':_0x1c36e8(0x188),'data':{'userId':_0x5cccf1[0x0]['id'],'username':_0x5cccf1[0x0][_0x1c36e8(0x194)],'first_name':_0x5cccf1[0x0][_0x1c36e8(0x175)],'last_name':_0x5cccf1[0x0][_0x1c36e8(0x192)],'email':_0x5cccf1[0x0][_0x1c36e8(0x1b3)],'avatar_url':_0x5cccf1[0x0]['avatar_url'],'id':_0x5cccf1[0x0]['id'],'role':_0x5cccf1[0x0][_0x1c36e8(0x19a)],'token':_0x2202de,'is_enabled':0x1}});}catch(_0x509fd3){console[_0x1c36e8(0x1a9)](_0x1c36e8(0x195)),console[_0x1c36e8(0x1a9)](_0x509fd3),_0x288efc[_0x1c36e8(0x1ab)](0x1f4)[_0x1c36e8(0x1a3)]({'error':'Error!\x20Something\x20went\x20wrong.','stack':_0x509fd3[_0x1c36e8(0x1ad)],'message':_0x509fd3[_0x1c36e8(0x19c)]});}}),router[a1_0x381635(0x174)](a1_0x381635(0x17e),verifyToken,async(_0x3cf4ad,_0x208515,_0x423096)=>{const _0x3f119b=a1_0x381635,{current_password:_0x279094,new_password:_0x5019cc}=_0x3cf4ad[_0x3f119b(0x1bb)];console[_0x3f119b(0x1a9)]({'body':_0x3cf4ad[_0x3f119b(0x1bb)]});const _0x667e07=_0x3cf4ad[_0x3f119b(0x182)][_0x3f119b(0x1b3)];let _0x279118;try{const [_0x205eec]=await conn[_0x3f119b(0x1bf)]()[_0x3f119b(0x177)](_0x3f119b(0x1a2),[_0x667e07]);if(_0x205eec[_0x3f119b(0x1bd)]>0x0){_0x279118=_0x205eec[0x0];if(!await bcrypt['compare'](_0x279094,_0x279118['crypted_password'])){_0x208515[_0x3f119b(0x1ab)](0x191)[_0x3f119b(0x1a3)]({'error':_0x3f119b(0x18f)});return;}const _0x1fdfa5=await bcrypt[_0x3f119b(0x181)](_0x5019cc,0xa);await conn[_0x3f119b(0x1bf)]()[_0x3f119b(0x177)](_0x3f119b(0x199),[_0x1fdfa5,_0x667e07]),_0x208515[_0x3f119b(0x1ab)](0xc8)[_0x3f119b(0x1a3)]({'success':!![]});}}catch(_0x16a2d3){console[_0x3f119b(0x1a9)]({'err':_0x16a2d3}),_0x208515['status'](0x1f4)[_0x3f119b(0x1a3)]({'error':_0x3f119b(0x1a6)});return;}}),router['post'](a1_0x381635(0x193),upload[a1_0x381635(0x19f)](a1_0x381635(0x187)),verifyToken,async(_0x263dcd,_0x531afb,_0x13f095)=>{const _0x130043=a1_0x381635,{username:_0x566928,first_name:_0x4539d6,last_name:_0x5034c0}=_0x263dcd[_0x130043(0x1bb)],_0x42b828=_0x263dcd[_0x130043(0x182)][_0x130043(0x1b3)];let _0xd90187;try{const [_0x28e24a]=await conn[_0x130043(0x1bf)]()[_0x130043(0x177)](_0x130043(0x1a2),[_0x42b828]);_0x28e24a[_0x130043(0x1bd)]>0x0&&(_0xd90187=_0x28e24a[0x0]);}catch(_0x2c26cc){console['log']({'err':_0x2c26cc}),_0x531afb[_0x130043(0x1ab)](0x1f4)[_0x130043(0x1a3)]({'error':_0x130043(0x1a6)});return;}if(!_0xd90187){_0x531afb[_0x130043(0x1ab)](0x191)[_0x130043(0x1a3)]({'error':_0x130043(0x18c)});return;}console[_0x130043(0x1a9)]({'req':_0x263dcd['body']});let _0x100669=_0xd90187[_0x130043(0x1b9)];if(_0x263dcd[_0x130043(0x18d)]){const _0x502661=_0x130043(0x179)+randomUUID()+_0x130043(0x1a8);fs['copyFileSync'](_0x263dcd[_0x130043(0x18d)][_0x130043(0x1b7)],'./'+_0x502661),fs['unlinkSync'](_0x263dcd[_0x130043(0x18d)][_0x130043(0x1b7)]),_0x100669=config['ServerUrl']+'/'+_0x502661;}try{await conn[_0x130043(0x1bf)]()[_0x130043(0x177)](_0x130043(0x178),[_0x566928,_0x4539d6,_0x5034c0,_0x100669,_0x42b828]);let _0x376cca;try{_0x376cca=jwt[_0x130043(0x1bc)]({'userId':_0xd90187['id'],'email':_0xd90187[_0x130043(0x1b3)]},config['jwtSecretKey'],{'expiresIn':_0x130043(0x1aa)});}catch(_0x2df12f){console['log'](_0x2df12f),_0x531afb[_0x130043(0x1ab)](0x1f4)['json']({'error':_0x130043(0x1a6)});return;}_0x531afb[_0x130043(0x1ab)](0xc8)[_0x130043(0x1a3)]({'success':!![],'data':{'userId':_0xd90187['id'],'username':_0x566928,'first_name':_0x4539d6,'last_name':_0x5034c0,'email':_0xd90187['email'],'avatar_url':_0x100669,'token':_0x376cca}});}catch(_0x4e5035){console[_0x130043(0x1a9)]({'err':_0x4e5035}),_0x531afb[_0x130043(0x1ab)](0x1f4)[_0x130043(0x1a3)]({'error':_0x130043(0x1a6)});return;}}),module['exports']=router;function a1_0x4579(){const _0x45197b=['username','===================error===================','is_enabled','multer','sendMail','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','role','./avatars','message','350UGhfLl','8221670UEozgY','single','863652vJSvAO','transporter','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','json','diskStorage','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','Error!\x20Something\x20went\x20wrong.','jwtSecretKey','.png','log','24h','status','619296CutJEY','stack','crypto','96HPDWuj','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','smtpFrom','express','email','1359364BsnkPj','../CADViewer_config.json','../libs/jwt','path','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','avatar_url','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)','body','sign','length','75995EmxApp','promise','Invalid\x20email\x20or\x20password','616JNFUwc','11zYoSOF','bcrypt','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','../libs/mysql.js','post','first_name','/validate-email/:token','execute','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','avatars/','/login','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','compare','/update-password','Welcome\x20to\x20CADViewer','params','hash','user','<p>Welcome\x20to\x20CADViewer</p>','14MnbKqy','/signup','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','avatar','Email\x20validated\x20successfully','avatars','jsonwebtoken','1541367McaYzU','Invalid\x20user','file','insertId','Invalid\x20password','../libs/mail','User\x20already\x20exists','last_name','/update-user-info'];a1_0x4579=function(){return _0x45197b;};return a1_0x4579();}