function a1_0x442f(_0x4d43fa,_0x57b8a3){const _0x52ce3f=a1_0x52ce();return a1_0x442f=function(_0x442fa4,_0x25ce04){_0x442fa4=_0x442fa4-0xf5;let _0x19094f=_0x52ce3f[_0x442fa4];return _0x19094f;},a1_0x442f(_0x4d43fa,_0x57b8a3);}const a1_0x1a3bba=a1_0x442f;(function(_0x8778a7,_0x574252){const _0x29b9aa=a1_0x442f,_0x3d8ec0=_0x8778a7();while(!![]){try{const _0xf18249=-parseInt(_0x29b9aa(0x114))/0x1*(-parseInt(_0x29b9aa(0x119))/0x2)+-parseInt(_0x29b9aa(0x105))/0x3*(parseInt(_0x29b9aa(0xfe))/0x4)+-parseInt(_0x29b9aa(0x106))/0x5+-parseInt(_0x29b9aa(0x11d))/0x6*(parseInt(_0x29b9aa(0x10f))/0x7)+parseInt(_0x29b9aa(0x134))/0x8*(-parseInt(_0x29b9aa(0x102))/0x9)+parseInt(_0x29b9aa(0x120))/0xa*(-parseInt(_0x29b9aa(0xfc))/0xb)+-parseInt(_0x29b9aa(0x122))/0xc*(-parseInt(_0x29b9aa(0x10e))/0xd);if(_0xf18249===_0x574252)break;else _0x3d8ec0['push'](_0x3d8ec0['shift']());}catch(_0x3852c){_0x3d8ec0['push'](_0x3d8ec0['shift']());}}}(a1_0x52ce,0x33e9a));const jwt=require('jsonwebtoken'),bcrypt=require('bcrypt'),config=require('../CADViewer_config.json'),conn=require(a1_0x1a3bba(0x115)),multer=require(a1_0x1a3bba(0x103)),fs=require('fs'),verifyToken=require(a1_0x1a3bba(0x108))[a1_0x1a3bba(0x12d)];!fs[a1_0x1a3bba(0x127)](a1_0x1a3bba(0x129))&&fs[a1_0x1a3bba(0x11c)](a1_0x1a3bba(0x129));const express=require(a1_0x1a3bba(0x104)),router=express['Router'](),{randomUUID}=require('crypto'),storage=multer[a1_0x1a3bba(0xf7)]({'destination':function(_0xeb1983,_0x4e80ea,_0x51fac4){const _0x2f9a5d=a1_0x1a3bba;_0x51fac4(null,_0x2f9a5d(0x10d));}}),upload=multer({'storage':storage});function a1_0x52ce(){const _0x814dc8=['../libs/mysql.js','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','avatar_url','sign','178yKZMoS','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','user','mkdirSync','86166YEHbqO','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','ServerUrl','60jJEZob','Invalid\x20email\x20or\x20password','24caTlkT','post','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','/update-password','json','existsSync','execute','./avatars','username','path','single','verifyToken','jwtSecretKey','Invalid\x20password','promise','/login','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','avatars/','8coevfc','status','last_name','diskStorage','renameSync','file','crypted_password','Error!\x20Something\x20went\x20wrong.','624822wxPjOf','role','116XZFdqL','exports','compare','body','783009INMtCP','multer','express','34818MIzrUN','2092275qrbkKK','hash','../libs/jwt','/update-user-info','first_name','length','insertId','avatars','8218925QwiLgo','35RGLtEC','User\x20already\x20exists','log','Invalid\x20user','email','2279XhKiXx'];a1_0x52ce=function(){return _0x814dc8;};return a1_0x52ce();}router[a1_0x1a3bba(0x123)](a1_0x1a3bba(0x131),async(_0x1bdfb1,_0x5a9dc8,_0x1d7425)=>{const _0x3896ae=a1_0x1a3bba;let {email:_0x225607,password:_0x7d518d}=_0x1bdfb1[_0x3896ae(0x101)];console[_0x3896ae(0x111)]({'email':_0x225607,'password':_0x7d518d});let _0x15f23a;try{const [_0x35ac12]=await conn[_0x3896ae(0x130)]()[_0x3896ae(0x128)](_0x3896ae(0x116),[_0x225607]);_0x35ac12['length']>0x0&&(_0x15f23a=_0x35ac12[0x0]);}catch(_0x5e82e2){console[_0x3896ae(0x111)]({'err':_0x5e82e2}),_0x5a9dc8['status'](0x1f4)['json']({'error':_0x3896ae(0xfb)});return;}console[_0x3896ae(0x111)](_0x15f23a),console['log'](_0x7d518d),console[_0x3896ae(0x111)](_0x15f23a[_0x3896ae(0xfa)]);if(!_0x15f23a||!await bcrypt['compare'](_0x7d518d,_0x15f23a['crypted_password'])){_0x5a9dc8[_0x3896ae(0xf5)](0x191)[_0x3896ae(0x126)]({'error':_0x3896ae(0x121)});return;}let _0x3386b6;try{_0x3386b6=jwt[_0x3896ae(0x118)]({'userId':_0x15f23a['id'],'email':_0x15f23a[_0x3896ae(0x113)]},config[_0x3896ae(0x12e)],{'expiresIn':'24h'});}catch(_0x4f7f4e){console[_0x3896ae(0x111)](_0x4f7f4e),_0x5a9dc8['status'](0x1f4)[_0x3896ae(0x126)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x5a9dc8[_0x3896ae(0xf5)](0xc8)[_0x3896ae(0x126)]({'success':!![],'data':{'userId':_0x15f23a['id'],'username':_0x15f23a[_0x3896ae(0x12a)],'first_name':_0x15f23a[_0x3896ae(0x10a)],'last_name':_0x15f23a[_0x3896ae(0xf6)],'email':_0x15f23a[_0x3896ae(0x113)],'avatar_url':_0x15f23a[_0x3896ae(0x117)],'id':_0x15f23a['id'],'role':_0x15f23a['role'],'token':_0x3386b6}});}),router[a1_0x1a3bba(0x123)]('/signup',async(_0x2defa2,_0x15af4e,_0x22249b)=>{const _0xa6da0e=a1_0x1a3bba,{username:_0x29db05,email:_0x525d7a,password:_0x456f03}=_0x2defa2['body'],[_0x156534]=await conn[_0xa6da0e(0x130)]()[_0xa6da0e(0x128)](_0xa6da0e(0x132),[_0x525d7a]);if(_0x156534[_0xa6da0e(0x10b)]>0x0){_0x15af4e[_0xa6da0e(0xf5)](0x1a6)[_0xa6da0e(0x126)]({'error':_0xa6da0e(0x110)});return;}const _0x336b77=await bcrypt['hash'](_0x456f03,0xa);try{const [_0x4277f1]=await conn[_0xa6da0e(0x130)]()[_0xa6da0e(0x128)](_0xa6da0e(0x11e),[_0x29db05,_0x525d7a,_0x336b77,'user']);if(_0x4277f1[_0xa6da0e(0x10c)]){const [_0x26c72b]=await conn[_0xa6da0e(0x130)]()[_0xa6da0e(0x128)](_0xa6da0e(0x11a),[_0x4277f1['insertId']]);_0x26c72b[_0xa6da0e(0x10b)]>0x0&&(newUser=_0x26c72b[0x0]);}}catch{_0x15af4e[_0xa6da0e(0xf5)](0x1f4)[_0xa6da0e(0x126)]({'error':_0xa6da0e(0xfb)});return;}let _0x4ecc4b;try{_0x4ecc4b=jwt[_0xa6da0e(0x118)]({'userId':newUser['id'],'email':newUser[_0xa6da0e(0x113)]},config[_0xa6da0e(0x12e)],{'expiresIn':'24h'});}catch(_0x2d57ff){_0x15af4e[_0xa6da0e(0xf5)](0x1f4)[_0xa6da0e(0x126)]({'error':_0xa6da0e(0xfb)});return;}_0x15af4e[_0xa6da0e(0xf5)](0xc9)['json']({'success':!![],'data':{'userId':newUser['id'],'username':newUser[_0xa6da0e(0x12a)],'first_name':newUser['first_name'],'last_name':newUser[_0xa6da0e(0xf6)],'email':newUser[_0xa6da0e(0x113)],'avatar_url':newUser[_0xa6da0e(0x117)],'id':newUser['id'],'role':newUser[_0xa6da0e(0xfd)],'token':_0x4ecc4b}});}),router[a1_0x1a3bba(0x123)](a1_0x1a3bba(0x125),verifyToken,async(_0x2fd3fe,_0x12260d,_0x552a40)=>{const _0x2874e8=a1_0x1a3bba,{current_password:_0x365bf4,new_password:_0x47dd27}=_0x2fd3fe[_0x2874e8(0x101)];console['log']({'body':_0x2fd3fe['body']});const _0x1e3275=_0x2fd3fe['user'][_0x2874e8(0x113)];let _0x314e50;try{const [_0x15cb3b]=await conn[_0x2874e8(0x130)]()[_0x2874e8(0x128)](_0x2874e8(0x132),[_0x1e3275]);if(_0x15cb3b[_0x2874e8(0x10b)]>0x0){_0x314e50=_0x15cb3b[0x0];if(!await bcrypt[_0x2874e8(0x100)](_0x365bf4,_0x314e50[_0x2874e8(0xfa)])){_0x12260d[_0x2874e8(0xf5)](0x191)[_0x2874e8(0x126)]({'error':_0x2874e8(0x12f)});return;}const _0x182227=await bcrypt[_0x2874e8(0x107)](_0x47dd27,0xa);await conn[_0x2874e8(0x130)]()['execute']('UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x182227,_0x1e3275]),_0x12260d['status'](0xc8)['json']({'success':!![]});}}catch(_0x5cc5e9){console['log']({'err':_0x5cc5e9}),_0x12260d[_0x2874e8(0xf5)](0x1f4)[_0x2874e8(0x126)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router[a1_0x1a3bba(0x123)](a1_0x1a3bba(0x109),upload[a1_0x1a3bba(0x12c)]('avatar'),verifyToken,async(_0x31a738,_0xf0918f,_0xc8c9df)=>{const _0x23af27=a1_0x1a3bba,{username:_0xb5279e,first_name:_0x1aa384,last_name:_0x1ec3cf}=_0x31a738[_0x23af27(0x101)],_0x5e7f01=_0x31a738[_0x23af27(0x11b)][_0x23af27(0x113)];let _0x577ead;try{const [_0x868efe]=await conn[_0x23af27(0x130)]()[_0x23af27(0x128)](_0x23af27(0x132),[_0x5e7f01]);_0x868efe[_0x23af27(0x10b)]>0x0&&(_0x577ead=_0x868efe[0x0]);}catch(_0x22054f){console[_0x23af27(0x111)]({'err':_0x22054f}),_0xf0918f['status'](0x1f4)[_0x23af27(0x126)]({'error':_0x23af27(0xfb)});return;}if(!_0x577ead){_0xf0918f[_0x23af27(0xf5)](0x191)['json']({'error':_0x23af27(0x112)});return;}console['log']({'req':_0x31a738['body']});let _0x1c4b4e=_0x577ead[_0x23af27(0x117)];if(_0x31a738[_0x23af27(0xf9)]){const _0x367516=_0x23af27(0x133)+randomUUID()+'.png';fs[_0x23af27(0xf8)](_0x31a738['file'][_0x23af27(0x12b)],'./'+_0x367516),_0x1c4b4e=config[_0x23af27(0x11f)]+'/'+_0x367516;}try{await conn[_0x23af27(0x130)]()['execute'](_0x23af27(0x124),[_0xb5279e,_0x1aa384,_0x1ec3cf,_0x1c4b4e,_0x5e7f01]);let _0x2e562f;try{_0x2e562f=jwt[_0x23af27(0x118)]({'userId':_0x577ead['id'],'email':_0x577ead[_0x23af27(0x113)]},config[_0x23af27(0x12e)],{'expiresIn':'24h'});}catch(_0x4582d6){console[_0x23af27(0x111)](_0x4582d6),_0xf0918f[_0x23af27(0xf5)](0x1f4)[_0x23af27(0x126)]({'error':_0x23af27(0xfb)});return;}_0xf0918f[_0x23af27(0xf5)](0xc8)[_0x23af27(0x126)]({'success':!![],'data':{'userId':_0x577ead['id'],'username':_0xb5279e,'first_name':_0x1aa384,'last_name':_0x1ec3cf,'email':_0x577ead['email'],'avatar_url':_0x1c4b4e,'token':_0x2e562f}});}catch(_0x28ee17){console[_0x23af27(0x111)]({'err':_0x28ee17}),_0xf0918f[_0x23af27(0xf5)](0x1f4)['json']({'error':_0x23af27(0xfb)});return;}}),module[a1_0x1a3bba(0xff)]=router;