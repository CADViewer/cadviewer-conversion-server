const a1_0x23398b=a1_0x48f1;(function(_0x2ea479,_0x38450c){const _0x448116=a1_0x48f1,_0x3a0eb1=_0x2ea479();while(!![]){try{const _0x39a450=parseInt(_0x448116(0x165))/0x1+parseInt(_0x448116(0x148))/0x2*(parseInt(_0x448116(0x172))/0x3)+-parseInt(_0x448116(0x13d))/0x4*(-parseInt(_0x448116(0x16d))/0x5)+-parseInt(_0x448116(0x14f))/0x6+-parseInt(_0x448116(0x147))/0x7+parseInt(_0x448116(0x173))/0x8*(-parseInt(_0x448116(0x15d))/0x9)+parseInt(_0x448116(0x174))/0xa*(-parseInt(_0x448116(0x15a))/0xb);if(_0x39a450===_0x38450c)break;else _0x3a0eb1['push'](_0x3a0eb1['shift']());}catch(_0xbf65a5){_0x3a0eb1['push'](_0x3a0eb1['shift']());}}}(a1_0x57c0,0x67f2a));const jwt=require(a1_0x23398b(0x152)),bcrypt=require(a1_0x23398b(0x162)),config=require(a1_0x23398b(0x141)),conn=require(a1_0x23398b(0x176)),multer=require(a1_0x23398b(0x136)),fs=require('fs'),verifyToken=require('../libs/jwt')['verifyToken'];function a1_0x57c0(){const _0x23afbe=['file','5fdvcHU','renameSync','User\x20already\x20exists','crypto','ServerUrl','5262BBHDsh','184bpKukb','490HHmBcN','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','../libs/mysql.js','Invalid\x20user','Invalid\x20password','multer','promise','avatars','diskStorage','./avatars','first_name','status','1979108JPppfn','avatars/','email','mkdirSync','../CADViewer_config.json','sign','/signup','last_name','compare','insertId','448126GEckeb','926GunnYz','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','post','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','/update-password','username','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','583920DUTpKf','avatar','role','jsonwebtoken','/update-user-info','express','log','json','existsSync','jwtSecretKey','exports','56419fRiLBi','24h','.png','324279yuWCzy','avatar_url','Router','user','hash','bcrypt','path','crypted_password','360263vTnUBL','body','length','execute','single','Invalid\x20email\x20or\x20password','Error!\x20Something\x20went\x20wrong.'];a1_0x57c0=function(){return _0x23afbe;};return a1_0x57c0();}!fs[a1_0x23398b(0x157)]('./avatars')&&fs[a1_0x23398b(0x140)](a1_0x23398b(0x13a));const express=require(a1_0x23398b(0x154)),router=express[a1_0x23398b(0x15f)](),{randomUUID}=require(a1_0x23398b(0x170)),storage=multer[a1_0x23398b(0x139)]({'destination':function(_0x133cf5,_0x187e77,_0x4fba7a){const _0x3fef6d=a1_0x23398b;_0x4fba7a(null,_0x3fef6d(0x138));}}),upload=multer({'storage':storage});function a1_0x48f1(_0x1a8143,_0x14dde4){const _0x57c0e0=a1_0x57c0();return a1_0x48f1=function(_0x48f134,_0x25c8b2){_0x48f134=_0x48f134-0x135;let _0x40cd8a=_0x57c0e0[_0x48f134];return _0x40cd8a;},a1_0x48f1(_0x1a8143,_0x14dde4);}router[a1_0x23398b(0x14a)]('/login',async(_0x1ed4d9,_0x53c124,_0x4155a8)=>{const _0x43444d=a1_0x23398b;let {email:_0x32edaf,password:_0x337562}=_0x1ed4d9['body'];console[_0x43444d(0x155)]({'email':_0x32edaf,'password':_0x337562});let _0xc0653f;try{const [_0x596791]=await conn[_0x43444d(0x137)]()['execute'](_0x43444d(0x175),[_0x32edaf]);_0x596791[_0x43444d(0x167)]>0x0&&(_0xc0653f=_0x596791[0x0]);}catch(_0x2226a8){console['log']({'err':_0x2226a8}),_0x53c124[_0x43444d(0x13c)](0x1f4)[_0x43444d(0x156)]({'error':_0x43444d(0x16b)});return;}if(!_0xc0653f||!await bcrypt[_0x43444d(0x145)](_0x337562,_0xc0653f['crypted_password'])){_0x53c124['status'](0x191)[_0x43444d(0x156)]({'error':_0x43444d(0x16a)});return;}let _0x4a657c;try{_0x4a657c=jwt['sign']({'userId':_0xc0653f['id'],'email':_0xc0653f[_0x43444d(0x13f)]},config['jwtSecretKey'],{'expiresIn':_0x43444d(0x15b)});}catch(_0x16428){console[_0x43444d(0x155)](_0x16428),_0x53c124['status'](0x1f4)[_0x43444d(0x156)]({'error':_0x43444d(0x16b)});return;}_0x53c124[_0x43444d(0x13c)](0xc8)[_0x43444d(0x156)]({'success':!![],'data':{'userId':_0xc0653f['id'],'username':_0xc0653f[_0x43444d(0x14d)],'first_name':_0xc0653f[_0x43444d(0x13b)],'last_name':_0xc0653f[_0x43444d(0x144)],'email':_0xc0653f[_0x43444d(0x13f)],'avatar_url':_0xc0653f[_0x43444d(0x15e)],'id':_0xc0653f['id'],'role':_0xc0653f[_0x43444d(0x151)],'token':_0x4a657c}});}),router[a1_0x23398b(0x14a)](a1_0x23398b(0x143),async(_0x5417fd,_0xa803dd,_0x286307)=>{const _0x116958=a1_0x23398b,{username:_0x27c65e,email:_0x4d7171,password:_0x103eda}=_0x5417fd[_0x116958(0x166)],[_0x2ed583]=await conn[_0x116958(0x137)]()['execute'](_0x116958(0x14e),[_0x4d7171]);if(_0x2ed583[_0x116958(0x167)]>0x0){_0xa803dd['status'](0x1a6)['json']({'error':_0x116958(0x16f)});return;}const _0x375c93=await bcrypt[_0x116958(0x161)](_0x103eda,0xa);try{const [_0x27134a]=await conn['promise']()[_0x116958(0x168)]('INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)',[_0x27c65e,_0x4d7171,_0x375c93,_0x116958(0x160)]);if(_0x27134a[_0x116958(0x146)]){const [_0x333c3f]=await conn[_0x116958(0x137)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0x27134a[_0x116958(0x146)]]);_0x333c3f[_0x116958(0x167)]>0x0&&(newUser=_0x333c3f[0x0]);}}catch{_0xa803dd['status'](0x1f4)[_0x116958(0x156)]({'error':_0x116958(0x16b)});return;}let _0x48d6fb;try{_0x48d6fb=jwt['sign']({'userId':newUser['id'],'email':newUser[_0x116958(0x13f)]},config['jwtSecretKey'],{'expiresIn':_0x116958(0x15b)});}catch(_0x4d52dd){_0xa803dd[_0x116958(0x13c)](0x1f4)[_0x116958(0x156)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0xa803dd[_0x116958(0x13c)](0xc9)[_0x116958(0x156)]({'success':!![],'data':{'userId':newUser['id'],'username':newUser[_0x116958(0x14d)],'first_name':newUser['first_name'],'last_name':newUser[_0x116958(0x144)],'email':newUser[_0x116958(0x13f)],'avatar_url':newUser['avatar_url'],'token':_0x48d6fb}});}),router[a1_0x23398b(0x14a)](a1_0x23398b(0x14c),verifyToken,async(_0x5a028a,_0x1ab026,_0x383ab7)=>{const _0x1a8384=a1_0x23398b,{current_password:_0x4ee593,new_password:_0x4267cc}=_0x5a028a[_0x1a8384(0x166)];console[_0x1a8384(0x155)]({'body':_0x5a028a[_0x1a8384(0x166)]});const _0x3e3808=_0x5a028a[_0x1a8384(0x160)]['email'];let _0x174302;try{const [_0x502974]=await conn[_0x1a8384(0x137)]()[_0x1a8384(0x168)](_0x1a8384(0x14e),[_0x3e3808]);if(_0x502974[_0x1a8384(0x167)]>0x0){_0x174302=_0x502974[0x0];if(!await bcrypt[_0x1a8384(0x145)](_0x4ee593,_0x174302[_0x1a8384(0x164)])){_0x1ab026[_0x1a8384(0x13c)](0x191)[_0x1a8384(0x156)]({'error':_0x1a8384(0x135)});return;}const _0x5a4aa2=await bcrypt[_0x1a8384(0x161)](_0x4267cc,0xa);await conn[_0x1a8384(0x137)]()['execute'](_0x1a8384(0x14b),[_0x5a4aa2,_0x3e3808]),_0x1ab026['status'](0xc8)[_0x1a8384(0x156)]({'success':!![]});}}catch(_0x1b1dbb){console[_0x1a8384(0x155)]({'err':_0x1b1dbb}),_0x1ab026['status'](0x1f4)['json']({'error':_0x1a8384(0x16b)});return;}}),router[a1_0x23398b(0x14a)](a1_0x23398b(0x153),upload[a1_0x23398b(0x169)](a1_0x23398b(0x150)),verifyToken,async(_0x49b33f,_0x3c7925,_0x4826a7)=>{const _0x30f56d=a1_0x23398b,{username:_0x10a98b,first_name:_0x22a545,last_name:_0x30264a}=_0x49b33f[_0x30f56d(0x166)],_0x5c28aa=_0x49b33f[_0x30f56d(0x160)][_0x30f56d(0x13f)];let _0x305d9e;try{const [_0x54fe3a]=await conn['promise']()[_0x30f56d(0x168)](_0x30f56d(0x14e),[_0x5c28aa]);_0x54fe3a[_0x30f56d(0x167)]>0x0&&(_0x305d9e=_0x54fe3a[0x0]);}catch(_0x31a947){console[_0x30f56d(0x155)]({'err':_0x31a947}),_0x3c7925['status'](0x1f4)[_0x30f56d(0x156)]({'error':_0x30f56d(0x16b)});return;}if(!_0x305d9e){_0x3c7925[_0x30f56d(0x13c)](0x191)['json']({'error':_0x30f56d(0x177)});return;}console['log']({'req':_0x49b33f[_0x30f56d(0x166)]});let _0x5994ab=_0x305d9e['avatar_url'];if(_0x49b33f[_0x30f56d(0x16c)]){const _0x4c31e1=_0x30f56d(0x13e)+randomUUID()+_0x30f56d(0x15c);fs[_0x30f56d(0x16e)](_0x49b33f[_0x30f56d(0x16c)][_0x30f56d(0x163)],'./'+_0x4c31e1),_0x5994ab=config[_0x30f56d(0x171)]+'/'+_0x4c31e1;}try{await conn[_0x30f56d(0x137)]()[_0x30f56d(0x168)](_0x30f56d(0x149),[_0x10a98b,_0x22a545,_0x30264a,_0x5994ab,_0x5c28aa]);let _0x4d3bae;try{_0x4d3bae=jwt[_0x30f56d(0x142)]({'userId':_0x305d9e['id'],'email':_0x305d9e[_0x30f56d(0x13f)]},config[_0x30f56d(0x158)],{'expiresIn':_0x30f56d(0x15b)});}catch(_0x3fd16b){console[_0x30f56d(0x155)](_0x3fd16b),_0x3c7925[_0x30f56d(0x13c)](0x1f4)[_0x30f56d(0x156)]({'error':_0x30f56d(0x16b)});return;}_0x3c7925[_0x30f56d(0x13c)](0xc8)[_0x30f56d(0x156)]({'success':!![],'data':{'userId':_0x305d9e['id'],'username':_0x10a98b,'first_name':_0x22a545,'last_name':_0x30264a,'email':_0x305d9e[_0x30f56d(0x13f)],'avatar_url':_0x5994ab,'token':_0x4d3bae}});}catch(_0x4e28e0){console[_0x30f56d(0x155)]({'err':_0x4e28e0}),_0x3c7925[_0x30f56d(0x13c)](0x1f4)['json']({'error':_0x30f56d(0x16b)});return;}}),module[a1_0x23398b(0x159)]=router;