const a1_0x429a1e=a1_0x24f5;function a1_0x24f5(_0x426cc1,_0x41b378){const _0x6c725b=a1_0x6c72();return a1_0x24f5=function(_0x24f53f,_0x6a14b6){_0x24f53f=_0x24f53f-0x71;let _0x2b2d0d=_0x6c725b[_0x24f53f];return _0x2b2d0d;},a1_0x24f5(_0x426cc1,_0x41b378);}function a1_0x6c72(){const _0x37c21f=['</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','crypted_password','status','Error!\x20Something\x20went\x20wrong.','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)','sign','<p>Welcome\x20to\x20CADViewer</p>','Invalid\x20validation\x20token','smtpFrom','json','ServerUrl','Invalid\x20user','User\x20already\x20exists','732852KmtEMV','log','last_name','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','hash','execute','crypto','/update-user-info','/update-password','232pLDvJk','insertId','2285qnFQWb','Email\x20validated\x20successfully','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','247330SFriku','.png','enableEmailVerification','promise','avatar','avatar_url','3832318VrByOm','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','74583DRHnXJ','Invalid\x20password','24h','transporter','email','1619823jQZrmS','multer','===================error===================','jwtSecretKey','body','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','/signup','username','express','avatars/','role','message','../CADViewer_config.json','Invalid\x20email\x20or\x20password','user','/login','/validate-email/:token','path','first_name','single','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','length','../libs/mysql.js','679902WPXnYT','jsonwebtoken','exports','stack','params','file','compare','existsSync','Welcome\x20to\x20CADViewer','post','5108ZHlaYp','avatars','./avatars','../libs/jwt','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','verifyToken','renameSync'];a1_0x6c72=function(){return _0x37c21f;};return a1_0x6c72();}(function(_0x3907e4,_0x1c8818){const _0x2bc3eb=a1_0x24f5,_0x4156a6=_0x3907e4();while(!![]){try{const _0x50c95d=parseInt(_0x2bc3eb(0xab))/0x1+-parseInt(_0x2bc3eb(0xb9))/0x2+parseInt(_0x2bc3eb(0x74))/0x3+-parseInt(_0x2bc3eb(0x96))/0x4*(parseInt(_0x2bc3eb(0xb6))/0x5)+parseInt(_0x2bc3eb(0x8c))/0x6+-parseInt(_0x2bc3eb(0xbf))/0x7+-parseInt(_0x2bc3eb(0xb4))/0x8*(-parseInt(_0x2bc3eb(0xc1))/0x9);if(_0x50c95d===_0x1c8818)break;else _0x4156a6['push'](_0x4156a6['shift']());}catch(_0x1cd8c7){_0x4156a6['push'](_0x4156a6['shift']());}}}(a1_0x6c72,0x5abf9));const jwt=require(a1_0x429a1e(0x8d)),bcrypt=require('bcrypt'),config=require(a1_0x429a1e(0x80)),conn=require(a1_0x429a1e(0x8b)),multer=require(a1_0x429a1e(0x75)),fs=require('fs'),verifyToken=require(a1_0x429a1e(0x99))[a1_0x429a1e(0x9c)];!fs[a1_0x429a1e(0x93)]('./avatars')&&fs['mkdirSync'](a1_0x429a1e(0x98));const express=require(a1_0x429a1e(0x7c)),router=express['Router'](),{randomUUID}=require(a1_0x429a1e(0xb1)),storage=multer['diskStorage']({'destination':function(_0x5a8840,_0x1c096f,_0x42190e){const _0x16e1dc=a1_0x429a1e;_0x42190e(null,_0x16e1dc(0x97));}}),upload=multer({'storage':storage});router['post'](a1_0x429a1e(0x83),async(_0x48bfd0,_0x4fff51,_0x4cc933)=>{const _0x48912f=a1_0x429a1e;let {email:_0x45a1bb,password:_0x1cd7e7}=_0x48bfd0[_0x48912f(0x78)];console[_0x48912f(0xac)]({'email':_0x45a1bb,'password':_0x1cd7e7});let _0xbdaca7;try{const [_0xed9062]=await conn[_0x48912f(0xbc)]()[_0x48912f(0xb0)](_0x48912f(0x9b),[_0x45a1bb]);_0xed9062['length']>0x0&&(_0xbdaca7=_0xed9062[0x0]);}catch(_0x25e3f8){console[_0x48912f(0xac)]({'err':_0x25e3f8}),_0x4fff51[_0x48912f(0xa0)](0x1f4)[_0x48912f(0xa7)]({'error':_0x48912f(0xa1)});return;}console['log'](_0xbdaca7),console['log'](_0x1cd7e7),console[_0x48912f(0xac)](_0xbdaca7[_0x48912f(0x9f)]);if(!_0xbdaca7||!await bcrypt[_0x48912f(0x92)](_0x1cd7e7,_0xbdaca7[_0x48912f(0x9f)])){_0x4fff51['status'](0x191)[_0x48912f(0xa7)]({'error':_0x48912f(0x81)});return;}let _0xcf1111;try{_0xcf1111=jwt['sign']({'userId':_0xbdaca7['id'],'email':_0xbdaca7[_0x48912f(0x73)]},config[_0x48912f(0x77)],{'expiresIn':_0x48912f(0x71)});}catch(_0x461d7b){console[_0x48912f(0xac)](_0x461d7b),_0x4fff51[_0x48912f(0xa0)](0x1f4)[_0x48912f(0xa7)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x4fff51['status'](0xc8)[_0x48912f(0xa7)]({'success':!![],'data':{'userId':_0xbdaca7['id'],'username':_0xbdaca7[_0x48912f(0x7b)],'first_name':_0xbdaca7[_0x48912f(0x86)],'last_name':_0xbdaca7[_0x48912f(0xad)],'email':_0xbdaca7[_0x48912f(0x73)],'avatar_url':_0xbdaca7[_0x48912f(0xbe)],'id':_0xbdaca7['id'],'role':_0xbdaca7[_0x48912f(0x7e)],'token':_0xcf1111}});}),router[a1_0x429a1e(0x95)](a1_0x429a1e(0x7a),async(_0x3fec94,_0x285889,_0x5cce59)=>{const _0x271a6d=a1_0x429a1e,{username:_0x2587ef,email:_0x39bfe3,password:_0x4f07e6}=_0x3fec94[_0x271a6d(0x78)],[_0x30d385]=await conn['promise']()[_0x271a6d(0xb0)](_0x271a6d(0xae),[_0x39bfe3]);if(_0x30d385['length']>0x0){_0x285889['status'](0x1a6)[_0x271a6d(0xa7)]({'error':_0x271a6d(0xaa)});return;}const _0x42f860=await bcrypt[_0x271a6d(0xaf)](_0x4f07e6,0xa);let _0xd15691=null,_0xfbaf04=0x1;config['enableEmailVerification']&&(_0xd15691=randomUUID(),_0xfbaf04=0x0);let _0x4fdda7;try{const _0x502bc9=randomUUID(),_0x3cc618='./uploads/'+_0x502bc9;fs['mkdirSync'](_0x3cc618);const [_0x47c647]=await conn['promise']()['execute'](_0x271a6d(0xa2),[_0x2587ef,_0x39bfe3,_0x42f860,'demo_user',_0xfbaf04,_0xd15691,_0x502bc9]);if(_0x47c647[_0x271a6d(0xb5)]){const [_0x4ef86c]=await conn[_0x271a6d(0xbc)]()[_0x271a6d(0xb0)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0x47c647[_0x271a6d(0xb5)]]);_0x4ef86c[_0x271a6d(0x8a)]>0x0&&(_0x4fdda7=_0x4ef86c[0x0]);}}catch{_0x285889[_0x271a6d(0xa0)](0x1f4)[_0x271a6d(0xa7)]({'error':_0x271a6d(0xa1)});return;}let _0x21aaf0;try{_0x21aaf0=jwt[_0x271a6d(0xa3)]({'userId':_0x4fdda7['id'],'email':_0x4fdda7['email']},config['jwtSecretKey'],{'expiresIn':_0x271a6d(0x71)});}catch(_0x403c90){_0x285889[_0x271a6d(0xa0)](0x1f4)[_0x271a6d(0xa7)]({'error':_0x271a6d(0xa1)});return;}const _0x5ea8c5=require('../libs/mail')[_0x271a6d(0x72)];let _0x271065=_0x271a6d(0xa4);if(config[_0x271a6d(0xbb)]){const _0x5dc92d=config['frontendUrl']+'/validate-email/'+_0xd15691;_0x271065=_0x271a6d(0xb8)+_0x5dc92d+_0x271a6d(0x9a)+_0x5dc92d+_0x271a6d(0x9e);const _0x2532ce={'from':config[_0x271a6d(0xa6)],'to':_0x4fdda7[_0x271a6d(0x73)],'subject':_0x271a6d(0x94),'text':_0x271a6d(0x94),'html':_0x271065};try{await _0x5ea8c5['sendMail'](_0x2532ce);}catch(_0x4247aa){console['log'](_0x271a6d(0x76)),console[_0x271a6d(0xac)](_0x4247aa),_0x285889['status'](0x1f4)['json']({'error':_0x271a6d(0x89),'stack':_0x4247aa['stack'],'message':_0x4247aa['message']});return;}_0x285889[_0x271a6d(0xa0)](0xc8)[_0x271a6d(0xa7)]({'success':!![],'message':'Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account'});return;}_0x285889['status'](0xc9)['json']({'success':!![],'data':{'userId':_0x4fdda7['id'],'username':_0x4fdda7['username'],'first_name':_0x4fdda7[_0x271a6d(0x86)],'last_name':_0x4fdda7[_0x271a6d(0xad)],'email':_0x4fdda7[_0x271a6d(0x73)],'avatar_url':_0x4fdda7[_0x271a6d(0xbe)],'id':_0x4fdda7['id'],'role':_0x4fdda7[_0x271a6d(0x7e)],'token':_0x21aaf0,'is_enabled':_0x4fdda7['is_enabled']}});}),router[a1_0x429a1e(0x95)](a1_0x429a1e(0x84),async(_0x8bc276,_0x2eb798)=>{const _0x2d4f6e=a1_0x429a1e;try{const {token:_0x296368}=_0x8bc276[_0x2d4f6e(0x90)],[_0x544ec9]=await conn[_0x2d4f6e(0xbc)]()[_0x2d4f6e(0xb0)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?',[_0x296368]);if(_0x544ec9[_0x2d4f6e(0x8a)]===0x0){_0x2eb798[_0x2d4f6e(0xa0)](0x194)[_0x2d4f6e(0xa7)]({'error':_0x2d4f6e(0xa5)});return;}await conn[_0x2d4f6e(0xbc)]()[_0x2d4f6e(0xb0)](_0x2d4f6e(0x88),[_0x296368]);const _0x3c669f=jwt[_0x2d4f6e(0xa3)]({'id':_0x544ec9[0x0]['id'],'email':_0x544ec9[0x0][_0x2d4f6e(0x73)]},config[_0x2d4f6e(0x77)],{'expiresIn':_0x2d4f6e(0x71)});_0x2eb798[_0x2d4f6e(0xa0)](0xc8)[_0x2d4f6e(0xa7)]({'success':!![],'message':_0x2d4f6e(0xb7),'data':{'userId':_0x544ec9[0x0]['id'],'username':_0x544ec9[0x0]['username'],'first_name':_0x544ec9[0x0]['first_name'],'last_name':_0x544ec9[0x0][_0x2d4f6e(0xad)],'email':_0x544ec9[0x0]['email'],'avatar_url':_0x544ec9[0x0]['avatar_url'],'id':_0x544ec9[0x0]['id'],'role':_0x544ec9[0x0][_0x2d4f6e(0x7e)],'token':_0x3c669f,'is_enabled':0x1}});}catch(_0xe323aa){console['log'](_0x2d4f6e(0x76)),console[_0x2d4f6e(0xac)](_0xe323aa),_0x2eb798[_0x2d4f6e(0xa0)](0x1f4)[_0x2d4f6e(0xa7)]({'error':_0x2d4f6e(0xa1),'stack':_0xe323aa[_0x2d4f6e(0x8f)],'message':_0xe323aa[_0x2d4f6e(0x7f)]});}}),router[a1_0x429a1e(0x95)](a1_0x429a1e(0xb3),verifyToken,async(_0x1f974a,_0x1354e8,_0x221b3c)=>{const _0x7dbf76=a1_0x429a1e,{current_password:_0x431eb9,new_password:_0x2b841f}=_0x1f974a[_0x7dbf76(0x78)];console[_0x7dbf76(0xac)]({'body':_0x1f974a[_0x7dbf76(0x78)]});const _0x201956=_0x1f974a[_0x7dbf76(0x82)][_0x7dbf76(0x73)];let _0x3884b2;try{const [_0x372542]=await conn['promise']()[_0x7dbf76(0xb0)](_0x7dbf76(0xae),[_0x201956]);if(_0x372542[_0x7dbf76(0x8a)]>0x0){_0x3884b2=_0x372542[0x0];if(!await bcrypt[_0x7dbf76(0x92)](_0x431eb9,_0x3884b2[_0x7dbf76(0x9f)])){_0x1354e8[_0x7dbf76(0xa0)](0x191)['json']({'error':_0x7dbf76(0xc2)});return;}const _0x20df33=await bcrypt[_0x7dbf76(0xaf)](_0x2b841f,0xa);await conn[_0x7dbf76(0xbc)]()[_0x7dbf76(0xb0)](_0x7dbf76(0xc0),[_0x20df33,_0x201956]),_0x1354e8[_0x7dbf76(0xa0)](0xc8)[_0x7dbf76(0xa7)]({'success':!![]});}}catch(_0x396020){console[_0x7dbf76(0xac)]({'err':_0x396020}),_0x1354e8['status'](0x1f4)[_0x7dbf76(0xa7)]({'error':_0x7dbf76(0xa1)});return;}}),router[a1_0x429a1e(0x95)](a1_0x429a1e(0xb2),upload[a1_0x429a1e(0x87)](a1_0x429a1e(0xbd)),verifyToken,async(_0x17d741,_0x5e9623,_0x18c5dd)=>{const _0xa03129=a1_0x429a1e,{username:_0x2378d8,first_name:_0x17e59d,last_name:_0x1cdded}=_0x17d741['body'],_0x515cde=_0x17d741[_0xa03129(0x82)][_0xa03129(0x73)];let _0x531026;try{const [_0x451be7]=await conn[_0xa03129(0xbc)]()[_0xa03129(0xb0)](_0xa03129(0xae),[_0x515cde]);_0x451be7[_0xa03129(0x8a)]>0x0&&(_0x531026=_0x451be7[0x0]);}catch(_0x1951f9){console[_0xa03129(0xac)]({'err':_0x1951f9}),_0x5e9623[_0xa03129(0xa0)](0x1f4)[_0xa03129(0xa7)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x531026){_0x5e9623['status'](0x191)[_0xa03129(0xa7)]({'error':_0xa03129(0xa9)});return;}console[_0xa03129(0xac)]({'req':_0x17d741[_0xa03129(0x78)]});let _0x1e5b2a=_0x531026[_0xa03129(0xbe)];if(_0x17d741['file']){const _0x50ecd1=_0xa03129(0x7d)+randomUUID()+_0xa03129(0xba);fs[_0xa03129(0x9d)](_0x17d741[_0xa03129(0x91)][_0xa03129(0x85)],'./'+_0x50ecd1),_0x1e5b2a=config[_0xa03129(0xa8)]+'/'+_0x50ecd1;}try{await conn[_0xa03129(0xbc)]()['execute'](_0xa03129(0x79),[_0x2378d8,_0x17e59d,_0x1cdded,_0x1e5b2a,_0x515cde]);let _0x495725;try{_0x495725=jwt[_0xa03129(0xa3)]({'userId':_0x531026['id'],'email':_0x531026['email']},config[_0xa03129(0x77)],{'expiresIn':_0xa03129(0x71)});}catch(_0x3fddc0){console[_0xa03129(0xac)](_0x3fddc0),_0x5e9623[_0xa03129(0xa0)](0x1f4)['json']({'error':_0xa03129(0xa1)});return;}_0x5e9623[_0xa03129(0xa0)](0xc8)['json']({'success':!![],'data':{'userId':_0x531026['id'],'username':_0x2378d8,'first_name':_0x17e59d,'last_name':_0x1cdded,'email':_0x531026[_0xa03129(0x73)],'avatar_url':_0x1e5b2a,'token':_0x495725}});}catch(_0x3a6303){console[_0xa03129(0xac)]({'err':_0x3a6303}),_0x5e9623['status'](0x1f4)['json']({'error':_0xa03129(0xa1)});return;}}),module[a1_0x429a1e(0x8e)]=router;