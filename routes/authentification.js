const a1_0x3dd8e0=a1_0x5280;(function(_0x7aa07a,_0x17416a){const _0x2c50a7=a1_0x5280,_0x314dcf=_0x7aa07a();while(!![]){try{const _0x362d93=parseInt(_0x2c50a7(0x1b3))/0x1*(-parseInt(_0x2c50a7(0x1d2))/0x2)+-parseInt(_0x2c50a7(0x1ef))/0x3+parseInt(_0x2c50a7(0x1f8))/0x4+parseInt(_0x2c50a7(0x1cf))/0x5*(-parseInt(_0x2c50a7(0x1b5))/0x6)+-parseInt(_0x2c50a7(0x1e4))/0x7+-parseInt(_0x2c50a7(0x1e6))/0x8*(-parseInt(_0x2c50a7(0x1b4))/0x9)+parseInt(_0x2c50a7(0x1f3))/0xa;if(_0x362d93===_0x17416a)break;else _0x314dcf['push'](_0x314dcf['shift']());}catch(_0xfa5327){_0x314dcf['push'](_0x314dcf['shift']());}}}(a1_0x296f,0x21ef2));function a1_0x5280(_0x386c11,_0x27cd7d){const _0x296f86=a1_0x296f();return a1_0x5280=function(_0x5280aa,_0x41ce77){_0x5280aa=_0x5280aa-0x1a9;let _0x2585e1=_0x296f86[_0x5280aa];return _0x2585e1;},a1_0x5280(_0x386c11,_0x27cd7d);}const jwt=require(a1_0x3dd8e0(0x1e9)),bcrypt=require(a1_0x3dd8e0(0x1aa)),config=require(a1_0x3dd8e0(0x1b8)),conn=require(a1_0x3dd8e0(0x1ce)),multer=require(a1_0x3dd8e0(0x1ed)),fs=require('fs'),verifyToken=require(a1_0x3dd8e0(0x1c7))['verifyToken'];!fs[a1_0x3dd8e0(0x1d6)](a1_0x3dd8e0(0x1d0))&&fs[a1_0x3dd8e0(0x1d1)](a1_0x3dd8e0(0x1d0));const express=require(a1_0x3dd8e0(0x1be)),router=express['Router'](),{randomUUID}=require(a1_0x3dd8e0(0x1d5)),storage=multer['diskStorage']({'destination':function(_0x259dd6,_0x347ced,_0x4afadc){const _0x1ae484=a1_0x3dd8e0;_0x4afadc(null,_0x1ae484(0x1d3));}}),upload=multer({'storage':storage});function a1_0x296f(){const _0x2ae102=['\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','transporter','24h','sendMail','execute','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','body','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','/signup','Welcome\x20to\x20CADViewer','path','User\x20already\x20exists','hash','1859011dlEPUm','length','32cxtAWp','params','/validate-email/:token','jsonwebtoken','Email\x20sent:\x20','/update-user-info','renameSync','multer','Invalid\x20validation\x20token','476409QbQerb','username','role','email','7362160rpXfkf','file','<p>Welcome\x20to\x20CADViewer</p>','jwtSecretKey','enableEmailVerification','465172keZRNC','exports','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','bcrypt','last_name','first_name','sign','post','crypted_password','Invalid\x20password','../libs/mail','ServerUrl','103ctqlcj','92133xYGWQS','6tnDKBP','/validate-email/','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','../CADViewer_config.json','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)','promise','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL\x20WHERE\x20`validation_token`\x20=\x20?','avatar_url','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','express','.png','avatar','Email\x20validated\x20successfully','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','status','smtpFrom','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','../libs/jwt','is_enabled','json','Error!\x20Something\x20went\x20wrong.','compare','log','insertId','../libs/mysql.js','565330TpkmfL','./avatars','mkdirSync','4214NeDFyK','avatars','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','crypto','existsSync'];a1_0x296f=function(){return _0x2ae102;};return a1_0x296f();}router[a1_0x3dd8e0(0x1ae)]('/login',async(_0x8380f6,_0x2af23b,_0x1d5758)=>{const _0x3e27d5=a1_0x3dd8e0;let {email:_0x3d0b82,password:_0x36ec9c}=_0x8380f6[_0x3e27d5(0x1dd)];console[_0x3e27d5(0x1cc)]({'email':_0x3d0b82,'password':_0x36ec9c});let _0x4bfe89;try{const [_0x3f49ef]=await conn[_0x3e27d5(0x1ba)]()['execute'](_0x3e27d5(0x1a9),[_0x3d0b82]);_0x3f49ef['length']>0x0&&(_0x4bfe89=_0x3f49ef[0x0]);}catch(_0x152a88){console[_0x3e27d5(0x1cc)]({'err':_0x152a88}),_0x2af23b[_0x3e27d5(0x1c4)](0x1f4)[_0x3e27d5(0x1c9)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}console['log'](_0x4bfe89),console[_0x3e27d5(0x1cc)](_0x36ec9c),console['log'](_0x4bfe89[_0x3e27d5(0x1af)]);if(!_0x4bfe89||!await bcrypt[_0x3e27d5(0x1cb)](_0x36ec9c,_0x4bfe89[_0x3e27d5(0x1af)])){_0x2af23b['status'](0x191)[_0x3e27d5(0x1c9)]({'error':'Invalid\x20email\x20or\x20password'});return;}let _0x49c3c0;try{_0x49c3c0=jwt[_0x3e27d5(0x1ad)]({'userId':_0x4bfe89['id'],'email':_0x4bfe89['email']},config['jwtSecretKey'],{'expiresIn':_0x3e27d5(0x1d9)});}catch(_0x41f43c){console[_0x3e27d5(0x1cc)](_0x41f43c),_0x2af23b[_0x3e27d5(0x1c4)](0x1f4)[_0x3e27d5(0x1c9)]({'error':_0x3e27d5(0x1ca)});return;}_0x2af23b[_0x3e27d5(0x1c4)](0xc8)[_0x3e27d5(0x1c9)]({'success':!![],'data':{'userId':_0x4bfe89['id'],'username':_0x4bfe89[_0x3e27d5(0x1f0)],'first_name':_0x4bfe89[_0x3e27d5(0x1ac)],'last_name':_0x4bfe89[_0x3e27d5(0x1ab)],'email':_0x4bfe89[_0x3e27d5(0x1f2)],'avatar_url':_0x4bfe89[_0x3e27d5(0x1bc)],'id':_0x4bfe89['id'],'role':_0x4bfe89[_0x3e27d5(0x1f1)],'token':_0x49c3c0}});}),router['post'](a1_0x3dd8e0(0x1df),async(_0x254de4,_0x1cebcb,_0x3bc78a)=>{const _0x3b428b=a1_0x3dd8e0,{username:_0x2e6675,email:_0x1ced95,password:_0x342be0}=_0x254de4[_0x3b428b(0x1dd)],[_0x29c6d9]=await conn[_0x3b428b(0x1ba)]()[_0x3b428b(0x1db)](_0x3b428b(0x1de),[_0x1ced95]);if(_0x29c6d9['length']>0x0){_0x1cebcb['status'](0x1a6)[_0x3b428b(0x1c9)]({'error':_0x3b428b(0x1e2)});return;}const _0x262a41=await bcrypt[_0x3b428b(0x1e3)](_0x342be0,0xa);let _0x10e70e=null,_0x4d324c=0x1;config[_0x3b428b(0x1f7)]&&(_0x10e70e=randomUUID(),_0x4d324c=0x0);let _0x1f7571;try{const [_0x3d12fd]=await conn[_0x3b428b(0x1ba)]()[_0x3b428b(0x1db)](_0x3b428b(0x1b9),[_0x2e6675,_0x1ced95,_0x262a41,'user',_0x4d324c,_0x10e70e]);if(_0x3d12fd['insertId']){const [_0x2a7b6f]=await conn[_0x3b428b(0x1ba)]()['execute'](_0x3b428b(0x1b7),[_0x3d12fd[_0x3b428b(0x1cd)]]);_0x2a7b6f[_0x3b428b(0x1e5)]>0x0&&(_0x1f7571=_0x2a7b6f[0x0]);}}catch{_0x1cebcb[_0x3b428b(0x1c4)](0x1f4)[_0x3b428b(0x1c9)]({'error':_0x3b428b(0x1ca)});return;}let _0x42135f;try{_0x42135f=jwt['sign']({'userId':_0x1f7571['id'],'email':_0x1f7571[_0x3b428b(0x1f2)]},config[_0x3b428b(0x1f6)],{'expiresIn':_0x3b428b(0x1d9)});}catch(_0x183ef7){_0x1cebcb['status'](0x1f4)[_0x3b428b(0x1c9)]({'error':_0x3b428b(0x1ca)});return;}const _0x17df23=require(_0x3b428b(0x1b1))[_0x3b428b(0x1d8)];let _0x220552=_0x3b428b(0x1f5);if(config[_0x3b428b(0x1f7)]){const _0x35df9c=config['frontendUrl']+_0x3b428b(0x1b6)+_0x10e70e;_0x220552=_0x3b428b(0x1d7)+_0x35df9c+_0x3b428b(0x1c3)+_0x35df9c+_0x3b428b(0x1d4);const _0x14e0aa={'from':config[_0x3b428b(0x1c5)],'to':_0x1f7571[_0x3b428b(0x1f2)],'subject':'Welcome\x20to\x20CADViewer','text':_0x3b428b(0x1e0),'html':_0x220552};_0x17df23[_0x3b428b(0x1da)](_0x14e0aa,(_0x2b0bbc,_0x3ae021)=>{const _0x1b6524=_0x3b428b;_0x2b0bbc?console['log'](_0x2b0bbc):console[_0x1b6524(0x1cc)](_0x1b6524(0x1ea)+_0x3ae021['response']);}),_0x1cebcb[_0x3b428b(0x1c4)](0xc8)[_0x3b428b(0x1c9)]({'success':!![],'message':_0x3b428b(0x1c2)});return;}_0x1cebcb[_0x3b428b(0x1c4)](0xc9)[_0x3b428b(0x1c9)]({'success':!![],'data':{'userId':_0x1f7571['id'],'username':_0x1f7571['username'],'first_name':_0x1f7571[_0x3b428b(0x1ac)],'last_name':_0x1f7571[_0x3b428b(0x1ab)],'email':_0x1f7571[_0x3b428b(0x1f2)],'avatar_url':_0x1f7571['avatar_url'],'id':_0x1f7571['id'],'role':_0x1f7571[_0x3b428b(0x1f1)],'token':_0x42135f,'is_enabled':_0x1f7571[_0x3b428b(0x1c8)]}});}),router[a1_0x3dd8e0(0x1ae)](a1_0x3dd8e0(0x1e8),async(_0x2b0c6e,_0x30c3e0)=>{const _0x4a53ae=a1_0x3dd8e0;try{const {token:_0x250240}=_0x2b0c6e[_0x4a53ae(0x1e7)],[_0x2057f8]=await conn[_0x4a53ae(0x1ba)]()[_0x4a53ae(0x1db)](_0x4a53ae(0x1c6),[_0x250240]);if(_0x2057f8[_0x4a53ae(0x1e5)]===0x0){_0x30c3e0[_0x4a53ae(0x1c4)](0x194)['json']({'error':_0x4a53ae(0x1ee)});return;}await conn[_0x4a53ae(0x1ba)]()[_0x4a53ae(0x1db)](_0x4a53ae(0x1bb),[_0x250240]);const _0x3228a9=jwt[_0x4a53ae(0x1ad)]({'id':_0x2057f8[0x0]['id'],'email':_0x2057f8[0x0][_0x4a53ae(0x1f2)]},config[_0x4a53ae(0x1f6)],{'expiresIn':_0x4a53ae(0x1d9)});_0x30c3e0[_0x4a53ae(0x1c4)](0xc8)[_0x4a53ae(0x1c9)]({'success':!![],'message':_0x4a53ae(0x1c1),'data':{'userId':_0x2057f8[0x0]['id'],'username':_0x2057f8[0x0]['username'],'first_name':_0x2057f8[0x0]['first_name'],'last_name':_0x2057f8[0x0][_0x4a53ae(0x1ab)],'email':_0x2057f8[0x0]['email'],'avatar_url':_0x2057f8[0x0][_0x4a53ae(0x1bc)],'id':_0x2057f8[0x0]['id'],'role':_0x2057f8[0x0][_0x4a53ae(0x1f1)],'token':_0x3228a9,'is_enabled':0x1}});}catch(_0x70736c){console[_0x4a53ae(0x1cc)](_0x70736c),_0x30c3e0[_0x4a53ae(0x1c4)](0x1f4)[_0x4a53ae(0x1c9)]({'error':_0x4a53ae(0x1ca)});}}),router[a1_0x3dd8e0(0x1ae)]('/update-password',verifyToken,async(_0x43c661,_0x3bb628,_0x24588d)=>{const _0x19c6ae=a1_0x3dd8e0,{current_password:_0xe330cb,new_password:_0xd5b867}=_0x43c661[_0x19c6ae(0x1dd)];console[_0x19c6ae(0x1cc)]({'body':_0x43c661['body']});const _0xa6c218=_0x43c661['user'][_0x19c6ae(0x1f2)];let _0x238c80;try{const [_0x280d91]=await conn[_0x19c6ae(0x1ba)]()[_0x19c6ae(0x1db)](_0x19c6ae(0x1de),[_0xa6c218]);if(_0x280d91[_0x19c6ae(0x1e5)]>0x0){_0x238c80=_0x280d91[0x0];if(!await bcrypt[_0x19c6ae(0x1cb)](_0xe330cb,_0x238c80[_0x19c6ae(0x1af)])){_0x3bb628[_0x19c6ae(0x1c4)](0x191)['json']({'error':_0x19c6ae(0x1b0)});return;}const _0x574a33=await bcrypt['hash'](_0xd5b867,0xa);await conn['promise']()[_0x19c6ae(0x1db)](_0x19c6ae(0x1dc),[_0x574a33,_0xa6c218]),_0x3bb628['status'](0xc8)['json']({'success':!![]});}}catch(_0x8bd63a){console['log']({'err':_0x8bd63a}),_0x3bb628['status'](0x1f4)['json']({'error':_0x19c6ae(0x1ca)});return;}}),router[a1_0x3dd8e0(0x1ae)](a1_0x3dd8e0(0x1eb),upload['single'](a1_0x3dd8e0(0x1c0)),verifyToken,async(_0x1aa24b,_0x5da8fc,_0x139157)=>{const _0x1100da=a1_0x3dd8e0,{username:_0x3e0b08,first_name:_0x130236,last_name:_0x23c267}=_0x1aa24b[_0x1100da(0x1dd)],_0x3f1ad0=_0x1aa24b['user']['email'];let _0x583dbf;try{const [_0x375c81]=await conn[_0x1100da(0x1ba)]()[_0x1100da(0x1db)](_0x1100da(0x1de),[_0x3f1ad0]);_0x375c81['length']>0x0&&(_0x583dbf=_0x375c81[0x0]);}catch(_0x1d246b){console[_0x1100da(0x1cc)]({'err':_0x1d246b}),_0x5da8fc[_0x1100da(0x1c4)](0x1f4)[_0x1100da(0x1c9)]({'error':_0x1100da(0x1ca)});return;}if(!_0x583dbf){_0x5da8fc[_0x1100da(0x1c4)](0x191)[_0x1100da(0x1c9)]({'error':'Invalid\x20user'});return;}console[_0x1100da(0x1cc)]({'req':_0x1aa24b[_0x1100da(0x1dd)]});let _0x101a2a=_0x583dbf[_0x1100da(0x1bc)];if(_0x1aa24b[_0x1100da(0x1f4)]){const _0x22d1d6='avatars/'+randomUUID()+_0x1100da(0x1bf);fs[_0x1100da(0x1ec)](_0x1aa24b[_0x1100da(0x1f4)][_0x1100da(0x1e1)],'./'+_0x22d1d6),_0x101a2a=config[_0x1100da(0x1b2)]+'/'+_0x22d1d6;}try{await conn[_0x1100da(0x1ba)]()[_0x1100da(0x1db)](_0x1100da(0x1bd),[_0x3e0b08,_0x130236,_0x23c267,_0x101a2a,_0x3f1ad0]);let _0x49f665;try{_0x49f665=jwt[_0x1100da(0x1ad)]({'userId':_0x583dbf['id'],'email':_0x583dbf[_0x1100da(0x1f2)]},config[_0x1100da(0x1f6)],{'expiresIn':_0x1100da(0x1d9)});}catch(_0x59e117){console[_0x1100da(0x1cc)](_0x59e117),_0x5da8fc[_0x1100da(0x1c4)](0x1f4)[_0x1100da(0x1c9)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x5da8fc[_0x1100da(0x1c4)](0xc8)[_0x1100da(0x1c9)]({'success':!![],'data':{'userId':_0x583dbf['id'],'username':_0x3e0b08,'first_name':_0x130236,'last_name':_0x23c267,'email':_0x583dbf[_0x1100da(0x1f2)],'avatar_url':_0x101a2a,'token':_0x49f665}});}catch(_0x36030e){console[_0x1100da(0x1cc)]({'err':_0x36030e}),_0x5da8fc[_0x1100da(0x1c4)](0x1f4)[_0x1100da(0x1c9)]({'error':_0x1100da(0x1ca)});return;}}),module[a1_0x3dd8e0(0x1f9)]=router;