const a1_0x53c6ff=a1_0x3234;(function(_0x149f0f,_0x4bb937){const _0x31dbb4=a1_0x3234,_0x27484a=_0x149f0f();while(!![]){try{const _0x59db0c=parseInt(_0x31dbb4(0x174))/0x1+parseInt(_0x31dbb4(0x16e))/0x2+-parseInt(_0x31dbb4(0x18b))/0x3*(-parseInt(_0x31dbb4(0x175))/0x4)+-parseInt(_0x31dbb4(0x1a1))/0x5+parseInt(_0x31dbb4(0x190))/0x6+-parseInt(_0x31dbb4(0x176))/0x7*(-parseInt(_0x31dbb4(0x16d))/0x8)+-parseInt(_0x31dbb4(0x19a))/0x9;if(_0x59db0c===_0x4bb937)break;else _0x27484a['push'](_0x27484a['shift']());}catch(_0x64679){_0x27484a['push'](_0x27484a['shift']());}}}(a1_0x3378,0x4306c));const jwt=require(a1_0x53c6ff(0x194)),bcrypt=require(a1_0x53c6ff(0x184)),config=require('../CADViewer_config.json'),conn=require(a1_0x53c6ff(0x19f)),multer=require('multer'),fs=require('fs'),verifyToken=require('../libs/jwt')[a1_0x53c6ff(0x195)];!fs['existsSync'](a1_0x53c6ff(0x193))&&fs['mkdirSync']('./avatars');function a1_0x3378(){const _0x3d5ea6=['first_name','avatar_url','is_enabled','Error!\x20Something\x20went\x20wrong.','smtpFrom','mkdirSync','frontendUrl','express','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','json','unlinkSync','post','status','log','transporter','../libs/mail','avatar','24h','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','.png','avatars/','===================error===================','48ZkTXVY','113178CbsVnQ','hash','promise','user','jwtSecretKey','path','189577bBEaSX','4QPYmdF','442064nsPMpC','file','enableEmailVerification','message','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','insertId','User\x20already\x20exists','/validate-email/:token','username','crypto','crypted_password','demo_user','length','bcrypt','exports','last_name','Invalid\x20validation\x20token','single','body','copyFileSync','1391487jzahQL','Welcome\x20to\x20CADViewer','email','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','./uploads/','929244grZeXt','stack','Invalid\x20password','./avatars','jsonwebtoken','verifyToken','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','ServerUrl','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','5794776wIrNAn','execute','Invalid\x20user','compare','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','../libs/mysql.js','Email\x20validated\x20successfully','1626885IcLTOk','role','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','/update-password','Router','sendMail','/login','sign'];a1_0x3378=function(){return _0x3d5ea6;};return a1_0x3378();}const express=require(a1_0x53c6ff(0x1b0)),router=express[a1_0x53c6ff(0x1a5)](),{randomUUID}=require(a1_0x53c6ff(0x180)),storage=multer['diskStorage']({'destination':function(_0xf819f2,_0x1edcf1,_0x42a47d){_0x42a47d(null,'avatars');}}),upload=multer({'storage':storage});function a1_0x3234(_0x482b3c,_0x3e8194){const _0x3378e4=a1_0x3378();return a1_0x3234=function(_0x32347e,_0x454bc9){_0x32347e=_0x32347e-0x168;let _0x199af8=_0x3378e4[_0x32347e];return _0x199af8;},a1_0x3234(_0x482b3c,_0x3e8194);}router[a1_0x53c6ff(0x1b4)](a1_0x53c6ff(0x1a7),async(_0x46a7a1,_0x599973,_0x183ba0)=>{const _0x723452=a1_0x53c6ff;let {email:_0x4ab299,password:_0x26906d}=_0x46a7a1[_0x723452(0x189)];console[_0x723452(0x1b6)]({'email':_0x4ab299,'password':_0x26906d});let _0x150374;try{const [_0x2ae1ea]=await conn[_0x723452(0x170)]()[_0x723452(0x19b)](_0x723452(0x19e),[_0x4ab299]);_0x2ae1ea['length']>0x0&&(_0x150374=_0x2ae1ea[0x0]);}catch(_0x4468bb){console[_0x723452(0x1b6)]({'err':_0x4468bb}),_0x599973[_0x723452(0x1b5)](0x1f4)[_0x723452(0x1b2)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x150374||!await bcrypt['compare'](_0x26906d,_0x150374?.[_0x723452(0x181)])){_0x599973[_0x723452(0x1b5)](0x191)[_0x723452(0x1b2)]({'error':'Invalid\x20email\x20or\x20password'});return;}let _0xcda1b8;try{_0xcda1b8=jwt['sign']({'userId':_0x150374['id'],'email':_0x150374[_0x723452(0x18d)]},config[_0x723452(0x172)],{'expiresIn':_0x723452(0x168)});}catch(_0x2d3f03){console[_0x723452(0x1b6)](_0x2d3f03),_0x599973[_0x723452(0x1b5)](0x1f4)[_0x723452(0x1b2)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x599973['status'](0xc8)['json']({'success':!![],'data':{'userId':_0x150374['id'],'username':_0x150374['username'],'first_name':_0x150374[_0x723452(0x1a9)],'last_name':_0x150374['last_name'],'email':_0x150374[_0x723452(0x18d)],'avatar_url':_0x150374['avatar_url'],'id':_0x150374['id'],'role':_0x150374[_0x723452(0x1a2)],'token':_0xcda1b8}});}),router[a1_0x53c6ff(0x1b4)]('/signup',async(_0x3fe47b,_0x341f7a,_0x2f71d8)=>{const _0x284fbc=a1_0x53c6ff,{username:_0x185f93,email:_0x322fa9,password:_0xfc6563}=_0x3fe47b[_0x284fbc(0x189)],[_0x310a33]=await conn[_0x284fbc(0x170)]()[_0x284fbc(0x19b)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x322fa9]);if(_0x310a33['length']>0x0){_0x341f7a['status'](0x1a6)[_0x284fbc(0x1b2)]({'error':_0x284fbc(0x17d)});return;}const _0x2e974f=await bcrypt[_0x284fbc(0x16f)](_0xfc6563,0xa);let _0x4418ac=null,_0x57d365=0x1;config[_0x284fbc(0x178)]&&(_0x4418ac=randomUUID(),_0x57d365=0x0);let _0x4b711b;try{const _0x1b5dd9=randomUUID(),_0x222ff9=_0x284fbc(0x18f)+_0x1b5dd9;fs[_0x284fbc(0x1ae)](_0x222ff9);const [_0xdb57bc]=await conn[_0x284fbc(0x170)]()['execute'](_0x284fbc(0x196),[_0x185f93,_0x322fa9,_0x2e974f,_0x284fbc(0x182),_0x57d365,_0x4418ac,_0x1b5dd9]);if(_0xdb57bc['insertId']){const [_0x1b41dd]=await conn[_0x284fbc(0x170)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0xdb57bc[_0x284fbc(0x17c)]]);_0x1b41dd[_0x284fbc(0x183)]>0x0&&(_0x4b711b=_0x1b41dd[0x0]);}}catch{_0x341f7a[_0x284fbc(0x1b5)](0x1f4)[_0x284fbc(0x1b2)]({'error':_0x284fbc(0x1ac)});return;}let _0x57886d;try{_0x57886d=jwt[_0x284fbc(0x1a8)]({'userId':_0x4b711b['id'],'email':_0x4b711b[_0x284fbc(0x18d)]},config[_0x284fbc(0x172)],{'expiresIn':'24h'});}catch(_0x2f55c5){_0x341f7a['status'](0x1f4)[_0x284fbc(0x1b2)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}const _0x4ece65=require(_0x284fbc(0x1b8))[_0x284fbc(0x1b7)];let _0x34905c='<p>Welcome\x20to\x20CADViewer</p>';if(config['enableEmailVerification']){const _0x2b2866=config[_0x284fbc(0x1af)]+'/validate-email/'+_0x4418ac;_0x34905c=_0x284fbc(0x197)+_0x2b2866+'\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>'+_0x2b2866+_0x284fbc(0x1b1);const _0x2fcff2={'from':config[_0x284fbc(0x1ad)],'to':_0x4b711b[_0x284fbc(0x18d)],'subject':_0x284fbc(0x18c),'text':_0x284fbc(0x18c),'html':_0x34905c};try{await _0x4ece65[_0x284fbc(0x1a6)](_0x2fcff2);}catch(_0x3d606f){console[_0x284fbc(0x1b6)](_0x284fbc(0x16c)),console[_0x284fbc(0x1b6)](_0x3d606f),_0x341f7a[_0x284fbc(0x1b5)](0x1f4)['json']({'error':_0x284fbc(0x199),'stack':_0x3d606f[_0x284fbc(0x191)],'message':_0x3d606f[_0x284fbc(0x179)]});return;}_0x341f7a[_0x284fbc(0x1b5)](0xc8)['json']({'success':!![],'message':_0x284fbc(0x17a)});return;}_0x341f7a[_0x284fbc(0x1b5)](0xc9)[_0x284fbc(0x1b2)]({'success':!![],'data':{'userId':_0x4b711b['id'],'username':_0x4b711b[_0x284fbc(0x17f)],'first_name':_0x4b711b[_0x284fbc(0x1a9)],'last_name':_0x4b711b['last_name'],'email':_0x4b711b[_0x284fbc(0x18d)],'avatar_url':_0x4b711b[_0x284fbc(0x1aa)],'id':_0x4b711b['id'],'role':_0x4b711b[_0x284fbc(0x1a2)],'token':_0x57886d,'is_enabled':_0x4b711b[_0x284fbc(0x1ab)]}});}),router['post'](a1_0x53c6ff(0x17e),async(_0x2797cd,_0x1dc8a7)=>{const _0x4fe0fe=a1_0x53c6ff;try{const {token:_0xdd79d}=_0x2797cd['params'],[_0x43e14b]=await conn[_0x4fe0fe(0x170)]()[_0x4fe0fe(0x19b)](_0x4fe0fe(0x18e),[_0xdd79d]);if(_0x43e14b['length']===0x0){_0x1dc8a7['status'](0x194)['json']({'error':_0x4fe0fe(0x187)});return;}await conn[_0x4fe0fe(0x170)]()[_0x4fe0fe(0x19b)](_0x4fe0fe(0x17b),[_0xdd79d]);const _0x31bfe6=jwt[_0x4fe0fe(0x1a8)]({'id':_0x43e14b[0x0]['id'],'email':_0x43e14b[0x0]['email']},config['jwtSecretKey'],{'expiresIn':_0x4fe0fe(0x168)});_0x1dc8a7[_0x4fe0fe(0x1b5)](0xc8)['json']({'success':!![],'message':_0x4fe0fe(0x1a0),'data':{'userId':_0x43e14b[0x0]['id'],'username':_0x43e14b[0x0][_0x4fe0fe(0x17f)],'first_name':_0x43e14b[0x0][_0x4fe0fe(0x1a9)],'last_name':_0x43e14b[0x0][_0x4fe0fe(0x186)],'email':_0x43e14b[0x0]['email'],'avatar_url':_0x43e14b[0x0][_0x4fe0fe(0x1aa)],'id':_0x43e14b[0x0]['id'],'role':_0x43e14b[0x0][_0x4fe0fe(0x1a2)],'token':_0x31bfe6,'is_enabled':0x1}});}catch(_0x22a2d0){console[_0x4fe0fe(0x1b6)](_0x4fe0fe(0x16c)),console[_0x4fe0fe(0x1b6)](_0x22a2d0),_0x1dc8a7[_0x4fe0fe(0x1b5)](0x1f4)[_0x4fe0fe(0x1b2)]({'error':'Error!\x20Something\x20went\x20wrong.','stack':_0x22a2d0[_0x4fe0fe(0x191)],'message':_0x22a2d0['message']});}}),router['post'](a1_0x53c6ff(0x1a4),verifyToken,async(_0x4b2006,_0x22b495,_0x19f805)=>{const _0xedfa8d=a1_0x53c6ff,{current_password:_0x547dae,new_password:_0x530417}=_0x4b2006[_0xedfa8d(0x189)];console[_0xedfa8d(0x1b6)]({'body':_0x4b2006[_0xedfa8d(0x189)]});const _0x3a0ad7=_0x4b2006[_0xedfa8d(0x171)][_0xedfa8d(0x18d)];let _0x2e2f00;try{const [_0x50989a]=await conn[_0xedfa8d(0x170)]()[_0xedfa8d(0x19b)](_0xedfa8d(0x169),[_0x3a0ad7]);if(_0x50989a[_0xedfa8d(0x183)]>0x0){_0x2e2f00=_0x50989a[0x0];if(!await bcrypt[_0xedfa8d(0x19d)](_0x547dae,_0x2e2f00[_0xedfa8d(0x181)])){_0x22b495[_0xedfa8d(0x1b5)](0x191)[_0xedfa8d(0x1b2)]({'error':_0xedfa8d(0x192)});return;}const _0x539c37=await bcrypt[_0xedfa8d(0x16f)](_0x530417,0xa);await conn[_0xedfa8d(0x170)]()[_0xedfa8d(0x19b)](_0xedfa8d(0x1a3),[_0x539c37,_0x3a0ad7]),_0x22b495[_0xedfa8d(0x1b5)](0xc8)[_0xedfa8d(0x1b2)]({'success':!![]});}}catch(_0x384461){console[_0xedfa8d(0x1b6)]({'err':_0x384461}),_0x22b495[_0xedfa8d(0x1b5)](0x1f4)[_0xedfa8d(0x1b2)]({'error':_0xedfa8d(0x1ac)});return;}}),router[a1_0x53c6ff(0x1b4)]('/update-user-info',upload[a1_0x53c6ff(0x188)](a1_0x53c6ff(0x1b9)),verifyToken,async(_0x297fc2,_0x263bf5,_0x56ce25)=>{const _0x277529=a1_0x53c6ff,{username:_0x362801,first_name:_0x10214c,last_name:_0x46c874}=_0x297fc2[_0x277529(0x189)],_0x1cbfdc=_0x297fc2[_0x277529(0x171)]['email'];let _0x3979ab;try{const [_0xbfc548]=await conn[_0x277529(0x170)]()[_0x277529(0x19b)](_0x277529(0x169),[_0x1cbfdc]);_0xbfc548[_0x277529(0x183)]>0x0&&(_0x3979ab=_0xbfc548[0x0]);}catch(_0x11fefe){console['log']({'err':_0x11fefe}),_0x263bf5[_0x277529(0x1b5)](0x1f4)[_0x277529(0x1b2)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x3979ab){_0x263bf5['status'](0x191)[_0x277529(0x1b2)]({'error':_0x277529(0x19c)});return;}console['log']({'req':_0x297fc2[_0x277529(0x189)]});let _0x58639f=_0x3979ab[_0x277529(0x1aa)];if(_0x297fc2[_0x277529(0x177)]){const _0x37ae89=_0x277529(0x16b)+randomUUID()+_0x277529(0x16a);fs[_0x277529(0x18a)](_0x297fc2[_0x277529(0x177)][_0x277529(0x173)],'./'+_0x37ae89),fs[_0x277529(0x1b3)](_0x297fc2[_0x277529(0x177)][_0x277529(0x173)]),_0x58639f=config[_0x277529(0x198)]+'/'+_0x37ae89;}try{await conn[_0x277529(0x170)]()[_0x277529(0x19b)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x362801,_0x10214c,_0x46c874,_0x58639f,_0x1cbfdc]);let _0x30dd42;try{_0x30dd42=jwt[_0x277529(0x1a8)]({'userId':_0x3979ab['id'],'email':_0x3979ab['email']},config[_0x277529(0x172)],{'expiresIn':_0x277529(0x168)});}catch(_0x58f8db){console['log'](_0x58f8db),_0x263bf5['status'](0x1f4)['json']({'error':_0x277529(0x1ac)});return;}_0x263bf5['status'](0xc8)[_0x277529(0x1b2)]({'success':!![],'data':{'userId':_0x3979ab['id'],'username':_0x362801,'first_name':_0x10214c,'last_name':_0x46c874,'email':_0x3979ab[_0x277529(0x18d)],'avatar_url':_0x58639f,'token':_0x30dd42}});}catch(_0x113a4d){console[_0x277529(0x1b6)]({'err':_0x113a4d}),_0x263bf5[_0x277529(0x1b5)](0x1f4)[_0x277529(0x1b2)]({'error':_0x277529(0x1ac)});return;}}),module[a1_0x53c6ff(0x185)]=router;