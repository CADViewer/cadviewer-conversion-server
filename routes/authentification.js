function a1_0x72fb(){const _0x17c1b9=['length','log','compare','24h','/update-password','4nIbkXZ','crypted_password','Error\x20parsing\x20geolocation\x20data:','avatars/','express','user','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','city','../libs/jwt','Email\x20validated\x20successfully','file','===================error===================','body','first_name','avatars','Router','languages','jwtSecretKey','promise','336759WtujId','single','./avatars','/validate-email/:token','verifyToken','status','/login','3792380uVYmIc','Error!\x20Something\x20went\x20wrong.','callbackMethod_gatewayUrl','last_name','2DKxrVA','/signup','email','callbackMethod_gatewayUrl_flag','is_enabled','insertId','post','time_zone','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','Invalid\x20validation\x20token','/update-user-info','506425yfRRqp','./uploads/','Invalid\x20email\x20or\x20password','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','151648XSpbQn','mkdirSync','171mRQgeS','json','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','role','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','code','country_name','hash','bcrypt','message','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','avatar','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','multer','path','6382523qgxrTu','avatar_url','../libs/email-utils','enableEmailVerification','name','Invalid\x20password','username','User\x20already\x20exists','region','execute','params','crypto','Error\x20during\x20user\x20creation:','1076282fIEfqg','stack','ServerUrl','sign','1808178GySBkb'];a1_0x72fb=function(){return _0x17c1b9;};return a1_0x72fb();}const a1_0x1831c0=a1_0x5b5e;function a1_0x5b5e(_0x3b942e,_0x2a20fe){const _0x72fb90=a1_0x72fb();return a1_0x5b5e=function(_0x5b5efc,_0x22dc26){_0x5b5efc=_0x5b5efc-0x1d7;let _0x214cc0=_0x72fb90[_0x5b5efc];return _0x214cc0;},a1_0x5b5e(_0x3b942e,_0x2a20fe);}(function(_0x368878,_0x43dbfd){const _0x3bb846=a1_0x5b5e,_0x1124f=_0x368878();while(!![]){try{const _0x3bf0e8=-parseInt(_0x3bb846(0x210))/0x1*(-parseInt(_0x3bb846(0x1e3))/0x2)+parseInt(_0x3bb846(0x1d8))/0x3*(parseInt(_0x3bb846(0x21a))/0x4)+parseInt(_0x3bb846(0x1ee))/0x5+-parseInt(_0x3bb846(0x214))/0x6+-parseInt(_0x3bb846(0x203))/0x7+parseInt(_0x3bb846(0x1f2))/0x8*(parseInt(_0x3bb846(0x1f4))/0x9)+parseInt(_0x3bb846(0x1df))/0xa;if(_0x3bf0e8===_0x43dbfd)break;else _0x1124f['push'](_0x1124f['shift']());}catch(_0x45b7dc){_0x1124f['push'](_0x1124f['shift']());}}}(a1_0x72fb,0xc73c6));const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x1831c0(0x1fc)),config=require('../CADViewer_config.json'),conn=require('../libs/mysql.js'),multer=require(a1_0x1831c0(0x201)),fs=require('fs'),verifyToken=require(a1_0x1831c0(0x222))[a1_0x1831c0(0x1dc)],{sendWelcomeEmail}=require(a1_0x1831c0(0x205));!fs['existsSync'](a1_0x1831c0(0x1da))&&fs[a1_0x1831c0(0x1f3)](a1_0x1831c0(0x1da));const express=require(a1_0x1831c0(0x21e)),router=express[a1_0x1831c0(0x229)](),{randomUUID}=require(a1_0x1831c0(0x20e)),storage=multer['diskStorage']({'destination':function(_0x1604ef,_0x322b05,_0x4f2c6b){const _0x160c92=a1_0x1831c0;_0x4f2c6b(null,_0x160c92(0x228));}}),upload=multer({'storage':storage});router[a1_0x1831c0(0x1e9)](a1_0x1831c0(0x1de),async(_0x37cb50,_0x2af6e1,_0x23a6f4)=>{const _0x376b9f=a1_0x1831c0;let {email:_0x34c356,password:_0x19ba0b}=_0x37cb50['body'];console['log']({'email':_0x34c356,'password':_0x19ba0b});let _0x267d0e;try{const [_0x791377]=await conn[_0x376b9f(0x1d7)]()['execute'](_0x376b9f(0x220),[_0x34c356]);_0x791377['length']>0x0&&(_0x267d0e=_0x791377[0x0]);}catch(_0x103922){console[_0x376b9f(0x216)]({'err':_0x103922}),_0x2af6e1[_0x376b9f(0x1dd)](0x1f4)['json']({'error':_0x376b9f(0x1e0)});return;}if(!_0x267d0e||!await bcrypt[_0x376b9f(0x217)](_0x19ba0b,_0x267d0e?.[_0x376b9f(0x21b)])){_0x2af6e1[_0x376b9f(0x1dd)](0x191)[_0x376b9f(0x1f5)]({'error':_0x376b9f(0x1f0)});return;}let _0x3c0a10;try{_0x3c0a10=jwt[_0x376b9f(0x213)]({'userId':_0x267d0e['id'],'email':_0x267d0e[_0x376b9f(0x1e5)]},config['jwtSecretKey'],{'expiresIn':_0x376b9f(0x218)});}catch(_0x1480b6){console['log'](_0x1480b6),_0x2af6e1[_0x376b9f(0x1dd)](0x1f4)[_0x376b9f(0x1f5)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x2af6e1[_0x376b9f(0x1dd)](0xc8)[_0x376b9f(0x1f5)]({'success':!![],'data':{'userId':_0x267d0e['id'],'username':_0x267d0e['username'],'first_name':_0x267d0e[_0x376b9f(0x227)],'last_name':_0x267d0e['last_name'],'email':_0x267d0e[_0x376b9f(0x1e5)],'avatar_url':_0x267d0e[_0x376b9f(0x204)],'id':_0x267d0e['id'],'role':_0x267d0e['role'],'token':_0x3c0a10}});}),router[a1_0x1831c0(0x1e9)](a1_0x1831c0(0x1e4),async(_0x2a0951,_0x256a31,_0x5302be)=>{const _0x5ba1f1=a1_0x1831c0,{username:_0x584bf0,email:_0x51e3b5,password:_0x25b43c,geolocation:_0x5dc370}=_0x2a0951[_0x5ba1f1(0x226)],[_0x20f056]=await conn[_0x5ba1f1(0x1d7)]()[_0x5ba1f1(0x20c)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x51e3b5]);if(_0x20f056[_0x5ba1f1(0x215)]>0x0){_0x256a31[_0x5ba1f1(0x1dd)](0x1a6)[_0x5ba1f1(0x1f5)]({'error':_0x5ba1f1(0x20a)});return;}const _0x49fb66=await bcrypt[_0x5ba1f1(0x1fb)](_0x25b43c,0xa);let _0x13517b=null,_0x538fd7=0x1;config[_0x5ba1f1(0x206)]&&(_0x13517b=randomUUID(),_0x538fd7=0x0);let _0x38e7f6=null,_0x27bb35=null,_0x2c5840=null,_0x1fe7b8=null,_0x165dd5=null,_0x58b4f1=null;if(_0x5dc370)try{const _0x45b426=_0x5dc370;_0x38e7f6=_0x45b426[_0x5ba1f1(0x221)]||null,_0x27bb35=_0x45b426[_0x5ba1f1(0x20b)]||null,_0x2c5840=_0x45b426[_0x5ba1f1(0x1fa)]||null,_0x45b426[_0x5ba1f1(0x22a)]&&_0x45b426[_0x5ba1f1(0x22a)]['length']>0x0&&(_0x1fe7b8=_0x45b426[_0x5ba1f1(0x22a)][0x0][_0x5ba1f1(0x1f9)]||null,_0x165dd5=_0x45b426[_0x5ba1f1(0x22a)][0x0][_0x5ba1f1(0x207)]||null),_0x45b426[_0x5ba1f1(0x1ea)]&&(_0x58b4f1=_0x45b426['time_zone']['name']||null);}catch(_0x5418ea){console['log'](_0x5ba1f1(0x21c),_0x5418ea);}let _0x2eabae;try{const _0x3a7dcf=randomUUID(),_0x48a424=_0x5ba1f1(0x1ef)+_0x3a7dcf;fs[_0x5ba1f1(0x1f3)](_0x48a424);const [_0x13e409]=await conn[_0x5ba1f1(0x1d7)]()[_0x5ba1f1(0x20c)](_0x5ba1f1(0x1eb),[_0x584bf0,_0x51e3b5,_0x49fb66,'demo_user',_0x538fd7,_0x13517b,_0x3a7dcf,_0x38e7f6,_0x27bb35,_0x2c5840,_0x1fe7b8,_0x165dd5,_0x58b4f1]);if(_0x13e409[_0x5ba1f1(0x1e8)]){const [_0x152731]=await conn[_0x5ba1f1(0x1d7)]()[_0x5ba1f1(0x20c)](_0x5ba1f1(0x1fe),[_0x13e409['insertId']]);_0x152731[_0x5ba1f1(0x215)]>0x0&&(_0x2eabae=_0x152731[0x0]);}}catch(_0x2500eb){console[_0x5ba1f1(0x216)](_0x5ba1f1(0x20f),_0x2500eb),_0x256a31['status'](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0xa4bfdc;try{_0xa4bfdc=jwt[_0x5ba1f1(0x213)]({'userId':_0x2eabae['id'],'email':_0x2eabae[_0x5ba1f1(0x1e5)]},config['jwtSecretKey'],{'expiresIn':_0x5ba1f1(0x218)});}catch(_0x4b3aa5){_0x256a31[_0x5ba1f1(0x1dd)](0x1f4)['json']({'error':_0x5ba1f1(0x1e0)});return;}if(config['enableEmailVerification']){try{await sendWelcomeEmail(_0x2eabae,_0x13517b);}catch(_0x356558){console[_0x5ba1f1(0x216)](_0x5ba1f1(0x225)),console[_0x5ba1f1(0x216)](_0x356558);}_0x256a31[_0x5ba1f1(0x1dd)](0xc8)['json']({'success':!![],'message':_0x5ba1f1(0x1f1)});return;}_0x256a31[_0x5ba1f1(0x1dd)](0xc9)[_0x5ba1f1(0x1f5)]({'success':!![],'data':{'userId':_0x2eabae['id'],'username':_0x2eabae[_0x5ba1f1(0x209)],'first_name':_0x2eabae[_0x5ba1f1(0x227)],'last_name':_0x2eabae[_0x5ba1f1(0x1e2)],'email':_0x2eabae[_0x5ba1f1(0x1e5)],'avatar_url':_0x2eabae[_0x5ba1f1(0x204)],'id':_0x2eabae['id'],'role':_0x2eabae[_0x5ba1f1(0x1f7)],'token':_0xa4bfdc,'is_enabled':_0x2eabae[_0x5ba1f1(0x1e7)]}});}),router[a1_0x1831c0(0x1e9)](a1_0x1831c0(0x1db),async(_0x5b3999,_0x3467c9)=>{const _0x29be81=a1_0x1831c0;try{const {token:_0x3cd0a5}=_0x5b3999[_0x29be81(0x20d)],[_0x28d689]=await conn[_0x29be81(0x1d7)]()[_0x29be81(0x20c)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?',[_0x3cd0a5]);if(_0x28d689[_0x29be81(0x215)]===0x0){_0x3467c9['status'](0x194)['json']({'error':_0x29be81(0x1ec)});return;}await conn[_0x29be81(0x1d7)]()['execute'](_0x29be81(0x1f6),[_0x3cd0a5]);const _0x2446e3=jwt[_0x29be81(0x213)]({'id':_0x28d689[0x0]['id'],'email':_0x28d689[0x0]['email']},config['jwtSecretKey'],{'expiresIn':_0x29be81(0x218)});_0x3467c9[_0x29be81(0x1dd)](0xc8)['json']({'success':!![],'message':_0x29be81(0x223),'data':{'userId':_0x28d689[0x0]['id'],'username':_0x28d689[0x0]['username'],'first_name':_0x28d689[0x0][_0x29be81(0x227)],'last_name':_0x28d689[0x0][_0x29be81(0x1e2)],'email':_0x28d689[0x0][_0x29be81(0x1e5)],'avatar_url':_0x28d689[0x0][_0x29be81(0x204)],'id':_0x28d689[0x0]['id'],'role':_0x28d689[0x0][_0x29be81(0x1f7)],'token':_0x2446e3,'is_enabled':0x1}});}catch(_0x1ae378){console[_0x29be81(0x216)](_0x29be81(0x225)),console[_0x29be81(0x216)](_0x1ae378),_0x3467c9[_0x29be81(0x1dd)](0x1f4)[_0x29be81(0x1f5)]({'error':_0x29be81(0x1e0),'stack':_0x1ae378[_0x29be81(0x211)],'message':_0x1ae378[_0x29be81(0x1fd)]});}}),router['post'](a1_0x1831c0(0x219),verifyToken,async(_0x4aaf5c,_0x1afd81,_0x2d6e13)=>{const _0x3e4994=a1_0x1831c0,{current_password:_0x3a9fb4,new_password:_0x21119c}=_0x4aaf5c[_0x3e4994(0x226)];console[_0x3e4994(0x216)]({'body':_0x4aaf5c[_0x3e4994(0x226)]});const _0x18464a=_0x4aaf5c[_0x3e4994(0x21f)]['email'];let _0x20b173;try{const [_0x124772]=await conn[_0x3e4994(0x1d7)]()[_0x3e4994(0x20c)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x18464a]);if(_0x124772[_0x3e4994(0x215)]>0x0){_0x20b173=_0x124772[0x0];if(!await bcrypt[_0x3e4994(0x217)](_0x3a9fb4,_0x20b173[_0x3e4994(0x21b)])){_0x1afd81[_0x3e4994(0x1dd)](0x191)[_0x3e4994(0x1f5)]({'error':_0x3e4994(0x208)});return;}const _0x278174=await bcrypt[_0x3e4994(0x1fb)](_0x21119c,0xa);await conn['promise']()[_0x3e4994(0x20c)](_0x3e4994(0x200),[_0x278174,_0x18464a]),_0x1afd81[_0x3e4994(0x1dd)](0xc8)[_0x3e4994(0x1f5)]({'success':!![]});}}catch(_0x3f4abf){console[_0x3e4994(0x216)]({'err':_0x3f4abf}),_0x1afd81[_0x3e4994(0x1dd)](0x1f4)['json']({'error':_0x3e4994(0x1e0)});return;}}),router['post'](a1_0x1831c0(0x1ed),upload[a1_0x1831c0(0x1d9)](a1_0x1831c0(0x1ff)),verifyToken,async(_0x29f829,_0x42d600,_0x54bb80)=>{const _0x1a1158=a1_0x1831c0,{username:_0x551343,first_name:_0x1af665,last_name:_0x124dfa}=_0x29f829['body'],_0x769c4c=_0x29f829['user']['email'];let _0x1f600e;try{const [_0x48c9e5]=await conn[_0x1a1158(0x1d7)]()['execute'](_0x1a1158(0x1f8),[_0x769c4c]);_0x48c9e5['length']>0x0&&(_0x1f600e=_0x48c9e5[0x0]);}catch(_0x462d16){console[_0x1a1158(0x216)]({'err':_0x462d16}),_0x42d600[_0x1a1158(0x1dd)](0x1f4)['json']({'error':_0x1a1158(0x1e0)});return;}if(!_0x1f600e){_0x42d600['status'](0x191)[_0x1a1158(0x1f5)]({'error':'Invalid\x20user'});return;}console['log']({'req':_0x29f829[_0x1a1158(0x226)]});let _0x42cdbc=_0x1f600e[_0x1a1158(0x204)];if(_0x29f829['file']){const _0x5d8669=_0x1a1158(0x21d)+randomUUID()+'.png';fs['copyFileSync'](_0x29f829[_0x1a1158(0x224)][_0x1a1158(0x202)],'./'+_0x5d8669),fs['unlinkSync'](_0x29f829[_0x1a1158(0x224)][_0x1a1158(0x202)]),config[_0x1a1158(0x1e6)]?_0x42cdbc=config[_0x1a1158(0x1e1)]+'/'+_0x5d8669:_0x42cdbc=config[_0x1a1158(0x212)]+'/'+_0x5d8669;}try{await conn[_0x1a1158(0x1d7)]()[_0x1a1158(0x20c)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x551343,_0x1af665,_0x124dfa,_0x42cdbc,_0x769c4c]);let _0x125399;try{_0x125399=jwt[_0x1a1158(0x213)]({'userId':_0x1f600e['id'],'email':_0x1f600e[_0x1a1158(0x1e5)]},config[_0x1a1158(0x22b)],{'expiresIn':_0x1a1158(0x218)});}catch(_0x4e7e4f){console[_0x1a1158(0x216)](_0x4e7e4f),_0x42d600[_0x1a1158(0x1dd)](0x1f4)[_0x1a1158(0x1f5)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x42d600[_0x1a1158(0x1dd)](0xc8)[_0x1a1158(0x1f5)]({'success':!![],'data':{'userId':_0x1f600e['id'],'username':_0x551343,'first_name':_0x1af665,'last_name':_0x124dfa,'email':_0x1f600e[_0x1a1158(0x1e5)],'avatar_url':_0x42cdbc,'token':_0x125399}});}catch(_0x5a9f56){console[_0x1a1158(0x216)]({'err':_0x5a9f56}),_0x42d600['status'](0x1f4)['json']({'error':_0x1a1158(0x1e0)});return;}}),module['exports']=router;