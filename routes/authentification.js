const a1_0x3385f6=a1_0x2056;(function(_0x2923da,_0x52178e){const _0x2ac755=a1_0x2056,_0x3aeaf2=_0x2923da();while(!![]){try{const _0x41834c=parseInt(_0x2ac755(0x181))/0x1+-parseInt(_0x2ac755(0x162))/0x2*(parseInt(_0x2ac755(0x16a))/0x3)+parseInt(_0x2ac755(0x154))/0x4*(parseInt(_0x2ac755(0x146))/0x5)+-parseInt(_0x2ac755(0x17f))/0x6*(-parseInt(_0x2ac755(0x16f))/0x7)+-parseInt(_0x2ac755(0x17b))/0x8*(parseInt(_0x2ac755(0x169))/0x9)+-parseInt(_0x2ac755(0x150))/0xa*(-parseInt(_0x2ac755(0x17c))/0xb)+-parseInt(_0x2ac755(0x16c))/0xc;if(_0x41834c===_0x52178e)break;else _0x3aeaf2['push'](_0x3aeaf2['shift']());}catch(_0x532196){_0x3aeaf2['push'](_0x3aeaf2['shift']());}}}(a1_0x5988,0xa91f0));const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x3385f6(0x170)),config=require(a1_0x3385f6(0x177)),conn=require(a1_0x3385f6(0x141)),multer=require(a1_0x3385f6(0x160)),fs=require('fs'),verifyToken=require(a1_0x3385f6(0x157))[a1_0x3385f6(0x15e)];!fs[a1_0x3385f6(0x149)](a1_0x3385f6(0x16e))&&fs[a1_0x3385f6(0x17e)](a1_0x3385f6(0x16e));function a1_0x5988(){const _0xb2c430=['/login','last_name','crypto','Invalid\x20user','../CADViewer_config.json','user','promise','path','216lYiSpL','13058749TOLadv','username','mkdirSync','6VSdHNe','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','313874oYMrqO','ServerUrl','single','../libs/mysql.js','exports','jwtSecretKey','/update-password','length','5604890iAOJxI','Invalid\x20email\x20or\x20password','avatars/','existsSync','json','Router','status','insertId','Invalid\x20password','express','10cFVrjZ','diskStorage','execute','post','4yyvabN','role','24h','../libs/jwt','log','User\x20already\x20exists','.png','file','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','/update-user-info','verifyToken','hash','multer','first_name','156382lBsNZS','avatar','crypted_password','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','body','Error!\x20Something\x20went\x20wrong.','106686fCyxzW','21qmPMSF','email','14537844IYRdJi','compare','./avatars','1047137OMajvH','bcrypt','sign','avatar_url'];a1_0x5988=function(){return _0xb2c430;};return a1_0x5988();}const express=require(a1_0x3385f6(0x14f)),router=express[a1_0x3385f6(0x14b)](),{randomUUID}=require(a1_0x3385f6(0x175)),storage=multer[a1_0x3385f6(0x151)]({'destination':function(_0x5f496d,_0x4b337f,_0x3fc502){_0x3fc502(null,'avatars');}}),upload=multer({'storage':storage});function a1_0x2056(_0x3e0ebf,_0x253b1c){const _0x5988f4=a1_0x5988();return a1_0x2056=function(_0x205633,_0x28d8ef){_0x205633=_0x205633-0x141;let _0x2bd6ac=_0x5988f4[_0x205633];return _0x2bd6ac;},a1_0x2056(_0x3e0ebf,_0x253b1c);}router['post'](a1_0x3385f6(0x173),async(_0x132468,_0xde69ff,_0x42dba0)=>{const _0x23354d=a1_0x3385f6;let {email:_0x300fe2,password:_0x1baaae}=_0x132468[_0x23354d(0x167)];console[_0x23354d(0x158)]({'email':_0x300fe2,'password':_0x1baaae});let _0x2be5e7;try{const [_0xbbd0ae]=await conn[_0x23354d(0x179)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?',[_0x300fe2]);_0xbbd0ae['length']>0x0&&(_0x2be5e7=_0xbbd0ae[0x0]);}catch(_0x39541a){console[_0x23354d(0x158)]({'err':_0x39541a}),_0xde69ff['status'](0x1f4)[_0x23354d(0x14a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}console[_0x23354d(0x158)](_0x2be5e7),console[_0x23354d(0x158)](_0x1baaae),console[_0x23354d(0x158)](_0x2be5e7[_0x23354d(0x164)]);if(!_0x2be5e7||!await bcrypt[_0x23354d(0x16d)](_0x1baaae,_0x2be5e7[_0x23354d(0x164)])){_0xde69ff[_0x23354d(0x14c)](0x191)[_0x23354d(0x14a)]({'error':_0x23354d(0x147)});return;}let _0x598334;try{_0x598334=jwt['sign']({'userId':_0x2be5e7['id'],'email':_0x2be5e7['email']},config['jwtSecretKey'],{'expiresIn':_0x23354d(0x156)});}catch(_0x56fa4b){console[_0x23354d(0x158)](_0x56fa4b),_0xde69ff[_0x23354d(0x14c)](0x1f4)[_0x23354d(0x14a)]({'error':_0x23354d(0x168)});return;}_0xde69ff[_0x23354d(0x14c)](0xc8)[_0x23354d(0x14a)]({'success':!![],'data':{'userId':_0x2be5e7['id'],'username':_0x2be5e7[_0x23354d(0x17d)],'first_name':_0x2be5e7['first_name'],'last_name':_0x2be5e7[_0x23354d(0x174)],'email':_0x2be5e7[_0x23354d(0x16b)],'avatar_url':_0x2be5e7[_0x23354d(0x172)],'id':_0x2be5e7['id'],'role':_0x2be5e7['role'],'token':_0x598334}});}),router['post']('/signup',async(_0x31b501,_0x4c0056,_0x255b05)=>{const _0x3ceae1=a1_0x3385f6,{username:_0x4f37d2,email:_0x5545f6,password:_0x81e961}=_0x31b501[_0x3ceae1(0x167)],[_0x1daed4]=await conn[_0x3ceae1(0x179)]()[_0x3ceae1(0x152)](_0x3ceae1(0x15c),[_0x5545f6]);if(_0x1daed4[_0x3ceae1(0x145)]>0x0){_0x4c0056[_0x3ceae1(0x14c)](0x1a6)[_0x3ceae1(0x14a)]({'error':_0x3ceae1(0x159)});return;}const _0x105b7a=await bcrypt[_0x3ceae1(0x15f)](_0x81e961,0xa);try{const [_0x675caf]=await conn[_0x3ceae1(0x179)]()['execute'](_0x3ceae1(0x166),[_0x4f37d2,_0x5545f6,_0x105b7a,_0x3ceae1(0x178)]);if(_0x675caf[_0x3ceae1(0x14d)]){const [_0x585b20]=await conn[_0x3ceae1(0x179)]()[_0x3ceae1(0x152)](_0x3ceae1(0x180),[_0x675caf[_0x3ceae1(0x14d)]]);_0x585b20['length']>0x0&&(newUser=_0x585b20[0x0]);}}catch{_0x4c0056['status'](0x1f4)[_0x3ceae1(0x14a)]({'error':_0x3ceae1(0x168)});return;}let _0xb803a2;try{_0xb803a2=jwt[_0x3ceae1(0x171)]({'userId':newUser['id'],'email':newUser['email']},config['jwtSecretKey'],{'expiresIn':_0x3ceae1(0x156)});}catch(_0x23d368){_0x4c0056[_0x3ceae1(0x14c)](0x1f4)[_0x3ceae1(0x14a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x4c0056[_0x3ceae1(0x14c)](0xc9)[_0x3ceae1(0x14a)]({'success':!![],'data':{'userId':newUser['id'],'username':newUser['username'],'first_name':newUser[_0x3ceae1(0x161)],'last_name':newUser[_0x3ceae1(0x174)],'email':newUser['email'],'avatar_url':newUser[_0x3ceae1(0x172)],'id':newUser['id'],'role':newUser[_0x3ceae1(0x155)],'token':_0xb803a2}});}),router['post'](a1_0x3385f6(0x144),verifyToken,async(_0x5c751a,_0xabdb1b,_0x4fc842)=>{const _0x1e4490=a1_0x3385f6,{current_password:_0x442502,new_password:_0x296697}=_0x5c751a[_0x1e4490(0x167)];console['log']({'body':_0x5c751a[_0x1e4490(0x167)]});const _0x24ffbc=_0x5c751a[_0x1e4490(0x178)][_0x1e4490(0x16b)];let _0x4a04df;try{const [_0x502b97]=await conn[_0x1e4490(0x179)]()[_0x1e4490(0x152)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x24ffbc]);if(_0x502b97[_0x1e4490(0x145)]>0x0){_0x4a04df=_0x502b97[0x0];if(!await bcrypt[_0x1e4490(0x16d)](_0x442502,_0x4a04df['crypted_password'])){_0xabdb1b[_0x1e4490(0x14c)](0x191)['json']({'error':_0x1e4490(0x14e)});return;}const _0x2fa4df=await bcrypt[_0x1e4490(0x15f)](_0x296697,0xa);await conn['promise']()[_0x1e4490(0x152)](_0x1e4490(0x165),[_0x2fa4df,_0x24ffbc]),_0xabdb1b[_0x1e4490(0x14c)](0xc8)[_0x1e4490(0x14a)]({'success':!![]});}}catch(_0x1fcb8d){console[_0x1e4490(0x158)]({'err':_0x1fcb8d}),_0xabdb1b[_0x1e4490(0x14c)](0x1f4)[_0x1e4490(0x14a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router[a1_0x3385f6(0x153)](a1_0x3385f6(0x15d),upload[a1_0x3385f6(0x183)](a1_0x3385f6(0x163)),verifyToken,async(_0x4b6a96,_0x850560,_0x19d324)=>{const _0x5bbf3a=a1_0x3385f6,{username:_0x849aef,first_name:_0x1e8d2b,last_name:_0x2ef687}=_0x4b6a96[_0x5bbf3a(0x167)],_0x4a918e=_0x4b6a96[_0x5bbf3a(0x178)][_0x5bbf3a(0x16b)];let _0x26f380;try{const [_0x549c64]=await conn[_0x5bbf3a(0x179)]()['execute'](_0x5bbf3a(0x15c),[_0x4a918e]);_0x549c64[_0x5bbf3a(0x145)]>0x0&&(_0x26f380=_0x549c64[0x0]);}catch(_0x1cf812){console[_0x5bbf3a(0x158)]({'err':_0x1cf812}),_0x850560['status'](0x1f4)['json']({'error':_0x5bbf3a(0x168)});return;}if(!_0x26f380){_0x850560[_0x5bbf3a(0x14c)](0x191)['json']({'error':_0x5bbf3a(0x176)});return;}console['log']({'req':_0x4b6a96['body']});let _0x27a4b8=_0x26f380[_0x5bbf3a(0x172)];if(_0x4b6a96[_0x5bbf3a(0x15b)]){const _0x3e2471=_0x5bbf3a(0x148)+randomUUID()+_0x5bbf3a(0x15a);fs['renameSync'](_0x4b6a96[_0x5bbf3a(0x15b)][_0x5bbf3a(0x17a)],'./'+_0x3e2471),_0x27a4b8=config[_0x5bbf3a(0x182)]+'/'+_0x3e2471;}try{await conn[_0x5bbf3a(0x179)]()[_0x5bbf3a(0x152)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x849aef,_0x1e8d2b,_0x2ef687,_0x27a4b8,_0x4a918e]);let _0x3278e7;try{_0x3278e7=jwt[_0x5bbf3a(0x171)]({'userId':_0x26f380['id'],'email':_0x26f380[_0x5bbf3a(0x16b)]},config[_0x5bbf3a(0x143)],{'expiresIn':_0x5bbf3a(0x156)});}catch(_0xd7b690){console[_0x5bbf3a(0x158)](_0xd7b690),_0x850560[_0x5bbf3a(0x14c)](0x1f4)['json']({'error':_0x5bbf3a(0x168)});return;}_0x850560[_0x5bbf3a(0x14c)](0xc8)[_0x5bbf3a(0x14a)]({'success':!![],'data':{'userId':_0x26f380['id'],'username':_0x849aef,'first_name':_0x1e8d2b,'last_name':_0x2ef687,'email':_0x26f380['email'],'avatar_url':_0x27a4b8,'token':_0x3278e7}});}catch(_0x32ce11){console['log']({'err':_0x32ce11}),_0x850560['status'](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module[a1_0x3385f6(0x142)]=router;