function a1_0x4ee5(_0xc103a3,_0x1f5773){const _0x542681=a1_0x5426();return a1_0x4ee5=function(_0x4ee5b8,_0x3f916a){_0x4ee5b8=_0x4ee5b8-0x171;let _0x64be4e=_0x542681[_0x4ee5b8];return _0x64be4e;},a1_0x4ee5(_0xc103a3,_0x1f5773);}const a1_0x296814=a1_0x4ee5;(function(_0x414dda,_0x3cd9c9){const _0x56bcd7=a1_0x4ee5,_0x1742b0=_0x414dda();while(!![]){try{const _0x3f684d=parseInt(_0x56bcd7(0x1b9))/0x1+-parseInt(_0x56bcd7(0x1bd))/0x2*(parseInt(_0x56bcd7(0x183))/0x3)+-parseInt(_0x56bcd7(0x180))/0x4*(parseInt(_0x56bcd7(0x1ac))/0x5)+parseInt(_0x56bcd7(0x1c2))/0x6*(-parseInt(_0x56bcd7(0x1b1))/0x7)+parseInt(_0x56bcd7(0x1a0))/0x8*(parseInt(_0x56bcd7(0x19c))/0x9)+parseInt(_0x56bcd7(0x18c))/0xa*(-parseInt(_0x56bcd7(0x1a3))/0xb)+parseInt(_0x56bcd7(0x19e))/0xc;if(_0x3f684d===_0x3cd9c9)break;else _0x1742b0['push'](_0x1742b0['shift']());}catch(_0x1e3d6f){_0x1742b0['push'](_0x1742b0['shift']());}}}(a1_0x5426,0x44d2d));const jwt=require(a1_0x296814(0x1a7)),bcrypt=require(a1_0x296814(0x1a5)),config=require('../CADViewer_config.json'),conn=require('../libs/mysql.js'),multer=require(a1_0x296814(0x194)),fs=require('fs'),verifyToken=require(a1_0x296814(0x196))['verifyToken'];!fs[a1_0x296814(0x18e)](a1_0x296814(0x1bc))&&fs[a1_0x296814(0x19d)](a1_0x296814(0x1bc));const express=require(a1_0x296814(0x191)),router=express[a1_0x296814(0x181)](),{randomUUID}=require(a1_0x296814(0x190)),storage=multer[a1_0x296814(0x18d)]({'destination':function(_0x4b955f,_0x40d359,_0x141ce9){const _0x30f564=a1_0x296814;_0x141ce9(null,_0x30f564(0x1bb));}}),upload=multer({'storage':storage});router[a1_0x296814(0x1ab)](a1_0x296814(0x1b4),async(_0x51e7d9,_0x483dc8,_0x476145)=>{const _0x524ad1=a1_0x296814;let {email:_0x206c7b,password:_0x86e9d0}=_0x51e7d9[_0x524ad1(0x199)];console[_0x524ad1(0x176)]({'email':_0x206c7b,'password':_0x86e9d0});let _0x3beed7;try{const [_0x460731]=await conn[_0x524ad1(0x184)]()[_0x524ad1(0x1c9)](_0x524ad1(0x187),[_0x206c7b]);_0x460731[_0x524ad1(0x1b2)]>0x0&&(_0x3beed7=_0x460731[0x0]);}catch(_0x5b88ab){console['log']({'err':_0x5b88ab}),_0x483dc8[_0x524ad1(0x195)](0x1f4)[_0x524ad1(0x174)]({'error':_0x524ad1(0x1ba)});return;}if(!_0x3beed7||!await bcrypt[_0x524ad1(0x177)](_0x86e9d0,_0x3beed7?.[_0x524ad1(0x175)])){_0x483dc8[_0x524ad1(0x195)](0x191)['json']({'error':'Invalid\x20email\x20or\x20password'});return;}let _0x5e0ec9;try{_0x5e0ec9=jwt[_0x524ad1(0x185)]({'userId':_0x3beed7['id'],'email':_0x3beed7[_0x524ad1(0x1a8)]},config[_0x524ad1(0x1b0)],{'expiresIn':_0x524ad1(0x17a)});}catch(_0x15ffc6){console['log'](_0x15ffc6),_0x483dc8['status'](0x1f4)[_0x524ad1(0x174)]({'error':_0x524ad1(0x1ba)});return;}_0x483dc8[_0x524ad1(0x195)](0xc8)[_0x524ad1(0x174)]({'success':!![],'data':{'userId':_0x3beed7['id'],'username':_0x3beed7[_0x524ad1(0x19b)],'first_name':_0x3beed7[_0x524ad1(0x1c7)],'last_name':_0x3beed7[_0x524ad1(0x192)],'email':_0x3beed7['email'],'avatar_url':_0x3beed7[_0x524ad1(0x1c8)],'id':_0x3beed7['id'],'role':_0x3beed7[_0x524ad1(0x17d)],'token':_0x5e0ec9}});}),router[a1_0x296814(0x1ab)](a1_0x296814(0x1aa),async(_0x40b8b4,_0x34eff4,_0x47b1c6)=>{const _0x35ec85=a1_0x296814,{username:_0x1dfd72,email:_0x57f991,password:_0x149ab4}=_0x40b8b4[_0x35ec85(0x199)],[_0x4befdb]=await conn[_0x35ec85(0x184)]()[_0x35ec85(0x1c9)](_0x35ec85(0x1b8),[_0x57f991]);if(_0x4befdb[_0x35ec85(0x1b2)]>0x0){_0x34eff4['status'](0x1a6)[_0x35ec85(0x174)]({'error':'User\x20already\x20exists'});return;}const _0x51aee0=await bcrypt[_0x35ec85(0x17e)](_0x149ab4,0xa);let _0x2fe852=null,_0x1ac0b3=0x1;config[_0x35ec85(0x1ad)]&&(_0x2fe852=randomUUID(),_0x1ac0b3=0x0);let _0x50f07d;try{const _0x45d429=randomUUID(),_0x487c6c=_0x35ec85(0x1b3)+_0x45d429;fs[_0x35ec85(0x19d)](_0x487c6c);const [_0x2a5a48]=await conn[_0x35ec85(0x184)]()[_0x35ec85(0x1c9)](_0x35ec85(0x1a4),[_0x1dfd72,_0x57f991,_0x51aee0,_0x35ec85(0x19f),_0x1ac0b3,_0x2fe852,_0x45d429]);if(_0x2a5a48[_0x35ec85(0x1b6)]){const [_0x3f7db4]=await conn[_0x35ec85(0x184)]()[_0x35ec85(0x1c9)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0x2a5a48[_0x35ec85(0x1b6)]]);_0x3f7db4['length']>0x0&&(_0x50f07d=_0x3f7db4[0x0]);}}catch{_0x34eff4['status'](0x1f4)[_0x35ec85(0x174)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x4a09c0;try{_0x4a09c0=jwt[_0x35ec85(0x185)]({'userId':_0x50f07d['id'],'email':_0x50f07d['email']},config[_0x35ec85(0x1b0)],{'expiresIn':_0x35ec85(0x17a)});}catch(_0x590f5b){_0x34eff4[_0x35ec85(0x195)](0x1f4)[_0x35ec85(0x174)]({'error':_0x35ec85(0x1ba)});return;}const _0x50dde2=require('../libs/mail')[_0x35ec85(0x1af)];let _0xa03888=_0x35ec85(0x193);if(config[_0x35ec85(0x1ad)]){var _0x3cdd35=config[_0x35ec85(0x197)];_0x3cdd35[_0x35ec85(0x1c3)]('/')&&(_0x3cdd35=_0x3cdd35['slice'](0x0,-0x1));const _0x116e71=_0x3cdd35+_0x35ec85(0x17c)+_0x2fe852;_0xa03888=_0x35ec85(0x18a)+_0x116e71+_0x35ec85(0x1a9)+_0x116e71+_0x35ec85(0x1c6);const _0x53b098={'from':config['smtpFrom'],'to':_0x50f07d[_0x35ec85(0x1a8)],'subject':_0x35ec85(0x17b),'text':_0x35ec85(0x17b),'html':_0xa03888};try{await _0x50dde2[_0x35ec85(0x182)](_0x53b098);}catch(_0x217244){console[_0x35ec85(0x176)](_0x35ec85(0x1c5)),console[_0x35ec85(0x176)](_0x217244),_0x34eff4[_0x35ec85(0x195)](0x1f4)[_0x35ec85(0x174)]({'error':_0x35ec85(0x1c1),'stack':_0x217244['stack'],'message':_0x217244[_0x35ec85(0x1bf)]});return;}_0x34eff4['status'](0xc8)[_0x35ec85(0x174)]({'success':!![],'message':_0x35ec85(0x1be)});return;}_0x34eff4[_0x35ec85(0x195)](0xc9)[_0x35ec85(0x174)]({'success':!![],'data':{'userId':_0x50f07d['id'],'username':_0x50f07d[_0x35ec85(0x19b)],'first_name':_0x50f07d[_0x35ec85(0x1c7)],'last_name':_0x50f07d[_0x35ec85(0x192)],'email':_0x50f07d[_0x35ec85(0x1a8)],'avatar_url':_0x50f07d[_0x35ec85(0x1c8)],'id':_0x50f07d['id'],'role':_0x50f07d[_0x35ec85(0x17d)],'token':_0x4a09c0,'is_enabled':_0x50f07d[_0x35ec85(0x1ae)]}});}),router['post'](a1_0x296814(0x19a),async(_0x1442d2,_0x4493f7)=>{const _0x4ac0a6=a1_0x296814;try{const {token:_0x34a887}=_0x1442d2[_0x4ac0a6(0x1c4)],[_0x4ce81e]=await conn[_0x4ac0a6(0x184)]()[_0x4ac0a6(0x1c9)](_0x4ac0a6(0x178),[_0x34a887]);if(_0x4ce81e[_0x4ac0a6(0x1b2)]===0x0){_0x4493f7[_0x4ac0a6(0x195)](0x194)[_0x4ac0a6(0x174)]({'error':_0x4ac0a6(0x171)});return;}await conn[_0x4ac0a6(0x184)]()[_0x4ac0a6(0x1c9)](_0x4ac0a6(0x1ca),[_0x34a887]);const _0x5cf731=jwt['sign']({'id':_0x4ce81e[0x0]['id'],'email':_0x4ce81e[0x0][_0x4ac0a6(0x1a8)]},config['jwtSecretKey'],{'expiresIn':_0x4ac0a6(0x17a)});_0x4493f7[_0x4ac0a6(0x195)](0xc8)['json']({'success':!![],'message':_0x4ac0a6(0x1c0),'data':{'userId':_0x4ce81e[0x0]['id'],'username':_0x4ce81e[0x0][_0x4ac0a6(0x19b)],'first_name':_0x4ce81e[0x0][_0x4ac0a6(0x1c7)],'last_name':_0x4ce81e[0x0][_0x4ac0a6(0x192)],'email':_0x4ce81e[0x0][_0x4ac0a6(0x1a8)],'avatar_url':_0x4ce81e[0x0][_0x4ac0a6(0x1c8)],'id':_0x4ce81e[0x0]['id'],'role':_0x4ce81e[0x0][_0x4ac0a6(0x17d)],'token':_0x5cf731,'is_enabled':0x1}});}catch(_0x4c305f){console[_0x4ac0a6(0x176)](_0x4ac0a6(0x1c5)),console['log'](_0x4c305f),_0x4493f7[_0x4ac0a6(0x195)](0x1f4)[_0x4ac0a6(0x174)]({'error':_0x4ac0a6(0x1ba),'stack':_0x4c305f[_0x4ac0a6(0x189)],'message':_0x4c305f['message']});}}),router['post'](a1_0x296814(0x173),verifyToken,async(_0x1bf67d,_0x2f93b3,_0x10c311)=>{const _0xb32fe5=a1_0x296814,{current_password:_0x158d5b,new_password:_0x25b861}=_0x1bf67d[_0xb32fe5(0x199)];console[_0xb32fe5(0x176)]({'body':_0x1bf67d[_0xb32fe5(0x199)]});const _0x705606=_0x1bf67d[_0xb32fe5(0x18f)][_0xb32fe5(0x1a8)];let _0x367f21;try{const [_0x4ed60b]=await conn[_0xb32fe5(0x184)]()[_0xb32fe5(0x1c9)](_0xb32fe5(0x1b8),[_0x705606]);if(_0x4ed60b[_0xb32fe5(0x1b2)]>0x0){_0x367f21=_0x4ed60b[0x0];if(!await bcrypt['compare'](_0x158d5b,_0x367f21[_0xb32fe5(0x175)])){_0x2f93b3['status'](0x191)[_0xb32fe5(0x174)]({'error':_0xb32fe5(0x188)});return;}const _0x45420a=await bcrypt['hash'](_0x25b861,0xa);await conn[_0xb32fe5(0x184)]()[_0xb32fe5(0x1c9)](_0xb32fe5(0x186),[_0x45420a,_0x705606]),_0x2f93b3['status'](0xc8)[_0xb32fe5(0x174)]({'success':!![]});}}catch(_0xba4266){console[_0xb32fe5(0x176)]({'err':_0xba4266}),_0x2f93b3[_0xb32fe5(0x195)](0x1f4)[_0xb32fe5(0x174)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router[a1_0x296814(0x1ab)](a1_0x296814(0x1a2),upload[a1_0x296814(0x198)]('avatar'),verifyToken,async(_0x346b76,_0x42af36,_0x426dde)=>{const _0x4b67b1=a1_0x296814,{username:_0x5b8e27,first_name:_0xff222d,last_name:_0x543651}=_0x346b76[_0x4b67b1(0x199)],_0x43bf46=_0x346b76[_0x4b67b1(0x18f)][_0x4b67b1(0x1a8)];let _0x5d3f14;try{const [_0x36a381]=await conn[_0x4b67b1(0x184)]()[_0x4b67b1(0x1c9)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x43bf46]);_0x36a381['length']>0x0&&(_0x5d3f14=_0x36a381[0x0]);}catch(_0x4aed52){console[_0x4b67b1(0x176)]({'err':_0x4aed52}),_0x42af36[_0x4b67b1(0x195)](0x1f4)[_0x4b67b1(0x174)]({'error':_0x4b67b1(0x1ba)});return;}if(!_0x5d3f14){_0x42af36[_0x4b67b1(0x195)](0x191)[_0x4b67b1(0x174)]({'error':_0x4b67b1(0x17f)});return;}console[_0x4b67b1(0x176)]({'req':_0x346b76['body']});let _0x4fb61c=_0x5d3f14[_0x4b67b1(0x1c8)];if(_0x346b76[_0x4b67b1(0x18b)]){const _0x158fa8=_0x4b67b1(0x1a6)+randomUUID()+_0x4b67b1(0x1a1);fs['copyFileSync'](_0x346b76[_0x4b67b1(0x18b)][_0x4b67b1(0x172)],'./'+_0x158fa8),fs[_0x4b67b1(0x1b7)](_0x346b76[_0x4b67b1(0x18b)][_0x4b67b1(0x172)]),_0x4fb61c=config[_0x4b67b1(0x179)]+'/'+_0x158fa8;}try{await conn[_0x4b67b1(0x184)]()['execute'](_0x4b67b1(0x1b5),[_0x5b8e27,_0xff222d,_0x543651,_0x4fb61c,_0x43bf46]);let _0x18c48f;try{_0x18c48f=jwt['sign']({'userId':_0x5d3f14['id'],'email':_0x5d3f14[_0x4b67b1(0x1a8)]},config['jwtSecretKey'],{'expiresIn':'24h'});}catch(_0x2fd0e4){console[_0x4b67b1(0x176)](_0x2fd0e4),_0x42af36[_0x4b67b1(0x195)](0x1f4)[_0x4b67b1(0x174)]({'error':_0x4b67b1(0x1ba)});return;}_0x42af36[_0x4b67b1(0x195)](0xc8)['json']({'success':!![],'data':{'userId':_0x5d3f14['id'],'username':_0x5b8e27,'first_name':_0xff222d,'last_name':_0x543651,'email':_0x5d3f14[_0x4b67b1(0x1a8)],'avatar_url':_0x4fb61c,'token':_0x18c48f}});}catch(_0xd1bfba){console[_0x4b67b1(0x176)]({'err':_0xd1bfba}),_0x42af36[_0x4b67b1(0x195)](0x1f4)[_0x4b67b1(0x174)]({'error':_0x4b67b1(0x1ba)});return;}}),module['exports']=router;function a1_0x5426(){const _0x464451=['/validate-email/','role','hash','Invalid\x20user','36YSDZsa','Router','sendMail','3HsbHyF','promise','sign','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','Invalid\x20password','stack','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','file','188780ErRsxB','diskStorage','existsSync','user','crypto','express','last_name','<p>Welcome\x20to\x20CADViewer</p>','multer','status','../libs/jwt','frontendUrl','single','body','/validate-email/:token','username','9495osXNlj','mkdirSync','10857204ymJCQB','demo_user','2720AgtBYv','.png','/update-user-info','297mzlVir','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)','bcrypt','avatars/','jsonwebtoken','email','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','/signup','post','36370uUOcyd','enableEmailVerification','is_enabled','transporter','jwtSecretKey','1926764cZJuhz','length','./uploads/','/login','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','insertId','unlinkSync','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','173097CsBitV','Error!\x20Something\x20went\x20wrong.','avatars','./avatars','608478XkErcQ','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','message','Email\x20validated\x20successfully','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','6woDigU','endsWith','params','===================error===================','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','first_name','avatar_url','execute','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','Invalid\x20validation\x20token','path','/update-password','json','crypted_password','log','compare','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','ServerUrl','24h','Welcome\x20to\x20CADViewer'];a1_0x5426=function(){return _0x464451;};return a1_0x5426();}