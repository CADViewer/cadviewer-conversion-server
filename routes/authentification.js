const a1_0x3c7b58=a1_0x3c42;(function(_0x812431,_0x2cd228){const _0x290344=a1_0x3c42,_0x309e54=_0x812431();while(!![]){try{const _0x50f0a7=-parseInt(_0x290344(0x1f4))/0x1+parseInt(_0x290344(0x1dc))/0x2*(-parseInt(_0x290344(0x1bf))/0x3)+parseInt(_0x290344(0x1ea))/0x4*(-parseInt(_0x290344(0x205))/0x5)+parseInt(_0x290344(0x203))/0x6*(-parseInt(_0x290344(0x201))/0x7)+-parseInt(_0x290344(0x1c1))/0x8*(-parseInt(_0x290344(0x1ff))/0x9)+-parseInt(_0x290344(0x1be))/0xa*(-parseInt(_0x290344(0x1fe))/0xb)+parseInt(_0x290344(0x1f1))/0xc;if(_0x50f0a7===_0x2cd228)break;else _0x309e54['push'](_0x309e54['shift']());}catch(_0x2067a3){_0x309e54['push'](_0x309e54['shift']());}}}(a1_0x2a4f,0xd1a6b));const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x3c7b58(0x1f2)),config=require(a1_0x3c7b58(0x1e9)),conn=require(a1_0x3c7b58(0x1da)),multer=require(a1_0x3c7b58(0x1d8)),fs=require('fs'),verifyToken=require('../libs/jwt')['verifyToken'];!fs[a1_0x3c7b58(0x1c6)](a1_0x3c7b58(0x1c0))&&fs['mkdirSync']('./avatars');function a1_0x3c42(_0x50abf5,_0x2b0441){const _0x2a4f5f=a1_0x2a4f();return a1_0x3c42=function(_0x3c42d5,_0x2454c8){_0x3c42d5=_0x3c42d5-0x1ba;let _0xa93bd8=_0x2a4f5f[_0x3c42d5];return _0xa93bd8;},a1_0x3c42(_0x50abf5,_0x2b0441);}const express=require(a1_0x3c7b58(0x1d0)),router=express[a1_0x3c7b58(0x1db)](),{randomUUID}=require('crypto'),storage=multer[a1_0x3c7b58(0x1ef)]({'destination':function(_0x47731a,_0x27c3ac,_0x41c9b8){_0x41c9b8(null,'avatars');}}),upload=multer({'storage':storage});function a1_0x2a4f(){const _0x156515=['post','<p>Welcome\x20to\x20CADViewer</p>','role','Invalid\x20user','renameSync','Welcome\x20to\x20CADViewer','express','insertId','Error!\x20Something\x20went\x20wrong.','promise','Invalid\x20email\x20or\x20password','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','sign','multer','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL\x20WHERE\x20`validation_token`\x20=\x20?','../libs/mysql.js','Router','12JcLcSZ','/update-password','avatar_url','/update-user-info','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)','enableEmailVerification','stack','jwtSecretKey','/login','sendMail','username','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','exports','../CADViewer_config.json','2421812dXfyoK','json','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','status','execute','diskStorage','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','49429296QJNHvB','bcrypt','email','1418188diyCQi','length','compare','Invalid\x20validation\x20token','is_enabled','avatar','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','.png','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','first_name','11IDnfmL','9351DJuVOn','Invalid\x20password','7utIyjs','../libs/mail','8392872OxYfCh','body','5fESxmO','user','path','last_name','crypted_password','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','params','log','24h','/validate-email/','8620310kvAXCd','414915EXGsuB','./avatars','1000OrNWcr','hash','file','frontendUrl','smtpFrom','existsSync','message','User\x20already\x20exists','/validate-email/:token'];a1_0x2a4f=function(){return _0x156515;};return a1_0x2a4f();}router[a1_0x3c7b58(0x1ca)](a1_0x3c7b58(0x1e4),async(_0x2e4280,_0x1e0fd6,_0xacff93)=>{const _0x597291=a1_0x3c7b58;let {email:_0x366318,password:_0x1be563}=_0x2e4280[_0x597291(0x204)];console[_0x597291(0x1bb)]({'email':_0x366318,'password':_0x1be563});let _0x2245cd;try{const [_0x575375]=await conn['promise']()[_0x597291(0x1ee)](_0x597291(0x1d6),[_0x366318]);_0x575375['length']>0x0&&(_0x2245cd=_0x575375[0x0]);}catch(_0x2a4179){console['log']({'err':_0x2a4179}),_0x1e0fd6['status'](0x1f4)[_0x597291(0x1eb)]({'error':_0x597291(0x1d2)});return;}console[_0x597291(0x1bb)](_0x2245cd),console[_0x597291(0x1bb)](_0x1be563),console['log'](_0x2245cd[_0x597291(0x209)]);if(!_0x2245cd||!await bcrypt[_0x597291(0x1f6)](_0x1be563,_0x2245cd[_0x597291(0x209)])){_0x1e0fd6['status'](0x191)[_0x597291(0x1eb)]({'error':_0x597291(0x1d4)});return;}let _0x5029fa;try{_0x5029fa=jwt['sign']({'userId':_0x2245cd['id'],'email':_0x2245cd[_0x597291(0x1f3)]},config[_0x597291(0x1e3)],{'expiresIn':_0x597291(0x1bc)});}catch(_0x1b6974){console['log'](_0x1b6974),_0x1e0fd6[_0x597291(0x1ed)](0x1f4)[_0x597291(0x1eb)]({'error':_0x597291(0x1d2)});return;}_0x1e0fd6[_0x597291(0x1ed)](0xc8)[_0x597291(0x1eb)]({'success':!![],'data':{'userId':_0x2245cd['id'],'username':_0x2245cd[_0x597291(0x1e6)],'first_name':_0x2245cd['first_name'],'last_name':_0x2245cd[_0x597291(0x208)],'email':_0x2245cd['email'],'avatar_url':_0x2245cd[_0x597291(0x1de)],'id':_0x2245cd['id'],'role':_0x2245cd['role'],'token':_0x5029fa}});}),router['post']('/signup',async(_0x26d95a,_0x51c577,_0x48e591)=>{const _0x554505=a1_0x3c7b58,{username:_0x4b6720,email:_0x553393,password:_0x3600e9}=_0x26d95a[_0x554505(0x204)],[_0x4d3983]=await conn['promise']()[_0x554505(0x1ee)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x553393]);if(_0x4d3983[_0x554505(0x1f5)]>0x0){_0x51c577[_0x554505(0x1ed)](0x1a6)[_0x554505(0x1eb)]({'error':_0x554505(0x1c8)});return;}const _0x326746=await bcrypt[_0x554505(0x1c2)](_0x3600e9,0xa);let _0x5bb263=null,_0x7b9375=0x1;config[_0x554505(0x1e1)]&&(_0x5bb263=randomUUID(),_0x7b9375=0x0);let _0x13b83b;try{const [_0xa701c5]=await conn['promise']()['execute'](_0x554505(0x1e0),[_0x4b6720,_0x553393,_0x326746,_0x554505(0x206),_0x7b9375,_0x5bb263]);if(_0xa701c5[_0x554505(0x1d1)]){const [_0x3fe571]=await conn['promise']()[_0x554505(0x1ee)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0xa701c5[_0x554505(0x1d1)]]);_0x3fe571[_0x554505(0x1f5)]>0x0&&(_0x13b83b=_0x3fe571[0x0]);}}catch{_0x51c577[_0x554505(0x1ed)](0x1f4)[_0x554505(0x1eb)]({'error':_0x554505(0x1d2)});return;}let _0x3897e8;try{_0x3897e8=jwt[_0x554505(0x1d7)]({'userId':_0x13b83b['id'],'email':_0x13b83b[_0x554505(0x1f3)]},config[_0x554505(0x1e3)],{'expiresIn':_0x554505(0x1bc)});}catch(_0x39c2c8){_0x51c577[_0x554505(0x1ed)](0x1f4)[_0x554505(0x1eb)]({'error':_0x554505(0x1d2)});return;}const _0x128da9=require(_0x554505(0x202))['transporter'];let _0x37b45a=_0x554505(0x1cb);if(config[_0x554505(0x1e1)]){const _0x3671fa=config[_0x554505(0x1c4)]+_0x554505(0x1bd)+_0x5bb263;_0x37b45a=_0x554505(0x20a)+_0x3671fa+'\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>'+_0x3671fa+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20';const _0x2b01fa={'from':config[_0x554505(0x1c5)],'to':_0x13b83b[_0x554505(0x1f3)],'subject':_0x554505(0x1cf),'text':_0x554505(0x1cf),'html':_0x37b45a};try{await _0x128da9[_0x554505(0x1e5)](_0x2b01fa);}catch(_0xfe1e8c){console[_0x554505(0x1bb)]('===================error==================='),console[_0x554505(0x1bb)](_0xfe1e8c),_0x51c577[_0x554505(0x1ed)](0x1f4)[_0x554505(0x1eb)]({'error':_0x554505(0x1ec),'stack':_0xfe1e8c[_0x554505(0x1e2)],'message':_0xfe1e8c['message']});return;}_0x51c577[_0x554505(0x1ed)](0xc8)['json']({'success':!![],'message':_0x554505(0x1fc)});return;}_0x51c577[_0x554505(0x1ed)](0xc9)[_0x554505(0x1eb)]({'success':!![],'data':{'userId':_0x13b83b['id'],'username':_0x13b83b['username'],'first_name':_0x13b83b[_0x554505(0x1fd)],'last_name':_0x13b83b[_0x554505(0x208)],'email':_0x13b83b[_0x554505(0x1f3)],'avatar_url':_0x13b83b[_0x554505(0x1de)],'id':_0x13b83b['id'],'role':_0x13b83b[_0x554505(0x1cc)],'token':_0x3897e8,'is_enabled':_0x13b83b[_0x554505(0x1f8)]}});}),router['post'](a1_0x3c7b58(0x1c9),async(_0x411b74,_0x1056be)=>{const _0x350a52=a1_0x3c7b58;try{const {token:_0x20413f}=_0x411b74[_0x350a52(0x1ba)],[_0x2007f8]=await conn[_0x350a52(0x1d3)]()[_0x350a52(0x1ee)](_0x350a52(0x1fa),[_0x20413f]);if(_0x2007f8['length']===0x0){_0x1056be['status'](0x194)[_0x350a52(0x1eb)]({'error':_0x350a52(0x1f7)});return;}await conn['promise']()[_0x350a52(0x1ee)](_0x350a52(0x1d9),[_0x20413f]);const _0x1b91ea=jwt[_0x350a52(0x1d7)]({'id':_0x2007f8[0x0]['id'],'email':_0x2007f8[0x0][_0x350a52(0x1f3)]},config['jwtSecretKey'],{'expiresIn':_0x350a52(0x1bc)});_0x1056be['status'](0xc8)[_0x350a52(0x1eb)]({'success':!![],'message':'Email\x20validated\x20successfully','data':{'userId':_0x2007f8[0x0]['id'],'username':_0x2007f8[0x0][_0x350a52(0x1e6)],'first_name':_0x2007f8[0x0][_0x350a52(0x1fd)],'last_name':_0x2007f8[0x0][_0x350a52(0x208)],'email':_0x2007f8[0x0][_0x350a52(0x1f3)],'avatar_url':_0x2007f8[0x0][_0x350a52(0x1de)],'id':_0x2007f8[0x0]['id'],'role':_0x2007f8[0x0][_0x350a52(0x1cc)],'token':_0x1b91ea,'is_enabled':0x1}});}catch(_0x220b35){console[_0x350a52(0x1bb)]('===================error==================='),console[_0x350a52(0x1bb)](_0x220b35),_0x1056be[_0x350a52(0x1ed)](0x1f4)['json']({'error':_0x350a52(0x1d2),'stack':_0x220b35[_0x350a52(0x1e2)],'message':_0x220b35[_0x350a52(0x1c7)]});}}),router[a1_0x3c7b58(0x1ca)](a1_0x3c7b58(0x1dd),verifyToken,async(_0x2884a1,_0x336bc7,_0x1efa41)=>{const _0x46a00b=a1_0x3c7b58,{current_password:_0x19d39a,new_password:_0x3fb3ab}=_0x2884a1[_0x46a00b(0x204)];console['log']({'body':_0x2884a1[_0x46a00b(0x204)]});const _0x559ef7=_0x2884a1[_0x46a00b(0x206)][_0x46a00b(0x1f3)];let _0x4823c7;try{const [_0x534d58]=await conn[_0x46a00b(0x1d3)]()['execute'](_0x46a00b(0x1f0),[_0x559ef7]);if(_0x534d58[_0x46a00b(0x1f5)]>0x0){_0x4823c7=_0x534d58[0x0];if(!await bcrypt[_0x46a00b(0x1f6)](_0x19d39a,_0x4823c7[_0x46a00b(0x209)])){_0x336bc7[_0x46a00b(0x1ed)](0x191)[_0x46a00b(0x1eb)]({'error':_0x46a00b(0x200)});return;}const _0x40be89=await bcrypt[_0x46a00b(0x1c2)](_0x3fb3ab,0xa);await conn[_0x46a00b(0x1d3)]()[_0x46a00b(0x1ee)](_0x46a00b(0x1d5),[_0x40be89,_0x559ef7]),_0x336bc7[_0x46a00b(0x1ed)](0xc8)[_0x46a00b(0x1eb)]({'success':!![]});}}catch(_0x56e27c){console[_0x46a00b(0x1bb)]({'err':_0x56e27c}),_0x336bc7[_0x46a00b(0x1ed)](0x1f4)[_0x46a00b(0x1eb)]({'error':_0x46a00b(0x1d2)});return;}}),router[a1_0x3c7b58(0x1ca)](a1_0x3c7b58(0x1df),upload['single'](a1_0x3c7b58(0x1f9)),verifyToken,async(_0x4d28cc,_0x5ed178,_0x49dee1)=>{const _0x3a3ccf=a1_0x3c7b58,{username:_0x14b95a,first_name:_0x51d677,last_name:_0x37fb9a}=_0x4d28cc[_0x3a3ccf(0x204)],_0x552c43=_0x4d28cc[_0x3a3ccf(0x206)][_0x3a3ccf(0x1f3)];let _0x3faf9d;try{const [_0xf4cbad]=await conn[_0x3a3ccf(0x1d3)]()[_0x3a3ccf(0x1ee)](_0x3a3ccf(0x1f0),[_0x552c43]);_0xf4cbad[_0x3a3ccf(0x1f5)]>0x0&&(_0x3faf9d=_0xf4cbad[0x0]);}catch(_0x37f133){console[_0x3a3ccf(0x1bb)]({'err':_0x37f133}),_0x5ed178['status'](0x1f4)['json']({'error':_0x3a3ccf(0x1d2)});return;}if(!_0x3faf9d){_0x5ed178[_0x3a3ccf(0x1ed)](0x191)[_0x3a3ccf(0x1eb)]({'error':_0x3a3ccf(0x1cd)});return;}console[_0x3a3ccf(0x1bb)]({'req':_0x4d28cc[_0x3a3ccf(0x204)]});let _0x26df8a=_0x3faf9d[_0x3a3ccf(0x1de)];if(_0x4d28cc[_0x3a3ccf(0x1c3)]){const _0x51f77f='avatars/'+randomUUID()+_0x3a3ccf(0x1fb);fs[_0x3a3ccf(0x1ce)](_0x4d28cc[_0x3a3ccf(0x1c3)][_0x3a3ccf(0x207)],'./'+_0x51f77f),_0x26df8a=config['ServerUrl']+'/'+_0x51f77f;}try{await conn[_0x3a3ccf(0x1d3)]()[_0x3a3ccf(0x1ee)](_0x3a3ccf(0x1e7),[_0x14b95a,_0x51d677,_0x37fb9a,_0x26df8a,_0x552c43]);let _0x503eba;try{_0x503eba=jwt[_0x3a3ccf(0x1d7)]({'userId':_0x3faf9d['id'],'email':_0x3faf9d[_0x3a3ccf(0x1f3)]},config['jwtSecretKey'],{'expiresIn':'24h'});}catch(_0x5e18da){console[_0x3a3ccf(0x1bb)](_0x5e18da),_0x5ed178[_0x3a3ccf(0x1ed)](0x1f4)[_0x3a3ccf(0x1eb)]({'error':_0x3a3ccf(0x1d2)});return;}_0x5ed178[_0x3a3ccf(0x1ed)](0xc8)[_0x3a3ccf(0x1eb)]({'success':!![],'data':{'userId':_0x3faf9d['id'],'username':_0x14b95a,'first_name':_0x51d677,'last_name':_0x37fb9a,'email':_0x3faf9d[_0x3a3ccf(0x1f3)],'avatar_url':_0x26df8a,'token':_0x503eba}});}catch(_0x1117ee){console[_0x3a3ccf(0x1bb)]({'err':_0x1117ee}),_0x5ed178['status'](0x1f4)[_0x3a3ccf(0x1eb)]({'error':_0x3a3ccf(0x1d2)});return;}}),module[a1_0x3c7b58(0x1e8)]=router;