const a1_0x2fe933=a1_0x363e;function a1_0x363e(_0xf4b980,_0x5500a8){const _0x9827cb=a1_0x9827();return a1_0x363e=function(_0x363e9a,_0x53915c){_0x363e9a=_0x363e9a-0xc7;let _0x2a0011=_0x9827cb[_0x363e9a];return _0x2a0011;},a1_0x363e(_0xf4b980,_0x5500a8);}(function(_0x3a4745,_0x1640f0){const _0x345902=a1_0x363e,_0x1235db=_0x3a4745();while(!![]){try{const _0x5c0173=-parseInt(_0x345902(0xfd))/0x1*(parseInt(_0x345902(0xca))/0x2)+-parseInt(_0x345902(0x101))/0x3+-parseInt(_0x345902(0xfb))/0x4+parseInt(_0x345902(0xdb))/0x5+-parseInt(_0x345902(0xd6))/0x6*(-parseInt(_0x345902(0xf8))/0x7)+-parseInt(_0x345902(0xdc))/0x8*(-parseInt(_0x345902(0xee))/0x9)+parseInt(_0x345902(0xd9))/0xa;if(_0x5c0173===_0x1640f0)break;else _0x1235db['push'](_0x1235db['shift']());}catch(_0x6a7b1f){_0x1235db['push'](_0x1235db['shift']());}}}(a1_0x9827,0x82bdf));const jwt=require(a1_0x2fe933(0xe5)),bcrypt=require(a1_0x2fe933(0x103)),config=require(a1_0x2fe933(0xd1)),conn=require(a1_0x2fe933(0xe8)),multer=require(a1_0x2fe933(0xd3)),fs=require('fs'),verifyToken=require(a1_0x2fe933(0xf0))[a1_0x2fe933(0xce)];!fs[a1_0x2fe933(0xd4)](a1_0x2fe933(0xe9))&&fs['mkdirSync'](a1_0x2fe933(0xe9));function a1_0x9827(){const _0x14feff=['Router','/update-password','email','verifyToken','log','promise','../CADViewer_config.json','role','multer','existsSync','24h','2415762ktMhIG','hash','path','607150LwKqvR','file','4924025qdAwmF','24ftvRWi','post','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','body','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','jwtSecretKey','sign','/signup','single','jsonwebtoken','Error!\x20Something\x20went\x20wrong.','length','../libs/mysql.js','./avatars','execute','Invalid\x20password','crypted_password','.png','848403gbYtaD','last_name','../libs/jwt','Invalid\x20email\x20or\x20password','first_name','json','express','Invalid\x20user','avatars','status','14aaYgJz','diskStorage','User\x20already\x20exists','2161112pxfbfB','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','1XqtcgX','user','avatar','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','1140963XyyeeE','insertId','bcrypt','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','compare','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','avatar_url','avatars/','1354914WcUovv'];a1_0x9827=function(){return _0x14feff;};return a1_0x9827();}const express=require(a1_0x2fe933(0xf4)),router=express[a1_0x2fe933(0xcb)](),{randomUUID}=require('crypto'),storage=multer[a1_0x2fe933(0xf9)]({'destination':function(_0x4d6b49,_0x4f3b0f,_0x34df49){const _0x5839e6=a1_0x2fe933;_0x34df49(null,_0x5839e6(0xf6));}}),upload=multer({'storage':storage});router[a1_0x2fe933(0xdd)]('/login',async(_0x63dcaa,_0x2ba6dd,_0x20d766)=>{const _0x1a6fe9=a1_0x2fe933;let {email:_0x1ab8cc,password:_0x5b26e7}=_0x63dcaa[_0x1a6fe9(0xdf)];console[_0x1a6fe9(0xcf)]({'email':_0x1ab8cc,'password':_0x5b26e7});let _0x279c52;try{const [_0x51101a]=await conn[_0x1a6fe9(0xd0)]()[_0x1a6fe9(0xea)](_0x1a6fe9(0xe0),[_0x1ab8cc]);_0x51101a[_0x1a6fe9(0xe7)]>0x0&&(_0x279c52=_0x51101a[0x0]);}catch(_0x494da3){console['log']({'err':_0x494da3}),_0x2ba6dd['status'](0x1f4)[_0x1a6fe9(0xf3)]({'error':_0x1a6fe9(0xe6)});return;}console[_0x1a6fe9(0xcf)](_0x279c52),console['log'](_0x5b26e7),console[_0x1a6fe9(0xcf)](_0x279c52[_0x1a6fe9(0xec)]);if(!_0x279c52||!await bcrypt['compare'](_0x5b26e7,_0x279c52[_0x1a6fe9(0xec)])){_0x2ba6dd[_0x1a6fe9(0xf7)](0x191)[_0x1a6fe9(0xf3)]({'error':_0x1a6fe9(0xf1)});return;}let _0x4d2c80;try{_0x4d2c80=jwt[_0x1a6fe9(0xe2)]({'userId':_0x279c52['id'],'email':_0x279c52[_0x1a6fe9(0xcd)]},config['jwtSecretKey'],{'expiresIn':_0x1a6fe9(0xd5)});}catch(_0x212b90){console[_0x1a6fe9(0xcf)](_0x212b90),_0x2ba6dd['status'](0x1f4)[_0x1a6fe9(0xf3)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x2ba6dd[_0x1a6fe9(0xf7)](0xc8)[_0x1a6fe9(0xf3)]({'success':!![],'data':{'userId':_0x279c52['id'],'username':_0x279c52['username'],'first_name':_0x279c52[_0x1a6fe9(0xf2)],'last_name':_0x279c52['last_name'],'email':_0x279c52[_0x1a6fe9(0xcd)],'avatar_url':_0x279c52[_0x1a6fe9(0xc8)],'id':_0x279c52['id'],'role':_0x279c52['role'],'token':_0x4d2c80}});}),router[a1_0x2fe933(0xdd)](a1_0x2fe933(0xe3),async(_0x506a67,_0x2b2ad8,_0x3691bd)=>{const _0x123094=a1_0x2fe933,{username:_0x3fd011,email:_0x3137ea,password:_0x5e76cb}=_0x506a67[_0x123094(0xdf)],[_0x3aeeb3]=await conn[_0x123094(0xd0)]()[_0x123094(0xea)](_0x123094(0x104),[_0x3137ea]);if(_0x3aeeb3[_0x123094(0xe7)]>0x0){_0x2b2ad8[_0x123094(0xf7)](0x1a6)[_0x123094(0xf3)]({'error':_0x123094(0xfa)});return;}const _0x2b52f5=await bcrypt[_0x123094(0xd7)](_0x5e76cb,0xa);try{const [_0x43c465]=await conn[_0x123094(0xd0)]()[_0x123094(0xea)](_0x123094(0x100),[_0x3fd011,_0x3137ea,_0x2b52f5,'user']);if(_0x43c465[_0x123094(0x102)]){const [_0x302613]=await conn[_0x123094(0xd0)]()[_0x123094(0xea)](_0x123094(0xfc),[_0x43c465[_0x123094(0x102)]]);_0x302613['length']>0x0&&(newUser=_0x302613[0x0]);}}catch{_0x2b2ad8[_0x123094(0xf7)](0x1f4)[_0x123094(0xf3)]({'error':_0x123094(0xe6)});return;}let _0x12d4a0;try{_0x12d4a0=jwt[_0x123094(0xe2)]({'userId':newUser['id'],'email':newUser[_0x123094(0xcd)]},config[_0x123094(0xe1)],{'expiresIn':_0x123094(0xd5)});}catch(_0x116497){_0x2b2ad8[_0x123094(0xf7)](0x1f4)[_0x123094(0xf3)]({'error':_0x123094(0xe6)});return;}_0x2b2ad8['status'](0xc9)[_0x123094(0xf3)]({'success':!![],'data':{'userId':newUser['id'],'username':newUser['username'],'first_name':newUser[_0x123094(0xf2)],'last_name':newUser[_0x123094(0xef)],'email':newUser['email'],'avatar_url':newUser[_0x123094(0xc8)],'id':newUser['id'],'role':newUser[_0x123094(0xd2)],'token':_0x12d4a0}});}),router['post'](a1_0x2fe933(0xcc),verifyToken,async(_0x5a10c4,_0x1bc840,_0x3475e3)=>{const _0x4b664a=a1_0x2fe933,{current_password:_0x460404,new_password:_0x3555c6}=_0x5a10c4[_0x4b664a(0xdf)];console[_0x4b664a(0xcf)]({'body':_0x5a10c4[_0x4b664a(0xdf)]});const _0x56ca8d=_0x5a10c4[_0x4b664a(0xfe)]['email'];let _0x4e7cf6;try{const [_0x3ddcb0]=await conn[_0x4b664a(0xd0)]()[_0x4b664a(0xea)](_0x4b664a(0x104),[_0x56ca8d]);if(_0x3ddcb0[_0x4b664a(0xe7)]>0x0){_0x4e7cf6=_0x3ddcb0[0x0];if(!await bcrypt[_0x4b664a(0x105)](_0x460404,_0x4e7cf6[_0x4b664a(0xec)])){_0x1bc840[_0x4b664a(0xf7)](0x191)[_0x4b664a(0xf3)]({'error':_0x4b664a(0xeb)});return;}const _0x5b2c1e=await bcrypt[_0x4b664a(0xd7)](_0x3555c6,0xa);await conn[_0x4b664a(0xd0)]()[_0x4b664a(0xea)](_0x4b664a(0xc7),[_0x5b2c1e,_0x56ca8d]),_0x1bc840['status'](0xc8)[_0x4b664a(0xf3)]({'success':!![]});}}catch(_0x4a15a3){console[_0x4b664a(0xcf)]({'err':_0x4a15a3}),_0x1bc840[_0x4b664a(0xf7)](0x1f4)[_0x4b664a(0xf3)]({'error':_0x4b664a(0xe6)});return;}}),router[a1_0x2fe933(0xdd)]('/update-user-info',upload[a1_0x2fe933(0xe4)](a1_0x2fe933(0xff)),verifyToken,async(_0x2ff66b,_0x194fea,_0x3f3f3a)=>{const _0x1d65a9=a1_0x2fe933,{username:_0x35fd87,first_name:_0x59aca5,last_name:_0xa710a9}=_0x2ff66b[_0x1d65a9(0xdf)],_0x59c18a=_0x2ff66b[_0x1d65a9(0xfe)][_0x1d65a9(0xcd)];let _0xc04410;try{const [_0x4993d6]=await conn[_0x1d65a9(0xd0)]()[_0x1d65a9(0xea)](_0x1d65a9(0x104),[_0x59c18a]);_0x4993d6[_0x1d65a9(0xe7)]>0x0&&(_0xc04410=_0x4993d6[0x0]);}catch(_0x50cefc){console[_0x1d65a9(0xcf)]({'err':_0x50cefc}),_0x194fea['status'](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0xc04410){_0x194fea[_0x1d65a9(0xf7)](0x191)[_0x1d65a9(0xf3)]({'error':_0x1d65a9(0xf5)});return;}console['log']({'req':_0x2ff66b['body']});let _0x1d33d7=_0xc04410[_0x1d65a9(0xc8)];if(_0x2ff66b[_0x1d65a9(0xda)]){const _0x26b279=_0x1d65a9(0xc9)+randomUUID()+_0x1d65a9(0xed);fs['renameSync'](_0x2ff66b[_0x1d65a9(0xda)][_0x1d65a9(0xd8)],'./'+_0x26b279),_0x1d33d7=config['ServerUrl']+'/'+_0x26b279;}try{await conn[_0x1d65a9(0xd0)]()[_0x1d65a9(0xea)](_0x1d65a9(0xde),[_0x35fd87,_0x59aca5,_0xa710a9,_0x1d33d7,_0x59c18a]);let _0x1bad65;try{_0x1bad65=jwt['sign']({'userId':_0xc04410['id'],'email':_0xc04410[_0x1d65a9(0xcd)]},config[_0x1d65a9(0xe1)],{'expiresIn':_0x1d65a9(0xd5)});}catch(_0x266f33){console[_0x1d65a9(0xcf)](_0x266f33),_0x194fea[_0x1d65a9(0xf7)](0x1f4)[_0x1d65a9(0xf3)]({'error':_0x1d65a9(0xe6)});return;}_0x194fea['status'](0xc8)['json']({'success':!![],'data':{'userId':_0xc04410['id'],'username':_0x35fd87,'first_name':_0x59aca5,'last_name':_0xa710a9,'email':_0xc04410[_0x1d65a9(0xcd)],'avatar_url':_0x1d33d7,'token':_0x1bad65}});}catch(_0x19fd12){console['log']({'err':_0x19fd12}),_0x194fea[_0x1d65a9(0xf7)](0x1f4)[_0x1d65a9(0xf3)]({'error':_0x1d65a9(0xe6)});return;}}),module['exports']=router;