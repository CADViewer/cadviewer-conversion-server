const a1_0x313f6c=a1_0x4210;function a1_0x4210(_0xa79f7a,_0x50dcad){const _0x1bd3cd=a1_0x1bd3();return a1_0x4210=function(_0x421035,_0x3a9aa1){_0x421035=_0x421035-0x1df;let _0x2a7f10=_0x1bd3cd[_0x421035];return _0x2a7f10;},a1_0x4210(_0xa79f7a,_0x50dcad);}(function(_0x22a6e4,_0x392adf){const _0x38c80b=a1_0x4210,_0x506d33=_0x22a6e4();while(!![]){try{const _0x4ec02a=-parseInt(_0x38c80b(0x225))/0x1+-parseInt(_0x38c80b(0x221))/0x2*(parseInt(_0x38c80b(0x228))/0x3)+parseInt(_0x38c80b(0x200))/0x4+parseInt(_0x38c80b(0x202))/0x5+parseInt(_0x38c80b(0x227))/0x6*(-parseInt(_0x38c80b(0x1e1))/0x7)+parseInt(_0x38c80b(0x1f3))/0x8+parseInt(_0x38c80b(0x22c))/0x9*(-parseInt(_0x38c80b(0x22a))/0xa);if(_0x4ec02a===_0x392adf)break;else _0x506d33['push'](_0x506d33['shift']());}catch(_0x4726d8){_0x506d33['push'](_0x506d33['shift']());}}}(a1_0x1bd3,0x47310));const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x313f6c(0x1e8)),config=require(a1_0x313f6c(0x1f9)),conn=require(a1_0x313f6c(0x1ee)),multer=require(a1_0x313f6c(0x205)),fs=require('fs'),verifyToken=require(a1_0x313f6c(0x222))['verifyToken'];!fs['existsSync']('./avatars')&&fs['mkdirSync'](a1_0x313f6c(0x1f6));function a1_0x1bd3(){const _0x195d54=['avatars','Invalid\x20validation\x20token','avatar_url','insertId','../libs/mail','post','json','length','frontendUrl','Router','unlinkSync','/validate-email/','mkdirSync','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','/update-password','crypto','avatar','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','is_enabled','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','Invalid\x20password','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','./uploads/','file','email','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','123132kXKFdV','../libs/jwt','Error!\x20Something\x20went\x20wrong.','diskStorage','259542BFRWDz','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','2670vKwdNf','15zhhnia','/update-user-info','10zvIqEN','exports','1397412sOUMFk','endsWith','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','first_name','Welcome\x20to\x20CADViewer','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','<p>Welcome\x20to\x20CADViewer</p>','hash','user','Invalid\x20user','body','smtpFrom','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','===================error===================','/validate-email/:token','42WziKvb','compare','transporter','stack','username','params','slice','bcrypt','message','status','demo_user','24h','express','../libs/mysql.js','last_name','single','ServerUrl','enableEmailVerification','1318480hYCeTI','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','log','./avatars','crypted_password','promise','../CADViewer_config.json','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','path','execute','.png','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','/signup','1519708OGukLu','role','2360865xsKwdq','jwtSecretKey','sign','multer','copyFileSync'];a1_0x1bd3=function(){return _0x195d54;};return a1_0x1bd3();}const express=require(a1_0x313f6c(0x1ed)),router=express[a1_0x313f6c(0x210)](),{randomUUID}=require(a1_0x313f6c(0x216)),storage=multer[a1_0x313f6c(0x224)]({'destination':function(_0x3956f2,_0x171638,_0x204193){const _0x3ef215=a1_0x313f6c;_0x204193(null,_0x3ef215(0x207));}}),upload=multer({'storage':storage});router['post']('/login',async(_0x517adc,_0x551d07,_0x4c9ba0)=>{const _0x105dc6=a1_0x313f6c;let {email:_0x262ef2,password:_0x1d6f77}=_0x517adc['body'];console[_0x105dc6(0x1f5)]({'email':_0x262ef2,'password':_0x1d6f77});let _0x4a0b2f;try{const [_0x3ab3b4]=await conn['promise']()[_0x105dc6(0x1fc)](_0x105dc6(0x1f4),[_0x262ef2]);_0x3ab3b4[_0x105dc6(0x20e)]>0x0&&(_0x4a0b2f=_0x3ab3b4[0x0]);}catch(_0x4f023b){console[_0x105dc6(0x1f5)]({'err':_0x4f023b}),_0x551d07[_0x105dc6(0x1ea)](0x1f4)[_0x105dc6(0x20d)]({'error':_0x105dc6(0x223)});return;}if(!_0x4a0b2f||!await bcrypt[_0x105dc6(0x1e2)](_0x1d6f77,_0x4a0b2f?.[_0x105dc6(0x1f7)])){_0x551d07[_0x105dc6(0x1ea)](0x191)[_0x105dc6(0x20d)]({'error':'Invalid\x20email\x20or\x20password'});return;}let _0x158a24;try{_0x158a24=jwt[_0x105dc6(0x204)]({'userId':_0x4a0b2f['id'],'email':_0x4a0b2f[_0x105dc6(0x21f)]},config['jwtSecretKey'],{'expiresIn':_0x105dc6(0x1ec)});}catch(_0x160475){console[_0x105dc6(0x1f5)](_0x160475),_0x551d07[_0x105dc6(0x1ea)](0x1f4)[_0x105dc6(0x20d)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x551d07[_0x105dc6(0x1ea)](0xc8)[_0x105dc6(0x20d)]({'success':!![],'data':{'userId':_0x4a0b2f['id'],'username':_0x4a0b2f[_0x105dc6(0x1e5)],'first_name':_0x4a0b2f[_0x105dc6(0x22f)],'last_name':_0x4a0b2f[_0x105dc6(0x1ef)],'email':_0x4a0b2f[_0x105dc6(0x21f)],'avatar_url':_0x4a0b2f[_0x105dc6(0x209)],'id':_0x4a0b2f['id'],'role':_0x4a0b2f['role'],'token':_0x158a24}});}),router['post'](a1_0x313f6c(0x1ff),async(_0x43792b,_0x4f551c,_0x1d9fb1)=>{const _0x1a1413=a1_0x313f6c,{username:_0x3b4a48,email:_0x369f51,password:_0x2b99d2}=_0x43792b[_0x1a1413(0x236)],[_0x219b86]=await conn[_0x1a1413(0x1f8)]()[_0x1a1413(0x1fc)](_0x1a1413(0x220),[_0x369f51]);if(_0x219b86[_0x1a1413(0x20e)]>0x0){_0x4f551c[_0x1a1413(0x1ea)](0x1a6)[_0x1a1413(0x20d)]({'error':'User\x20already\x20exists'});return;}const _0x3c99fa=await bcrypt[_0x1a1413(0x233)](_0x2b99d2,0xa);let _0x59223d=null,_0x50545b=0x1;config['enableEmailVerification']&&(_0x59223d=randomUUID(),_0x50545b=0x0);let _0x2b2f1a;try{const _0x3e5c49=randomUUID(),_0x4ab20f=_0x1a1413(0x21d)+_0x3e5c49;fs[_0x1a1413(0x213)](_0x4ab20f);const [_0x26c930]=await conn[_0x1a1413(0x1f8)]()['execute']('INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)',[_0x3b4a48,_0x369f51,_0x3c99fa,_0x1a1413(0x1eb),_0x50545b,_0x59223d,_0x3e5c49]);if(_0x26c930['insertId']){const [_0x58ea70]=await conn[_0x1a1413(0x1f8)]()[_0x1a1413(0x1fc)](_0x1a1413(0x1fe),[_0x26c930[_0x1a1413(0x20a)]]);_0x58ea70[_0x1a1413(0x20e)]>0x0&&(_0x2b2f1a=_0x58ea70[0x0]);}}catch{_0x4f551c[_0x1a1413(0x1ea)](0x1f4)[_0x1a1413(0x20d)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x90ce05;try{_0x90ce05=jwt[_0x1a1413(0x204)]({'userId':_0x2b2f1a['id'],'email':_0x2b2f1a[_0x1a1413(0x21f)]},config[_0x1a1413(0x203)],{'expiresIn':_0x1a1413(0x1ec)});}catch(_0xbbb603){_0x4f551c[_0x1a1413(0x1ea)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}const _0x15495d=require(_0x1a1413(0x20b))[_0x1a1413(0x1e3)];let _0x5a3285=_0x1a1413(0x232);if(config[_0x1a1413(0x1f2)]){var _0x4ea004=config[_0x1a1413(0x20f)];_0x4ea004[_0x1a1413(0x22d)]('/')&&(_0x4ea004=_0x4ea004[_0x1a1413(0x1e7)](0x0,-0x1));const _0x52f7c3=_0x4ea004+_0x1a1413(0x212)+_0x59223d;_0x5a3285=_0x1a1413(0x21c)+_0x52f7c3+_0x1a1413(0x231)+_0x52f7c3+_0x1a1413(0x226);const _0x1466c4={'from':config[_0x1a1413(0x237)],'to':_0x2b2f1a[_0x1a1413(0x21f)],'subject':'Welcome\x20to\x20CADViewer','text':_0x1a1413(0x230),'html':_0x5a3285};try{await _0x15495d['sendMail'](_0x1466c4);}catch(_0x5a96cf){console['log'](_0x1a1413(0x1df)),console[_0x1a1413(0x1f5)](_0x5a96cf),_0x4f551c[_0x1a1413(0x1ea)](0x1f4)[_0x1a1413(0x20d)]({'error':_0x1a1413(0x22e),'stack':_0x5a96cf[_0x1a1413(0x1e4)],'message':_0x5a96cf[_0x1a1413(0x1e9)]});return;}_0x4f551c[_0x1a1413(0x1ea)](0xc8)[_0x1a1413(0x20d)]({'success':!![],'message':_0x1a1413(0x238)});return;}_0x4f551c[_0x1a1413(0x1ea)](0xc9)[_0x1a1413(0x20d)]({'success':!![],'data':{'userId':_0x2b2f1a['id'],'username':_0x2b2f1a[_0x1a1413(0x1e5)],'first_name':_0x2b2f1a[_0x1a1413(0x22f)],'last_name':_0x2b2f1a[_0x1a1413(0x1ef)],'email':_0x2b2f1a[_0x1a1413(0x21f)],'avatar_url':_0x2b2f1a[_0x1a1413(0x209)],'id':_0x2b2f1a['id'],'role':_0x2b2f1a['role'],'token':_0x90ce05,'is_enabled':_0x2b2f1a[_0x1a1413(0x219)]}});}),router[a1_0x313f6c(0x20c)](a1_0x313f6c(0x1e0),async(_0x219b6c,_0x28ef5d)=>{const _0x4852ef=a1_0x313f6c;try{const {token:_0x1790ad}=_0x219b6c[_0x4852ef(0x1e6)],[_0x1fcd89]=await conn[_0x4852ef(0x1f8)]()[_0x4852ef(0x1fc)](_0x4852ef(0x214),[_0x1790ad]);if(_0x1fcd89[_0x4852ef(0x20e)]===0x0){_0x28ef5d['status'](0x194)[_0x4852ef(0x20d)]({'error':_0x4852ef(0x208)});return;}await conn['promise']()[_0x4852ef(0x1fc)](_0x4852ef(0x1fa),[_0x1790ad]);const _0x5787c0=jwt['sign']({'id':_0x1fcd89[0x0]['id'],'email':_0x1fcd89[0x0][_0x4852ef(0x21f)]},config[_0x4852ef(0x203)],{'expiresIn':_0x4852ef(0x1ec)});_0x28ef5d[_0x4852ef(0x1ea)](0xc8)[_0x4852ef(0x20d)]({'success':!![],'message':'Email\x20validated\x20successfully','data':{'userId':_0x1fcd89[0x0]['id'],'username':_0x1fcd89[0x0][_0x4852ef(0x1e5)],'first_name':_0x1fcd89[0x0][_0x4852ef(0x22f)],'last_name':_0x1fcd89[0x0][_0x4852ef(0x1ef)],'email':_0x1fcd89[0x0][_0x4852ef(0x21f)],'avatar_url':_0x1fcd89[0x0][_0x4852ef(0x209)],'id':_0x1fcd89[0x0]['id'],'role':_0x1fcd89[0x0][_0x4852ef(0x201)],'token':_0x5787c0,'is_enabled':0x1}});}catch(_0x382e87){console[_0x4852ef(0x1f5)]('===================error==================='),console[_0x4852ef(0x1f5)](_0x382e87),_0x28ef5d[_0x4852ef(0x1ea)](0x1f4)[_0x4852ef(0x20d)]({'error':_0x4852ef(0x223),'stack':_0x382e87[_0x4852ef(0x1e4)],'message':_0x382e87['message']});}}),router[a1_0x313f6c(0x20c)](a1_0x313f6c(0x215),verifyToken,async(_0x3403ec,_0x44bbcf,_0x63e40b)=>{const _0x4a7141=a1_0x313f6c,{current_password:_0x290836,new_password:_0x19de95}=_0x3403ec['body'];console[_0x4a7141(0x1f5)]({'body':_0x3403ec[_0x4a7141(0x236)]});const _0x1fa854=_0x3403ec[_0x4a7141(0x234)][_0x4a7141(0x21f)];let _0x5be42e;try{const [_0x2b2292]=await conn[_0x4a7141(0x1f8)]()[_0x4a7141(0x1fc)](_0x4a7141(0x220),[_0x1fa854]);if(_0x2b2292[_0x4a7141(0x20e)]>0x0){_0x5be42e=_0x2b2292[0x0];if(!await bcrypt[_0x4a7141(0x1e2)](_0x290836,_0x5be42e[_0x4a7141(0x1f7)])){_0x44bbcf['status'](0x191)[_0x4a7141(0x20d)]({'error':_0x4a7141(0x21b)});return;}const _0x48879d=await bcrypt[_0x4a7141(0x233)](_0x19de95,0xa);await conn[_0x4a7141(0x1f8)]()[_0x4a7141(0x1fc)](_0x4a7141(0x218),[_0x48879d,_0x1fa854]),_0x44bbcf['status'](0xc8)[_0x4a7141(0x20d)]({'success':!![]});}}catch(_0x4d5327){console['log']({'err':_0x4d5327}),_0x44bbcf[_0x4a7141(0x1ea)](0x1f4)[_0x4a7141(0x20d)]({'error':_0x4a7141(0x223)});return;}}),router['post'](a1_0x313f6c(0x229),upload[a1_0x313f6c(0x1f0)](a1_0x313f6c(0x217)),verifyToken,async(_0x4cd81d,_0x34b36a,_0x1442d3)=>{const _0x684076=a1_0x313f6c,{username:_0x1bfbb0,first_name:_0x10a52a,last_name:_0x277eca}=_0x4cd81d['body'],_0x58faaf=_0x4cd81d[_0x684076(0x234)]['email'];let _0x42a61c;try{const [_0x3d203f]=await conn['promise']()['execute'](_0x684076(0x220),[_0x58faaf]);_0x3d203f[_0x684076(0x20e)]>0x0&&(_0x42a61c=_0x3d203f[0x0]);}catch(_0xe1556a){console[_0x684076(0x1f5)]({'err':_0xe1556a}),_0x34b36a[_0x684076(0x1ea)](0x1f4)[_0x684076(0x20d)]({'error':_0x684076(0x223)});return;}if(!_0x42a61c){_0x34b36a[_0x684076(0x1ea)](0x191)['json']({'error':_0x684076(0x235)});return;}console[_0x684076(0x1f5)]({'req':_0x4cd81d[_0x684076(0x236)]});let _0xb91e55=_0x42a61c['avatar_url'];if(_0x4cd81d[_0x684076(0x21e)]){const _0x4795e9='avatars/'+randomUUID()+_0x684076(0x1fd);fs[_0x684076(0x206)](_0x4cd81d[_0x684076(0x21e)][_0x684076(0x1fb)],'./'+_0x4795e9),fs[_0x684076(0x211)](_0x4cd81d[_0x684076(0x21e)][_0x684076(0x1fb)]),_0xb91e55=config[_0x684076(0x1f1)]+'/'+_0x4795e9;}try{await conn['promise']()['execute'](_0x684076(0x21a),[_0x1bfbb0,_0x10a52a,_0x277eca,_0xb91e55,_0x58faaf]);let _0x20b6e2;try{_0x20b6e2=jwt[_0x684076(0x204)]({'userId':_0x42a61c['id'],'email':_0x42a61c[_0x684076(0x21f)]},config[_0x684076(0x203)],{'expiresIn':_0x684076(0x1ec)});}catch(_0x13c864){console['log'](_0x13c864),_0x34b36a[_0x684076(0x1ea)](0x1f4)[_0x684076(0x20d)]({'error':_0x684076(0x223)});return;}_0x34b36a[_0x684076(0x1ea)](0xc8)['json']({'success':!![],'data':{'userId':_0x42a61c['id'],'username':_0x1bfbb0,'first_name':_0x10a52a,'last_name':_0x277eca,'email':_0x42a61c[_0x684076(0x21f)],'avatar_url':_0xb91e55,'token':_0x20b6e2}});}catch(_0x4a80c6){console['log']({'err':_0x4a80c6}),_0x34b36a[_0x684076(0x1ea)](0x1f4)[_0x684076(0x20d)]({'error':_0x684076(0x223)});return;}}),module[a1_0x313f6c(0x22b)]=router;