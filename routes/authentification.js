function a1_0x3d72(){const _0x4a86b1=['Error\x20during\x20user\x20creation:','express','user','https://www.google.com/recaptcha/api/siteverify','region','Invalid\x20email\x20or\x20password','avatars/','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','avatar_url','/login','recaptchaEnabled','post','14072hfrtbz','24h','./avatars','ServerUrl','625436yclMyR','User\x20already\x20exists','10879RPymcw','../libs/email-utils','../CADViewer_config.json','role','email','crypted_password','message','11kwqtGd','city','17789930EMYVGi','avatar','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','sign','../libs/jwt','json','===================error===================','Email\x20validated\x20successfully','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','error','promise','24sCeSSi','530576bAfslM','demo_user','axios','207EhLKnV','3241410CxfJLx','../libs/mysql.js','multer','country_name','Invalid\x20validation\x20token','/signup','insertId','existsSync','hash','Error\x20during\x20reCAPTCHA\x20verification.','languages','status','crypto','body','is_enabled','/update-user-info','compare','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','.png','last_name','stack','Invalid\x20password','path','unlinkSync','enableEmailVerification','Router','/validate-email/:token','log','data','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','Error!\x20Something\x20went\x20wrong.','jwtSecretKey','execute','params','108JBfxrQ','./uploads/','1075524yCAcbS','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','error-codes','verifyToken','Invalid\x20user','length','success','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','mkdirSync','diskStorage','time_zone','name','copyFileSync','file','first_name'];a1_0x3d72=function(){return _0x4a86b1;};return a1_0x3d72();}const a1_0x25bdb6=a1_0x3978;(function(_0xc9c818,_0x247d61){const _0x71b733=a1_0x3978,_0x28a84c=_0xc9c818();while(!![]){try{const _0x517f7d=-parseInt(_0x71b733(0xf0))/0x1*(-parseInt(_0x71b733(0xcd))/0x2)+parseInt(_0x71b733(0xcf))/0x3+parseInt(_0x71b733(0x106))/0x4+parseInt(_0x71b733(0x10a))/0x5+parseInt(_0x71b733(0x105))/0x6*(parseInt(_0x71b733(0xee))/0x7)+parseInt(_0x71b733(0xea))/0x8*(parseInt(_0x71b733(0x109))/0x9)+parseInt(_0x71b733(0xf9))/0xa*(-parseInt(_0x71b733(0xf7))/0xb);if(_0x517f7d===_0x247d61)break;else _0x28a84c['push'](_0x28a84c['shift']());}catch(_0x228325){_0x28a84c['push'](_0x28a84c['shift']());}}}(a1_0x3d72,0x5469c));const jwt=require('jsonwebtoken'),bcrypt=require('bcrypt'),config=require(a1_0x25bdb6(0xf2)),conn=require(a1_0x25bdb6(0x10b)),multer=require(a1_0x25bdb6(0x10c)),fs=require('fs'),verifyToken=require(a1_0x25bdb6(0xfe))[a1_0x25bdb6(0xd2)],{sendWelcomeEmail}=require(a1_0x25bdb6(0xf1)),axios=require(a1_0x25bdb6(0x108));!fs[a1_0x25bdb6(0x111)](a1_0x25bdb6(0xec))&&fs[a1_0x25bdb6(0xd7)]('./avatars');function a1_0x3978(_0x57cf74,_0x20347c){const _0x3d729a=a1_0x3d72();return a1_0x3978=function(_0x397892,_0x424ece){_0x397892=_0x397892-0xbd;let _0x5d39fe=_0x3d729a[_0x397892];return _0x5d39fe;},a1_0x3978(_0x57cf74,_0x20347c);}const express=require(a1_0x25bdb6(0xdf)),router=express[a1_0x25bdb6(0xc4)](),{randomUUID}=require(a1_0x25bdb6(0x116)),storage=multer[a1_0x25bdb6(0xd8)]({'destination':function(_0x39e4bb,_0x216fd2,_0xc908f4){_0xc908f4(null,'avatars');}}),upload=multer({'storage':storage});router[a1_0x25bdb6(0xe9)](a1_0x25bdb6(0xe7),async(_0x5ca242,_0x3a1e6e,_0x5b8065)=>{const _0x1bbf13=a1_0x25bdb6;let {email:_0x316946,password:_0x4cdb43}=_0x5ca242[_0x1bbf13(0x117)];console[_0x1bbf13(0xc6)]({'email':_0x316946,'password':_0x4cdb43});let _0x126cdb;try{const [_0x39dcec]=await conn[_0x1bbf13(0x104)]()[_0x1bbf13(0xcb)](_0x1bbf13(0xd0),[_0x316946]);_0x39dcec['length']>0x0&&(_0x126cdb=_0x39dcec[0x0]);}catch(_0x1d490e){console[_0x1bbf13(0xc6)]({'err':_0x1d490e}),_0x3a1e6e['status'](0x1f4)[_0x1bbf13(0xff)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x126cdb||!await bcrypt[_0x1bbf13(0x11a)](_0x4cdb43,_0x126cdb?.[_0x1bbf13(0xf5)])){_0x3a1e6e['status'](0x191)[_0x1bbf13(0xff)]({'error':_0x1bbf13(0xe3)});return;}let _0x555f9b;try{_0x555f9b=jwt[_0x1bbf13(0xfd)]({'userId':_0x126cdb['id'],'email':_0x126cdb[_0x1bbf13(0xf4)]},config['jwtSecretKey'],{'expiresIn':'24h'});}catch(_0x4e5ab5){console[_0x1bbf13(0xc6)](_0x4e5ab5),_0x3a1e6e[_0x1bbf13(0x115)](0x1f4)[_0x1bbf13(0xff)]({'error':_0x1bbf13(0xc9)});return;}_0x3a1e6e[_0x1bbf13(0x115)](0xc8)[_0x1bbf13(0xff)]({'success':!![],'data':{'userId':_0x126cdb['id'],'username':_0x126cdb['username'],'first_name':_0x126cdb[_0x1bbf13(0xdd)],'last_name':_0x126cdb[_0x1bbf13(0xbe)],'email':_0x126cdb['email'],'avatar_url':_0x126cdb[_0x1bbf13(0xe6)],'id':_0x126cdb['id'],'role':_0x126cdb[_0x1bbf13(0xf3)],'token':_0x555f9b}});}),router[a1_0x25bdb6(0xe9)](a1_0x25bdb6(0x10f),async(_0x55017b,_0x4e152c,_0x4e92f7)=>{const _0x524977=a1_0x25bdb6,{username:_0xe878e4,email:_0x8d5624,password:_0x45de5d,geolocation:_0x913c31,recaptchaToken:_0x1065e2}=_0x55017b[_0x524977(0x117)];if(config[_0x524977(0xe8)]){if(!_0x1065e2)return _0x4e152c['status'](0x190)[_0x524977(0xff)]({'error':'reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.'});try{const _0x3dd614=await axios[_0x524977(0xe9)](_0x524977(0xe1),null,{'params':{'secret':config['recaptchaSecretKey'],'response':_0x1065e2}});if(!_0x3dd614['data'][_0x524977(0xd5)])return _0x4e152c[_0x524977(0x115)](0x190)[_0x524977(0xff)]({'error':_0x524977(0xfb),'recaptchaErrors':_0x3dd614[_0x524977(0xc7)][_0x524977(0xd1)]});}catch(_0x3c4532){return console[_0x524977(0x103)]('reCAPTCHA\x20verification\x20error:',_0x3c4532),_0x4e152c[_0x524977(0x115)](0x1f4)['json']({'error':_0x524977(0x113)});}}const [_0x1245bd]=await conn[_0x524977(0x104)]()[_0x524977(0xcb)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x8d5624]);if(_0x1245bd['length']>0x0){_0x4e152c[_0x524977(0x115)](0x1a6)['json']({'error':_0x524977(0xef)});return;}const _0x33042a=await bcrypt['hash'](_0x45de5d,0xa);let _0x4614c8=null,_0x4bf970=0x1;config[_0x524977(0xc3)]&&(_0x4614c8=randomUUID(),_0x4bf970=0x0);let _0x447ebb=null,_0x3f17d7=null,_0x20ede6=null,_0x498484=null,_0x5012b3=null,_0x5e96be=null;if(_0x913c31)try{const _0x30f49a=_0x913c31;_0x447ebb=_0x30f49a[_0x524977(0xf8)]||null,_0x3f17d7=_0x30f49a[_0x524977(0xe2)]||null,_0x20ede6=_0x30f49a[_0x524977(0x10d)]||null,_0x30f49a[_0x524977(0x114)]&&_0x30f49a[_0x524977(0x114)][_0x524977(0xd4)]>0x0&&(_0x498484=_0x30f49a[_0x524977(0x114)][0x0]['code']||null,_0x5012b3=_0x30f49a[_0x524977(0x114)][0x0][_0x524977(0xda)]||null),_0x30f49a[_0x524977(0xd9)]&&(_0x5e96be=_0x30f49a[_0x524977(0xd9)][_0x524977(0xda)]||null);}catch(_0x337790){console['log']('Error\x20parsing\x20geolocation\x20data:',_0x337790);}let _0x2bfd6a;try{const _0x361943=randomUUID(),_0x48189a=_0x524977(0xce)+_0x361943;fs['mkdirSync'](_0x48189a);const [_0x3d64ff]=await conn[_0x524977(0x104)]()[_0x524977(0xcb)](_0x524977(0x102),[_0xe878e4,_0x8d5624,_0x33042a,_0x524977(0x107),_0x4bf970,_0x4614c8,_0x361943,_0x447ebb,_0x3f17d7,_0x20ede6,_0x498484,_0x5012b3,_0x5e96be]);if(_0x3d64ff[_0x524977(0x110)]){const [_0x350dda]=await conn[_0x524977(0x104)]()[_0x524977(0xcb)](_0x524977(0xfc),[_0x3d64ff[_0x524977(0x110)]]);_0x350dda[_0x524977(0xd4)]>0x0&&(_0x2bfd6a=_0x350dda[0x0]);}}catch(_0x382cce){console['log'](_0x524977(0xde),_0x382cce),_0x4e152c['status'](0x1f4)[_0x524977(0xff)]({'error':_0x524977(0xc9)});return;}let _0xd8a919;try{_0xd8a919=jwt[_0x524977(0xfd)]({'userId':_0x2bfd6a['id'],'email':_0x2bfd6a[_0x524977(0xf4)]},config[_0x524977(0xca)],{'expiresIn':_0x524977(0xeb)});}catch(_0x40360b){_0x4e152c[_0x524977(0x115)](0x1f4)[_0x524977(0xff)]({'error':_0x524977(0xc9)});return;}if(config['enableEmailVerification']){try{await sendWelcomeEmail(_0x2bfd6a,_0x4614c8);}catch(_0x2f442c){console[_0x524977(0xc6)]('===================error==================='),console[_0x524977(0xc6)](_0x2f442c);}_0x4e152c[_0x524977(0x115)](0xc8)['json']({'success':!![],'message':_0x524977(0xc8)});return;}_0x4e152c[_0x524977(0x115)](0xc9)[_0x524977(0xff)]({'success':!![],'data':{'userId':_0x2bfd6a['id'],'username':_0x2bfd6a['username'],'first_name':_0x2bfd6a[_0x524977(0xdd)],'last_name':_0x2bfd6a['last_name'],'email':_0x2bfd6a[_0x524977(0xf4)],'avatar_url':_0x2bfd6a['avatar_url'],'id':_0x2bfd6a['id'],'role':_0x2bfd6a['role'],'token':_0xd8a919,'is_enabled':_0x2bfd6a[_0x524977(0x118)]}});}),router['post'](a1_0x25bdb6(0xc5),async(_0x4bd889,_0x1e0e8d)=>{const _0x4cd8a6=a1_0x25bdb6;try{const {token:_0x3e4d7e}=_0x4bd889[_0x4cd8a6(0xcc)],[_0x5c4af0]=await conn[_0x4cd8a6(0x104)]()[_0x4cd8a6(0xcb)](_0x4cd8a6(0xe5),[_0x3e4d7e]);if(_0x5c4af0['length']===0x0){_0x1e0e8d['status'](0x194)[_0x4cd8a6(0xff)]({'error':_0x4cd8a6(0x10e)});return;}await conn['promise']()[_0x4cd8a6(0xcb)](_0x4cd8a6(0x11b),[_0x3e4d7e]);const _0x548310=jwt[_0x4cd8a6(0xfd)]({'id':_0x5c4af0[0x0]['id'],'email':_0x5c4af0[0x0][_0x4cd8a6(0xf4)]},config['jwtSecretKey'],{'expiresIn':_0x4cd8a6(0xeb)});_0x1e0e8d['status'](0xc8)[_0x4cd8a6(0xff)]({'success':!![],'message':_0x4cd8a6(0x101),'data':{'userId':_0x5c4af0[0x0]['id'],'username':_0x5c4af0[0x0]['username'],'first_name':_0x5c4af0[0x0][_0x4cd8a6(0xdd)],'last_name':_0x5c4af0[0x0][_0x4cd8a6(0xbe)],'email':_0x5c4af0[0x0]['email'],'avatar_url':_0x5c4af0[0x0]['avatar_url'],'id':_0x5c4af0[0x0]['id'],'role':_0x5c4af0[0x0][_0x4cd8a6(0xf3)],'token':_0x548310,'is_enabled':0x1}});}catch(_0xab1205){console[_0x4cd8a6(0xc6)](_0x4cd8a6(0x100)),console[_0x4cd8a6(0xc6)](_0xab1205),_0x1e0e8d['status'](0x1f4)['json']({'error':_0x4cd8a6(0xc9),'stack':_0xab1205[_0x4cd8a6(0xbf)],'message':_0xab1205[_0x4cd8a6(0xf6)]});}}),router[a1_0x25bdb6(0xe9)]('/update-password',verifyToken,async(_0x32de6f,_0x177c97,_0x3549c2)=>{const _0xb9b82e=a1_0x25bdb6,{current_password:_0x29ec92,new_password:_0x4bb173}=_0x32de6f[_0xb9b82e(0x117)];console[_0xb9b82e(0xc6)]({'body':_0x32de6f[_0xb9b82e(0x117)]});const _0xe1656a=_0x32de6f[_0xb9b82e(0xe0)][_0xb9b82e(0xf4)];let _0x1c3626;try{const [_0x5edad1]=await conn['promise']()['execute'](_0xb9b82e(0xd6),[_0xe1656a]);if(_0x5edad1[_0xb9b82e(0xd4)]>0x0){_0x1c3626=_0x5edad1[0x0];if(!await bcrypt['compare'](_0x29ec92,_0x1c3626[_0xb9b82e(0xf5)])){_0x177c97[_0xb9b82e(0x115)](0x191)['json']({'error':_0xb9b82e(0xc0)});return;}const _0x57ba4d=await bcrypt[_0xb9b82e(0x112)](_0x4bb173,0xa);await conn[_0xb9b82e(0x104)]()[_0xb9b82e(0xcb)]('UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x57ba4d,_0xe1656a]),_0x177c97[_0xb9b82e(0x115)](0xc8)[_0xb9b82e(0xff)]({'success':!![]});}}catch(_0x4e7295){console[_0xb9b82e(0xc6)]({'err':_0x4e7295}),_0x177c97['status'](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router['post'](a1_0x25bdb6(0x119),upload['single'](a1_0x25bdb6(0xfa)),verifyToken,async(_0x1a55a2,_0x1e629f,_0x472d6c)=>{const _0x295340=a1_0x25bdb6,{username:_0x2ada51,first_name:_0x4e1acf,last_name:_0x3ff50b}=_0x1a55a2[_0x295340(0x117)],_0x5146e5=_0x1a55a2[_0x295340(0xe0)][_0x295340(0xf4)];let _0xc2f8e1;try{const [_0x2a9b3d]=await conn[_0x295340(0x104)]()[_0x295340(0xcb)](_0x295340(0xd6),[_0x5146e5]);_0x2a9b3d['length']>0x0&&(_0xc2f8e1=_0x2a9b3d[0x0]);}catch(_0x3949ef){console['log']({'err':_0x3949ef}),_0x1e629f[_0x295340(0x115)](0x1f4)['json']({'error':_0x295340(0xc9)});return;}if(!_0xc2f8e1){_0x1e629f[_0x295340(0x115)](0x191)['json']({'error':_0x295340(0xd3)});return;}console['log']({'req':_0x1a55a2[_0x295340(0x117)]});let _0xb41e5b=_0xc2f8e1[_0x295340(0xe6)];if(_0x1a55a2[_0x295340(0xdc)]){const _0x39421f=_0x295340(0xe4)+randomUUID()+_0x295340(0xbd);fs[_0x295340(0xdb)](_0x1a55a2[_0x295340(0xdc)][_0x295340(0xc1)],'./'+_0x39421f),fs[_0x295340(0xc2)](_0x1a55a2[_0x295340(0xdc)][_0x295340(0xc1)]),config['callbackMethod_gatewayUrl_flag']?_0xb41e5b=config['callbackMethod_gatewayUrl']+'/'+_0x39421f:_0xb41e5b=config[_0x295340(0xed)]+'/'+_0x39421f;}try{await conn[_0x295340(0x104)]()[_0x295340(0xcb)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x2ada51,_0x4e1acf,_0x3ff50b,_0xb41e5b,_0x5146e5]);let _0x150164;try{_0x150164=jwt['sign']({'userId':_0xc2f8e1['id'],'email':_0xc2f8e1['email']},config[_0x295340(0xca)],{'expiresIn':_0x295340(0xeb)});}catch(_0x4ebd60){console[_0x295340(0xc6)](_0x4ebd60),_0x1e629f['status'](0x1f4)[_0x295340(0xff)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x1e629f['status'](0xc8)[_0x295340(0xff)]({'success':!![],'data':{'userId':_0xc2f8e1['id'],'username':_0x2ada51,'first_name':_0x4e1acf,'last_name':_0x3ff50b,'email':_0xc2f8e1['email'],'avatar_url':_0xb41e5b,'token':_0x150164}});}catch(_0x4b40fa){console[_0x295340(0xc6)]({'err':_0x4b40fa}),_0x1e629f[_0x295340(0x115)](0x1f4)[_0x295340(0xff)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module['exports']=router;