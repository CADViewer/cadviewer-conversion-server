const a1_0x116748=a1_0x197b;(function(_0x37ff6d,_0x550f5b){const _0x284727=a1_0x197b,_0x3aeafc=_0x37ff6d();while(!![]){try{const _0x2f6153=-parseInt(_0x284727(0x1ff))/0x1*(parseInt(_0x284727(0x1ee))/0x2)+-parseInt(_0x284727(0x1b9))/0x3*(parseInt(_0x284727(0x1f7))/0x4)+-parseInt(_0x284727(0x1d8))/0x5+parseInt(_0x284727(0x1cf))/0x6+parseInt(_0x284727(0x1fa))/0x7+-parseInt(_0x284727(0x1c9))/0x8+parseInt(_0x284727(0x1b7))/0x9;if(_0x2f6153===_0x550f5b)break;else _0x3aeafc['push'](_0x3aeafc['shift']());}catch(_0x97d2c9){_0x3aeafc['push'](_0x3aeafc['shift']());}}}(a1_0xe290,0x622bd));function a1_0xe290(){const _0x2b5979=['.png','ServerUrl','User\x20already\x20exists','24h','1OVymwB','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','existsSync','enableEmailVerification','compare','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','status','/validate-email/:token','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','mkdirSync','8412759wzKUMS','Email\x20validated\x20successfully','6gSHaye','username','Invalid\x20password','./avatars','avatar','avatars/','/login','user','sendMail','avatars','length','log','crypted_password','demo_user','Invalid\x20validation\x20token','express','2690952ZyRujY','Router','===================error===================','json','../CADViewer_config.json','body','806274PMAdBR','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','bcrypt','Invalid\x20email\x20or\x20password','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','email','jwtSecretKey','Invalid\x20user','single','1774015BmiabX','smtpFrom','../libs/mysql.js','/validate-email/','avatar_url','../libs/jwt','/signup','Welcome\x20to\x20CADViewer','Error!\x20Something\x20went\x20wrong.','first_name','post','message','<p>Welcome\x20to\x20CADViewer</p>','file','sign','last_name','./uploads/','execute','promise','is_enabled','multer','transporter','749170EzhdEY','insertId','stack','/update-user-info','/update-password','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','hash','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','jsonwebtoken','14228HJJrKq','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','2840950tMQtQi'];a1_0xe290=function(){return _0x2b5979;};return a1_0xe290();}const jwt=require(a1_0x116748(0x1f6)),bcrypt=require(a1_0x116748(0x1d1)),config=require(a1_0x116748(0x1cd)),conn=require(a1_0x116748(0x1da)),multer=require(a1_0x116748(0x1ec)),fs=require('fs'),verifyToken=require(a1_0x116748(0x1dd))['verifyToken'];!fs[a1_0x116748(0x201)]('./avatars')&&fs[a1_0x116748(0x1b6)](a1_0x116748(0x1bc));function a1_0x197b(_0x1fd1d7,_0x3fee8f){const _0xe290f3=a1_0xe290();return a1_0x197b=function(_0x197b0a,_0x2d7361){_0x197b0a=_0x197b0a-0x1b6;let _0x411ec8=_0xe290f3[_0x197b0a];return _0x411ec8;},a1_0x197b(_0x1fd1d7,_0x3fee8f);}const express=require(a1_0x116748(0x1c8)),router=express[a1_0x116748(0x1ca)](),{randomUUID}=require('crypto'),storage=multer['diskStorage']({'destination':function(_0x369b62,_0x1a3a4e,_0x3e6f64){const _0x292948=a1_0x116748;_0x3e6f64(null,_0x292948(0x1c2));}}),upload=multer({'storage':storage});router[a1_0x116748(0x1e2)](a1_0x116748(0x1bf),async(_0x4b3746,_0xd06c1b,_0x548046)=>{const _0x52a544=a1_0x116748;let {email:_0x2d0cb7,password:_0x3fe9f2}=_0x4b3746[_0x52a544(0x1ce)];console['log']({'email':_0x2d0cb7,'password':_0x3fe9f2});let _0x463387;try{const [_0x4063d3]=await conn[_0x52a544(0x1ea)]()[_0x52a544(0x1e9)](_0x52a544(0x200),[_0x2d0cb7]);_0x4063d3['length']>0x0&&(_0x463387=_0x4063d3[0x0]);}catch(_0x41dde5){console['log']({'err':_0x41dde5}),_0xd06c1b['status'](0x1f4)[_0x52a544(0x1cc)]({'error':_0x52a544(0x1e0)});return;}if(!_0x463387||!await bcrypt[_0x52a544(0x203)](_0x3fe9f2,_0x463387?.['crypted_password'])){_0xd06c1b[_0x52a544(0x206)](0x191)[_0x52a544(0x1cc)]({'error':_0x52a544(0x1d2)});return;}let _0x47429e;try{_0x47429e=jwt[_0x52a544(0x1e6)]({'userId':_0x463387['id'],'email':_0x463387[_0x52a544(0x1d4)]},config[_0x52a544(0x1d5)],{'expiresIn':'24h'});}catch(_0x5a32a9){console[_0x52a544(0x1c4)](_0x5a32a9),_0xd06c1b[_0x52a544(0x206)](0x1f4)[_0x52a544(0x1cc)]({'error':_0x52a544(0x1e0)});return;}_0xd06c1b['status'](0xc8)[_0x52a544(0x1cc)]({'success':!![],'data':{'userId':_0x463387['id'],'username':_0x463387[_0x52a544(0x1ba)],'first_name':_0x463387[_0x52a544(0x1e1)],'last_name':_0x463387[_0x52a544(0x1e7)],'email':_0x463387['email'],'avatar_url':_0x463387[_0x52a544(0x1dc)],'id':_0x463387['id'],'role':_0x463387['role'],'token':_0x47429e}});}),router[a1_0x116748(0x1e2)](a1_0x116748(0x1de),async(_0x3e6e85,_0x56aafc,_0x10b0ae)=>{const _0x1fc5e8=a1_0x116748,{username:_0x1026ef,email:_0x3ff71a,password:_0x5a7d76}=_0x3e6e85[_0x1fc5e8(0x1ce)],[_0x220160]=await conn[_0x1fc5e8(0x1ea)]()[_0x1fc5e8(0x1e9)](_0x1fc5e8(0x205),[_0x3ff71a]);if(_0x220160[_0x1fc5e8(0x1c3)]>0x0){_0x56aafc[_0x1fc5e8(0x206)](0x1a6)['json']({'error':_0x1fc5e8(0x1fd)});return;}const _0x4c7f64=await bcrypt[_0x1fc5e8(0x1f4)](_0x5a7d76,0xa);let _0x26d72a=null,_0xe8ed58=0x1;config[_0x1fc5e8(0x202)]&&(_0x26d72a=randomUUID(),_0xe8ed58=0x0);let _0x17c959;try{const _0x5774c8=randomUUID(),_0x35a7d6=_0x1fc5e8(0x1e8)+_0x5774c8;fs[_0x1fc5e8(0x1b6)](_0x35a7d6);const [_0x34b2c4]=await conn[_0x1fc5e8(0x1ea)]()[_0x1fc5e8(0x1e9)]('INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)',[_0x1026ef,_0x3ff71a,_0x4c7f64,_0x1fc5e8(0x1c6),_0xe8ed58,_0x26d72a,_0x5774c8]);if(_0x34b2c4['insertId']){const [_0x5cec5b]=await conn[_0x1fc5e8(0x1ea)]()['execute'](_0x1fc5e8(0x1d3),[_0x34b2c4[_0x1fc5e8(0x1ef)]]);_0x5cec5b[_0x1fc5e8(0x1c3)]>0x0&&(_0x17c959=_0x5cec5b[0x0]);}}catch{_0x56aafc[_0x1fc5e8(0x206)](0x1f4)[_0x1fc5e8(0x1cc)]({'error':_0x1fc5e8(0x1e0)});return;}let _0x2c20a9;try{_0x2c20a9=jwt[_0x1fc5e8(0x1e6)]({'userId':_0x17c959['id'],'email':_0x17c959[_0x1fc5e8(0x1d4)]},config[_0x1fc5e8(0x1d5)],{'expiresIn':'24h'});}catch(_0x270ab3){_0x56aafc['status'](0x1f4)[_0x1fc5e8(0x1cc)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}const _0x1b2bc2=require('../libs/mail')[_0x1fc5e8(0x1ed)];let _0x1599ed=_0x1fc5e8(0x1e4);if(config[_0x1fc5e8(0x202)]){const _0xd3b340=config['frontendUrl']+_0x1fc5e8(0x1db)+_0x26d72a;_0x1599ed='\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22'+_0xd3b340+_0x1fc5e8(0x208)+_0xd3b340+_0x1fc5e8(0x1f3);const _0x4623c8={'from':config[_0x1fc5e8(0x1d9)],'to':_0x17c959[_0x1fc5e8(0x1d4)],'subject':_0x1fc5e8(0x1df),'text':'Welcome\x20to\x20CADViewer','html':_0x1599ed};try{await _0x1b2bc2[_0x1fc5e8(0x1c1)](_0x4623c8);}catch(_0x484c1c){console[_0x1fc5e8(0x1c4)]('===================error==================='),console[_0x1fc5e8(0x1c4)](_0x484c1c),_0x56aafc[_0x1fc5e8(0x206)](0x1f4)[_0x1fc5e8(0x1cc)]({'error':_0x1fc5e8(0x1f8),'stack':_0x484c1c[_0x1fc5e8(0x1f0)],'message':_0x484c1c[_0x1fc5e8(0x1e3)]});return;}_0x56aafc[_0x1fc5e8(0x206)](0xc8)[_0x1fc5e8(0x1cc)]({'success':!![],'message':_0x1fc5e8(0x1d0)});return;}_0x56aafc[_0x1fc5e8(0x206)](0xc9)[_0x1fc5e8(0x1cc)]({'success':!![],'data':{'userId':_0x17c959['id'],'username':_0x17c959['username'],'first_name':_0x17c959[_0x1fc5e8(0x1e1)],'last_name':_0x17c959[_0x1fc5e8(0x1e7)],'email':_0x17c959[_0x1fc5e8(0x1d4)],'avatar_url':_0x17c959[_0x1fc5e8(0x1dc)],'id':_0x17c959['id'],'role':_0x17c959['role'],'token':_0x2c20a9,'is_enabled':_0x17c959[_0x1fc5e8(0x1eb)]}});}),router[a1_0x116748(0x1e2)](a1_0x116748(0x207),async(_0x58bb1e,_0x5204fc)=>{const _0x4edc4a=a1_0x116748;try{const {token:_0x16eb3a}=_0x58bb1e['params'],[_0x2f517d]=await conn[_0x4edc4a(0x1ea)]()[_0x4edc4a(0x1e9)](_0x4edc4a(0x1f9),[_0x16eb3a]);if(_0x2f517d[_0x4edc4a(0x1c3)]===0x0){_0x5204fc[_0x4edc4a(0x206)](0x194)['json']({'error':_0x4edc4a(0x1c7)});return;}await conn[_0x4edc4a(0x1ea)]()[_0x4edc4a(0x1e9)](_0x4edc4a(0x204),[_0x16eb3a]);const _0xa57db2=jwt[_0x4edc4a(0x1e6)]({'id':_0x2f517d[0x0]['id'],'email':_0x2f517d[0x0][_0x4edc4a(0x1d4)]},config[_0x4edc4a(0x1d5)],{'expiresIn':'24h'});_0x5204fc['status'](0xc8)[_0x4edc4a(0x1cc)]({'success':!![],'message':_0x4edc4a(0x1b8),'data':{'userId':_0x2f517d[0x0]['id'],'username':_0x2f517d[0x0]['username'],'first_name':_0x2f517d[0x0][_0x4edc4a(0x1e1)],'last_name':_0x2f517d[0x0][_0x4edc4a(0x1e7)],'email':_0x2f517d[0x0]['email'],'avatar_url':_0x2f517d[0x0][_0x4edc4a(0x1dc)],'id':_0x2f517d[0x0]['id'],'role':_0x2f517d[0x0]['role'],'token':_0xa57db2,'is_enabled':0x1}});}catch(_0x4e0e2d){console[_0x4edc4a(0x1c4)](_0x4edc4a(0x1cb)),console[_0x4edc4a(0x1c4)](_0x4e0e2d),_0x5204fc[_0x4edc4a(0x206)](0x1f4)[_0x4edc4a(0x1cc)]({'error':_0x4edc4a(0x1e0),'stack':_0x4e0e2d[_0x4edc4a(0x1f0)],'message':_0x4e0e2d['message']});}}),router[a1_0x116748(0x1e2)](a1_0x116748(0x1f2),verifyToken,async(_0x34430e,_0x31f7b6,_0x5c1087)=>{const _0x561432=a1_0x116748,{current_password:_0x32d9b6,new_password:_0x19b967}=_0x34430e[_0x561432(0x1ce)];console[_0x561432(0x1c4)]({'body':_0x34430e['body']});const _0x2f8133=_0x34430e[_0x561432(0x1c0)]['email'];let _0x3c8e77;try{const [_0x8fc06b]=await conn[_0x561432(0x1ea)]()[_0x561432(0x1e9)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x2f8133]);if(_0x8fc06b['length']>0x0){_0x3c8e77=_0x8fc06b[0x0];if(!await bcrypt[_0x561432(0x203)](_0x32d9b6,_0x3c8e77[_0x561432(0x1c5)])){_0x31f7b6['status'](0x191)[_0x561432(0x1cc)]({'error':_0x561432(0x1bb)});return;}const _0xb5c182=await bcrypt['hash'](_0x19b967,0xa);await conn[_0x561432(0x1ea)]()[_0x561432(0x1e9)]('UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0xb5c182,_0x2f8133]),_0x31f7b6['status'](0xc8)['json']({'success':!![]});}}catch(_0x53291b){console[_0x561432(0x1c4)]({'err':_0x53291b}),_0x31f7b6[_0x561432(0x206)](0x1f4)[_0x561432(0x1cc)]({'error':_0x561432(0x1e0)});return;}}),router[a1_0x116748(0x1e2)](a1_0x116748(0x1f1),upload[a1_0x116748(0x1d7)](a1_0x116748(0x1bd)),verifyToken,async(_0x37d0c5,_0x1657da,_0x1b8f32)=>{const _0x11b896=a1_0x116748,{username:_0x4bf33d,first_name:_0x1dcf46,last_name:_0x28db16}=_0x37d0c5[_0x11b896(0x1ce)],_0x92bdb3=_0x37d0c5[_0x11b896(0x1c0)][_0x11b896(0x1d4)];let _0x90b9ab;try{const [_0x342afd]=await conn[_0x11b896(0x1ea)]()[_0x11b896(0x1e9)](_0x11b896(0x205),[_0x92bdb3]);_0x342afd[_0x11b896(0x1c3)]>0x0&&(_0x90b9ab=_0x342afd[0x0]);}catch(_0xea502c){console[_0x11b896(0x1c4)]({'err':_0xea502c}),_0x1657da[_0x11b896(0x206)](0x1f4)[_0x11b896(0x1cc)]({'error':_0x11b896(0x1e0)});return;}if(!_0x90b9ab){_0x1657da[_0x11b896(0x206)](0x191)['json']({'error':_0x11b896(0x1d6)});return;}console[_0x11b896(0x1c4)]({'req':_0x37d0c5[_0x11b896(0x1ce)]});let _0x25de2b=_0x90b9ab[_0x11b896(0x1dc)];if(_0x37d0c5['file']){const _0x10abcc=_0x11b896(0x1be)+randomUUID()+_0x11b896(0x1fb);fs['renameSync'](_0x37d0c5[_0x11b896(0x1e5)]['path'],'./'+_0x10abcc),_0x25de2b=config[_0x11b896(0x1fc)]+'/'+_0x10abcc;}try{await conn[_0x11b896(0x1ea)]()[_0x11b896(0x1e9)](_0x11b896(0x1f5),[_0x4bf33d,_0x1dcf46,_0x28db16,_0x25de2b,_0x92bdb3]);let _0x3ac13e;try{_0x3ac13e=jwt[_0x11b896(0x1e6)]({'userId':_0x90b9ab['id'],'email':_0x90b9ab[_0x11b896(0x1d4)]},config[_0x11b896(0x1d5)],{'expiresIn':_0x11b896(0x1fe)});}catch(_0x3f6371){console[_0x11b896(0x1c4)](_0x3f6371),_0x1657da['status'](0x1f4)['json']({'error':_0x11b896(0x1e0)});return;}_0x1657da[_0x11b896(0x206)](0xc8)['json']({'success':!![],'data':{'userId':_0x90b9ab['id'],'username':_0x4bf33d,'first_name':_0x1dcf46,'last_name':_0x28db16,'email':_0x90b9ab['email'],'avatar_url':_0x25de2b,'token':_0x3ac13e}});}catch(_0x37b23a){console[_0x11b896(0x1c4)]({'err':_0x37b23a}),_0x1657da[_0x11b896(0x206)](0x1f4)[_0x11b896(0x1cc)]({'error':_0x11b896(0x1e0)});return;}}),module['exports']=router;