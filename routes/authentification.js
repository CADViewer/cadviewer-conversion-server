const a1_0x85aac8=a1_0x1dde;(function(_0x5b0688,_0x53b3d6){const _0x2580f7=a1_0x1dde,_0x28b599=_0x5b0688();while(!![]){try{const _0x5c9699=parseInt(_0x2580f7(0x116))/0x1*(parseInt(_0x2580f7(0xeb))/0x2)+-parseInt(_0x2580f7(0x117))/0x3*(-parseInt(_0x2580f7(0xfe))/0x4)+-parseInt(_0x2580f7(0xde))/0x5*(-parseInt(_0x2580f7(0xf9))/0x6)+parseInt(_0x2580f7(0xdb))/0x7+parseInt(_0x2580f7(0x10d))/0x8+parseInt(_0x2580f7(0x112))/0x9*(-parseInt(_0x2580f7(0xdd))/0xa)+-parseInt(_0x2580f7(0xfc))/0xb*(parseInt(_0x2580f7(0xe4))/0xc);if(_0x5c9699===_0x53b3d6)break;else _0x28b599['push'](_0x28b599['shift']());}catch(_0x3c89d5){_0x28b599['push'](_0x28b599['shift']());}}}(a1_0x580a,0x631b6));function a1_0x1dde(_0x4658bf,_0x5d8c42){const _0x580ab7=a1_0x580a();return a1_0x1dde=function(_0x1dde9f,_0x322d99){_0x1dde9f=_0x1dde9f-0xcd;let _0x53d578=_0x580ab7[_0x1dde9f];return _0x53d578;},a1_0x1dde(_0x4658bf,_0x5d8c42);}const jwt=require(a1_0x85aac8(0x115)),bcrypt=require(a1_0x85aac8(0x111)),config=require(a1_0x85aac8(0xe6)),conn=require(a1_0x85aac8(0xfa)),multer=require('multer'),fs=require('fs'),verifyToken=require(a1_0x85aac8(0xe2))[a1_0x85aac8(0xe7)];!fs[a1_0x85aac8(0xe1)](a1_0x85aac8(0xd2))&&fs[a1_0x85aac8(0xf0)](a1_0x85aac8(0xd2));function a1_0x580a(){const _0xece40=['11rlLUua','exports','301868eCofCp','.png','24h','diskStorage','Invalid\x20password','/signup','is_enabled','/validate-email/','user','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL\x20WHERE\x20`validation_token`\x20=\x20?','express','/login','<p>Welcome\x20to\x20CADViewer</p>','hash','insertId','2205488ltxosT','email','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','length','bcrypt','387jSIkRo','first_name','log','jsonwebtoken','162993nAAIiL','21JpDJCe','ServerUrl','Invalid\x20validation\x20token','promise','last_name','Invalid\x20email\x20or\x20password','Error!\x20Something\x20went\x20wrong.','/update-password','status','post','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','./avatars','Invalid\x20user','response','role','jwtSecretKey','smtpFrom','compare','json','enableEmailVerification','5473762VVxaqD','crypted_password','23980KLgmwl','5gFJYhO','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','file','existsSync','../libs/jwt','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','23337348PIXJtw','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','../CADViewer_config.json','verifyToken','renameSync','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)','6QJEKzU','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','sign','params','Welcome\x20to\x20CADViewer','mkdirSync','User\x20already\x20exists','sendMail','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','avatar_url','execute','single','body','/update-user-info','2273610fgOGDR','../libs/mysql.js','username'];a1_0x580a=function(){return _0xece40;};return a1_0x580a();}const express=require(a1_0x85aac8(0x108)),router=express['Router'](),{randomUUID}=require('crypto'),storage=multer[a1_0x85aac8(0x101)]({'destination':function(_0x587557,_0x3389b3,_0x5f15e7){_0x5f15e7(null,'avatars');}}),upload=multer({'storage':storage});router[a1_0x85aac8(0xd0)](a1_0x85aac8(0x109),async(_0x39418a,_0x31c935,_0x1beb09)=>{const _0x294ddd=a1_0x85aac8;let {email:_0x432cf,password:_0x1da682}=_0x39418a['body'];console[_0x294ddd(0x114)]({'email':_0x432cf,'password':_0x1da682});let _0x2e3ece;try{const [_0x4060e3]=await conn[_0x294ddd(0x11a)]()[_0x294ddd(0xf5)](_0x294ddd(0xe5),[_0x432cf]);_0x4060e3[_0x294ddd(0x110)]>0x0&&(_0x2e3ece=_0x4060e3[0x0]);}catch(_0x31e089){console[_0x294ddd(0x114)]({'err':_0x31e089}),_0x31c935[_0x294ddd(0xcf)](0x1f4)['json']({'error':_0x294ddd(0xcd)});return;}console[_0x294ddd(0x114)](_0x2e3ece),console[_0x294ddd(0x114)](_0x1da682),console['log'](_0x2e3ece[_0x294ddd(0xdc)]);if(!_0x2e3ece||!await bcrypt['compare'](_0x1da682,_0x2e3ece[_0x294ddd(0xdc)])){_0x31c935['status'](0x191)['json']({'error':_0x294ddd(0x11c)});return;}let _0x595939;try{_0x595939=jwt[_0x294ddd(0xed)]({'userId':_0x2e3ece['id'],'email':_0x2e3ece[_0x294ddd(0x10e)]},config[_0x294ddd(0xd6)],{'expiresIn':_0x294ddd(0x100)});}catch(_0x205d27){console[_0x294ddd(0x114)](_0x205d27),_0x31c935[_0x294ddd(0xcf)](0x1f4)[_0x294ddd(0xd9)]({'error':_0x294ddd(0xcd)});return;}_0x31c935[_0x294ddd(0xcf)](0xc8)[_0x294ddd(0xd9)]({'success':!![],'data':{'userId':_0x2e3ece['id'],'username':_0x2e3ece[_0x294ddd(0xfb)],'first_name':_0x2e3ece['first_name'],'last_name':_0x2e3ece[_0x294ddd(0x11b)],'email':_0x2e3ece[_0x294ddd(0x10e)],'avatar_url':_0x2e3ece[_0x294ddd(0xf4)],'id':_0x2e3ece['id'],'role':_0x2e3ece[_0x294ddd(0xd5)],'token':_0x595939}});}),router[a1_0x85aac8(0xd0)](a1_0x85aac8(0x103),async(_0x316ea3,_0x96949c,_0x22caac)=>{const _0x237a17=a1_0x85aac8,{username:_0xa10bcf,email:_0x182bc3,password:_0x2bb1f0}=_0x316ea3[_0x237a17(0xf7)],[_0x1cbaea]=await conn[_0x237a17(0x11a)]()['execute'](_0x237a17(0xd1),[_0x182bc3]);if(_0x1cbaea['length']>0x0){_0x96949c[_0x237a17(0xcf)](0x1a6)[_0x237a17(0xd9)]({'error':_0x237a17(0xf1)});return;}const _0x5b8dca=await bcrypt['hash'](_0x2bb1f0,0xa);let _0x5451ef=null,_0x450efe=0x1;config[_0x237a17(0xda)]&&(_0x5451ef=randomUUID(),_0x450efe=0x0);let _0x5437d9;try{const [_0x435a7b]=await conn[_0x237a17(0x11a)]()[_0x237a17(0xf5)](_0x237a17(0xea),[_0xa10bcf,_0x182bc3,_0x5b8dca,_0x237a17(0x106),_0x450efe,_0x5451ef]);if(_0x435a7b[_0x237a17(0x10c)]){const [_0x3c0e09]=await conn[_0x237a17(0x11a)]()[_0x237a17(0xf5)](_0x237a17(0x10f),[_0x435a7b[_0x237a17(0x10c)]]);_0x3c0e09[_0x237a17(0x110)]>0x0&&(_0x5437d9=_0x3c0e09[0x0]);}}catch{_0x96949c['status'](0x1f4)['json']({'error':_0x237a17(0xcd)});return;}let _0x3330a4;try{_0x3330a4=jwt['sign']({'userId':_0x5437d9['id'],'email':_0x5437d9[_0x237a17(0x10e)]},config[_0x237a17(0xd6)],{'expiresIn':_0x237a17(0x100)});}catch(_0x334c3d){_0x96949c[_0x237a17(0xcf)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}const _0x29018a=require('../libs/mail')['transporter'];let _0x5cba92=_0x237a17(0x10a);if(config['enableEmailVerification']){const _0x7b95b9=config['frontendUrl']+_0x237a17(0x105)+_0x5451ef;_0x5cba92=_0x237a17(0xec)+_0x7b95b9+'\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>'+_0x7b95b9+_0x237a17(0xdf);const _0x4c73df={'from':config[_0x237a17(0xd7)],'to':_0x5437d9[_0x237a17(0x10e)],'subject':_0x237a17(0xef),'text':_0x237a17(0xef),'html':_0x5cba92};_0x29018a[_0x237a17(0xf2)](_0x4c73df,(_0x5920b3,_0x5bbe40)=>{const _0x24ae78=_0x237a17;_0x5920b3?console[_0x24ae78(0x114)](_0x5920b3):console['log']('Email\x20sent:\x20'+_0x5bbe40[_0x24ae78(0xd4)]);}),_0x96949c[_0x237a17(0xcf)](0xc8)[_0x237a17(0xd9)]({'success':!![],'message':_0x237a17(0xe3)});return;}_0x96949c['status'](0xc9)[_0x237a17(0xd9)]({'success':!![],'data':{'userId':_0x5437d9['id'],'username':_0x5437d9[_0x237a17(0xfb)],'first_name':_0x5437d9[_0x237a17(0x113)],'last_name':_0x5437d9['last_name'],'email':_0x5437d9[_0x237a17(0x10e)],'avatar_url':_0x5437d9['avatar_url'],'id':_0x5437d9['id'],'role':_0x5437d9[_0x237a17(0xd5)],'token':_0x3330a4,'is_enabled':_0x5437d9[_0x237a17(0x104)]}});}),router[a1_0x85aac8(0xd0)]('/validate-email/:token',async(_0x506fd1,_0x490424)=>{const _0x175f71=a1_0x85aac8;try{const {token:_0x5e8beb}=_0x506fd1[_0x175f71(0xee)],[_0x313fce]=await conn[_0x175f71(0x11a)]()[_0x175f71(0xf5)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?',[_0x5e8beb]);if(_0x313fce[_0x175f71(0x110)]===0x0){_0x490424[_0x175f71(0xcf)](0x194)[_0x175f71(0xd9)]({'error':_0x175f71(0x119)});return;}await conn[_0x175f71(0x11a)]()[_0x175f71(0xf5)](_0x175f71(0x107),[_0x5e8beb]);const _0x246923=jwt[_0x175f71(0xed)]({'id':_0x313fce[0x0]['id'],'email':_0x313fce[0x0][_0x175f71(0x10e)]},config[_0x175f71(0xd6)],{'expiresIn':_0x175f71(0x100)});_0x490424['status'](0xc8)[_0x175f71(0xd9)]({'success':!![],'message':'Email\x20validated\x20successfully','data':{'userId':_0x313fce[0x0]['id'],'username':_0x313fce[0x0]['username'],'first_name':_0x313fce[0x0][_0x175f71(0x113)],'last_name':_0x313fce[0x0]['last_name'],'email':_0x313fce[0x0][_0x175f71(0x10e)],'avatar_url':_0x313fce[0x0]['avatar_url'],'id':_0x313fce[0x0]['id'],'role':_0x313fce[0x0][_0x175f71(0xd5)],'token':_0x246923,'is_enabled':0x1}});}catch(_0xeb3208){console[_0x175f71(0x114)](_0xeb3208),_0x490424[_0x175f71(0xcf)](0x1f4)[_0x175f71(0xd9)]({'error':'Error!\x20Something\x20went\x20wrong.'});}}),router[a1_0x85aac8(0xd0)](a1_0x85aac8(0xce),verifyToken,async(_0x41d3e4,_0x50b975,_0x57b9c5)=>{const _0x24f51b=a1_0x85aac8,{current_password:_0x1a0d90,new_password:_0x4c76e8}=_0x41d3e4['body'];console['log']({'body':_0x41d3e4[_0x24f51b(0xf7)]});const _0x59dfab=_0x41d3e4[_0x24f51b(0x106)][_0x24f51b(0x10e)];let _0x1082c4;try{const [_0x38ea6e]=await conn[_0x24f51b(0x11a)]()[_0x24f51b(0xf5)](_0x24f51b(0xd1),[_0x59dfab]);if(_0x38ea6e[_0x24f51b(0x110)]>0x0){_0x1082c4=_0x38ea6e[0x0];if(!await bcrypt[_0x24f51b(0xd8)](_0x1a0d90,_0x1082c4[_0x24f51b(0xdc)])){_0x50b975['status'](0x191)[_0x24f51b(0xd9)]({'error':_0x24f51b(0x102)});return;}const _0x28dc5b=await bcrypt[_0x24f51b(0x10b)](_0x4c76e8,0xa);await conn[_0x24f51b(0x11a)]()[_0x24f51b(0xf5)](_0x24f51b(0xe9),[_0x28dc5b,_0x59dfab]),_0x50b975['status'](0xc8)[_0x24f51b(0xd9)]({'success':!![]});}}catch(_0x149b1e){console[_0x24f51b(0x114)]({'err':_0x149b1e}),_0x50b975[_0x24f51b(0xcf)](0x1f4)['json']({'error':_0x24f51b(0xcd)});return;}}),router['post'](a1_0x85aac8(0xf8),upload[a1_0x85aac8(0xf6)]('avatar'),verifyToken,async(_0xae58a5,_0x18825e,_0x642984)=>{const _0x8266de=a1_0x85aac8,{username:_0x1442f2,first_name:_0x3ab285,last_name:_0x59387f}=_0xae58a5[_0x8266de(0xf7)],_0x57e700=_0xae58a5['user'][_0x8266de(0x10e)];let _0x1c4c3e;try{const [_0x3181c0]=await conn[_0x8266de(0x11a)]()[_0x8266de(0xf5)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x57e700]);_0x3181c0['length']>0x0&&(_0x1c4c3e=_0x3181c0[0x0]);}catch(_0x39da05){console[_0x8266de(0x114)]({'err':_0x39da05}),_0x18825e[_0x8266de(0xcf)](0x1f4)[_0x8266de(0xd9)]({'error':_0x8266de(0xcd)});return;}if(!_0x1c4c3e){_0x18825e[_0x8266de(0xcf)](0x191)[_0x8266de(0xd9)]({'error':_0x8266de(0xd3)});return;}console['log']({'req':_0xae58a5[_0x8266de(0xf7)]});let _0x34ba4b=_0x1c4c3e[_0x8266de(0xf4)];if(_0xae58a5[_0x8266de(0xe0)]){const _0x5d861c='avatars/'+randomUUID()+_0x8266de(0xff);fs[_0x8266de(0xe8)](_0xae58a5[_0x8266de(0xe0)]['path'],'./'+_0x5d861c),_0x34ba4b=config[_0x8266de(0x118)]+'/'+_0x5d861c;}try{await conn[_0x8266de(0x11a)]()[_0x8266de(0xf5)](_0x8266de(0xf3),[_0x1442f2,_0x3ab285,_0x59387f,_0x34ba4b,_0x57e700]);let _0x228c78;try{_0x228c78=jwt[_0x8266de(0xed)]({'userId':_0x1c4c3e['id'],'email':_0x1c4c3e['email']},config[_0x8266de(0xd6)],{'expiresIn':_0x8266de(0x100)});}catch(_0x126de6){console[_0x8266de(0x114)](_0x126de6),_0x18825e['status'](0x1f4)[_0x8266de(0xd9)]({'error':_0x8266de(0xcd)});return;}_0x18825e[_0x8266de(0xcf)](0xc8)['json']({'success':!![],'data':{'userId':_0x1c4c3e['id'],'username':_0x1442f2,'first_name':_0x3ab285,'last_name':_0x59387f,'email':_0x1c4c3e[_0x8266de(0x10e)],'avatar_url':_0x34ba4b,'token':_0x228c78}});}catch(_0x234726){console[_0x8266de(0x114)]({'err':_0x234726}),_0x18825e[_0x8266de(0xcf)](0x1f4)[_0x8266de(0xd9)]({'error':_0x8266de(0xcd)});return;}}),module[a1_0x85aac8(0xfd)]=router;