function a1_0x1d88(){const _0x393c4f=['../libs/jwt','multer','username','Invalid\x20user','2268984foQEnG','./avatars','sign','last_name','137322JCEfwv','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)','exports','avatars/','enableEmailVerification','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','frontendUrl','user','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','status','1tlKgLS','Router','renameSync','diskStorage','Error!\x20Something\x20went\x20wrong.','hash','.png','promise','email','1168238LCgVaU','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','../libs/mail','avatar','avatars','crypted_password','file','role','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','Welcome\x20to\x20CADViewer','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','Email\x20validated\x20successfully','3980VdcaGl','message','json','Invalid\x20password','24h','2961945JICYDE','is_enabled','15850vlptPN','insertId','params','log','post','compare','transporter','jwtSecretKey','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','../CADViewer_config.json','express','execute','sendMail','first_name','verifyToken','4545TRMaVO','/validate-email/','/login','548zqSicl','/update-user-info','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL\x20WHERE\x20`validation_token`\x20=\x20?','avatar_url','Invalid\x20email\x20or\x20password','/update-password','body','===================error===================','Invalid\x20validation\x20token','ServerUrl','length','../libs/mysql.js','739941tntqlS'];a1_0x1d88=function(){return _0x393c4f;};return a1_0x1d88();}const a1_0x4f7336=a1_0x1636;(function(_0x5c510f,_0x38e15f){const _0x1ae9d9=a1_0x1636,_0x3f1638=_0x5c510f();while(!![]){try{const _0x4e0efb=parseInt(_0x1ae9d9(0xda))/0x1*(parseInt(_0x1ae9d9(0xe3))/0x2)+-parseInt(_0x1ae9d9(0x116))/0x3+parseInt(_0x1ae9d9(0x109))/0x4*(-parseInt(_0x1ae9d9(0xef))/0x5)+-parseInt(_0x1ae9d9(0x11f))/0x6+-parseInt(_0x1ae9d9(0xf4))/0x7+-parseInt(_0x1ae9d9(0x11b))/0x8+-parseInt(_0x1ae9d9(0x106))/0x9*(-parseInt(_0x1ae9d9(0xf6))/0xa);if(_0x4e0efb===_0x38e15f)break;else _0x3f1638['push'](_0x3f1638['shift']());}catch(_0x227c54){_0x3f1638['push'](_0x3f1638['shift']());}}}(a1_0x1d88,0x490c0));const jwt=require('jsonwebtoken'),bcrypt=require('bcrypt'),config=require(a1_0x4f7336(0x100)),conn=require(a1_0x4f7336(0x115)),multer=require(a1_0x4f7336(0x118)),fs=require('fs'),verifyToken=require(a1_0x4f7336(0x117))[a1_0x4f7336(0x105)];function a1_0x1636(_0x1357a9,_0x398e06){const _0x1d88d7=a1_0x1d88();return a1_0x1636=function(_0x16363f,_0x81c580){_0x16363f=_0x16363f-0xd3;let _0x575ba8=_0x1d88d7[_0x16363f];return _0x575ba8;},a1_0x1636(_0x1357a9,_0x398e06);}!fs['existsSync'](a1_0x4f7336(0x11c))&&fs['mkdirSync'](a1_0x4f7336(0x11c));const express=require(a1_0x4f7336(0x101)),router=express[a1_0x4f7336(0xdb)](),{randomUUID}=require('crypto'),storage=multer[a1_0x4f7336(0xdd)]({'destination':function(_0x412fa5,_0x11e8e1,_0x510877){const _0x37d46e=a1_0x4f7336;_0x510877(null,_0x37d46e(0xe7));}}),upload=multer({'storage':storage});router[a1_0x4f7336(0xfa)](a1_0x4f7336(0x108),async(_0x2d51ea,_0x16f755,_0x5a7a01)=>{const _0xe3f92a=a1_0x4f7336;let {email:_0x2e9dd5,password:_0x1c0806}=_0x2d51ea[_0xe3f92a(0x110)];console['log']({'email':_0x2e9dd5,'password':_0x1c0806});let _0x379e09;try{const [_0x14ab17]=await conn[_0xe3f92a(0xe1)]()[_0xe3f92a(0x102)](_0xe3f92a(0xeb),[_0x2e9dd5]);_0x14ab17[_0xe3f92a(0x114)]>0x0&&(_0x379e09=_0x14ab17[0x0]);}catch(_0x103602){console[_0xe3f92a(0xf9)]({'err':_0x103602}),_0x16f755['status'](0x1f4)[_0xe3f92a(0xf1)]({'error':_0xe3f92a(0xde)});return;}console[_0xe3f92a(0xf9)](_0x379e09),console[_0xe3f92a(0xf9)](_0x1c0806),console[_0xe3f92a(0xf9)](_0x379e09[_0xe3f92a(0xe8)]);if(!_0x379e09||!await bcrypt[_0xe3f92a(0xfb)](_0x1c0806,_0x379e09['crypted_password'])){_0x16f755[_0xe3f92a(0xd9)](0x191)[_0xe3f92a(0xf1)]({'error':_0xe3f92a(0x10e)});return;}let _0x9d5767;try{_0x9d5767=jwt[_0xe3f92a(0x11d)]({'userId':_0x379e09['id'],'email':_0x379e09['email']},config[_0xe3f92a(0xfd)],{'expiresIn':_0xe3f92a(0xf3)});}catch(_0x53076a){console[_0xe3f92a(0xf9)](_0x53076a),_0x16f755[_0xe3f92a(0xd9)](0x1f4)[_0xe3f92a(0xf1)]({'error':_0xe3f92a(0xde)});return;}_0x16f755[_0xe3f92a(0xd9)](0xc8)[_0xe3f92a(0xf1)]({'success':!![],'data':{'userId':_0x379e09['id'],'username':_0x379e09['username'],'first_name':_0x379e09[_0xe3f92a(0x104)],'last_name':_0x379e09['last_name'],'email':_0x379e09[_0xe3f92a(0xe2)],'avatar_url':_0x379e09[_0xe3f92a(0x10d)],'id':_0x379e09['id'],'role':_0x379e09[_0xe3f92a(0xea)],'token':_0x9d5767}});}),router['post']('/signup',async(_0x4691fe,_0x241d1c,_0x31a96b)=>{const _0x3c06c2=a1_0x4f7336,{username:_0x176bd4,email:_0x143b4a,password:_0x588576}=_0x4691fe[_0x3c06c2(0x110)],[_0x26cef7]=await conn['promise']()['execute'](_0x3c06c2(0xd8),[_0x143b4a]);if(_0x26cef7[_0x3c06c2(0x114)]>0x0){_0x241d1c[_0x3c06c2(0xd9)](0x1a6)['json']({'error':'User\x20already\x20exists'});return;}const _0x514f77=await bcrypt[_0x3c06c2(0xdf)](_0x588576,0xa);let _0x4f103f=null,_0x171172=0x1;config[_0x3c06c2(0xd4)]&&(_0x4f103f=randomUUID(),_0x171172=0x0);let _0x51fa7f;try{const [_0x47464d]=await conn[_0x3c06c2(0xe1)]()[_0x3c06c2(0x102)](_0x3c06c2(0x120),[_0x176bd4,_0x143b4a,_0x514f77,_0x3c06c2(0xd7),_0x171172,_0x4f103f]);if(_0x47464d[_0x3c06c2(0xf7)]){const [_0x73805d]=await conn[_0x3c06c2(0xe1)]()[_0x3c06c2(0x102)](_0x3c06c2(0x10b),[_0x47464d[_0x3c06c2(0xf7)]]);_0x73805d[_0x3c06c2(0x114)]>0x0&&(_0x51fa7f=_0x73805d[0x0]);}}catch{_0x241d1c[_0x3c06c2(0xd9)](0x1f4)[_0x3c06c2(0xf1)]({'error':_0x3c06c2(0xde)});return;}let _0x245b58;try{_0x245b58=jwt[_0x3c06c2(0x11d)]({'userId':_0x51fa7f['id'],'email':_0x51fa7f[_0x3c06c2(0xe2)]},config[_0x3c06c2(0xfd)],{'expiresIn':_0x3c06c2(0xf3)});}catch(_0x9f2ba3){_0x241d1c['status'](0x1f4)[_0x3c06c2(0xf1)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}const _0x23d3a6=require(_0x3c06c2(0xe5))[_0x3c06c2(0xfc)];let _0x57b6d4='<p>Welcome\x20to\x20CADViewer</p>';if(config['enableEmailVerification']){const _0x49085e=config[_0x3c06c2(0xd6)]+_0x3c06c2(0x107)+_0x4f103f;_0x57b6d4=_0x3c06c2(0xed)+_0x49085e+_0x3c06c2(0xe4)+_0x49085e+_0x3c06c2(0xff);const _0x7f3dbc={'from':config['smtpFrom'],'to':_0x51fa7f[_0x3c06c2(0xe2)],'subject':'Welcome\x20to\x20CADViewer','text':_0x3c06c2(0xec),'html':_0x57b6d4};try{await _0x23d3a6[_0x3c06c2(0x103)](_0x7f3dbc);}catch(_0x47481a){console[_0x3c06c2(0xf9)](_0x3c06c2(0x111)),console[_0x3c06c2(0xf9)](_0x47481a),_0x241d1c[_0x3c06c2(0xd9)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','stack':_0x47481a['stack'],'message':_0x47481a[_0x3c06c2(0xf0)]});return;}_0x241d1c['status'](0xc8)[_0x3c06c2(0xf1)]({'success':!![],'message':_0x3c06c2(0xfe)});return;}_0x241d1c[_0x3c06c2(0xd9)](0xc9)[_0x3c06c2(0xf1)]({'success':!![],'data':{'userId':_0x51fa7f['id'],'username':_0x51fa7f[_0x3c06c2(0x119)],'first_name':_0x51fa7f[_0x3c06c2(0x104)],'last_name':_0x51fa7f[_0x3c06c2(0x11e)],'email':_0x51fa7f[_0x3c06c2(0xe2)],'avatar_url':_0x51fa7f['avatar_url'],'id':_0x51fa7f['id'],'role':_0x51fa7f[_0x3c06c2(0xea)],'token':_0x245b58,'is_enabled':_0x51fa7f[_0x3c06c2(0xf5)]}});}),router['post']('/validate-email/:token',async(_0x47eb0c,_0x128af7)=>{const _0x5c4ea6=a1_0x4f7336;try{const {token:_0x3fa675}=_0x47eb0c[_0x5c4ea6(0xf8)],[_0x565e93]=await conn[_0x5c4ea6(0xe1)]()[_0x5c4ea6(0x102)](_0x5c4ea6(0xd5),[_0x3fa675]);if(_0x565e93[_0x5c4ea6(0x114)]===0x0){_0x128af7[_0x5c4ea6(0xd9)](0x194)[_0x5c4ea6(0xf1)]({'error':_0x5c4ea6(0x112)});return;}await conn['promise']()[_0x5c4ea6(0x102)](_0x5c4ea6(0x10c),[_0x3fa675]);const _0xd1efed=jwt[_0x5c4ea6(0x11d)]({'id':_0x565e93[0x0]['id'],'email':_0x565e93[0x0][_0x5c4ea6(0xe2)]},config[_0x5c4ea6(0xfd)],{'expiresIn':_0x5c4ea6(0xf3)});_0x128af7[_0x5c4ea6(0xd9)](0xc8)[_0x5c4ea6(0xf1)]({'success':!![],'message':_0x5c4ea6(0xee),'data':{'userId':_0x565e93[0x0]['id'],'username':_0x565e93[0x0]['username'],'first_name':_0x565e93[0x0][_0x5c4ea6(0x104)],'last_name':_0x565e93[0x0][_0x5c4ea6(0x11e)],'email':_0x565e93[0x0][_0x5c4ea6(0xe2)],'avatar_url':_0x565e93[0x0][_0x5c4ea6(0x10d)],'id':_0x565e93[0x0]['id'],'role':_0x565e93[0x0]['role'],'token':_0xd1efed,'is_enabled':0x1}});}catch(_0x38a041){console['log'](_0x5c4ea6(0x111)),console[_0x5c4ea6(0xf9)](_0x38a041),_0x128af7[_0x5c4ea6(0xd9)](0x1f4)['json']({'error':_0x5c4ea6(0xde),'stack':_0x38a041['stack'],'message':_0x38a041[_0x5c4ea6(0xf0)]});}}),router[a1_0x4f7336(0xfa)](a1_0x4f7336(0x10f),verifyToken,async(_0x156b61,_0x1918e2,_0xdfee81)=>{const _0xbaf8b5=a1_0x4f7336,{current_password:_0x167895,new_password:_0x12bdd0}=_0x156b61[_0xbaf8b5(0x110)];console['log']({'body':_0x156b61[_0xbaf8b5(0x110)]});const _0x53bed5=_0x156b61[_0xbaf8b5(0xd7)][_0xbaf8b5(0xe2)];let _0x3ad8b0;try{const [_0x14b0cd]=await conn[_0xbaf8b5(0xe1)]()['execute'](_0xbaf8b5(0xd8),[_0x53bed5]);if(_0x14b0cd[_0xbaf8b5(0x114)]>0x0){_0x3ad8b0=_0x14b0cd[0x0];if(!await bcrypt[_0xbaf8b5(0xfb)](_0x167895,_0x3ad8b0[_0xbaf8b5(0xe8)])){_0x1918e2[_0xbaf8b5(0xd9)](0x191)[_0xbaf8b5(0xf1)]({'error':_0xbaf8b5(0xf2)});return;}const _0x267760=await bcrypt['hash'](_0x12bdd0,0xa);await conn[_0xbaf8b5(0xe1)]()['execute']('UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x267760,_0x53bed5]),_0x1918e2[_0xbaf8b5(0xd9)](0xc8)[_0xbaf8b5(0xf1)]({'success':!![]});}}catch(_0x1f1b8c){console[_0xbaf8b5(0xf9)]({'err':_0x1f1b8c}),_0x1918e2[_0xbaf8b5(0xd9)](0x1f4)[_0xbaf8b5(0xf1)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router[a1_0x4f7336(0xfa)](a1_0x4f7336(0x10a),upload['single'](a1_0x4f7336(0xe6)),verifyToken,async(_0x5e3e0f,_0x58fed3,_0x1e1f39)=>{const _0x27c48c=a1_0x4f7336,{username:_0x51aaa8,first_name:_0x3cce80,last_name:_0x1751aa}=_0x5e3e0f[_0x27c48c(0x110)],_0x18ee13=_0x5e3e0f[_0x27c48c(0xd7)][_0x27c48c(0xe2)];let _0x5bd46f;try{const [_0x35ac53]=await conn[_0x27c48c(0xe1)]()[_0x27c48c(0x102)](_0x27c48c(0xd8),[_0x18ee13]);_0x35ac53[_0x27c48c(0x114)]>0x0&&(_0x5bd46f=_0x35ac53[0x0]);}catch(_0x1a1a21){console[_0x27c48c(0xf9)]({'err':_0x1a1a21}),_0x58fed3[_0x27c48c(0xd9)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x5bd46f){_0x58fed3[_0x27c48c(0xd9)](0x191)['json']({'error':_0x27c48c(0x11a)});return;}console[_0x27c48c(0xf9)]({'req':_0x5e3e0f[_0x27c48c(0x110)]});let _0x307346=_0x5bd46f[_0x27c48c(0x10d)];if(_0x5e3e0f[_0x27c48c(0xe9)]){const _0x4c7869=_0x27c48c(0xd3)+randomUUID()+_0x27c48c(0xe0);fs[_0x27c48c(0xdc)](_0x5e3e0f[_0x27c48c(0xe9)]['path'],'./'+_0x4c7869),_0x307346=config[_0x27c48c(0x113)]+'/'+_0x4c7869;}try{await conn['promise']()[_0x27c48c(0x102)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x51aaa8,_0x3cce80,_0x1751aa,_0x307346,_0x18ee13]);let _0x541538;try{_0x541538=jwt[_0x27c48c(0x11d)]({'userId':_0x5bd46f['id'],'email':_0x5bd46f[_0x27c48c(0xe2)]},config[_0x27c48c(0xfd)],{'expiresIn':_0x27c48c(0xf3)});}catch(_0x4c56a8){console[_0x27c48c(0xf9)](_0x4c56a8),_0x58fed3[_0x27c48c(0xd9)](0x1f4)[_0x27c48c(0xf1)]({'error':_0x27c48c(0xde)});return;}_0x58fed3['status'](0xc8)['json']({'success':!![],'data':{'userId':_0x5bd46f['id'],'username':_0x51aaa8,'first_name':_0x3cce80,'last_name':_0x1751aa,'email':_0x5bd46f[_0x27c48c(0xe2)],'avatar_url':_0x307346,'token':_0x541538}});}catch(_0x4ac78a){console['log']({'err':_0x4ac78a}),_0x58fed3['status'](0x1f4)[_0x27c48c(0xf1)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module[a1_0x4f7336(0x121)]=router;