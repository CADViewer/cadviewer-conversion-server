const a1_0xbfe904=a1_0x5621;function a1_0x5621(_0xe3476f,_0x1f1d39){const _0x404669=a1_0x4046();return a1_0x5621=function(_0x562179,_0x1ef7a7){_0x562179=_0x562179-0x156;let _0x32d3e9=_0x404669[_0x562179];return _0x32d3e9;},a1_0x5621(_0xe3476f,_0x1f1d39);}(function(_0x4b5024,_0x2c43e6){const _0x1cd8ec=a1_0x5621,_0x14d1a6=_0x4b5024();while(!![]){try{const _0x1f01d8=parseInt(_0x1cd8ec(0x188))/0x1+parseInt(_0x1cd8ec(0x156))/0x2*(parseInt(_0x1cd8ec(0x16a))/0x3)+-parseInt(_0x1cd8ec(0x186))/0x4+parseInt(_0x1cd8ec(0x17f))/0x5*(-parseInt(_0x1cd8ec(0x191))/0x6)+-parseInt(_0x1cd8ec(0x196))/0x7*(-parseInt(_0x1cd8ec(0x168))/0x8)+-parseInt(_0x1cd8ec(0x17c))/0x9*(parseInt(_0x1cd8ec(0x17e))/0xa)+parseInt(_0x1cd8ec(0x169))/0xb;if(_0x1f01d8===_0x2c43e6)break;else _0x14d1a6['push'](_0x14d1a6['shift']());}catch(_0x21bd52){_0x14d1a6['push'](_0x14d1a6['shift']());}}}(a1_0x4046,0xc27ed));const jwt=require(a1_0xbfe904(0x15f)),bcrypt=require(a1_0xbfe904(0x173)),config=require(a1_0xbfe904(0x17d)),conn=require(a1_0xbfe904(0x165)),multer=require(a1_0xbfe904(0x178)),fs=require('fs'),verifyToken=require('../libs/jwt')[a1_0xbfe904(0x180)];function a1_0x4046(){const _0x15b8a0=['./avatars','file','json','../libs/mysql.js','.png','length','14856yXOPdz','3129577cGPVLI','53874yZQCvR','role','jwtSecretKey','Invalid\x20user','Error!\x20Something\x20went\x20wrong.','/login','email','last_name','insertId','bcrypt','username','/update-user-info','avatars/','/update-password','multer','renameSync','User\x20already\x20exists','post','14697wtpjsn','../CADViewer_config.json','1970dVsCWG','65225qmLmni','verifyToken','Invalid\x20email\x20or\x20password','user','24h','status','avatar_url','5014340EttQxS','avatars','537965LLdRcd','mkdirSync','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','log','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','compare','crypto','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','diskStorage','180DOnlBm','first_name','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','exports','sign','4879jbmZlP','72LNzOsH','single','body','/signup','ServerUrl','hash','promise','crypted_password','Router','jsonwebtoken','execute','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?'];a1_0x4046=function(){return _0x15b8a0;};return a1_0x4046();}!fs['existsSync'](a1_0xbfe904(0x162))&&fs[a1_0xbfe904(0x189)]('./avatars');const express=require('express'),router=express[a1_0xbfe904(0x15e)](),{randomUUID}=require(a1_0xbfe904(0x18e)),storage=multer[a1_0xbfe904(0x190)]({'destination':function(_0x1b83ef,_0x36205a,_0x3d02ca){const _0x27e1d0=a1_0xbfe904;_0x3d02ca(null,_0x27e1d0(0x187));}}),upload=multer({'storage':storage});router[a1_0xbfe904(0x17b)](a1_0xbfe904(0x16f),async(_0x3bea84,_0x4d3f8d,_0x5ba75f)=>{const _0x5d2a1d=a1_0xbfe904;let {email:_0x16ba13,password:_0x2d4aaa}=_0x3bea84[_0x5d2a1d(0x158)];console['log']({'email':_0x16ba13,'password':_0x2d4aaa});let _0x477789;try{const [_0x1206e3]=await conn[_0x5d2a1d(0x15c)]()[_0x5d2a1d(0x160)](_0x5d2a1d(0x18c),[_0x16ba13]);_0x1206e3[_0x5d2a1d(0x167)]>0x0&&(_0x477789=_0x1206e3[0x0]);}catch(_0x125b4b){console[_0x5d2a1d(0x18b)]({'err':_0x125b4b}),_0x4d3f8d[_0x5d2a1d(0x184)](0x1f4)[_0x5d2a1d(0x164)]({'error':_0x5d2a1d(0x16e)});return;}console['log'](_0x477789),console['log'](_0x2d4aaa),console[_0x5d2a1d(0x18b)](_0x477789[_0x5d2a1d(0x15d)]);if(!_0x477789||!await bcrypt['compare'](_0x2d4aaa,_0x477789[_0x5d2a1d(0x15d)])){_0x4d3f8d[_0x5d2a1d(0x184)](0x191)[_0x5d2a1d(0x164)]({'error':_0x5d2a1d(0x181)});return;}let _0x85d062;try{_0x85d062=jwt[_0x5d2a1d(0x195)]({'userId':_0x477789['id'],'email':_0x477789[_0x5d2a1d(0x170)]},config[_0x5d2a1d(0x16c)],{'expiresIn':'24h'});}catch(_0x308f09){console[_0x5d2a1d(0x18b)](_0x308f09),_0x4d3f8d[_0x5d2a1d(0x184)](0x1f4)[_0x5d2a1d(0x164)]({'error':_0x5d2a1d(0x16e)});return;}_0x4d3f8d['status'](0xc8)[_0x5d2a1d(0x164)]({'success':!![],'data':{'userId':_0x477789['id'],'username':_0x477789[_0x5d2a1d(0x174)],'first_name':_0x477789[_0x5d2a1d(0x192)],'last_name':_0x477789[_0x5d2a1d(0x171)],'email':_0x477789[_0x5d2a1d(0x170)],'avatar_url':_0x477789[_0x5d2a1d(0x185)],'id':_0x477789['id'],'role':_0x477789[_0x5d2a1d(0x16b)],'token':_0x85d062}});}),router[a1_0xbfe904(0x17b)](a1_0xbfe904(0x159),async(_0x112b7b,_0x30eeca,_0x306cd1)=>{const _0x27825c=a1_0xbfe904,{username:_0x32ea3e,email:_0x2d2dd6,password:_0x35da28}=_0x112b7b[_0x27825c(0x158)],[_0x392d17]=await conn['promise']()['execute'](_0x27825c(0x193),[_0x2d2dd6]);if(_0x392d17[_0x27825c(0x167)]>0x0){_0x30eeca[_0x27825c(0x184)](0x1a6)[_0x27825c(0x164)]({'error':_0x27825c(0x17a)});return;}const _0x6b852=await bcrypt['hash'](_0x35da28,0xa);try{const [_0x158cda]=await conn[_0x27825c(0x15c)]()['execute'](_0x27825c(0x18f),[_0x32ea3e,_0x2d2dd6,_0x6b852,_0x27825c(0x182)]);if(_0x158cda[_0x27825c(0x172)]){const [_0x37b679]=await conn[_0x27825c(0x15c)]()['execute'](_0x27825c(0x161),[_0x158cda[_0x27825c(0x172)]]);_0x37b679[_0x27825c(0x167)]>0x0&&(newUser=_0x37b679[0x0]);}}catch{_0x30eeca[_0x27825c(0x184)](0x1f4)[_0x27825c(0x164)]({'error':_0x27825c(0x16e)});return;}let _0x4e5f4c;try{_0x4e5f4c=jwt[_0x27825c(0x195)]({'userId':newUser['id'],'email':newUser[_0x27825c(0x170)]},config[_0x27825c(0x16c)],{'expiresIn':_0x27825c(0x183)});}catch(_0xf66524){_0x30eeca[_0x27825c(0x184)](0x1f4)[_0x27825c(0x164)]({'error':_0x27825c(0x16e)});return;}_0x30eeca[_0x27825c(0x184)](0xc9)[_0x27825c(0x164)]({'success':!![],'data':{'userId':newUser['id'],'username':newUser[_0x27825c(0x174)],'first_name':newUser[_0x27825c(0x192)],'last_name':newUser['last_name'],'email':newUser[_0x27825c(0x170)],'avatar_url':newUser[_0x27825c(0x185)],'id':newUser['id'],'role':newUser[_0x27825c(0x16b)],'token':_0x4e5f4c}});}),router[a1_0xbfe904(0x17b)](a1_0xbfe904(0x177),verifyToken,async(_0x2b435b,_0x47779b,_0x47a1d9)=>{const _0x222e97=a1_0xbfe904,{current_password:_0x46dcd6,new_password:_0x423b3e}=_0x2b435b['body'];console[_0x222e97(0x18b)]({'body':_0x2b435b[_0x222e97(0x158)]});const _0x4c7cfc=_0x2b435b[_0x222e97(0x182)][_0x222e97(0x170)];let _0x1f33cb;try{const [_0x591bca]=await conn[_0x222e97(0x15c)]()[_0x222e97(0x160)](_0x222e97(0x193),[_0x4c7cfc]);if(_0x591bca[_0x222e97(0x167)]>0x0){_0x1f33cb=_0x591bca[0x0];if(!await bcrypt[_0x222e97(0x18d)](_0x46dcd6,_0x1f33cb[_0x222e97(0x15d)])){_0x47779b[_0x222e97(0x184)](0x191)[_0x222e97(0x164)]({'error':'Invalid\x20password'});return;}const _0xe6b5e7=await bcrypt[_0x222e97(0x15b)](_0x423b3e,0xa);await conn[_0x222e97(0x15c)]()[_0x222e97(0x160)](_0x222e97(0x18a),[_0xe6b5e7,_0x4c7cfc]),_0x47779b[_0x222e97(0x184)](0xc8)[_0x222e97(0x164)]({'success':!![]});}}catch(_0x478247){console[_0x222e97(0x18b)]({'err':_0x478247}),_0x47779b[_0x222e97(0x184)](0x1f4)[_0x222e97(0x164)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router[a1_0xbfe904(0x17b)](a1_0xbfe904(0x175),upload[a1_0xbfe904(0x157)]('avatar'),verifyToken,async(_0x408e4c,_0x4aead1,_0x1ede65)=>{const _0x30d000=a1_0xbfe904,{username:_0x4dbbb7,first_name:_0x33cf85,last_name:_0x255208}=_0x408e4c[_0x30d000(0x158)],_0x4ac06b=_0x408e4c['user']['email'];let _0x317273;try{const [_0x35c185]=await conn[_0x30d000(0x15c)]()[_0x30d000(0x160)](_0x30d000(0x193),[_0x4ac06b]);_0x35c185[_0x30d000(0x167)]>0x0&&(_0x317273=_0x35c185[0x0]);}catch(_0x2922cc){console[_0x30d000(0x18b)]({'err':_0x2922cc}),_0x4aead1[_0x30d000(0x184)](0x1f4)['json']({'error':_0x30d000(0x16e)});return;}if(!_0x317273){_0x4aead1[_0x30d000(0x184)](0x191)['json']({'error':_0x30d000(0x16d)});return;}console['log']({'req':_0x408e4c[_0x30d000(0x158)]});let _0x585979=_0x317273['avatar_url'];if(_0x408e4c[_0x30d000(0x163)]){const _0x63f8c8=_0x30d000(0x176)+randomUUID()+_0x30d000(0x166);fs[_0x30d000(0x179)](_0x408e4c[_0x30d000(0x163)]['path'],'./'+_0x63f8c8),_0x585979=config[_0x30d000(0x15a)]+'/'+_0x63f8c8;}try{await conn['promise']()[_0x30d000(0x160)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x4dbbb7,_0x33cf85,_0x255208,_0x585979,_0x4ac06b]);let _0x495f23;try{_0x495f23=jwt[_0x30d000(0x195)]({'userId':_0x317273['id'],'email':_0x317273[_0x30d000(0x170)]},config[_0x30d000(0x16c)],{'expiresIn':_0x30d000(0x183)});}catch(_0x4cfba8){console[_0x30d000(0x18b)](_0x4cfba8),_0x4aead1[_0x30d000(0x184)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x4aead1['status'](0xc8)['json']({'success':!![],'data':{'userId':_0x317273['id'],'username':_0x4dbbb7,'first_name':_0x33cf85,'last_name':_0x255208,'email':_0x317273[_0x30d000(0x170)],'avatar_url':_0x585979,'token':_0x495f23}});}catch(_0x3544a3){console[_0x30d000(0x18b)]({'err':_0x3544a3}),_0x4aead1[_0x30d000(0x184)](0x1f4)[_0x30d000(0x164)]({'error':_0x30d000(0x16e)});return;}}),module[a1_0xbfe904(0x194)]=router;