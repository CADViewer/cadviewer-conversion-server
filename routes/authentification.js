function a1_0x225a(_0x3fc646,_0xf28ee2){const _0x271b02=a1_0x271b();return a1_0x225a=function(_0x225af7,_0x51f3f6){_0x225af7=_0x225af7-0x17a;let _0x39eccf=_0x271b02[_0x225af7];return _0x39eccf;},a1_0x225a(_0x3fc646,_0xf28ee2);}const a1_0x46ab90=a1_0x225a;(function(_0x22d079,_0x49131c){const _0x27179b=a1_0x225a,_0x437ebf=_0x22d079();while(!![]){try{const _0x39003f=parseInt(_0x27179b(0x183))/0x1*(-parseInt(_0x27179b(0x1bf))/0x2)+-parseInt(_0x27179b(0x182))/0x3+-parseInt(_0x27179b(0x1c3))/0x4+parseInt(_0x27179b(0x1be))/0x5+parseInt(_0x27179b(0x1a0))/0x6*(parseInt(_0x27179b(0x1c5))/0x7)+-parseInt(_0x27179b(0x190))/0x8+parseInt(_0x27179b(0x1c1))/0x9*(parseInt(_0x27179b(0x19f))/0xa);if(_0x39003f===_0x49131c)break;else _0x437ebf['push'](_0x437ebf['shift']());}catch(_0x1bdd1a){_0x437ebf['push'](_0x437ebf['shift']());}}}(a1_0x271b,0x2a8e2));const jwt=require(a1_0x46ab90(0x1c8)),bcrypt=require('bcrypt'),config=require(a1_0x46ab90(0x19a)),conn=require(a1_0x46ab90(0x1ad)),multer=require(a1_0x46ab90(0x1a1)),fs=require('fs'),verifyToken=require(a1_0x46ab90(0x194))['verifyToken'],{sendWelcomeEmail}=require(a1_0x46ab90(0x18e)),axios=require(a1_0x46ab90(0x1b2));function a1_0x271b(){const _0xd33f9c=['1220544cDAJLh','length','21RuloDS','email','Error\x20parsing\x20geolocation\x20data:','jsonwebtoken','./avatars','existsSync','code','callbackMethod_gatewayUrl_flag','Invalid\x20user','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','languages','sign','log','https://www.google.com/recaptcha/api/siteverify','Error\x20during\x20reCAPTCHA\x20verification.','post','error','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','compare','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','insertId','===================error===================','468252hlLCKR','3UVdnbF','role','promise','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','data','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','Invalid\x20validation\x20token','username','/update-password','ServerUrl','recaptchaEnabled','../libs/email-utils','path','459160PloYTz','Email\x20validated\x20successfully','/validate-email/:token','Invalid\x20email\x20or\x20password','../libs/jwt','diskStorage','avatar','file','crypto','avatars/','../CADViewer_config.json','avatar_url','is_enabled','time_zone','Router','3145690CqOsDe','417504WdpERK','multer','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','user','mkdirSync','Error\x20during\x20user\x20creation:','/login','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','last_name','region','express','24h','Error!\x20Something\x20went\x20wrong.','../libs/mysql.js','stack','success','error-codes','/update-user-info','axios','json','body','params','callbackMethod_gatewayUrl','status','execute','first_name','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','avatars','enableEmailVerification','jwtSecretKey','1162385zQcQwX','41918BTvlkC','country_name','9piYtnr','exports'];a1_0x271b=function(){return _0xd33f9c;};return a1_0x271b();}!fs[a1_0x46ab90(0x1ca)](a1_0x46ab90(0x1c9))&&fs['mkdirSync'](a1_0x46ab90(0x1c9));const express=require(a1_0x46ab90(0x1aa)),router=express[a1_0x46ab90(0x19e)](),{randomUUID}=require(a1_0x46ab90(0x198)),storage=multer[a1_0x46ab90(0x195)]({'destination':function(_0x91b1d,_0x371411,_0x2cac0f){const _0x2ee8ef=a1_0x46ab90;_0x2cac0f(null,_0x2ee8ef(0x1bb));}}),upload=multer({'storage':storage});router['post'](a1_0x46ab90(0x1a6),async(_0x20bfc3,_0x1681cc,_0x373509)=>{const _0x57bc36=a1_0x46ab90;let {email:_0x247429,password:_0x576d3e}=_0x20bfc3[_0x57bc36(0x1b4)];console['log']({'email':_0x247429,'password':_0x576d3e});let _0x5be336;try{const [_0x3a6657]=await conn['promise']()[_0x57bc36(0x1b8)](_0x57bc36(0x1ba),[_0x247429]);_0x3a6657[_0x57bc36(0x1c4)]>0x0&&(_0x5be336=_0x3a6657[0x0]);}catch(_0x53b7ed){console[_0x57bc36(0x1d1)]({'err':_0x53b7ed}),_0x1681cc[_0x57bc36(0x1b7)](0x1f4)[_0x57bc36(0x1b3)]({'error':_0x57bc36(0x1ac)});return;}if(!_0x5be336||!await bcrypt[_0x57bc36(0x17e)](_0x576d3e,_0x5be336?.['crypted_password'])){_0x1681cc[_0x57bc36(0x1b7)](0x191)['json']({'error':_0x57bc36(0x193)});return;}let _0x4e8c2e;try{_0x4e8c2e=jwt['sign']({'userId':_0x5be336['id'],'email':_0x5be336['email']},config[_0x57bc36(0x1bd)],{'expiresIn':'24h'});}catch(_0x58571b){console['log'](_0x58571b),_0x1681cc[_0x57bc36(0x1b7)](0x1f4)['json']({'error':_0x57bc36(0x1ac)});return;}_0x1681cc[_0x57bc36(0x1b7)](0xc8)[_0x57bc36(0x1b3)]({'success':!![],'data':{'userId':_0x5be336['id'],'username':_0x5be336['username'],'first_name':_0x5be336[_0x57bc36(0x1b9)],'last_name':_0x5be336[_0x57bc36(0x1a8)],'email':_0x5be336[_0x57bc36(0x1c6)],'avatar_url':_0x5be336[_0x57bc36(0x19b)],'id':_0x5be336['id'],'role':_0x5be336[_0x57bc36(0x184)],'token':_0x4e8c2e}});}),router[a1_0x46ab90(0x17b)]('/signup',async(_0x5e9035,_0x4c291a,_0x3c473f)=>{const _0x5832e4=a1_0x46ab90,{username:_0x71d317,email:_0x879d2c,password:_0x2f02a6,geolocation:_0x43522a,recaptchaToken:_0x1f147f}=_0x5e9035[_0x5832e4(0x1b4)];if(config[_0x5832e4(0x18d)]){if(!_0x1f147f)return _0x4c291a[_0x5832e4(0x1b7)](0x190)[_0x5832e4(0x1b3)]({'error':_0x5832e4(0x1a7)});try{const _0x7d782d=await axios[_0x5832e4(0x17b)](_0x5832e4(0x1d2),null,{'params':{'secret':config['recaptchaSecretKey'],'response':_0x1f147f}});if(!_0x7d782d['data'][_0x5832e4(0x1af)])return _0x4c291a[_0x5832e4(0x1b7)](0x190)['json']({'error':'reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','recaptchaErrors':_0x7d782d[_0x5832e4(0x187)][_0x5832e4(0x1b0)]});}catch(_0x9b8021){return console[_0x5832e4(0x17c)]('reCAPTCHA\x20verification\x20error:',_0x9b8021),_0x4c291a[_0x5832e4(0x1b7)](0x1f4)[_0x5832e4(0x1b3)]({'error':_0x5832e4(0x17a)});}}const [_0x2a6846]=await conn[_0x5832e4(0x185)]()[_0x5832e4(0x1b8)](_0x5832e4(0x17f),[_0x879d2c]);if(_0x2a6846[_0x5832e4(0x1c4)]>0x0){_0x4c291a[_0x5832e4(0x1b7)](0x1a6)[_0x5832e4(0x1b3)]({'error':'User\x20already\x20exists'});return;}const _0x11ba45=await bcrypt['hash'](_0x2f02a6,0xa);let _0x4a5602=null,_0x6c71c6=0x1;config[_0x5832e4(0x1bc)]&&(_0x4a5602=randomUUID(),_0x6c71c6=0x0);let _0x4bedd6=null,_0x1bcf9f=null,_0x1b6193=null,_0x506ba6=null,_0x2381f5=null,_0x46ca6e=null;if(_0x43522a)try{const _0x250d5a=_0x43522a;_0x4bedd6=_0x250d5a['city']||null,_0x1bcf9f=_0x250d5a[_0x5832e4(0x1a9)]||null,_0x1b6193=_0x250d5a[_0x5832e4(0x1c0)]||null,_0x250d5a[_0x5832e4(0x1cf)]&&_0x250d5a[_0x5832e4(0x1cf)][_0x5832e4(0x1c4)]>0x0&&(_0x506ba6=_0x250d5a[_0x5832e4(0x1cf)][0x0][_0x5832e4(0x1cb)]||null,_0x2381f5=_0x250d5a['languages'][0x0]['name']||null),_0x250d5a[_0x5832e4(0x19d)]&&(_0x46ca6e=_0x250d5a[_0x5832e4(0x19d)]['name']||null);}catch(_0x5a08d7){console[_0x5832e4(0x1d1)](_0x5832e4(0x1c7),_0x5a08d7);}let _0x34ec9c;try{const _0x30070c=randomUUID(),_0x433b38='./uploads/'+_0x30070c;fs[_0x5832e4(0x1a4)](_0x433b38);const [_0x1fed16]=await conn[_0x5832e4(0x185)]()[_0x5832e4(0x1b8)](_0x5832e4(0x17d),[_0x71d317,_0x879d2c,_0x11ba45,'demo_user',_0x6c71c6,_0x4a5602,_0x30070c,_0x4bedd6,_0x1bcf9f,_0x1b6193,_0x506ba6,_0x2381f5,_0x46ca6e]);if(_0x1fed16[_0x5832e4(0x180)]){const [_0x5e898c]=await conn[_0x5832e4(0x185)]()[_0x5832e4(0x1b8)](_0x5832e4(0x188),[_0x1fed16[_0x5832e4(0x180)]]);_0x5e898c[_0x5832e4(0x1c4)]>0x0&&(_0x34ec9c=_0x5e898c[0x0]);}}catch(_0x555c6e){console[_0x5832e4(0x1d1)](_0x5832e4(0x1a5),_0x555c6e),_0x4c291a[_0x5832e4(0x1b7)](0x1f4)[_0x5832e4(0x1b3)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x279df3;try{_0x279df3=jwt[_0x5832e4(0x1d0)]({'userId':_0x34ec9c['id'],'email':_0x34ec9c[_0x5832e4(0x1c6)]},config['jwtSecretKey'],{'expiresIn':'24h'});}catch(_0x574b92){_0x4c291a['status'](0x1f4)['json']({'error':_0x5832e4(0x1ac)});return;}if(config[_0x5832e4(0x1bc)]){try{await sendWelcomeEmail(_0x34ec9c,_0x4a5602);}catch(_0x20348d){console[_0x5832e4(0x1d1)](_0x5832e4(0x181)),console[_0x5832e4(0x1d1)](_0x20348d);}_0x4c291a['status'](0xc8)[_0x5832e4(0x1b3)]({'success':!![],'message':_0x5832e4(0x186)});return;}_0x4c291a['status'](0xc9)[_0x5832e4(0x1b3)]({'success':!![],'data':{'userId':_0x34ec9c['id'],'username':_0x34ec9c[_0x5832e4(0x18a)],'first_name':_0x34ec9c[_0x5832e4(0x1b9)],'last_name':_0x34ec9c[_0x5832e4(0x1a8)],'email':_0x34ec9c[_0x5832e4(0x1c6)],'avatar_url':_0x34ec9c[_0x5832e4(0x19b)],'id':_0x34ec9c['id'],'role':_0x34ec9c[_0x5832e4(0x184)],'token':_0x279df3,'is_enabled':_0x34ec9c[_0x5832e4(0x19c)]}});}),router[a1_0x46ab90(0x17b)](a1_0x46ab90(0x192),async(_0x367129,_0x30408c)=>{const _0x47367e=a1_0x46ab90;try{const {token:_0x4995ef}=_0x367129[_0x47367e(0x1b5)],[_0x3f7c88]=await conn[_0x47367e(0x185)]()[_0x47367e(0x1b8)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?',[_0x4995ef]);if(_0x3f7c88['length']===0x0){_0x30408c[_0x47367e(0x1b7)](0x194)[_0x47367e(0x1b3)]({'error':_0x47367e(0x189)});return;}await conn[_0x47367e(0x185)]()[_0x47367e(0x1b8)](_0x47367e(0x1ce),[_0x4995ef]);const _0xabd411=jwt[_0x47367e(0x1d0)]({'id':_0x3f7c88[0x0]['id'],'email':_0x3f7c88[0x0][_0x47367e(0x1c6)]},config[_0x47367e(0x1bd)],{'expiresIn':_0x47367e(0x1ab)});_0x30408c[_0x47367e(0x1b7)](0xc8)['json']({'success':!![],'message':_0x47367e(0x191),'data':{'userId':_0x3f7c88[0x0]['id'],'username':_0x3f7c88[0x0][_0x47367e(0x18a)],'first_name':_0x3f7c88[0x0]['first_name'],'last_name':_0x3f7c88[0x0]['last_name'],'email':_0x3f7c88[0x0][_0x47367e(0x1c6)],'avatar_url':_0x3f7c88[0x0][_0x47367e(0x19b)],'id':_0x3f7c88[0x0]['id'],'role':_0x3f7c88[0x0]['role'],'token':_0xabd411,'is_enabled':0x1}});}catch(_0x123996){console['log'](_0x47367e(0x181)),console[_0x47367e(0x1d1)](_0x123996),_0x30408c[_0x47367e(0x1b7)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.','stack':_0x123996[_0x47367e(0x1ae)],'message':_0x123996['message']});}}),router[a1_0x46ab90(0x17b)](a1_0x46ab90(0x18b),verifyToken,async(_0x34a7cd,_0x396f63,_0x17ab20)=>{const _0x59db40=a1_0x46ab90,{current_password:_0x1a504d,new_password:_0x4e3188}=_0x34a7cd[_0x59db40(0x1b4)];console[_0x59db40(0x1d1)]({'body':_0x34a7cd[_0x59db40(0x1b4)]});const _0x503ae8=_0x34a7cd['user'][_0x59db40(0x1c6)];let _0x41849a;try{const [_0x26828a]=await conn[_0x59db40(0x185)]()[_0x59db40(0x1b8)](_0x59db40(0x17f),[_0x503ae8]);if(_0x26828a['length']>0x0){_0x41849a=_0x26828a[0x0];if(!await bcrypt[_0x59db40(0x17e)](_0x1a504d,_0x41849a['crypted_password'])){_0x396f63[_0x59db40(0x1b7)](0x191)[_0x59db40(0x1b3)]({'error':'Invalid\x20password'});return;}const _0x4924f4=await bcrypt['hash'](_0x4e3188,0xa);await conn['promise']()[_0x59db40(0x1b8)]('UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x4924f4,_0x503ae8]),_0x396f63[_0x59db40(0x1b7)](0xc8)[_0x59db40(0x1b3)]({'success':!![]});}}catch(_0x19628f){console[_0x59db40(0x1d1)]({'err':_0x19628f}),_0x396f63['status'](0x1f4)[_0x59db40(0x1b3)]({'error':_0x59db40(0x1ac)});return;}}),router[a1_0x46ab90(0x17b)](a1_0x46ab90(0x1b1),upload['single'](a1_0x46ab90(0x196)),verifyToken,async(_0x17033a,_0xa49a79,_0x2bccb8)=>{const _0x426601=a1_0x46ab90,{username:_0x47f396,first_name:_0x3b18ae,last_name:_0x47070b}=_0x17033a['body'],_0x49d4cb=_0x17033a[_0x426601(0x1a3)]['email'];let _0x258874;try{const [_0x13a0a4]=await conn['promise']()[_0x426601(0x1b8)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x49d4cb]);_0x13a0a4[_0x426601(0x1c4)]>0x0&&(_0x258874=_0x13a0a4[0x0]);}catch(_0x50c68f){console[_0x426601(0x1d1)]({'err':_0x50c68f}),_0xa49a79['status'](0x1f4)['json']({'error':_0x426601(0x1ac)});return;}if(!_0x258874){_0xa49a79[_0x426601(0x1b7)](0x191)[_0x426601(0x1b3)]({'error':_0x426601(0x1cd)});return;}console[_0x426601(0x1d1)]({'req':_0x17033a['body']});let _0x2c42d3=_0x258874[_0x426601(0x19b)];if(_0x17033a['file']){const _0x42f861=_0x426601(0x199)+randomUUID()+'.png';fs['copyFileSync'](_0x17033a['file'][_0x426601(0x18f)],'./'+_0x42f861),fs['unlinkSync'](_0x17033a[_0x426601(0x197)][_0x426601(0x18f)]),config[_0x426601(0x1cc)]?_0x2c42d3=config[_0x426601(0x1b6)]+'/'+_0x42f861:_0x2c42d3=config[_0x426601(0x18c)]+'/'+_0x42f861;}try{await conn[_0x426601(0x185)]()['execute'](_0x426601(0x1a2),[_0x47f396,_0x3b18ae,_0x47070b,_0x2c42d3,_0x49d4cb]);let _0x3a459f;try{_0x3a459f=jwt[_0x426601(0x1d0)]({'userId':_0x258874['id'],'email':_0x258874[_0x426601(0x1c6)]},config[_0x426601(0x1bd)],{'expiresIn':_0x426601(0x1ab)});}catch(_0x5627d7){console[_0x426601(0x1d1)](_0x5627d7),_0xa49a79[_0x426601(0x1b7)](0x1f4)[_0x426601(0x1b3)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0xa49a79[_0x426601(0x1b7)](0xc8)['json']({'success':!![],'data':{'userId':_0x258874['id'],'username':_0x47f396,'first_name':_0x3b18ae,'last_name':_0x47070b,'email':_0x258874[_0x426601(0x1c6)],'avatar_url':_0x2c42d3,'token':_0x3a459f}});}catch(_0x26549d){console[_0x426601(0x1d1)]({'err':_0x26549d}),_0xa49a79[_0x426601(0x1b7)](0x1f4)[_0x426601(0x1b3)]({'error':_0x426601(0x1ac)});return;}}),module[a1_0x46ab90(0x1c2)]=router;