const a1_0x24d15b=a1_0x1447;(function(_0x35aaa5,_0x5ace5e){const _0x5b6146=a1_0x1447,_0x3f9aac=_0x35aaa5();while(!![]){try{const _0x51a2db=parseInt(_0x5b6146(0xcf))/0x1*(-parseInt(_0x5b6146(0xc9))/0x2)+parseInt(_0x5b6146(0x98))/0x3*(parseInt(_0x5b6146(0xc5))/0x4)+parseInt(_0x5b6146(0xdb))/0x5+parseInt(_0x5b6146(0xae))/0x6*(-parseInt(_0x5b6146(0x89))/0x7)+parseInt(_0x5b6146(0xb3))/0x8+parseInt(_0x5b6146(0x91))/0x9+parseInt(_0x5b6146(0xa4))/0xa*(-parseInt(_0x5b6146(0xa5))/0xb);if(_0x51a2db===_0x5ace5e)break;else _0x3f9aac['push'](_0x3f9aac['shift']());}catch(_0x58aa77){_0x3f9aac['push'](_0x3f9aac['shift']());}}}(a1_0xa8d0,0x6abd6));const jwt=require(a1_0x24d15b(0xb5)),bcrypt=require(a1_0x24d15b(0x9e)),config=require('../CADViewer_config.json'),conn=require(a1_0x24d15b(0xb2)),multer=require(a1_0x24d15b(0xc6)),fs=require('fs'),verifyToken=require('../libs/jwt')[a1_0x24d15b(0x9b)];!fs[a1_0x24d15b(0xa6)]('./avatars')&&fs[a1_0x24d15b(0xbb)]('./avatars');function a1_0xa8d0(){const _0x2c7eb8=['3xdXqfS','ServerUrl','user','avatars','/update-password','enableEmailVerification','copyFileSync','demo_user','../libs/mail','/update-user-info','compare','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','2463095AipelK','last_name','length','6067117AAMqKn','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','path','Invalid\x20validation\x20token','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','24h','smtpFrom','first_name','5447385kxuNXf','promise','Invalid\x20user','role','Router','json','./uploads/','3MClqEs','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','username','verifyToken','Error!\x20Something\x20went\x20wrong.','hash','bcrypt','single','post','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','slice','/validate-email/:token','710lqGRLi','170643kOiPgG','existsSync','Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','exports','status','frontendUrl','User\x20already\x20exists','file','6rKvhvH','Email\x20validated\x20successfully','body','crypted_password','../libs/mysql.js','6632776KYIIhJ','Invalid\x20password','jsonwebtoken','===================error===================','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','insertId','Welcome\x20to\x20CADViewer','params','mkdirSync','sendMail','.png','email','log','avatars/','jwtSecretKey','unlinkSync','transporter','Invalid\x20email\x20or\x20password','2372444jxfgMP','multer','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)','sign','76488XKloGi','message','execute','is_enabled','stack','avatar_url'];a1_0xa8d0=function(){return _0x2c7eb8;};return a1_0xa8d0();}const express=require('express'),router=express[a1_0x24d15b(0x95)](),{randomUUID}=require('crypto'),storage=multer['diskStorage']({'destination':function(_0x3b8628,_0xf8f5ba,_0x4a66c4){const _0x14807b=a1_0x24d15b;_0x4a66c4(null,_0x14807b(0xd2));}}),upload=multer({'storage':storage});function a1_0x1447(_0x603340,_0x3386cc){const _0xa8d0c9=a1_0xa8d0();return a1_0x1447=function(_0x1447a5,_0x584d37){_0x1447a5=_0x1447a5-0x87;let _0x2bbf35=_0xa8d0c9[_0x1447a5];return _0x2bbf35;},a1_0x1447(_0x603340,_0x3386cc);}router[a1_0x24d15b(0xa0)]('/login',async(_0x496802,_0x27cdc5,_0x1e8779)=>{const _0x1efc55=a1_0x24d15b;let {email:_0x34be47,password:_0x259f6a}=_0x496802[_0x1efc55(0xb0)];console[_0x1efc55(0xbf)]({'email':_0x34be47,'password':_0x259f6a});let _0x5e6838;try{const [_0x426081]=await conn[_0x1efc55(0x92)]()[_0x1efc55(0xcb)](_0x1efc55(0xa8),[_0x34be47]);_0x426081[_0x1efc55(0x88)]>0x0&&(_0x5e6838=_0x426081[0x0]);}catch(_0x55925b){console[_0x1efc55(0xbf)]({'err':_0x55925b}),_0x27cdc5[_0x1efc55(0xaa)](0x1f4)['json']({'error':_0x1efc55(0x9c)});return;}if(!_0x5e6838||!await bcrypt[_0x1efc55(0xd9)](_0x259f6a,_0x5e6838?.[_0x1efc55(0xb1)])){_0x27cdc5[_0x1efc55(0xaa)](0x191)[_0x1efc55(0x96)]({'error':_0x1efc55(0xc4)});return;}let _0x32e473;try{_0x32e473=jwt[_0x1efc55(0xc8)]({'userId':_0x5e6838['id'],'email':_0x5e6838[_0x1efc55(0xbe)]},config[_0x1efc55(0xc1)],{'expiresIn':_0x1efc55(0x8e)});}catch(_0x565de8){console['log'](_0x565de8),_0x27cdc5[_0x1efc55(0xaa)](0x1f4)[_0x1efc55(0x96)]({'error':_0x1efc55(0x9c)});return;}_0x27cdc5[_0x1efc55(0xaa)](0xc8)[_0x1efc55(0x96)]({'success':!![],'data':{'userId':_0x5e6838['id'],'username':_0x5e6838[_0x1efc55(0x9a)],'first_name':_0x5e6838[_0x1efc55(0x90)],'last_name':_0x5e6838[_0x1efc55(0x87)],'email':_0x5e6838['email'],'avatar_url':_0x5e6838['avatar_url'],'id':_0x5e6838['id'],'role':_0x5e6838[_0x1efc55(0x94)],'token':_0x32e473}});}),router[a1_0x24d15b(0xa0)]('/signup',async(_0x2be61d,_0x1cb280,_0x4dfb5e)=>{const _0x5efda5=a1_0x24d15b,{username:_0x3e8c51,email:_0x512d48,password:_0xc69310}=_0x2be61d['body'],[_0x25b205]=await conn[_0x5efda5(0x92)]()[_0x5efda5(0xcb)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x512d48]);if(_0x25b205[_0x5efda5(0x88)]>0x0){_0x1cb280[_0x5efda5(0xaa)](0x1a6)['json']({'error':_0x5efda5(0xac)});return;}const _0x4a631a=await bcrypt[_0x5efda5(0x9d)](_0xc69310,0xa);let _0x471504=null,_0x46772=0x1;config[_0x5efda5(0xd4)]&&(_0x471504=randomUUID(),_0x46772=0x0);let _0x214836;try{const _0x1d50c4=randomUUID(),_0x417c79=_0x5efda5(0x97)+_0x1d50c4;fs[_0x5efda5(0xbb)](_0x417c79);const [_0x5f33ad]=await conn['promise']()['execute'](_0x5efda5(0xc7),[_0x3e8c51,_0x512d48,_0x4a631a,_0x5efda5(0xd6),_0x46772,_0x471504,_0x1d50c4]);if(_0x5f33ad[_0x5efda5(0xb8)]){const [_0xd35b8b]=await conn[_0x5efda5(0x92)]()[_0x5efda5(0xcb)](_0x5efda5(0xa1),[_0x5f33ad[_0x5efda5(0xb8)]]);_0xd35b8b[_0x5efda5(0x88)]>0x0&&(_0x214836=_0xd35b8b[0x0]);}}catch{_0x1cb280[_0x5efda5(0xaa)](0x1f4)[_0x5efda5(0x96)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x325d43;try{_0x325d43=jwt[_0x5efda5(0xc8)]({'userId':_0x214836['id'],'email':_0x214836[_0x5efda5(0xbe)]},config[_0x5efda5(0xc1)],{'expiresIn':_0x5efda5(0x8e)});}catch(_0x2b2068){_0x1cb280['status'](0x1f4)[_0x5efda5(0x96)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}const _0xe7302e=require(_0x5efda5(0xd7))[_0x5efda5(0xc3)];let _0x5da6a2='<p>Welcome\x20to\x20CADViewer</p>';if(config['enableEmailVerification']){var _0x1a2ca8=config[_0x5efda5(0xab)];_0x1a2ca8['endsWith']('/')&&(_0x1a2ca8=_0x1a2ca8[_0x5efda5(0xa2)](0x0,-0x1));const _0x444e7d=_0x1a2ca8+'/validate-email/'+_0x471504;_0x5da6a2=_0x5efda5(0xb7)+_0x444e7d+'\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>'+_0x444e7d+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20';const _0x436628={'from':config[_0x5efda5(0x8f)],'to':_0x214836[_0x5efda5(0xbe)],'subject':_0x5efda5(0xb9),'text':_0x5efda5(0xb9),'html':_0x5da6a2};try{await _0xe7302e[_0x5efda5(0xbc)](_0x436628);}catch(_0x191bbe){console[_0x5efda5(0xbf)](_0x5efda5(0xb6)),console['log'](_0x191bbe),_0x1cb280['status'](0x1f4)[_0x5efda5(0x96)]({'error':_0x5efda5(0xa7),'stack':_0x191bbe['stack'],'message':_0x191bbe[_0x5efda5(0xca)]});return;}_0x1cb280['status'](0xc8)[_0x5efda5(0x96)]({'success':!![],'message':_0x5efda5(0x8d)});return;}_0x1cb280[_0x5efda5(0xaa)](0xc9)[_0x5efda5(0x96)]({'success':!![],'data':{'userId':_0x214836['id'],'username':_0x214836[_0x5efda5(0x9a)],'first_name':_0x214836['first_name'],'last_name':_0x214836[_0x5efda5(0x87)],'email':_0x214836[_0x5efda5(0xbe)],'avatar_url':_0x214836[_0x5efda5(0xce)],'id':_0x214836['id'],'role':_0x214836[_0x5efda5(0x94)],'token':_0x325d43,'is_enabled':_0x214836[_0x5efda5(0xcc)]}});}),router[a1_0x24d15b(0xa0)](a1_0x24d15b(0xa3),async(_0xcc04a,_0x3d672e)=>{const _0x119ae9=a1_0x24d15b;try{const {token:_0x46cc8e}=_0xcc04a[_0x119ae9(0xba)],[_0x177af7]=await conn[_0x119ae9(0x92)]()[_0x119ae9(0xcb)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?',[_0x46cc8e]);if(_0x177af7[_0x119ae9(0x88)]===0x0){_0x3d672e[_0x119ae9(0xaa)](0x194)[_0x119ae9(0x96)]({'error':_0x119ae9(0x8c)});return;}await conn[_0x119ae9(0x92)]()[_0x119ae9(0xcb)](_0x119ae9(0x8a),[_0x46cc8e]);const _0x56873b=jwt[_0x119ae9(0xc8)]({'id':_0x177af7[0x0]['id'],'email':_0x177af7[0x0][_0x119ae9(0xbe)]},config['jwtSecretKey'],{'expiresIn':_0x119ae9(0x8e)});_0x3d672e['status'](0xc8)[_0x119ae9(0x96)]({'success':!![],'message':_0x119ae9(0xaf),'data':{'userId':_0x177af7[0x0]['id'],'username':_0x177af7[0x0]['username'],'first_name':_0x177af7[0x0][_0x119ae9(0x90)],'last_name':_0x177af7[0x0]['last_name'],'email':_0x177af7[0x0]['email'],'avatar_url':_0x177af7[0x0][_0x119ae9(0xce)],'id':_0x177af7[0x0]['id'],'role':_0x177af7[0x0][_0x119ae9(0x94)],'token':_0x56873b,'is_enabled':0x1}});}catch(_0x5ddb69){console['log']('===================error==================='),console[_0x119ae9(0xbf)](_0x5ddb69),_0x3d672e[_0x119ae9(0xaa)](0x1f4)[_0x119ae9(0x96)]({'error':'Error!\x20Something\x20went\x20wrong.','stack':_0x5ddb69[_0x119ae9(0xcd)],'message':_0x5ddb69['message']});}}),router[a1_0x24d15b(0xa0)](a1_0x24d15b(0xd3),verifyToken,async(_0x2d802a,_0x39f83d,_0x22d0b3)=>{const _0x2a3e13=a1_0x24d15b,{current_password:_0x107faf,new_password:_0x3f9e13}=_0x2d802a[_0x2a3e13(0xb0)];console[_0x2a3e13(0xbf)]({'body':_0x2d802a['body']});const _0x43f64d=_0x2d802a[_0x2a3e13(0xd1)][_0x2a3e13(0xbe)];let _0x31a30d;try{const [_0xe0605b]=await conn[_0x2a3e13(0x92)]()['execute'](_0x2a3e13(0x99),[_0x43f64d]);if(_0xe0605b['length']>0x0){_0x31a30d=_0xe0605b[0x0];if(!await bcrypt['compare'](_0x107faf,_0x31a30d[_0x2a3e13(0xb1)])){_0x39f83d[_0x2a3e13(0xaa)](0x191)['json']({'error':_0x2a3e13(0xb4)});return;}const _0x23d454=await bcrypt[_0x2a3e13(0x9d)](_0x3f9e13,0xa);await conn[_0x2a3e13(0x92)]()['execute'](_0x2a3e13(0xda),[_0x23d454,_0x43f64d]),_0x39f83d[_0x2a3e13(0xaa)](0xc8)[_0x2a3e13(0x96)]({'success':!![]});}}catch(_0x56e1a8){console[_0x2a3e13(0xbf)]({'err':_0x56e1a8}),_0x39f83d[_0x2a3e13(0xaa)](0x1f4)['json']({'error':_0x2a3e13(0x9c)});return;}}),router[a1_0x24d15b(0xa0)](a1_0x24d15b(0xd8),upload[a1_0x24d15b(0x9f)]('avatar'),verifyToken,async(_0x42c4e4,_0x31d532,_0x2edcfe)=>{const _0x3af1ef=a1_0x24d15b,{username:_0x4a8473,first_name:_0x23c08f,last_name:_0x44d768}=_0x42c4e4['body'],_0x546a66=_0x42c4e4['user']['email'];let _0x474572;try{const [_0x474b3d]=await conn[_0x3af1ef(0x92)]()[_0x3af1ef(0xcb)](_0x3af1ef(0x99),[_0x546a66]);_0x474b3d[_0x3af1ef(0x88)]>0x0&&(_0x474572=_0x474b3d[0x0]);}catch(_0xc2857f){console[_0x3af1ef(0xbf)]({'err':_0xc2857f}),_0x31d532[_0x3af1ef(0xaa)](0x1f4)[_0x3af1ef(0x96)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x474572){_0x31d532[_0x3af1ef(0xaa)](0x191)[_0x3af1ef(0x96)]({'error':_0x3af1ef(0x93)});return;}console['log']({'req':_0x42c4e4[_0x3af1ef(0xb0)]});let _0x5e979f=_0x474572[_0x3af1ef(0xce)];if(_0x42c4e4[_0x3af1ef(0xad)]){const _0x3dd491=_0x3af1ef(0xc0)+randomUUID()+_0x3af1ef(0xbd);fs[_0x3af1ef(0xd5)](_0x42c4e4[_0x3af1ef(0xad)][_0x3af1ef(0x8b)],'./'+_0x3dd491),fs[_0x3af1ef(0xc2)](_0x42c4e4[_0x3af1ef(0xad)]['path']),_0x5e979f=config[_0x3af1ef(0xd0)]+'/'+_0x3dd491;}try{await conn['promise']()[_0x3af1ef(0xcb)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x4a8473,_0x23c08f,_0x44d768,_0x5e979f,_0x546a66]);let _0xd75e9f;try{_0xd75e9f=jwt[_0x3af1ef(0xc8)]({'userId':_0x474572['id'],'email':_0x474572[_0x3af1ef(0xbe)]},config[_0x3af1ef(0xc1)],{'expiresIn':_0x3af1ef(0x8e)});}catch(_0x2ad546){console['log'](_0x2ad546),_0x31d532[_0x3af1ef(0xaa)](0x1f4)[_0x3af1ef(0x96)]({'error':_0x3af1ef(0x9c)});return;}_0x31d532[_0x3af1ef(0xaa)](0xc8)[_0x3af1ef(0x96)]({'success':!![],'data':{'userId':_0x474572['id'],'username':_0x4a8473,'first_name':_0x23c08f,'last_name':_0x44d768,'email':_0x474572['email'],'avatar_url':_0x5e979f,'token':_0xd75e9f}});}catch(_0x2e67a0){console['log']({'err':_0x2e67a0}),_0x31d532[_0x3af1ef(0xaa)](0x1f4)[_0x3af1ef(0x96)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module[a1_0x24d15b(0xa9)]=router;