const a1_0x3ade87=a1_0x5f0d;(function(_0x457fcb,_0x59939b){const _0x464415=a1_0x5f0d,_0x2d9b22=_0x457fcb();while(!![]){try{const _0x3d8dff=parseInt(_0x464415(0x1c6))/0x1+parseInt(_0x464415(0x1cb))/0x2*(parseInt(_0x464415(0x1d4))/0x3)+parseInt(_0x464415(0x1cd))/0x4+-parseInt(_0x464415(0x1f9))/0x5*(-parseInt(_0x464415(0x1e1))/0x6)+parseInt(_0x464415(0x211))/0x7*(parseInt(_0x464415(0x1d0))/0x8)+-parseInt(_0x464415(0x203))/0x9*(-parseInt(_0x464415(0x1fd))/0xa)+-parseInt(_0x464415(0x1f2))/0xb;if(_0x3d8dff===_0x59939b)break;else _0x2d9b22['push'](_0x2d9b22['shift']());}catch(_0x301f77){_0x2d9b22['push'](_0x2d9b22['shift']());}}}(a1_0x26fb,0xd00e7));const jwt=require(a1_0x3ade87(0x1c3)),bcrypt=require(a1_0x3ade87(0x20b)),config=require(a1_0x3ade87(0x1e4)),conn=require(a1_0x3ade87(0x1e6)),multer=require(a1_0x3ade87(0x21e)),fs=require('fs'),verifyToken=require(a1_0x3ade87(0x1c9))[a1_0x3ade87(0x1e3)],{sendWelcomeEmail}=require(a1_0x3ade87(0x1dd)),axios=require(a1_0x3ade87(0x1ef));function a1_0x26fb(){const _0x46c01f=['single','existsSync','city','promise','https://www.google.com/recaptcha/api/siteverify','json','code','role','express','diskStorage','Router','mkdirSync','multer','execute','crypto','avatar','unlinkSync','24h','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','recaptchaEnabled','jsonwebtoken','error','insertId','219627CRMTre','crypted_password','region','../libs/jwt','callbackMethod_gatewayUrl_flag','12DBOoTL','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','1879152LcdJta','Error!\x20Something\x20went\x20wrong.','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','5448QNLfzF','recaptchaSecretKey','exports','user','127653gyjEXu','country_name','/validate-email/:token','Email\x20validated\x20successfully','User\x20already\x20exists','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','data','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','path','../libs/email-utils','/signup','time_zone','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','2754FilIPL','ServerUrl','verifyToken','../CADViewer_config.json','.png','../libs/mysql.js','Invalid\x20user','===================error===================','post','copyFileSync','avatars/','username','error-codes','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','axios','demo_user','languages','27543714XqEaNu','Error\x20parsing\x20geolocation\x20data:','email','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','Invalid\x20validation\x20token','log','file','7745LiABOI','./uploads/','sign','body','10uvtUfX','success','enableEmailVerification','is_enabled','last_name','avatar_url','11449008DhvbGM','hash','status','length','first_name','name','./avatars','avatars','bcrypt','stack','reCAPTCHA\x20verification\x20error:','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','compare','jwtSecretKey','4403iJaUeu'];a1_0x26fb=function(){return _0x46c01f;};return a1_0x26fb();}!fs[a1_0x3ade87(0x213)](a1_0x3ade87(0x209))&&fs[a1_0x3ade87(0x21d)]('./avatars');function a1_0x5f0d(_0xb7cfa0,_0x52c70f){const _0x26fbc1=a1_0x26fb();return a1_0x5f0d=function(_0x5f0d89,_0x3d3bd2){_0x5f0d89=_0x5f0d89-0x1c0;let _0x3d7088=_0x26fbc1[_0x5f0d89];return _0x3d7088;},a1_0x5f0d(_0xb7cfa0,_0x52c70f);}const express=require(a1_0x3ade87(0x21a)),router=express[a1_0x3ade87(0x21c)](),{randomUUID}=require(a1_0x3ade87(0x220)),storage=multer[a1_0x3ade87(0x21b)]({'destination':function(_0x3fb63e,_0x340c11,_0x3b16c2){const _0x108808=a1_0x3ade87;_0x3b16c2(null,_0x108808(0x20a));}}),upload=multer({'storage':storage});router['post']('/login',async(_0x11d6e9,_0x1b0faa,_0x4044dc)=>{const _0x3b3469=a1_0x3ade87;let {email:_0x19b8d3,password:_0x38ec86}=_0x11d6e9[_0x3b3469(0x1fc)];console[_0x3b3469(0x1f7)]({'email':_0x19b8d3,'password':_0x38ec86});let _0x4df56b;try{const [_0x362282]=await conn['promise']()[_0x3b3469(0x21f)](_0x3b3469(0x1f5),[_0x19b8d3]);_0x362282[_0x3b3469(0x206)]>0x0&&(_0x4df56b=_0x362282[0x0]);}catch(_0x2633b0){console[_0x3b3469(0x1f7)]({'err':_0x2633b0}),_0x1b0faa[_0x3b3469(0x205)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x4df56b||!await bcrypt[_0x3b3469(0x20f)](_0x38ec86,_0x4df56b?.[_0x3b3469(0x1c7)])){_0x1b0faa[_0x3b3469(0x205)](0x191)[_0x3b3469(0x217)]({'error':'Invalid\x20email\x20or\x20password'});return;}let _0x10dd51;try{_0x10dd51=jwt['sign']({'userId':_0x4df56b['id'],'email':_0x4df56b['email']},config['jwtSecretKey'],{'expiresIn':_0x3b3469(0x1c0)});}catch(_0x9e51ac){console['log'](_0x9e51ac),_0x1b0faa[_0x3b3469(0x205)](0x1f4)[_0x3b3469(0x217)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x1b0faa[_0x3b3469(0x205)](0xc8)[_0x3b3469(0x217)]({'success':!![],'data':{'userId':_0x4df56b['id'],'username':_0x4df56b[_0x3b3469(0x1ec)],'first_name':_0x4df56b[_0x3b3469(0x207)],'last_name':_0x4df56b[_0x3b3469(0x201)],'email':_0x4df56b[_0x3b3469(0x1f4)],'avatar_url':_0x4df56b[_0x3b3469(0x202)],'id':_0x4df56b['id'],'role':_0x4df56b[_0x3b3469(0x219)],'token':_0x10dd51}});}),router[a1_0x3ade87(0x1e9)](a1_0x3ade87(0x1de),async(_0x15dde2,_0x32f96b,_0x5bb28c)=>{const _0x1494e4=a1_0x3ade87,{username:_0x4fa7a7,email:_0x7d6de3,password:_0x3a7417,geolocation:_0x695ec,recaptchaToken:_0xdcb378}=_0x15dde2[_0x1494e4(0x1fc)];if(config[_0x1494e4(0x1c2)]){if(!_0xdcb378)return _0x32f96b[_0x1494e4(0x205)](0x190)[_0x1494e4(0x217)]({'error':_0x1494e4(0x20e)});try{const _0xca5883=await axios['post'](_0x1494e4(0x216),null,{'params':{'secret':config[_0x1494e4(0x1d1)],'response':_0xdcb378}});if(!_0xca5883[_0x1494e4(0x1da)][_0x1494e4(0x1fe)])return _0x32f96b[_0x1494e4(0x205)](0x190)[_0x1494e4(0x217)]({'error':'reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','recaptchaErrors':_0xca5883[_0x1494e4(0x1da)][_0x1494e4(0x1ed)]});}catch(_0x4481b8){return console[_0x1494e4(0x1c4)](_0x1494e4(0x20d),_0x4481b8),_0x32f96b['status'](0x1f4)[_0x1494e4(0x217)]({'error':'Error\x20during\x20reCAPTCHA\x20verification.'});}}const [_0x40d87b]=await conn[_0x1494e4(0x215)]()[_0x1494e4(0x21f)](_0x1494e4(0x1c1),[_0x7d6de3]);if(_0x40d87b[_0x1494e4(0x206)]>0x0){_0x32f96b['status'](0x1a6)[_0x1494e4(0x217)]({'error':_0x1494e4(0x1d8)});return;}const _0x2dd6bb=await bcrypt[_0x1494e4(0x204)](_0x3a7417,0xa);let _0x4f1b3d=null,_0x4edaee=0x1;config['enableEmailVerification']&&(_0x4f1b3d=randomUUID(),_0x4edaee=0x0);let _0x30b87e=null,_0x49ee8b=null,_0x2f7ac9=null,_0x126cd5=null,_0x106c51=null,_0x1a3e93=null;if(_0x695ec)try{const _0x4b473b=_0x695ec;_0x30b87e=_0x4b473b[_0x1494e4(0x214)]||null,_0x49ee8b=_0x4b473b[_0x1494e4(0x1c8)]||null,_0x2f7ac9=_0x4b473b[_0x1494e4(0x1d5)]||null,_0x4b473b[_0x1494e4(0x1f1)]&&_0x4b473b['languages'][_0x1494e4(0x206)]>0x0&&(_0x126cd5=_0x4b473b[_0x1494e4(0x1f1)][0x0][_0x1494e4(0x218)]||null,_0x106c51=_0x4b473b[_0x1494e4(0x1f1)][0x0][_0x1494e4(0x208)]||null),_0x4b473b[_0x1494e4(0x1df)]&&(_0x1a3e93=_0x4b473b['time_zone'][_0x1494e4(0x208)]||null);}catch(_0x426d75){console[_0x1494e4(0x1f7)](_0x1494e4(0x1f3),_0x426d75);}let _0x1f54ad;try{const _0x47dfa2=randomUUID(),_0x18b071=_0x1494e4(0x1fa)+_0x47dfa2;fs['mkdirSync'](_0x18b071);const [_0x5cd746]=await conn[_0x1494e4(0x215)]()[_0x1494e4(0x21f)](_0x1494e4(0x1cc),[_0x4fa7a7,_0x7d6de3,_0x2dd6bb,_0x1494e4(0x1f0),_0x4edaee,_0x4f1b3d,_0x47dfa2,_0x30b87e,_0x49ee8b,_0x2f7ac9,_0x126cd5,_0x106c51,_0x1a3e93]);if(_0x5cd746['insertId']){const [_0xc31ef3]=await conn[_0x1494e4(0x215)]()[_0x1494e4(0x21f)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0x5cd746[_0x1494e4(0x1c5)]]);_0xc31ef3[_0x1494e4(0x206)]>0x0&&(_0x1f54ad=_0xc31ef3[0x0]);}}catch(_0x4baa37){console[_0x1494e4(0x1f7)]('Error\x20during\x20user\x20creation:',_0x4baa37),_0x32f96b[_0x1494e4(0x205)](0x1f4)[_0x1494e4(0x217)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x5d0516;try{_0x5d0516=jwt[_0x1494e4(0x1fb)]({'userId':_0x1f54ad['id'],'email':_0x1f54ad['email']},config['jwtSecretKey'],{'expiresIn':_0x1494e4(0x1c0)});}catch(_0x53ce3a){_0x32f96b[_0x1494e4(0x205)](0x1f4)['json']({'error':_0x1494e4(0x1ce)});return;}if(config[_0x1494e4(0x1ff)]){try{await sendWelcomeEmail(_0x1f54ad,_0x4f1b3d);}catch(_0x111e81){console[_0x1494e4(0x1f7)](_0x1494e4(0x1e8)),console[_0x1494e4(0x1f7)](_0x111e81);}_0x32f96b[_0x1494e4(0x205)](0xc8)[_0x1494e4(0x217)]({'success':!![],'message':_0x1494e4(0x1ee)});return;}_0x32f96b[_0x1494e4(0x205)](0xc9)[_0x1494e4(0x217)]({'success':!![],'data':{'userId':_0x1f54ad['id'],'username':_0x1f54ad[_0x1494e4(0x1ec)],'first_name':_0x1f54ad[_0x1494e4(0x207)],'last_name':_0x1f54ad[_0x1494e4(0x201)],'email':_0x1f54ad[_0x1494e4(0x1f4)],'avatar_url':_0x1f54ad[_0x1494e4(0x202)],'id':_0x1f54ad['id'],'role':_0x1f54ad['role'],'token':_0x5d0516,'is_enabled':_0x1f54ad[_0x1494e4(0x200)]}});}),router[a1_0x3ade87(0x1e9)](a1_0x3ade87(0x1d6),async(_0x5d83f5,_0x9b7f88)=>{const _0x27094c=a1_0x3ade87;try{const {token:_0x457339}=_0x5d83f5['params'],[_0x42ad89]=await conn[_0x27094c(0x215)]()[_0x27094c(0x21f)](_0x27094c(0x1e0),[_0x457339]);if(_0x42ad89['length']===0x0){_0x9b7f88[_0x27094c(0x205)](0x194)[_0x27094c(0x217)]({'error':_0x27094c(0x1f6)});return;}await conn[_0x27094c(0x215)]()[_0x27094c(0x21f)](_0x27094c(0x1db),[_0x457339]);const _0x230288=jwt[_0x27094c(0x1fb)]({'id':_0x42ad89[0x0]['id'],'email':_0x42ad89[0x0][_0x27094c(0x1f4)]},config[_0x27094c(0x210)],{'expiresIn':_0x27094c(0x1c0)});_0x9b7f88['status'](0xc8)[_0x27094c(0x217)]({'success':!![],'message':_0x27094c(0x1d7),'data':{'userId':_0x42ad89[0x0]['id'],'username':_0x42ad89[0x0][_0x27094c(0x1ec)],'first_name':_0x42ad89[0x0][_0x27094c(0x207)],'last_name':_0x42ad89[0x0][_0x27094c(0x201)],'email':_0x42ad89[0x0][_0x27094c(0x1f4)],'avatar_url':_0x42ad89[0x0][_0x27094c(0x202)],'id':_0x42ad89[0x0]['id'],'role':_0x42ad89[0x0][_0x27094c(0x219)],'token':_0x230288,'is_enabled':0x1}});}catch(_0x1b78cf){console[_0x27094c(0x1f7)](_0x27094c(0x1e8)),console['log'](_0x1b78cf),_0x9b7f88[_0x27094c(0x205)](0x1f4)['json']({'error':_0x27094c(0x1ce),'stack':_0x1b78cf[_0x27094c(0x20c)],'message':_0x1b78cf['message']});}}),router[a1_0x3ade87(0x1e9)]('/update-password',verifyToken,async(_0x5597c3,_0x1d9e99,_0x16b11f)=>{const _0x13bfad=a1_0x3ade87,{current_password:_0x2fb26,new_password:_0x490f36}=_0x5597c3[_0x13bfad(0x1fc)];console['log']({'body':_0x5597c3[_0x13bfad(0x1fc)]});const _0x1f509e=_0x5597c3[_0x13bfad(0x1d3)]['email'];let _0x317227;try{const [_0x223e6e]=await conn[_0x13bfad(0x215)]()[_0x13bfad(0x21f)](_0x13bfad(0x1c1),[_0x1f509e]);if(_0x223e6e['length']>0x0){_0x317227=_0x223e6e[0x0];if(!await bcrypt['compare'](_0x2fb26,_0x317227[_0x13bfad(0x1c7)])){_0x1d9e99['status'](0x191)[_0x13bfad(0x217)]({'error':'Invalid\x20password'});return;}const _0x26d6a9=await bcrypt[_0x13bfad(0x204)](_0x490f36,0xa);await conn[_0x13bfad(0x215)]()[_0x13bfad(0x21f)](_0x13bfad(0x1d9),[_0x26d6a9,_0x1f509e]),_0x1d9e99[_0x13bfad(0x205)](0xc8)['json']({'success':!![]});}}catch(_0x12527f){console[_0x13bfad(0x1f7)]({'err':_0x12527f}),_0x1d9e99[_0x13bfad(0x205)](0x1f4)[_0x13bfad(0x217)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router[a1_0x3ade87(0x1e9)]('/update-user-info',upload[a1_0x3ade87(0x212)](a1_0x3ade87(0x221)),verifyToken,async(_0x5ce3aa,_0x530fdb,_0x2458db)=>{const _0x43d951=a1_0x3ade87,{username:_0x48be75,first_name:_0x4e3ad7,last_name:_0x1ae0a0}=_0x5ce3aa[_0x43d951(0x1fc)],_0x4bf32d=_0x5ce3aa[_0x43d951(0x1d3)][_0x43d951(0x1f4)];let _0x282a00;try{const [_0x5718c8]=await conn[_0x43d951(0x215)]()[_0x43d951(0x21f)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x4bf32d]);_0x5718c8[_0x43d951(0x206)]>0x0&&(_0x282a00=_0x5718c8[0x0]);}catch(_0x18c5cb){console[_0x43d951(0x1f7)]({'err':_0x18c5cb}),_0x530fdb[_0x43d951(0x205)](0x1f4)[_0x43d951(0x217)]({'error':_0x43d951(0x1ce)});return;}if(!_0x282a00){_0x530fdb[_0x43d951(0x205)](0x191)['json']({'error':_0x43d951(0x1e7)});return;}console[_0x43d951(0x1f7)]({'req':_0x5ce3aa[_0x43d951(0x1fc)]});let _0xb34ac8=_0x282a00[_0x43d951(0x202)];if(_0x5ce3aa[_0x43d951(0x1f8)]){const _0xdc3fdb=_0x43d951(0x1eb)+randomUUID()+_0x43d951(0x1e5);fs[_0x43d951(0x1ea)](_0x5ce3aa[_0x43d951(0x1f8)][_0x43d951(0x1dc)],'./'+_0xdc3fdb),fs[_0x43d951(0x222)](_0x5ce3aa[_0x43d951(0x1f8)][_0x43d951(0x1dc)]),config[_0x43d951(0x1ca)]?_0xb34ac8=config['callbackMethod_gatewayUrl']+'/'+_0xdc3fdb:_0xb34ac8=config[_0x43d951(0x1e2)]+'/'+_0xdc3fdb;}try{await conn[_0x43d951(0x215)]()[_0x43d951(0x21f)](_0x43d951(0x1cf),[_0x48be75,_0x4e3ad7,_0x1ae0a0,_0xb34ac8,_0x4bf32d]);let _0x7b4667;try{_0x7b4667=jwt['sign']({'userId':_0x282a00['id'],'email':_0x282a00[_0x43d951(0x1f4)]},config['jwtSecretKey'],{'expiresIn':_0x43d951(0x1c0)});}catch(_0x234afd){console[_0x43d951(0x1f7)](_0x234afd),_0x530fdb[_0x43d951(0x205)](0x1f4)[_0x43d951(0x217)]({'error':_0x43d951(0x1ce)});return;}_0x530fdb['status'](0xc8)[_0x43d951(0x217)]({'success':!![],'data':{'userId':_0x282a00['id'],'username':_0x48be75,'first_name':_0x4e3ad7,'last_name':_0x1ae0a0,'email':_0x282a00[_0x43d951(0x1f4)],'avatar_url':_0xb34ac8,'token':_0x7b4667}});}catch(_0x26ebb7){console[_0x43d951(0x1f7)]({'err':_0x26ebb7}),_0x530fdb[_0x43d951(0x205)](0x1f4)[_0x43d951(0x217)]({'error':_0x43d951(0x1ce)});return;}}),module[a1_0x3ade87(0x1d2)]=router;