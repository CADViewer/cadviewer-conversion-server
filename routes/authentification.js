const a1_0x433bf2=a1_0xab44;(function(_0x16d770,_0x23c0c3){const _0x452427=a1_0xab44,_0x3c1178=_0x16d770();while(!![]){try{const _0x42c425=-parseInt(_0x452427(0xbd))/0x1*(parseInt(_0x452427(0x9e))/0x2)+parseInt(_0x452427(0xd5))/0x3*(-parseInt(_0x452427(0xba))/0x4)+-parseInt(_0x452427(0xc5))/0x5*(parseInt(_0x452427(0x8c))/0x6)+parseInt(_0x452427(0x87))/0x7*(parseInt(_0x452427(0xaf))/0x8)+-parseInt(_0x452427(0xac))/0x9+parseInt(_0x452427(0xc3))/0xa*(parseInt(_0x452427(0x94))/0xb)+-parseInt(_0x452427(0xca))/0xc*(-parseInt(_0x452427(0x92))/0xd);if(_0x42c425===_0x23c0c3)break;else _0x3c1178['push'](_0x3c1178['shift']());}catch(_0x229846){_0x3c1178['push'](_0x3c1178['shift']());}}}(a1_0x18b0,0xe9966));const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x433bf2(0xd3)),config=require(a1_0x433bf2(0x99)),conn=require(a1_0x433bf2(0xad)),multer=require(a1_0x433bf2(0xae)),fs=require('fs'),verifyToken=require('../libs/jwt')[a1_0x433bf2(0xcd)];function a1_0xab44(_0x22f913,_0x226ce9){const _0x18b07d=a1_0x18b0();return a1_0xab44=function(_0xab44ac,_0x48844e){_0xab44ac=_0xab44ac-0x86;let _0x559979=_0x18b07d[_0xab44ac];return _0x559979;},a1_0xab44(_0x22f913,_0x226ce9);}function a1_0x18b0(){const _0x31ea8d=['Invalid\x20user','.png','450HWlcSe','log','exports','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL\x20WHERE\x20`validation_token`\x20=\x20?','body','526981pEQGRV','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)','137236ZKojwJ','response','existsSync','crypto','Welcome\x20to\x20CADViewer','../CADViewer_config.json','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','first_name','length','Error!\x20Something\x20went\x20wrong.','20FVVcNl','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','express','ServerUrl','execute','renameSync','hash','Email\x20validated\x20successfully','transporter','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','frontendUrl','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','avatar_url','email','2953296SascTN','../libs/mysql.js','multer','7240cegHyc','json','avatar','avatars/','file','params','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','role','username','Invalid\x20email\x20or\x20password','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','247916hDpfxx','sign','last_name','178851LGpItq','promise','Invalid\x20validation\x20token','/login','/update-password','user','250IcOHgL','./avatars','49900xQPLNv','compare','24h','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','/validate-email/:token','1092jCBbTw','jwtSecretKey','crypted_password','verifyToken','enableEmailVerification','post','status','diskStorage','insertId','bcrypt','single','78yYFEZm','/validate-email/','11081mrOzVc','/update-user-info','avatars'];a1_0x18b0=function(){return _0x31ea8d;};return a1_0x18b0();}!fs[a1_0x433bf2(0x96)](a1_0x433bf2(0xc4))&&fs['mkdirSync'](a1_0x433bf2(0xc4));const express=require(a1_0x433bf2(0xa0)),router=express['Router'](),{randomUUID}=require(a1_0x433bf2(0x97)),storage=multer[a1_0x433bf2(0xd1)]({'destination':function(_0x4d5c96,_0x28f17d,_0x5ab334){const _0x56be8e=a1_0x433bf2;_0x5ab334(null,_0x56be8e(0x89));}}),upload=multer({'storage':storage});router['post'](a1_0x433bf2(0xc0),async(_0x461f68,_0x388b6a,_0x313eda)=>{const _0xdd7bc5=a1_0x433bf2;let {email:_0x3caf38,password:_0x28d6f3}=_0x461f68[_0xdd7bc5(0x91)];console[_0xdd7bc5(0x8d)]({'email':_0x3caf38,'password':_0x28d6f3});let _0x38d569;try{const [_0x2e712d]=await conn[_0xdd7bc5(0xbe)]()[_0xdd7bc5(0xa2)](_0xdd7bc5(0x9a),[_0x3caf38]);_0x2e712d[_0xdd7bc5(0x9c)]>0x0&&(_0x38d569=_0x2e712d[0x0]);}catch(_0x32e35a){console[_0xdd7bc5(0x8d)]({'err':_0x32e35a}),_0x388b6a[_0xdd7bc5(0xd0)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}console[_0xdd7bc5(0x8d)](_0x38d569),console[_0xdd7bc5(0x8d)](_0x28d6f3),console['log'](_0x38d569['crypted_password']);if(!_0x38d569||!await bcrypt[_0xdd7bc5(0xc6)](_0x28d6f3,_0x38d569['crypted_password'])){_0x388b6a[_0xdd7bc5(0xd0)](0x191)[_0xdd7bc5(0xb0)]({'error':_0xdd7bc5(0xb8)});return;}let _0x3535d0;try{_0x3535d0=jwt[_0xdd7bc5(0xbb)]({'userId':_0x38d569['id'],'email':_0x38d569[_0xdd7bc5(0xab)]},config[_0xdd7bc5(0xcb)],{'expiresIn':_0xdd7bc5(0xc7)});}catch(_0x3b6974){console['log'](_0x3b6974),_0x388b6a[_0xdd7bc5(0xd0)](0x1f4)[_0xdd7bc5(0xb0)]({'error':_0xdd7bc5(0x9d)});return;}_0x388b6a[_0xdd7bc5(0xd0)](0xc8)['json']({'success':!![],'data':{'userId':_0x38d569['id'],'username':_0x38d569[_0xdd7bc5(0xb7)],'first_name':_0x38d569[_0xdd7bc5(0x9b)],'last_name':_0x38d569[_0xdd7bc5(0xbc)],'email':_0x38d569['email'],'avatar_url':_0x38d569['avatar_url'],'id':_0x38d569['id'],'role':_0x38d569['role'],'token':_0x3535d0}});}),router[a1_0x433bf2(0xcf)]('/signup',async(_0x2b5728,_0x506a61,_0x495f5f)=>{const _0x2fe933=a1_0x433bf2,{username:_0x40421c,email:_0x251053,password:_0x3bb40d}=_0x2b5728[_0x2fe933(0x91)],[_0x2ee625]=await conn[_0x2fe933(0xbe)]()[_0x2fe933(0xa2)](_0x2fe933(0xb5),[_0x251053]);if(_0x2ee625[_0x2fe933(0x9c)]>0x0){_0x506a61[_0x2fe933(0xd0)](0x1a6)['json']({'error':'User\x20already\x20exists'});return;}const _0x49783d=await bcrypt['hash'](_0x3bb40d,0xa);let _0x24dd02=null,_0x2c073f=0x1;config[_0x2fe933(0xce)]&&(_0x24dd02=randomUUID(),_0x2c073f=0x0);let _0x3de8a5;try{const [_0x13bb4a]=await conn[_0x2fe933(0xbe)]()[_0x2fe933(0xa2)](_0x2fe933(0x93),[_0x40421c,_0x251053,_0x49783d,_0x2fe933(0xc2),_0x2c073f,_0x24dd02]);if(_0x13bb4a[_0x2fe933(0xd2)]){const [_0x58efe0]=await conn[_0x2fe933(0xbe)]()[_0x2fe933(0xa2)](_0x2fe933(0x8f),[_0x13bb4a[_0x2fe933(0xd2)]]);_0x58efe0['length']>0x0&&(_0x3de8a5=_0x58efe0[0x0]);}}catch{_0x506a61['status'](0x1f4)[_0x2fe933(0xb0)]({'error':_0x2fe933(0x9d)});return;}let _0x324fe4;try{_0x324fe4=jwt[_0x2fe933(0xbb)]({'userId':_0x3de8a5['id'],'email':_0x3de8a5[_0x2fe933(0xab)]},config[_0x2fe933(0xcb)],{'expiresIn':_0x2fe933(0xc7)});}catch(_0x2268bf){_0x506a61['status'](0x1f4)[_0x2fe933(0xb0)]({'error':_0x2fe933(0x9d)});return;}const _0x5448fd=require('../libs/mail')[_0x2fe933(0xa6)];let _0x59c0e3='<p>Welcome\x20to\x20CADViewer</p>';if(config[_0x2fe933(0xce)]){const _0x40b3c3=config[_0x2fe933(0xa8)]+_0x2fe933(0x86)+_0x24dd02;_0x59c0e3=_0x2fe933(0x9f)+_0x40b3c3+_0x2fe933(0xb9)+_0x40b3c3+_0x2fe933(0xa7);const _0xbceb49={'from':config['smtpFrom'],'to':_0x3de8a5[_0x2fe933(0xab)],'subject':_0x2fe933(0x98),'text':_0x2fe933(0x98),'html':_0x59c0e3};_0x5448fd['sendMail'](_0xbceb49,(_0x2148a6,_0x18e164)=>{const _0x4362e7=_0x2fe933;_0x2148a6?console[_0x4362e7(0x8d)](_0x2148a6):console[_0x4362e7(0x8d)]('Email\x20sent:\x20'+_0x18e164[_0x4362e7(0x95)]);}),_0x506a61['status'](0xc8)[_0x2fe933(0xb0)]({'success':!![],'message':'Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account'});return;}_0x506a61[_0x2fe933(0xd0)](0xc9)[_0x2fe933(0xb0)]({'success':!![],'data':{'userId':_0x3de8a5['id'],'username':_0x3de8a5['username'],'first_name':_0x3de8a5[_0x2fe933(0x9b)],'last_name':_0x3de8a5[_0x2fe933(0xbc)],'email':_0x3de8a5[_0x2fe933(0xab)],'avatar_url':_0x3de8a5[_0x2fe933(0xaa)],'id':_0x3de8a5['id'],'role':_0x3de8a5[_0x2fe933(0xb6)],'token':_0x324fe4,'is_enabled':_0x3de8a5['is_enabled']}});}),router[a1_0x433bf2(0xcf)](a1_0x433bf2(0xc9),async(_0x10324c,_0x4f3d1a)=>{const _0x4b3431=a1_0x433bf2;try{const {token:_0x5a5eda}=_0x10324c[_0x4b3431(0xb4)],[_0x5ea10d]=await conn['promise']()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?',[_0x5a5eda]);if(_0x5ea10d[_0x4b3431(0x9c)]===0x0){_0x4f3d1a[_0x4b3431(0xd0)](0x194)[_0x4b3431(0xb0)]({'error':_0x4b3431(0xbf)});return;}await conn['promise']()[_0x4b3431(0xa2)](_0x4b3431(0x90),[_0x5a5eda]);const _0x3c59d2=jwt[_0x4b3431(0xbb)]({'id':_0x5ea10d[0x0]['id'],'email':_0x5ea10d[0x0]['email']},config[_0x4b3431(0xcb)],{'expiresIn':_0x4b3431(0xc7)});_0x4f3d1a[_0x4b3431(0xd0)](0xc8)[_0x4b3431(0xb0)]({'success':!![],'message':_0x4b3431(0xa5),'data':{'userId':_0x5ea10d[0x0]['id'],'username':_0x5ea10d[0x0]['username'],'first_name':_0x5ea10d[0x0][_0x4b3431(0x9b)],'last_name':_0x5ea10d[0x0][_0x4b3431(0xbc)],'email':_0x5ea10d[0x0][_0x4b3431(0xab)],'avatar_url':_0x5ea10d[0x0][_0x4b3431(0xaa)],'id':_0x5ea10d[0x0]['id'],'role':_0x5ea10d[0x0][_0x4b3431(0xb6)],'token':_0x3c59d2,'is_enabled':0x1}});}catch(_0x411f34){console[_0x4b3431(0x8d)](_0x411f34),_0x4f3d1a[_0x4b3431(0xd0)](0x1f4)['json']({'error':_0x4b3431(0x9d)});}}),router['post'](a1_0x433bf2(0xc1),verifyToken,async(_0x28d25e,_0x288c01,_0x11000c)=>{const _0x589acb=a1_0x433bf2,{current_password:_0x52dfc8,new_password:_0x1e3c4b}=_0x28d25e[_0x589acb(0x91)];console['log']({'body':_0x28d25e[_0x589acb(0x91)]});const _0x3bc6d2=_0x28d25e[_0x589acb(0xc2)][_0x589acb(0xab)];let _0x7faee2;try{const [_0x409f36]=await conn[_0x589acb(0xbe)]()[_0x589acb(0xa2)](_0x589acb(0xb5),[_0x3bc6d2]);if(_0x409f36['length']>0x0){_0x7faee2=_0x409f36[0x0];if(!await bcrypt[_0x589acb(0xc6)](_0x52dfc8,_0x7faee2[_0x589acb(0xcc)])){_0x288c01['status'](0x191)['json']({'error':'Invalid\x20password'});return;}const _0x36a37c=await bcrypt[_0x589acb(0xa4)](_0x1e3c4b,0xa);await conn[_0x589acb(0xbe)]()[_0x589acb(0xa2)](_0x589acb(0xa9),[_0x36a37c,_0x3bc6d2]),_0x288c01[_0x589acb(0xd0)](0xc8)['json']({'success':!![]});}}catch(_0x3a2462){console['log']({'err':_0x3a2462}),_0x288c01[_0x589acb(0xd0)](0x1f4)['json']({'error':_0x589acb(0x9d)});return;}}),router[a1_0x433bf2(0xcf)](a1_0x433bf2(0x88),upload[a1_0x433bf2(0xd4)](a1_0x433bf2(0xb1)),verifyToken,async(_0x31fa8e,_0x396e42,_0x486a9a)=>{const _0xcf324c=a1_0x433bf2,{username:_0xc3d608,first_name:_0x480de0,last_name:_0x4cf802}=_0x31fa8e[_0xcf324c(0x91)],_0x516108=_0x31fa8e[_0xcf324c(0xc2)][_0xcf324c(0xab)];let _0x171690;try{const [_0x5c974e]=await conn[_0xcf324c(0xbe)]()[_0xcf324c(0xa2)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x516108]);_0x5c974e[_0xcf324c(0x9c)]>0x0&&(_0x171690=_0x5c974e[0x0]);}catch(_0xa6be37){console['log']({'err':_0xa6be37}),_0x396e42['status'](0x1f4)['json']({'error':_0xcf324c(0x9d)});return;}if(!_0x171690){_0x396e42[_0xcf324c(0xd0)](0x191)['json']({'error':_0xcf324c(0x8a)});return;}console['log']({'req':_0x31fa8e[_0xcf324c(0x91)]});let _0x2abed1=_0x171690[_0xcf324c(0xaa)];if(_0x31fa8e[_0xcf324c(0xb3)]){const _0x440cea=_0xcf324c(0xb2)+randomUUID()+_0xcf324c(0x8b);fs[_0xcf324c(0xa3)](_0x31fa8e['file']['path'],'./'+_0x440cea),_0x2abed1=config[_0xcf324c(0xa1)]+'/'+_0x440cea;}try{await conn[_0xcf324c(0xbe)]()[_0xcf324c(0xa2)](_0xcf324c(0xc8),[_0xc3d608,_0x480de0,_0x4cf802,_0x2abed1,_0x516108]);let _0x4e6834;try{_0x4e6834=jwt[_0xcf324c(0xbb)]({'userId':_0x171690['id'],'email':_0x171690[_0xcf324c(0xab)]},config['jwtSecretKey'],{'expiresIn':_0xcf324c(0xc7)});}catch(_0x5718f1){console[_0xcf324c(0x8d)](_0x5718f1),_0x396e42['status'](0x1f4)['json']({'error':_0xcf324c(0x9d)});return;}_0x396e42[_0xcf324c(0xd0)](0xc8)[_0xcf324c(0xb0)]({'success':!![],'data':{'userId':_0x171690['id'],'username':_0xc3d608,'first_name':_0x480de0,'last_name':_0x4cf802,'email':_0x171690[_0xcf324c(0xab)],'avatar_url':_0x2abed1,'token':_0x4e6834}});}catch(_0x19b56d){console[_0xcf324c(0x8d)]({'err':_0x19b56d}),_0x396e42[_0xcf324c(0xd0)](0x1f4)[_0xcf324c(0xb0)]({'error':_0xcf324c(0x9d)});return;}}),module[a1_0x433bf2(0x8e)]=router;