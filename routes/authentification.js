const a1_0x2f73b0=a1_0x5ba2;function a1_0x5ba2(_0x267f79,_0x85daca){const _0x3a10b0=a1_0x3a10();return a1_0x5ba2=function(_0x5ba235,_0x15bdb9){_0x5ba235=_0x5ba235-0xc7;let _0x4f0fd7=_0x3a10b0[_0x5ba235];return _0x4f0fd7;},a1_0x5ba2(_0x267f79,_0x85daca);}(function(_0x50f982,_0x45db60){const _0x5e4291=a1_0x5ba2,_0x57c665=_0x50f982();while(!![]){try{const _0x294304=parseInt(_0x5e4291(0x102))/0x1+-parseInt(_0x5e4291(0xc8))/0x2+parseInt(_0x5e4291(0xe0))/0x3+parseInt(_0x5e4291(0xd1))/0x4+-parseInt(_0x5e4291(0xdf))/0x5*(parseInt(_0x5e4291(0xeb))/0x6)+parseInt(_0x5e4291(0xe5))/0x7*(-parseInt(_0x5e4291(0xf4))/0x8)+parseInt(_0x5e4291(0xf5))/0x9*(parseInt(_0x5e4291(0xdd))/0xa);if(_0x294304===_0x45db60)break;else _0x57c665['push'](_0x57c665['shift']());}catch(_0x2341ec){_0x57c665['push'](_0x57c665['shift']());}}}(a1_0x3a10,0xceb89));const jwt=require('jsonwebtoken'),bcrypt=require(a1_0x2f73b0(0x100)),config=require(a1_0x2f73b0(0xd0)),conn=require(a1_0x2f73b0(0xd2)),multer=require(a1_0x2f73b0(0xfc)),fs=require('fs'),verifyToken=require(a1_0x2f73b0(0xda))['verifyToken'];function a1_0x3a10(){const _0x1121f0=['multer','avatars/','diskStorage','execute','bcrypt','/update-password','1181911TXDqrn','sign','body','avatar','1170642nMTTUT','ServerUrl','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','24h','Invalid\x20password','.png','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','username','../CADViewer_config.json','772760vixFVJ','../libs/mysql.js','renameSync','length','email','compare','last_name','promise','User\x20already\x20exists','../libs/jwt','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','express','280010XWmBNG','first_name','6025bZoNNL','2858130MvNSjB','Error!\x20Something\x20went\x20wrong.','post','status','user','105308nIbwua','json','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','/login','mkdirSync','insertId','4494tHipFa','Invalid\x20user','log','/signup','exports','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','avatar_url','jwtSecretKey','role','592AcMEOX','360tlGhiQ','./avatars','path','crypted_password','Invalid\x20email\x20or\x20password','hash','single'];a1_0x3a10=function(){return _0x1121f0;};return a1_0x3a10();}!fs['existsSync'](a1_0x2f73b0(0xf6))&&fs[a1_0x2f73b0(0xe9)](a1_0x2f73b0(0xf6));const express=require(a1_0x2f73b0(0xdc)),router=express['Router'](),{randomUUID}=require('crypto'),storage=multer[a1_0x2f73b0(0xfe)]({'destination':function(_0x1deaa0,_0x372b3e,_0x2541c3){_0x2541c3(null,'avatars');}}),upload=multer({'storage':storage});router['post'](a1_0x2f73b0(0xe8),async(_0x22a67d,_0x566fcc,_0x4fa530)=>{const _0x34f4f2=a1_0x2f73b0;let {email:_0x32d919,password:_0x1b60ac}=_0x22a67d[_0x34f4f2(0x104)];console['log']({'email':_0x32d919,'password':_0x1b60ac});let _0x453306;try{const [_0x17733d]=await conn[_0x34f4f2(0xd8)]()['execute'](_0x34f4f2(0xe7),[_0x32d919]);_0x17733d['length']>0x0&&(_0x453306=_0x17733d[0x0]);}catch(_0xe88ba7){console[_0x34f4f2(0xed)]({'err':_0xe88ba7}),_0x566fcc[_0x34f4f2(0xe3)](0x1f4)[_0x34f4f2(0xe6)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}console[_0x34f4f2(0xed)](_0x453306),console[_0x34f4f2(0xed)](_0x1b60ac),console[_0x34f4f2(0xed)](_0x453306[_0x34f4f2(0xf8)]);if(!_0x453306||!await bcrypt['compare'](_0x1b60ac,_0x453306[_0x34f4f2(0xf8)])){_0x566fcc['status'](0x191)[_0x34f4f2(0xe6)]({'error':_0x34f4f2(0xf9)});return;}let _0x1ea060;try{_0x1ea060=jwt[_0x34f4f2(0x103)]({'userId':_0x453306['id'],'email':_0x453306[_0x34f4f2(0xd5)]},config[_0x34f4f2(0xf2)],{'expiresIn':'24h'});}catch(_0x29dc57){console['log'](_0x29dc57),_0x566fcc[_0x34f4f2(0xe3)](0x1f4)[_0x34f4f2(0xe6)]({'error':_0x34f4f2(0xe1)});return;}_0x566fcc[_0x34f4f2(0xe3)](0xc8)['json']({'success':!![],'data':{'userId':_0x453306['id'],'username':_0x453306[_0x34f4f2(0xcf)],'first_name':_0x453306[_0x34f4f2(0xde)],'last_name':_0x453306[_0x34f4f2(0xd7)],'email':_0x453306[_0x34f4f2(0xd5)],'avatar_url':_0x453306['avatar_url'],'id':_0x453306['id'],'role':_0x453306[_0x34f4f2(0xf3)],'token':_0x1ea060}});}),router['post'](a1_0x2f73b0(0xee),async(_0x4febf5,_0x521caa,_0x52ae2c)=>{const _0x57cf2e=a1_0x2f73b0,{username:_0x362b9a,email:_0x4b20ce,password:_0xe4d50b}=_0x4febf5['body'],[_0x37f778]=await conn[_0x57cf2e(0xd8)]()[_0x57cf2e(0xff)](_0x57cf2e(0xdb),[_0x4b20ce]);if(_0x37f778[_0x57cf2e(0xd4)]>0x0){_0x521caa['status'](0x1a6)[_0x57cf2e(0xe6)]({'error':_0x57cf2e(0xd9)});return;}const _0x52acea=await bcrypt['hash'](_0xe4d50b,0xa);try{const [_0x38a603]=await conn[_0x57cf2e(0xd8)]()[_0x57cf2e(0xff)](_0x57cf2e(0xf0),[_0x362b9a,_0x4b20ce,_0x52acea,'user']);if(_0x38a603[_0x57cf2e(0xea)]){const [_0x30d788]=await conn[_0x57cf2e(0xd8)]()['execute'](_0x57cf2e(0xca),[_0x38a603[_0x57cf2e(0xea)]]);_0x30d788[_0x57cf2e(0xd4)]>0x0&&(newUser=_0x30d788[0x0]);}}catch{_0x521caa['status'](0x1f4)[_0x57cf2e(0xe6)]({'error':_0x57cf2e(0xe1)});return;}let _0x2ff28d;try{_0x2ff28d=jwt['sign']({'userId':newUser['id'],'email':newUser[_0x57cf2e(0xd5)]},config['jwtSecretKey'],{'expiresIn':'24h'});}catch(_0x50a5c0){_0x521caa[_0x57cf2e(0xe3)](0x1f4)[_0x57cf2e(0xe6)]({'error':_0x57cf2e(0xe1)});return;}_0x521caa[_0x57cf2e(0xe3)](0xc9)[_0x57cf2e(0xe6)]({'success':!![],'data':{'userId':newUser['id'],'username':newUser[_0x57cf2e(0xcf)],'first_name':newUser[_0x57cf2e(0xde)],'last_name':newUser[_0x57cf2e(0xd7)],'email':newUser[_0x57cf2e(0xd5)],'avatar_url':newUser[_0x57cf2e(0xf1)],'id':newUser['id'],'role':newUser[_0x57cf2e(0xf3)],'token':_0x2ff28d}});}),router['post'](a1_0x2f73b0(0x101),verifyToken,async(_0x2f34d5,_0x407d18,_0x17dc84)=>{const _0x2c9025=a1_0x2f73b0,{current_password:_0x1798e2,new_password:_0x38000e}=_0x2f34d5[_0x2c9025(0x104)];console[_0x2c9025(0xed)]({'body':_0x2f34d5[_0x2c9025(0x104)]});const _0x1fb5f1=_0x2f34d5[_0x2c9025(0xe4)]['email'];let _0x437063;try{const [_0x3815d6]=await conn[_0x2c9025(0xd8)]()[_0x2c9025(0xff)](_0x2c9025(0xdb),[_0x1fb5f1]);if(_0x3815d6[_0x2c9025(0xd4)]>0x0){_0x437063=_0x3815d6[0x0];if(!await bcrypt[_0x2c9025(0xd6)](_0x1798e2,_0x437063[_0x2c9025(0xf8)])){_0x407d18[_0x2c9025(0xe3)](0x191)['json']({'error':_0x2c9025(0xcc)});return;}const _0x3c06f7=await bcrypt[_0x2c9025(0xfa)](_0x38000e,0xa);await conn[_0x2c9025(0xd8)]()[_0x2c9025(0xff)](_0x2c9025(0xce),[_0x3c06f7,_0x1fb5f1]),_0x407d18[_0x2c9025(0xe3)](0xc8)[_0x2c9025(0xe6)]({'success':!![]});}}catch(_0x28c7d3){console[_0x2c9025(0xed)]({'err':_0x28c7d3}),_0x407d18[_0x2c9025(0xe3)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router[a1_0x2f73b0(0xe2)]('/update-user-info',upload[a1_0x2f73b0(0xfb)](a1_0x2f73b0(0xc7)),verifyToken,async(_0x15b700,_0x5e7595,_0x5a0a8c)=>{const _0x13ea63=a1_0x2f73b0,{username:_0x364c65,first_name:_0x437c78,last_name:_0x363002}=_0x15b700['body'],_0x4d406a=_0x15b700[_0x13ea63(0xe4)][_0x13ea63(0xd5)];let _0x5ca060;try{const [_0x425c5a]=await conn[_0x13ea63(0xd8)]()[_0x13ea63(0xff)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x4d406a]);_0x425c5a[_0x13ea63(0xd4)]>0x0&&(_0x5ca060=_0x425c5a[0x0]);}catch(_0x3117b1){console[_0x13ea63(0xed)]({'err':_0x3117b1}),_0x5e7595['status'](0x1f4)['json']({'error':_0x13ea63(0xe1)});return;}if(!_0x5ca060){_0x5e7595[_0x13ea63(0xe3)](0x191)[_0x13ea63(0xe6)]({'error':_0x13ea63(0xec)});return;}console[_0x13ea63(0xed)]({'req':_0x15b700[_0x13ea63(0x104)]});let _0x5bc0e6=_0x5ca060['avatar_url'];if(_0x15b700['file']){const _0x1cad8f=_0x13ea63(0xfd)+randomUUID()+_0x13ea63(0xcd);fs[_0x13ea63(0xd3)](_0x15b700['file'][_0x13ea63(0xf7)],'./'+_0x1cad8f),_0x5bc0e6=config[_0x13ea63(0xc9)]+'/'+_0x1cad8f;}try{await conn[_0x13ea63(0xd8)]()['execute']('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x364c65,_0x437c78,_0x363002,_0x5bc0e6,_0x4d406a]);let _0x586e94;try{_0x586e94=jwt[_0x13ea63(0x103)]({'userId':_0x5ca060['id'],'email':_0x5ca060['email']},config[_0x13ea63(0xf2)],{'expiresIn':_0x13ea63(0xcb)});}catch(_0x34cfbf){console[_0x13ea63(0xed)](_0x34cfbf),_0x5e7595['status'](0x1f4)[_0x13ea63(0xe6)]({'error':_0x13ea63(0xe1)});return;}_0x5e7595[_0x13ea63(0xe3)](0xc8)[_0x13ea63(0xe6)]({'success':!![],'data':{'userId':_0x5ca060['id'],'username':_0x364c65,'first_name':_0x437c78,'last_name':_0x363002,'email':_0x5ca060[_0x13ea63(0xd5)],'avatar_url':_0x5bc0e6,'token':_0x586e94}});}catch(_0x2d2cc2){console['log']({'err':_0x2d2cc2}),_0x5e7595[_0x13ea63(0xe3)](0x1f4)[_0x13ea63(0xe6)]({'error':_0x13ea63(0xe1)});return;}}),module[a1_0x2f73b0(0xef)]=router;