const a1_0xbf2802=a1_0x3059;function a1_0x3059(_0x4a717d,_0x5c32aa){const _0xe8382e=a1_0xe838();return a1_0x3059=function(_0x305966,_0x5af887){_0x305966=_0x305966-0xe2;let _0x1571c9=_0xe8382e[_0x305966];return _0x1571c9;},a1_0x3059(_0x4a717d,_0x5c32aa);}function a1_0xe838(){const _0x2f6942=['1093240jLuQfv','../libs/mysql.js','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','compare','log','73434BWvPhg','execute','express','6390JtGSUs','/update-user-info','../CADViewer_config.json','Invalid\x20email\x20or\x20password','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','/update-password','verifyToken','/signup','24h','avatar','promise','hash','length','1050915ZrnnNQ','bcrypt','1122359HXqzlu','body','./avatars','sign','status','20TYSZjC','../libs/jwt','1195119iZqmDR','first_name','role','.png','Error!\x20Something\x20went\x20wrong.','jsonwebtoken','avatars/','json','User\x20already\x20exists','jwtSecretKey','/login','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','avatars','user','email','avatar_url','existsSync','post','4IBZVnT','last_name','Invalid\x20password','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','multer','crypted_password','1054992gjuxQY','renameSync','10cwUHWL','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?'];a1_0xe838=function(){return _0x2f6942;};return a1_0xe838();}(function(_0x20b604,_0x427f37){const _0x250ea0=a1_0x3059,_0xb90bcf=_0x20b604();while(!![]){try{const _0x16b392=-parseInt(_0x250ea0(0x100))/0x1*(-parseInt(_0x250ea0(0x114))/0x2)+-parseInt(_0x250ea0(0xfd))/0x3+parseInt(_0x250ea0(0xee))/0x4*(parseInt(_0x250ea0(0x10d))/0x5)+parseInt(_0x250ea0(0xf4))/0x6+-parseInt(_0x250ea0(0x10f))/0x7+parseInt(_0x250ea0(0xf8))/0x8+parseInt(_0x250ea0(0x116))/0x9*(-parseInt(_0x250ea0(0xf6))/0xa);if(_0x16b392===_0x427f37)break;else _0xb90bcf['push'](_0xb90bcf['shift']());}catch(_0x16252f){_0xb90bcf['push'](_0xb90bcf['shift']());}}}(a1_0xe838,0x41aa4));const jwt=require(a1_0xbf2802(0x11b)),bcrypt=require(a1_0xbf2802(0x10e)),config=require(a1_0xbf2802(0x102)),conn=require(a1_0xbf2802(0xf9)),multer=require(a1_0xbf2802(0xf2)),fs=require('fs'),verifyToken=require(a1_0xbf2802(0x115))[a1_0xbf2802(0x106)];!fs[a1_0xbf2802(0xec)](a1_0xbf2802(0x111))&&fs['mkdirSync'](a1_0xbf2802(0x111));const express=require(a1_0xbf2802(0xff)),router=express['Router'](),{randomUUID}=require('crypto'),storage=multer['diskStorage']({'destination':function(_0x503410,_0x56a806,_0x867009){const _0x3cd5dd=a1_0xbf2802;_0x867009(null,_0x3cd5dd(0xe8));}}),upload=multer({'storage':storage});router[a1_0xbf2802(0xed)](a1_0xbf2802(0xe6),async(_0x413234,_0x259b00,_0x540a6b)=>{const _0x504c32=a1_0xbf2802;let {email:_0x5a2dca,password:_0x1f0563}=_0x413234['body'];console[_0x504c32(0xfc)]({'email':_0x5a2dca,'password':_0x1f0563});let _0x45c799;try{const [_0x4a92bd]=await conn['promise']()[_0x504c32(0xfe)](_0x504c32(0xf7),[_0x5a2dca]);_0x4a92bd[_0x504c32(0x10c)]>0x0&&(_0x45c799=_0x4a92bd[0x0]);}catch(_0x240739){console[_0x504c32(0xfc)]({'err':_0x240739}),_0x259b00['status'](0x1f4)[_0x504c32(0xe3)]({'error':_0x504c32(0x11a)});return;}console['log'](_0x45c799),console['log'](_0x1f0563),console[_0x504c32(0xfc)](_0x45c799[_0x504c32(0xf3)]);if(!_0x45c799||!await bcrypt[_0x504c32(0xfb)](_0x1f0563,_0x45c799[_0x504c32(0xf3)])){_0x259b00['status'](0x191)[_0x504c32(0xe3)]({'error':_0x504c32(0x103)});return;}let _0x3b2098;try{_0x3b2098=jwt[_0x504c32(0x112)]({'userId':_0x45c799['id'],'email':_0x45c799[_0x504c32(0xea)]},config[_0x504c32(0xe5)],{'expiresIn':_0x504c32(0x108)});}catch(_0x4067dc){console[_0x504c32(0xfc)](_0x4067dc),_0x259b00[_0x504c32(0x113)](0x1f4)[_0x504c32(0xe3)]({'error':_0x504c32(0x11a)});return;}_0x259b00[_0x504c32(0x113)](0xc8)[_0x504c32(0xe3)]({'success':!![],'data':{'userId':_0x45c799['id'],'username':_0x45c799['username'],'first_name':_0x45c799[_0x504c32(0x117)],'last_name':_0x45c799[_0x504c32(0xef)],'email':_0x45c799['email'],'avatar_url':_0x45c799[_0x504c32(0xeb)],'id':_0x45c799['id'],'role':_0x45c799['role'],'token':_0x3b2098}});}),router[a1_0xbf2802(0xed)](a1_0xbf2802(0x107),async(_0x153a64,_0x1fe851,_0x565f40)=>{const _0x1b9927=a1_0xbf2802,{username:_0x295daa,email:_0x51d084,password:_0x484890}=_0x153a64[_0x1b9927(0x110)],[_0x42ba7e]=await conn['promise']()[_0x1b9927(0xfe)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x51d084]);if(_0x42ba7e['length']>0x0){_0x1fe851['status'](0x1a6)[_0x1b9927(0xe3)]({'error':_0x1b9927(0xe4)});return;}const _0x1dcdb8=await bcrypt[_0x1b9927(0x10b)](_0x484890,0xa);try{const [_0x319a4e]=await conn[_0x1b9927(0x10a)]()[_0x1b9927(0xfe)](_0x1b9927(0xfa),[_0x295daa,_0x51d084,_0x1dcdb8,_0x1b9927(0xe9)]);if(_0x319a4e['insertId']){const [_0x55aed7]=await conn['promise']()[_0x1b9927(0xfe)](_0x1b9927(0xe7),[_0x319a4e['insertId']]);_0x55aed7['length']>0x0&&(newUser=_0x55aed7[0x0]);}}catch{_0x1fe851[_0x1b9927(0x113)](0x1f4)['json']({'error':_0x1b9927(0x11a)});return;}let _0x595c55;try{_0x595c55=jwt[_0x1b9927(0x112)]({'userId':newUser['id'],'email':newUser[_0x1b9927(0xea)]},config['jwtSecretKey'],{'expiresIn':'24h'});}catch(_0x2a38d7){_0x1fe851[_0x1b9927(0x113)](0x1f4)[_0x1b9927(0xe3)]({'error':_0x1b9927(0x11a)});return;}_0x1fe851[_0x1b9927(0x113)](0xc9)['json']({'success':!![],'data':{'userId':newUser['id'],'username':newUser['username'],'first_name':newUser[_0x1b9927(0x117)],'last_name':newUser[_0x1b9927(0xef)],'email':newUser[_0x1b9927(0xea)],'avatar_url':newUser[_0x1b9927(0xeb)],'id':newUser['id'],'role':newUser[_0x1b9927(0x118)],'token':_0x595c55}});}),router[a1_0xbf2802(0xed)](a1_0xbf2802(0x105),verifyToken,async(_0x1cfba7,_0x4e1002,_0x32f718)=>{const _0x2e64ed=a1_0xbf2802,{current_password:_0x54303f,new_password:_0x31f313}=_0x1cfba7[_0x2e64ed(0x110)];console[_0x2e64ed(0xfc)]({'body':_0x1cfba7[_0x2e64ed(0x110)]});const _0x6cfa19=_0x1cfba7['user'][_0x2e64ed(0xea)];let _0x1b492f;try{const [_0x7094ed]=await conn['promise']()[_0x2e64ed(0xfe)](_0x2e64ed(0x104),[_0x6cfa19]);if(_0x7094ed['length']>0x0){_0x1b492f=_0x7094ed[0x0];if(!await bcrypt[_0x2e64ed(0xfb)](_0x54303f,_0x1b492f[_0x2e64ed(0xf3)])){_0x4e1002['status'](0x191)[_0x2e64ed(0xe3)]({'error':_0x2e64ed(0xf0)});return;}const _0x2acccb=await bcrypt[_0x2e64ed(0x10b)](_0x31f313,0xa);await conn[_0x2e64ed(0x10a)]()[_0x2e64ed(0xfe)](_0x2e64ed(0xf1),[_0x2acccb,_0x6cfa19]),_0x4e1002['status'](0xc8)[_0x2e64ed(0xe3)]({'success':!![]});}}catch(_0x9208b){console[_0x2e64ed(0xfc)]({'err':_0x9208b}),_0x4e1002[_0x2e64ed(0x113)](0x1f4)['json']({'error':_0x2e64ed(0x11a)});return;}}),router[a1_0xbf2802(0xed)](a1_0xbf2802(0x101),upload['single'](a1_0xbf2802(0x109)),verifyToken,async(_0x4df975,_0x16b484,_0x80b7cb)=>{const _0x18c5a2=a1_0xbf2802,{username:_0x3afe6a,first_name:_0x19c78c,last_name:_0x79c261}=_0x4df975[_0x18c5a2(0x110)],_0x5a23b4=_0x4df975[_0x18c5a2(0xe9)][_0x18c5a2(0xea)];let _0x49aec1;try{const [_0x13b733]=await conn[_0x18c5a2(0x10a)]()[_0x18c5a2(0xfe)](_0x18c5a2(0x104),[_0x5a23b4]);_0x13b733['length']>0x0&&(_0x49aec1=_0x13b733[0x0]);}catch(_0x4dd354){console[_0x18c5a2(0xfc)]({'err':_0x4dd354}),_0x16b484[_0x18c5a2(0x113)](0x1f4)[_0x18c5a2(0xe3)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x49aec1){_0x16b484['status'](0x191)[_0x18c5a2(0xe3)]({'error':'Invalid\x20user'});return;}console[_0x18c5a2(0xfc)]({'req':_0x4df975[_0x18c5a2(0x110)]});let _0x2677c9=_0x49aec1[_0x18c5a2(0xeb)];if(_0x4df975['file']){const _0x178151=_0x18c5a2(0xe2)+randomUUID()+_0x18c5a2(0x119);fs[_0x18c5a2(0xf5)](_0x4df975['file']['path'],'./'+_0x178151),_0x2677c9=config['ServerUrl']+'/'+_0x178151;}try{await conn[_0x18c5a2(0x10a)]()[_0x18c5a2(0xfe)]('UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x3afe6a,_0x19c78c,_0x79c261,_0x2677c9,_0x5a23b4]);let _0x1f5abf;try{_0x1f5abf=jwt['sign']({'userId':_0x49aec1['id'],'email':_0x49aec1['email']},config[_0x18c5a2(0xe5)],{'expiresIn':_0x18c5a2(0x108)});}catch(_0x4752dd){console[_0x18c5a2(0xfc)](_0x4752dd),_0x16b484[_0x18c5a2(0x113)](0x1f4)[_0x18c5a2(0xe3)]({'error':_0x18c5a2(0x11a)});return;}_0x16b484[_0x18c5a2(0x113)](0xc8)[_0x18c5a2(0xe3)]({'success':!![],'data':{'userId':_0x49aec1['id'],'username':_0x3afe6a,'first_name':_0x19c78c,'last_name':_0x79c261,'email':_0x49aec1[_0x18c5a2(0xea)],'avatar_url':_0x2677c9,'token':_0x1f5abf}});}catch(_0x4049d7){console[_0x18c5a2(0xfc)]({'err':_0x4049d7}),_0x16b484[_0x18c5a2(0x113)](0x1f4)['json']({'error':_0x18c5a2(0x11a)});return;}}),module['exports']=router;