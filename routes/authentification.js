function a1_0x1d53(_0x896f70,_0x4e7165){const _0x45dd85=a1_0x45dd();return a1_0x1d53=function(_0x1d53f4,_0x7fbadc){_0x1d53f4=_0x1d53f4-0x12e;let _0x4117d4=_0x45dd85[_0x1d53f4];return _0x4117d4;},a1_0x1d53(_0x896f70,_0x4e7165);}const a1_0x412080=a1_0x1d53;(function(_0x121ae0,_0x2a08bc){const _0xbdbbd4=a1_0x1d53,_0x3d876d=_0x121ae0();while(!![]){try{const _0x2b1fc2=-parseInt(_0xbdbbd4(0x169))/0x1*(parseInt(_0xbdbbd4(0x14d))/0x2)+-parseInt(_0xbdbbd4(0x182))/0x3*(-parseInt(_0xbdbbd4(0x17d))/0x4)+parseInt(_0xbdbbd4(0x163))/0x5+parseInt(_0xbdbbd4(0x131))/0x6*(parseInt(_0xbdbbd4(0x13a))/0x7)+parseInt(_0xbdbbd4(0x143))/0x8*(parseInt(_0xbdbbd4(0x130))/0x9)+parseInt(_0xbdbbd4(0x14b))/0xa+-parseInt(_0xbdbbd4(0x156))/0xb*(parseInt(_0xbdbbd4(0x133))/0xc);if(_0x2b1fc2===_0x2a08bc)break;else _0x3d876d['push'](_0x3d876d['shift']());}catch(_0xf52417){_0x3d876d['push'](_0x3d876d['shift']());}}}(a1_0x45dd,0xa741f));const jwt=require(a1_0x412080(0x160)),bcrypt=require('bcrypt'),config=require('../CADViewer_config.json'),conn=require(a1_0x412080(0x16e)),multer=require(a1_0x412080(0x172)),fs=require('fs'),verifyToken=require(a1_0x412080(0x157))['verifyToken'],{sendWelcomeEmail}=require(a1_0x412080(0x12f)),axios=require(a1_0x412080(0x132));function a1_0x45dd(){const _0x3b624b=['existsSync','first_name','demo_user','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','avatar_url','time_zone','promise','single','701576cVLuYG','user','stack','avatar','/update-password','length','express','languages','7967030vyiJgd','params','565342pnwlSR','enableEmailVerification','User\x20already\x20exists','./uploads/','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','https://www.google.com/recaptcha/api/siteverify','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','name','recaptchaEnabled','24024649hfBEZa','../libs/jwt','last_name','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','status','hash','mkdirSync','success','.png','city','jsonwebtoken','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','json','6015640CrVCLF','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','data','sign','Email\x20validated\x20successfully','file','4FPxyTc','body','callbackMethod_gatewayUrl_flag','execute','copyFileSync','../libs/mysql.js','email','message','crypto','multer','Invalid\x20validation\x20token','compare','/signup','24h','jwtSecretKey','username','region','Error!\x20Something\x20went\x20wrong.','Error\x20during\x20reCAPTCHA\x20verification.','crypted_password','460gtfgXY','role','path','error','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','35268StKhbZ','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','exports','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','/validate-email/:token','unlinkSync','./avatars','Error\x20parsing\x20geolocation\x20data:','callbackMethod_gatewayUrl','/update-user-info','../libs/email-utils','54iUYWqp','31794azhTLR','axios','12OFXONq','avatars','avatars/','Router','===================error===================','post','log','161IeHmMN'];a1_0x45dd=function(){return _0x3b624b;};return a1_0x45dd();}!fs[a1_0x412080(0x13b)](a1_0x412080(0x188))&&fs[a1_0x412080(0x15c)](a1_0x412080(0x188));const express=require(a1_0x412080(0x149)),router=express[a1_0x412080(0x136)](),{randomUUID}=require(a1_0x412080(0x171)),storage=multer['diskStorage']({'destination':function(_0x4d02d4,_0x223159,_0x33c11d){const _0x320670=a1_0x412080;_0x33c11d(null,_0x320670(0x134));}}),upload=multer({'storage':storage});router[a1_0x412080(0x138)]('/login',async(_0x2a1077,_0x2956b2,_0x4358e5)=>{const _0x26bf7d=a1_0x412080;let {email:_0x17a435,password:_0x1c183a}=_0x2a1077[_0x26bf7d(0x16a)];console[_0x26bf7d(0x139)]({'email':_0x17a435,'password':_0x1c183a});let _0xa1cbac;try{const [_0x2ce144]=await conn[_0x26bf7d(0x141)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?',[_0x17a435]);_0x2ce144[_0x26bf7d(0x148)]>0x0&&(_0xa1cbac=_0x2ce144[0x0]);}catch(_0x3f506f){console[_0x26bf7d(0x139)]({'err':_0x3f506f}),_0x2956b2[_0x26bf7d(0x15a)](0x1f4)[_0x26bf7d(0x162)]({'error':_0x26bf7d(0x17a)});return;}if(!_0xa1cbac||!await bcrypt[_0x26bf7d(0x174)](_0x1c183a,_0xa1cbac?.[_0x26bf7d(0x17c)])){_0x2956b2[_0x26bf7d(0x15a)](0x191)['json']({'error':'Invalid\x20email\x20or\x20password'});return;}let _0x5cb82f;try{_0x5cb82f=jwt['sign']({'userId':_0xa1cbac['id'],'email':_0xa1cbac[_0x26bf7d(0x16f)]},config[_0x26bf7d(0x177)],{'expiresIn':'24h'});}catch(_0x5c9452){console[_0x26bf7d(0x139)](_0x5c9452),_0x2956b2['status'](0x1f4)[_0x26bf7d(0x162)]({'error':_0x26bf7d(0x17a)});return;}_0x2956b2['status'](0xc8)[_0x26bf7d(0x162)]({'success':!![],'data':{'userId':_0xa1cbac['id'],'username':_0xa1cbac[_0x26bf7d(0x178)],'first_name':_0xa1cbac[_0x26bf7d(0x13c)],'last_name':_0xa1cbac[_0x26bf7d(0x158)],'email':_0xa1cbac[_0x26bf7d(0x16f)],'avatar_url':_0xa1cbac[_0x26bf7d(0x13f)],'id':_0xa1cbac['id'],'role':_0xa1cbac['role'],'token':_0x5cb82f}});}),router['post'](a1_0x412080(0x175),async(_0xb5cb97,_0x126369,_0x274776)=>{const _0x2677c3=a1_0x412080,{username:_0x3ce53a,email:_0x5a1f7a,password:_0x488202,geolocation:_0x3d22ae,recaptchaToken:_0x4f0d90}=_0xb5cb97[_0x2677c3(0x16a)];if(config[_0x2677c3(0x155)]){if(!_0x4f0d90)return _0x126369[_0x2677c3(0x15a)](0x190)[_0x2677c3(0x162)]({'error':_0x2677c3(0x159)});try{const _0x30a9bd=await axios['post'](_0x2677c3(0x152),null,{'params':{'secret':config['recaptchaSecretKey'],'response':_0x4f0d90}});if(!_0x30a9bd[_0x2677c3(0x165)][_0x2677c3(0x15d)])return _0x126369[_0x2677c3(0x15a)](0x190)[_0x2677c3(0x162)]({'error':_0x2677c3(0x159),'recaptchaErrors':_0x30a9bd[_0x2677c3(0x165)]['error-codes']});}catch(_0x3373f9){return console[_0x2677c3(0x180)]('reCAPTCHA\x20verification\x20error:',_0x3373f9),_0x126369[_0x2677c3(0x15a)](0x1f4)[_0x2677c3(0x162)]({'error':_0x2677c3(0x17b)});}}const [_0x45d324]=await conn['promise']()[_0x2677c3(0x16c)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x5a1f7a]);if(_0x45d324[_0x2677c3(0x148)]>0x0){_0x126369['status'](0x1a6)['json']({'error':_0x2677c3(0x14f)});return;}const _0x1f1de9=await bcrypt[_0x2677c3(0x15b)](_0x488202,0xa);let _0x37772d=null,_0x41d090=0x1;config[_0x2677c3(0x14e)]&&(_0x37772d=randomUUID(),_0x41d090=0x0);let _0x5d6514=null,_0x120ac6=null,_0x1ff308=null,_0x560ae5=null,_0x2e03f1=null,_0x54b8aa=null;if(_0x3d22ae)try{const _0x5d9823=_0x3d22ae;_0x5d6514=_0x5d9823[_0x2677c3(0x15f)]||null,_0x120ac6=_0x5d9823[_0x2677c3(0x179)]||null,_0x1ff308=_0x5d9823['country_name']||null,_0x5d9823['languages']&&_0x5d9823[_0x2677c3(0x14a)][_0x2677c3(0x148)]>0x0&&(_0x560ae5=_0x5d9823[_0x2677c3(0x14a)][0x0]['code']||null,_0x2e03f1=_0x5d9823[_0x2677c3(0x14a)][0x0][_0x2677c3(0x154)]||null),_0x5d9823[_0x2677c3(0x140)]&&(_0x54b8aa=_0x5d9823[_0x2677c3(0x140)][_0x2677c3(0x154)]||null);}catch(_0x5c8de8){console[_0x2677c3(0x139)](_0x2677c3(0x189),_0x5c8de8);}let _0x31995a;try{const _0x4e141f=randomUUID(),_0x2a9d59=_0x2677c3(0x150)+_0x4e141f;fs[_0x2677c3(0x15c)](_0x2a9d59);const [_0x3c53da]=await conn[_0x2677c3(0x141)]()[_0x2677c3(0x16c)](_0x2677c3(0x161),[_0x3ce53a,_0x5a1f7a,_0x1f1de9,_0x2677c3(0x13d),_0x41d090,_0x37772d,_0x4e141f,_0x5d6514,_0x120ac6,_0x1ff308,_0x560ae5,_0x2e03f1,_0x54b8aa]);if(_0x3c53da['insertId']){const [_0x42d1ba]=await conn[_0x2677c3(0x141)]()[_0x2677c3(0x16c)](_0x2677c3(0x185),[_0x3c53da['insertId']]);_0x42d1ba[_0x2677c3(0x148)]>0x0&&(_0x31995a=_0x42d1ba[0x0]);}}catch(_0x31dfee){console['log']('Error\x20during\x20user\x20creation:',_0x31dfee),_0x126369[_0x2677c3(0x15a)](0x1f4)[_0x2677c3(0x162)]({'error':_0x2677c3(0x17a)});return;}let _0x19db91;try{_0x19db91=jwt[_0x2677c3(0x166)]({'userId':_0x31995a['id'],'email':_0x31995a[_0x2677c3(0x16f)]},config['jwtSecretKey'],{'expiresIn':_0x2677c3(0x176)});}catch(_0x4d3222){_0x126369[_0x2677c3(0x15a)](0x1f4)[_0x2677c3(0x162)]({'error':_0x2677c3(0x17a)});return;}if(config[_0x2677c3(0x14e)]){try{await sendWelcomeEmail(_0x31995a,_0x37772d);}catch(_0x14d74f){console[_0x2677c3(0x139)]('===================error==================='),console[_0x2677c3(0x139)](_0x14d74f);}_0x126369[_0x2677c3(0x15a)](0xc8)[_0x2677c3(0x162)]({'success':!![],'message':_0x2677c3(0x183)});return;}_0x126369['status'](0xc9)[_0x2677c3(0x162)]({'success':!![],'data':{'userId':_0x31995a['id'],'username':_0x31995a[_0x2677c3(0x178)],'first_name':_0x31995a[_0x2677c3(0x13c)],'last_name':_0x31995a[_0x2677c3(0x158)],'email':_0x31995a[_0x2677c3(0x16f)],'avatar_url':_0x31995a[_0x2677c3(0x13f)],'id':_0x31995a['id'],'role':_0x31995a['role'],'token':_0x19db91,'is_enabled':_0x31995a['is_enabled']}});}),router[a1_0x412080(0x138)](a1_0x412080(0x186),async(_0x1d443b,_0x18ae5d)=>{const _0x466a6f=a1_0x412080;try{const {token:_0x207fd7}=_0x1d443b[_0x466a6f(0x14c)],[_0x1dc8ec]=await conn[_0x466a6f(0x141)]()[_0x466a6f(0x16c)](_0x466a6f(0x151),[_0x207fd7]);if(_0x1dc8ec['length']===0x0){_0x18ae5d[_0x466a6f(0x15a)](0x194)[_0x466a6f(0x162)]({'error':_0x466a6f(0x173)});return;}await conn[_0x466a6f(0x141)]()[_0x466a6f(0x16c)](_0x466a6f(0x164),[_0x207fd7]);const _0x57fa4c=jwt[_0x466a6f(0x166)]({'id':_0x1dc8ec[0x0]['id'],'email':_0x1dc8ec[0x0][_0x466a6f(0x16f)]},config['jwtSecretKey'],{'expiresIn':_0x466a6f(0x176)});_0x18ae5d[_0x466a6f(0x15a)](0xc8)[_0x466a6f(0x162)]({'success':!![],'message':_0x466a6f(0x167),'data':{'userId':_0x1dc8ec[0x0]['id'],'username':_0x1dc8ec[0x0][_0x466a6f(0x178)],'first_name':_0x1dc8ec[0x0][_0x466a6f(0x13c)],'last_name':_0x1dc8ec[0x0][_0x466a6f(0x158)],'email':_0x1dc8ec[0x0][_0x466a6f(0x16f)],'avatar_url':_0x1dc8ec[0x0][_0x466a6f(0x13f)],'id':_0x1dc8ec[0x0]['id'],'role':_0x1dc8ec[0x0][_0x466a6f(0x17e)],'token':_0x57fa4c,'is_enabled':0x1}});}catch(_0xd1c9f3){console[_0x466a6f(0x139)](_0x466a6f(0x137)),console[_0x466a6f(0x139)](_0xd1c9f3),_0x18ae5d[_0x466a6f(0x15a)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.','stack':_0xd1c9f3[_0x466a6f(0x145)],'message':_0xd1c9f3[_0x466a6f(0x170)]});}}),router[a1_0x412080(0x138)](a1_0x412080(0x147),verifyToken,async(_0x303532,_0x4c60d7,_0x3a3897)=>{const _0x42385f=a1_0x412080,{current_password:_0x4d50dd,new_password:_0x543de8}=_0x303532[_0x42385f(0x16a)];console['log']({'body':_0x303532['body']});const _0x289071=_0x303532['user']['email'];let _0x5647c9;try{const [_0x4cfda0]=await conn[_0x42385f(0x141)]()[_0x42385f(0x16c)](_0x42385f(0x181),[_0x289071]);if(_0x4cfda0[_0x42385f(0x148)]>0x0){_0x5647c9=_0x4cfda0[0x0];if(!await bcrypt[_0x42385f(0x174)](_0x4d50dd,_0x5647c9[_0x42385f(0x17c)])){_0x4c60d7[_0x42385f(0x15a)](0x191)['json']({'error':'Invalid\x20password'});return;}const _0x59313a=await bcrypt['hash'](_0x543de8,0xa);await conn[_0x42385f(0x141)]()[_0x42385f(0x16c)](_0x42385f(0x153),[_0x59313a,_0x289071]),_0x4c60d7[_0x42385f(0x15a)](0xc8)[_0x42385f(0x162)]({'success':!![]});}}catch(_0x3e7427){console[_0x42385f(0x139)]({'err':_0x3e7427}),_0x4c60d7[_0x42385f(0x15a)](0x1f4)[_0x42385f(0x162)]({'error':_0x42385f(0x17a)});return;}}),router[a1_0x412080(0x138)](a1_0x412080(0x12e),upload[a1_0x412080(0x142)](a1_0x412080(0x146)),verifyToken,async(_0x6563ed,_0xe4ebe,_0x3ac164)=>{const _0x5bcf27=a1_0x412080,{username:_0x4fd015,first_name:_0x505aad,last_name:_0x21a436}=_0x6563ed[_0x5bcf27(0x16a)],_0x57bc08=_0x6563ed[_0x5bcf27(0x144)][_0x5bcf27(0x16f)];let _0x258df7;try{const [_0x4ebc99]=await conn[_0x5bcf27(0x141)]()[_0x5bcf27(0x16c)](_0x5bcf27(0x181),[_0x57bc08]);_0x4ebc99[_0x5bcf27(0x148)]>0x0&&(_0x258df7=_0x4ebc99[0x0]);}catch(_0x467d5f){console['log']({'err':_0x467d5f}),_0xe4ebe['status'](0x1f4)['json']({'error':_0x5bcf27(0x17a)});return;}if(!_0x258df7){_0xe4ebe[_0x5bcf27(0x15a)](0x191)[_0x5bcf27(0x162)]({'error':'Invalid\x20user'});return;}console['log']({'req':_0x6563ed[_0x5bcf27(0x16a)]});let _0x1fd519=_0x258df7[_0x5bcf27(0x13f)];if(_0x6563ed['file']){const _0xd9c4c8=_0x5bcf27(0x135)+randomUUID()+_0x5bcf27(0x15e);fs[_0x5bcf27(0x16d)](_0x6563ed['file'][_0x5bcf27(0x17f)],'./'+_0xd9c4c8),fs[_0x5bcf27(0x187)](_0x6563ed[_0x5bcf27(0x168)][_0x5bcf27(0x17f)]),config[_0x5bcf27(0x16b)]?_0x1fd519=config[_0x5bcf27(0x18a)]+'/'+_0xd9c4c8:_0x1fd519=config['ServerUrl']+'/'+_0xd9c4c8;}try{await conn[_0x5bcf27(0x141)]()[_0x5bcf27(0x16c)](_0x5bcf27(0x13e),[_0x4fd015,_0x505aad,_0x21a436,_0x1fd519,_0x57bc08]);let _0x94ef29;try{_0x94ef29=jwt[_0x5bcf27(0x166)]({'userId':_0x258df7['id'],'email':_0x258df7[_0x5bcf27(0x16f)]},config['jwtSecretKey'],{'expiresIn':_0x5bcf27(0x176)});}catch(_0x157026){console[_0x5bcf27(0x139)](_0x157026),_0xe4ebe['status'](0x1f4)[_0x5bcf27(0x162)]({'error':_0x5bcf27(0x17a)});return;}_0xe4ebe[_0x5bcf27(0x15a)](0xc8)[_0x5bcf27(0x162)]({'success':!![],'data':{'userId':_0x258df7['id'],'username':_0x4fd015,'first_name':_0x505aad,'last_name':_0x21a436,'email':_0x258df7['email'],'avatar_url':_0x1fd519,'token':_0x94ef29}});}catch(_0x2be613){console['log']({'err':_0x2be613}),_0xe4ebe['status'](0x1f4)[_0x5bcf27(0x162)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module[a1_0x412080(0x184)]=router;