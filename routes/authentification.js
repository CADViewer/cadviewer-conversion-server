const a1_0x1fa46f=a1_0x4055;function a1_0x1a3e(){const _0x241aa7=['Welcome\x20to\x20CADViewer','../libs/mysql.js','<p>Welcome\x20to\x20CADViewer</p>','status','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','./avatars','username','hash','compare','jwtSecretKey','crypted_password','path','smtpFrom','sign','1559468Lonwkr','Invalid\x20validation\x20token','avatars/','Invalid\x20email\x20or\x20password','avatar','mkdirSync','first_name','single','exports','878660Ixstnk','user','9277416qmutVL','post','role','Email\x20validated\x20successfully','1311630WgKKlI','copyFileSync','/login','body','execute','length','Please\x20check\x20your\x20email\x20to\x20validate\x20your\x20account','186006hApaMf','\x0a\x20\x20\x20\x20\x20\x20<!DOCTYPE\x20html>\x0a\x20\x20\x20\x20\x20\x20<html>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20font-family:\x20Arial,\x20sans-serif;\x20line-height:\x201.6;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20600px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20padding:\x2020px;\x20background:\x20#ea580c;\x20color:\x20white;\x20border-radius:\x205px\x205px\x200\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.content\x20{\x20padding:\x2020px;\x20background:\x20#f9f9f9;\x20border:\x201px\x20solid\x20#ddd;\x20border-radius:\x200\x200\x205px\x205px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-block;\x20padding:\x2012px\x2024px;\x20background:\x20#ea580c;\x20color:\x20white\x20!important;\x20text-decoration:\x20none;\x20border-radius:\x205px;\x20margin:\x2020px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background:\x20#f97316;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2020px;\x20color:\x20#666;\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1>Welcome\x20to\x20CADViewer!</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>We\x20are\x20delighted\x20to\x20welcome\x20you\x20to\x20our\x20community.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>To\x20start\x20using\x20CADViewer\x20Visual\x20Query,\x20please\x20validate\x20your\x20email\x20address\x20by\x20clicking\x20the\x20button\x20below:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22text-align:\x20center;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22','../CADViewer_config.json','ServerUrl','unlinkSync','/signup','email','./uploads/','express','promise','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','Invalid\x20user','last_name','../libs/jwt','existsSync','User\x20already\x20exists','multer','44avVaqR','7517720ngWhAX','is_enabled','avatars','insertId','sendMail','===================error===================','/update-password','jsonwebtoken','verifyToken','frontendUrl','json','file','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','message','5928702asCqtt','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>This\x20email\x20was\x20sent\x20automatically,\x20please\x20do\x20not\x20reply.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','/validate-email/:token','\x22\x20class=\x22button\x22>Validate\x20my\x20email\x20address</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>If\x20the\x20button\x20doesn\x27t\x20work,\x20you\x20can\x20copy\x20and\x20paste\x20this\x20link\x20in\x20your\x20browser:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22word-break:\x20break-all;\x22>','avatar_url','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','24h','../libs/mail','Error!\x20Something\x20went\x20wrong.','bcrypt','log','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?'];a1_0x1a3e=function(){return _0x241aa7;};return a1_0x1a3e();}(function(_0x3c24dd,_0x385ac8){const _0x38bc1f=a1_0x4055,_0x197d0d=_0x3c24dd();while(!![]){try{const _0x110662=parseInt(_0x38bc1f(0x111))/0x1+-parseInt(_0x38bc1f(0x108))/0x2+-parseInt(_0x38bc1f(0x11e))/0x3*(parseInt(_0x38bc1f(0x12f))/0x4)+parseInt(_0x38bc1f(0x117))/0x5+-parseInt(_0x38bc1f(0x13e))/0x6+parseInt(_0x38bc1f(0x130))/0x7+parseInt(_0x38bc1f(0x113))/0x8;if(_0x110662===_0x385ac8)break;else _0x197d0d['push'](_0x197d0d['shift']());}catch(_0x4c2e70){_0x197d0d['push'](_0x197d0d['shift']());}}}(a1_0x1a3e,0xe1c4e));const jwt=require(a1_0x1fa46f(0x137)),bcrypt=require(a1_0x1fa46f(0xf7)),config=require(a1_0x1fa46f(0x120)),conn=require(a1_0x1fa46f(0xfb)),multer=require(a1_0x1fa46f(0x12e)),fs=require('fs'),verifyToken=require(a1_0x1fa46f(0x12b))[a1_0x1fa46f(0x138)];function a1_0x4055(_0x24fa98,_0x3c932c){const _0x1a3e61=a1_0x1a3e();return a1_0x4055=function(_0x4055dc,_0x24b61b){_0x4055dc=_0x4055dc-0xf1;let _0x3a95a8=_0x1a3e61[_0x4055dc];return _0x3a95a8;},a1_0x4055(_0x24fa98,_0x3c932c);}!fs[a1_0x1fa46f(0x12c)]('./avatars')&&fs[a1_0x1fa46f(0x10d)](a1_0x1fa46f(0xff));const express=require(a1_0x1fa46f(0x126)),router=express['Router'](),{randomUUID}=require('crypto'),storage=multer['diskStorage']({'destination':function(_0x28708a,_0x2857e6,_0x5a2275){const _0x1499d4=a1_0x1fa46f;_0x5a2275(null,_0x1499d4(0x132));}}),upload=multer({'storage':storage});router['post'](a1_0x1fa46f(0x119),async(_0x22ed85,_0x5489f,_0x328341)=>{const _0x4a47bd=a1_0x1fa46f;let {email:_0x15f6de,password:_0x29ce02}=_0x22ed85[_0x4a47bd(0x11a)];console[_0x4a47bd(0xf8)]({'email':_0x15f6de,'password':_0x29ce02});let _0x24584d;try{const [_0x1f88f2]=await conn[_0x4a47bd(0x127)]()[_0x4a47bd(0x11b)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?',[_0x15f6de]);_0x1f88f2['length']>0x0&&(_0x24584d=_0x1f88f2[0x0]);}catch(_0x5c63da){console[_0x4a47bd(0xf8)]({'err':_0x5c63da}),_0x5489f[_0x4a47bd(0xfd)](0x1f4)['json']({'error':_0x4a47bd(0xf6)});return;}if(!_0x24584d||!await bcrypt[_0x4a47bd(0x102)](_0x29ce02,_0x24584d?.[_0x4a47bd(0x104)])){_0x5489f[_0x4a47bd(0xfd)](0x191)['json']({'error':_0x4a47bd(0x10b)});return;}let _0x1d3248;try{_0x1d3248=jwt[_0x4a47bd(0x107)]({'userId':_0x24584d['id'],'email':_0x24584d[_0x4a47bd(0x124)]},config[_0x4a47bd(0x103)],{'expiresIn':_0x4a47bd(0xf4)});}catch(_0xdc67c7){console[_0x4a47bd(0xf8)](_0xdc67c7),_0x5489f[_0x4a47bd(0xfd)](0x1f4)[_0x4a47bd(0x13a)]({'error':_0x4a47bd(0xf6)});return;}_0x5489f[_0x4a47bd(0xfd)](0xc8)[_0x4a47bd(0x13a)]({'success':!![],'data':{'userId':_0x24584d['id'],'username':_0x24584d['username'],'first_name':_0x24584d[_0x4a47bd(0x10e)],'last_name':_0x24584d[_0x4a47bd(0x12a)],'email':_0x24584d[_0x4a47bd(0x124)],'avatar_url':_0x24584d[_0x4a47bd(0xf2)],'id':_0x24584d['id'],'role':_0x24584d[_0x4a47bd(0x115)],'token':_0x1d3248}});}),router[a1_0x1fa46f(0x114)](a1_0x1fa46f(0x123),async(_0x2e1d6b,_0x27f7f6,_0x4cf815)=>{const _0x2f8815=a1_0x1fa46f,{username:_0x3ef0b5,email:_0x2ce6c4,password:_0x41df2c}=_0x2e1d6b[_0x2f8815(0x11a)],[_0x2c9737]=await conn[_0x2f8815(0x127)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x2ce6c4]);if(_0x2c9737[_0x2f8815(0x11c)]>0x0){_0x27f7f6[_0x2f8815(0xfd)](0x1a6)[_0x2f8815(0x13a)]({'error':_0x2f8815(0x12d)});return;}const _0x39da4f=await bcrypt[_0x2f8815(0x101)](_0x41df2c,0xa);let _0x261a60=null,_0x25b854=0x1;config['enableEmailVerification']&&(_0x261a60=randomUUID(),_0x25b854=0x0);let _0x42704f;try{const _0x13575d=randomUUID(),_0x574b14=_0x2f8815(0x125)+_0x13575d;fs[_0x2f8815(0x10d)](_0x574b14);const [_0x371356]=await conn[_0x2f8815(0x127)]()[_0x2f8815(0x11b)]('INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?)',[_0x3ef0b5,_0x2ce6c4,_0x39da4f,'demo_user',_0x25b854,_0x261a60,_0x13575d]);if(_0x371356['insertId']){const [_0x7fa22a]=await conn[_0x2f8815(0x127)]()[_0x2f8815(0x11b)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0x371356[_0x2f8815(0x133)]]);_0x7fa22a['length']>0x0&&(_0x42704f=_0x7fa22a[0x0]);}}catch{_0x27f7f6[_0x2f8815(0xfd)](0x1f4)['json']({'error':_0x2f8815(0xf6)});return;}let _0x3f98c8;try{_0x3f98c8=jwt[_0x2f8815(0x107)]({'userId':_0x42704f['id'],'email':_0x42704f['email']},config[_0x2f8815(0x103)],{'expiresIn':_0x2f8815(0xf4)});}catch(_0x244403){_0x27f7f6[_0x2f8815(0xfd)](0x1f4)[_0x2f8815(0x13a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}const _0x3b5ced=require(_0x2f8815(0xf5))['transporter'];let _0xdf5773=_0x2f8815(0xfc);if(config['enableEmailVerification']){const _0x42f454=config[_0x2f8815(0x139)]+'/validate-email/'+_0x261a60;_0xdf5773=_0x2f8815(0x11f)+_0x42f454+_0x2f8815(0xf1)+_0x42f454+_0x2f8815(0x13f);const _0x4623ce={'from':config[_0x2f8815(0x106)],'to':_0x42704f['email'],'subject':_0x2f8815(0xfa),'text':'Welcome\x20to\x20CADViewer','html':_0xdf5773};try{await _0x3b5ced[_0x2f8815(0x134)](_0x4623ce);}catch(_0x1b441a){console[_0x2f8815(0xf8)](_0x2f8815(0x135)),console[_0x2f8815(0xf8)](_0x1b441a),_0x27f7f6['status'](0x1f4)[_0x2f8815(0x13a)]({'error':'Error!\x20Something\x20went\x20wrong\x20while\x20sending\x20the\x20email','stack':_0x1b441a['stack'],'message':_0x1b441a[_0x2f8815(0x13d)]});return;}_0x27f7f6[_0x2f8815(0xfd)](0xc8)[_0x2f8815(0x13a)]({'success':!![],'message':_0x2f8815(0x11d)});return;}_0x27f7f6[_0x2f8815(0xfd)](0xc9)['json']({'success':!![],'data':{'userId':_0x42704f['id'],'username':_0x42704f[_0x2f8815(0x100)],'first_name':_0x42704f[_0x2f8815(0x10e)],'last_name':_0x42704f[_0x2f8815(0x12a)],'email':_0x42704f[_0x2f8815(0x124)],'avatar_url':_0x42704f[_0x2f8815(0xf2)],'id':_0x42704f['id'],'role':_0x42704f[_0x2f8815(0x115)],'token':_0x3f98c8,'is_enabled':_0x42704f[_0x2f8815(0x131)]}});}),router[a1_0x1fa46f(0x114)](a1_0x1fa46f(0x140),async(_0xf97437,_0x41273b)=>{const _0x1d0808=a1_0x1fa46f;try{const {token:_0x3d3ae7}=_0xf97437['params'],[_0x530c27]=await conn[_0x1d0808(0x127)]()[_0x1d0808(0x11b)](_0x1d0808(0xf9),[_0x3d3ae7]);if(_0x530c27['length']===0x0){_0x41273b[_0x1d0808(0xfd)](0x194)[_0x1d0808(0x13a)]({'error':_0x1d0808(0x109)});return;}await conn['promise']()[_0x1d0808(0x11b)](_0x1d0808(0x128),[_0x3d3ae7]);const _0x52ee57=jwt[_0x1d0808(0x107)]({'id':_0x530c27[0x0]['id'],'email':_0x530c27[0x0][_0x1d0808(0x124)]},config[_0x1d0808(0x103)],{'expiresIn':_0x1d0808(0xf4)});_0x41273b['status'](0xc8)[_0x1d0808(0x13a)]({'success':!![],'message':_0x1d0808(0x116),'data':{'userId':_0x530c27[0x0]['id'],'username':_0x530c27[0x0][_0x1d0808(0x100)],'first_name':_0x530c27[0x0][_0x1d0808(0x10e)],'last_name':_0x530c27[0x0][_0x1d0808(0x12a)],'email':_0x530c27[0x0][_0x1d0808(0x124)],'avatar_url':_0x530c27[0x0]['avatar_url'],'id':_0x530c27[0x0]['id'],'role':_0x530c27[0x0][_0x1d0808(0x115)],'token':_0x52ee57,'is_enabled':0x1}});}catch(_0x31739b){console[_0x1d0808(0xf8)]('===================error==================='),console[_0x1d0808(0xf8)](_0x31739b),_0x41273b[_0x1d0808(0xfd)](0x1f4)[_0x1d0808(0x13a)]({'error':_0x1d0808(0xf6),'stack':_0x31739b['stack'],'message':_0x31739b[_0x1d0808(0x13d)]});}}),router[a1_0x1fa46f(0x114)](a1_0x1fa46f(0x136),verifyToken,async(_0x279124,_0x13625e,_0x5a01f3)=>{const _0x3f6ff9=a1_0x1fa46f,{current_password:_0x56870e,new_password:_0x5353dd}=_0x279124[_0x3f6ff9(0x11a)];console['log']({'body':_0x279124[_0x3f6ff9(0x11a)]});const _0x4dcfbb=_0x279124[_0x3f6ff9(0x112)]['email'];let _0x1483fd;try{const [_0xf81175]=await conn[_0x3f6ff9(0x127)]()[_0x3f6ff9(0x11b)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x4dcfbb]);if(_0xf81175[_0x3f6ff9(0x11c)]>0x0){_0x1483fd=_0xf81175[0x0];if(!await bcrypt[_0x3f6ff9(0x102)](_0x56870e,_0x1483fd[_0x3f6ff9(0x104)])){_0x13625e[_0x3f6ff9(0xfd)](0x191)[_0x3f6ff9(0x13a)]({'error':'Invalid\x20password'});return;}const _0x3aad23=await bcrypt[_0x3f6ff9(0x101)](_0x5353dd,0xa);await conn['promise']()[_0x3f6ff9(0x11b)](_0x3f6ff9(0xf3),[_0x3aad23,_0x4dcfbb]),_0x13625e[_0x3f6ff9(0xfd)](0xc8)[_0x3f6ff9(0x13a)]({'success':!![]});}}catch(_0xf0764f){console[_0x3f6ff9(0xf8)]({'err':_0xf0764f}),_0x13625e[_0x3f6ff9(0xfd)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router[a1_0x1fa46f(0x114)]('/update-user-info',upload[a1_0x1fa46f(0x10f)](a1_0x1fa46f(0x10c)),verifyToken,async(_0x5175e3,_0x4eb6f5,_0x344957)=>{const _0x17f941=a1_0x1fa46f,{username:_0x346e56,first_name:_0x36761a,last_name:_0x22f3ea}=_0x5175e3[_0x17f941(0x11a)],_0x143d7a=_0x5175e3[_0x17f941(0x112)]['email'];let _0x40b506;try{const [_0x13d9b7]=await conn[_0x17f941(0x127)]()[_0x17f941(0x11b)](_0x17f941(0x13c),[_0x143d7a]);_0x13d9b7[_0x17f941(0x11c)]>0x0&&(_0x40b506=_0x13d9b7[0x0]);}catch(_0x117c3f){console['log']({'err':_0x117c3f}),_0x4eb6f5[_0x17f941(0xfd)](0x1f4)[_0x17f941(0x13a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x40b506){_0x4eb6f5['status'](0x191)[_0x17f941(0x13a)]({'error':_0x17f941(0x129)});return;}console[_0x17f941(0xf8)]({'req':_0x5175e3[_0x17f941(0x11a)]});let _0x5cfbe3=_0x40b506['avatar_url'];if(_0x5175e3[_0x17f941(0x13b)]){const _0x430f85=_0x17f941(0x10a)+randomUUID()+'.png';fs[_0x17f941(0x118)](_0x5175e3[_0x17f941(0x13b)][_0x17f941(0x105)],'./'+_0x430f85),fs[_0x17f941(0x122)](_0x5175e3[_0x17f941(0x13b)]['path']),_0x5cfbe3=config[_0x17f941(0x121)]+'/'+_0x430f85;}try{await conn[_0x17f941(0x127)]()['execute'](_0x17f941(0xfe),[_0x346e56,_0x36761a,_0x22f3ea,_0x5cfbe3,_0x143d7a]);let _0xd428fa;try{_0xd428fa=jwt[_0x17f941(0x107)]({'userId':_0x40b506['id'],'email':_0x40b506['email']},config['jwtSecretKey'],{'expiresIn':'24h'});}catch(_0x280566){console[_0x17f941(0xf8)](_0x280566),_0x4eb6f5[_0x17f941(0xfd)](0x1f4)[_0x17f941(0x13a)]({'error':_0x17f941(0xf6)});return;}_0x4eb6f5['status'](0xc8)[_0x17f941(0x13a)]({'success':!![],'data':{'userId':_0x40b506['id'],'username':_0x346e56,'first_name':_0x36761a,'last_name':_0x22f3ea,'email':_0x40b506[_0x17f941(0x124)],'avatar_url':_0x5cfbe3,'token':_0xd428fa}});}catch(_0x383f7b){console['log']({'err':_0x383f7b}),_0x4eb6f5[_0x17f941(0xfd)](0x1f4)[_0x17f941(0x13a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),module[a1_0x1fa46f(0x110)]=router;