function a1_0x2cb6(){const _0x59551c=['/validate-email/:token','post','promise','is_enabled','diskStorage','jsonwebtoken','18FWbPRm','crypted_password','exports','Email\x20validated\x20successfully','Invalid\x20email\x20or\x20password','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`validation_token`\x20=\x20?','recaptchaEnabled','../libs/mysql.js','===================error===================','languages','file','Please\x20check\x20your\x20email\x20account\x20to\x20validate\x20your\x20account.\x20If\x20you\x20don\x27t\x20see\x20the\x20email,\x20please\x20check\x20your\x20spam\x20folder.','./avatars','User\x20already\x20exists','country_name','success','../CADViewer_config.json','./uploads/','data','3tFYvre','multer','5624164AqdhZP','error-codes','express','Invalid\x20validation\x20token','12xdNsqh','verifyToken','1744936MYdrve','error','UPDATE\x20`users`\x20SET\x20`is_enabled`\x20=\x201,\x20`validation_token`\x20=\x20NULL,\x20`updated_at`\x20=\x20NOW()\x20WHERE\x20`validation_token`\x20=\x20?','message','../libs/jwt','Router','18849WRSfNC','7DpbDfQ','/update-password','ServerUrl','path','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','/update-user-info','recaptchaSecretKey','length','Error!\x20Something\x20went\x20wrong.','last_name','user','/signup','callbackMethod_gatewayUrl_flag','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`,\x20`validation_token`,\x20`created_at`,\x20`updated_at`,\x20`folder_name`,\x20`city`,\x20`region`,\x20`country`,\x20`language_code`,\x20`language_name`,\x20`timezone`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20NOW(),\x20NOW(),\x20?,\x20?,\x20?,\x20?,\x20?,\x20?,\x20?)','2654740IwMhuz','reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','existsSync','region','time_zone','log','2vTGZgC','sign','9zYGpuG','city','code','24h','2247650AYxThX','avatar','bcrypt','mkdirSync','body','../libs/email-utils','status','1802984uhnQnA','Error\x20during\x20reCAPTCHA\x20verification.','stack','avatar_url','jwtSecretKey','username','crypto','Invalid\x20user','enableEmailVerification','.png','first_name','role','json','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','callbackMethod_gatewayUrl','execute','copyFileSync','demo_user','insertId','reCAPTCHA\x20verification\x20error:','hash','email','compare','name','692845NesEBe'];a1_0x2cb6=function(){return _0x59551c;};return a1_0x2cb6();}const a1_0x225562=a1_0xcddb;(function(_0x21b1b0,_0x8a0ba6){const _0x19d356=a1_0xcddb,_0xcf54eb=_0x21b1b0();while(!![]){try{const _0x37a359=-parseInt(_0x19d356(0xa4))/0x1*(-parseInt(_0x19d356(0xba))/0x2)+parseInt(_0x19d356(0x96))/0x3*(-parseInt(_0x19d356(0xc7))/0x4)+-parseInt(_0x19d356(0x7c))/0x5*(parseInt(_0x19d356(0x83))/0x6)+-parseInt(_0x19d356(0xa5))/0x7*(-parseInt(_0x19d356(0x9e))/0x8)+parseInt(_0x19d356(0xbc))/0x9*(parseInt(_0x19d356(0xc0))/0xa)+parseInt(_0x19d356(0xb4))/0xb*(parseInt(_0x19d356(0x9c))/0xc)+parseInt(_0x19d356(0x98))/0xd;if(_0x37a359===_0x8a0ba6)break;else _0xcf54eb['push'](_0xcf54eb['shift']());}catch(_0x4964d1){_0xcf54eb['push'](_0xcf54eb['shift']());}}}(a1_0x2cb6,0x41bbe));const jwt=require(a1_0x225562(0x82)),bcrypt=require(a1_0x225562(0xc2)),config=require(a1_0x225562(0x93)),conn=require(a1_0x225562(0x8a)),multer=require(a1_0x225562(0x97)),fs=require('fs'),verifyToken=require(a1_0x225562(0xa2))[a1_0x225562(0x9d)],{sendWelcomeEmail}=require(a1_0x225562(0xc5)),axios=require('axios');!fs[a1_0x225562(0xb6)](a1_0x225562(0x8f))&&fs['mkdirSync']('./avatars');const express=require(a1_0x225562(0x9a)),router=express[a1_0x225562(0xa3)](),{randomUUID}=require(a1_0x225562(0xcd)),storage=multer[a1_0x225562(0x81)]({'destination':function(_0x2586e7,_0x4e566e,_0x37ff70){_0x37ff70(null,'avatars');}}),upload=multer({'storage':storage});function a1_0xcddb(_0x1cb071,_0x3d8377){const _0x2cb6d8=a1_0x2cb6();return a1_0xcddb=function(_0xcddb65,_0x3573d5){_0xcddb65=_0xcddb65-0x6b;let _0x3304e3=_0x2cb6d8[_0xcddb65];return _0x3304e3;},a1_0xcddb(_0x1cb071,_0x3d8377);}router['post']('/login',async(_0x494f1e,_0x53face,_0x16d9dd)=>{const _0x3cb26e=a1_0x225562;let {email:_0x548b9c,password:_0x365f96}=_0x494f1e['body'];console[_0x3cb26e(0xb9)]({'email':_0x548b9c,'password':_0x365f96});let _0x120277;try{const [_0x89d50e]=await conn[_0x3cb26e(0x7f)]()[_0x3cb26e(0x73)](_0x3cb26e(0x71),[_0x548b9c]);_0x89d50e[_0x3cb26e(0xad)]>0x0&&(_0x120277=_0x89d50e[0x0]);}catch(_0x242a03){console[_0x3cb26e(0xb9)]({'err':_0x242a03}),_0x53face[_0x3cb26e(0xc6)](0x1f4)[_0x3cb26e(0x70)]({'error':_0x3cb26e(0xae)});return;}if(!_0x120277||!await bcrypt[_0x3cb26e(0x7a)](_0x365f96,_0x120277?.[_0x3cb26e(0x84)])){_0x53face[_0x3cb26e(0xc6)](0x191)[_0x3cb26e(0x70)]({'error':_0x3cb26e(0x87)});return;}let _0x3fb4cc;try{_0x3fb4cc=jwt[_0x3cb26e(0xbb)]({'userId':_0x120277['id'],'email':_0x120277['email']},config[_0x3cb26e(0xcb)],{'expiresIn':_0x3cb26e(0xbf)});}catch(_0x4d0dff){console[_0x3cb26e(0xb9)](_0x4d0dff),_0x53face[_0x3cb26e(0xc6)](0x1f4)[_0x3cb26e(0x70)]({'error':_0x3cb26e(0xae)});return;}_0x53face[_0x3cb26e(0xc6)](0xc8)[_0x3cb26e(0x70)]({'success':!![],'data':{'userId':_0x120277['id'],'username':_0x120277['username'],'first_name':_0x120277[_0x3cb26e(0x6e)],'last_name':_0x120277[_0x3cb26e(0xaf)],'email':_0x120277[_0x3cb26e(0x79)],'avatar_url':_0x120277[_0x3cb26e(0xca)],'id':_0x120277['id'],'role':_0x120277[_0x3cb26e(0x6f)],'token':_0x3fb4cc}});}),router[a1_0x225562(0x7e)](a1_0x225562(0xb1),async(_0x3390b1,_0x233d29,_0x2122b8)=>{const _0x59ab95=a1_0x225562,{username:_0x215dd0,email:_0x29f688,password:_0x494d7f,geolocation:_0x452d3f,recaptchaToken:_0x4462ac}=_0x3390b1[_0x59ab95(0xc4)];if(config[_0x59ab95(0x89)]){if(!_0x4462ac)return _0x233d29[_0x59ab95(0xc6)](0x190)[_0x59ab95(0x70)]({'error':_0x59ab95(0xb5)});try{const _0x5a1dd0=await axios[_0x59ab95(0x7e)]('https://www.google.com/recaptcha/api/siteverify',null,{'params':{'secret':config[_0x59ab95(0xac)],'response':_0x4462ac}});if(!_0x5a1dd0[_0x59ab95(0x95)][_0x59ab95(0x92)])return _0x233d29[_0x59ab95(0xc6)](0x190)['json']({'error':'reCAPTCHA\x20verification\x20failed.\x20Please\x20try\x20again.','recaptchaErrors':_0x5a1dd0[_0x59ab95(0x95)][_0x59ab95(0x99)]});}catch(_0x4070b8){return console[_0x59ab95(0x9f)](_0x59ab95(0x77),_0x4070b8),_0x233d29[_0x59ab95(0xc6)](0x1f4)[_0x59ab95(0x70)]({'error':_0x59ab95(0xc8)});}}const [_0x3500d9]=await conn[_0x59ab95(0x7f)]()[_0x59ab95(0x73)](_0x59ab95(0xa9),[_0x29f688]);if(_0x3500d9[_0x59ab95(0xad)]>0x0){_0x233d29[_0x59ab95(0xc6)](0x1a6)[_0x59ab95(0x70)]({'error':_0x59ab95(0x90)});return;}const _0x36ca7c=await bcrypt[_0x59ab95(0x78)](_0x494d7f,0xa);let _0x31c613=null,_0x587796=0x1;config[_0x59ab95(0x6c)]&&(_0x31c613=randomUUID(),_0x587796=0x0);let _0x298fb5=null,_0x2ceb5e=null,_0x65d304=null,_0x445206=null,_0xf1cca6=null,_0x14c9cc=null;if(_0x452d3f)try{const _0x31f4bd=_0x452d3f;_0x298fb5=_0x31f4bd[_0x59ab95(0xbd)]||null,_0x2ceb5e=_0x31f4bd[_0x59ab95(0xb7)]||null,_0x65d304=_0x31f4bd[_0x59ab95(0x91)]||null,_0x31f4bd[_0x59ab95(0x8c)]&&_0x31f4bd['languages'][_0x59ab95(0xad)]>0x0&&(_0x445206=_0x31f4bd[_0x59ab95(0x8c)][0x0][_0x59ab95(0xbe)]||null,_0xf1cca6=_0x31f4bd['languages'][0x0][_0x59ab95(0x7b)]||null),_0x31f4bd['time_zone']&&(_0x14c9cc=_0x31f4bd[_0x59ab95(0xb8)][_0x59ab95(0x7b)]||null);}catch(_0x302388){console[_0x59ab95(0xb9)]('Error\x20parsing\x20geolocation\x20data:',_0x302388);}let _0x34ccc9;try{const _0x36ff6e=randomUUID(),_0x501419=_0x59ab95(0x94)+_0x36ff6e;fs[_0x59ab95(0xc3)](_0x501419);const [_0x2a51bd]=await conn['promise']()['execute'](_0x59ab95(0xb3),[_0x215dd0,_0x29f688,_0x36ca7c,_0x59ab95(0x75),_0x587796,_0x31c613,_0x36ff6e,_0x298fb5,_0x2ceb5e,_0x65d304,_0x445206,_0xf1cca6,_0x14c9cc]);if(_0x2a51bd[_0x59ab95(0x76)]){const [_0x498292]=await conn['promise']()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?',[_0x2a51bd[_0x59ab95(0x76)]]);_0x498292['length']>0x0&&(_0x34ccc9=_0x498292[0x0]);}}catch(_0x4cb52e){console[_0x59ab95(0xb9)]('Error\x20during\x20user\x20creation:',_0x4cb52e),_0x233d29[_0x59ab95(0xc6)](0x1f4)[_0x59ab95(0x70)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x225fe5;try{_0x225fe5=jwt[_0x59ab95(0xbb)]({'userId':_0x34ccc9['id'],'email':_0x34ccc9[_0x59ab95(0x79)]},config[_0x59ab95(0xcb)],{'expiresIn':_0x59ab95(0xbf)});}catch(_0x588620){_0x233d29[_0x59ab95(0xc6)](0x1f4)['json']({'error':_0x59ab95(0xae)});return;}if(config[_0x59ab95(0x6c)]){try{await sendWelcomeEmail(_0x34ccc9,_0x31c613);}catch(_0x52aec9){console[_0x59ab95(0xb9)](_0x59ab95(0x8b)),console[_0x59ab95(0xb9)](_0x52aec9);}_0x233d29['status'](0xc8)[_0x59ab95(0x70)]({'success':!![],'message':_0x59ab95(0x8e)});return;}_0x233d29[_0x59ab95(0xc6)](0xc9)[_0x59ab95(0x70)]({'success':!![],'data':{'userId':_0x34ccc9['id'],'username':_0x34ccc9[_0x59ab95(0xcc)],'first_name':_0x34ccc9['first_name'],'last_name':_0x34ccc9[_0x59ab95(0xaf)],'email':_0x34ccc9['email'],'avatar_url':_0x34ccc9[_0x59ab95(0xca)],'id':_0x34ccc9['id'],'role':_0x34ccc9[_0x59ab95(0x6f)],'token':_0x225fe5,'is_enabled':_0x34ccc9[_0x59ab95(0x80)]}});}),router['post'](a1_0x225562(0x7d),async(_0xf8ae5,_0x1c7fe4)=>{const _0x32a333=a1_0x225562;try{const {token:_0x48abbb}=_0xf8ae5['params'],[_0x42f711]=await conn['promise']()['execute'](_0x32a333(0x88),[_0x48abbb]);if(_0x42f711['length']===0x0){_0x1c7fe4[_0x32a333(0xc6)](0x194)[_0x32a333(0x70)]({'error':_0x32a333(0x9b)});return;}await conn[_0x32a333(0x7f)]()[_0x32a333(0x73)](_0x32a333(0xa0),[_0x48abbb]);const _0x2209ea=jwt[_0x32a333(0xbb)]({'id':_0x42f711[0x0]['id'],'email':_0x42f711[0x0][_0x32a333(0x79)]},config[_0x32a333(0xcb)],{'expiresIn':_0x32a333(0xbf)});_0x1c7fe4[_0x32a333(0xc6)](0xc8)[_0x32a333(0x70)]({'success':!![],'message':_0x32a333(0x86),'data':{'userId':_0x42f711[0x0]['id'],'username':_0x42f711[0x0][_0x32a333(0xcc)],'first_name':_0x42f711[0x0]['first_name'],'last_name':_0x42f711[0x0]['last_name'],'email':_0x42f711[0x0][_0x32a333(0x79)],'avatar_url':_0x42f711[0x0][_0x32a333(0xca)],'id':_0x42f711[0x0]['id'],'role':_0x42f711[0x0]['role'],'token':_0x2209ea,'is_enabled':0x1}});}catch(_0x492489){console[_0x32a333(0xb9)](_0x32a333(0x8b)),console[_0x32a333(0xb9)](_0x492489),_0x1c7fe4[_0x32a333(0xc6)](0x1f4)[_0x32a333(0x70)]({'error':_0x32a333(0xae),'stack':_0x492489[_0x32a333(0xc9)],'message':_0x492489[_0x32a333(0xa1)]});}}),router[a1_0x225562(0x7e)](a1_0x225562(0xa6),verifyToken,async(_0x58cecb,_0x58ed76,_0x1e9272)=>{const _0x54b6ec=a1_0x225562,{current_password:_0x29e4b0,new_password:_0x2ea950}=_0x58cecb[_0x54b6ec(0xc4)];console[_0x54b6ec(0xb9)]({'body':_0x58cecb['body']});const _0x5e3674=_0x58cecb['user'][_0x54b6ec(0x79)];let _0x30633b;try{const [_0x1a2ca0]=await conn[_0x54b6ec(0x7f)]()[_0x54b6ec(0x73)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x5e3674]);if(_0x1a2ca0[_0x54b6ec(0xad)]>0x0){_0x30633b=_0x1a2ca0[0x0];if(!await bcrypt[_0x54b6ec(0x7a)](_0x29e4b0,_0x30633b[_0x54b6ec(0x84)])){_0x58ed76[_0x54b6ec(0xc6)](0x191)[_0x54b6ec(0x70)]({'error':'Invalid\x20password'});return;}const _0x508530=await bcrypt[_0x54b6ec(0x78)](_0x2ea950,0xa);await conn[_0x54b6ec(0x7f)]()[_0x54b6ec(0x73)]('UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x508530,_0x5e3674]),_0x58ed76['status'](0xc8)['json']({'success':!![]});}}catch(_0x51a2d7){console[_0x54b6ec(0xb9)]({'err':_0x51a2d7}),_0x58ed76[_0x54b6ec(0xc6)](0x1f4)['json']({'error':_0x54b6ec(0xae)});return;}}),router[a1_0x225562(0x7e)](a1_0x225562(0xab),upload['single'](a1_0x225562(0xc1)),verifyToken,async(_0x524768,_0x26e310,_0x51f705)=>{const _0x3c3731=a1_0x225562,{username:_0x1b2d0a,first_name:_0x153e64,last_name:_0x3b7b24}=_0x524768['body'],_0x16dc09=_0x524768[_0x3c3731(0xb0)][_0x3c3731(0x79)];let _0xc10d76;try{const [_0x1185df]=await conn[_0x3c3731(0x7f)]()[_0x3c3731(0x73)](_0x3c3731(0xa9),[_0x16dc09]);_0x1185df[_0x3c3731(0xad)]>0x0&&(_0xc10d76=_0x1185df[0x0]);}catch(_0x44c863){console[_0x3c3731(0xb9)]({'err':_0x44c863}),_0x26e310[_0x3c3731(0xc6)](0x1f4)[_0x3c3731(0x70)]({'error':_0x3c3731(0xae)});return;}if(!_0xc10d76){_0x26e310[_0x3c3731(0xc6)](0x191)[_0x3c3731(0x70)]({'error':_0x3c3731(0x6b)});return;}console[_0x3c3731(0xb9)]({'req':_0x524768[_0x3c3731(0xc4)]});let _0x524285=_0xc10d76[_0x3c3731(0xca)];if(_0x524768[_0x3c3731(0x8d)]){const _0x1e05d3='avatars/'+randomUUID()+_0x3c3731(0x6d);fs[_0x3c3731(0x74)](_0x524768[_0x3c3731(0x8d)][_0x3c3731(0xa8)],'./'+_0x1e05d3),fs['unlinkSync'](_0x524768[_0x3c3731(0x8d)][_0x3c3731(0xa8)]),config[_0x3c3731(0xb2)]?_0x524285=config[_0x3c3731(0x72)]+'/'+_0x1e05d3:_0x524285=config[_0x3c3731(0xa7)]+'/'+_0x1e05d3;}try{await conn[_0x3c3731(0x7f)]()[_0x3c3731(0x73)](_0x3c3731(0xaa),[_0x1b2d0a,_0x153e64,_0x3b7b24,_0x524285,_0x16dc09]);let _0x3df1ee;try{_0x3df1ee=jwt[_0x3c3731(0xbb)]({'userId':_0xc10d76['id'],'email':_0xc10d76[_0x3c3731(0x79)]},config[_0x3c3731(0xcb)],{'expiresIn':'24h'});}catch(_0x54a984){console[_0x3c3731(0xb9)](_0x54a984),_0x26e310[_0x3c3731(0xc6)](0x1f4)['json']({'error':_0x3c3731(0xae)});return;}_0x26e310[_0x3c3731(0xc6)](0xc8)['json']({'success':!![],'data':{'userId':_0xc10d76['id'],'username':_0x1b2d0a,'first_name':_0x153e64,'last_name':_0x3b7b24,'email':_0xc10d76[_0x3c3731(0x79)],'avatar_url':_0x524285,'token':_0x3df1ee}});}catch(_0x1f5455){console[_0x3c3731(0xb9)]({'err':_0x1f5455}),_0x26e310[_0x3c3731(0xc6)](0x1f4)[_0x3c3731(0x70)]({'error':_0x3c3731(0xae)});return;}}),module[a1_0x225562(0x85)]=router;