const a1_0x4b8a86=a1_0x5b2b;(function(_0x30f0b2,_0x4330c5){const _0x1428b8=a1_0x5b2b,_0x1d9738=_0x30f0b2();while(!![]){try{const _0x18c402=-parseInt(_0x1428b8(0x1ec))/0x1*(-parseInt(_0x1428b8(0x1e6))/0x2)+-parseInt(_0x1428b8(0x1d2))/0x3+parseInt(_0x1428b8(0x1e0))/0x4*(-parseInt(_0x1428b8(0x1dc))/0x5)+-parseInt(_0x1428b8(0x1cd))/0x6*(parseInt(_0x1428b8(0x1f8))/0x7)+parseInt(_0x1428b8(0x204))/0x8*(-parseInt(_0x1428b8(0x1e5))/0x9)+parseInt(_0x1428b8(0x1fc))/0xa*(parseInt(_0x1428b8(0x1da))/0xb)+-parseInt(_0x1428b8(0x1e8))/0xc;if(_0x18c402===_0x4330c5)break;else _0x1d9738['push'](_0x1d9738['shift']());}catch(_0x4f25f6){_0x1d9738['push'](_0x1d9738['shift']());}}}(a1_0x5f2a,0x2dc5d));function a1_0x5f2a(){const _0x21f5f6=['crypted_password','path','length','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','/update-password','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','jwtSecretKey','User\x20already\x20exists','json','../libs/mysql.js','4728qcDEWU','Invalid\x20email\x20or\x20password','user','verifyToken','role','113910dvWctL','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','express','/signup','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','promise','Invalid\x20user','avatars/','708158vWHXdx','body','5TNCpqb','avatar_url','single','Router','33484NDLLUb','first_name','./avatars','../libs/jwt','Invalid\x20password','4977GNZHsU','90CBKPcH','post','1821732vkbDmB','username','avatars','crypto','7149bdfqUm','file','email','log','bcrypt','/update-user-info','mkdirSync','ServerUrl','renameSync','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','last_name','749GQpOmF','status','Error!\x20Something\x20went\x20wrong.','hash','50FfKytK','../CADViewer_config.json','insertId','existsSync','compare','jsonwebtoken','avatar','sign','2512fobvlv','execute','24h'];a1_0x5f2a=function(){return _0x21f5f6;};return a1_0x5f2a();}function a1_0x5b2b(_0x2ae2f8,_0x814ac5){const _0x5f2a61=a1_0x5f2a();return a1_0x5b2b=function(_0x5b2bf5,_0x381305){_0x5b2bf5=_0x5b2bf5-0x1c9;let _0x3c8d77=_0x5f2a61[_0x5b2bf5];return _0x3c8d77;},a1_0x5b2b(_0x2ae2f8,_0x814ac5);}const jwt=require(a1_0x4b8a86(0x201)),bcrypt=require(a1_0x4b8a86(0x1f0)),config=require(a1_0x4b8a86(0x1fd)),conn=require(a1_0x4b8a86(0x1cc)),multer=require('multer'),fs=require('fs'),verifyToken=require(a1_0x4b8a86(0x1e3))[a1_0x4b8a86(0x1d0)];!fs[a1_0x4b8a86(0x1ff)](a1_0x4b8a86(0x1e2))&&fs[a1_0x4b8a86(0x1f2)](a1_0x4b8a86(0x1e2));const express=require(a1_0x4b8a86(0x1d4)),router=express[a1_0x4b8a86(0x1df)](),{randomUUID}=require(a1_0x4b8a86(0x1eb)),storage=multer['diskStorage']({'destination':function(_0x471767,_0x144475,_0x229c48){const _0x37ed80=a1_0x4b8a86;_0x229c48(null,_0x37ed80(0x1ea));}}),upload=multer({'storage':storage});router[a1_0x4b8a86(0x1e7)]('/login',async(_0x5bd324,_0x3a18fe,_0x19808e)=>{const _0x50d1fd=a1_0x4b8a86;let {email:_0x1cbc39,password:_0x47d3a4}=_0x5bd324[_0x50d1fd(0x1db)];console[_0x50d1fd(0x1ef)]({'email':_0x1cbc39,'password':_0x47d3a4});let _0x124c02;try{const [_0x2f38d9]=await conn[_0x50d1fd(0x1d7)]()[_0x50d1fd(0x205)](_0x50d1fd(0x1f6),[_0x1cbc39]);_0x2f38d9[_0x50d1fd(0x209)]>0x0&&(_0x124c02=_0x2f38d9[0x0]);}catch(_0x3908ae){console['log']({'err':_0x3908ae}),_0x3a18fe[_0x50d1fd(0x1f9)](0x1f4)['json']({'error':_0x50d1fd(0x1fa)});return;}console['log'](_0x124c02),console[_0x50d1fd(0x1ef)](_0x47d3a4),console[_0x50d1fd(0x1ef)](_0x124c02['crypted_password']);if(!_0x124c02||!await bcrypt[_0x50d1fd(0x200)](_0x47d3a4,_0x124c02[_0x50d1fd(0x207)])){_0x3a18fe[_0x50d1fd(0x1f9)](0x191)[_0x50d1fd(0x1cb)]({'error':_0x50d1fd(0x1ce)});return;}let _0x4a0c77;try{_0x4a0c77=jwt[_0x50d1fd(0x203)]({'userId':_0x124c02['id'],'email':_0x124c02[_0x50d1fd(0x1ee)]},config[_0x50d1fd(0x1c9)],{'expiresIn':'24h'});}catch(_0x4a9d75){console[_0x50d1fd(0x1ef)](_0x4a9d75),_0x3a18fe[_0x50d1fd(0x1f9)](0x1f4)['json']({'error':_0x50d1fd(0x1fa)});return;}_0x3a18fe['status'](0xc8)[_0x50d1fd(0x1cb)]({'success':!![],'data':{'userId':_0x124c02['id'],'username':_0x124c02['username'],'first_name':_0x124c02[_0x50d1fd(0x1e1)],'last_name':_0x124c02[_0x50d1fd(0x1f7)],'email':_0x124c02[_0x50d1fd(0x1ee)],'avatar_url':_0x124c02['avatar_url'],'id':_0x124c02['id'],'role':_0x124c02[_0x50d1fd(0x1d1)],'token':_0x4a0c77}});}),router[a1_0x4b8a86(0x1e7)](a1_0x4b8a86(0x1d5),async(_0x13572d,_0x17735f,_0x12722c)=>{const _0x315422=a1_0x4b8a86,{username:_0x386e02,email:_0x57e5df,password:_0x31f360}=_0x13572d['body'],[_0x14b418]=await conn[_0x315422(0x1d7)]()[_0x315422(0x205)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x57e5df]);if(_0x14b418['length']>0x0){_0x17735f['status'](0x1a6)['json']({'error':_0x315422(0x1ca)});return;}const _0x140545=await bcrypt[_0x315422(0x1fb)](_0x31f360,0xa);try{const [_0x1bfc13]=await conn['promise']()[_0x315422(0x205)](_0x315422(0x20a),[_0x386e02,_0x57e5df,_0x140545,_0x315422(0x1cf)]);if(_0x1bfc13[_0x315422(0x1fe)]){const [_0x446fa3]=await conn[_0x315422(0x1d7)]()[_0x315422(0x205)](_0x315422(0x1f5),[_0x1bfc13[_0x315422(0x1fe)]]);_0x446fa3[_0x315422(0x209)]>0x0&&(newUser=_0x446fa3[0x0]);}}catch{_0x17735f[_0x315422(0x1f9)](0x1f4)[_0x315422(0x1cb)]({'error':_0x315422(0x1fa)});return;}let _0x3242be;try{_0x3242be=jwt[_0x315422(0x203)]({'userId':newUser['id'],'email':newUser[_0x315422(0x1ee)]},config[_0x315422(0x1c9)],{'expiresIn':'24h'});}catch(_0x5680ac){_0x17735f[_0x315422(0x1f9)](0x1f4)[_0x315422(0x1cb)]({'error':_0x315422(0x1fa)});return;}_0x17735f[_0x315422(0x1f9)](0xc9)[_0x315422(0x1cb)]({'success':!![],'data':{'userId':newUser['id'],'username':newUser[_0x315422(0x1e9)],'first_name':newUser['first_name'],'last_name':newUser['last_name'],'email':newUser[_0x315422(0x1ee)],'avatar_url':newUser[_0x315422(0x1dd)],'id':newUser['id'],'role':newUser[_0x315422(0x1d1)],'token':_0x3242be}});}),router[a1_0x4b8a86(0x1e7)](a1_0x4b8a86(0x20b),verifyToken,async(_0x321042,_0x6b1423,_0x483e35)=>{const _0x5a463f=a1_0x4b8a86,{current_password:_0x446f5c,new_password:_0x50ab70}=_0x321042[_0x5a463f(0x1db)];console[_0x5a463f(0x1ef)]({'body':_0x321042[_0x5a463f(0x1db)]});const _0x471623=_0x321042[_0x5a463f(0x1cf)][_0x5a463f(0x1ee)];let _0xeb702a;try{const [_0x55e018]=await conn[_0x5a463f(0x1d7)]()[_0x5a463f(0x205)](_0x5a463f(0x1d6),[_0x471623]);if(_0x55e018[_0x5a463f(0x209)]>0x0){_0xeb702a=_0x55e018[0x0];if(!await bcrypt['compare'](_0x446f5c,_0xeb702a[_0x5a463f(0x207)])){_0x6b1423[_0x5a463f(0x1f9)](0x191)[_0x5a463f(0x1cb)]({'error':_0x5a463f(0x1e4)});return;}const _0x3e09dd=await bcrypt['hash'](_0x50ab70,0xa);await conn[_0x5a463f(0x1d7)]()[_0x5a463f(0x205)](_0x5a463f(0x1d3),[_0x3e09dd,_0x471623]),_0x6b1423[_0x5a463f(0x1f9)](0xc8)[_0x5a463f(0x1cb)]({'success':!![]});}}catch(_0x2a6193){console['log']({'err':_0x2a6193}),_0x6b1423[_0x5a463f(0x1f9)](0x1f4)[_0x5a463f(0x1cb)]({'error':_0x5a463f(0x1fa)});return;}}),router[a1_0x4b8a86(0x1e7)](a1_0x4b8a86(0x1f1),upload[a1_0x4b8a86(0x1de)](a1_0x4b8a86(0x202)),verifyToken,async(_0xaa2e99,_0x6bb6c3,_0x495a0d)=>{const _0x326129=a1_0x4b8a86,{username:_0x26a993,first_name:_0x3daae4,last_name:_0x4c4e39}=_0xaa2e99[_0x326129(0x1db)],_0x359c47=_0xaa2e99[_0x326129(0x1cf)][_0x326129(0x1ee)];let _0x1c4a9d;try{const [_0x22eec6]=await conn[_0x326129(0x1d7)]()[_0x326129(0x205)](_0x326129(0x1d6),[_0x359c47]);_0x22eec6[_0x326129(0x209)]>0x0&&(_0x1c4a9d=_0x22eec6[0x0]);}catch(_0x1b0622){console[_0x326129(0x1ef)]({'err':_0x1b0622}),_0x6bb6c3['status'](0x1f4)[_0x326129(0x1cb)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x1c4a9d){_0x6bb6c3[_0x326129(0x1f9)](0x191)[_0x326129(0x1cb)]({'error':_0x326129(0x1d8)});return;}console[_0x326129(0x1ef)]({'req':_0xaa2e99[_0x326129(0x1db)]});let _0x25349a=_0x1c4a9d[_0x326129(0x1dd)];if(_0xaa2e99[_0x326129(0x1ed)]){const _0x16f9e2=_0x326129(0x1d9)+randomUUID()+'.png';fs[_0x326129(0x1f4)](_0xaa2e99[_0x326129(0x1ed)][_0x326129(0x208)],'./'+_0x16f9e2),_0x25349a=config[_0x326129(0x1f3)]+'/'+_0x16f9e2;}try{await conn[_0x326129(0x1d7)]()['execute'](_0x326129(0x20c),[_0x26a993,_0x3daae4,_0x4c4e39,_0x25349a,_0x359c47]);let _0x223446;try{_0x223446=jwt[_0x326129(0x203)]({'userId':_0x1c4a9d['id'],'email':_0x1c4a9d[_0x326129(0x1ee)]},config[_0x326129(0x1c9)],{'expiresIn':_0x326129(0x206)});}catch(_0x5e5b72){console[_0x326129(0x1ef)](_0x5e5b72),_0x6bb6c3[_0x326129(0x1f9)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x6bb6c3[_0x326129(0x1f9)](0xc8)[_0x326129(0x1cb)]({'success':!![],'data':{'userId':_0x1c4a9d['id'],'username':_0x26a993,'first_name':_0x3daae4,'last_name':_0x4c4e39,'email':_0x1c4a9d[_0x326129(0x1ee)],'avatar_url':_0x25349a,'token':_0x223446}});}catch(_0x34583e){console[_0x326129(0x1ef)]({'err':_0x34583e}),_0x6bb6c3[_0x326129(0x1f9)](0x1f4)[_0x326129(0x1cb)]({'error':_0x326129(0x1fa)});return;}}),module['exports']=router;