const a1_0x1259f9=a1_0x4daa;(function(_0x1b2a87,_0x1594c1){const _0x329c72=a1_0x4daa,_0x1408b1=_0x1b2a87();while(!![]){try{const _0x45fdc1=-parseInt(_0x329c72(0x10a))/0x1+-parseInt(_0x329c72(0x130))/0x2+parseInt(_0x329c72(0x114))/0x3+-parseInt(_0x329c72(0x128))/0x4*(parseInt(_0x329c72(0x135))/0x5)+parseInt(_0x329c72(0x106))/0x6*(parseInt(_0x329c72(0x100))/0x7)+-parseInt(_0x329c72(0x11a))/0x8+parseInt(_0x329c72(0x139))/0x9*(parseInt(_0x329c72(0x112))/0xa);if(_0x45fdc1===_0x1594c1)break;else _0x1408b1['push'](_0x1408b1['shift']());}catch(_0x38fd8c){_0x1408b1['push'](_0x1408b1['shift']());}}}(a1_0x1fea,0xd3e1b));const jwt=require(a1_0x1259f9(0x126)),bcrypt=require('bcrypt'),config=require(a1_0x1259f9(0x12c)),conn=require(a1_0x1259f9(0x108)),multer=require(a1_0x1259f9(0x11c)),fs=require('fs'),verifyToken=require(a1_0x1259f9(0xfc))[a1_0x1259f9(0x105)];!fs[a1_0x1259f9(0x102)](a1_0x1259f9(0x107))&&fs[a1_0x1259f9(0x129)](a1_0x1259f9(0x107));function a1_0x4daa(_0x53d985,_0x2badfc){const _0x1fea9b=a1_0x1fea();return a1_0x4daa=function(_0x4daace,_0x2bd7b6){_0x4daace=_0x4daace-0xf9;let _0x3e96c1=_0x1fea9b[_0x4daace];return _0x3e96c1;},a1_0x4daa(_0x53d985,_0x2badfc);}const express=require(a1_0x1259f9(0xf9)),router=express[a1_0x1259f9(0x12b)](),{randomUUID}=require('crypto'),storage=multer[a1_0x1259f9(0x103)]({'destination':function(_0x195a22,_0x4c01ba,_0x3716e1){const _0x22c8c8=a1_0x1259f9;_0x3716e1(null,_0x22c8c8(0x113));}}),upload=multer({'storage':storage});router['post'](a1_0x1259f9(0x10b),async(_0x32bf58,_0x43dd89,_0x23ad65)=>{const _0x491cef=a1_0x1259f9;let {email:_0x28bb1a,password:_0x1dc8d4}=_0x32bf58['body'];console[_0x491cef(0x134)]({'email':_0x28bb1a,'password':_0x1dc8d4});let _0x4ef89e;try{const [_0x503b10]=await conn['promise']()[_0x491cef(0x12e)](_0x491cef(0x10f),[_0x28bb1a]);_0x503b10[_0x491cef(0x124)]>0x0&&(_0x4ef89e=_0x503b10[0x0]);}catch(_0x52bc89){console[_0x491cef(0x134)]({'err':_0x52bc89}),_0x43dd89[_0x491cef(0x110)](0x1f4)['json']({'error':_0x491cef(0xfa)});return;}console[_0x491cef(0x134)](_0x4ef89e),console[_0x491cef(0x134)](_0x1dc8d4),console[_0x491cef(0x134)](_0x4ef89e[_0x491cef(0x116)]);if(!_0x4ef89e||!await bcrypt['compare'](_0x1dc8d4,_0x4ef89e[_0x491cef(0x116)])){_0x43dd89[_0x491cef(0x110)](0x191)['json']({'error':_0x491cef(0x125)});return;}let _0x6f86b9;try{_0x6f86b9=jwt[_0x491cef(0x111)]({'userId':_0x4ef89e['id'],'email':_0x4ef89e[_0x491cef(0x137)]},config[_0x491cef(0x131)],{'expiresIn':'24h'});}catch(_0x1c0ffa){console[_0x491cef(0x134)](_0x1c0ffa),_0x43dd89[_0x491cef(0x110)](0x1f4)[_0x491cef(0x10d)]({'error':_0x491cef(0xfa)});return;}_0x43dd89[_0x491cef(0x110)](0xc8)['json']({'success':!![],'data':{'userId':_0x4ef89e['id'],'username':_0x4ef89e[_0x491cef(0x117)],'first_name':_0x4ef89e['first_name'],'last_name':_0x4ef89e[_0x491cef(0x12d)],'email':_0x4ef89e[_0x491cef(0x137)],'avatar_url':_0x4ef89e[_0x491cef(0xfb)],'id':_0x4ef89e['id'],'role':_0x4ef89e['role'],'token':_0x6f86b9}});}),router['post'](a1_0x1259f9(0x10e),async(_0x1b020d,_0x112a4c,_0x2c367c)=>{const _0x141782=a1_0x1259f9,{username:_0x4b9c25,email:_0x8dec3b,password:_0x45d5f8}=_0x1b020d[_0x141782(0x120)],[_0x200e02]=await conn[_0x141782(0x11b)]()[_0x141782(0x12e)](_0x141782(0x11d),[_0x8dec3b]);if(_0x200e02['length']>0x0){_0x112a4c[_0x141782(0x110)](0x1a6)[_0x141782(0x10d)]({'error':_0x141782(0xfd)});return;}const _0x34ae72=await bcrypt['hash'](_0x45d5f8,0xa);try{const [_0x58e93f]=await conn[_0x141782(0x11b)]()[_0x141782(0x12e)](_0x141782(0x10c),[_0x4b9c25,_0x8dec3b,_0x34ae72,'user']);if(_0x58e93f[_0x141782(0x121)]){const [_0x273dc5]=await conn[_0x141782(0x11b)]()[_0x141782(0x12e)](_0x141782(0x104),[_0x58e93f['insertId']]);_0x273dc5['length']>0x0&&(newUser=_0x273dc5[0x0]);}}catch{_0x112a4c[_0x141782(0x110)](0x1f4)[_0x141782(0x10d)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}let _0x11279a;try{_0x11279a=jwt[_0x141782(0x111)]({'userId':newUser['id'],'email':newUser[_0x141782(0x137)]},config['jwtSecretKey'],{'expiresIn':_0x141782(0x101)});}catch(_0x1c6cfd){_0x112a4c[_0x141782(0x110)](0x1f4)[_0x141782(0x10d)]({'error':_0x141782(0xfa)});return;}_0x112a4c[_0x141782(0x110)](0xc9)[_0x141782(0x10d)]({'success':!![],'data':{'userId':newUser['id'],'username':newUser[_0x141782(0x117)],'first_name':newUser[_0x141782(0x136)],'last_name':newUser[_0x141782(0x12d)],'email':newUser['email'],'avatar_url':newUser['avatar_url'],'id':newUser['id'],'role':newUser[_0x141782(0x123)],'token':_0x11279a}});}),router[a1_0x1259f9(0x109)](a1_0x1259f9(0x115),verifyToken,async(_0x37d33f,_0xd7dbe4,_0x3e2eb7)=>{const _0x4e6c62=a1_0x1259f9,{current_password:_0x10691a,new_password:_0x4699fb}=_0x37d33f[_0x4e6c62(0x120)];console[_0x4e6c62(0x134)]({'body':_0x37d33f[_0x4e6c62(0x120)]});const _0x1c62fa=_0x37d33f['user'][_0x4e6c62(0x137)];let _0x5a26a2;try{const [_0x5e2550]=await conn[_0x4e6c62(0x11b)]()[_0x4e6c62(0x12e)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x1c62fa]);if(_0x5e2550[_0x4e6c62(0x124)]>0x0){_0x5a26a2=_0x5e2550[0x0];if(!await bcrypt[_0x4e6c62(0x13a)](_0x10691a,_0x5a26a2[_0x4e6c62(0x116)])){_0xd7dbe4[_0x4e6c62(0x110)](0x191)[_0x4e6c62(0x10d)]({'error':_0x4e6c62(0x122)});return;}const _0x1ea3f4=await bcrypt[_0x4e6c62(0x133)](_0x4699fb,0xa);await conn[_0x4e6c62(0x11b)]()['execute'](_0x4e6c62(0x11e),[_0x1ea3f4,_0x1c62fa]),_0xd7dbe4['status'](0xc8)[_0x4e6c62(0x10d)]({'success':!![]});}}catch(_0x2b354b){console[_0x4e6c62(0x134)]({'err':_0x2b354b}),_0xd7dbe4['status'](0x1f4)[_0x4e6c62(0x10d)]({'error':_0x4e6c62(0xfa)});return;}}),router[a1_0x1259f9(0x109)](a1_0x1259f9(0xff),upload['single'](a1_0x1259f9(0x132)),verifyToken,async(_0x462fdd,_0x2f9989,_0x519a0f)=>{const _0x9f0eb7=a1_0x1259f9,{username:_0x3669a8,first_name:_0x3a3aea,last_name:_0x56bd8a}=_0x462fdd['body'],_0x14641b=_0x462fdd['user'][_0x9f0eb7(0x137)];let _0x422bc8;try{const [_0x3b2a2e]=await conn[_0x9f0eb7(0x11b)]()[_0x9f0eb7(0x12e)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x14641b]);_0x3b2a2e['length']>0x0&&(_0x422bc8=_0x3b2a2e[0x0]);}catch(_0x288ab5){console[_0x9f0eb7(0x134)]({'err':_0x288ab5}),_0x2f9989['status'](0x1f4)[_0x9f0eb7(0x10d)]({'error':_0x9f0eb7(0xfa)});return;}if(!_0x422bc8){_0x2f9989[_0x9f0eb7(0x110)](0x191)[_0x9f0eb7(0x10d)]({'error':_0x9f0eb7(0x119)});return;}console[_0x9f0eb7(0x134)]({'req':_0x462fdd[_0x9f0eb7(0x120)]});let _0x4dc731=_0x422bc8['avatar_url'];if(_0x462fdd[_0x9f0eb7(0x12f)]){const _0x4f4ff1=_0x9f0eb7(0x11f)+randomUUID()+_0x9f0eb7(0xfe);fs['renameSync'](_0x462fdd[_0x9f0eb7(0x12f)][_0x9f0eb7(0x138)],'./'+_0x4f4ff1),_0x4dc731=config[_0x9f0eb7(0x118)]+'/'+_0x4f4ff1;}try{await conn[_0x9f0eb7(0x11b)]()[_0x9f0eb7(0x12e)](_0x9f0eb7(0x12a),[_0x3669a8,_0x3a3aea,_0x56bd8a,_0x4dc731,_0x14641b]);let _0x505bab;try{_0x505bab=jwt[_0x9f0eb7(0x111)]({'userId':_0x422bc8['id'],'email':_0x422bc8[_0x9f0eb7(0x137)]},config['jwtSecretKey'],{'expiresIn':_0x9f0eb7(0x101)});}catch(_0x3e3f1f){console[_0x9f0eb7(0x134)](_0x3e3f1f),_0x2f9989[_0x9f0eb7(0x110)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}_0x2f9989[_0x9f0eb7(0x110)](0xc8)[_0x9f0eb7(0x10d)]({'success':!![],'data':{'userId':_0x422bc8['id'],'username':_0x3669a8,'first_name':_0x3a3aea,'last_name':_0x56bd8a,'email':_0x422bc8[_0x9f0eb7(0x137)],'avatar_url':_0x4dc731,'token':_0x505bab}});}catch(_0x404ad1){console[_0x9f0eb7(0x134)]({'err':_0x404ad1}),_0x2f9989[_0x9f0eb7(0x110)](0x1f4)[_0x9f0eb7(0x10d)]({'error':_0x9f0eb7(0xfa)});return;}}),module[a1_0x1259f9(0x127)]=router;function a1_0x1fea(){const _0x261a4a=['Error!\x20Something\x20went\x20wrong.','avatar_url','../libs/jwt','User\x20already\x20exists','.png','/update-user-info','217BSWUNv','24h','existsSync','diskStorage','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','verifyToken','327324XVMFqx','./avatars','../libs/mysql.js','post','304714EUdRES','/login','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','json','/signup','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','status','sign','40ZaiEmT','avatars','414585CgSlRr','/update-password','crypted_password','username','ServerUrl','Invalid\x20user','3330456OLDXlz','promise','multer','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','avatars/','body','insertId','Invalid\x20password','role','length','Invalid\x20email\x20or\x20password','jsonwebtoken','exports','6299140yTjtwV','mkdirSync','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','Router','../CADViewer_config.json','last_name','execute','file','1338888RocdWF','jwtSecretKey','avatar','hash','log','5NBxsNl','first_name','email','path','4508433bTesOO','compare','express'];a1_0x1fea=function(){return _0x261a4a;};return a1_0x1fea();}