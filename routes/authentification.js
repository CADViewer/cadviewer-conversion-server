const a1_0x56a9fb=a1_0x3aaa;(function(_0x3e2fb3,_0x22297c){const _0x2b45f7=a1_0x3aaa,_0x24b4d1=_0x3e2fb3();while(!![]){try{const _0x5028e6=-parseInt(_0x2b45f7(0x226))/0x1+parseInt(_0x2b45f7(0x1f4))/0x2+-parseInt(_0x2b45f7(0x1f0))/0x3+parseInt(_0x2b45f7(0x1fd))/0x4+-parseInt(_0x2b45f7(0x228))/0x5*(parseInt(_0x2b45f7(0x217))/0x6)+-parseInt(_0x2b45f7(0x220))/0x7+parseInt(_0x2b45f7(0x21d))/0x8;if(_0x5028e6===_0x22297c)break;else _0x24b4d1['push'](_0x24b4d1['shift']());}catch(_0x22c13e){_0x24b4d1['push'](_0x24b4d1['shift']());}}}(a1_0x261f,0xf2828));const jwt=require(a1_0x56a9fb(0x211)),bcrypt=require(a1_0x56a9fb(0x213)),config=require(a1_0x56a9fb(0x20e)),conn=require(a1_0x56a9fb(0x216)),multer=require('multer'),fs=require('fs'),verifyToken=require(a1_0x56a9fb(0x20f))[a1_0x56a9fb(0x20c)];function a1_0x261f(){const _0x24f4e1=['ServerUrl','status','hash','338121fGQZPu','username','compare','/update-password','1406794GLAbhP','avatars','diskStorage','body','crypto','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`id`\x20=\x20?','Invalid\x20user','file','INSERT\x20INTO\x20`users`\x20(`username`,\x20`email`,\x20`crypted_password`,\x20`role`,\x20`is_enabled`)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x201)','6480492jyPdMU','length','path','Invalid\x20password','avatar_url','existsSync','.png','last_name','exports','first_name','promise','./avatars','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`is_enabled`\x20=\x201\x20AND\x20`email`\x20=\x20?','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','User\x20already\x20exists','verifyToken','renameSync','../CADViewer_config.json','../libs/jwt','insertId','jsonwebtoken','/login','bcrypt','post','UPDATE\x20`users`\x20SET\x20`username`\x20=\x20?,\x20`first_name`\x20=\x20?,\x20`last_name`\x20=\x20?,\x20`avatar_url`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','../libs/mysql.js','3246otgHmP','email','24h','sign','jwtSecretKey','crypted_password','20999816scolXJ','role','/update-user-info','11896192aoLNUw','user','Error!\x20Something\x20went\x20wrong.','execute','json','mkdirSync','357173GZpvUf','log','16505zpGBKq'];a1_0x261f=function(){return _0x24f4e1;};return a1_0x261f();}function a1_0x3aaa(_0x25e9b6,_0x2df19b){const _0x261fb6=a1_0x261f();return a1_0x3aaa=function(_0x3aaa9e,_0x5aed2f){_0x3aaa9e=_0x3aaa9e-0x1ee;let _0x41dbb7=_0x261fb6[_0x3aaa9e];return _0x41dbb7;},a1_0x3aaa(_0x25e9b6,_0x2df19b);}!fs[a1_0x56a9fb(0x202)](a1_0x56a9fb(0x208))&&fs[a1_0x56a9fb(0x225)](a1_0x56a9fb(0x208));const express=require('express'),router=express['Router'](),{randomUUID}=require(a1_0x56a9fb(0x1f8)),storage=multer[a1_0x56a9fb(0x1f6)]({'destination':function(_0x5942fa,_0x5cca9c,_0xf18bfe){const _0x32c798=a1_0x56a9fb;_0xf18bfe(null,_0x32c798(0x1f5));}}),upload=multer({'storage':storage});router[a1_0x56a9fb(0x214)](a1_0x56a9fb(0x212),async(_0x1dd2e3,_0x20fe09,_0x4b320b)=>{const _0x439b66=a1_0x56a9fb;let {email:_0x4768cc,password:_0x5b1402}=_0x1dd2e3[_0x439b66(0x1f7)];console[_0x439b66(0x227)]({'email':_0x4768cc,'password':_0x5b1402});let _0x4aa37d;try{const [_0x310627]=await conn[_0x439b66(0x207)]()[_0x439b66(0x223)](_0x439b66(0x209),[_0x4768cc]);_0x310627[_0x439b66(0x1fe)]>0x0&&(_0x4aa37d=_0x310627[0x0]);}catch(_0xb9e7bf){console[_0x439b66(0x227)]({'err':_0xb9e7bf}),_0x20fe09[_0x439b66(0x1ee)](0x1f4)['json']({'error':_0x439b66(0x222)});return;}console['log'](_0x4aa37d),console[_0x439b66(0x227)](_0x5b1402),console[_0x439b66(0x227)](_0x4aa37d['crypted_password']);if(!_0x4aa37d||!await bcrypt[_0x439b66(0x1f2)](_0x5b1402,_0x4aa37d[_0x439b66(0x21c)])){_0x20fe09[_0x439b66(0x1ee)](0x191)['json']({'error':'Invalid\x20email\x20or\x20password'});return;}let _0x2b6794;try{_0x2b6794=jwt[_0x439b66(0x21a)]({'userId':_0x4aa37d['id'],'email':_0x4aa37d[_0x439b66(0x218)]},config[_0x439b66(0x21b)],{'expiresIn':_0x439b66(0x219)});}catch(_0x44316e){console['log'](_0x44316e),_0x20fe09[_0x439b66(0x1ee)](0x1f4)[_0x439b66(0x224)]({'error':_0x439b66(0x222)});return;}_0x20fe09[_0x439b66(0x1ee)](0xc8)[_0x439b66(0x224)]({'success':!![],'data':{'userId':_0x4aa37d['id'],'username':_0x4aa37d[_0x439b66(0x1f1)],'first_name':_0x4aa37d[_0x439b66(0x206)],'last_name':_0x4aa37d[_0x439b66(0x204)],'email':_0x4aa37d[_0x439b66(0x218)],'avatar_url':_0x4aa37d['avatar_url'],'id':_0x4aa37d['id'],'role':_0x4aa37d[_0x439b66(0x21e)],'token':_0x2b6794}});}),router['post']('/signup',async(_0xf204d4,_0x3eaf6d,_0x21992f)=>{const _0x4da914=a1_0x56a9fb,{username:_0x53ac0f,email:_0x12d243,password:_0x304d3c}=_0xf204d4['body'],[_0x5b7f7a]=await conn[_0x4da914(0x207)]()[_0x4da914(0x223)](_0x4da914(0x20a),[_0x12d243]);if(_0x5b7f7a[_0x4da914(0x1fe)]>0x0){_0x3eaf6d[_0x4da914(0x1ee)](0x1a6)['json']({'error':_0x4da914(0x20b)});return;}const _0x4739cf=await bcrypt[_0x4da914(0x1ef)](_0x304d3c,0xa);try{const [_0x4d444e]=await conn[_0x4da914(0x207)]()[_0x4da914(0x223)](_0x4da914(0x1fc),[_0x53ac0f,_0x12d243,_0x4739cf,_0x4da914(0x221)]);if(_0x4d444e[_0x4da914(0x210)]){const [_0x40105f]=await conn[_0x4da914(0x207)]()[_0x4da914(0x223)](_0x4da914(0x1f9),[_0x4d444e['insertId']]);_0x40105f[_0x4da914(0x1fe)]>0x0&&(newUser=_0x40105f[0x0]);}}catch{_0x3eaf6d[_0x4da914(0x1ee)](0x1f4)['json']({'error':_0x4da914(0x222)});return;}let _0x331585;try{_0x331585=jwt['sign']({'userId':newUser['id'],'email':newUser[_0x4da914(0x218)]},config[_0x4da914(0x21b)],{'expiresIn':_0x4da914(0x219)});}catch(_0x30b66c){_0x3eaf6d[_0x4da914(0x1ee)](0x1f4)[_0x4da914(0x224)]({'error':_0x4da914(0x222)});return;}_0x3eaf6d[_0x4da914(0x1ee)](0xc9)[_0x4da914(0x224)]({'success':!![],'data':{'userId':newUser['id'],'username':newUser[_0x4da914(0x1f1)],'first_name':newUser[_0x4da914(0x206)],'last_name':newUser[_0x4da914(0x204)],'email':newUser[_0x4da914(0x218)],'avatar_url':newUser[_0x4da914(0x201)],'id':newUser['id'],'role':newUser[_0x4da914(0x21e)],'token':_0x331585}});}),router[a1_0x56a9fb(0x214)](a1_0x56a9fb(0x1f3),verifyToken,async(_0x40a5a3,_0x226366,_0x3f6d61)=>{const _0x2bcba8=a1_0x56a9fb,{current_password:_0x49ce52,new_password:_0x390ea1}=_0x40a5a3[_0x2bcba8(0x1f7)];console['log']({'body':_0x40a5a3['body']});const _0xcdf53d=_0x40a5a3[_0x2bcba8(0x221)]['email'];let _0xcc6e89;try{const [_0x2d1bf5]=await conn[_0x2bcba8(0x207)]()[_0x2bcba8(0x223)](_0x2bcba8(0x20a),[_0xcdf53d]);if(_0x2d1bf5[_0x2bcba8(0x1fe)]>0x0){_0xcc6e89=_0x2d1bf5[0x0];if(!await bcrypt[_0x2bcba8(0x1f2)](_0x49ce52,_0xcc6e89['crypted_password'])){_0x226366[_0x2bcba8(0x1ee)](0x191)[_0x2bcba8(0x224)]({'error':_0x2bcba8(0x200)});return;}const _0x3a17a7=await bcrypt[_0x2bcba8(0x1ef)](_0x390ea1,0xa);await conn['promise']()[_0x2bcba8(0x223)]('UPDATE\x20`users`\x20SET\x20`crypted_password`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x3a17a7,_0xcdf53d]),_0x226366['status'](0xc8)[_0x2bcba8(0x224)]({'success':!![]});}}catch(_0x53d3fe){console[_0x2bcba8(0x227)]({'err':_0x53d3fe}),_0x226366[_0x2bcba8(0x1ee)](0x1f4)[_0x2bcba8(0x224)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}),router['post'](a1_0x56a9fb(0x21f),upload['single']('avatar'),verifyToken,async(_0x169346,_0x4d7cca,_0xf9e80b)=>{const _0x14ec1d=a1_0x56a9fb,{username:_0x5d4a13,first_name:_0x2283e5,last_name:_0x4f07a4}=_0x169346[_0x14ec1d(0x1f7)],_0x4ec5cd=_0x169346[_0x14ec1d(0x221)]['email'];let _0x199846;try{const [_0x9a8630]=await conn[_0x14ec1d(0x207)]()[_0x14ec1d(0x223)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x4ec5cd]);_0x9a8630['length']>0x0&&(_0x199846=_0x9a8630[0x0]);}catch(_0x2ce31d){console['log']({'err':_0x2ce31d}),_0x4d7cca[_0x14ec1d(0x1ee)](0x1f4)[_0x14ec1d(0x224)]({'error':_0x14ec1d(0x222)});return;}if(!_0x199846){_0x4d7cca[_0x14ec1d(0x1ee)](0x191)[_0x14ec1d(0x224)]({'error':_0x14ec1d(0x1fa)});return;}console[_0x14ec1d(0x227)]({'req':_0x169346['body']});let _0x1b421e=_0x199846['avatar_url'];if(_0x169346[_0x14ec1d(0x1fb)]){const _0x31a6cf='avatars/'+randomUUID()+_0x14ec1d(0x203);fs[_0x14ec1d(0x20d)](_0x169346[_0x14ec1d(0x1fb)][_0x14ec1d(0x1ff)],'./'+_0x31a6cf),_0x1b421e=config[_0x14ec1d(0x229)]+'/'+_0x31a6cf;}try{await conn[_0x14ec1d(0x207)]()[_0x14ec1d(0x223)](_0x14ec1d(0x215),[_0x5d4a13,_0x2283e5,_0x4f07a4,_0x1b421e,_0x4ec5cd]);let _0x333980;try{_0x333980=jwt[_0x14ec1d(0x21a)]({'userId':_0x199846['id'],'email':_0x199846[_0x14ec1d(0x218)]},config[_0x14ec1d(0x21b)],{'expiresIn':_0x14ec1d(0x219)});}catch(_0x42cb56){console[_0x14ec1d(0x227)](_0x42cb56),_0x4d7cca[_0x14ec1d(0x1ee)](0x1f4)[_0x14ec1d(0x224)]({'error':_0x14ec1d(0x222)});return;}_0x4d7cca[_0x14ec1d(0x1ee)](0xc8)[_0x14ec1d(0x224)]({'success':!![],'data':{'userId':_0x199846['id'],'username':_0x5d4a13,'first_name':_0x2283e5,'last_name':_0x4f07a4,'email':_0x199846['email'],'avatar_url':_0x1b421e,'token':_0x333980}});}catch(_0x332f35){console[_0x14ec1d(0x227)]({'err':_0x332f35}),_0x4d7cca[_0x14ec1d(0x1ee)](0x1f4)[_0x14ec1d(0x224)]({'error':_0x14ec1d(0x222)});return;}}),module[a1_0x56a9fb(0x205)]=router;