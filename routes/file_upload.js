const a8_0x467604=a8_0x269b;(function(_0x62f1aa,_0x4290c7){const _0x3ec056=a8_0x269b,_0x1c721d=_0x62f1aa();while(!![]){try{const _0x2f1706=parseInt(_0x3ec056(0xbb))/0x1*(-parseInt(_0x3ec056(0xad))/0x2)+-parseInt(_0x3ec056(0xd0))/0x3+parseInt(_0x3ec056(0xc2))/0x4+-parseInt(_0x3ec056(0xde))/0x5+-parseInt(_0x3ec056(0xac))/0x6+parseInt(_0x3ec056(0xb8))/0x7+parseInt(_0x3ec056(0xba))/0x8;if(_0x2f1706===_0x4290c7)break;else _0x1c721d['push'](_0x1c721d['shift']());}catch(_0x1ea8cc){_0x1c721d['push'](_0x1c721d['shift']());}}}(a8_0x280f,0xbf2e3));function a8_0x280f(){const _0x523e92=['crypto','Router','Folder\x20name\x20is\x20required','../libs/jwt','/remove','send','6250097pVEXmM','Invalid\x20user','24460128lhxmHJ','175ZdYYGP','statSync','array','body','status','log','delete','848708SlwjYM','originalname','mkdirSync','length','multer','./uploads/','reduce','size','folderLocation','existsSync','files','json','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','express','1322805AXKbJW','\x20files','httpStatusCode','rmdirSync','path','post','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','email','promise','Error!\x20Something\x20went\x20wrong.','./uploads','unlinkSync','/files','copyFileSync','7219865ywmqlS','../CADViewer_config.json','\x20MB\x20of\x20files','Path\x20is\x20required','execute','forEach','map','4764336LkJUXJ','8006ewIeFf','user','uploads','readdirSync','../libs/mysql.js'];a8_0x280f=function(){return _0x523e92;};return a8_0x280f();}function a8_0x269b(_0x16650b,_0x3239d4){const _0x280f87=a8_0x280f();return a8_0x269b=function(_0x269b0b,_0xad6f38){_0x269b0b=_0x269b0b-0xa8;let _0x160564=_0x280f87[_0x269b0b];return _0x160564;},a8_0x269b(_0x16650b,_0x3239d4);}const multer=require(a8_0x467604(0xc6)),fs=require('fs'),{randomUUID}=require(a8_0x467604(0xb2)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x467604(0xdf)),conn=require(a8_0x467604(0xb1)),verifyToken=require(a8_0x467604(0xb5))['verifyToken'],dir=a8_0x467604(0xda);!fs[a8_0x467604(0xcb)](dir)&&fs['mkdirSync'](dir);const express=require(a8_0x467604(0xcf)),router=express[a8_0x467604(0xb3)](),config=require(a8_0x467604(0xdf)),storage=multer['diskStorage']({'destination':function(_0x146757,_0x176cad,_0x3d24c7){const _0x71a5a0=a8_0x467604;_0x3d24c7(null,_0x71a5a0(0xaf));}}),upload=multer({'storage':storage});router[a8_0x467604(0xd5)](a8_0x467604(0xdc),upload[a8_0x467604(0xbd)](a8_0x467604(0xcc)),verifyToken,async(_0x55cad3,_0x48862c,_0x4426e2)=>{const _0x110d9f=a8_0x467604,_0x55e2c9=_0x55cad3[_0x110d9f(0xcc)],{global:_0x2d7144,path:_0x4e1a81}=_0x55cad3[_0x110d9f(0xbe)],_0x2a5096=config[_0x110d9f(0xca)];console[_0x110d9f(0xc0)]({'global':_0x2d7144}),console[_0x110d9f(0xc0)](_0x55e2c9),console[_0x110d9f(0xc0)]({'user':_0x55cad3[_0x110d9f(0xae)]});if(_0x2d7144){_0x55e2c9[_0x110d9f(0xaa)](_0x41ae55=>{const _0x5974b0=_0x110d9f;fs[_0x5974b0(0xdd)](_0x41ae55[_0x5974b0(0xd4)],(_0x4e1a81||_0x2a5096)+'/'+_0x41ae55[_0x5974b0(0xc3)]),fs[_0x5974b0(0xdb)](_0x41ae55[_0x5974b0(0xd4)]);}),_0x48862c[_0x110d9f(0xb7)]({'files':_0x55e2c9[_0x110d9f(0xab)](_0xe8e280=>({..._0xe8e280,'path':(_0x4e1a81||_0x2a5096)+'/'+_0xe8e280[_0x110d9f(0xc3)]}))});return;}let _0x22421d;try{const [_0x24d6b1]=await conn[_0x110d9f(0xd8)]()[_0x110d9f(0xa9)](_0x110d9f(0xd6),[_0x55cad3[_0x110d9f(0xae)]['email']]);_0x24d6b1[_0x110d9f(0xc5)]>0x0&&(_0x22421d=_0x24d6b1[0x0]);}catch(_0x2ad4f1){console[_0x110d9f(0xc0)]({'err':_0x2ad4f1}),_0x48862c[_0x110d9f(0xbf)](0x1f4)['json']({'error':_0x110d9f(0xd9)});return;}if(!_0x22421d){_0x48862c[_0x110d9f(0xbf)](0x191)[_0x110d9f(0xcd)]({'error':_0x110d9f(0xb9)});return;}let _0x1d8adc=_0x22421d['folder_name'];if(!_0x1d8adc){_0x1d8adc=randomUUID();try{await conn[_0x110d9f(0xd8)]()[_0x110d9f(0xa9)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x1d8adc,_0x55cad3[_0x110d9f(0xae)][_0x110d9f(0xd7)]]);}catch(_0x7ee8df){console['log']({'err':_0x7ee8df}),_0x48862c[_0x110d9f(0xbf)](0x1f4)[_0x110d9f(0xcd)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x3ed7c7=_0x110d9f(0xc7)+_0x1d8adc;!fs[_0x110d9f(0xcb)](_0x3ed7c7)&&fs[_0x110d9f(0xc4)](_0x3ed7c7);if(!_0x55e2c9){const _0x178770=new Error('Please\x20upload\x20a\x20file');return _0x178770[_0x110d9f(0xd2)]=0x190,_0x4426e2(_0x178770);}const _0x54fbc2=fs['readdirSync'](_0x3ed7c7)[_0x110d9f(0xc5)]+_0x55e2c9[_0x110d9f(0xc5)];console['log']({'numberOfSize':_0x54fbc2});if(_0x54fbc2>userFolderMaximumFiles)return _0x48862c[_0x110d9f(0xbf)](0x190)[_0x110d9f(0xcd)]({'error':_0x110d9f(0xce)+userFolderMaximumFiles+_0x110d9f(0xd1)});const _0x240849=fs[_0x110d9f(0xb0)](_0x3ed7c7)[_0x110d9f(0xc8)]((_0x42d935,_0x257e1b)=>_0x42d935+fs[_0x110d9f(0xbc)](_0x3ed7c7+'/'+_0x257e1b)[_0x110d9f(0xc9)],0x0),_0x3c786d=_0x55e2c9['reduce']((_0x137ce3,_0x2b306d)=>_0x137ce3+_0x2b306d[_0x110d9f(0xc9)],0x0);console[_0x110d9f(0xc0)]({'totalSize':_0x240849,'uploadedSize':_0x3c786d});if(_0x3c786d+_0x240849>userFolderMaximumSizeInMB*0x400*0x400)return _0x48862c[_0x110d9f(0xbf)](0x190)[_0x110d9f(0xcd)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+_0x110d9f(0xe0)});_0x55e2c9[_0x110d9f(0xaa)](_0x5d045b=>{const _0x370c34=_0x110d9f;fs[_0x370c34(0xdd)](_0x5d045b[_0x370c34(0xd4)],_0x3ed7c7+'/'+_0x5d045b[_0x370c34(0xc3)]),fs['unlinkSync'](_0x5d045b['path']);}),_0x48862c[_0x110d9f(0xb7)]({'files':_0x55e2c9['map'](_0x4fd11b=>({..._0x4fd11b,'path':_0x3ed7c7+'/'+_0x4fd11b['originalname']}))});}),router[a8_0x467604(0xd5)]('/folder',verifyToken,async(_0x5a9daf,_0x273f10)=>{const _0x1015d6=a8_0x467604,{path:_0x307d79,folder_name:_0x452792}=_0x5a9daf['body'];console[_0x1015d6(0xc0)]({'path':_0x307d79,'folder_name':_0x452792});if(!_0x307d79)return _0x273f10[_0x1015d6(0xbf)](0x190)[_0x1015d6(0xcd)]({'error':_0x1015d6(0xa8)});if(!_0x452792)return _0x273f10['status'](0x190)[_0x1015d6(0xcd)]({'error':_0x1015d6(0xb4)});const _0x34f9ff=_0x307d79+'/'+_0x452792;!fs[_0x1015d6(0xcb)](_0x34f9ff)&&fs[_0x1015d6(0xc4)](_0x34f9ff),_0x273f10[_0x1015d6(0xb7)]({'path':_0x34f9ff});}),router[a8_0x467604(0xc1)](a8_0x467604(0xb6),verifyToken,async(_0x30b5e4,_0x342406)=>{const _0x48de43=a8_0x467604,{isFolder:_0x466157,path:_0x5d4842}=_0x30b5e4[_0x48de43(0xbe)];!_0x466157?fs['unlinkSync'](_0x5d4842):fs[_0x48de43(0xd3)](_0x5d4842,{'recursive':!![]}),_0x342406['send']({'success':!![]});}),module['exports']=router;