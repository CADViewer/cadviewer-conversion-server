const a8_0x1e7b2c=a8_0x5297;(function(_0x5336e0,_0xf1b41c){const _0x411b4e=a8_0x5297,_0x247ac2=_0x5336e0();while(!![]){try{const _0x513acf=-parseInt(_0x411b4e(0x15e))/0x1+parseInt(_0x411b4e(0x156))/0x2*(parseInt(_0x411b4e(0x14c))/0x3)+parseInt(_0x411b4e(0x15c))/0x4+-parseInt(_0x411b4e(0x135))/0x5*(-parseInt(_0x411b4e(0x160))/0x6)+-parseInt(_0x411b4e(0x130))/0x7+parseInt(_0x411b4e(0x14a))/0x8*(parseInt(_0x411b4e(0x136))/0x9)+parseInt(_0x411b4e(0x15f))/0xa;if(_0x513acf===_0xf1b41c)break;else _0x247ac2['push'](_0x247ac2['shift']());}catch(_0x43ea63){_0x247ac2['push'](_0x247ac2['shift']());}}}(a8_0x1438,0xa909c));const multer=require(a8_0x1e7b2c(0x12b)),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x1e7b2c(0x13c)),conn=require(a8_0x1e7b2c(0x12d)),verifyToken=require(a8_0x1e7b2c(0x139))['verifyToken'],dir=a8_0x1e7b2c(0x12f);!fs['existsSync'](dir)&&fs[a8_0x1e7b2c(0x145)](dir);const express=require(a8_0x1e7b2c(0x12c)),router=express['Router'](),config=require(a8_0x1e7b2c(0x13c)),storage=multer[a8_0x1e7b2c(0x158)]({'destination':function(_0x458085,_0x457161,_0x53cbbf){const _0x18cf9b=a8_0x1e7b2c;_0x53cbbf(null,_0x18cf9b(0x138));}}),upload=multer({'storage':storage});function a8_0x5297(_0x59d93a,_0x95d5db){const _0x143803=a8_0x1438();return a8_0x5297=function(_0x529797,_0x10ee61){_0x529797=_0x529797-0x12b;let _0x2e3808=_0x143803[_0x529797];return _0x2e3808;},a8_0x5297(_0x59d93a,_0x95d5db);}router[a8_0x1e7b2c(0x150)](a8_0x1e7b2c(0x132),upload['array'](a8_0x1e7b2c(0x12e)),verifyToken,async(_0x146502,_0x31b957,_0x1cb22f)=>{const _0x8d01a0=a8_0x1e7b2c,_0x40d62a=_0x146502[_0x8d01a0(0x12e)],{global:_0x1e063f,path:_0xc03ca1}=_0x146502[_0x8d01a0(0x131)],_0x5bcea4=config['folderLocation'];console[_0x8d01a0(0x151)]({'global':_0x1e063f}),console['log'](_0x40d62a),console[_0x8d01a0(0x151)]({'user':_0x146502[_0x8d01a0(0x13d)]});if(_0x1e063f){_0x40d62a[_0x8d01a0(0x14b)](_0x1c34d1=>{const _0x1c97ad=_0x8d01a0;fs[_0x1c97ad(0x134)](_0x1c34d1['path'],(_0xc03ca1||_0x5bcea4)+'/'+_0x1c34d1['originalname']),fs[_0x1c97ad(0x15a)](_0x1c34d1[_0x1c97ad(0x142)]);}),_0x31b957['send']({'files':_0x40d62a[_0x8d01a0(0x159)](_0x475c37=>({..._0x475c37,'path':(_0xc03ca1||_0x5bcea4)+'/'+_0x475c37['originalname']}))});return;}let _0x4fddd2;try{const [_0x1e998e]=await conn[_0x8d01a0(0x146)]()[_0x8d01a0(0x144)](_0x8d01a0(0x161),[_0x146502[_0x8d01a0(0x13d)][_0x8d01a0(0x14f)]]);_0x1e998e[_0x8d01a0(0x149)]>0x0&&(_0x4fddd2=_0x1e998e[0x0]);}catch(_0x2c6711){console['log']({'err':_0x2c6711}),_0x31b957['status'](0x1f4)[_0x8d01a0(0x13a)]({'error':_0x8d01a0(0x13e)});return;}if(!_0x4fddd2){_0x31b957['status'](0x191)['json']({'error':_0x8d01a0(0x137)});return;}let _0xa81588=_0x4fddd2['folder_name'];if(!_0xa81588){_0xa81588=randomUUID();try{await conn[_0x8d01a0(0x146)]()[_0x8d01a0(0x144)](_0x8d01a0(0x141),[_0xa81588,_0x146502[_0x8d01a0(0x13d)][_0x8d01a0(0x14f)]]);}catch(_0x3619a5){console['log']({'err':_0x3619a5}),_0x31b957[_0x8d01a0(0x13b)](0x1f4)[_0x8d01a0(0x13a)]({'error':_0x8d01a0(0x13e)});return;}}const _0x2272b2=_0x8d01a0(0x152)+_0xa81588;!fs[_0x8d01a0(0x140)](_0x2272b2)&&fs[_0x8d01a0(0x145)](_0x2272b2);if(!_0x40d62a){const _0xb72337=new Error(_0x8d01a0(0x143));return _0xb72337[_0x8d01a0(0x153)]=0x190,_0x1cb22f(_0xb72337);}const _0x3e6a07=fs[_0x8d01a0(0x13f)](_0x2272b2)[_0x8d01a0(0x149)]+_0x40d62a['length'];console[_0x8d01a0(0x151)]({'numberOfSize':_0x3e6a07});if(_0x3e6a07>userFolderMaximumFiles)return _0x31b957[_0x8d01a0(0x13b)](0x190)[_0x8d01a0(0x13a)]({'error':_0x8d01a0(0x15b)+userFolderMaximumFiles+_0x8d01a0(0x15d)});const _0x96cd7c=fs[_0x8d01a0(0x13f)](_0x2272b2)[_0x8d01a0(0x155)]((_0x28e4c3,_0x30a5fa)=>_0x28e4c3+fs[_0x8d01a0(0x157)](_0x2272b2+'/'+_0x30a5fa)[_0x8d01a0(0x147)],0x0),_0x1745f8=_0x40d62a[_0x8d01a0(0x155)]((_0x19dab8,_0x138fc3)=>_0x19dab8+_0x138fc3['size'],0x0);console[_0x8d01a0(0x151)]({'totalSize':_0x96cd7c,'uploadedSize':_0x1745f8});if(_0x1745f8+_0x96cd7c>userFolderMaximumSizeInMB*0x400*0x400)return _0x31b957[_0x8d01a0(0x13b)](0x190)[_0x8d01a0(0x13a)]({'error':_0x8d01a0(0x15b)+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x40d62a[_0x8d01a0(0x14b)](_0x3870e2=>{const _0x2a631=_0x8d01a0;fs[_0x2a631(0x134)](_0x3870e2[_0x2a631(0x142)],_0x2272b2+'/'+_0x3870e2['originalname']),fs[_0x2a631(0x15a)](_0x3870e2[_0x2a631(0x142)]);}),_0x31b957[_0x8d01a0(0x148)]({'files':_0x40d62a[_0x8d01a0(0x159)](_0x268596=>({..._0x268596,'path':_0x2272b2+'/'+_0x268596['originalname']}))});}),router[a8_0x1e7b2c(0x150)](a8_0x1e7b2c(0x154),verifyToken,async(_0x5ea154,_0x214d17)=>{const _0x3592a8=a8_0x1e7b2c,{path:_0x42719f,folder_name:_0x472500}=_0x5ea154[_0x3592a8(0x131)];console[_0x3592a8(0x151)]({'path':_0x42719f,'folder_name':_0x472500});if(!_0x42719f)return _0x214d17['status'](0x190)[_0x3592a8(0x13a)]({'error':_0x3592a8(0x133)});if(!_0x472500)return _0x214d17['status'](0x190)[_0x3592a8(0x13a)]({'error':_0x3592a8(0x14e)});const _0x2342f6=_0x42719f+'/'+_0x472500;!fs[_0x3592a8(0x140)](_0x2342f6)&&fs[_0x3592a8(0x145)](_0x2342f6),_0x214d17[_0x3592a8(0x148)]({'path':_0x2342f6});}),router['delete'](a8_0x1e7b2c(0x162),verifyToken,async(_0x300579,_0x16d450)=>{const _0x59dac5=a8_0x1e7b2c,{isFolder:_0x59617a,path:_0x51f141}=_0x300579[_0x59dac5(0x131)];!_0x59617a?fs[_0x59dac5(0x15a)](_0x51f141):fs['rmdirSync'](_0x51f141,{'recursive':!![]}),_0x16d450['send']({'success':!![]});}),module[a8_0x1e7b2c(0x14d)]=router;function a8_0x1438(){const _0x31ff38=['express','../libs/mysql.js','files','./uploads','3184797BJfeAm','body','/files','Path\x20is\x20required','copyFileSync','135qmoVEE','3438GXMFDh','Invalid\x20user','uploads','../libs/jwt','json','status','../CADViewer_config.json','user','Error!\x20Something\x20went\x20wrong.','readdirSync','existsSync','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','path','Please\x20upload\x20a\x20file','execute','mkdirSync','promise','size','send','length','5112woiCep','forEach','6BKdtwz','exports','Folder\x20name\x20is\x20required','email','post','log','./uploads/','httpStatusCode','/folder','reduce','263644PfXuis','statSync','diskStorage','map','unlinkSync','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','2401032InPbrs','\x20files','834362CfjGKh','5181770UwjbXF','79008iTLAjv','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','/remove','multer'];a8_0x1438=function(){return _0x31ff38;};return a8_0x1438();}