const a8_0x30a5e1=a8_0x3e8e;function a8_0x3e8e(_0x2319e7,_0x646d27){const _0x43a522=a8_0x43a5();return a8_0x3e8e=function(_0x3e8ec3,_0x1245f0){_0x3e8ec3=_0x3e8ec3-0x145;let _0x15add3=_0x43a522[_0x3e8ec3];return _0x15add3;},a8_0x3e8e(_0x2319e7,_0x646d27);}function a8_0x43a5(){const _0xda27e4=['Router','Folder\x20name\x20is\x20required','user','736134Wnxqhf','json','/remove','map','execute','log','unlinkSync','crypto','Please\x20upload\x20a\x20file','2JmjTXU','promise','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','status','\x20MB\x20of\x20files','1260248LxypXe','path','reduce','Error!\x20Something\x20went\x20wrong.','../libs/jwt','1129131ZRumCh','body','uploads','length','send','verifyToken','existsSync','5650106yhuXoY','/files','files','array','9972840IjqCWF','Path\x20is\x20required','rmdirSync','folderLocation','4158940tZPSiS','size','../CADViewer_config.json','email','mkdirSync','./uploads','folder_name','699414jIFARB','originalname','post','delete','multer','\x20files','forEach','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','../libs/mysql.js','readdirSync','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','httpStatusCode'];a8_0x43a5=function(){return _0xda27e4;};return a8_0x43a5();}(function(_0x570a74,_0x331011){const _0x23bb96=a8_0x3e8e,_0x13f422=_0x570a74();while(!![]){try{const _0x414103=parseInt(_0x23bb96(0x14e))/0x1*(-parseInt(_0x23bb96(0x157))/0x2)+parseInt(_0x23bb96(0x161))/0x3+-parseInt(_0x23bb96(0x15c))/0x4+parseInt(_0x23bb96(0x170))/0x5+-parseInt(_0x23bb96(0x177))/0x6+-parseInt(_0x23bb96(0x168))/0x7+parseInt(_0x23bb96(0x16c))/0x8;if(_0x414103===_0x331011)break;else _0x13f422['push'](_0x13f422['shift']());}catch(_0x543ed2){_0x13f422['push'](_0x13f422['shift']());}}}(a8_0x43a5,0x75267));const multer=require(a8_0x30a5e1(0x17b)),fs=require('fs'),{randomUUID}=require(a8_0x30a5e1(0x155)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x30a5e1(0x172)),conn=require(a8_0x30a5e1(0x147)),verifyToken=require(a8_0x30a5e1(0x160))[a8_0x30a5e1(0x166)],dir=a8_0x30a5e1(0x175);!fs[a8_0x30a5e1(0x167)](dir)&&fs[a8_0x30a5e1(0x174)](dir);const express=require('express'),router=express[a8_0x30a5e1(0x14b)](),config=require(a8_0x30a5e1(0x172)),storage=multer['diskStorage']({'destination':function(_0x268511,_0x262d65,_0x276363){const _0x3c3158=a8_0x30a5e1;_0x276363(null,_0x3c3158(0x163));}}),upload=multer({'storage':storage});router[a8_0x30a5e1(0x179)](a8_0x30a5e1(0x169),upload[a8_0x30a5e1(0x16b)](a8_0x30a5e1(0x16a)),verifyToken,async(_0x40c0d6,_0x40f570,_0x5112d3)=>{const _0x2df400=a8_0x30a5e1,_0x346058=_0x40c0d6[_0x2df400(0x16a)],{global:_0x4c06c5,path:_0x483943}=_0x40c0d6['body'],_0xf35b4f=config[_0x2df400(0x16f)];console[_0x2df400(0x153)]({'global':_0x4c06c5}),console[_0x2df400(0x153)](_0x346058),console[_0x2df400(0x153)]({'user':_0x40c0d6[_0x2df400(0x14d)]});if(_0x4c06c5){_0x346058['forEach'](_0x494598=>{const _0x253156=_0x2df400;fs['copyFileSync'](_0x494598[_0x253156(0x15d)],(_0x483943||_0xf35b4f)+'/'+_0x494598[_0x253156(0x178)]),fs[_0x253156(0x154)](_0x494598[_0x253156(0x15d)]);}),_0x40f570[_0x2df400(0x165)]({'files':_0x346058[_0x2df400(0x151)](_0x4d424a=>({..._0x4d424a,'path':(_0x483943||_0xf35b4f)+'/'+_0x4d424a[_0x2df400(0x178)]}))});return;}let _0x455436;try{const [_0x5027a4]=await conn[_0x2df400(0x158)]()[_0x2df400(0x152)](_0x2df400(0x146),[_0x40c0d6[_0x2df400(0x14d)]['email']]);_0x5027a4['length']>0x0&&(_0x455436=_0x5027a4[0x0]);}catch(_0x3b7b2e){console[_0x2df400(0x153)]({'err':_0x3b7b2e}),_0x40f570['status'](0x1f4)['json']({'error':_0x2df400(0x15f)});return;}if(!_0x455436){_0x40f570['status'](0x191)[_0x2df400(0x14f)]({'error':'Invalid\x20user'});return;}let _0x6443d3=_0x455436[_0x2df400(0x176)];if(!_0x6443d3){_0x6443d3=randomUUID();try{await conn['promise']()['execute'](_0x2df400(0x159),[_0x6443d3,_0x40c0d6[_0x2df400(0x14d)][_0x2df400(0x173)]]);}catch(_0x31a822){console['log']({'err':_0x31a822}),_0x40f570[_0x2df400(0x15a)](0x1f4)['json']({'error':_0x2df400(0x15f)});return;}}const _0x47e409='./uploads/'+_0x6443d3;!fs[_0x2df400(0x167)](_0x47e409)&&fs['mkdirSync'](_0x47e409);if(!_0x346058){const _0x4d2a40=new Error(_0x2df400(0x156));return _0x4d2a40[_0x2df400(0x14a)]=0x190,_0x5112d3(_0x4d2a40);}const _0x36e23c=fs[_0x2df400(0x148)](_0x47e409)[_0x2df400(0x164)]+_0x346058['length'];console['log']({'numberOfSize':_0x36e23c});if(_0x36e23c>userFolderMaximumFiles)return _0x40f570['status'](0x190)[_0x2df400(0x14f)]({'error':_0x2df400(0x149)+userFolderMaximumFiles+_0x2df400(0x17c)});const _0x1a1f96=fs[_0x2df400(0x148)](_0x47e409)[_0x2df400(0x15e)]((_0x59960f,_0x507aaf)=>_0x59960f+fs['statSync'](_0x47e409+'/'+_0x507aaf)[_0x2df400(0x171)],0x0),_0x5b22cb=_0x346058[_0x2df400(0x15e)]((_0x47888c,_0x2e3c77)=>_0x47888c+_0x2e3c77[_0x2df400(0x171)],0x0);console['log']({'totalSize':_0x1a1f96,'uploadedSize':_0x5b22cb});if(_0x5b22cb+_0x1a1f96>userFolderMaximumSizeInMB*0x400*0x400)return _0x40f570['status'](0x190)[_0x2df400(0x14f)]({'error':_0x2df400(0x149)+userFolderMaximumSizeInMB+_0x2df400(0x15b)});_0x346058[_0x2df400(0x145)](_0xa9e180=>{const _0x52e713=_0x2df400;fs['copyFileSync'](_0xa9e180[_0x52e713(0x15d)],_0x47e409+'/'+_0xa9e180[_0x52e713(0x178)]),fs['unlinkSync'](_0xa9e180['path']);}),_0x40f570[_0x2df400(0x165)]({'files':_0x346058['map'](_0x44b101=>({..._0x44b101,'path':_0x47e409+'/'+_0x44b101['originalname']}))});}),router[a8_0x30a5e1(0x179)]('/folder',verifyToken,async(_0x1ff616,_0x25ad12)=>{const _0x27299e=a8_0x30a5e1,{path:_0x1d196d,folder_name:_0x48fca6}=_0x1ff616[_0x27299e(0x162)];console[_0x27299e(0x153)]({'path':_0x1d196d,'folder_name':_0x48fca6});if(!_0x1d196d)return _0x25ad12[_0x27299e(0x15a)](0x190)[_0x27299e(0x14f)]({'error':_0x27299e(0x16d)});if(!_0x48fca6)return _0x25ad12[_0x27299e(0x15a)](0x190)[_0x27299e(0x14f)]({'error':_0x27299e(0x14c)});const _0x1a31a6=_0x1d196d+'/'+_0x48fca6;!fs['existsSync'](_0x1a31a6)&&fs[_0x27299e(0x174)](_0x1a31a6),_0x25ad12[_0x27299e(0x165)]({'path':_0x1a31a6});}),router[a8_0x30a5e1(0x17a)](a8_0x30a5e1(0x150),verifyToken,async(_0x29f365,_0x1e4f36)=>{const _0x349c0d=a8_0x30a5e1,{isFolder:_0x5e9e25,path:_0x2c1f9d}=_0x29f365[_0x349c0d(0x162)];!_0x5e9e25?fs[_0x349c0d(0x154)](_0x2c1f9d):fs[_0x349c0d(0x16e)](_0x2c1f9d,{'recursive':!![]}),_0x1e4f36[_0x349c0d(0x165)]({'success':!![]});}),module['exports']=router;