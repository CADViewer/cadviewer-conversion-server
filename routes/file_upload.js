const a8_0x54a458=a8_0x5cae;function a8_0x20f6(){const _0x22667d=['Router','multer','/folder','promise','delete','mkdirSync','status','existsSync','forEach','folderLocation','Please\x20upload\x20a\x20file','28378KDMmXS','user','unlinkSync','body','9624480uodFNY','originalname','express','verifyToken','40QFJKJx','renameSync','readdirSync','json','2984238kGqVWB','post','statSync','send','map','598396gNxqVl','./uploads/','501KOODiQ','1DMnmLp','path','rmdirSync','./uploads','\x20files','../libs/mysql.js','/remove','../libs/jwt','files','Path\x20is\x20required','httpStatusCode','diskStorage','length','email','1359120aoLYin','size','540333YwGDQY','execute','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','11516NzIDyX','log','Invalid\x20user','../CADViewer_config.json','reduce','crypto'];a8_0x20f6=function(){return _0x22667d;};return a8_0x20f6();}(function(_0x471328,_0x49c04e){const _0x4bad18=a8_0x5cae,_0x40e9ac=_0x471328();while(!![]){try{const _0x453179=-parseInt(_0x4bad18(0x69))/0x1*(-parseInt(_0x4bad18(0x66))/0x2)+-parseInt(_0x4bad18(0x68))/0x3*(parseInt(_0x4bad18(0x7d))/0x4)+parseInt(_0x4bad18(0x77))/0x5+-parseInt(_0x4bad18(0x9a))/0x6+parseInt(_0x4bad18(0x8e))/0x7+parseInt(_0x4bad18(0x96))/0x8*(-parseInt(_0x4bad18(0x79))/0x9)+parseInt(_0x4bad18(0x92))/0xa;if(_0x453179===_0x49c04e)break;else _0x40e9ac['push'](_0x40e9ac['shift']());}catch(_0xaffd37){_0x40e9ac['push'](_0x40e9ac['shift']());}}}(a8_0x20f6,0x3f465));const multer=require(a8_0x54a458(0x84)),fs=require('fs'),{randomUUID}=require(a8_0x54a458(0x82)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x54a458(0x80)),conn=require(a8_0x54a458(0x6e)),verifyToken=require(a8_0x54a458(0x70))[a8_0x54a458(0x95)],dir=a8_0x54a458(0x6c);function a8_0x5cae(_0xe5ca26,_0x3ca857){const _0x20f64d=a8_0x20f6();return a8_0x5cae=function(_0x5cae00,_0x33b8f4){_0x5cae00=_0x5cae00-0x64;let _0x158ce8=_0x20f64d[_0x5cae00];return _0x158ce8;},a8_0x5cae(_0xe5ca26,_0x3ca857);}!fs['existsSync'](dir)&&fs[a8_0x54a458(0x88)](dir);const express=require(a8_0x54a458(0x94)),router=express[a8_0x54a458(0x83)](),config=require(a8_0x54a458(0x80)),storage=multer[a8_0x54a458(0x74)]({'destination':function(_0x24f071,_0x1989e7,_0x51092c){_0x51092c(null,'uploads');}}),upload=multer({'storage':storage});router[a8_0x54a458(0x9b)]('/files',upload['array'](a8_0x54a458(0x71)),verifyToken,async(_0x527bf9,_0x48ba4b,_0x492a8c)=>{const _0x2a1369=a8_0x54a458,_0x392c75=_0x527bf9[_0x2a1369(0x71)],{global:_0x49e83c,path:_0x9badd2}=_0x527bf9[_0x2a1369(0x91)],_0x191498=config['folderLocation'];console[_0x2a1369(0x7e)]({'global':_0x49e83c}),console['log'](_0x392c75),console['log']({'user':_0x527bf9['user']});if(_0x49e83c){_0x392c75['forEach'](_0x17eb15=>{const _0x27b892=_0x2a1369;fs[_0x27b892(0x97)](_0x17eb15[_0x27b892(0x6a)],(_0x9badd2||_0x191498)+'/'+_0x17eb15[_0x27b892(0x93)]);}),_0x48ba4b['send']({'files':_0x392c75[_0x2a1369(0x65)](_0x4fa3bb=>({..._0x4fa3bb,'path':(_0x9badd2||_0x191498)+'/'+_0x4fa3bb[_0x2a1369(0x93)]}))});return;}let _0x4ee693;try{const [_0x1bfefa]=await conn[_0x2a1369(0x86)]()[_0x2a1369(0x7a)](_0x2a1369(0x7b),[_0x527bf9[_0x2a1369(0x8f)]['email']]);_0x1bfefa[_0x2a1369(0x75)]>0x0&&(_0x4ee693=_0x1bfefa[0x0]);}catch(_0x1dda77){console['log']({'err':_0x1dda77}),_0x48ba4b['status'](0x1f4)[_0x2a1369(0x99)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x4ee693){_0x48ba4b[_0x2a1369(0x89)](0x191)[_0x2a1369(0x99)]({'error':_0x2a1369(0x7f)});return;}let _0x532bbc=_0x4ee693['folder_name'];if(!_0x532bbc){_0x532bbc=randomUUID();try{await conn[_0x2a1369(0x86)]()[_0x2a1369(0x7a)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x532bbc,_0x527bf9['user'][_0x2a1369(0x76)]]);}catch(_0x280313){console[_0x2a1369(0x7e)]({'err':_0x280313}),_0x48ba4b[_0x2a1369(0x89)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x42bce4=_0x2a1369(0x67)+_0x532bbc;!fs[_0x2a1369(0x8a)](_0x42bce4)&&fs['mkdirSync'](_0x42bce4);if(!_0x392c75){const _0x23cc32=new Error(_0x2a1369(0x8d));return _0x23cc32[_0x2a1369(0x73)]=0x190,_0x492a8c(_0x23cc32);}const _0x47999b=fs['readdirSync'](_0x42bce4)[_0x2a1369(0x75)]+_0x392c75['length'];console['log']({'numberOfSize':_0x47999b});if(_0x47999b>userFolderMaximumFiles)return _0x48ba4b[_0x2a1369(0x89)](0x190)[_0x2a1369(0x99)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+_0x2a1369(0x6d)});const _0x37f717=fs[_0x2a1369(0x98)](_0x42bce4)[_0x2a1369(0x81)]((_0x5e5965,_0x4e2498)=>_0x5e5965+fs[_0x2a1369(0x9c)](_0x42bce4+'/'+_0x4e2498)[_0x2a1369(0x78)],0x0),_0x566181=_0x392c75[_0x2a1369(0x81)]((_0x128895,_0xe935cf)=>_0x128895+_0xe935cf[_0x2a1369(0x78)],0x0);console[_0x2a1369(0x7e)]({'totalSize':_0x37f717,'uploadedSize':_0x566181});if(_0x566181+_0x37f717>userFolderMaximumSizeInMB*0x400*0x400)return _0x48ba4b[_0x2a1369(0x89)](0x190)[_0x2a1369(0x99)]({'error':_0x2a1369(0x7c)+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x392c75[_0x2a1369(0x8b)](_0x430803=>{const _0xa32f95=_0x2a1369;fs[_0xa32f95(0x97)](_0x430803[_0xa32f95(0x6a)],_0x42bce4+'/'+_0x430803['originalname']);}),_0x48ba4b[_0x2a1369(0x64)]({'files':_0x392c75[_0x2a1369(0x65)](_0x363301=>({..._0x363301,'path':_0x42bce4+'/'+_0x363301[_0x2a1369(0x93)]}))});}),router['post'](a8_0x54a458(0x85),verifyToken,async(_0x348423,_0x53a242)=>{const _0x298a36=a8_0x54a458,{path:_0x22fd1b,folder_name:_0x652aab}=_0x348423[_0x298a36(0x91)],_0x1e1aa5=config[_0x298a36(0x8c)];console[_0x298a36(0x7e)]({'path':_0x22fd1b,'folder_name':_0x652aab});if(!_0x22fd1b)return _0x53a242[_0x298a36(0x89)](0x190)['json']({'error':_0x298a36(0x72)});if(!_0x652aab)return _0x53a242['status'](0x190)[_0x298a36(0x99)]({'error':'Folder\x20name\x20is\x20required'});const _0x1999a1=_0x22fd1b+'/'+_0x652aab;!fs['existsSync'](_0x1999a1)&&fs[_0x298a36(0x88)](_0x1999a1),_0x53a242[_0x298a36(0x64)]({'path':_0x1999a1});}),router[a8_0x54a458(0x87)](a8_0x54a458(0x6f),verifyToken,async(_0x46a43d,_0x5026a9)=>{const _0xdb6e33=a8_0x54a458,{isFolder:_0x455008,path:_0x5be3ca}=_0x46a43d['body'];!_0x455008?fs[_0xdb6e33(0x90)](_0x5be3ca):fs[_0xdb6e33(0x6b)](_0x5be3ca,{'recursive':!![]}),_0x5026a9[_0xdb6e33(0x64)]({'success':!![]});}),module['exports']=router;