const a8_0x1aacbf=a8_0x1d48;(function(_0x242091,_0x4c3fa7){const _0x11242d=a8_0x1d48,_0x27095e=_0x242091();while(!![]){try{const _0x32ae12=-parseInt(_0x11242d(0x14d))/0x1+-parseInt(_0x11242d(0x137))/0x2*(parseInt(_0x11242d(0x135))/0x3)+parseInt(_0x11242d(0x151))/0x4*(parseInt(_0x11242d(0x141))/0x5)+-parseInt(_0x11242d(0x138))/0x6+-parseInt(_0x11242d(0x12d))/0x7+parseInt(_0x11242d(0x149))/0x8*(parseInt(_0x11242d(0x14f))/0x9)+-parseInt(_0x11242d(0x132))/0xa*(-parseInt(_0x11242d(0x15c))/0xb);if(_0x32ae12===_0x4c3fa7)break;else _0x27095e['push'](_0x27095e['shift']());}catch(_0x351d0e){_0x27095e['push'](_0x27095e['shift']());}}}(a8_0x2045,0x224ee));const multer=require(a8_0x1aacbf(0x159)),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x1aacbf(0x12a)),conn=require(a8_0x1aacbf(0x152)),verifyToken=require(a8_0x1aacbf(0x14c))[a8_0x1aacbf(0x13e)],dir='./uploads';!fs[a8_0x1aacbf(0x12f)](dir)&&fs[a8_0x1aacbf(0x142)](dir);const express=require(a8_0x1aacbf(0x154)),router=express['Router'](),config=require(a8_0x1aacbf(0x12a)),storage=multer[a8_0x1aacbf(0x15f)]({'destination':function(_0x4288ed,_0x2ffc0f,_0x33136c){_0x33136c(null,'uploads');}}),upload=multer({'storage':storage});router[a8_0x1aacbf(0x153)](a8_0x1aacbf(0x144),upload[a8_0x1aacbf(0x147)]('files'),verifyToken,async(_0x1dd78f,_0x1866d3,_0xb118f8)=>{const _0x457262=a8_0x1aacbf,_0x5f4174=_0x1dd78f['files'],{global:_0x453f70,path:_0x141918}=_0x1dd78f[_0x457262(0x131)],_0x3591f2=config[_0x457262(0x14b)];console[_0x457262(0x12e)]({'global':_0x453f70}),console['log'](_0x5f4174),console[_0x457262(0x12e)]({'user':_0x1dd78f['user']});if(_0x453f70){_0x5f4174[_0x457262(0x13f)](_0x21a046=>{const _0x21dcba=_0x457262;fs[_0x21dcba(0x157)](_0x21a046['path'],(_0x141918||_0x3591f2)+'/'+_0x21a046[_0x21dcba(0x12b)]);}),_0x1866d3[_0x457262(0x13d)]({'files':_0x5f4174['map'](_0x4d7932=>({..._0x4d7932,'path':(_0x141918||_0x3591f2)+'/'+_0x4d7932['originalname']}))});return;}let _0xfc0eb3;try{const [_0x373afb]=await conn['promise']()[_0x457262(0x136)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x1dd78f[_0x457262(0x133)][_0x457262(0x15b)]]);_0x373afb[_0x457262(0x14a)]>0x0&&(_0xfc0eb3=_0x373afb[0x0]);}catch(_0x1d23ae){console['log']({'err':_0x1d23ae}),_0x1866d3[_0x457262(0x158)](0x1f4)[_0x457262(0x130)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0xfc0eb3){_0x1866d3['status'](0x191)['json']({'error':_0x457262(0x148)});return;}let _0x2d4462=_0xfc0eb3[_0x457262(0x146)];if(!_0x2d4462){_0x2d4462=randomUUID();try{await conn[_0x457262(0x15e)]()[_0x457262(0x136)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x2d4462,_0x1dd78f[_0x457262(0x133)][_0x457262(0x15b)]]);}catch(_0x2047ff){console[_0x457262(0x12e)]({'err':_0x2047ff}),_0x1866d3[_0x457262(0x158)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x15e7c1=_0x457262(0x13c)+_0x2d4462;!fs[_0x457262(0x12f)](_0x15e7c1)&&fs[_0x457262(0x142)](_0x15e7c1);if(!_0x5f4174){const _0x4438c8=new Error('Please\x20upload\x20a\x20file');return _0x4438c8[_0x457262(0x140)]=0x190,_0xb118f8(_0x4438c8);}const _0x57308c=fs[_0x457262(0x14e)](_0x15e7c1)['length']+_0x5f4174[_0x457262(0x14a)];console[_0x457262(0x12e)]({'numberOfSize':_0x57308c});if(_0x57308c>userFolderMaximumFiles)return _0x1866d3[_0x457262(0x158)](0x190)[_0x457262(0x130)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+_0x457262(0x134)});const _0x43de90=fs[_0x457262(0x14e)](_0x15e7c1)[_0x457262(0x12c)]((_0xf4d594,_0x59b82f)=>_0xf4d594+fs[_0x457262(0x13b)](_0x15e7c1+'/'+_0x59b82f)[_0x457262(0x155)],0x0),_0x2a8956=_0x5f4174[_0x457262(0x12c)]((_0x57cfe8,_0x20bc44)=>_0x57cfe8+_0x20bc44[_0x457262(0x155)],0x0);console[_0x457262(0x12e)]({'totalSize':_0x43de90,'uploadedSize':_0x2a8956});if(_0x2a8956+_0x43de90>userFolderMaximumSizeInMB*0x400*0x400)return _0x1866d3['status'](0x190)[_0x457262(0x130)]({'error':_0x457262(0x15a)+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x5f4174['forEach'](_0x17da3f=>{const _0x344d5a=_0x457262;fs[_0x344d5a(0x157)](_0x17da3f[_0x344d5a(0x15d)],_0x15e7c1+'/'+_0x17da3f[_0x344d5a(0x12b)]);}),_0x1866d3['send']({'files':_0x5f4174[_0x457262(0x13a)](_0x15b1d3=>({..._0x15b1d3,'path':_0x15e7c1+'/'+_0x15b1d3[_0x457262(0x12b)]}))});}),router[a8_0x1aacbf(0x153)](a8_0x1aacbf(0x139),verifyToken,async(_0x45badb,_0x189c10)=>{const _0x388812=a8_0x1aacbf,{path:_0x489b8b,folder_name:_0x265bc4}=_0x45badb[_0x388812(0x131)],_0x4dd31f=config['folderLocation'];console[_0x388812(0x12e)]({'path':_0x489b8b,'folder_name':_0x265bc4});if(!_0x489b8b)return _0x189c10[_0x388812(0x158)](0x190)[_0x388812(0x130)]({'error':_0x388812(0x143)});if(!_0x265bc4)return _0x189c10[_0x388812(0x158)](0x190)[_0x388812(0x130)]({'error':_0x388812(0x150)});const _0x5c7050=_0x489b8b+'/'+_0x265bc4;!fs['existsSync'](_0x5c7050)&&fs[_0x388812(0x142)](_0x5c7050),_0x189c10[_0x388812(0x13d)]({'path':_0x5c7050});}),router['delete'](a8_0x1aacbf(0x145),verifyToken,async(_0x8560e6,_0x59364f)=>{const _0x1382b4=a8_0x1aacbf,{isFolder:_0x3547fd,path:_0x33490d}=_0x8560e6['body'];!_0x3547fd?fs[_0x1382b4(0x156)](_0x33490d):fs['rmdirSync'](_0x33490d,{'recursive':!![]}),_0x59364f[_0x1382b4(0x13d)]({'success':!![]});}),module['exports']=router;function a8_0x1d48(_0x520975,_0x1eb662){const _0x204556=a8_0x2045();return a8_0x1d48=function(_0x1d48f7,_0x1f5f1c){_0x1d48f7=_0x1d48f7-0x12a;let _0x159b90=_0x204556[_0x1d48f7];return _0x159b90;},a8_0x1d48(_0x520975,_0x1eb662);}function a8_0x2045(){const _0x4279a3=['folder_name','array','Invalid\x20user','16gnrWgS','length','folderLocation','../libs/jwt','262958ZiYlYN','readdirSync','278478lEXVhK','Folder\x20name\x20is\x20required','20BwbOxv','../libs/mysql.js','post','express','size','unlinkSync','renameSync','status','multer','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','email','913BUAWjK','path','promise','diskStorage','../CADViewer_config.json','originalname','reduce','304367IDCNgC','log','existsSync','json','body','73300kkARXs','user','\x20files','644535autuPG','execute','2VwqWSp','247074ltJRPB','/folder','map','statSync','./uploads/','send','verifyToken','forEach','httpStatusCode','32715OspcOk','mkdirSync','Path\x20is\x20required','/files','/remove'];a8_0x2045=function(){return _0x4279a3;};return a8_0x2045();}