const a8_0x35062f=a8_0x4f94;(function(_0x32b926,_0x234dfa){const _0x3adc59=a8_0x4f94,_0x558473=_0x32b926();while(!![]){try{const _0x3e0722=-parseInt(_0x3adc59(0x1c3))/0x1*(parseInt(_0x3adc59(0x1d8))/0x2)+parseInt(_0x3adc59(0x1b3))/0x3+-parseInt(_0x3adc59(0x1ac))/0x4+-parseInt(_0x3adc59(0x1da))/0x5*(parseInt(_0x3adc59(0x1c2))/0x6)+-parseInt(_0x3adc59(0x1b8))/0x7+-parseInt(_0x3adc59(0x1bb))/0x8*(-parseInt(_0x3adc59(0x1af))/0x9)+parseInt(_0x3adc59(0x1d5))/0xa;if(_0x3e0722===_0x234dfa)break;else _0x558473['push'](_0x558473['shift']());}catch(_0x196b06){_0x558473['push'](_0x558473['shift']());}}}(a8_0xe84d,0x71409));const multer=require(a8_0x35062f(0x1c1)),fs=require('fs'),{randomUUID}=require(a8_0x35062f(0x1be)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x35062f(0x1bd)),conn=require('../libs/mysql.js'),verifyToken=require(a8_0x35062f(0x1df))[a8_0x35062f(0x1dd)],dir=a8_0x35062f(0x1d4);function a8_0xe84d(){const _0x2b9dfb=['160dEksvR','Path\x20is\x20required','promise','verifyToken','email','../libs/jwt','status','exports','forEach','execute','folder_name','2679692DAOEMb','json','body','4155489TydgMc','folderLocation','files','Router','2228202rVPgWo','./uploads/','/folder','send','length','63574jDgdfV','reduce','path','8rdZHjA','log','../CADViewer_config.json','crypto','diskStorage','array','multer','7980MejNOd','926sSdKkJ','existsSync','map','unlinkSync','readdirSync','originalname','Folder\x20name\x20is\x20required','post','delete','user','Invalid\x20user','mkdirSync','copyFileSync','/remove','Please\x20upload\x20a\x20file','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','httpStatusCode','./uploads','3865790TTdjkv','size','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','876FCsNtM','uploads'];a8_0xe84d=function(){return _0x2b9dfb;};return a8_0xe84d();}function a8_0x4f94(_0x3e063e,_0x223626){const _0xe84d67=a8_0xe84d();return a8_0x4f94=function(_0x4f9407,_0x118228){_0x4f9407=_0x4f9407-0x1ab;let _0x3be5a4=_0xe84d67[_0x4f9407];return _0x3be5a4;},a8_0x4f94(_0x3e063e,_0x223626);}!fs[a8_0x35062f(0x1c4)](dir)&&fs[a8_0x35062f(0x1ce)](dir);const express=require('express'),router=express[a8_0x35062f(0x1b2)](),config=require(a8_0x35062f(0x1bd)),storage=multer[a8_0x35062f(0x1bf)]({'destination':function(_0x2849ce,_0x4dedf3,_0x233804){const _0x5c5062=a8_0x35062f;_0x233804(null,_0x5c5062(0x1d9));}}),upload=multer({'storage':storage});router[a8_0x35062f(0x1ca)]('/files',upload[a8_0x35062f(0x1c0)](a8_0x35062f(0x1b1)),verifyToken,async(_0x58b50f,_0x5822f3,_0x310abe)=>{const _0x2d63d2=a8_0x35062f,_0x396f5c=_0x58b50f[_0x2d63d2(0x1b1)],{global:_0x44d908,path:_0x384296}=_0x58b50f['body'],_0x544703=config[_0x2d63d2(0x1b0)];console[_0x2d63d2(0x1bc)]({'global':_0x44d908}),console[_0x2d63d2(0x1bc)](_0x396f5c),console[_0x2d63d2(0x1bc)]({'user':_0x58b50f['user']});if(_0x44d908){_0x396f5c[_0x2d63d2(0x1e2)](_0xc2497b=>{const _0xcf0fdf=_0x2d63d2;fs[_0xcf0fdf(0x1cf)](_0xc2497b[_0xcf0fdf(0x1ba)],(_0x384296||_0x544703)+'/'+_0xc2497b[_0xcf0fdf(0x1c8)]),fs[_0xcf0fdf(0x1c6)](_0xc2497b[_0xcf0fdf(0x1ba)]);}),_0x5822f3[_0x2d63d2(0x1b6)]({'files':_0x396f5c[_0x2d63d2(0x1c5)](_0x22c49f=>({..._0x22c49f,'path':(_0x384296||_0x544703)+'/'+_0x22c49f[_0x2d63d2(0x1c8)]}))});return;}let _0x102440;try{const [_0x24d064]=await conn['promise']()[_0x2d63d2(0x1e3)](_0x2d63d2(0x1d2),[_0x58b50f[_0x2d63d2(0x1cc)][_0x2d63d2(0x1de)]]);_0x24d064[_0x2d63d2(0x1b7)]>0x0&&(_0x102440=_0x24d064[0x0]);}catch(_0x31526a){console[_0x2d63d2(0x1bc)]({'err':_0x31526a}),_0x5822f3[_0x2d63d2(0x1e0)](0x1f4)[_0x2d63d2(0x1ad)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x102440){_0x5822f3[_0x2d63d2(0x1e0)](0x191)[_0x2d63d2(0x1ad)]({'error':_0x2d63d2(0x1cd)});return;}let _0x16baf1=_0x102440[_0x2d63d2(0x1ab)];if(!_0x16baf1){_0x16baf1=randomUUID();try{await conn[_0x2d63d2(0x1dc)]()[_0x2d63d2(0x1e3)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x16baf1,_0x58b50f['user']['email']]);}catch(_0x46b5a8){console[_0x2d63d2(0x1bc)]({'err':_0x46b5a8}),_0x5822f3[_0x2d63d2(0x1e0)](0x1f4)[_0x2d63d2(0x1ad)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x5b70f4=_0x2d63d2(0x1b4)+_0x16baf1;!fs[_0x2d63d2(0x1c4)](_0x5b70f4)&&fs[_0x2d63d2(0x1ce)](_0x5b70f4);if(!_0x396f5c){const _0x1782af=new Error(_0x2d63d2(0x1d1));return _0x1782af[_0x2d63d2(0x1d3)]=0x190,_0x310abe(_0x1782af);}const _0x536366=fs['readdirSync'](_0x5b70f4)[_0x2d63d2(0x1b7)]+_0x396f5c[_0x2d63d2(0x1b7)];console['log']({'numberOfSize':_0x536366});if(_0x536366>userFolderMaximumFiles)return _0x5822f3[_0x2d63d2(0x1e0)](0x190)[_0x2d63d2(0x1ad)]({'error':_0x2d63d2(0x1d7)+userFolderMaximumFiles+'\x20files'});const _0x452faf=fs[_0x2d63d2(0x1c7)](_0x5b70f4)[_0x2d63d2(0x1b9)]((_0x501944,_0x20f473)=>_0x501944+fs['statSync'](_0x5b70f4+'/'+_0x20f473)['size'],0x0),_0x95e987=_0x396f5c[_0x2d63d2(0x1b9)]((_0x1a5164,_0x4b6060)=>_0x1a5164+_0x4b6060[_0x2d63d2(0x1d6)],0x0);console['log']({'totalSize':_0x452faf,'uploadedSize':_0x95e987});if(_0x95e987+_0x452faf>userFolderMaximumSizeInMB*0x400*0x400)return _0x5822f3[_0x2d63d2(0x1e0)](0x190)[_0x2d63d2(0x1ad)]({'error':_0x2d63d2(0x1d7)+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x396f5c[_0x2d63d2(0x1e2)](_0x2efcab=>{const _0x1eef99=_0x2d63d2;fs[_0x1eef99(0x1cf)](_0x2efcab[_0x1eef99(0x1ba)],_0x5b70f4+'/'+_0x2efcab[_0x1eef99(0x1c8)]),fs[_0x1eef99(0x1c6)](_0x2efcab[_0x1eef99(0x1ba)]);}),_0x5822f3[_0x2d63d2(0x1b6)]({'files':_0x396f5c[_0x2d63d2(0x1c5)](_0x2eee4d=>({..._0x2eee4d,'path':_0x5b70f4+'/'+_0x2eee4d['originalname']}))});}),router[a8_0x35062f(0x1ca)](a8_0x35062f(0x1b5),verifyToken,async(_0x218064,_0x5a516d)=>{const _0x50a3db=a8_0x35062f,{path:_0x1d300a,folder_name:_0x54c77b}=_0x218064[_0x50a3db(0x1ae)];console['log']({'path':_0x1d300a,'folder_name':_0x54c77b});if(!_0x1d300a)return _0x5a516d['status'](0x190)[_0x50a3db(0x1ad)]({'error':_0x50a3db(0x1db)});if(!_0x54c77b)return _0x5a516d['status'](0x190)[_0x50a3db(0x1ad)]({'error':_0x50a3db(0x1c9)});const _0x6a1299=_0x1d300a+'/'+_0x54c77b;!fs[_0x50a3db(0x1c4)](_0x6a1299)&&fs[_0x50a3db(0x1ce)](_0x6a1299),_0x5a516d['send']({'path':_0x6a1299});}),router[a8_0x35062f(0x1cb)](a8_0x35062f(0x1d0),verifyToken,async(_0x44a216,_0x3578b8)=>{const _0x389083=a8_0x35062f,{isFolder:_0x15174d,path:_0x3ddddb}=_0x44a216[_0x389083(0x1ae)];!_0x15174d?fs[_0x389083(0x1c6)](_0x3ddddb):fs['rmdirSync'](_0x3ddddb,{'recursive':!![]}),_0x3578b8[_0x389083(0x1b6)]({'success':!![]});}),module[a8_0x35062f(0x1e1)]=router;