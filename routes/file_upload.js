const a9_0x4de6e8=a9_0x5dae;function a9_0x5dae(_0x53a37e,_0x4cbddd){const _0x105a54=a9_0x105a();return a9_0x5dae=function(_0x5dae69,_0x3ef7e7){_0x5dae69=_0x5dae69-0x1cd;let _0x39100f=_0x105a54[_0x5dae69];return _0x39100f;},a9_0x5dae(_0x53a37e,_0x4cbddd);}(function(_0x33edf3,_0x5e4310){const _0x14b569=a9_0x5dae,_0x51a516=_0x33edf3();while(!![]){try{const _0x5b44d=parseInt(_0x14b569(0x1d4))/0x1+-parseInt(_0x14b569(0x1e6))/0x2*(parseInt(_0x14b569(0x1d5))/0x3)+-parseInt(_0x14b569(0x1d6))/0x4*(parseInt(_0x14b569(0x1eb))/0x5)+parseInt(_0x14b569(0x1f3))/0x6+-parseInt(_0x14b569(0x1e7))/0x7*(-parseInt(_0x14b569(0x1f1))/0x8)+parseInt(_0x14b569(0x1fb))/0x9+parseInt(_0x14b569(0x1f2))/0xa*(-parseInt(_0x14b569(0x1d3))/0xb);if(_0x5b44d===_0x5e4310)break;else _0x51a516['push'](_0x51a516['shift']());}catch(_0x76c5ea){_0x51a516['push'](_0x51a516['shift']());}}}(a9_0x105a,0x37e2c));const multer=require(a9_0x4de6e8(0x202)),fs=require('fs'),{randomUUID}=require(a9_0x4de6e8(0x1e3)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a9_0x4de6e8(0x1f7)),conn=require(a9_0x4de6e8(0x1fe)),verifyToken=require(a9_0x4de6e8(0x1f9))[a9_0x4de6e8(0x201)],dir=a9_0x4de6e8(0x1de);!fs[a9_0x4de6e8(0x1d2)](dir)&&fs[a9_0x4de6e8(0x1fc)](dir);const express=require(a9_0x4de6e8(0x1e4)),router=express['Router'](),config=require(a9_0x4de6e8(0x1f7)),storage=multer[a9_0x4de6e8(0x1e9)]({'destination':function(_0x49bd3f,_0x4e1ac8,_0x2a013e){_0x2a013e(null,'uploads');}}),upload=multer({'storage':storage});function a9_0x105a(){const _0x33c1e6=['email','../CADViewer_config.json','json','../libs/jwt','./uploads/','580617VawupF','mkdirSync','delete','../libs/mysql.js','copyFileSync','reduce','verifyToken','multer','unlinkSync','post','folderLocation','promise','status','Error!\x20Something\x20went\x20wrong.','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','existsSync','33wAoOmE','395511TVrhEg','272274EXYOHj','14852KcemwA','/files','size','exports','user','path','originalname','map','./uploads','execute','Path\x20is\x20required','array','rmdirSync','crypto','express','log','10cqmZEf','1939777hOvnNZ','Invalid\x20user','diskStorage','body','355fiFJrb','send','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','/remove','length','readdirSync','8ovERwN','638870RuNiwj','2405082vKTDju','files','forEach'];a9_0x105a=function(){return _0x33c1e6;};return a9_0x105a();}router[a9_0x4de6e8(0x204)](a9_0x4de6e8(0x1d7),upload[a9_0x4de6e8(0x1e1)](a9_0x4de6e8(0x1f4)),verifyToken,async(_0x245ee1,_0x2aba01,_0x380fe9)=>{const _0x3c1350=a9_0x4de6e8,_0xc3f40b=_0x245ee1[_0x3c1350(0x1f4)],{global:_0x4c46b0,path:_0x1ebead}=_0x245ee1['body'],_0x16e87a=config[_0x3c1350(0x1cd)];console['log']({'global':_0x4c46b0}),console[_0x3c1350(0x1e5)](_0xc3f40b),console[_0x3c1350(0x1e5)]({'user':_0x245ee1[_0x3c1350(0x1da)]});if(_0x4c46b0){_0xc3f40b[_0x3c1350(0x1f5)](_0x1ab9c8=>{const _0x4e29b8=_0x3c1350;fs[_0x4e29b8(0x1ff)](_0x1ab9c8[_0x4e29b8(0x1db)],(_0x1ebead||_0x16e87a)+'/'+_0x1ab9c8[_0x4e29b8(0x1dc)]),fs[_0x4e29b8(0x203)](_0x1ab9c8['path']);}),_0x2aba01[_0x3c1350(0x1ec)]({'files':_0xc3f40b['map'](_0x33fbd=>({..._0x33fbd,'path':(_0x1ebead||_0x16e87a)+'/'+_0x33fbd['originalname']}))});return;}let _0x557602;try{const [_0x1b4bf1]=await conn[_0x3c1350(0x1ce)]()[_0x3c1350(0x1df)](_0x3c1350(0x1ed),[_0x245ee1[_0x3c1350(0x1da)][_0x3c1350(0x1f6)]]);_0x1b4bf1[_0x3c1350(0x1ef)]>0x0&&(_0x557602=_0x1b4bf1[0x0]);}catch(_0x130f9e){console[_0x3c1350(0x1e5)]({'err':_0x130f9e}),_0x2aba01['status'](0x1f4)[_0x3c1350(0x1f8)]({'error':_0x3c1350(0x1d0)});return;}if(!_0x557602){_0x2aba01[_0x3c1350(0x1cf)](0x191)['json']({'error':_0x3c1350(0x1e8)});return;}let _0x34355b=_0x557602['folder_name'];if(!_0x34355b){_0x34355b=randomUUID();try{await conn[_0x3c1350(0x1ce)]()[_0x3c1350(0x1df)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x34355b,_0x245ee1['user'][_0x3c1350(0x1f6)]]);}catch(_0xe79c39){console['log']({'err':_0xe79c39}),_0x2aba01[_0x3c1350(0x1cf)](0x1f4)[_0x3c1350(0x1f8)]({'error':_0x3c1350(0x1d0)});return;}}const _0x1e9b24=_0x3c1350(0x1fa)+_0x34355b;!fs[_0x3c1350(0x1d2)](_0x1e9b24)&&fs['mkdirSync'](_0x1e9b24);if(!_0xc3f40b){const _0x353d5d=new Error('Please\x20upload\x20a\x20file');return _0x353d5d['httpStatusCode']=0x190,_0x380fe9(_0x353d5d);}const _0x59638f=fs['readdirSync'](_0x1e9b24)[_0x3c1350(0x1ef)]+_0xc3f40b[_0x3c1350(0x1ef)];console[_0x3c1350(0x1e5)]({'numberOfSize':_0x59638f});if(_0x59638f>userFolderMaximumFiles)return _0x2aba01[_0x3c1350(0x1cf)](0x190)[_0x3c1350(0x1f8)]({'error':_0x3c1350(0x1d1)+userFolderMaximumFiles+'\x20files'});const _0x5d7140=fs[_0x3c1350(0x1f0)](_0x1e9b24)[_0x3c1350(0x200)]((_0x34e6ef,_0x5e3146)=>_0x34e6ef+fs['statSync'](_0x1e9b24+'/'+_0x5e3146)[_0x3c1350(0x1d8)],0x0),_0x595cf7=_0xc3f40b[_0x3c1350(0x200)]((_0x44c5de,_0x127eee)=>_0x44c5de+_0x127eee[_0x3c1350(0x1d8)],0x0);console['log']({'totalSize':_0x5d7140,'uploadedSize':_0x595cf7});if(_0x595cf7+_0x5d7140>userFolderMaximumSizeInMB*0x400*0x400)return _0x2aba01[_0x3c1350(0x1cf)](0x190)[_0x3c1350(0x1f8)]({'error':_0x3c1350(0x1d1)+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0xc3f40b[_0x3c1350(0x1f5)](_0x357b6b=>{const _0x245292=_0x3c1350;fs['copyFileSync'](_0x357b6b[_0x245292(0x1db)],_0x1e9b24+'/'+_0x357b6b[_0x245292(0x1dc)]),fs[_0x245292(0x203)](_0x357b6b[_0x245292(0x1db)]);}),_0x2aba01[_0x3c1350(0x1ec)]({'files':_0xc3f40b[_0x3c1350(0x1dd)](_0x3f6ff3=>({..._0x3f6ff3,'path':_0x1e9b24+'/'+_0x3f6ff3['originalname']}))});}),router[a9_0x4de6e8(0x204)]('/folder',verifyToken,async(_0x1fa9fd,_0x10ff51)=>{const _0x1feba4=a9_0x4de6e8,{path:_0x5d2f82,folder_name:_0x4bbb2d}=_0x1fa9fd[_0x1feba4(0x1ea)];console[_0x1feba4(0x1e5)]({'path':_0x5d2f82,'folder_name':_0x4bbb2d});if(!_0x5d2f82)return _0x10ff51[_0x1feba4(0x1cf)](0x190)[_0x1feba4(0x1f8)]({'error':_0x1feba4(0x1e0)});if(!_0x4bbb2d)return _0x10ff51[_0x1feba4(0x1cf)](0x190)[_0x1feba4(0x1f8)]({'error':'Folder\x20name\x20is\x20required'});const _0x132b10=_0x5d2f82+'/'+_0x4bbb2d;!fs[_0x1feba4(0x1d2)](_0x132b10)&&fs[_0x1feba4(0x1fc)](_0x132b10),_0x10ff51[_0x1feba4(0x1ec)]({'path':_0x132b10});}),router[a9_0x4de6e8(0x1fd)](a9_0x4de6e8(0x1ee),verifyToken,async(_0x2d07ad,_0x5f10cd)=>{const _0x247fff=a9_0x4de6e8,{isFolder:_0x3b4401,path:_0x1d75ba}=_0x2d07ad[_0x247fff(0x1ea)];!_0x3b4401?fs[_0x247fff(0x203)](_0x1d75ba):fs[_0x247fff(0x1e2)](_0x1d75ba,{'recursive':!![]}),_0x5f10cd[_0x247fff(0x1ec)]({'success':!![]});}),module[a9_0x4de6e8(0x1d9)]=router;