const a8_0x1dc3bf=a8_0x38ba;function a8_0x38ba(_0x5433b8,_0x43af9f){const _0x2e65d4=a8_0x2e65();return a8_0x38ba=function(_0x38ba45,_0x202228){_0x38ba45=_0x38ba45-0xa0;let _0x3f60ce=_0x2e65d4[_0x38ba45];return _0x3f60ce;},a8_0x38ba(_0x5433b8,_0x43af9f);}(function(_0x1ff937,_0x13318e){const _0x42d602=a8_0x38ba,_0x158475=_0x1ff937();while(!![]){try{const _0x43f4f4=-parseInt(_0x42d602(0xcd))/0x1*(parseInt(_0x42d602(0xa0))/0x2)+-parseInt(_0x42d602(0xb8))/0x3+-parseInt(_0x42d602(0xa6))/0x4+parseInt(_0x42d602(0xd6))/0x5*(parseInt(_0x42d602(0xc8))/0x6)+parseInt(_0x42d602(0xb4))/0x7+parseInt(_0x42d602(0xab))/0x8*(-parseInt(_0x42d602(0xac))/0x9)+parseInt(_0x42d602(0xb3))/0xa*(parseInt(_0x42d602(0xd3))/0xb);if(_0x43f4f4===_0x13318e)break;else _0x158475['push'](_0x158475['shift']());}catch(_0x329363){_0x158475['push'](_0x158475['shift']());}}}(a8_0x2e65,0xed5db));const multer=require(a8_0x1dc3bf(0xc6)),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x1dc3bf(0xd1)),conn=require(a8_0x1dc3bf(0xaa)),verifyToken=require(a8_0x1dc3bf(0xc4))['verifyToken'],dir='./uploads';!fs['existsSync'](dir)&&fs[a8_0x1dc3bf(0xbd)](dir);const express=require(a8_0x1dc3bf(0xd0)),router=express[a8_0x1dc3bf(0xcb)](),config=require('../CADViewer_config.json'),storage=multer[a8_0x1dc3bf(0xa8)]({'destination':function(_0x19a482,_0x442fec,_0x81ba10){const _0x1c7c79=a8_0x1dc3bf;_0x81ba10(null,_0x1c7c79(0xa3));}}),upload=multer({'storage':storage});router[a8_0x1dc3bf(0xa2)](a8_0x1dc3bf(0xcc),upload[a8_0x1dc3bf(0xb1)](a8_0x1dc3bf(0xd5)),verifyToken,async(_0x3cfaf1,_0xd49fde,_0x25e5d2)=>{const _0x342f63=a8_0x1dc3bf,_0x4cb34d=_0x3cfaf1[_0x342f63(0xd5)],{global:_0x1b0ead,path:_0x442316}=_0x3cfaf1[_0x342f63(0xb0)],_0x2f51d4=config[_0x342f63(0xa7)];console['log']({'global':_0x1b0ead}),console['log'](_0x4cb34d),console[_0x342f63(0xb5)]({'user':_0x3cfaf1[_0x342f63(0xb2)]});if(_0x1b0ead){_0x4cb34d[_0x342f63(0xb9)](_0x36d532=>{const _0x26f376=_0x342f63;fs[_0x26f376(0xc5)](_0x36d532[_0x26f376(0xa9)],(_0x442316||_0x2f51d4)+'/'+_0x36d532[_0x26f376(0xca)]),fs[_0x26f376(0xb6)](_0x36d532['path']);}),_0xd49fde[_0x342f63(0xd4)]({'files':_0x4cb34d['map'](_0x344838=>({..._0x344838,'path':(_0x442316||_0x2f51d4)+'/'+_0x344838[_0x342f63(0xca)]}))});return;}let _0xf68a74;try{const [_0x3233dc]=await conn[_0x342f63(0xaf)]()[_0x342f63(0xc3)](_0x342f63(0xd7),[_0x3cfaf1['user'][_0x342f63(0xbc)]]);_0x3233dc[_0x342f63(0xa4)]>0x0&&(_0xf68a74=_0x3233dc[0x0]);}catch(_0x434edb){console['log']({'err':_0x434edb}),_0xd49fde[_0x342f63(0xbb)](0x1f4)[_0x342f63(0xc7)]({'error':_0x342f63(0xc1)});return;}if(!_0xf68a74){_0xd49fde[_0x342f63(0xbb)](0x191)[_0x342f63(0xc7)]({'error':_0x342f63(0xba)});return;}let _0x5c0c19=_0xf68a74['folder_name'];if(!_0x5c0c19){_0x5c0c19=randomUUID();try{await conn[_0x342f63(0xaf)]()['execute']('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x5c0c19,_0x3cfaf1[_0x342f63(0xb2)][_0x342f63(0xbc)]]);}catch(_0x377732){console[_0x342f63(0xb5)]({'err':_0x377732}),_0xd49fde[_0x342f63(0xbb)](0x1f4)[_0x342f63(0xc7)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x538d35=_0x342f63(0xc0)+_0x5c0c19;!fs[_0x342f63(0xcf)](_0x538d35)&&fs[_0x342f63(0xbd)](_0x538d35);if(!_0x4cb34d){const _0x3168a8=new Error(_0x342f63(0xce));return _0x3168a8[_0x342f63(0xbe)]=0x190,_0x25e5d2(_0x3168a8);}const _0x351379=fs[_0x342f63(0xb7)](_0x538d35)['length']+_0x4cb34d[_0x342f63(0xa4)];console['log']({'numberOfSize':_0x351379});if(_0x351379>userFolderMaximumFiles)return _0xd49fde[_0x342f63(0xbb)](0x190)[_0x342f63(0xc7)]({'error':_0x342f63(0xa5)+userFolderMaximumFiles+_0x342f63(0xc2)});const _0x41cd61=fs[_0x342f63(0xb7)](_0x538d35)['reduce']((_0x2db331,_0x439710)=>_0x2db331+fs['statSync'](_0x538d35+'/'+_0x439710)[_0x342f63(0xbf)],0x0),_0x101c4d=_0x4cb34d['reduce']((_0x3659f0,_0x5ae8e1)=>_0x3659f0+_0x5ae8e1['size'],0x0);console[_0x342f63(0xb5)]({'totalSize':_0x41cd61,'uploadedSize':_0x101c4d});if(_0x101c4d+_0x41cd61>userFolderMaximumSizeInMB*0x400*0x400)return _0xd49fde[_0x342f63(0xbb)](0x190)['json']({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x4cb34d['forEach'](_0x474614=>{const _0x1684b9=_0x342f63;fs['copyFileSync'](_0x474614['path'],_0x538d35+'/'+_0x474614[_0x1684b9(0xca)]),fs[_0x1684b9(0xb6)](_0x474614[_0x1684b9(0xa9)]);}),_0xd49fde[_0x342f63(0xd4)]({'files':_0x4cb34d[_0x342f63(0xad)](_0x3ea3a0=>({..._0x3ea3a0,'path':_0x538d35+'/'+_0x3ea3a0[_0x342f63(0xca)]}))});}),router[a8_0x1dc3bf(0xa2)](a8_0x1dc3bf(0xae),verifyToken,async(_0x9ed99a,_0x4a0900)=>{const _0x13ae01=a8_0x1dc3bf,{path:_0x2bca5b,folder_name:_0x125ffe}=_0x9ed99a[_0x13ae01(0xb0)];console[_0x13ae01(0xb5)]({'path':_0x2bca5b,'folder_name':_0x125ffe});if(!_0x2bca5b)return _0x4a0900[_0x13ae01(0xbb)](0x190)[_0x13ae01(0xc7)]({'error':_0x13ae01(0xd2)});if(!_0x125ffe)return _0x4a0900[_0x13ae01(0xbb)](0x190)[_0x13ae01(0xc7)]({'error':'Folder\x20name\x20is\x20required'});const _0x3be2c2=_0x2bca5b+'/'+_0x125ffe;!fs[_0x13ae01(0xcf)](_0x3be2c2)&&fs[_0x13ae01(0xbd)](_0x3be2c2),_0x4a0900[_0x13ae01(0xd4)]({'path':_0x3be2c2});}),router['delete']('/remove',verifyToken,async(_0x5c43d9,_0x7b5312)=>{const _0x51bf7e=a8_0x1dc3bf,{isFolder:_0x5d409c,path:_0x3bec11}=_0x5c43d9[_0x51bf7e(0xb0)];!_0x5d409c?fs['unlinkSync'](_0x3bec11):fs[_0x51bf7e(0xc9)](_0x3bec11,{'recursive':!![]}),_0x7b5312[_0x51bf7e(0xd4)]({'success':!![]});}),module[a8_0x1dc3bf(0xa1)]=router;function a8_0x2e65(){const _0x124bc3=['path','../libs/mysql.js','32YMGGcZ','2247777wBHkME','map','/folder','promise','body','array','user','230cCFQYG','475986GKvovc','log','unlinkSync','readdirSync','4518615pSOGYY','forEach','Invalid\x20user','status','email','mkdirSync','httpStatusCode','size','./uploads/','Error!\x20Something\x20went\x20wrong.','\x20files','execute','../libs/jwt','copyFileSync','multer','json','17532bbuSCO','rmdirSync','originalname','Router','/files','1NFpXiq','Please\x20upload\x20a\x20file','existsSync','express','../CADViewer_config.json','Path\x20is\x20required','2128907iQeSso','send','files','1545KoiFwd','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','2654702hJZvSb','exports','post','uploads','length','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','2469712Hagbzt','folderLocation','diskStorage'];a8_0x2e65=function(){return _0x124bc3;};return a8_0x2e65();}