function a8_0x5947(_0x111d09,_0x50e0b0){const _0x42831a=a8_0x4283();return a8_0x5947=function(_0x59474e,_0x44f5e8){_0x59474e=_0x59474e-0x1d4;let _0x355149=_0x42831a[_0x59474e];return _0x355149;},a8_0x5947(_0x111d09,_0x50e0b0);}const a8_0x38873a=a8_0x5947;(function(_0x327eb3,_0x3587aa){const _0x1eb750=a8_0x5947,_0xd3b2c6=_0x327eb3();while(!![]){try{const _0x57a211=parseInt(_0x1eb750(0x1e9))/0x1+parseInt(_0x1eb750(0x201))/0x2+parseInt(_0x1eb750(0x1d7))/0x3+-parseInt(_0x1eb750(0x1f9))/0x4+parseInt(_0x1eb750(0x1dc))/0x5+parseInt(_0x1eb750(0x205))/0x6+-parseInt(_0x1eb750(0x1fc))/0x7;if(_0x57a211===_0x3587aa)break;else _0xd3b2c6['push'](_0xd3b2c6['shift']());}catch(_0x4fedc3){_0xd3b2c6['push'](_0xd3b2c6['shift']());}}}(a8_0x4283,0x603b2));const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a8_0x38873a(0x1e3)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x38873a(0x1e8)),conn=require(a8_0x38873a(0x200)),verifyToken=require(a8_0x38873a(0x1e7))[a8_0x38873a(0x1e2)],dir='./uploads';!fs[a8_0x38873a(0x203)](dir)&&fs[a8_0x38873a(0x1fd)](dir);function a8_0x4283(){const _0xccf48b=['Invalid\x20user','14213101CVmfAb','mkdirSync','path','uploads','../libs/mysql.js','1555450sYXLQv','execute','existsSync','delete','3493110utsPvR','user','email','json','array','/folder','Path\x20is\x20required','1498044anOnzM','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','send','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','Error!\x20Something\x20went\x20wrong.','2587855rAhEtN','renameSync','statSync','size','\x20MB\x20of\x20files','diskStorage','verifyToken','crypto','exports','promise','forEach','../libs/jwt','../CADViewer_config.json','761897Mvgbnx','Router','log','originalname','/remove','reduce','body','length','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','post','express','status','files','folderLocation','\x20files','httpStatusCode','2856484uSUHLk','./uploads/'];a8_0x4283=function(){return _0xccf48b;};return a8_0x4283();}const express=require(a8_0x38873a(0x1f3)),router=express[a8_0x38873a(0x1ea)](),config=require(a8_0x38873a(0x1e8)),storage=multer[a8_0x38873a(0x1e1)]({'destination':function(_0xc468a2,_0x187c13,_0x1fb3bb){const _0xee62a3=a8_0x38873a;_0x1fb3bb(null,_0xee62a3(0x1ff));}}),upload=multer({'storage':storage});router[a8_0x38873a(0x1f2)]('/files',upload[a8_0x38873a(0x1d4)](a8_0x38873a(0x1f5)),verifyToken,async(_0x17c695,_0x5cfc3d,_0xafce7b)=>{const _0x426fd1=a8_0x38873a,_0x2d6185=_0x17c695['files'],{global:_0x2971af,path:_0x16dbce}=_0x17c695[_0x426fd1(0x1ef)],_0x5ce617=config[_0x426fd1(0x1f6)];console[_0x426fd1(0x1eb)]({'global':_0x2971af}),console[_0x426fd1(0x1eb)](_0x2d6185),console['log']({'user':_0x17c695[_0x426fd1(0x206)]});if(_0x2971af){_0x2d6185[_0x426fd1(0x1e6)](_0x32848a=>{const _0x43a8dd=_0x426fd1;fs[_0x43a8dd(0x1dd)](_0x32848a[_0x43a8dd(0x1fe)],(_0x16dbce||_0x5ce617)+'/'+_0x32848a[_0x43a8dd(0x1ec)]);}),_0x5cfc3d[_0x426fd1(0x1d9)]({'files':_0x2d6185['map'](_0x350fe6=>({..._0x350fe6,'path':(_0x16dbce||_0x5ce617)+'/'+_0x350fe6[_0x426fd1(0x1ec)]}))});return;}let _0x58772a;try{const [_0x1a6037]=await conn[_0x426fd1(0x1e5)]()[_0x426fd1(0x202)](_0x426fd1(0x1da),[_0x17c695[_0x426fd1(0x206)][_0x426fd1(0x207)]]);_0x1a6037[_0x426fd1(0x1f0)]>0x0&&(_0x58772a=_0x1a6037[0x0]);}catch(_0x1082ca){console[_0x426fd1(0x1eb)]({'err':_0x1082ca}),_0x5cfc3d[_0x426fd1(0x1f4)](0x1f4)[_0x426fd1(0x208)]({'error':_0x426fd1(0x1db)});return;}if(!_0x58772a){_0x5cfc3d[_0x426fd1(0x1f4)](0x191)[_0x426fd1(0x208)]({'error':_0x426fd1(0x1fb)});return;}let _0x1ba3d7=_0x58772a['folder_name'];if(!_0x1ba3d7){_0x1ba3d7=randomUUID();try{await conn[_0x426fd1(0x1e5)]()[_0x426fd1(0x202)](_0x426fd1(0x1f1),[_0x1ba3d7,_0x17c695[_0x426fd1(0x206)]['email']]);}catch(_0x52cda0){console[_0x426fd1(0x1eb)]({'err':_0x52cda0}),_0x5cfc3d[_0x426fd1(0x1f4)](0x1f4)[_0x426fd1(0x208)]({'error':_0x426fd1(0x1db)});return;}}const _0x483423=_0x426fd1(0x1fa)+_0x1ba3d7;!fs[_0x426fd1(0x203)](_0x483423)&&fs[_0x426fd1(0x1fd)](_0x483423);if(!_0x2d6185){const _0x1a4659=new Error('Please\x20upload\x20a\x20file');return _0x1a4659[_0x426fd1(0x1f8)]=0x190,_0xafce7b(_0x1a4659);}const _0x1480f6=fs['readdirSync'](_0x483423)[_0x426fd1(0x1f0)]+_0x2d6185['length'];console['log']({'numberOfSize':_0x1480f6});if(_0x1480f6>userFolderMaximumFiles)return _0x5cfc3d['status'](0x190)[_0x426fd1(0x208)]({'error':_0x426fd1(0x1d8)+userFolderMaximumFiles+_0x426fd1(0x1f7)});const _0x494618=fs['readdirSync'](_0x483423)[_0x426fd1(0x1ee)]((_0x48fad2,_0xaae9fd)=>_0x48fad2+fs[_0x426fd1(0x1de)](_0x483423+'/'+_0xaae9fd)[_0x426fd1(0x1df)],0x0),_0x252d6c=_0x2d6185[_0x426fd1(0x1ee)]((_0x49c398,_0x1e8fc3)=>_0x49c398+_0x1e8fc3['size'],0x0);console[_0x426fd1(0x1eb)]({'totalSize':_0x494618,'uploadedSize':_0x252d6c});if(_0x252d6c+_0x494618>userFolderMaximumSizeInMB*0x400*0x400)return _0x5cfc3d[_0x426fd1(0x1f4)](0x190)['json']({'error':_0x426fd1(0x1d8)+userFolderMaximumSizeInMB+_0x426fd1(0x1e0)});_0x2d6185[_0x426fd1(0x1e6)](_0x5a4888=>{const _0x27940c=_0x426fd1;fs[_0x27940c(0x1dd)](_0x5a4888['path'],_0x483423+'/'+_0x5a4888[_0x27940c(0x1ec)]);}),_0x5cfc3d[_0x426fd1(0x1d9)]({'files':_0x2d6185['map'](_0x11f08e=>({..._0x11f08e,'path':_0x483423+'/'+_0x11f08e[_0x426fd1(0x1ec)]}))});}),router[a8_0x38873a(0x1f2)](a8_0x38873a(0x1d5),verifyToken,async(_0x3c1596,_0x529da7)=>{const _0x45ece7=a8_0x38873a,{path:_0x41921e,folder_name:_0x348e43}=_0x3c1596[_0x45ece7(0x1ef)],_0x42454f=config[_0x45ece7(0x1f6)];console[_0x45ece7(0x1eb)]({'path':_0x41921e,'folder_name':_0x348e43});if(!_0x41921e)return _0x529da7[_0x45ece7(0x1f4)](0x190)[_0x45ece7(0x208)]({'error':_0x45ece7(0x1d6)});if(!_0x348e43)return _0x529da7['status'](0x190)['json']({'error':'Folder\x20name\x20is\x20required'});const _0x3a8539=_0x41921e+'/'+_0x348e43;!fs[_0x45ece7(0x203)](_0x3a8539)&&fs[_0x45ece7(0x1fd)](_0x3a8539),_0x529da7[_0x45ece7(0x1d9)]({'path':_0x3a8539});}),router[a8_0x38873a(0x204)](a8_0x38873a(0x1ed),verifyToken,async(_0x54adce,_0x9a934d)=>{const _0x2e2e0a=a8_0x38873a,{isFolder:_0x47cce7,path:_0x541bce}=_0x54adce[_0x2e2e0a(0x1ef)];!_0x47cce7?fs['unlinkSync'](_0x541bce):fs['rmdirSync'](_0x541bce,{'recursive':!![]}),_0x9a934d[_0x2e2e0a(0x1d9)]({'success':!![]});}),module[a8_0x38873a(0x1e4)]=router;