function a8_0xbab7(){const _0xfcab3f=['Path\x20is\x20required','Router','unlinkSync','uploads','Folder\x20name\x20is\x20required','execute','6494920HGJNyV','Invalid\x20user','folder_name','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','length','mkdirSync','\x20files','../CADViewer_config.json','10pWEVpM','verifyToken','email','1101941lGhrgg','diskStorage','originalname','reduce','existsSync','multer','10975944yqYmeS','map','Error!\x20Something\x20went\x20wrong.','193920ptlPTh','\x20MB\x20of\x20files','files','size','promise','../libs/jwt','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','readdirSync','rmdirSync','forEach','1237683NdVyeT','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','user','copyFileSync','send','Please\x20upload\x20a\x20file','../libs/mysql.js','882840LJERTk','7meYYIa','log','post','status','crypto','statSync','folderLocation','11475234fNMWdL','express','/remove','8hITxqB','json','body','path'];a8_0xbab7=function(){return _0xfcab3f;};return a8_0xbab7();}const a8_0x5948d9=a8_0x1f2d;function a8_0x1f2d(_0xea6025,_0x2f51ab){const _0xbab7e6=a8_0xbab7();return a8_0x1f2d=function(_0x1f2d45,_0x1f14c8){_0x1f2d45=_0x1f2d45-0x1bb;let _0xc6b8f5=_0xbab7e6[_0x1f2d45];return _0xc6b8f5;},a8_0x1f2d(_0xea6025,_0x2f51ab);}(function(_0x34d453,_0x2920e8){const _0x546ce2=a8_0x1f2d,_0x40d298=_0x34d453();while(!![]){try{const _0x46ff0a=-parseInt(_0x546ce2(0x1ef))/0x1+-parseInt(_0x546ce2(0x1be))/0x2+-parseInt(_0x546ce2(0x1c8))/0x3*(-parseInt(_0x546ce2(0x1da))/0x4)+parseInt(_0x546ce2(0x1e4))/0x5+-parseInt(_0x546ce2(0x1cf))/0x6+parseInt(_0x546ce2(0x1d0))/0x7*(parseInt(_0x546ce2(0x1bb))/0x8)+parseInt(_0x546ce2(0x1d7))/0x9*(-parseInt(_0x546ce2(0x1ec))/0xa);if(_0x46ff0a===_0x2920e8)break;else _0x40d298['push'](_0x40d298['shift']());}catch(_0x125679){_0x40d298['push'](_0x40d298['shift']());}}}(a8_0xbab7,0xd5a18));const multer=require(a8_0x5948d9(0x1f4)),fs=require('fs'),{randomUUID}=require(a8_0x5948d9(0x1d4)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x5948d9(0x1eb)),conn=require(a8_0x5948d9(0x1ce)),verifyToken=require(a8_0x5948d9(0x1c3))[a8_0x5948d9(0x1ed)],dir='./uploads';!fs[a8_0x5948d9(0x1f3)](dir)&&fs[a8_0x5948d9(0x1e9)](dir);const express=require(a8_0x5948d9(0x1d8)),router=express[a8_0x5948d9(0x1df)](),config=require(a8_0x5948d9(0x1eb)),storage=multer[a8_0x5948d9(0x1f0)]({'destination':function(_0x469686,_0x4a7cd0,_0x5aab4d){const _0x26c2df=a8_0x5948d9;_0x5aab4d(null,_0x26c2df(0x1e1));}}),upload=multer({'storage':storage});router[a8_0x5948d9(0x1d2)]('/files',upload['array'](a8_0x5948d9(0x1c0)),verifyToken,async(_0x20d869,_0x395175,_0xca2f6e)=>{const _0xc3cdd7=a8_0x5948d9,_0x2261b3=_0x20d869[_0xc3cdd7(0x1c0)],{global:_0x45a53b,path:_0x578eec}=_0x20d869[_0xc3cdd7(0x1dc)],_0x4a94bd=config[_0xc3cdd7(0x1d6)];console[_0xc3cdd7(0x1d1)]({'global':_0x45a53b}),console[_0xc3cdd7(0x1d1)](_0x2261b3),console[_0xc3cdd7(0x1d1)]({'user':_0x20d869[_0xc3cdd7(0x1ca)]});if(_0x45a53b){_0x2261b3[_0xc3cdd7(0x1c7)](_0x121820=>{const _0xbc0029=_0xc3cdd7;fs[_0xbc0029(0x1cb)](_0x121820[_0xbc0029(0x1dd)],(_0x578eec||_0x4a94bd)+'/'+_0x121820[_0xbc0029(0x1f1)]),fs[_0xbc0029(0x1e0)](_0x121820[_0xbc0029(0x1dd)]);}),_0x395175[_0xc3cdd7(0x1cc)]({'files':_0x2261b3[_0xc3cdd7(0x1bc)](_0x41ddcf=>({..._0x41ddcf,'path':(_0x578eec||_0x4a94bd)+'/'+_0x41ddcf['originalname']}))});return;}let _0x58ddd9;try{const [_0x1a7e39]=await conn[_0xc3cdd7(0x1c2)]()[_0xc3cdd7(0x1e3)](_0xc3cdd7(0x1c4),[_0x20d869[_0xc3cdd7(0x1ca)][_0xc3cdd7(0x1ee)]]);_0x1a7e39[_0xc3cdd7(0x1e8)]>0x0&&(_0x58ddd9=_0x1a7e39[0x0]);}catch(_0x192797){console[_0xc3cdd7(0x1d1)]({'err':_0x192797}),_0x395175['status'](0x1f4)[_0xc3cdd7(0x1db)]({'error':_0xc3cdd7(0x1bd)});return;}if(!_0x58ddd9){_0x395175['status'](0x191)[_0xc3cdd7(0x1db)]({'error':_0xc3cdd7(0x1e5)});return;}let _0x3b8038=_0x58ddd9[_0xc3cdd7(0x1e6)];if(!_0x3b8038){_0x3b8038=randomUUID();try{await conn[_0xc3cdd7(0x1c2)]()[_0xc3cdd7(0x1e3)](_0xc3cdd7(0x1c9),[_0x3b8038,_0x20d869['user']['email']]);}catch(_0x3a681d){console['log']({'err':_0x3a681d}),_0x395175[_0xc3cdd7(0x1d3)](0x1f4)[_0xc3cdd7(0x1db)]({'error':_0xc3cdd7(0x1bd)});return;}}const _0x581861='./uploads/'+_0x3b8038;!fs[_0xc3cdd7(0x1f3)](_0x581861)&&fs[_0xc3cdd7(0x1e9)](_0x581861);if(!_0x2261b3){const _0x4815f2=new Error(_0xc3cdd7(0x1cd));return _0x4815f2['httpStatusCode']=0x190,_0xca2f6e(_0x4815f2);}const _0xdd6a60=fs[_0xc3cdd7(0x1c5)](_0x581861)[_0xc3cdd7(0x1e8)]+_0x2261b3[_0xc3cdd7(0x1e8)];console[_0xc3cdd7(0x1d1)]({'numberOfSize':_0xdd6a60});if(_0xdd6a60>userFolderMaximumFiles)return _0x395175[_0xc3cdd7(0x1d3)](0x190)[_0xc3cdd7(0x1db)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+_0xc3cdd7(0x1ea)});const _0x1ad62e=fs[_0xc3cdd7(0x1c5)](_0x581861)[_0xc3cdd7(0x1f2)]((_0x397a33,_0x41c17f)=>_0x397a33+fs[_0xc3cdd7(0x1d5)](_0x581861+'/'+_0x41c17f)[_0xc3cdd7(0x1c1)],0x0),_0x1af424=_0x2261b3[_0xc3cdd7(0x1f2)]((_0x1775e0,_0x51e9eb)=>_0x1775e0+_0x51e9eb['size'],0x0);console['log']({'totalSize':_0x1ad62e,'uploadedSize':_0x1af424});if(_0x1af424+_0x1ad62e>userFolderMaximumSizeInMB*0x400*0x400)return _0x395175[_0xc3cdd7(0x1d3)](0x190)[_0xc3cdd7(0x1db)]({'error':_0xc3cdd7(0x1e7)+userFolderMaximumSizeInMB+_0xc3cdd7(0x1bf)});_0x2261b3[_0xc3cdd7(0x1c7)](_0x516fc3=>{const _0x36b524=_0xc3cdd7;fs[_0x36b524(0x1cb)](_0x516fc3[_0x36b524(0x1dd)],_0x581861+'/'+_0x516fc3['originalname']),fs[_0x36b524(0x1e0)](_0x516fc3[_0x36b524(0x1dd)]);}),_0x395175[_0xc3cdd7(0x1cc)]({'files':_0x2261b3[_0xc3cdd7(0x1bc)](_0x3ca9e0=>({..._0x3ca9e0,'path':_0x581861+'/'+_0x3ca9e0[_0xc3cdd7(0x1f1)]}))});}),router[a8_0x5948d9(0x1d2)]('/folder',verifyToken,async(_0x7c6765,_0x2258b3)=>{const _0x1f48c9=a8_0x5948d9,{path:_0x39a09d,folder_name:_0x492c5a}=_0x7c6765[_0x1f48c9(0x1dc)];console[_0x1f48c9(0x1d1)]({'path':_0x39a09d,'folder_name':_0x492c5a});if(!_0x39a09d)return _0x2258b3[_0x1f48c9(0x1d3)](0x190)[_0x1f48c9(0x1db)]({'error':_0x1f48c9(0x1de)});if(!_0x492c5a)return _0x2258b3['status'](0x190)['json']({'error':_0x1f48c9(0x1e2)});const _0x36124a=_0x39a09d+'/'+_0x492c5a;!fs[_0x1f48c9(0x1f3)](_0x36124a)&&fs['mkdirSync'](_0x36124a),_0x2258b3[_0x1f48c9(0x1cc)]({'path':_0x36124a});}),router['delete'](a8_0x5948d9(0x1d9),verifyToken,async(_0x561765,_0x4bca88)=>{const _0x1055d3=a8_0x5948d9,{isFolder:_0x35b915,path:_0x465d28}=_0x561765[_0x1055d3(0x1dc)];!_0x35b915?fs[_0x1055d3(0x1e0)](_0x465d28):fs[_0x1055d3(0x1c6)](_0x465d28,{'recursive':!![]}),_0x4bca88['send']({'success':!![]});}),module['exports']=router;