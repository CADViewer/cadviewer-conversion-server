const a8_0x59dc41=a8_0x5eca;function a8_0x5eca(_0x32eb8b,_0x2128ee){const _0x3663a3=a8_0x3663();return a8_0x5eca=function(_0x5eca5e,_0x566047){_0x5eca5e=_0x5eca5e-0x130;let _0xfc1ce=_0x3663a3[_0x5eca5e];return _0xfc1ce;},a8_0x5eca(_0x32eb8b,_0x2128ee);}function a8_0x3663(){const _0x3e3a44=['execute','uploads','send','map','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','Error!\x20Something\x20went\x20wrong.','Please\x20upload\x20a\x20file','2846767ZjZbZU','forEach','./uploads','exports','user','readdirSync','8CCwuYA','6DlLvNF','744140CETwEs','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','\x20files','promise','post','diskStorage','array','delete','length','54VzKipJ','statSync','multer','785815aiLWrP','originalname','mkdirSync','folderLocation','files','../CADViewer_config.json','express','existsSync','path','Folder\x20name\x20is\x20required','1BTAfWo','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','status','Invalid\x20user','185170ESuWGd','Path\x20is\x20required','body','reduce','rmdirSync','286380OfbkoO','7708XlPSRD','renameSync','folder_name','log','size','crypto','1213233RiiVGe','/folder','email','Router','../libs/jwt','json'];a8_0x3663=function(){return _0x3e3a44;};return a8_0x3663();}(function(_0x57c70f,_0x3bde74){const _0x47523a=a8_0x5eca,_0x33b250=_0x57c70f();while(!![]){try{const _0xd57573=parseInt(_0x47523a(0x149))/0x1*(parseInt(_0x47523a(0x153))/0x2)+parseInt(_0x47523a(0x152))/0x3+parseInt(_0x47523a(0x133))/0x4+-parseInt(_0x47523a(0x13f))/0x5*(parseInt(_0x47523a(0x132))/0x6)+-parseInt(_0x47523a(0x159))/0x7*(parseInt(_0x47523a(0x131))/0x8)+parseInt(_0x47523a(0x13c))/0x9*(-parseInt(_0x47523a(0x14d))/0xa)+parseInt(_0x47523a(0x166))/0xb;if(_0xd57573===_0x3bde74)break;else _0x33b250['push'](_0x33b250['shift']());}catch(_0x11ffab){_0x33b250['push'](_0x33b250['shift']());}}}(a8_0x3663,0x190a2));const multer=require(a8_0x59dc41(0x13e)),fs=require('fs'),{randomUUID}=require(a8_0x59dc41(0x158)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x59dc41(0x144)),conn=require('../libs/mysql.js'),verifyToken=require(a8_0x59dc41(0x15d))['verifyToken'],dir=a8_0x59dc41(0x168);!fs['existsSync'](dir)&&fs[a8_0x59dc41(0x141)](dir);const express=require(a8_0x59dc41(0x145)),router=express[a8_0x59dc41(0x15c)](),config=require(a8_0x59dc41(0x144)),storage=multer[a8_0x59dc41(0x138)]({'destination':function(_0x2e4351,_0x74fde5,_0x577d1d){const _0x51dee0=a8_0x59dc41;_0x577d1d(null,_0x51dee0(0x160));}}),upload=multer({'storage':storage});router['post']('/files',upload[a8_0x59dc41(0x139)]('files'),verifyToken,async(_0x2b06c0,_0x1dc984,_0xa1bd20)=>{const _0x26d948=a8_0x59dc41,_0x514b7a=_0x2b06c0[_0x26d948(0x143)],{global:_0x2a0850,path:_0x167c6f}=_0x2b06c0[_0x26d948(0x14f)],_0x38f89d=config[_0x26d948(0x142)];console[_0x26d948(0x156)]({'global':_0x2a0850}),console[_0x26d948(0x156)](_0x514b7a),console[_0x26d948(0x156)]({'user':_0x2b06c0['user']});if(_0x2a0850){_0x514b7a[_0x26d948(0x167)](_0x1a8409=>{const _0x582be9=_0x26d948;fs[_0x582be9(0x154)](_0x1a8409[_0x582be9(0x147)],(_0x167c6f||_0x38f89d)+'/'+_0x1a8409['originalname']);}),_0x1dc984['send']({'files':_0x514b7a[_0x26d948(0x162)](_0xa2e6f1=>({..._0xa2e6f1,'path':(_0x167c6f||_0x38f89d)+'/'+_0xa2e6f1[_0x26d948(0x140)]}))});return;}let _0x472b61;try{const [_0x3494fa]=await conn[_0x26d948(0x136)]()[_0x26d948(0x15f)](_0x26d948(0x14a),[_0x2b06c0['user'][_0x26d948(0x15b)]]);_0x3494fa[_0x26d948(0x13b)]>0x0&&(_0x472b61=_0x3494fa[0x0]);}catch(_0xe6d62b){console[_0x26d948(0x156)]({'err':_0xe6d62b}),_0x1dc984[_0x26d948(0x14b)](0x1f4)[_0x26d948(0x15e)]({'error':_0x26d948(0x164)});return;}if(!_0x472b61){_0x1dc984[_0x26d948(0x14b)](0x191)['json']({'error':_0x26d948(0x14c)});return;}let _0x5ec410=_0x472b61[_0x26d948(0x155)];if(!_0x5ec410){_0x5ec410=randomUUID();try{await conn[_0x26d948(0x136)]()[_0x26d948(0x15f)](_0x26d948(0x163),[_0x5ec410,_0x2b06c0[_0x26d948(0x16a)][_0x26d948(0x15b)]]);}catch(_0x56e05b){console[_0x26d948(0x156)]({'err':_0x56e05b}),_0x1dc984['status'](0x1f4)[_0x26d948(0x15e)]({'error':_0x26d948(0x164)});return;}}const _0x122c8d='./uploads/'+_0x5ec410;!fs[_0x26d948(0x146)](_0x122c8d)&&fs[_0x26d948(0x141)](_0x122c8d);if(!_0x514b7a){const _0x4cc627=new Error(_0x26d948(0x165));return _0x4cc627['httpStatusCode']=0x190,_0xa1bd20(_0x4cc627);}const _0x5747ef=fs[_0x26d948(0x130)](_0x122c8d)[_0x26d948(0x13b)]+_0x514b7a['length'];console['log']({'numberOfSize':_0x5747ef});if(_0x5747ef>userFolderMaximumFiles)return _0x1dc984['status'](0x190)[_0x26d948(0x15e)]({'error':_0x26d948(0x134)+userFolderMaximumFiles+_0x26d948(0x135)});const _0x20c804=fs[_0x26d948(0x130)](_0x122c8d)[_0x26d948(0x150)]((_0x15c677,_0x2f8372)=>_0x15c677+fs[_0x26d948(0x13d)](_0x122c8d+'/'+_0x2f8372)[_0x26d948(0x157)],0x0),_0xc4dce3=_0x514b7a[_0x26d948(0x150)]((_0x3e21d0,_0x4f0786)=>_0x3e21d0+_0x4f0786['size'],0x0);console[_0x26d948(0x156)]({'totalSize':_0x20c804,'uploadedSize':_0xc4dce3});if(_0xc4dce3+_0x20c804>userFolderMaximumSizeInMB*0x400*0x400)return _0x1dc984[_0x26d948(0x14b)](0x190)[_0x26d948(0x15e)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x514b7a[_0x26d948(0x167)](_0x45a9a6=>{const _0x212d30=_0x26d948;fs[_0x212d30(0x154)](_0x45a9a6[_0x212d30(0x147)],_0x122c8d+'/'+_0x45a9a6[_0x212d30(0x140)]);}),_0x1dc984[_0x26d948(0x161)]({'files':_0x514b7a[_0x26d948(0x162)](_0x4b8d2b=>({..._0x4b8d2b,'path':_0x122c8d+'/'+_0x4b8d2b[_0x26d948(0x140)]}))});}),router[a8_0x59dc41(0x137)](a8_0x59dc41(0x15a),verifyToken,async(_0x3a5542,_0xfd5655)=>{const _0x33f474=a8_0x59dc41,{path:_0x203dac,folder_name:_0x27898b}=_0x3a5542[_0x33f474(0x14f)],_0x26c9a3=config['folderLocation'];console['log']({'path':_0x203dac,'folder_name':_0x27898b});if(!_0x203dac)return _0xfd5655[_0x33f474(0x14b)](0x190)['json']({'error':_0x33f474(0x14e)});if(!_0x27898b)return _0xfd5655[_0x33f474(0x14b)](0x190)[_0x33f474(0x15e)]({'error':_0x33f474(0x148)});const _0x5dbc38=_0x203dac+'/'+_0x27898b;!fs[_0x33f474(0x146)](_0x5dbc38)&&fs[_0x33f474(0x141)](_0x5dbc38),_0xfd5655[_0x33f474(0x161)]({'path':_0x5dbc38});}),router[a8_0x59dc41(0x13a)]('/remove',verifyToken,async(_0x40de1d,_0x59d5b0)=>{const _0x2020f5=a8_0x59dc41,{isFolder:_0x45ed1,path:_0x35bb19}=_0x40de1d[_0x2020f5(0x14f)];!_0x45ed1?fs['unlinkSync'](_0x35bb19):fs[_0x2020f5(0x151)](_0x35bb19,{'recursive':!![]}),_0x59d5b0['send']({'success':!![]});}),module[a8_0x59dc41(0x169)]=router;