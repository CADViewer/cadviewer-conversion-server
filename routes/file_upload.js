function a8_0x1852(){const _0x18161f=['length','post','log','forEach','map','body','1621308eszlFy','promise','renameSync','\x20MB\x20of\x20files','uploads','status','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','folderLocation','readdirSync','unlinkSync','../libs/mysql.js','email','Path\x20is\x20required','../libs/jwt','/folder','mkdirSync','4rygnMc','size','send','execute','diskStorage','40503015KQiHsj','Please\x20upload\x20a\x20file','array','1665604UDExSY','Error!\x20Something\x20went\x20wrong.','7UbZDdV','json','verifyToken','/remove','/files','8251865UbeAmy','../CADViewer_config.json','6723088THdlxg','Router','multer','\x20files','path','1977618UavJDL','./uploads','6522216POPIjw','existsSync','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','statSync','Invalid\x20user','user','Folder\x20name\x20is\x20required','files','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','originalname','crypto','exports'];a8_0x1852=function(){return _0x18161f;};return a8_0x1852();}const a8_0x1be3f9=a8_0x25bc;(function(_0x18d10d,_0x56cee2){const _0xfe7c14=a8_0x25bc,_0x4b7d31=_0x18d10d();while(!![]){try{const _0x358794=parseInt(_0xfe7c14(0x111))/0x1+parseInt(_0xfe7c14(0xef))/0x2+-parseInt(_0xfe7c14(0xfd))/0x3+parseInt(_0xfe7c14(0xe7))/0x4*(parseInt(_0xfe7c14(0xf6))/0x5)+parseInt(_0xfe7c14(0xff))/0x6+-parseInt(_0xfe7c14(0xf1))/0x7*(-parseInt(_0xfe7c14(0xf8))/0x8)+-parseInt(_0xfe7c14(0xec))/0x9;if(_0x358794===_0x56cee2)break;else _0x4b7d31['push'](_0x4b7d31['shift']());}catch(_0x531a22){_0x4b7d31['push'](_0x4b7d31['shift']());}}}(a8_0x1852,0xd4fac));const multer=require(a8_0x1be3f9(0xfa)),fs=require('fs'),{randomUUID}=require(a8_0x1be3f9(0x109)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require(a8_0x1be3f9(0x11b)),verifyToken=require(a8_0x1be3f9(0x11e))[a8_0x1be3f9(0xf3)],dir=a8_0x1be3f9(0xfe);!fs[a8_0x1be3f9(0x100)](dir)&&fs[a8_0x1be3f9(0x120)](dir);const express=require('express'),router=express[a8_0x1be3f9(0xf9)](),config=require(a8_0x1be3f9(0xf7)),storage=multer[a8_0x1be3f9(0xeb)]({'destination':function(_0x467ad1,_0x4c4400,_0x192e3a){const _0x8a8177=a8_0x1be3f9;_0x192e3a(null,_0x8a8177(0x115));}}),upload=multer({'storage':storage});function a8_0x25bc(_0x5c92f4,_0x5911a2){const _0x1852b1=a8_0x1852();return a8_0x25bc=function(_0x25bc06,_0x1ca2d4){_0x25bc06=_0x25bc06-0xe7;let _0x4cffb8=_0x1852b1[_0x25bc06];return _0x4cffb8;},a8_0x25bc(_0x5c92f4,_0x5911a2);}router[a8_0x1be3f9(0x10c)](a8_0x1be3f9(0xf5),upload[a8_0x1be3f9(0xee)](a8_0x1be3f9(0x106)),verifyToken,async(_0x3f29cc,_0x12faa4,_0x36bc56)=>{const _0x15bc72=a8_0x1be3f9,_0x2cc277=_0x3f29cc[_0x15bc72(0x106)],{global:_0x24db84,path:_0x439cde}=_0x3f29cc['body'],_0x2608ac=config[_0x15bc72(0x118)];console[_0x15bc72(0x10d)]({'global':_0x24db84}),console[_0x15bc72(0x10d)](_0x2cc277),console[_0x15bc72(0x10d)]({'user':_0x3f29cc[_0x15bc72(0x104)]});if(_0x24db84){_0x2cc277[_0x15bc72(0x10e)](_0x11ae8d=>{const _0x1d0de5=_0x15bc72;fs[_0x1d0de5(0x113)](_0x11ae8d[_0x1d0de5(0xfc)],(_0x439cde||_0x2608ac)+'/'+_0x11ae8d[_0x1d0de5(0x108)]);}),_0x12faa4['send']({'files':_0x2cc277['map'](_0x49f720=>({..._0x49f720,'path':(_0x439cde||_0x2608ac)+'/'+_0x49f720['originalname']}))});return;}let _0x2fa2f0;try{const [_0x501fa7]=await conn[_0x15bc72(0x112)]()[_0x15bc72(0xea)](_0x15bc72(0x117),[_0x3f29cc[_0x15bc72(0x104)][_0x15bc72(0x11c)]]);_0x501fa7[_0x15bc72(0x10b)]>0x0&&(_0x2fa2f0=_0x501fa7[0x0]);}catch(_0x1523d4){console[_0x15bc72(0x10d)]({'err':_0x1523d4}),_0x12faa4[_0x15bc72(0x116)](0x1f4)[_0x15bc72(0xf2)]({'error':_0x15bc72(0xf0)});return;}if(!_0x2fa2f0){_0x12faa4[_0x15bc72(0x116)](0x191)[_0x15bc72(0xf2)]({'error':_0x15bc72(0x103)});return;}let _0x855a52=_0x2fa2f0['folder_name'];if(!_0x855a52){_0x855a52=randomUUID();try{await conn[_0x15bc72(0x112)]()[_0x15bc72(0xea)](_0x15bc72(0x107),[_0x855a52,_0x3f29cc[_0x15bc72(0x104)][_0x15bc72(0x11c)]]);}catch(_0x1552f1){console[_0x15bc72(0x10d)]({'err':_0x1552f1}),_0x12faa4['status'](0x1f4)[_0x15bc72(0xf2)]({'error':_0x15bc72(0xf0)});return;}}const _0x57cf0c='./uploads/'+_0x855a52;!fs[_0x15bc72(0x100)](_0x57cf0c)&&fs[_0x15bc72(0x120)](_0x57cf0c);if(!_0x2cc277){const _0x68c704=new Error(_0x15bc72(0xed));return _0x68c704['httpStatusCode']=0x190,_0x36bc56(_0x68c704);}const _0x13f832=fs[_0x15bc72(0x119)](_0x57cf0c)['length']+_0x2cc277['length'];console[_0x15bc72(0x10d)]({'numberOfSize':_0x13f832});if(_0x13f832>userFolderMaximumFiles)return _0x12faa4['status'](0x190)[_0x15bc72(0xf2)]({'error':_0x15bc72(0x101)+userFolderMaximumFiles+_0x15bc72(0xfb)});const _0x51bc4a=fs[_0x15bc72(0x119)](_0x57cf0c)['reduce']((_0x14a724,_0x314c46)=>_0x14a724+fs[_0x15bc72(0x102)](_0x57cf0c+'/'+_0x314c46)[_0x15bc72(0xe8)],0x0),_0x42170b=_0x2cc277['reduce']((_0x5e57d5,_0x224c2f)=>_0x5e57d5+_0x224c2f[_0x15bc72(0xe8)],0x0);console[_0x15bc72(0x10d)]({'totalSize':_0x51bc4a,'uploadedSize':_0x42170b});if(_0x42170b+_0x51bc4a>userFolderMaximumSizeInMB*0x400*0x400)return _0x12faa4['status'](0x190)[_0x15bc72(0xf2)]({'error':_0x15bc72(0x101)+userFolderMaximumSizeInMB+_0x15bc72(0x114)});_0x2cc277['forEach'](_0x5cc66b=>{const _0x26fc8b=_0x15bc72;fs['renameSync'](_0x5cc66b[_0x26fc8b(0xfc)],_0x57cf0c+'/'+_0x5cc66b[_0x26fc8b(0x108)]);}),_0x12faa4[_0x15bc72(0xe9)]({'files':_0x2cc277[_0x15bc72(0x10f)](_0x314fde=>({..._0x314fde,'path':_0x57cf0c+'/'+_0x314fde['originalname']}))});}),router[a8_0x1be3f9(0x10c)](a8_0x1be3f9(0x11f),verifyToken,async(_0x6a4d4e,_0x1265ca)=>{const _0x2d12c1=a8_0x1be3f9,{path:_0x19256b,folder_name:_0x1b131e}=_0x6a4d4e[_0x2d12c1(0x110)],_0x446409=config[_0x2d12c1(0x118)];console['log']({'path':_0x19256b,'folder_name':_0x1b131e});if(!_0x19256b)return _0x1265ca[_0x2d12c1(0x116)](0x190)[_0x2d12c1(0xf2)]({'error':_0x2d12c1(0x11d)});if(!_0x1b131e)return _0x1265ca[_0x2d12c1(0x116)](0x190)[_0x2d12c1(0xf2)]({'error':_0x2d12c1(0x105)});const _0xc51078=_0x19256b+'/'+_0x1b131e;!fs['existsSync'](_0xc51078)&&fs[_0x2d12c1(0x120)](_0xc51078),_0x1265ca[_0x2d12c1(0xe9)]({'path':_0xc51078});}),router['delete'](a8_0x1be3f9(0xf4),verifyToken,async(_0x211b84,_0x389ae6)=>{const _0xbcac57=a8_0x1be3f9,{isFolder:_0x2d77c0,path:_0xa06cd}=_0x211b84['body'];!_0x2d77c0?fs[_0xbcac57(0x11a)](_0xa06cd):fs['rmdirSync'](_0xa06cd,{'recursive':!![]}),_0x389ae6[_0xbcac57(0xe9)]({'success':!![]});}),module[a8_0x1be3f9(0x10a)]=router;