const a8_0x3a362e=a8_0xb306;function a8_0xb306(_0x24113d,_0x3e6761){const _0x15d330=a8_0x15d3();return a8_0xb306=function(_0xb306eb,_0x857262){_0xb306eb=_0xb306eb-0x1bb;let _0x41a546=_0x15d330[_0xb306eb];return _0x41a546;},a8_0xb306(_0x24113d,_0x3e6761);}function a8_0x15d3(){const _0x1d4ccb=['152yanEra','../CADViewer_config.json','files','verifyToken','127167yeaaCa','Error!\x20Something\x20went\x20wrong.','reduce','Folder\x20name\x20is\x20required','./uploads/','./uploads','crypto','folderLocation','2MxsaDQ','1603589PnSlHt','/folder','5192aeAmYl','../libs/mysql.js','json','execute','map','mkdirSync','status','originalname','readdirSync','Invalid\x20user','send','302466MZzHCA','forEach','Please\x20upload\x20a\x20file','length','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','log','110358fIbtvI','exports','express','220ZYAmFD','size','80nysGRp','httpStatusCode','848369EzhuPU','12040140vFqrAX','promise','/files','delete','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','path','312uudVsW','existsSync','email','array','25nvrcFh','\x20MB\x20of\x20files','uploads','\x20files','diskStorage','user','Path\x20is\x20required','post','/remove','body'];a8_0x15d3=function(){return _0x1d4ccb;};return a8_0x15d3();}(function(_0x3bb0c1,_0x2e0fa7){const _0x3f05ee=a8_0xb306,_0x1328f6=_0x3bb0c1();while(!![]){try{const _0x589b0b=parseInt(_0x3f05ee(0x1c5))/0x1*(parseInt(_0x3f05ee(0x1e6))/0x2)+-parseInt(_0x3f05ee(0x1de))/0x3*(parseInt(_0x3f05ee(0x1da))/0x4)+parseInt(_0x3f05ee(0x1d0))/0x5*(parseInt(_0x3f05ee(0x1f4))/0x6)+-parseInt(_0x3f05ee(0x1c6))/0x7+parseInt(_0x3f05ee(0x1c3))/0x8*(-parseInt(_0x3f05ee(0x1be))/0x9)+parseInt(_0x3f05ee(0x1c1))/0xa*(parseInt(_0x3f05ee(0x1e9))/0xb)+-parseInt(_0x3f05ee(0x1cc))/0xc*(-parseInt(_0x3f05ee(0x1e7))/0xd);if(_0x589b0b===_0x2e0fa7)break;else _0x1328f6['push'](_0x1328f6['shift']());}catch(_0x1538f0){_0x1328f6['push'](_0x1328f6['shift']());}}}(a8_0x15d3,0xd3134));const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a8_0x3a362e(0x1e4)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x3a362e(0x1db)),conn=require(a8_0x3a362e(0x1ea)),verifyToken=require('../libs/jwt')[a8_0x3a362e(0x1dd)],dir=a8_0x3a362e(0x1e3);!fs[a8_0x3a362e(0x1cd)](dir)&&fs[a8_0x3a362e(0x1ee)](dir);const express=require(a8_0x3a362e(0x1c0)),router=express['Router'](),config=require(a8_0x3a362e(0x1db)),storage=multer[a8_0x3a362e(0x1d4)]({'destination':function(_0x36e09e,_0x3c3b54,_0x5aee2a){const _0x2073bd=a8_0x3a362e;_0x5aee2a(null,_0x2073bd(0x1d2));}}),upload=multer({'storage':storage});router[a8_0x3a362e(0x1d7)](a8_0x3a362e(0x1c8),upload[a8_0x3a362e(0x1cf)]('files'),verifyToken,async(_0x51557f,_0xd11210,_0x5a0479)=>{const _0x5ef303=a8_0x3a362e,_0x293e89=_0x51557f[_0x5ef303(0x1dc)],{global:_0x2aa281,path:_0xab7bf3}=_0x51557f[_0x5ef303(0x1d9)],_0x3e405e=config['folderLocation'];console[_0x5ef303(0x1bd)]({'global':_0x2aa281}),console[_0x5ef303(0x1bd)](_0x293e89),console[_0x5ef303(0x1bd)]({'user':_0x51557f['user']});if(_0x2aa281){_0x293e89['forEach'](_0x529bf2=>{const _0x5758f8=_0x5ef303;fs['renameSync'](_0x529bf2[_0x5758f8(0x1cb)],(_0xab7bf3||_0x3e405e)+'/'+_0x529bf2[_0x5758f8(0x1f0)]);}),_0xd11210[_0x5ef303(0x1f3)]({'files':_0x293e89[_0x5ef303(0x1ed)](_0x547aa3=>({..._0x547aa3,'path':(_0xab7bf3||_0x3e405e)+'/'+_0x547aa3['originalname']}))});return;}let _0x1d041d;try{const [_0x190f9e]=await conn[_0x5ef303(0x1c7)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x51557f[_0x5ef303(0x1d5)][_0x5ef303(0x1ce)]]);_0x190f9e[_0x5ef303(0x1bb)]>0x0&&(_0x1d041d=_0x190f9e[0x0]);}catch(_0x29e551){console[_0x5ef303(0x1bd)]({'err':_0x29e551}),_0xd11210['status'](0x1f4)[_0x5ef303(0x1eb)]({'error':_0x5ef303(0x1df)});return;}if(!_0x1d041d){_0xd11210[_0x5ef303(0x1ef)](0x191)[_0x5ef303(0x1eb)]({'error':_0x5ef303(0x1f2)});return;}let _0x33c9f4=_0x1d041d['folder_name'];if(!_0x33c9f4){_0x33c9f4=randomUUID();try{await conn[_0x5ef303(0x1c7)]()[_0x5ef303(0x1ec)](_0x5ef303(0x1bc),[_0x33c9f4,_0x51557f[_0x5ef303(0x1d5)][_0x5ef303(0x1ce)]]);}catch(_0x5e0d88){console[_0x5ef303(0x1bd)]({'err':_0x5e0d88}),_0xd11210['status'](0x1f4)[_0x5ef303(0x1eb)]({'error':_0x5ef303(0x1df)});return;}}const _0x1aaa93=_0x5ef303(0x1e2)+_0x33c9f4;!fs[_0x5ef303(0x1cd)](_0x1aaa93)&&fs['mkdirSync'](_0x1aaa93);if(!_0x293e89){const _0x24b3c6=new Error(_0x5ef303(0x1f6));return _0x24b3c6[_0x5ef303(0x1c4)]=0x190,_0x5a0479(_0x24b3c6);}const _0xd8a944=fs['readdirSync'](_0x1aaa93)[_0x5ef303(0x1bb)]+_0x293e89['length'];console[_0x5ef303(0x1bd)]({'numberOfSize':_0xd8a944});if(_0xd8a944>userFolderMaximumFiles)return _0xd11210[_0x5ef303(0x1ef)](0x190)[_0x5ef303(0x1eb)]({'error':_0x5ef303(0x1ca)+userFolderMaximumFiles+_0x5ef303(0x1d3)});const _0x496efa=fs[_0x5ef303(0x1f1)](_0x1aaa93)[_0x5ef303(0x1e0)]((_0xf34f13,_0xd123fb)=>_0xf34f13+fs['statSync'](_0x1aaa93+'/'+_0xd123fb)[_0x5ef303(0x1c2)],0x0),_0x52d975=_0x293e89[_0x5ef303(0x1e0)]((_0x49878a,_0x4f7537)=>_0x49878a+_0x4f7537[_0x5ef303(0x1c2)],0x0);console[_0x5ef303(0x1bd)]({'totalSize':_0x496efa,'uploadedSize':_0x52d975});if(_0x52d975+_0x496efa>userFolderMaximumSizeInMB*0x400*0x400)return _0xd11210['status'](0x190)['json']({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+_0x5ef303(0x1d1)});_0x293e89[_0x5ef303(0x1f5)](_0x227e1=>{const _0x42f3fe=_0x5ef303;fs['renameSync'](_0x227e1[_0x42f3fe(0x1cb)],_0x1aaa93+'/'+_0x227e1[_0x42f3fe(0x1f0)]);}),_0xd11210[_0x5ef303(0x1f3)]({'files':_0x293e89[_0x5ef303(0x1ed)](_0x270678=>({..._0x270678,'path':_0x1aaa93+'/'+_0x270678[_0x5ef303(0x1f0)]}))});}),router[a8_0x3a362e(0x1d7)](a8_0x3a362e(0x1e8),verifyToken,async(_0x44ebdd,_0x38f972)=>{const _0x47991e=a8_0x3a362e,{path:_0x2ccfec,folder_name:_0x58445f}=_0x44ebdd[_0x47991e(0x1d9)],_0x4538ae=config[_0x47991e(0x1e5)];console[_0x47991e(0x1bd)]({'path':_0x2ccfec,'folder_name':_0x58445f});if(!_0x2ccfec)return _0x38f972[_0x47991e(0x1ef)](0x190)['json']({'error':_0x47991e(0x1d6)});if(!_0x58445f)return _0x38f972[_0x47991e(0x1ef)](0x190)[_0x47991e(0x1eb)]({'error':_0x47991e(0x1e1)});const _0x301a2=_0x2ccfec+'/'+_0x58445f;!fs[_0x47991e(0x1cd)](_0x301a2)&&fs[_0x47991e(0x1ee)](_0x301a2),_0x38f972['send']({'path':_0x301a2});}),router[a8_0x3a362e(0x1c9)](a8_0x3a362e(0x1d8),verifyToken,async(_0x12ae41,_0x413175)=>{const _0x524750=a8_0x3a362e,{isFolder:_0x6cc8c7,path:_0x42d495}=_0x12ae41['body'];!_0x6cc8c7?fs['unlinkSync'](_0x42d495):fs['rmdirSync'](_0x42d495,{'recursive':!![]}),_0x413175[_0x524750(0x1f3)]({'success':!![]});}),module[a8_0x3a362e(0x1bf)]=router;