const a8_0x7135a9=a8_0x5718;(function(_0x5c3ef2,_0x499882){const _0x41a7ea=a8_0x5718,_0x537988=_0x5c3ef2();while(!![]){try{const _0x2ec9f3=parseInt(_0x41a7ea(0x8f))/0x1+-parseInt(_0x41a7ea(0xb0))/0x2+parseInt(_0x41a7ea(0x96))/0x3*(-parseInt(_0x41a7ea(0xa6))/0x4)+-parseInt(_0x41a7ea(0x84))/0x5*(-parseInt(_0x41a7ea(0xb2))/0x6)+-parseInt(_0x41a7ea(0xaf))/0x7+-parseInt(_0x41a7ea(0xa9))/0x8+parseInt(_0x41a7ea(0xaa))/0x9;if(_0x2ec9f3===_0x499882)break;else _0x537988['push'](_0x537988['shift']());}catch(_0x166f5c){_0x537988['push'](_0x537988['shift']());}}}(a8_0x5290,0x1fe19));const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a8_0x7135a9(0xa0)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x7135a9(0x97)),conn=require('../libs/mysql.js'),verifyToken=require(a8_0x7135a9(0x8a))[a8_0x7135a9(0x8b)],dir='./uploads';function a8_0x5718(_0xe09a2b,_0x32688b){const _0x5290f6=a8_0x5290();return a8_0x5718=function(_0x5718b0,_0x5ebfb8){_0x5718b0=_0x5718b0-0x81;let _0x16a894=_0x5290f6[_0x5718b0];return _0x16a894;},a8_0x5718(_0xe09a2b,_0x32688b);}!fs[a8_0x7135a9(0x9a)](dir)&&fs['mkdirSync'](dir);const express=require('express'),router=express['Router'](),config=require(a8_0x7135a9(0x97)),storage=multer['diskStorage']({'destination':function(_0x288cc4,_0x3fd42f,_0x51fcfe){_0x51fcfe(null,'uploads');}}),upload=multer({'storage':storage});function a8_0x5290(){const _0x580cc1=['Path\x20is\x20required','1776640nxIjpH','6435072euZEHN','log','Please\x20upload\x20a\x20file','folderLocation','send','1802178CVHyeU','291608HukzWz','size','1116nqJHLN','body','length','map','940QPzTGA','Invalid\x20user','originalname','json','execute','renameSync','../libs/jwt','verifyToken','Folder\x20name\x20is\x20required','exports','/remove','220887dsYTRq','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','array','folder_name','readdirSync','unlinkSync','user','6NQXjGT','../CADViewer_config.json','path','statSync','existsSync','post','mkdirSync','delete','Error!\x20Something\x20went\x20wrong.','forEach','crypto','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','reduce','files','email','status','429880OcxEmk','promise'];a8_0x5290=function(){return _0x580cc1;};return a8_0x5290();}router[a8_0x7135a9(0x9b)]('/files',upload[a8_0x7135a9(0x91)](a8_0x7135a9(0xa3)),verifyToken,async(_0x330605,_0x22f5d6,_0x17e082)=>{const _0x379cb4=a8_0x7135a9,_0x17f347=_0x330605[_0x379cb4(0xa3)],{global:_0x1f0630,path:_0x36c414}=_0x330605[_0x379cb4(0x81)],_0x57df1e=config[_0x379cb4(0xad)];console['log']({'global':_0x1f0630}),console[_0x379cb4(0xab)](_0x17f347),console[_0x379cb4(0xab)]({'user':_0x330605[_0x379cb4(0x95)]});if(_0x1f0630){_0x17f347[_0x379cb4(0x9f)](_0x202e7d=>{const _0x168677=_0x379cb4;fs[_0x168677(0x89)](_0x202e7d[_0x168677(0x98)],(_0x36c414||_0x57df1e)+'/'+_0x202e7d[_0x168677(0x86)]);}),_0x22f5d6[_0x379cb4(0xae)]({'files':_0x17f347[_0x379cb4(0x83)](_0x17c0b7=>({..._0x17c0b7,'path':(_0x36c414||_0x57df1e)+'/'+_0x17c0b7[_0x379cb4(0x86)]}))});return;}let _0x2f5bd0;try{const [_0x45d173]=await conn[_0x379cb4(0xa7)]()[_0x379cb4(0x88)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x330605[_0x379cb4(0x95)][_0x379cb4(0xa4)]]);_0x45d173[_0x379cb4(0x82)]>0x0&&(_0x2f5bd0=_0x45d173[0x0]);}catch(_0xdc78df){console[_0x379cb4(0xab)]({'err':_0xdc78df}),_0x22f5d6[_0x379cb4(0xa5)](0x1f4)[_0x379cb4(0x87)]({'error':_0x379cb4(0x9e)});return;}if(!_0x2f5bd0){_0x22f5d6[_0x379cb4(0xa5)](0x191)['json']({'error':_0x379cb4(0x85)});return;}let _0x2fc9bc=_0x2f5bd0[_0x379cb4(0x92)];if(!_0x2fc9bc){_0x2fc9bc=randomUUID();try{await conn[_0x379cb4(0xa7)]()['execute'](_0x379cb4(0x90),[_0x2fc9bc,_0x330605[_0x379cb4(0x95)][_0x379cb4(0xa4)]]);}catch(_0x427e63){console[_0x379cb4(0xab)]({'err':_0x427e63}),_0x22f5d6[_0x379cb4(0xa5)](0x1f4)['json']({'error':_0x379cb4(0x9e)});return;}}const _0x156f8b='./uploads/'+_0x2fc9bc;!fs[_0x379cb4(0x9a)](_0x156f8b)&&fs[_0x379cb4(0x9c)](_0x156f8b);if(!_0x17f347){const _0x5f52b8=new Error(_0x379cb4(0xac));return _0x5f52b8['httpStatusCode']=0x190,_0x17e082(_0x5f52b8);}const _0x379098=fs[_0x379cb4(0x93)](_0x156f8b)[_0x379cb4(0x82)]+_0x17f347[_0x379cb4(0x82)];console['log']({'numberOfSize':_0x379098});if(_0x379098>userFolderMaximumFiles)return _0x22f5d6[_0x379cb4(0xa5)](0x190)[_0x379cb4(0x87)]({'error':_0x379cb4(0xa1)+userFolderMaximumFiles+'\x20files'});const _0x475897=fs['readdirSync'](_0x156f8b)[_0x379cb4(0xa2)]((_0x2e17c3,_0x2ff34e)=>_0x2e17c3+fs[_0x379cb4(0x99)](_0x156f8b+'/'+_0x2ff34e)[_0x379cb4(0xb1)],0x0),_0x1b0d67=_0x17f347[_0x379cb4(0xa2)]((_0x16c979,_0x1d878b)=>_0x16c979+_0x1d878b[_0x379cb4(0xb1)],0x0);console[_0x379cb4(0xab)]({'totalSize':_0x475897,'uploadedSize':_0x1b0d67});if(_0x1b0d67+_0x475897>userFolderMaximumSizeInMB*0x400*0x400)return _0x22f5d6[_0x379cb4(0xa5)](0x190)[_0x379cb4(0x87)]({'error':_0x379cb4(0xa1)+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x17f347[_0x379cb4(0x9f)](_0x564eea=>{const _0xb03590=_0x379cb4;fs[_0xb03590(0x89)](_0x564eea['path'],_0x156f8b+'/'+_0x564eea[_0xb03590(0x86)]);}),_0x22f5d6[_0x379cb4(0xae)]({'files':_0x17f347[_0x379cb4(0x83)](_0x29278a=>({..._0x29278a,'path':_0x156f8b+'/'+_0x29278a[_0x379cb4(0x86)]}))});}),router['post']('/folder',verifyToken,async(_0x1037fe,_0x2dfcf9)=>{const _0x154866=a8_0x7135a9,{path:_0x55502c,folder_name:_0x4f2d7d}=_0x1037fe[_0x154866(0x81)],_0x5cf183=config[_0x154866(0xad)];console['log']({'path':_0x55502c,'folder_name':_0x4f2d7d});if(!_0x55502c)return _0x2dfcf9[_0x154866(0xa5)](0x190)[_0x154866(0x87)]({'error':_0x154866(0xa8)});if(!_0x4f2d7d)return _0x2dfcf9[_0x154866(0xa5)](0x190)[_0x154866(0x87)]({'error':_0x154866(0x8c)});const _0x52884f=_0x55502c+'/'+_0x4f2d7d;!fs[_0x154866(0x9a)](_0x52884f)&&fs['mkdirSync'](_0x52884f),_0x2dfcf9[_0x154866(0xae)]({'path':_0x52884f});}),router[a8_0x7135a9(0x9d)](a8_0x7135a9(0x8e),verifyToken,async(_0x3e9671,_0x12c163)=>{const _0x1d4279=a8_0x7135a9,{isFolder:_0x3dbb30,path:_0x540f73}=_0x3e9671[_0x1d4279(0x81)];!_0x3dbb30?fs[_0x1d4279(0x94)](_0x540f73):fs['rmdirSync'](_0x540f73,{'recursive':!![]}),_0x12c163[_0x1d4279(0xae)]({'success':!![]});}),module[a8_0x7135a9(0x8d)]=router;