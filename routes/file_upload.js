const a8_0x1dfa27=a8_0x1061;(function(_0x237d26,_0x1e7b47){const _0x354fd3=a8_0x1061,_0x4dc3c5=_0x237d26();while(!![]){try{const _0x24a24d=parseInt(_0x354fd3(0x114))/0x1*(-parseInt(_0x354fd3(0xfb))/0x2)+parseInt(_0x354fd3(0x11b))/0x3+parseInt(_0x354fd3(0xf2))/0x4*(-parseInt(_0x354fd3(0x120))/0x5)+-parseInt(_0x354fd3(0xfa))/0x6*(parseInt(_0x354fd3(0x110))/0x7)+-parseInt(_0x354fd3(0x11e))/0x8+-parseInt(_0x354fd3(0xff))/0x9*(-parseInt(_0x354fd3(0xf9))/0xa)+parseInt(_0x354fd3(0x125))/0xb;if(_0x24a24d===_0x1e7b47)break;else _0x4dc3c5['push'](_0x4dc3c5['shift']());}catch(_0x19fc98){_0x4dc3c5['push'](_0x4dc3c5['shift']());}}}(a8_0x1825,0x7c67d));function a8_0x1061(_0x1b04bf,_0x246f61){const _0x1825fb=a8_0x1825();return a8_0x1061=function(_0x106166,_0x45008c){_0x106166=_0x106166-0xec;let _0x39577b=_0x1825fb[_0x106166];return _0x39577b;},a8_0x1061(_0x1b04bf,_0x246f61);}const multer=require(a8_0x1dfa27(0x10d)),fs=require('fs'),{randomUUID}=require(a8_0x1dfa27(0x121)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x1dfa27(0x10a)),conn=require(a8_0x1dfa27(0x102)),verifyToken=require(a8_0x1dfa27(0xf8))[a8_0x1dfa27(0xef)],dir=a8_0x1dfa27(0x119);function a8_0x1825(){const _0x2df6fc=['6114Fvooay','218MXUprc','send','path','/files','90soWPdU','log','Path\x20is\x20required','../libs/mysql.js','Error!\x20Something\x20went\x20wrong.','mkdirSync','unlinkSync','statSync','Folder\x20name\x20is\x20required','folderLocation','email','../CADViewer_config.json','copyFileSync','delete','multer','size','readdirSync','4557dZLCkB','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','length','post','2333eFdehL','status','/remove','\x20MB\x20of\x20files','execute','./uploads','existsSync','1386171ZFNYUt','user','rmdirSync','5648096zdNgqL','reduce','145UZAjHL','crypto','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','./uploads/','diskStorage','16531559uRTRjf','json','express','body','array','verifyToken','uploads','map','82468NpfcHB','originalname','files','exports','promise','forEach','../libs/jwt','766210EjRTsG'];a8_0x1825=function(){return _0x2df6fc;};return a8_0x1825();}!fs['existsSync'](dir)&&fs['mkdirSync'](dir);const express=require(a8_0x1dfa27(0xec)),router=express['Router'](),config=require('../CADViewer_config.json'),storage=multer[a8_0x1dfa27(0x124)]({'destination':function(_0x412582,_0x43182e,_0xecf067){const _0x17827d=a8_0x1dfa27;_0xecf067(null,_0x17827d(0xf0));}}),upload=multer({'storage':storage});router[a8_0x1dfa27(0x113)](a8_0x1dfa27(0xfe),upload[a8_0x1dfa27(0xee)](a8_0x1dfa27(0xf4)),verifyToken,async(_0x15b01b,_0x50578c,_0x51e46e)=>{const _0x4d273c=a8_0x1dfa27,_0x3890fd=_0x15b01b[_0x4d273c(0xf4)],{global:_0x538538,path:_0x132e0e}=_0x15b01b[_0x4d273c(0xed)],_0xb5bab6=config[_0x4d273c(0x108)];console[_0x4d273c(0x100)]({'global':_0x538538}),console['log'](_0x3890fd),console['log']({'user':_0x15b01b[_0x4d273c(0x11c)]});if(_0x538538){_0x3890fd[_0x4d273c(0xf7)](_0x129418=>{const _0x10c8d0=_0x4d273c;fs[_0x10c8d0(0x10b)](_0x129418['path'],(_0x132e0e||_0xb5bab6)+'/'+_0x129418['originalname']),fs['unlinkSync'](_0x129418['path']);}),_0x50578c['send']({'files':_0x3890fd[_0x4d273c(0xf1)](_0x429379=>({..._0x429379,'path':(_0x132e0e||_0xb5bab6)+'/'+_0x429379[_0x4d273c(0xf3)]}))});return;}let _0x42d6f6;try{const [_0x4114fa]=await conn[_0x4d273c(0xf6)]()[_0x4d273c(0x118)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x15b01b[_0x4d273c(0x11c)][_0x4d273c(0x109)]]);_0x4114fa[_0x4d273c(0x112)]>0x0&&(_0x42d6f6=_0x4114fa[0x0]);}catch(_0x566d14){console[_0x4d273c(0x100)]({'err':_0x566d14}),_0x50578c[_0x4d273c(0x115)](0x1f4)[_0x4d273c(0x126)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x42d6f6){_0x50578c[_0x4d273c(0x115)](0x191)[_0x4d273c(0x126)]({'error':'Invalid\x20user'});return;}let _0x45141c=_0x42d6f6['folder_name'];if(!_0x45141c){_0x45141c=randomUUID();try{await conn['promise']()[_0x4d273c(0x118)](_0x4d273c(0x122),[_0x45141c,_0x15b01b['user'][_0x4d273c(0x109)]]);}catch(_0x3dd084){console['log']({'err':_0x3dd084}),_0x50578c[_0x4d273c(0x115)](0x1f4)[_0x4d273c(0x126)]({'error':_0x4d273c(0x103)});return;}}const _0x12a38f=_0x4d273c(0x123)+_0x45141c;!fs[_0x4d273c(0x11a)](_0x12a38f)&&fs[_0x4d273c(0x104)](_0x12a38f);if(!_0x3890fd){const _0x2b949f=new Error('Please\x20upload\x20a\x20file');return _0x2b949f['httpStatusCode']=0x190,_0x51e46e(_0x2b949f);}const _0x2b3dc9=fs[_0x4d273c(0x10f)](_0x12a38f)['length']+_0x3890fd[_0x4d273c(0x112)];console[_0x4d273c(0x100)]({'numberOfSize':_0x2b3dc9});if(_0x2b3dc9>userFolderMaximumFiles)return _0x50578c['status'](0x190)['json']({'error':_0x4d273c(0x111)+userFolderMaximumFiles+'\x20files'});const _0x2cf526=fs['readdirSync'](_0x12a38f)[_0x4d273c(0x11f)]((_0x17e8aa,_0x1677c5)=>_0x17e8aa+fs[_0x4d273c(0x106)](_0x12a38f+'/'+_0x1677c5)[_0x4d273c(0x10e)],0x0),_0x27fc57=_0x3890fd[_0x4d273c(0x11f)]((_0x578af,_0x314d9a)=>_0x578af+_0x314d9a[_0x4d273c(0x10e)],0x0);console[_0x4d273c(0x100)]({'totalSize':_0x2cf526,'uploadedSize':_0x27fc57});if(_0x27fc57+_0x2cf526>userFolderMaximumSizeInMB*0x400*0x400)return _0x50578c[_0x4d273c(0x115)](0x190)[_0x4d273c(0x126)]({'error':_0x4d273c(0x111)+userFolderMaximumSizeInMB+_0x4d273c(0x117)});_0x3890fd['forEach'](_0x581a75=>{const _0x390ef5=_0x4d273c;fs[_0x390ef5(0x10b)](_0x581a75[_0x390ef5(0xfd)],_0x12a38f+'/'+_0x581a75['originalname']),fs[_0x390ef5(0x105)](_0x581a75[_0x390ef5(0xfd)]);}),_0x50578c['send']({'files':_0x3890fd[_0x4d273c(0xf1)](_0x50381c=>({..._0x50381c,'path':_0x12a38f+'/'+_0x50381c[_0x4d273c(0xf3)]}))});}),router['post']('/folder',verifyToken,async(_0xc73d13,_0x23ce10)=>{const _0x531615=a8_0x1dfa27,{path:_0x25b47c,folder_name:_0x1b5e53}=_0xc73d13[_0x531615(0xed)];console['log']({'path':_0x25b47c,'folder_name':_0x1b5e53});if(!_0x25b47c)return _0x23ce10['status'](0x190)[_0x531615(0x126)]({'error':_0x531615(0x101)});if(!_0x1b5e53)return _0x23ce10[_0x531615(0x115)](0x190)['json']({'error':_0x531615(0x107)});const _0x359952=_0x25b47c+'/'+_0x1b5e53;!fs['existsSync'](_0x359952)&&fs['mkdirSync'](_0x359952),_0x23ce10['send']({'path':_0x359952});}),router[a8_0x1dfa27(0x10c)](a8_0x1dfa27(0x116),verifyToken,async(_0x32add4,_0x4fc829)=>{const _0x13f74e=a8_0x1dfa27,{isFolder:_0x3698b5,path:_0x58d1d9}=_0x32add4[_0x13f74e(0xed)];!_0x3698b5?fs[_0x13f74e(0x105)](_0x58d1d9):fs[_0x13f74e(0x11d)](_0x58d1d9,{'recursive':!![]}),_0x4fc829[_0x13f74e(0xfc)]({'success':!![]});}),module[a8_0x1dfa27(0xf5)]=router;