const a8_0x540466=a8_0x58fd;(function(_0xd3d5f,_0x3a0c3f){const _0x3003d3=a8_0x58fd,_0x1738a4=_0xd3d5f();while(!![]){try{const _0x52fccd=-parseInt(_0x3003d3(0x180))/0x1*(parseInt(_0x3003d3(0x1b0))/0x2)+parseInt(_0x3003d3(0x1a2))/0x3+parseInt(_0x3003d3(0x17f))/0x4+-parseInt(_0x3003d3(0x19c))/0x5*(-parseInt(_0x3003d3(0x1a4))/0x6)+parseInt(_0x3003d3(0x1af))/0x7+-parseInt(_0x3003d3(0x195))/0x8*(-parseInt(_0x3003d3(0x191))/0x9)+-parseInt(_0x3003d3(0x185))/0xa;if(_0x52fccd===_0x3a0c3f)break;else _0x1738a4['push'](_0x1738a4['shift']());}catch(_0x3b6cc5){_0x1738a4['push'](_0x1738a4['shift']());}}}(a8_0x3836,0xeac22));const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a8_0x540466(0x1b5)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x540466(0x193)),conn=require(a8_0x540466(0x1a0)),verifyToken=require(a8_0x540466(0x198))['verifyToken'],dir=a8_0x540466(0x197);function a8_0x58fd(_0x1b9716,_0x2e2eda){const _0x3836a5=a8_0x3836();return a8_0x58fd=function(_0x58fd04,_0xc1ec4c){_0x58fd04=_0x58fd04-0x17d;let _0x39a72=_0x3836a5[_0x58fd04];return _0x39a72;},a8_0x58fd(_0x1b9716,_0x2e2eda);}!fs[a8_0x540466(0x183)](dir)&&fs[a8_0x540466(0x1b4)](dir);const express=require(a8_0x540466(0x1ad)),router=express['Router'](),config=require('../CADViewer_config.json'),storage=multer[a8_0x540466(0x1a6)]({'destination':function(_0x3d6d3f,_0x27792a,_0x545b5e){const _0x388a6c=a8_0x540466;_0x545b5e(null,_0x388a6c(0x1ac));}}),upload=multer({'storage':storage});router[a8_0x540466(0x1a5)](a8_0x540466(0x1a1),upload[a8_0x540466(0x1a9)](a8_0x540466(0x1a3)),verifyToken,async(_0x557896,_0x5c86bf,_0x382a7b)=>{const _0x1cb121=a8_0x540466,_0x3a173a=_0x557896['files'],{global:_0x375aa1,path:_0x977f80}=_0x557896[_0x1cb121(0x19b)],_0x12b1f6=config[_0x1cb121(0x19f)];console[_0x1cb121(0x18b)]({'global':_0x375aa1}),console[_0x1cb121(0x18b)](_0x3a173a),console[_0x1cb121(0x18b)]({'user':_0x557896[_0x1cb121(0x17d)]});if(_0x375aa1){_0x3a173a[_0x1cb121(0x189)](_0x4dd78a=>{const _0x13591e=_0x1cb121;fs[_0x13591e(0x192)](_0x4dd78a['path'],(_0x977f80||_0x12b1f6)+'/'+_0x4dd78a['originalname']),fs[_0x13591e(0x19d)](_0x4dd78a[_0x13591e(0x18c)]);}),_0x5c86bf[_0x1cb121(0x190)]({'files':_0x3a173a[_0x1cb121(0x1a8)](_0x5ed711=>({..._0x5ed711,'path':(_0x977f80||_0x12b1f6)+'/'+_0x5ed711[_0x1cb121(0x1ab)]}))});return;}let _0x5d1db1;try{const [_0x14fdca]=await conn[_0x1cb121(0x1b3)]()[_0x1cb121(0x188)](_0x1cb121(0x184),[_0x557896[_0x1cb121(0x17d)][_0x1cb121(0x187)]]);_0x14fdca[_0x1cb121(0x1b6)]>0x0&&(_0x5d1db1=_0x14fdca[0x0]);}catch(_0x6970c1){console[_0x1cb121(0x18b)]({'err':_0x6970c1}),_0x5c86bf[_0x1cb121(0x1ae)](0x1f4)[_0x1cb121(0x181)]({'error':_0x1cb121(0x194)});return;}if(!_0x5d1db1){_0x5c86bf[_0x1cb121(0x1ae)](0x191)[_0x1cb121(0x181)]({'error':'Invalid\x20user'});return;}let _0x1759c1=_0x5d1db1[_0x1cb121(0x1b1)];if(!_0x1759c1){_0x1759c1=randomUUID();try{await conn['promise']()[_0x1cb121(0x188)](_0x1cb121(0x1aa),[_0x1759c1,_0x557896['user']['email']]);}catch(_0x206487){console[_0x1cb121(0x18b)]({'err':_0x206487}),_0x5c86bf[_0x1cb121(0x1ae)](0x1f4)['json']({'error':_0x1cb121(0x194)});return;}}const _0x3b4ab3=_0x1cb121(0x18d)+_0x1759c1;!fs['existsSync'](_0x3b4ab3)&&fs[_0x1cb121(0x1b4)](_0x3b4ab3);if(!_0x3a173a){const _0x4cd541=new Error(_0x1cb121(0x18f));return _0x4cd541[_0x1cb121(0x17e)]=0x190,_0x382a7b(_0x4cd541);}const _0x21babc=fs[_0x1cb121(0x18e)](_0x3b4ab3)[_0x1cb121(0x1b6)]+_0x3a173a[_0x1cb121(0x1b6)];console[_0x1cb121(0x18b)]({'numberOfSize':_0x21babc});if(_0x21babc>userFolderMaximumFiles)return _0x5c86bf[_0x1cb121(0x1ae)](0x190)['json']({'error':_0x1cb121(0x1a7)+userFolderMaximumFiles+'\x20files'});const _0x51f28d=fs[_0x1cb121(0x18e)](_0x3b4ab3)['reduce']((_0x250966,_0x2f0771)=>_0x250966+fs[_0x1cb121(0x19a)](_0x3b4ab3+'/'+_0x2f0771)[_0x1cb121(0x182)],0x0),_0x308493=_0x3a173a['reduce']((_0x5d188d,_0x1eb61b)=>_0x5d188d+_0x1eb61b['size'],0x0);console[_0x1cb121(0x18b)]({'totalSize':_0x51f28d,'uploadedSize':_0x308493});if(_0x308493+_0x51f28d>userFolderMaximumSizeInMB*0x400*0x400)return _0x5c86bf[_0x1cb121(0x1ae)](0x190)[_0x1cb121(0x181)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+_0x1cb121(0x196)});_0x3a173a[_0x1cb121(0x189)](_0x4f9232=>{const _0x19ce9f=_0x1cb121;fs['copyFileSync'](_0x4f9232[_0x19ce9f(0x18c)],_0x3b4ab3+'/'+_0x4f9232[_0x19ce9f(0x1ab)]),fs[_0x19ce9f(0x19d)](_0x4f9232[_0x19ce9f(0x18c)]);}),_0x5c86bf[_0x1cb121(0x190)]({'files':_0x3a173a['map'](_0x1746cc=>({..._0x1746cc,'path':_0x3b4ab3+'/'+_0x1746cc['originalname']}))});}),router[a8_0x540466(0x1a5)](a8_0x540466(0x18a),verifyToken,async(_0x4a2119,_0x3a26bd)=>{const _0x1c05d4=a8_0x540466,{path:_0x4de2ed,folder_name:_0x1312a6}=_0x4a2119[_0x1c05d4(0x19b)];console[_0x1c05d4(0x18b)]({'path':_0x4de2ed,'folder_name':_0x1312a6});if(!_0x4de2ed)return _0x3a26bd[_0x1c05d4(0x1ae)](0x190)[_0x1c05d4(0x181)]({'error':_0x1c05d4(0x199)});if(!_0x1312a6)return _0x3a26bd[_0x1c05d4(0x1ae)](0x190)[_0x1c05d4(0x181)]({'error':'Folder\x20name\x20is\x20required'});const _0x237382=_0x4de2ed+'/'+_0x1312a6;!fs[_0x1c05d4(0x183)](_0x237382)&&fs[_0x1c05d4(0x1b4)](_0x237382),_0x3a26bd[_0x1c05d4(0x190)]({'path':_0x237382});}),router[a8_0x540466(0x1b2)]('/remove',verifyToken,async(_0x5cd388,_0x5965d9)=>{const _0x564ce3=a8_0x540466,{isFolder:_0x4c349e,path:_0x5c866f}=_0x5cd388[_0x564ce3(0x19b)];!_0x4c349e?fs[_0x564ce3(0x19d)](_0x5c866f):fs[_0x564ce3(0x19e)](_0x5c866f,{'recursive':!![]}),_0x5965d9[_0x564ce3(0x190)]({'success':!![]});}),module[a8_0x540466(0x186)]=router;function a8_0x3836(){const _0x5828fb=['1604844HmIrdz','copyFileSync','../CADViewer_config.json','Error!\x20Something\x20went\x20wrong.','48iXzYUQ','\x20MB\x20of\x20files','./uploads','../libs/jwt','Path\x20is\x20required','statSync','body','6780PToeWM','unlinkSync','rmdirSync','folderLocation','../libs/mysql.js','/files','518607lcZjYS','files','6198cbwlKy','post','diskStorage','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','map','array','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','originalname','uploads','express','status','10453814RrqSlg','4XVljrB','folder_name','delete','promise','mkdirSync','crypto','length','user','httpStatusCode','5758156PvUOHJ','576956rpKlyU','json','size','existsSync','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','34609720alxyOM','exports','email','execute','forEach','/folder','log','path','./uploads/','readdirSync','Please\x20upload\x20a\x20file','send'];a8_0x3836=function(){return _0x5828fb;};return a8_0x3836();}