const a8_0x58b819=a8_0x2f5b;(function(_0x3810d3,_0x452cf2){const _0x1b9823=a8_0x2f5b,_0x4c241e=_0x3810d3();while(!![]){try{const _0x2526c9=-parseInt(_0x1b9823(0x82))/0x1*(-parseInt(_0x1b9823(0xa1))/0x2)+parseInt(_0x1b9823(0x79))/0x3+parseInt(_0x1b9823(0x8a))/0x4*(-parseInt(_0x1b9823(0x99))/0x5)+parseInt(_0x1b9823(0x9e))/0x6*(parseInt(_0x1b9823(0xa5))/0x7)+-parseInt(_0x1b9823(0x88))/0x8*(-parseInt(_0x1b9823(0xa6))/0x9)+parseInt(_0x1b9823(0x6f))/0xa*(-parseInt(_0x1b9823(0x94))/0xb)+-parseInt(_0x1b9823(0x93))/0xc;if(_0x2526c9===_0x452cf2)break;else _0x4c241e['push'](_0x4c241e['shift']());}catch(_0x343bdd){_0x4c241e['push'](_0x4c241e['shift']());}}}(a8_0x5447,0xb03f5));function a8_0x5447(){const _0xc57113=['Please\x20upload\x20a\x20file','body','folderLocation','execute','files','multer','email','length','Path\x20is\x20required','1204407XuLZDe','log','\x20MB\x20of\x20files','\x20files','../CADViewer_config.json','statSync','renameSync','unlinkSync','httpStatusCode','6wSUbDW','mkdirSync','status','Router','verifyToken','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','456UvRIqT','existsSync','12qoEDeo','Folder\x20name\x20is\x20required','send','/remove','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','user','../libs/jwt','json','originalname','12125712cTakPQ','55GWoRlD','exports','/files','promise','Error!\x20Something\x20went\x20wrong.','304445BtZpzT','map','Invalid\x20user','size','forEach','66xaZXZG','reduce','post','280698MaqISh','delete','./uploads','folder_name','376789semtbh','181449xMcyYH','rmdirSync','path','2139570nvSqPU'];a8_0x5447=function(){return _0xc57113;};return a8_0x5447();}const multer=require(a8_0x58b819(0x75)),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x58b819(0x7d)),conn=require('../libs/mysql.js'),verifyToken=require(a8_0x58b819(0x90))[a8_0x58b819(0x86)],dir=a8_0x58b819(0xa3);!fs[a8_0x58b819(0x89)](dir)&&fs[a8_0x58b819(0x83)](dir);function a8_0x2f5b(_0x2a5ecd,_0x1970b6){const _0x5447ca=a8_0x5447();return a8_0x2f5b=function(_0x2f5bdf,_0x1d8174){_0x2f5bdf=_0x2f5bdf-0x6d;let _0x456651=_0x5447ca[_0x2f5bdf];return _0x456651;},a8_0x2f5b(_0x2a5ecd,_0x1970b6);}const express=require('express'),router=express[a8_0x58b819(0x85)](),config=require('../CADViewer_config.json'),storage=multer['diskStorage']({'destination':function(_0x5658b4,_0x51a2c9,_0x2e50bb){_0x2e50bb(null,'uploads');}}),upload=multer({'storage':storage});router[a8_0x58b819(0xa0)](a8_0x58b819(0x96),upload['array'](a8_0x58b819(0x74)),verifyToken,async(_0x292202,_0x4f6875,_0x2104c8)=>{const _0x1ee07e=a8_0x58b819,_0x772e94=_0x292202['files'],{global:_0x3cf608,path:_0x226aa6}=_0x292202['body'],_0x104718=config['folderLocation'];console['log']({'global':_0x3cf608}),console[_0x1ee07e(0x7a)](_0x772e94),console[_0x1ee07e(0x7a)]({'user':_0x292202['user']});if(_0x3cf608){_0x772e94[_0x1ee07e(0x9d)](_0x2326e6=>{const _0x1bff0f=_0x1ee07e;fs[_0x1bff0f(0x7f)](_0x2326e6[_0x1bff0f(0x6e)],(_0x226aa6||_0x104718)+'/'+_0x2326e6[_0x1bff0f(0x92)]);}),_0x4f6875[_0x1ee07e(0x8c)]({'files':_0x772e94[_0x1ee07e(0x9a)](_0xad3fa6=>({..._0xad3fa6,'path':(_0x226aa6||_0x104718)+'/'+_0xad3fa6[_0x1ee07e(0x92)]}))});return;}let _0x9b70fd;try{const [_0x114b7f]=await conn[_0x1ee07e(0x97)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x292202[_0x1ee07e(0x8f)]['email']]);_0x114b7f[_0x1ee07e(0x77)]>0x0&&(_0x9b70fd=_0x114b7f[0x0]);}catch(_0xcf6c3d){console[_0x1ee07e(0x7a)]({'err':_0xcf6c3d}),_0x4f6875['status'](0x1f4)['json']({'error':_0x1ee07e(0x98)});return;}if(!_0x9b70fd){_0x4f6875[_0x1ee07e(0x84)](0x191)['json']({'error':_0x1ee07e(0x9b)});return;}let _0x56a350=_0x9b70fd[_0x1ee07e(0xa4)];if(!_0x56a350){_0x56a350=randomUUID();try{await conn['promise']()[_0x1ee07e(0x73)](_0x1ee07e(0x8e),[_0x56a350,_0x292202['user'][_0x1ee07e(0x76)]]);}catch(_0x498ceb){console[_0x1ee07e(0x7a)]({'err':_0x498ceb}),_0x4f6875['status'](0x1f4)[_0x1ee07e(0x91)]({'error':_0x1ee07e(0x98)});return;}}const _0x51ef8e='./uploads/'+_0x56a350;!fs[_0x1ee07e(0x89)](_0x51ef8e)&&fs[_0x1ee07e(0x83)](_0x51ef8e);if(!_0x772e94){const _0x312f31=new Error(_0x1ee07e(0x70));return _0x312f31[_0x1ee07e(0x81)]=0x190,_0x2104c8(_0x312f31);}const _0x38c0d1=fs['readdirSync'](_0x51ef8e)[_0x1ee07e(0x77)]+_0x772e94[_0x1ee07e(0x77)];console['log']({'numberOfSize':_0x38c0d1});if(_0x38c0d1>userFolderMaximumFiles)return _0x4f6875[_0x1ee07e(0x84)](0x190)[_0x1ee07e(0x91)]({'error':_0x1ee07e(0x87)+userFolderMaximumFiles+_0x1ee07e(0x7c)});const _0x200e53=fs['readdirSync'](_0x51ef8e)[_0x1ee07e(0x9f)]((_0x5e542e,_0x9d3d0f)=>_0x5e542e+fs[_0x1ee07e(0x7e)](_0x51ef8e+'/'+_0x9d3d0f)[_0x1ee07e(0x9c)],0x0),_0x4e6c42=_0x772e94['reduce']((_0x1e2951,_0xc0221b)=>_0x1e2951+_0xc0221b[_0x1ee07e(0x9c)],0x0);console['log']({'totalSize':_0x200e53,'uploadedSize':_0x4e6c42});if(_0x4e6c42+_0x200e53>userFolderMaximumSizeInMB*0x400*0x400)return _0x4f6875[_0x1ee07e(0x84)](0x190)['json']({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+_0x1ee07e(0x7b)});_0x772e94['forEach'](_0xea2f8d=>{const _0x122803=_0x1ee07e;fs[_0x122803(0x7f)](_0xea2f8d[_0x122803(0x6e)],_0x51ef8e+'/'+_0xea2f8d[_0x122803(0x92)]);}),_0x4f6875[_0x1ee07e(0x8c)]({'files':_0x772e94[_0x1ee07e(0x9a)](_0x4c27be=>({..._0x4c27be,'path':_0x51ef8e+'/'+_0x4c27be['originalname']}))});}),router[a8_0x58b819(0xa0)]('/folder',verifyToken,async(_0x2f4d28,_0x269572)=>{const _0x1ae19f=a8_0x58b819,{path:_0x5134ab,folder_name:_0x1fd492}=_0x2f4d28['body'],_0x428304=config[_0x1ae19f(0x72)];console['log']({'path':_0x5134ab,'folder_name':_0x1fd492});if(!_0x5134ab)return _0x269572['status'](0x190)[_0x1ae19f(0x91)]({'error':_0x1ae19f(0x78)});if(!_0x1fd492)return _0x269572[_0x1ae19f(0x84)](0x190)[_0x1ae19f(0x91)]({'error':_0x1ae19f(0x8b)});const _0x51e4ed=_0x5134ab+'/'+_0x1fd492;!fs[_0x1ae19f(0x89)](_0x51e4ed)&&fs[_0x1ae19f(0x83)](_0x51e4ed),_0x269572['send']({'path':_0x51e4ed});}),router[a8_0x58b819(0xa2)](a8_0x58b819(0x8d),verifyToken,async(_0x8df54,_0x2bcd3e)=>{const _0x407b5e=a8_0x58b819,{isFolder:_0x21282a,path:_0x47553a}=_0x8df54[_0x407b5e(0x71)];!_0x21282a?fs[_0x407b5e(0x80)](_0x47553a):fs[_0x407b5e(0x6d)](_0x47553a,{'recursive':!![]}),_0x2bcd3e[_0x407b5e(0x8c)]({'success':!![]});}),module[a8_0x58b819(0x95)]=router;