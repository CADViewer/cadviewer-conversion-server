const a8_0x47bf3c=a8_0x3884;(function(_0x5941ee,_0x5893a5){const _0x478f7b=a8_0x3884,_0x1a2fe8=_0x5941ee();while(!![]){try{const _0x34e0ef=-parseInt(_0x478f7b(0xc4))/0x1+parseInt(_0x478f7b(0xbb))/0x2*(parseInt(_0x478f7b(0xa8))/0x3)+-parseInt(_0x478f7b(0xaa))/0x4*(parseInt(_0x478f7b(0xb4))/0x5)+-parseInt(_0x478f7b(0xb9))/0x6*(parseInt(_0x478f7b(0xb0))/0x7)+parseInt(_0x478f7b(0xab))/0x8*(-parseInt(_0x478f7b(0xc8))/0x9)+-parseInt(_0x478f7b(0xa9))/0xa+parseInt(_0x478f7b(0xd7))/0xb;if(_0x34e0ef===_0x5893a5)break;else _0x1a2fe8['push'](_0x1a2fe8['shift']());}catch(_0x292cff){_0x1a2fe8['push'](_0x1a2fe8['shift']());}}}(a8_0xc56e,0x221ce));const multer=require('multer'),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require('../libs/mysql.js'),verifyToken=require(a8_0x47bf3c(0xd8))[a8_0x47bf3c(0xdc)],dir=a8_0x47bf3c(0xdd);function a8_0xc56e(){const _0xbf45c2=['user','promise','../CADViewer_config.json','214205YtiVRG','reduce','Path\x20is\x20required','/remove','delete','9942JzzqbL','originalname','602Sgwiyh','rmdirSync','diskStorage','size','express','mkdirSync','Folder\x20name\x20is\x20required','folderLocation','./uploads/','75118dJEiWJ','Router','post','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','731376UWmQpV','execute','send','json','files','length','email','status','Error!\x20Something\x20went\x20wrong.','\x20files','log','readdirSync','httpStatusCode','uploads','body','8879915alWQXD','../libs/jwt','/folder','existsSync','\x20MB\x20of\x20files','verifyToken','./uploads','map','unlinkSync','renameSync','399VuWabN','691020jjebdw','4iWWIjr','24KRyCPo','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','folder_name','forEach','path','1169bTCuWH'];a8_0xc56e=function(){return _0xbf45c2;};return a8_0xc56e();}!fs[a8_0x47bf3c(0xda)](dir)&&fs['mkdirSync'](dir);const express=require(a8_0x47bf3c(0xbf)),router=express[a8_0x47bf3c(0xc5)](),config=require(a8_0x47bf3c(0xb3)),storage=multer[a8_0x47bf3c(0xbd)]({'destination':function(_0x102223,_0x50ab65,_0x490502){const _0x24d15b=a8_0x47bf3c;_0x490502(null,_0x24d15b(0xd5));}}),upload=multer({'storage':storage});function a8_0x3884(_0x30a8c5,_0x5569cf){const _0xc56e96=a8_0xc56e();return a8_0x3884=function(_0x388452,_0x5ca390){_0x388452=_0x388452-0xa8;let _0x4d80e7=_0xc56e96[_0x388452];return _0x4d80e7;},a8_0x3884(_0x30a8c5,_0x5569cf);}router[a8_0x47bf3c(0xc6)]('/files',upload['array'](a8_0x47bf3c(0xcc)),verifyToken,async(_0x894da8,_0x2050af,_0x2c1933)=>{const _0x56de29=a8_0x47bf3c,_0x2dfd47=_0x894da8[_0x56de29(0xcc)],{global:_0x4e88b4,path:_0x5c91e6}=_0x894da8[_0x56de29(0xd6)],_0x5e3cdb=config[_0x56de29(0xc2)];console[_0x56de29(0xd2)]({'global':_0x4e88b4}),console['log'](_0x2dfd47),console[_0x56de29(0xd2)]({'user':_0x894da8[_0x56de29(0xb1)]});if(_0x4e88b4){_0x2dfd47[_0x56de29(0xae)](_0x4b0586=>{const _0x299a00=_0x56de29;fs[_0x299a00(0xe0)](_0x4b0586[_0x299a00(0xaf)],(_0x5c91e6||_0x5e3cdb)+'/'+_0x4b0586[_0x299a00(0xba)]);}),_0x2050af['send']({'files':_0x2dfd47[_0x56de29(0xde)](_0xad0d4d=>({..._0xad0d4d,'path':(_0x5c91e6||_0x5e3cdb)+'/'+_0xad0d4d[_0x56de29(0xba)]}))});return;}let _0x5a31d9;try{const [_0x1b48cf]=await conn[_0x56de29(0xb2)]()[_0x56de29(0xc9)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x894da8[_0x56de29(0xb1)][_0x56de29(0xce)]]);_0x1b48cf[_0x56de29(0xcd)]>0x0&&(_0x5a31d9=_0x1b48cf[0x0]);}catch(_0x23e797){console[_0x56de29(0xd2)]({'err':_0x23e797}),_0x2050af[_0x56de29(0xcf)](0x1f4)['json']({'error':_0x56de29(0xd0)});return;}if(!_0x5a31d9){_0x2050af[_0x56de29(0xcf)](0x191)[_0x56de29(0xcb)]({'error':'Invalid\x20user'});return;}let _0x4fd2b8=_0x5a31d9[_0x56de29(0xad)];if(!_0x4fd2b8){_0x4fd2b8=randomUUID();try{await conn['promise']()[_0x56de29(0xc9)](_0x56de29(0xc7),[_0x4fd2b8,_0x894da8[_0x56de29(0xb1)][_0x56de29(0xce)]]);}catch(_0x155026){console[_0x56de29(0xd2)]({'err':_0x155026}),_0x2050af[_0x56de29(0xcf)](0x1f4)[_0x56de29(0xcb)]({'error':_0x56de29(0xd0)});return;}}const _0x14b4fb=_0x56de29(0xc3)+_0x4fd2b8;!fs[_0x56de29(0xda)](_0x14b4fb)&&fs[_0x56de29(0xc0)](_0x14b4fb);if(!_0x2dfd47){const _0x2b5063=new Error('Please\x20upload\x20a\x20file');return _0x2b5063[_0x56de29(0xd4)]=0x190,_0x2c1933(_0x2b5063);}const _0x569d77=fs[_0x56de29(0xd3)](_0x14b4fb)[_0x56de29(0xcd)]+_0x2dfd47[_0x56de29(0xcd)];console[_0x56de29(0xd2)]({'numberOfSize':_0x569d77});if(_0x569d77>userFolderMaximumFiles)return _0x2050af['status'](0x190)['json']({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+_0x56de29(0xd1)});const _0x4fd35e=fs[_0x56de29(0xd3)](_0x14b4fb)[_0x56de29(0xb5)]((_0x1332a1,_0xf11337)=>_0x1332a1+fs['statSync'](_0x14b4fb+'/'+_0xf11337)[_0x56de29(0xbe)],0x0),_0x2f5116=_0x2dfd47[_0x56de29(0xb5)]((_0x581d2a,_0x27182d)=>_0x581d2a+_0x27182d[_0x56de29(0xbe)],0x0);console['log']({'totalSize':_0x4fd35e,'uploadedSize':_0x2f5116});if(_0x2f5116+_0x4fd35e>userFolderMaximumSizeInMB*0x400*0x400)return _0x2050af[_0x56de29(0xcf)](0x190)[_0x56de29(0xcb)]({'error':_0x56de29(0xac)+userFolderMaximumSizeInMB+_0x56de29(0xdb)});_0x2dfd47[_0x56de29(0xae)](_0x1311cd=>{const _0x2b42ad=_0x56de29;fs[_0x2b42ad(0xe0)](_0x1311cd['path'],_0x14b4fb+'/'+_0x1311cd[_0x2b42ad(0xba)]);}),_0x2050af['send']({'files':_0x2dfd47[_0x56de29(0xde)](_0x3cead9=>({..._0x3cead9,'path':_0x14b4fb+'/'+_0x3cead9[_0x56de29(0xba)]}))});}),router[a8_0x47bf3c(0xc6)](a8_0x47bf3c(0xd9),verifyToken,async(_0x532c41,_0x2c52d7)=>{const _0x613ff4=a8_0x47bf3c,{path:_0x486ca7,folder_name:_0x3fba69}=_0x532c41[_0x613ff4(0xd6)],_0x282c61=config['folderLocation'];console[_0x613ff4(0xd2)]({'path':_0x486ca7,'folder_name':_0x3fba69});if(!_0x486ca7)return _0x2c52d7[_0x613ff4(0xcf)](0x190)[_0x613ff4(0xcb)]({'error':_0x613ff4(0xb6)});if(!_0x3fba69)return _0x2c52d7['status'](0x190)[_0x613ff4(0xcb)]({'error':_0x613ff4(0xc1)});const _0x497f8f=_0x486ca7+'/'+_0x3fba69;!fs[_0x613ff4(0xda)](_0x497f8f)&&fs[_0x613ff4(0xc0)](_0x497f8f),_0x2c52d7[_0x613ff4(0xca)]({'path':_0x497f8f});}),router[a8_0x47bf3c(0xb8)](a8_0x47bf3c(0xb7),verifyToken,async(_0x10cfaf,_0x2e6b64)=>{const _0x4e12bb=a8_0x47bf3c,{isFolder:_0x320c58,path:_0x4935ab}=_0x10cfaf[_0x4e12bb(0xd6)];!_0x320c58?fs[_0x4e12bb(0xdf)](_0x4935ab):fs[_0x4e12bb(0xbc)](_0x4935ab,{'recursive':!![]}),_0x2e6b64[_0x4e12bb(0xca)]({'success':!![]});}),module['exports']=router;