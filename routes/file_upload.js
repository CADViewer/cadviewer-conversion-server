const a8_0x55ac16=a8_0x5a06;(function(_0x26651a,_0x236d16){const _0x588f4b=a8_0x5a06,_0x1ad0a8=_0x26651a();while(!![]){try{const _0xa94d=-parseInt(_0x588f4b(0xb7))/0x1*(-parseInt(_0x588f4b(0xbb))/0x2)+parseInt(_0x588f4b(0x8e))/0x3+parseInt(_0x588f4b(0xaf))/0x4*(parseInt(_0x588f4b(0x91))/0x5)+-parseInt(_0x588f4b(0x8c))/0x6*(-parseInt(_0x588f4b(0xa1))/0x7)+-parseInt(_0x588f4b(0x98))/0x8+-parseInt(_0x588f4b(0x8f))/0x9*(-parseInt(_0x588f4b(0xa4))/0xa)+-parseInt(_0x588f4b(0xbd))/0xb;if(_0xa94d===_0x236d16)break;else _0x1ad0a8['push'](_0x1ad0a8['shift']());}catch(_0x213177){_0x1ad0a8['push'](_0x1ad0a8['shift']());}}}(a8_0x4212,0x7e15a));const multer=require(a8_0x55ac16(0xb9)),fs=require('fs'),{randomUUID}=require(a8_0x55ac16(0x97)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require(a8_0x55ac16(0xc0)),verifyToken=require('../libs/jwt')[a8_0x55ac16(0x99)],dir=a8_0x55ac16(0xbe);function a8_0x5a06(_0x30c020,_0x56b38b){const _0x4212e7=a8_0x4212();return a8_0x5a06=function(_0x5a060a,_0x1f489b){_0x5a060a=_0x5a060a-0x8a;let _0x327a93=_0x4212e7[_0x5a060a];return _0x327a93;},a8_0x5a06(_0x30c020,_0x56b38b);}function a8_0x4212(){const _0x56530e=['3725576pBBcom','verifyToken','\x20MB\x20of\x20files','Invalid\x20user','diskStorage','/files','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','unlinkSync','./uploads/','5557517Tnquoa','/remove','send','138190YFWZIv','readdirSync','status','existsSync','rmdirSync','Path\x20is\x20required','Router','log','mkdirSync','reduce','Please\x20upload\x20a\x20file','12aPZqBy','promise','json','array','renameSync','map','forEach','folder_name','881233ZpJqZA','size','multer','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','2WXWisA','execute','25897993pSAEhZ','./uploads','Folder\x20name\x20is\x20required','../libs/mysql.js','\x20files','user','post','length','email','files','delete','body','express','6yrjNAd','originalname','2727756EyjxaM','225Zejcfc','statSync','677685wmpQji','Error!\x20Something\x20went\x20wrong.','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','path','../CADViewer_config.json','folderLocation','crypto'];a8_0x4212=function(){return _0x56530e;};return a8_0x4212();}!fs[a8_0x55ac16(0xa7)](dir)&&fs[a8_0x55ac16(0xac)](dir);const express=require(a8_0x55ac16(0x8b)),router=express[a8_0x55ac16(0xaa)](),config=require(a8_0x55ac16(0x95)),storage=multer[a8_0x55ac16(0x9c)]({'destination':function(_0x1c5f5e,_0x884a7d,_0xa1b59c){_0xa1b59c(null,'uploads');}}),upload=multer({'storage':storage});router['post'](a8_0x55ac16(0x9d),upload[a8_0x55ac16(0xb2)](a8_0x55ac16(0xc6)),verifyToken,async(_0xe176be,_0x1ac540,_0x40fc69)=>{const _0x1b40ed=a8_0x55ac16,_0x56f73c=_0xe176be[_0x1b40ed(0xc6)],{global:_0xd9aed,path:_0x4cb62d}=_0xe176be['body'],_0xc1fb42=config[_0x1b40ed(0x96)];console['log']({'global':_0xd9aed}),console[_0x1b40ed(0xab)](_0x56f73c),console[_0x1b40ed(0xab)]({'user':_0xe176be[_0x1b40ed(0xc2)]});if(_0xd9aed){_0x56f73c[_0x1b40ed(0xb5)](_0x13fc65=>{const _0x28e9d4=_0x1b40ed;fs[_0x28e9d4(0xb3)](_0x13fc65[_0x28e9d4(0x94)],(_0x4cb62d||_0xc1fb42)+'/'+_0x13fc65[_0x28e9d4(0x8d)]);}),_0x1ac540[_0x1b40ed(0xa3)]({'files':_0x56f73c[_0x1b40ed(0xb4)](_0x41c4c5=>({..._0x41c4c5,'path':(_0x4cb62d||_0xc1fb42)+'/'+_0x41c4c5[_0x1b40ed(0x8d)]}))});return;}let _0x5dadf6;try{const [_0x2f4c12]=await conn[_0x1b40ed(0xb0)]()['execute'](_0x1b40ed(0xba),[_0xe176be[_0x1b40ed(0xc2)][_0x1b40ed(0xc5)]]);_0x2f4c12[_0x1b40ed(0xc4)]>0x0&&(_0x5dadf6=_0x2f4c12[0x0]);}catch(_0x5c2de7){console[_0x1b40ed(0xab)]({'err':_0x5c2de7}),_0x1ac540['status'](0x1f4)[_0x1b40ed(0xb1)]({'error':_0x1b40ed(0x92)});return;}if(!_0x5dadf6){_0x1ac540['status'](0x191)['json']({'error':_0x1b40ed(0x9b)});return;}let _0x4bee2e=_0x5dadf6[_0x1b40ed(0xb6)];if(!_0x4bee2e){_0x4bee2e=randomUUID();try{await conn[_0x1b40ed(0xb0)]()[_0x1b40ed(0xbc)](_0x1b40ed(0x9e),[_0x4bee2e,_0xe176be[_0x1b40ed(0xc2)][_0x1b40ed(0xc5)]]);}catch(_0x49de8e){console[_0x1b40ed(0xab)]({'err':_0x49de8e}),_0x1ac540['status'](0x1f4)[_0x1b40ed(0xb1)]({'error':_0x1b40ed(0x92)});return;}}const _0x3ea011=_0x1b40ed(0xa0)+_0x4bee2e;!fs[_0x1b40ed(0xa7)](_0x3ea011)&&fs['mkdirSync'](_0x3ea011);if(!_0x56f73c){const _0x47e5da=new Error(_0x1b40ed(0xae));return _0x47e5da['httpStatusCode']=0x190,_0x40fc69(_0x47e5da);}const _0x287be6=fs[_0x1b40ed(0xa5)](_0x3ea011)['length']+_0x56f73c[_0x1b40ed(0xc4)];console[_0x1b40ed(0xab)]({'numberOfSize':_0x287be6});if(_0x287be6>userFolderMaximumFiles)return _0x1ac540[_0x1b40ed(0xa6)](0x190)[_0x1b40ed(0xb1)]({'error':_0x1b40ed(0x93)+userFolderMaximumFiles+_0x1b40ed(0xc1)});const _0x139186=fs['readdirSync'](_0x3ea011)[_0x1b40ed(0xad)]((_0x5da7b9,_0x560e09)=>_0x5da7b9+fs[_0x1b40ed(0x90)](_0x3ea011+'/'+_0x560e09)['size'],0x0),_0x4b89bd=_0x56f73c[_0x1b40ed(0xad)]((_0x460deb,_0x5d5689)=>_0x460deb+_0x5d5689[_0x1b40ed(0xb8)],0x0);console['log']({'totalSize':_0x139186,'uploadedSize':_0x4b89bd});if(_0x4b89bd+_0x139186>userFolderMaximumSizeInMB*0x400*0x400)return _0x1ac540[_0x1b40ed(0xa6)](0x190)[_0x1b40ed(0xb1)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+_0x1b40ed(0x9a)});_0x56f73c[_0x1b40ed(0xb5)](_0x1a471d=>{const _0x59d691=_0x1b40ed;fs['renameSync'](_0x1a471d[_0x59d691(0x94)],_0x3ea011+'/'+_0x1a471d[_0x59d691(0x8d)]);}),_0x1ac540[_0x1b40ed(0xa3)]({'files':_0x56f73c[_0x1b40ed(0xb4)](_0x177115=>({..._0x177115,'path':_0x3ea011+'/'+_0x177115['originalname']}))});}),router[a8_0x55ac16(0xc3)]('/folder',verifyToken,async(_0x5c227e,_0x91b5b0)=>{const _0x1a87fe=a8_0x55ac16,{path:_0x1a8f5b,folder_name:_0x5f1de1}=_0x5c227e[_0x1a87fe(0x8a)],_0x4bfe4b=config[_0x1a87fe(0x96)];console[_0x1a87fe(0xab)]({'path':_0x1a8f5b,'folder_name':_0x5f1de1});if(!_0x1a8f5b)return _0x91b5b0[_0x1a87fe(0xa6)](0x190)[_0x1a87fe(0xb1)]({'error':_0x1a87fe(0xa9)});if(!_0x5f1de1)return _0x91b5b0['status'](0x190)[_0x1a87fe(0xb1)]({'error':_0x1a87fe(0xbf)});const _0x3496ed=_0x1a8f5b+'/'+_0x5f1de1;!fs[_0x1a87fe(0xa7)](_0x3496ed)&&fs[_0x1a87fe(0xac)](_0x3496ed),_0x91b5b0['send']({'path':_0x3496ed});}),router[a8_0x55ac16(0xc7)](a8_0x55ac16(0xa2),verifyToken,async(_0x174f52,_0xe5687e)=>{const _0x3e0936=a8_0x55ac16,{isFolder:_0x492e9d,path:_0x49e040}=_0x174f52[_0x3e0936(0x8a)];!_0x492e9d?fs[_0x3e0936(0x9f)](_0x49e040):fs[_0x3e0936(0xa8)](_0x49e040,{'recursive':!![]}),_0xe5687e[_0x3e0936(0xa3)]({'success':!![]});}),module['exports']=router;