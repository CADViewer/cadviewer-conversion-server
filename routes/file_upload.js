const a8_0x2dbe10=a8_0x3fdc;(function(_0x2bcb3e,_0x56e207){const _0xec14e8=a8_0x3fdc,_0x2caaf7=_0x2bcb3e();while(!![]){try{const _0x364e31=parseInt(_0xec14e8(0x8c))/0x1*(parseInt(_0xec14e8(0xbc))/0x2)+parseInt(_0xec14e8(0x89))/0x3*(parseInt(_0xec14e8(0xa4))/0x4)+parseInt(_0xec14e8(0xa5))/0x5*(parseInt(_0xec14e8(0x9b))/0x6)+-parseInt(_0xec14e8(0xa8))/0x7*(-parseInt(_0xec14e8(0xb8))/0x8)+-parseInt(_0xec14e8(0xb6))/0x9+parseInt(_0xec14e8(0xb7))/0xa+parseInt(_0xec14e8(0x90))/0xb;if(_0x364e31===_0x56e207)break;else _0x2caaf7['push'](_0x2caaf7['shift']());}catch(_0x581bfd){_0x2caaf7['push'](_0x2caaf7['shift']());}}}(a8_0xef72,0x99245));function a8_0xef72(){const _0x5e48df=['map','3JZeGty','body','email','../libs/jwt','686301pHNyNG','user','path','/folder','execute','uploads','\x20files','log','./uploads','./uploads/','post','1525560HeOrmZ','copyFileSync','files','length','delete','folder_name','Folder\x20name\x20is\x20required','existsSync','originalname','108616mIotig','10jbPEVV','send','json','3499447fWKQBI','diskStorage','status','mkdirSync','statSync','rmdirSync','Error!\x20Something\x20went\x20wrong.','unlinkSync','Please\x20upload\x20a\x20file','multer','../CADViewer_config.json','crypto','reduce','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','11089521zJtFYb','1129070gsehfj','8KsoWik','forEach','size','folderLocation','287542LguFrv','readdirSync','promise','/remove','/files','Path\x20is\x20required','Router','27coqQfk','\x20MB\x20of\x20files'];a8_0xef72=function(){return _0x5e48df;};return a8_0xef72();}function a8_0x3fdc(_0x5ab9b4,_0x3a00ee){const _0xef72b5=a8_0xef72();return a8_0x3fdc=function(_0x3fdc04,_0x1decd7){_0x3fdc04=_0x3fdc04-0x86;let _0x49a16b=_0xef72b5[_0x3fdc04];return _0x49a16b;},a8_0x3fdc(_0x5ab9b4,_0x3a00ee);}const multer=require(a8_0x2dbe10(0xb1)),fs=require('fs'),{randomUUID}=require(a8_0x2dbe10(0xb3)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require('../libs/mysql.js'),verifyToken=require(a8_0x2dbe10(0x8f))['verifyToken'],dir=a8_0x2dbe10(0x98);!fs[a8_0x2dbe10(0xa2)](dir)&&fs[a8_0x2dbe10(0xab)](dir);const express=require('express'),router=express[a8_0x2dbe10(0x88)](),config=require(a8_0x2dbe10(0xb2)),storage=multer[a8_0x2dbe10(0xa9)]({'destination':function(_0x48a72e,_0x591a41,_0x5f188b){const _0x184fc0=a8_0x2dbe10;_0x5f188b(null,_0x184fc0(0x95));}}),upload=multer({'storage':storage});router[a8_0x2dbe10(0x9a)](a8_0x2dbe10(0x86),upload['array'](a8_0x2dbe10(0x9d)),verifyToken,async(_0x38a8cd,_0x317faa,_0x14c2df)=>{const _0x214843=a8_0x2dbe10,_0x4ed638=_0x38a8cd[_0x214843(0x9d)],{global:_0x58b29d,path:_0x3c67ac}=_0x38a8cd[_0x214843(0x8d)],_0x31f3ec=config[_0x214843(0xbb)];console[_0x214843(0x97)]({'global':_0x58b29d}),console[_0x214843(0x97)](_0x4ed638),console[_0x214843(0x97)]({'user':_0x38a8cd['user']});if(_0x58b29d){_0x4ed638[_0x214843(0xb9)](_0x3ca3af=>{const _0x45174a=_0x214843;fs['copyFileSync'](_0x3ca3af[_0x45174a(0x92)],(_0x3c67ac||_0x31f3ec)+'/'+_0x3ca3af[_0x45174a(0xa3)]),fs[_0x45174a(0xaf)](_0x3ca3af[_0x45174a(0x92)]);}),_0x317faa['send']({'files':_0x4ed638[_0x214843(0x8b)](_0x10dd60=>({..._0x10dd60,'path':(_0x3c67ac||_0x31f3ec)+'/'+_0x10dd60['originalname']}))});return;}let _0x1fd769;try{const [_0x2c3046]=await conn['promise']()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x38a8cd['user'][_0x214843(0x8e)]]);_0x2c3046['length']>0x0&&(_0x1fd769=_0x2c3046[0x0]);}catch(_0x46abb1){console[_0x214843(0x97)]({'err':_0x46abb1}),_0x317faa[_0x214843(0xaa)](0x1f4)[_0x214843(0xa7)]({'error':_0x214843(0xae)});return;}if(!_0x1fd769){_0x317faa[_0x214843(0xaa)](0x191)[_0x214843(0xa7)]({'error':'Invalid\x20user'});return;}let _0x36e734=_0x1fd769[_0x214843(0xa0)];if(!_0x36e734){_0x36e734=randomUUID();try{await conn[_0x214843(0xbe)]()[_0x214843(0x94)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x36e734,_0x38a8cd[_0x214843(0x91)][_0x214843(0x8e)]]);}catch(_0x1a5d76){console['log']({'err':_0x1a5d76}),_0x317faa[_0x214843(0xaa)](0x1f4)[_0x214843(0xa7)]({'error':_0x214843(0xae)});return;}}const _0x20ef13=_0x214843(0x99)+_0x36e734;!fs['existsSync'](_0x20ef13)&&fs['mkdirSync'](_0x20ef13);if(!_0x4ed638){const _0x179e35=new Error(_0x214843(0xb0));return _0x179e35['httpStatusCode']=0x190,_0x14c2df(_0x179e35);}const _0x2070dd=fs[_0x214843(0xbd)](_0x20ef13)[_0x214843(0x9e)]+_0x4ed638[_0x214843(0x9e)];console[_0x214843(0x97)]({'numberOfSize':_0x2070dd});if(_0x2070dd>userFolderMaximumFiles)return _0x317faa[_0x214843(0xaa)](0x190)['json']({'error':_0x214843(0xb5)+userFolderMaximumFiles+_0x214843(0x96)});const _0x30dc9b=fs['readdirSync'](_0x20ef13)['reduce']((_0x4b5b93,_0x3780d4)=>_0x4b5b93+fs[_0x214843(0xac)](_0x20ef13+'/'+_0x3780d4)[_0x214843(0xba)],0x0),_0x1ecb3e=_0x4ed638[_0x214843(0xb4)]((_0xf2c2cd,_0x3a65f4)=>_0xf2c2cd+_0x3a65f4['size'],0x0);console[_0x214843(0x97)]({'totalSize':_0x30dc9b,'uploadedSize':_0x1ecb3e});if(_0x1ecb3e+_0x30dc9b>userFolderMaximumSizeInMB*0x400*0x400)return _0x317faa[_0x214843(0xaa)](0x190)[_0x214843(0xa7)]({'error':_0x214843(0xb5)+userFolderMaximumSizeInMB+_0x214843(0x8a)});_0x4ed638[_0x214843(0xb9)](_0x10fbe4=>{const _0x8e92d4=_0x214843;fs[_0x8e92d4(0x9c)](_0x10fbe4[_0x8e92d4(0x92)],_0x20ef13+'/'+_0x10fbe4[_0x8e92d4(0xa3)]),fs['unlinkSync'](_0x10fbe4[_0x8e92d4(0x92)]);}),_0x317faa['send']({'files':_0x4ed638[_0x214843(0x8b)](_0xc33bb4=>({..._0xc33bb4,'path':_0x20ef13+'/'+_0xc33bb4[_0x214843(0xa3)]}))});}),router[a8_0x2dbe10(0x9a)](a8_0x2dbe10(0x93),verifyToken,async(_0xe731d7,_0x27b5fe)=>{const _0x861713=a8_0x2dbe10,{path:_0x5c3991,folder_name:_0x23fb23}=_0xe731d7['body'];console[_0x861713(0x97)]({'path':_0x5c3991,'folder_name':_0x23fb23});if(!_0x5c3991)return _0x27b5fe[_0x861713(0xaa)](0x190)[_0x861713(0xa7)]({'error':_0x861713(0x87)});if(!_0x23fb23)return _0x27b5fe['status'](0x190)['json']({'error':_0x861713(0xa1)});const _0x2c5cc2=_0x5c3991+'/'+_0x23fb23;!fs[_0x861713(0xa2)](_0x2c5cc2)&&fs[_0x861713(0xab)](_0x2c5cc2),_0x27b5fe[_0x861713(0xa6)]({'path':_0x2c5cc2});}),router[a8_0x2dbe10(0x9f)](a8_0x2dbe10(0xbf),verifyToken,async(_0x5e14d9,_0x158a4d)=>{const _0x5dc053=a8_0x2dbe10,{isFolder:_0x97cf2,path:_0x5dc657}=_0x5e14d9[_0x5dc053(0x8d)];!_0x97cf2?fs[_0x5dc053(0xaf)](_0x5dc657):fs[_0x5dc053(0xad)](_0x5dc657,{'recursive':!![]}),_0x158a4d[_0x5dc053(0xa6)]({'success':!![]});}),module['exports']=router;