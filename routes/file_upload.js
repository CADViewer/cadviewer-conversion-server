const a9_0x432447=a9_0x2808;(function(_0x25235e,_0x11590e){const _0x17cd0a=a9_0x2808,_0x1ffd9b=_0x25235e();while(!![]){try{const _0xd4974a=parseInt(_0x17cd0a(0x12d))/0x1+-parseInt(_0x17cd0a(0x131))/0x2+-parseInt(_0x17cd0a(0x12f))/0x3*(parseInt(_0x17cd0a(0x118))/0x4)+-parseInt(_0x17cd0a(0x114))/0x5*(-parseInt(_0x17cd0a(0x109))/0x6)+-parseInt(_0x17cd0a(0x102))/0x7*(-parseInt(_0x17cd0a(0x10b))/0x8)+-parseInt(_0x17cd0a(0x108))/0x9+-parseInt(_0x17cd0a(0x105))/0xa*(-parseInt(_0x17cd0a(0x11b))/0xb);if(_0xd4974a===_0x11590e)break;else _0x1ffd9b['push'](_0x1ffd9b['shift']());}catch(_0x2d365b){_0x1ffd9b['push'](_0x1ffd9b['shift']());}}}(a9_0xccac,0x739bd));const multer=require(a9_0x432447(0x122)),fs=require('fs'),{randomUUID}=require(a9_0x432447(0x113)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require(a9_0x432447(0x11c)),verifyToken=require(a9_0x432447(0x107))[a9_0x432447(0x128)],dir='./uploads';function a9_0xccac(){const _0x3c4ad7=['multer','/folder','email','folder_name','/files','unlinkSync','verifyToken','array','json','originalname','\x20MB\x20of\x20files','681485wgglsh','body','49287qyEBwF','Router','1471818CEQYFG','post','Error!\x20Something\x20went\x20wrong.','mkdirSync','send','copyFileSync','size','uploads','forEach','files','516761gzshsm','reduce','promise','5098670lcvXlC','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','../libs/jwt','6474915lNcQYH','825726WflNiW','existsSync','24BzGTZu','map','execute','Folder\x20name\x20is\x20required','length','path','Please\x20upload\x20a\x20file','rmdirSync','crypto','5DEEQiV','user','httpStatusCode','log','32KvzqrI','diskStorage','readdirSync','22nFapiO','../libs/mysql.js','folderLocation','Invalid\x20user','status','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','Path\x20is\x20required'];a9_0xccac=function(){return _0x3c4ad7;};return a9_0xccac();}!fs[a9_0x432447(0x10a)](dir)&&fs[a9_0x432447(0x134)](dir);const express=require('express'),router=express[a9_0x432447(0x130)](),config=require('../CADViewer_config.json'),storage=multer[a9_0x432447(0x119)]({'destination':function(_0x2663c6,_0x83853b,_0x1f0ae5){const _0x436e24=a9_0x432447;_0x1f0ae5(null,_0x436e24(0x138));}}),upload=multer({'storage':storage});function a9_0x2808(_0x59ea96,_0x2abf40){const _0xccac34=a9_0xccac();return a9_0x2808=function(_0x2808e7,_0x293b3b){_0x2808e7=_0x2808e7-0x102;let _0x172ef2=_0xccac34[_0x2808e7];return _0x172ef2;},a9_0x2808(_0x59ea96,_0x2abf40);}router[a9_0x432447(0x132)](a9_0x432447(0x126),upload[a9_0x432447(0x129)]('files'),verifyToken,async(_0x49ab2c,_0xa5d021,_0x371eb4)=>{const _0x384f15=a9_0x432447,_0x1e81a9=_0x49ab2c[_0x384f15(0x13a)],{global:_0x41f0bb,path:_0x30c490}=_0x49ab2c['body'],_0x14ba70=config[_0x384f15(0x11d)];console['log']({'global':_0x41f0bb}),console[_0x384f15(0x117)](_0x1e81a9),console[_0x384f15(0x117)]({'user':_0x49ab2c['user']});if(_0x41f0bb){_0x1e81a9[_0x384f15(0x139)](_0x492a1c=>{const _0x5f4076=_0x384f15;fs[_0x5f4076(0x136)](_0x492a1c['path'],(_0x30c490||_0x14ba70)+'/'+_0x492a1c[_0x5f4076(0x12b)]),fs[_0x5f4076(0x127)](_0x492a1c[_0x5f4076(0x110)]);}),_0xa5d021['send']({'files':_0x1e81a9[_0x384f15(0x10c)](_0x43888e=>({..._0x43888e,'path':(_0x30c490||_0x14ba70)+'/'+_0x43888e[_0x384f15(0x12b)]}))});return;}let _0x10dbda;try{const [_0x20f89a]=await conn[_0x384f15(0x104)]()[_0x384f15(0x10d)](_0x384f15(0x106),[_0x49ab2c['user'][_0x384f15(0x124)]]);_0x20f89a['length']>0x0&&(_0x10dbda=_0x20f89a[0x0]);}catch(_0x366873){console[_0x384f15(0x117)]({'err':_0x366873}),_0xa5d021[_0x384f15(0x11f)](0x1f4)['json']({'error':_0x384f15(0x133)});return;}if(!_0x10dbda){_0xa5d021['status'](0x191)[_0x384f15(0x12a)]({'error':_0x384f15(0x11e)});return;}let _0x5660f9=_0x10dbda[_0x384f15(0x125)];if(!_0x5660f9){_0x5660f9=randomUUID();try{await conn[_0x384f15(0x104)]()['execute']('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x5660f9,_0x49ab2c[_0x384f15(0x115)][_0x384f15(0x124)]]);}catch(_0x48ff45){console[_0x384f15(0x117)]({'err':_0x48ff45}),_0xa5d021[_0x384f15(0x11f)](0x1f4)[_0x384f15(0x12a)]({'error':_0x384f15(0x133)});return;}}const _0x2f3633='./uploads/'+_0x5660f9;!fs[_0x384f15(0x10a)](_0x2f3633)&&fs[_0x384f15(0x134)](_0x2f3633);if(!_0x1e81a9){const _0xcdd0e0=new Error(_0x384f15(0x111));return _0xcdd0e0[_0x384f15(0x116)]=0x190,_0x371eb4(_0xcdd0e0);}const _0x5da734=fs['readdirSync'](_0x2f3633)[_0x384f15(0x10f)]+_0x1e81a9[_0x384f15(0x10f)];console[_0x384f15(0x117)]({'numberOfSize':_0x5da734});if(_0x5da734>userFolderMaximumFiles)return _0xa5d021[_0x384f15(0x11f)](0x190)['json']({'error':_0x384f15(0x120)+userFolderMaximumFiles+'\x20files'});const _0x40b7f1=fs[_0x384f15(0x11a)](_0x2f3633)[_0x384f15(0x103)]((_0x3b39f9,_0x4d307e)=>_0x3b39f9+fs['statSync'](_0x2f3633+'/'+_0x4d307e)[_0x384f15(0x137)],0x0),_0x10a46d=_0x1e81a9[_0x384f15(0x103)]((_0x6938f6,_0x4ace73)=>_0x6938f6+_0x4ace73[_0x384f15(0x137)],0x0);console[_0x384f15(0x117)]({'totalSize':_0x40b7f1,'uploadedSize':_0x10a46d});if(_0x10a46d+_0x40b7f1>userFolderMaximumSizeInMB*0x400*0x400)return _0xa5d021[_0x384f15(0x11f)](0x190)[_0x384f15(0x12a)]({'error':_0x384f15(0x120)+userFolderMaximumSizeInMB+_0x384f15(0x12c)});_0x1e81a9[_0x384f15(0x139)](_0x336e52=>{const _0x15a424=_0x384f15;fs[_0x15a424(0x136)](_0x336e52['path'],_0x2f3633+'/'+_0x336e52[_0x15a424(0x12b)]),fs['unlinkSync'](_0x336e52[_0x15a424(0x110)]);}),_0xa5d021[_0x384f15(0x135)]({'files':_0x1e81a9[_0x384f15(0x10c)](_0x28f0e6=>({..._0x28f0e6,'path':_0x2f3633+'/'+_0x28f0e6[_0x384f15(0x12b)]}))});}),router['post'](a9_0x432447(0x123),verifyToken,async(_0x457135,_0x5b0958)=>{const _0x46b4e4=a9_0x432447,{path:_0x3ef443,folder_name:_0x4227e3}=_0x457135[_0x46b4e4(0x12e)];console[_0x46b4e4(0x117)]({'path':_0x3ef443,'folder_name':_0x4227e3});if(!_0x3ef443)return _0x5b0958[_0x46b4e4(0x11f)](0x190)[_0x46b4e4(0x12a)]({'error':_0x46b4e4(0x121)});if(!_0x4227e3)return _0x5b0958[_0x46b4e4(0x11f)](0x190)['json']({'error':_0x46b4e4(0x10e)});const _0x4ba484=_0x3ef443+'/'+_0x4227e3;!fs[_0x46b4e4(0x10a)](_0x4ba484)&&fs[_0x46b4e4(0x134)](_0x4ba484),_0x5b0958[_0x46b4e4(0x135)]({'path':_0x4ba484});}),router['delete']('/remove',verifyToken,async(_0x1450d4,_0x21d6d9)=>{const _0x38bc71=a9_0x432447,{isFolder:_0x123da1,path:_0x2ee656}=_0x1450d4[_0x38bc71(0x12e)];!_0x123da1?fs[_0x38bc71(0x127)](_0x2ee656):fs[_0x38bc71(0x112)](_0x2ee656,{'recursive':!![]}),_0x21d6d9[_0x38bc71(0x135)]({'success':!![]});}),module['exports']=router;