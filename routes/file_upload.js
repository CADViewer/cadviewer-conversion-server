const a8_0x4a826a=a8_0x32a5;function a8_0x32a5(_0x145b36,_0x4b808d){const _0x2912b0=a8_0x2912();return a8_0x32a5=function(_0x32a54a,_0x349171){_0x32a54a=_0x32a54a-0x77;let _0x55fb4f=_0x2912b0[_0x32a54a];return _0x55fb4f;},a8_0x32a5(_0x145b36,_0x4b808d);}(function(_0x16a89c,_0xe55cf4){const _0x9346b0=a8_0x32a5,_0x206f19=_0x16a89c();while(!![]){try{const _0x32a1dc=parseInt(_0x9346b0(0xad))/0x1*(parseInt(_0x9346b0(0x90))/0x2)+parseInt(_0x9346b0(0x9c))/0x3+-parseInt(_0x9346b0(0xa7))/0x4+-parseInt(_0x9346b0(0x8b))/0x5*(-parseInt(_0x9346b0(0x9f))/0x6)+-parseInt(_0x9346b0(0x9d))/0x7*(parseInt(_0x9346b0(0xa6))/0x8)+-parseInt(_0x9346b0(0xa5))/0x9*(-parseInt(_0x9346b0(0x7b))/0xa)+parseInt(_0x9346b0(0x8a))/0xb*(parseInt(_0x9346b0(0x79))/0xc);if(_0x32a1dc===_0xe55cf4)break;else _0x206f19['push'](_0x206f19['shift']());}catch(_0x67d012){_0x206f19['push'](_0x206f19['shift']());}}}(a8_0x2912,0x55037));function a8_0x2912(){const _0x3d1c1c=['verifyToken','exports','../CADViewer_config.json','6010lEfyRA','files','statSync','log','crypto','user','map','renameSync','delete','httpStatusCode','status','./uploads/','716208NfHaMl','18494lEEeKK','Invalid\x20user','24wBVlmq','existsSync','send','multer','/folder','\x20files','27TjijRR','176inPXXk','1390172KKhYGW','unlinkSync','express','/files','post','promise','30YqjTzx','../libs/jwt','/remove','Folder\x20name\x20is\x20required','json','Path\x20is\x20required','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','path','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','body','29748GVpmBj','forEach','483150MHmEpI','size','../libs/mysql.js','execute','./uploads','\x20MB\x20of\x20files','Error!\x20Something\x20went\x20wrong.','reduce','mkdirSync','uploads','readdirSync','originalname','length','rmdirSync','folder_name','495sAGgOo','210620mOVMBC','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?'];a8_0x2912=function(){return _0x3d1c1c;};return a8_0x2912();}const multer=require(a8_0x4a826a(0xa2)),fs=require('fs'),{randomUUID}=require(a8_0x4a826a(0x94)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x4a826a(0x8f)),conn=require(a8_0x4a826a(0x7d)),verifyToken=require(a8_0x4a826a(0xae))[a8_0x4a826a(0x8d)],dir=a8_0x4a826a(0x7f);!fs['existsSync'](dir)&&fs[a8_0x4a826a(0x83)](dir);const express=require(a8_0x4a826a(0xa9)),router=express['Router'](),config=require(a8_0x4a826a(0x8f)),storage=multer['diskStorage']({'destination':function(_0x47a069,_0x1a0583,_0xd0bd0b){const _0x185337=a8_0x4a826a;_0xd0bd0b(null,_0x185337(0x84));}}),upload=multer({'storage':storage});router[a8_0x4a826a(0xab)](a8_0x4a826a(0xaa),upload['array']('files'),verifyToken,async(_0x114930,_0x5b423c,_0x2eee31)=>{const _0x46d8d8=a8_0x4a826a,_0x3ee0a5=_0x114930[_0x46d8d8(0x91)],{global:_0x3111eb,path:_0x715c47}=_0x114930[_0x46d8d8(0x78)],_0x231eaf=config['folderLocation'];console[_0x46d8d8(0x93)]({'global':_0x3111eb}),console[_0x46d8d8(0x93)](_0x3ee0a5),console[_0x46d8d8(0x93)]({'user':_0x114930[_0x46d8d8(0x95)]});if(_0x3111eb){_0x3ee0a5[_0x46d8d8(0x7a)](_0x50917d=>{const _0x3a7672=_0x46d8d8;fs['renameSync'](_0x50917d['path'],(_0x715c47||_0x231eaf)+'/'+_0x50917d[_0x3a7672(0x86)]);}),_0x5b423c['send']({'files':_0x3ee0a5[_0x46d8d8(0x96)](_0x428d51=>({..._0x428d51,'path':(_0x715c47||_0x231eaf)+'/'+_0x428d51[_0x46d8d8(0x86)]}))});return;}let _0x2ed339;try{const [_0x4a4df0]=await conn[_0x46d8d8(0xac)]()[_0x46d8d8(0x7e)](_0x46d8d8(0x8c),[_0x114930[_0x46d8d8(0x95)]['email']]);_0x4a4df0['length']>0x0&&(_0x2ed339=_0x4a4df0[0x0]);}catch(_0x43bacb){console[_0x46d8d8(0x93)]({'err':_0x43bacb}),_0x5b423c[_0x46d8d8(0x9a)](0x1f4)['json']({'error':_0x46d8d8(0x81)});return;}if(!_0x2ed339){_0x5b423c['status'](0x191)[_0x46d8d8(0xb1)]({'error':_0x46d8d8(0x9e)});return;}let _0x13a8f8=_0x2ed339[_0x46d8d8(0x89)];if(!_0x13a8f8){_0x13a8f8=randomUUID();try{await conn[_0x46d8d8(0xac)]()[_0x46d8d8(0x7e)](_0x46d8d8(0xb3),[_0x13a8f8,_0x114930[_0x46d8d8(0x95)]['email']]);}catch(_0xb00007){console[_0x46d8d8(0x93)]({'err':_0xb00007}),_0x5b423c['status'](0x1f4)[_0x46d8d8(0xb1)]({'error':_0x46d8d8(0x81)});return;}}const _0x1ec50e=_0x46d8d8(0x9b)+_0x13a8f8;!fs[_0x46d8d8(0xa0)](_0x1ec50e)&&fs[_0x46d8d8(0x83)](_0x1ec50e);if(!_0x3ee0a5){const _0x476eb0=new Error('Please\x20upload\x20a\x20file');return _0x476eb0[_0x46d8d8(0x99)]=0x190,_0x2eee31(_0x476eb0);}const _0x525714=fs[_0x46d8d8(0x85)](_0x1ec50e)[_0x46d8d8(0x87)]+_0x3ee0a5[_0x46d8d8(0x87)];console[_0x46d8d8(0x93)]({'numberOfSize':_0x525714});if(_0x525714>userFolderMaximumFiles)return _0x5b423c[_0x46d8d8(0x9a)](0x190)[_0x46d8d8(0xb1)]({'error':_0x46d8d8(0x77)+userFolderMaximumFiles+_0x46d8d8(0xa4)});const _0x3fa44d=fs['readdirSync'](_0x1ec50e)[_0x46d8d8(0x82)]((_0x524bfd,_0x474eb8)=>_0x524bfd+fs[_0x46d8d8(0x92)](_0x1ec50e+'/'+_0x474eb8)[_0x46d8d8(0x7c)],0x0),_0x32dabe=_0x3ee0a5[_0x46d8d8(0x82)]((_0xd8d19a,_0x25da94)=>_0xd8d19a+_0x25da94[_0x46d8d8(0x7c)],0x0);console[_0x46d8d8(0x93)]({'totalSize':_0x3fa44d,'uploadedSize':_0x32dabe});if(_0x32dabe+_0x3fa44d>userFolderMaximumSizeInMB*0x400*0x400)return _0x5b423c['status'](0x190)['json']({'error':_0x46d8d8(0x77)+userFolderMaximumSizeInMB+_0x46d8d8(0x80)});_0x3ee0a5[_0x46d8d8(0x7a)](_0x3d68f0=>{const _0x275873=_0x46d8d8;fs[_0x275873(0x97)](_0x3d68f0[_0x275873(0xb4)],_0x1ec50e+'/'+_0x3d68f0['originalname']);}),_0x5b423c[_0x46d8d8(0xa1)]({'files':_0x3ee0a5['map'](_0x4ed7a4=>({..._0x4ed7a4,'path':_0x1ec50e+'/'+_0x4ed7a4['originalname']}))});}),router[a8_0x4a826a(0xab)](a8_0x4a826a(0xa3),verifyToken,async(_0x1459ec,_0x2ed71d)=>{const _0xe0b9a5=a8_0x4a826a,{path:_0x2f63f8,folder_name:_0x1f3218}=_0x1459ec[_0xe0b9a5(0x78)],_0x15020b=config['folderLocation'];console[_0xe0b9a5(0x93)]({'path':_0x2f63f8,'folder_name':_0x1f3218});if(!_0x2f63f8)return _0x2ed71d[_0xe0b9a5(0x9a)](0x190)[_0xe0b9a5(0xb1)]({'error':_0xe0b9a5(0xb2)});if(!_0x1f3218)return _0x2ed71d['status'](0x190)[_0xe0b9a5(0xb1)]({'error':_0xe0b9a5(0xb0)});const _0x5070c0=_0x2f63f8+'/'+_0x1f3218;!fs[_0xe0b9a5(0xa0)](_0x5070c0)&&fs[_0xe0b9a5(0x83)](_0x5070c0),_0x2ed71d[_0xe0b9a5(0xa1)]({'path':_0x5070c0});}),router[a8_0x4a826a(0x98)](a8_0x4a826a(0xaf),verifyToken,async(_0xef1147,_0x275f5c)=>{const _0x136f3f=a8_0x4a826a,{isFolder:_0x5db43f,path:_0x54265}=_0xef1147[_0x136f3f(0x78)];!_0x5db43f?fs[_0x136f3f(0xa8)](_0x54265):fs[_0x136f3f(0x88)](_0x54265,{'recursive':!![]}),_0x275f5c[_0x136f3f(0xa1)]({'success':!![]});}),module[a8_0x4a826a(0x8e)]=router;