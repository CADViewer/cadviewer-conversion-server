const a8_0x4bc43f=a8_0x1d2e;(function(_0x20b705,_0x11bfda){const _0x1c510a=a8_0x1d2e,_0x2a7a4e=_0x20b705();while(!![]){try{const _0x1dea97=-parseInt(_0x1c510a(0x204))/0x1+parseInt(_0x1c510a(0x1e7))/0x2+parseInt(_0x1c510a(0x1ee))/0x3+parseInt(_0x1c510a(0x1e0))/0x4+parseInt(_0x1c510a(0x1f0))/0x5*(-parseInt(_0x1c510a(0x1f1))/0x6)+-parseInt(_0x1c510a(0x210))/0x7*(-parseInt(_0x1c510a(0x1f4))/0x8)+parseInt(_0x1c510a(0x1f3))/0x9*(-parseInt(_0x1c510a(0x1e2))/0xa);if(_0x1dea97===_0x11bfda)break;else _0x2a7a4e['push'](_0x2a7a4e['shift']());}catch(_0x5be384){_0x2a7a4e['push'](_0x2a7a4e['shift']());}}}(a8_0x1899,0xd6c8c));const multer=require(a8_0x4bc43f(0x1e8)),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x4bc43f(0x20b)),conn=require(a8_0x4bc43f(0x1f9)),verifyToken=require('../libs/jwt')[a8_0x4bc43f(0x1ec)],dir=a8_0x4bc43f(0x1ef);!fs[a8_0x4bc43f(0x1e6)](dir)&&fs['mkdirSync'](dir);const express=require('express'),router=express['Router'](),config=require(a8_0x4bc43f(0x20b)),storage=multer['diskStorage']({'destination':function(_0x3ba43b,_0x25c1ff,_0x2d1ab9){const _0xd6aa0=a8_0x4bc43f;_0x2d1ab9(null,_0xd6aa0(0x1ed));}}),upload=multer({'storage':storage});function a8_0x1899(){const _0xc8309b=['files','length','statSync','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','4380985hHgpzJ','httpStatusCode','send','readdirSync','reduce','delete','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','Invalid\x20user','user','log','5729820PHsrZK','path','240PWgMsB','./uploads/','status','promise','existsSync','2429294kpgWeR','multer','Folder\x20name\x20is\x20required','execute','originalname','verifyToken','uploads','995265qZXAQX','./uploads','5vOUnBR','8556642Xtgxry','email','218826Pwsogc','8LphKSG','copyFileSync','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','\x20files','size','../libs/mysql.js','Error!\x20Something\x20went\x20wrong.','json','folderLocation','/files','unlinkSync','forEach','exports','array','map','Path\x20is\x20required','715313lvLsPC','mkdirSync','post','body','folder_name','\x20MB\x20of\x20files','rmdirSync','../CADViewer_config.json'];a8_0x1899=function(){return _0xc8309b;};return a8_0x1899();}function a8_0x1d2e(_0x4d95a8,_0x3947f7){const _0x1899a6=a8_0x1899();return a8_0x1d2e=function(_0x1d2eb5,_0x186ab1){_0x1d2eb5=_0x1d2eb5-0x1d9;let _0xe9baae=_0x1899a6[_0x1d2eb5];return _0xe9baae;},a8_0x1d2e(_0x4d95a8,_0x3947f7);}router[a8_0x4bc43f(0x206)](a8_0x4bc43f(0x1fd),upload[a8_0x4bc43f(0x201)]('files'),verifyToken,async(_0x70d383,_0x5271cc,_0x5b4a81)=>{const _0xb2f225=a8_0x4bc43f,_0x5433cb=_0x70d383[_0xb2f225(0x20c)],{global:_0x4592d5,path:_0x48cace}=_0x70d383[_0xb2f225(0x207)],_0x3e8270=config[_0xb2f225(0x1fc)];console['log']({'global':_0x4592d5}),console[_0xb2f225(0x1df)](_0x5433cb),console[_0xb2f225(0x1df)]({'user':_0x70d383[_0xb2f225(0x1de)]});if(_0x4592d5){_0x5433cb[_0xb2f225(0x1ff)](_0x4114f9=>{const _0xecbc9=_0xb2f225;fs['copyFileSync'](_0x4114f9[_0xecbc9(0x1e1)],(_0x48cace||_0x3e8270)+'/'+_0x4114f9['originalname']),fs[_0xecbc9(0x1fe)](_0x4114f9[_0xecbc9(0x1e1)]);}),_0x5271cc[_0xb2f225(0x212)]({'files':_0x5433cb[_0xb2f225(0x202)](_0x404706=>({..._0x404706,'path':(_0x48cace||_0x3e8270)+'/'+_0x404706[_0xb2f225(0x1eb)]}))});return;}let _0x3994de;try{const [_0x3a0eb5]=await conn[_0xb2f225(0x1e5)]()[_0xb2f225(0x1ea)](_0xb2f225(0x1dc),[_0x70d383[_0xb2f225(0x1de)]['email']]);_0x3a0eb5['length']>0x0&&(_0x3994de=_0x3a0eb5[0x0]);}catch(_0x10da28){console[_0xb2f225(0x1df)]({'err':_0x10da28}),_0x5271cc[_0xb2f225(0x1e4)](0x1f4)['json']({'error':_0xb2f225(0x1fa)});return;}if(!_0x3994de){_0x5271cc[_0xb2f225(0x1e4)](0x191)['json']({'error':_0xb2f225(0x1dd)});return;}let _0x294941=_0x3994de[_0xb2f225(0x208)];if(!_0x294941){_0x294941=randomUUID();try{await conn[_0xb2f225(0x1e5)]()[_0xb2f225(0x1ea)](_0xb2f225(0x20f),[_0x294941,_0x70d383[_0xb2f225(0x1de)][_0xb2f225(0x1f2)]]);}catch(_0x441585){console['log']({'err':_0x441585}),_0x5271cc[_0xb2f225(0x1e4)](0x1f4)['json']({'error':_0xb2f225(0x1fa)});return;}}const _0x244863=_0xb2f225(0x1e3)+_0x294941;!fs[_0xb2f225(0x1e6)](_0x244863)&&fs['mkdirSync'](_0x244863);if(!_0x5433cb){const _0x153aeb=new Error('Please\x20upload\x20a\x20file');return _0x153aeb[_0xb2f225(0x211)]=0x190,_0x5b4a81(_0x153aeb);}const _0x4086ad=fs[_0xb2f225(0x1d9)](_0x244863)[_0xb2f225(0x20d)]+_0x5433cb[_0xb2f225(0x20d)];console[_0xb2f225(0x1df)]({'numberOfSize':_0x4086ad});if(_0x4086ad>userFolderMaximumFiles)return _0x5271cc['status'](0x190)[_0xb2f225(0x1fb)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+_0xb2f225(0x1f7)});const _0x366bea=fs[_0xb2f225(0x1d9)](_0x244863)[_0xb2f225(0x1da)]((_0x174057,_0x3bbff7)=>_0x174057+fs[_0xb2f225(0x20e)](_0x244863+'/'+_0x3bbff7)[_0xb2f225(0x1f8)],0x0),_0x5ec56a=_0x5433cb[_0xb2f225(0x1da)]((_0x433034,_0x1e30c1)=>_0x433034+_0x1e30c1[_0xb2f225(0x1f8)],0x0);console['log']({'totalSize':_0x366bea,'uploadedSize':_0x5ec56a});if(_0x5ec56a+_0x366bea>userFolderMaximumSizeInMB*0x400*0x400)return _0x5271cc[_0xb2f225(0x1e4)](0x190)[_0xb2f225(0x1fb)]({'error':_0xb2f225(0x1f6)+userFolderMaximumSizeInMB+_0xb2f225(0x209)});_0x5433cb[_0xb2f225(0x1ff)](_0x15adb0=>{const _0x2f89d8=_0xb2f225;fs[_0x2f89d8(0x1f5)](_0x15adb0['path'],_0x244863+'/'+_0x15adb0[_0x2f89d8(0x1eb)]),fs[_0x2f89d8(0x1fe)](_0x15adb0['path']);}),_0x5271cc['send']({'files':_0x5433cb[_0xb2f225(0x202)](_0x5ca20c=>({..._0x5ca20c,'path':_0x244863+'/'+_0x5ca20c[_0xb2f225(0x1eb)]}))});}),router[a8_0x4bc43f(0x206)]('/folder',verifyToken,async(_0x34ec7a,_0x19765e)=>{const _0x302f62=a8_0x4bc43f,{path:_0x312246,folder_name:_0x53dbc2}=_0x34ec7a[_0x302f62(0x207)];console[_0x302f62(0x1df)]({'path':_0x312246,'folder_name':_0x53dbc2});if(!_0x312246)return _0x19765e['status'](0x190)[_0x302f62(0x1fb)]({'error':_0x302f62(0x203)});if(!_0x53dbc2)return _0x19765e['status'](0x190)['json']({'error':_0x302f62(0x1e9)});const _0x5d51b0=_0x312246+'/'+_0x53dbc2;!fs[_0x302f62(0x1e6)](_0x5d51b0)&&fs[_0x302f62(0x205)](_0x5d51b0),_0x19765e['send']({'path':_0x5d51b0});}),router[a8_0x4bc43f(0x1db)]('/remove',verifyToken,async(_0x491e1d,_0x3f8d44)=>{const _0x9f29d9=a8_0x4bc43f,{isFolder:_0x5d478b,path:_0x129ddd}=_0x491e1d[_0x9f29d9(0x207)];!_0x5d478b?fs['unlinkSync'](_0x129ddd):fs[_0x9f29d9(0x20a)](_0x129ddd,{'recursive':!![]}),_0x3f8d44[_0x9f29d9(0x212)]({'success':!![]});}),module[a8_0x4bc43f(0x200)]=router;