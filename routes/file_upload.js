const a8_0x2e91d6=a8_0x32ba;(function(_0x446ed5,_0x5aa9a3){const _0x3b3c29=a8_0x32ba,_0x396e27=_0x446ed5();while(!![]){try{const _0x3581e=parseInt(_0x3b3c29(0x106))/0x1*(-parseInt(_0x3b3c29(0x10e))/0x2)+-parseInt(_0x3b3c29(0x119))/0x3+parseInt(_0x3b3c29(0x11b))/0x4+-parseInt(_0x3b3c29(0xfa))/0x5*(-parseInt(_0x3b3c29(0xe8))/0x6)+-parseInt(_0x3b3c29(0xe7))/0x7+parseInt(_0x3b3c29(0x100))/0x8+parseInt(_0x3b3c29(0xec))/0x9;if(_0x3581e===_0x5aa9a3)break;else _0x396e27['push'](_0x396e27['shift']());}catch(_0xb12ff){_0x396e27['push'](_0x396e27['shift']());}}}(a8_0x4f4c,0xd3d83));const multer=require(a8_0x2e91d6(0x102)),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require(a8_0x2e91d6(0xf0)),verifyToken=require(a8_0x2e91d6(0xe4))[a8_0x2e91d6(0xf3)],dir=a8_0x2e91d6(0xff);function a8_0x32ba(_0x53b7fb,_0x380e52){const _0x4f4cd2=a8_0x4f4c();return a8_0x32ba=function(_0x32ba9c,_0xc4f09){_0x32ba9c=_0x32ba9c-0xe3;let _0x10a9e9=_0x4f4cd2[_0x32ba9c];return _0x10a9e9;},a8_0x32ba(_0x53b7fb,_0x380e52);}!fs[a8_0x2e91d6(0x111)](dir)&&fs['mkdirSync'](dir);function a8_0x4f4c(){const _0x19d9fc=['promise','unlinkSync','execute','\x20MB\x20of\x20files','4121967fjGqAG','./uploads/','5318976tFZHmj','../CADViewer_config.json','folderLocation','status','../libs/jwt','Please\x20upload\x20a\x20file','user','75397Jksufe','132mXoTmV','/folder','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','reduce','9241623xKTWzM','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','readdirSync','Path\x20is\x20required','../libs/mysql.js','Error!\x20Something\x20went\x20wrong.','forEach','verifyToken','diskStorage','httpStatusCode','rmdirSync','/files','path','/remove','73445gLDoXc','json','array','files','log','./uploads','6541472gIwUrq','Folder\x20name\x20is\x20required','multer','send','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','post','3ljTMwl','email','exports','Router','map','express','mkdirSync','originalname','829972sQOBva','delete','length','existsSync','size','Invalid\x20user','folder_name'];a8_0x4f4c=function(){return _0x19d9fc;};return a8_0x4f4c();}const express=require(a8_0x2e91d6(0x10b)),router=express[a8_0x2e91d6(0x109)](),config=require(a8_0x2e91d6(0x11c)),storage=multer[a8_0x2e91d6(0xf4)]({'destination':function(_0x3ec4f4,_0xb19687,_0x48ba88){_0x48ba88(null,'uploads');}}),upload=multer({'storage':storage});router[a8_0x2e91d6(0x105)](a8_0x2e91d6(0xf7),upload[a8_0x2e91d6(0xfc)](a8_0x2e91d6(0xfd)),verifyToken,async(_0x4e774c,_0x29c999,_0x13353f)=>{const _0x11a257=a8_0x2e91d6,_0x28897e=_0x4e774c[_0x11a257(0xfd)],{global:_0x362a48,path:_0x5a352f}=_0x4e774c['body'],_0xd40034=config[_0x11a257(0x11d)];console[_0x11a257(0xfe)]({'global':_0x362a48}),console[_0x11a257(0xfe)](_0x28897e),console[_0x11a257(0xfe)]({'user':_0x4e774c[_0x11a257(0xe6)]});if(_0x362a48){_0x28897e[_0x11a257(0xf2)](_0x14e00c=>{const _0x280583=_0x11a257;fs['copyFileSync'](_0x14e00c['path'],(_0x5a352f||_0xd40034)+'/'+_0x14e00c[_0x280583(0x10d)]),fs[_0x280583(0x116)](_0x14e00c['path']);}),_0x29c999['send']({'files':_0x28897e[_0x11a257(0x10a)](_0x2f2267=>({..._0x2f2267,'path':(_0x5a352f||_0xd40034)+'/'+_0x2f2267['originalname']}))});return;}let _0x327262;try{const [_0x3cab69]=await conn[_0x11a257(0x115)]()['execute'](_0x11a257(0x104),[_0x4e774c[_0x11a257(0xe6)][_0x11a257(0x107)]]);_0x3cab69[_0x11a257(0x110)]>0x0&&(_0x327262=_0x3cab69[0x0]);}catch(_0x23a329){console[_0x11a257(0xfe)]({'err':_0x23a329}),_0x29c999[_0x11a257(0xe3)](0x1f4)[_0x11a257(0xfb)]({'error':_0x11a257(0xf1)});return;}if(!_0x327262){_0x29c999['status'](0x191)[_0x11a257(0xfb)]({'error':_0x11a257(0x113)});return;}let _0x351c07=_0x327262[_0x11a257(0x114)];if(!_0x351c07){_0x351c07=randomUUID();try{await conn[_0x11a257(0x115)]()[_0x11a257(0x117)](_0x11a257(0xea),[_0x351c07,_0x4e774c[_0x11a257(0xe6)][_0x11a257(0x107)]]);}catch(_0xb1db35){console[_0x11a257(0xfe)]({'err':_0xb1db35}),_0x29c999[_0x11a257(0xe3)](0x1f4)[_0x11a257(0xfb)]({'error':_0x11a257(0xf1)});return;}}const _0x4ab1e7=_0x11a257(0x11a)+_0x351c07;!fs[_0x11a257(0x111)](_0x4ab1e7)&&fs['mkdirSync'](_0x4ab1e7);if(!_0x28897e){const _0x2978c5=new Error(_0x11a257(0xe5));return _0x2978c5[_0x11a257(0xf5)]=0x190,_0x13353f(_0x2978c5);}const _0x4dcb94=fs[_0x11a257(0xee)](_0x4ab1e7)[_0x11a257(0x110)]+_0x28897e[_0x11a257(0x110)];console[_0x11a257(0xfe)]({'numberOfSize':_0x4dcb94});if(_0x4dcb94>userFolderMaximumFiles)return _0x29c999[_0x11a257(0xe3)](0x190)[_0x11a257(0xfb)]({'error':_0x11a257(0xed)+userFolderMaximumFiles+'\x20files'});const _0x3c157b=fs[_0x11a257(0xee)](_0x4ab1e7)['reduce']((_0x13f95f,_0x3dd88a)=>_0x13f95f+fs['statSync'](_0x4ab1e7+'/'+_0x3dd88a)[_0x11a257(0x112)],0x0),_0xfd8b1c=_0x28897e[_0x11a257(0xeb)]((_0x3466dc,_0x5846b3)=>_0x3466dc+_0x5846b3[_0x11a257(0x112)],0x0);console[_0x11a257(0xfe)]({'totalSize':_0x3c157b,'uploadedSize':_0xfd8b1c});if(_0xfd8b1c+_0x3c157b>userFolderMaximumSizeInMB*0x400*0x400)return _0x29c999[_0x11a257(0xe3)](0x190)['json']({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+_0x11a257(0x118)});_0x28897e[_0x11a257(0xf2)](_0x4e65a0=>{const _0x35b58b=_0x11a257;fs['copyFileSync'](_0x4e65a0[_0x35b58b(0xf8)],_0x4ab1e7+'/'+_0x4e65a0[_0x35b58b(0x10d)]),fs[_0x35b58b(0x116)](_0x4e65a0['path']);}),_0x29c999[_0x11a257(0x103)]({'files':_0x28897e['map'](_0x59817b=>({..._0x59817b,'path':_0x4ab1e7+'/'+_0x59817b[_0x11a257(0x10d)]}))});}),router['post'](a8_0x2e91d6(0xe9),verifyToken,async(_0x5a0fbc,_0xdd0c07)=>{const _0x58c030=a8_0x2e91d6,{path:_0x2d7d3c,folder_name:_0x18f436}=_0x5a0fbc['body'];console['log']({'path':_0x2d7d3c,'folder_name':_0x18f436});if(!_0x2d7d3c)return _0xdd0c07['status'](0x190)['json']({'error':_0x58c030(0xef)});if(!_0x18f436)return _0xdd0c07[_0x58c030(0xe3)](0x190)[_0x58c030(0xfb)]({'error':_0x58c030(0x101)});const _0x44e0ed=_0x2d7d3c+'/'+_0x18f436;!fs[_0x58c030(0x111)](_0x44e0ed)&&fs[_0x58c030(0x10c)](_0x44e0ed),_0xdd0c07['send']({'path':_0x44e0ed});}),router[a8_0x2e91d6(0x10f)](a8_0x2e91d6(0xf9),verifyToken,async(_0x210024,_0x27e2e8)=>{const _0x25cdeb=a8_0x2e91d6,{isFolder:_0x1d9f7b,path:_0x58684b}=_0x210024['body'];!_0x1d9f7b?fs['unlinkSync'](_0x58684b):fs[_0x25cdeb(0xf6)](_0x58684b,{'recursive':!![]}),_0x27e2e8[_0x25cdeb(0x103)]({'success':!![]});}),module[a8_0x2e91d6(0x108)]=router;