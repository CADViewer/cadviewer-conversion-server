const a8_0xe3b249=a8_0x2367;function a8_0x2367(_0x2d55a0,_0x58d36a){const _0x185ff5=a8_0x185f();return a8_0x2367=function(_0x2367c5,_0xa3bb6a){_0x2367c5=_0x2367c5-0x8e;let _0x2c685e=_0x185ff5[_0x2367c5];return _0x2c685e;},a8_0x2367(_0x2d55a0,_0x58d36a);}(function(_0x1819e3,_0x367c5f){const _0x26b36c=a8_0x2367,_0x485b71=_0x1819e3();while(!![]){try{const _0x11687e=-parseInt(_0x26b36c(0xaa))/0x1*(-parseInt(_0x26b36c(0x9d))/0x2)+-parseInt(_0x26b36c(0xc7))/0x3*(-parseInt(_0x26b36c(0x91))/0x4)+-parseInt(_0x26b36c(0xb2))/0x5*(-parseInt(_0x26b36c(0xa7))/0x6)+parseInt(_0x26b36c(0xba))/0x7*(parseInt(_0x26b36c(0x96))/0x8)+parseInt(_0x26b36c(0xa4))/0x9+parseInt(_0x26b36c(0xc8))/0xa*(-parseInt(_0x26b36c(0x9f))/0xb)+-parseInt(_0x26b36c(0xc0))/0xc*(parseInt(_0x26b36c(0x93))/0xd);if(_0x11687e===_0x367c5f)break;else _0x485b71['push'](_0x485b71['shift']());}catch(_0x106648){_0x485b71['push'](_0x485b71['shift']());}}}(a8_0x185f,0xd9ffd));const multer=require(a8_0xe3b249(0xa3)),fs=require('fs'),{randomUUID}=require(a8_0xe3b249(0xc3)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0xe3b249(0xb6)),conn=require(a8_0xe3b249(0xbd)),verifyToken=require(a8_0xe3b249(0xa5))[a8_0xe3b249(0xa8)],dir=a8_0xe3b249(0xc5);function a8_0x185f(){const _0x57e558=['../libs/mysql.js','\x20MB\x20of\x20files','Router','12YyZdYy','diskStorage','existsSync','crypto','files','./uploads','Invalid\x20user','3reXNUS','6324990qymeWD','exports','forEach','mkdirSync','user','statSync','3089836oGiXeb','uploads','25612535RrUbmk','\x20files','Folder\x20name\x20is\x20required','1299248vcwFNK','folderLocation','array','path','length','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','express','2eXEgos','email','11aWEONU','renameSync','originalname','./uploads/','multer','2843451gjFVtD','../libs/jwt','post','6rrOInl','verifyToken','httpStatusCode','841221nCJHmh','size','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','Error!\x20Something\x20went\x20wrong.','log','json','status','readdirSync','2145790yXiFnx','body','/remove','execute','../CADViewer_config.json','reduce','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','promise','49NtrVdo','send','folder_name'];a8_0x185f=function(){return _0x57e558;};return a8_0x185f();}!fs[a8_0xe3b249(0xc2)](dir)&&fs[a8_0xe3b249(0x8e)](dir);const express=require(a8_0xe3b249(0x9c)),router=express[a8_0xe3b249(0xbf)](),config=require(a8_0xe3b249(0xb6)),storage=multer[a8_0xe3b249(0xc1)]({'destination':function(_0x3ff0c4,_0x395007,_0x253aa5){const _0x2452de=a8_0xe3b249;_0x253aa5(null,_0x2452de(0x92));}}),upload=multer({'storage':storage});router[a8_0xe3b249(0xa6)]('/files',upload[a8_0xe3b249(0x98)](a8_0xe3b249(0xc4)),verifyToken,async(_0x384a10,_0xa3d6ac,_0x436cd7)=>{const _0x490b05=a8_0xe3b249,_0x5859d6=_0x384a10[_0x490b05(0xc4)],{global:_0xcbb304,path:_0x1313c9}=_0x384a10[_0x490b05(0xb3)],_0x32f124=config[_0x490b05(0x97)];console[_0x490b05(0xae)]({'global':_0xcbb304}),console[_0x490b05(0xae)](_0x5859d6),console['log']({'user':_0x384a10['user']});if(_0xcbb304){_0x5859d6[_0x490b05(0xca)](_0x483467=>{const _0x52c879=_0x490b05;fs[_0x52c879(0xa0)](_0x483467[_0x52c879(0x99)],(_0x1313c9||_0x32f124)+'/'+_0x483467['originalname']);}),_0xa3d6ac[_0x490b05(0xbb)]({'files':_0x5859d6['map'](_0x49e3fa=>({..._0x49e3fa,'path':(_0x1313c9||_0x32f124)+'/'+_0x49e3fa['originalname']}))});return;}let _0x38c467;try{const [_0x11064c]=await conn[_0x490b05(0xb9)]()[_0x490b05(0xb5)](_0x490b05(0xb8),[_0x384a10[_0x490b05(0x8f)][_0x490b05(0x9e)]]);_0x11064c['length']>0x0&&(_0x38c467=_0x11064c[0x0]);}catch(_0x25074c){console[_0x490b05(0xae)]({'err':_0x25074c}),_0xa3d6ac[_0x490b05(0xb0)](0x1f4)['json']({'error':_0x490b05(0xad)});return;}if(!_0x38c467){_0xa3d6ac[_0x490b05(0xb0)](0x191)['json']({'error':_0x490b05(0xc6)});return;}let _0x59f1be=_0x38c467[_0x490b05(0xbc)];if(!_0x59f1be){_0x59f1be=randomUUID();try{await conn[_0x490b05(0xb9)]()[_0x490b05(0xb5)](_0x490b05(0x9b),[_0x59f1be,_0x384a10[_0x490b05(0x8f)][_0x490b05(0x9e)]]);}catch(_0x5624eb){console[_0x490b05(0xae)]({'err':_0x5624eb}),_0xa3d6ac[_0x490b05(0xb0)](0x1f4)[_0x490b05(0xaf)]({'error':_0x490b05(0xad)});return;}}const _0x2b53e2=_0x490b05(0xa2)+_0x59f1be;!fs[_0x490b05(0xc2)](_0x2b53e2)&&fs[_0x490b05(0x8e)](_0x2b53e2);if(!_0x5859d6){const _0xa9b455=new Error('Please\x20upload\x20a\x20file');return _0xa9b455[_0x490b05(0xa9)]=0x190,_0x436cd7(_0xa9b455);}const _0x1a5443=fs[_0x490b05(0xb1)](_0x2b53e2)[_0x490b05(0x9a)]+_0x5859d6[_0x490b05(0x9a)];console[_0x490b05(0xae)]({'numberOfSize':_0x1a5443});if(_0x1a5443>userFolderMaximumFiles)return _0xa3d6ac[_0x490b05(0xb0)](0x190)[_0x490b05(0xaf)]({'error':_0x490b05(0xac)+userFolderMaximumFiles+_0x490b05(0x94)});const _0x4a3921=fs['readdirSync'](_0x2b53e2)[_0x490b05(0xb7)]((_0x429d79,_0x1ee393)=>_0x429d79+fs[_0x490b05(0x90)](_0x2b53e2+'/'+_0x1ee393)[_0x490b05(0xab)],0x0),_0x297a7d=_0x5859d6['reduce']((_0x3b043c,_0x1b031c)=>_0x3b043c+_0x1b031c[_0x490b05(0xab)],0x0);console[_0x490b05(0xae)]({'totalSize':_0x4a3921,'uploadedSize':_0x297a7d});if(_0x297a7d+_0x4a3921>userFolderMaximumSizeInMB*0x400*0x400)return _0xa3d6ac[_0x490b05(0xb0)](0x190)[_0x490b05(0xaf)]({'error':_0x490b05(0xac)+userFolderMaximumSizeInMB+_0x490b05(0xbe)});_0x5859d6[_0x490b05(0xca)](_0x8f04e1=>{const _0x13ba30=_0x490b05;fs[_0x13ba30(0xa0)](_0x8f04e1[_0x13ba30(0x99)],_0x2b53e2+'/'+_0x8f04e1[_0x13ba30(0xa1)]);}),_0xa3d6ac['send']({'files':_0x5859d6['map'](_0x21b694=>({..._0x21b694,'path':_0x2b53e2+'/'+_0x21b694[_0x490b05(0xa1)]}))});}),router[a8_0xe3b249(0xa6)]('/folder',verifyToken,async(_0x2b4529,_0x3e2b48)=>{const _0x23a32a=a8_0xe3b249,{path:_0x318f2a,folder_name:_0xd2d15f}=_0x2b4529[_0x23a32a(0xb3)],_0x5319b3=config[_0x23a32a(0x97)];console[_0x23a32a(0xae)]({'path':_0x318f2a,'folder_name':_0xd2d15f});if(!_0x318f2a)return _0x3e2b48[_0x23a32a(0xb0)](0x190)[_0x23a32a(0xaf)]({'error':'Path\x20is\x20required'});if(!_0xd2d15f)return _0x3e2b48[_0x23a32a(0xb0)](0x190)['json']({'error':_0x23a32a(0x95)});const _0xf0a75=_0x318f2a+'/'+_0xd2d15f;!fs[_0x23a32a(0xc2)](_0xf0a75)&&fs[_0x23a32a(0x8e)](_0xf0a75),_0x3e2b48[_0x23a32a(0xbb)]({'path':_0xf0a75});}),router['delete'](a8_0xe3b249(0xb4),verifyToken,async(_0x1afbd0,_0x1687c3)=>{const _0x3fc4b0=a8_0xe3b249,{isFolder:_0x547aa5,path:_0x50164f}=_0x1afbd0[_0x3fc4b0(0xb3)];!_0x547aa5?fs['unlinkSync'](_0x50164f):fs['rmdirSync'](_0x50164f,{'recursive':!![]}),_0x1687c3[_0x3fc4b0(0xbb)]({'success':!![]});}),module[a8_0xe3b249(0xc9)]=router;