const a8_0x3e6ada=a8_0x1ff8;function a8_0x56de(){const _0x19f760=['649704iegdqf','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','322JlYmMn','multer','renameSync','execute','8535060IzDDbT','status','folder_name','4188rAoDfl','json','email','existsSync','420xTOtUS','uploads','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','mkdirSync','originalname','post','../libs/mysql.js','folderLocation','256069Cpecuw','verifyToken','size','unlinkSync','/files','14578RGKplN','array','send','exports','map','/remove','files','readdirSync','log','Path\x20is\x20required','Please\x20upload\x20a\x20file','27GIFZXW','./uploads/','\x20MB\x20of\x20files','express','../libs/jwt','593950qrsgyz','forEach','Invalid\x20user','user','69uzbKqu','promise','httpStatusCode','reduce','body','104612sZMvoc','Error!\x20Something\x20went\x20wrong.','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','../CADViewer_config.json','Folder\x20name\x20is\x20required','crypto','Router','\x20files','37MIerRz'];a8_0x56de=function(){return _0x19f760;};return a8_0x56de();}(function(_0x43864c,_0x34a9c5){const _0xb49a57=a8_0x1ff8,_0x24f75d=_0x43864c();while(!![]){try{const _0x2ce0e4=parseInt(_0xb49a57(0xc3))/0x1*(-parseInt(_0xb49a57(0xa2))/0x2)+-parseInt(_0xb49a57(0xb6))/0x3*(-parseInt(_0xb49a57(0xbb))/0x4)+-parseInt(_0xb49a57(0xb2))/0x5+-parseInt(_0xb49a57(0xcd))/0x6*(parseInt(_0xb49a57(0xc6))/0x7)+-parseInt(_0xb49a57(0xc4))/0x8*(-parseInt(_0xb49a57(0xad))/0x9)+parseInt(_0xb49a57(0xca))/0xa+parseInt(_0xb49a57(0x9d))/0xb*(-parseInt(_0xb49a57(0xd1))/0xc);if(_0x2ce0e4===_0x34a9c5)break;else _0x24f75d['push'](_0x24f75d['shift']());}catch(_0x29411c){_0x24f75d['push'](_0x24f75d['shift']());}}}(a8_0x56de,0x711cc));const multer=require(a8_0x3e6ada(0xc7)),fs=require('fs'),{randomUUID}=require(a8_0x3e6ada(0xc0)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x3e6ada(0xbe)),conn=require(a8_0x3e6ada(0xd7)),verifyToken=require(a8_0x3e6ada(0xb1))[a8_0x3e6ada(0x9e)],dir='./uploads';!fs['existsSync'](dir)&&fs[a8_0x3e6ada(0xd4)](dir);function a8_0x1ff8(_0x6503fe,_0x4db69b){const _0x56de05=a8_0x56de();return a8_0x1ff8=function(_0x1ff824,_0x38990f){_0x1ff824=_0x1ff824-0x9d;let _0x2bc0a0=_0x56de05[_0x1ff824];return _0x2bc0a0;},a8_0x1ff8(_0x6503fe,_0x4db69b);}const express=require(a8_0x3e6ada(0xb0)),router=express[a8_0x3e6ada(0xc1)](),config=require(a8_0x3e6ada(0xbe)),storage=multer['diskStorage']({'destination':function(_0x5b7f80,_0x19c5db,_0x18cac6){const _0x297069=a8_0x3e6ada;_0x18cac6(null,_0x297069(0xd2));}}),upload=multer({'storage':storage});router[a8_0x3e6ada(0xd6)](a8_0x3e6ada(0xa1),upload[a8_0x3e6ada(0xa3)](a8_0x3e6ada(0xa8)),verifyToken,async(_0x378215,_0x3411a6,_0x243ea3)=>{const _0xc6833e=a8_0x3e6ada,_0x249715=_0x378215['files'],{global:_0x46d2e3,path:_0x50a97d}=_0x378215[_0xc6833e(0xba)],_0x4ec094=config[_0xc6833e(0xd8)];console['log']({'global':_0x46d2e3}),console[_0xc6833e(0xaa)](_0x249715),console[_0xc6833e(0xaa)]({'user':_0x378215[_0xc6833e(0xb5)]});if(_0x46d2e3){_0x249715[_0xc6833e(0xb3)](_0x379ca9=>{const _0x5d512e=_0xc6833e;fs[_0x5d512e(0xc8)](_0x379ca9['path'],(_0x50a97d||_0x4ec094)+'/'+_0x379ca9[_0x5d512e(0xd5)]);}),_0x3411a6[_0xc6833e(0xa4)]({'files':_0x249715[_0xc6833e(0xa6)](_0x27b8f5=>({..._0x27b8f5,'path':(_0x50a97d||_0x4ec094)+'/'+_0x27b8f5[_0xc6833e(0xd5)]}))});return;}let _0x2f6b0c;try{const [_0x14a2e3]=await conn[_0xc6833e(0xb7)]()[_0xc6833e(0xc9)](_0xc6833e(0xd3),[_0x378215[_0xc6833e(0xb5)][_0xc6833e(0xcf)]]);_0x14a2e3['length']>0x0&&(_0x2f6b0c=_0x14a2e3[0x0]);}catch(_0x4f9479){console['log']({'err':_0x4f9479}),_0x3411a6[_0xc6833e(0xcb)](0x1f4)[_0xc6833e(0xce)]({'error':_0xc6833e(0xbc)});return;}if(!_0x2f6b0c){_0x3411a6[_0xc6833e(0xcb)](0x191)[_0xc6833e(0xce)]({'error':_0xc6833e(0xb4)});return;}let _0x56740a=_0x2f6b0c[_0xc6833e(0xcc)];if(!_0x56740a){_0x56740a=randomUUID();try{await conn['promise']()[_0xc6833e(0xc9)](_0xc6833e(0xbd),[_0x56740a,_0x378215[_0xc6833e(0xb5)][_0xc6833e(0xcf)]]);}catch(_0xb8c397){console[_0xc6833e(0xaa)]({'err':_0xb8c397}),_0x3411a6[_0xc6833e(0xcb)](0x1f4)[_0xc6833e(0xce)]({'error':_0xc6833e(0xbc)});return;}}const _0x4b1f91=_0xc6833e(0xae)+_0x56740a;!fs[_0xc6833e(0xd0)](_0x4b1f91)&&fs[_0xc6833e(0xd4)](_0x4b1f91);if(!_0x249715){const _0x19d595=new Error(_0xc6833e(0xac));return _0x19d595[_0xc6833e(0xb8)]=0x190,_0x243ea3(_0x19d595);}const _0x58256e=fs[_0xc6833e(0xa9)](_0x4b1f91)['length']+_0x249715['length'];console[_0xc6833e(0xaa)]({'numberOfSize':_0x58256e});if(_0x58256e>userFolderMaximumFiles)return _0x3411a6[_0xc6833e(0xcb)](0x190)['json']({'error':_0xc6833e(0xc5)+userFolderMaximumFiles+_0xc6833e(0xc2)});const _0x6b30b=fs[_0xc6833e(0xa9)](_0x4b1f91)[_0xc6833e(0xb9)]((_0x14887f,_0x4358c7)=>_0x14887f+fs['statSync'](_0x4b1f91+'/'+_0x4358c7)[_0xc6833e(0x9f)],0x0),_0x46fbd=_0x249715[_0xc6833e(0xb9)]((_0x5e7343,_0x3678f0)=>_0x5e7343+_0x3678f0['size'],0x0);console[_0xc6833e(0xaa)]({'totalSize':_0x6b30b,'uploadedSize':_0x46fbd});if(_0x46fbd+_0x6b30b>userFolderMaximumSizeInMB*0x400*0x400)return _0x3411a6['status'](0x190)['json']({'error':_0xc6833e(0xc5)+userFolderMaximumSizeInMB+_0xc6833e(0xaf)});_0x249715[_0xc6833e(0xb3)](_0x4640c4=>{const _0x5c6c0a=_0xc6833e;fs[_0x5c6c0a(0xc8)](_0x4640c4['path'],_0x4b1f91+'/'+_0x4640c4[_0x5c6c0a(0xd5)]);}),_0x3411a6['send']({'files':_0x249715[_0xc6833e(0xa6)](_0x176f99=>({..._0x176f99,'path':_0x4b1f91+'/'+_0x176f99[_0xc6833e(0xd5)]}))});}),router[a8_0x3e6ada(0xd6)]('/folder',verifyToken,async(_0x388aa1,_0x24b5da)=>{const _0x3b520f=a8_0x3e6ada,{path:_0x4caccc,folder_name:_0x38368a}=_0x388aa1[_0x3b520f(0xba)],_0xb691b7=config[_0x3b520f(0xd8)];console['log']({'path':_0x4caccc,'folder_name':_0x38368a});if(!_0x4caccc)return _0x24b5da['status'](0x190)[_0x3b520f(0xce)]({'error':_0x3b520f(0xab)});if(!_0x38368a)return _0x24b5da[_0x3b520f(0xcb)](0x190)[_0x3b520f(0xce)]({'error':_0x3b520f(0xbf)});const _0x1aad42=_0x4caccc+'/'+_0x38368a;!fs[_0x3b520f(0xd0)](_0x1aad42)&&fs['mkdirSync'](_0x1aad42),_0x24b5da[_0x3b520f(0xa4)]({'path':_0x1aad42});}),router['delete'](a8_0x3e6ada(0xa7),verifyToken,async(_0x4e3ed1,_0x170d16)=>{const _0x542f56=a8_0x3e6ada,{isFolder:_0x83d159,path:_0x123610}=_0x4e3ed1[_0x542f56(0xba)];!_0x83d159?fs[_0x542f56(0xa0)](_0x123610):fs['rmdirSync'](_0x123610,{'recursive':!![]}),_0x170d16[_0x542f56(0xa4)]({'success':!![]});}),module[a8_0x3e6ada(0xa5)]=router;