const a8_0x157df4=a8_0x1e71;(function(_0x5a2695,_0x3117d2){const _0x5aa805=a8_0x1e71,_0x16c09b=_0x5a2695();while(!![]){try{const _0x35670d=-parseInt(_0x5aa805(0x124))/0x1+-parseInt(_0x5aa805(0x101))/0x2+-parseInt(_0x5aa805(0x107))/0x3+-parseInt(_0x5aa805(0x109))/0x4*(parseInt(_0x5aa805(0x10e))/0x5)+parseInt(_0x5aa805(0x104))/0x6*(parseInt(_0x5aa805(0x115))/0x7)+-parseInt(_0x5aa805(0x127))/0x8*(parseInt(_0x5aa805(0x12b))/0x9)+parseInt(_0x5aa805(0x117))/0xa*(parseInt(_0x5aa805(0x12e))/0xb);if(_0x35670d===_0x3117d2)break;else _0x16c09b['push'](_0x16c09b['shift']());}catch(_0x4bad7a){_0x16c09b['push'](_0x16c09b['shift']());}}}(a8_0x3184,0xda570));const multer=require(a8_0x157df4(0x121)),fs=require('fs'),{randomUUID}=require(a8_0x157df4(0x116)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require(a8_0x157df4(0x114)),verifyToken=require(a8_0x157df4(0x103))[a8_0x157df4(0x12a)],dir=a8_0x157df4(0x119);function a8_0x3184(){const _0x58edd6=['unlinkSync','uploads','verifyToken','14244138VlzekJ','Router','path','7997891StScMZ','httpStatusCode','array','user','files','Please\x20upload\x20a\x20file','send','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','existsSync','/folder','Path\x20is\x20required','folderLocation','json','391440sHyccD','diskStorage','../libs/jwt','1776NglnwB','readdirSync','/remove','4848348KzAkHW','email','651892QtPDKC','forEach','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','renameSync','Invalid\x20user','35iepNWh','rmdirSync','length','\x20MB\x20of\x20files','body','originalname','../libs/mysql.js','41566uSYfpy','crypto','70xTZWJx','express','./uploads','post','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','mkdirSync','../CADViewer_config.json','map','statSync','Error!\x20Something\x20went\x20wrong.','multer','status','size','1417566RljWiF','execute','log','8aPMitP'];a8_0x3184=function(){return _0x58edd6;};return a8_0x3184();}!fs[a8_0x157df4(0x136)](dir)&&fs['mkdirSync'](dir);const express=require(a8_0x157df4(0x118)),router=express[a8_0x157df4(0x12c)](),config=require(a8_0x157df4(0x11d)),storage=multer[a8_0x157df4(0x102)]({'destination':function(_0x2923c6,_0x4589fb,_0x55b9fd){const _0x10857a=a8_0x157df4;_0x55b9fd(null,_0x10857a(0x129));}}),upload=multer({'storage':storage});function a8_0x1e71(_0x418aa7,_0x2befa7){const _0x31841c=a8_0x3184();return a8_0x1e71=function(_0x1e716c,_0x1a785b){_0x1e716c=_0x1e716c-0x101;let _0x5349d9=_0x31841c[_0x1e716c];return _0x5349d9;},a8_0x1e71(_0x418aa7,_0x2befa7);}router[a8_0x157df4(0x11a)]('/files',upload[a8_0x157df4(0x130)]('files'),verifyToken,async(_0xb0b71e,_0x34c19e,_0x129d18)=>{const _0x379739=a8_0x157df4,_0xdf8428=_0xb0b71e[_0x379739(0x132)],{global:_0x56d63a,path:_0x4e5ff7}=_0xb0b71e[_0x379739(0x112)],_0x1aca09=config['folderLocation'];console[_0x379739(0x126)]({'global':_0x56d63a}),console[_0x379739(0x126)](_0xdf8428),console[_0x379739(0x126)]({'user':_0xb0b71e[_0x379739(0x131)]});if(_0x56d63a){_0xdf8428[_0x379739(0x10a)](_0x27d7e5=>{const _0x115028=_0x379739;fs[_0x115028(0x10c)](_0x27d7e5[_0x115028(0x12d)],(_0x4e5ff7||_0x1aca09)+'/'+_0x27d7e5[_0x115028(0x113)]);}),_0x34c19e['send']({'files':_0xdf8428[_0x379739(0x11e)](_0x340805=>({..._0x340805,'path':(_0x4e5ff7||_0x1aca09)+'/'+_0x340805['originalname']}))});return;}let _0x192ecf;try{const [_0x3d7495]=await conn['promise']()['execute'](_0x379739(0x11b),[_0xb0b71e[_0x379739(0x131)][_0x379739(0x108)]]);_0x3d7495[_0x379739(0x110)]>0x0&&(_0x192ecf=_0x3d7495[0x0]);}catch(_0x49df44){console[_0x379739(0x126)]({'err':_0x49df44}),_0x34c19e[_0x379739(0x122)](0x1f4)[_0x379739(0x13a)]({'error':_0x379739(0x120)});return;}if(!_0x192ecf){_0x34c19e[_0x379739(0x122)](0x191)['json']({'error':_0x379739(0x10d)});return;}let _0x52ae40=_0x192ecf['folder_name'];if(!_0x52ae40){_0x52ae40=randomUUID();try{await conn['promise']()[_0x379739(0x125)](_0x379739(0x135),[_0x52ae40,_0xb0b71e[_0x379739(0x131)]['email']]);}catch(_0x3de10b){console[_0x379739(0x126)]({'err':_0x3de10b}),_0x34c19e[_0x379739(0x122)](0x1f4)[_0x379739(0x13a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x285587='./uploads/'+_0x52ae40;!fs[_0x379739(0x136)](_0x285587)&&fs[_0x379739(0x11c)](_0x285587);if(!_0xdf8428){const _0x57fd43=new Error(_0x379739(0x133));return _0x57fd43[_0x379739(0x12f)]=0x190,_0x129d18(_0x57fd43);}const _0x18fcef=fs[_0x379739(0x105)](_0x285587)[_0x379739(0x110)]+_0xdf8428['length'];console['log']({'numberOfSize':_0x18fcef});if(_0x18fcef>userFolderMaximumFiles)return _0x34c19e[_0x379739(0x122)](0x190)['json']({'error':_0x379739(0x10b)+userFolderMaximumFiles+'\x20files'});const _0x2a6d58=fs['readdirSync'](_0x285587)['reduce']((_0x2d435e,_0x489be7)=>_0x2d435e+fs[_0x379739(0x11f)](_0x285587+'/'+_0x489be7)[_0x379739(0x123)],0x0),_0x25b46f=_0xdf8428['reduce']((_0x20d65c,_0x729f69)=>_0x20d65c+_0x729f69[_0x379739(0x123)],0x0);console[_0x379739(0x126)]({'totalSize':_0x2a6d58,'uploadedSize':_0x25b46f});if(_0x25b46f+_0x2a6d58>userFolderMaximumSizeInMB*0x400*0x400)return _0x34c19e['status'](0x190)[_0x379739(0x13a)]({'error':_0x379739(0x10b)+userFolderMaximumSizeInMB+_0x379739(0x111)});_0xdf8428[_0x379739(0x10a)](_0x4999a8=>{const _0x2ab31b=_0x379739;fs[_0x2ab31b(0x10c)](_0x4999a8['path'],_0x285587+'/'+_0x4999a8[_0x2ab31b(0x113)]);}),_0x34c19e[_0x379739(0x134)]({'files':_0xdf8428[_0x379739(0x11e)](_0x33c8ae=>({..._0x33c8ae,'path':_0x285587+'/'+_0x33c8ae[_0x379739(0x113)]}))});}),router['post'](a8_0x157df4(0x137),verifyToken,async(_0x260480,_0x3b34f8)=>{const _0x3f9853=a8_0x157df4,{path:_0x46131e,folder_name:_0x518b9a}=_0x260480[_0x3f9853(0x112)],_0x3a4e92=config[_0x3f9853(0x139)];console[_0x3f9853(0x126)]({'path':_0x46131e,'folder_name':_0x518b9a});if(!_0x46131e)return _0x3b34f8[_0x3f9853(0x122)](0x190)['json']({'error':_0x3f9853(0x138)});if(!_0x518b9a)return _0x3b34f8[_0x3f9853(0x122)](0x190)['json']({'error':'Folder\x20name\x20is\x20required'});const _0x475481=_0x46131e+'/'+_0x518b9a;!fs[_0x3f9853(0x136)](_0x475481)&&fs['mkdirSync'](_0x475481),_0x3b34f8[_0x3f9853(0x134)]({'path':_0x475481});}),router['delete'](a8_0x157df4(0x106),verifyToken,async(_0x6bb62f,_0x58c919)=>{const _0x444fca=a8_0x157df4,{isFolder:_0x3b6e1e,path:_0x1891a1}=_0x6bb62f['body'];!_0x3b6e1e?fs[_0x444fca(0x128)](_0x1891a1):fs[_0x444fca(0x10f)](_0x1891a1,{'recursive':!![]}),_0x58c919[_0x444fca(0x134)]({'success':!![]});}),module['exports']=router;