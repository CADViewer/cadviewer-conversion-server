const a8_0x160fdb=a8_0x536c;(function(_0x51da9f,_0x1127a2){const _0x476926=a8_0x536c,_0x3343f7=_0x51da9f();while(!![]){try{const _0x327028=-parseInt(_0x476926(0x173))/0x1+-parseInt(_0x476926(0x17d))/0x2+-parseInt(_0x476926(0x171))/0x3+-parseInt(_0x476926(0x184))/0x4+-parseInt(_0x476926(0x163))/0x5*(-parseInt(_0x476926(0x188))/0x6)+parseInt(_0x476926(0x17e))/0x7*(-parseInt(_0x476926(0x166))/0x8)+-parseInt(_0x476926(0x15c))/0x9*(-parseInt(_0x476926(0x17c))/0xa);if(_0x327028===_0x1127a2)break;else _0x3343f7['push'](_0x3343f7['shift']());}catch(_0x23dfb3){_0x3343f7['push'](_0x3343f7['shift']());}}}(a8_0x3b12,0x9b198));function a8_0x3b12(){const _0x2c2c7b=['renameSync','readdirSync','/folder','statSync','83455lMtHQD','existsSync','json','140432GEYSvY','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','httpStatusCode','reduce','body','array','delete','\x20files','promise','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','uploads','2414514WgCAyz','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','556697GTGGcV','Error!\x20Something\x20went\x20wrong.','mkdirSync','files','user','log','verifyToken','path','express','250fjgoNJ','655014dbzJTc','133vKAFhh','folderLocation','status','../libs/mysql.js','unlinkSync','diskStorage','1129328NEEreL','email','Router','./uploads/','258rrdUnx','\x20MB\x20of\x20files','../CADViewer_config.json','post','map','originalname','forEach','Folder\x20name\x20is\x20required','size','length','send','800091mhbHDB','/files','execute'];a8_0x3b12=function(){return _0x2c2c7b;};return a8_0x3b12();}const multer=require('multer'),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require(a8_0x160fdb(0x181)),verifyToken=require('../libs/jwt')[a8_0x160fdb(0x179)],dir='./uploads';!fs[a8_0x160fdb(0x164)](dir)&&fs[a8_0x160fdb(0x175)](dir);const express=require(a8_0x160fdb(0x17b)),router=express[a8_0x160fdb(0x186)](),config=require(a8_0x160fdb(0x18a)),storage=multer[a8_0x160fdb(0x183)]({'destination':function(_0x5b1756,_0x2b8d39,_0xbc2a3f){const _0x6b9d43=a8_0x160fdb;_0xbc2a3f(null,_0x6b9d43(0x170));}}),upload=multer({'storage':storage});function a8_0x536c(_0x40a70d,_0x436fe6){const _0x3b12e6=a8_0x3b12();return a8_0x536c=function(_0x536c65,_0x5058d7){_0x536c65=_0x536c65-0x156;let _0x1c2585=_0x3b12e6[_0x536c65];return _0x1c2585;},a8_0x536c(_0x40a70d,_0x436fe6);}router[a8_0x160fdb(0x18b)](a8_0x160fdb(0x15d),upload[a8_0x160fdb(0x16b)](a8_0x160fdb(0x176)),verifyToken,async(_0x373524,_0x49ebda,_0xd6addd)=>{const _0x4660e3=a8_0x160fdb,_0xa663bd=_0x373524[_0x4660e3(0x176)],{global:_0x53cba4,path:_0x2780b2}=_0x373524['body'],_0x4581e5=config[_0x4660e3(0x17f)];console[_0x4660e3(0x178)]({'global':_0x53cba4}),console[_0x4660e3(0x178)](_0xa663bd),console[_0x4660e3(0x178)]({'user':_0x373524[_0x4660e3(0x177)]});if(_0x53cba4){_0xa663bd[_0x4660e3(0x157)](_0x57fbcf=>{const _0x7a4f18=_0x4660e3;fs[_0x7a4f18(0x15f)](_0x57fbcf[_0x7a4f18(0x17a)],(_0x2780b2||_0x4581e5)+'/'+_0x57fbcf['originalname']);}),_0x49ebda['send']({'files':_0xa663bd[_0x4660e3(0x18c)](_0x553129=>({..._0x553129,'path':(_0x2780b2||_0x4581e5)+'/'+_0x553129['originalname']}))});return;}let _0x32186b;try{const [_0x1c94f5]=await conn[_0x4660e3(0x16e)]()[_0x4660e3(0x15e)](_0x4660e3(0x172),[_0x373524[_0x4660e3(0x177)][_0x4660e3(0x185)]]);_0x1c94f5['length']>0x0&&(_0x32186b=_0x1c94f5[0x0]);}catch(_0xb986f4){console[_0x4660e3(0x178)]({'err':_0xb986f4}),_0x49ebda[_0x4660e3(0x180)](0x1f4)[_0x4660e3(0x165)]({'error':_0x4660e3(0x174)});return;}if(!_0x32186b){_0x49ebda['status'](0x191)['json']({'error':'Invalid\x20user'});return;}let _0x5ef812=_0x32186b['folder_name'];if(!_0x5ef812){_0x5ef812=randomUUID();try{await conn['promise']()[_0x4660e3(0x15e)](_0x4660e3(0x16f),[_0x5ef812,_0x373524[_0x4660e3(0x177)]['email']]);}catch(_0x1f7ca4){console['log']({'err':_0x1f7ca4}),_0x49ebda[_0x4660e3(0x180)](0x1f4)[_0x4660e3(0x165)]({'error':_0x4660e3(0x174)});return;}}const _0x3dad5c=_0x4660e3(0x187)+_0x5ef812;!fs[_0x4660e3(0x164)](_0x3dad5c)&&fs[_0x4660e3(0x175)](_0x3dad5c);if(!_0xa663bd){const _0xfc0c9f=new Error('Please\x20upload\x20a\x20file');return _0xfc0c9f[_0x4660e3(0x168)]=0x190,_0xd6addd(_0xfc0c9f);}const _0x70f05=fs[_0x4660e3(0x160)](_0x3dad5c)[_0x4660e3(0x15a)]+_0xa663bd[_0x4660e3(0x15a)];console[_0x4660e3(0x178)]({'numberOfSize':_0x70f05});if(_0x70f05>userFolderMaximumFiles)return _0x49ebda[_0x4660e3(0x180)](0x190)['json']({'error':_0x4660e3(0x167)+userFolderMaximumFiles+_0x4660e3(0x16d)});const _0x16e7a8=fs[_0x4660e3(0x160)](_0x3dad5c)[_0x4660e3(0x169)]((_0x580dcc,_0x1489e1)=>_0x580dcc+fs[_0x4660e3(0x162)](_0x3dad5c+'/'+_0x1489e1)[_0x4660e3(0x159)],0x0),_0x5c0706=_0xa663bd[_0x4660e3(0x169)]((_0x48d0fa,_0x541466)=>_0x48d0fa+_0x541466['size'],0x0);console[_0x4660e3(0x178)]({'totalSize':_0x16e7a8,'uploadedSize':_0x5c0706});if(_0x5c0706+_0x16e7a8>userFolderMaximumSizeInMB*0x400*0x400)return _0x49ebda[_0x4660e3(0x180)](0x190)['json']({'error':_0x4660e3(0x167)+userFolderMaximumSizeInMB+_0x4660e3(0x189)});_0xa663bd['forEach'](_0x36d5cc=>{const _0x53840d=_0x4660e3;fs['renameSync'](_0x36d5cc[_0x53840d(0x17a)],_0x3dad5c+'/'+_0x36d5cc[_0x53840d(0x156)]);}),_0x49ebda[_0x4660e3(0x15b)]({'files':_0xa663bd[_0x4660e3(0x18c)](_0x2496f1=>({..._0x2496f1,'path':_0x3dad5c+'/'+_0x2496f1[_0x4660e3(0x156)]}))});}),router[a8_0x160fdb(0x18b)](a8_0x160fdb(0x161),verifyToken,async(_0x44f7a1,_0x1ba94d)=>{const _0x3335bb=a8_0x160fdb,{path:_0x4a4e15,folder_name:_0x5b7265}=_0x44f7a1[_0x3335bb(0x16a)],_0x43587a=config['folderLocation'];console[_0x3335bb(0x178)]({'path':_0x4a4e15,'folder_name':_0x5b7265});if(!_0x4a4e15)return _0x1ba94d['status'](0x190)[_0x3335bb(0x165)]({'error':'Path\x20is\x20required'});if(!_0x5b7265)return _0x1ba94d[_0x3335bb(0x180)](0x190)[_0x3335bb(0x165)]({'error':_0x3335bb(0x158)});const _0x8250f8=_0x4a4e15+'/'+_0x5b7265;!fs[_0x3335bb(0x164)](_0x8250f8)&&fs[_0x3335bb(0x175)](_0x8250f8),_0x1ba94d[_0x3335bb(0x15b)]({'path':_0x8250f8});}),router[a8_0x160fdb(0x16c)]('/remove',verifyToken,async(_0x5cadba,_0x77a78e)=>{const _0x51c66c=a8_0x160fdb,{isFolder:_0x56eba0,path:_0x17d4ee}=_0x5cadba[_0x51c66c(0x16a)];!_0x56eba0?fs[_0x51c66c(0x182)](_0x17d4ee):fs['rmdirSync'](_0x17d4ee,{'recursive':!![]}),_0x77a78e[_0x51c66c(0x15b)]({'success':!![]});}),module['exports']=router;