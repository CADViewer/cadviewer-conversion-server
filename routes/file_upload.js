const a9_0x43be2f=a9_0x10f1;function a9_0x10f1(_0x534200,_0x342cc5){const _0x400768=a9_0x4007();return a9_0x10f1=function(_0x10f124,_0x7ea395){_0x10f124=_0x10f124-0x86;let _0x129e16=_0x400768[_0x10f124];return _0x129e16;},a9_0x10f1(_0x534200,_0x342cc5);}(function(_0x473fdb,_0x221d7f){const _0x353033=a9_0x10f1,_0x28e005=_0x473fdb();while(!![]){try{const _0xd099ed=parseInt(_0x353033(0x90))/0x1+-parseInt(_0x353033(0x8e))/0x2+-parseInt(_0x353033(0x95))/0x3*(-parseInt(_0x353033(0x9b))/0x4)+-parseInt(_0x353033(0xb5))/0x5+-parseInt(_0x353033(0xb1))/0x6+parseInt(_0x353033(0x86))/0x7*(parseInt(_0x353033(0xb4))/0x8)+parseInt(_0x353033(0xa9))/0x9*(parseInt(_0x353033(0x93))/0xa);if(_0xd099ed===_0x221d7f)break;else _0x28e005['push'](_0x28e005['shift']());}catch(_0x4f31eb){_0x28e005['push'](_0x28e005['shift']());}}}(a9_0x4007,0xa46aa));const multer=require(a9_0x43be2f(0xad)),fs=require('fs'),{randomUUID}=require(a9_0x43be2f(0xbb)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a9_0x43be2f(0xa2)),conn=require(a9_0x43be2f(0xaf)),verifyToken=require(a9_0x43be2f(0xb8))[a9_0x43be2f(0x8c)],dir=a9_0x43be2f(0xba);!fs[a9_0x43be2f(0xb2)](dir)&&fs[a9_0x43be2f(0x8b)](dir);function a9_0x4007(){const _0x3e8e37=['537CkmjLB','Error!\x20Something\x20went\x20wrong.','body','/remove','Router','map','5444mSrSJb','post','exports','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','size','Invalid\x20user','\x20MB\x20of\x20files','../CADViewer_config.json','uploads','Folder\x20name\x20is\x20required','status','originalname','log','unlinkSync','9MFrrsR','express','/files','execute','multer','/folder','../libs/mysql.js','length','1217814yzoYdL','existsSync','promise','8shthAr','6410190mdIIKN','./uploads/','reduce','../libs/jwt','forEach','./uploads','crypto','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','user','6543894GcUAkv','email','files','\x20files','readdirSync','mkdirSync','verifyToken','copyFileSync','1564058zxQLIJ','json','840312PjFwhS','send','httpStatusCode','9217130kUEpCF','Path\x20is\x20required'];a9_0x4007=function(){return _0x3e8e37;};return a9_0x4007();}const express=require(a9_0x43be2f(0xaa)),router=express[a9_0x43be2f(0x99)](),config=require('../CADViewer_config.json'),storage=multer['diskStorage']({'destination':function(_0x349341,_0x3766c0,_0x37b138){const _0x3ecb05=a9_0x43be2f;_0x37b138(null,_0x3ecb05(0xa3));}}),upload=multer({'storage':storage});router['post'](a9_0x43be2f(0xab),upload['array'](a9_0x43be2f(0x88)),verifyToken,async(_0xfea0e3,_0x416974,_0x2ab3d6)=>{const _0x180ddb=a9_0x43be2f,_0x456e4b=_0xfea0e3[_0x180ddb(0x88)],{global:_0x37b3a2,path:_0x5af1bc}=_0xfea0e3['body'],_0x247c66=config['folderLocation'];console[_0x180ddb(0xa7)]({'global':_0x37b3a2}),console[_0x180ddb(0xa7)](_0x456e4b),console[_0x180ddb(0xa7)]({'user':_0xfea0e3[_0x180ddb(0xbd)]});if(_0x37b3a2){_0x456e4b[_0x180ddb(0xb9)](_0xcd00ad=>{const _0x100fad=_0x180ddb;fs[_0x100fad(0x8d)](_0xcd00ad['path'],(_0x5af1bc||_0x247c66)+'/'+_0xcd00ad[_0x100fad(0xa6)]),fs['unlinkSync'](_0xcd00ad['path']);}),_0x416974['send']({'files':_0x456e4b[_0x180ddb(0x9a)](_0x29c928=>({..._0x29c928,'path':(_0x5af1bc||_0x247c66)+'/'+_0x29c928['originalname']}))});return;}let _0x25fc98;try{const [_0x313b20]=await conn[_0x180ddb(0xb3)]()[_0x180ddb(0xac)](_0x180ddb(0xbc),[_0xfea0e3['user']['email']]);_0x313b20[_0x180ddb(0xb0)]>0x0&&(_0x25fc98=_0x313b20[0x0]);}catch(_0xd454ba){console[_0x180ddb(0xa7)]({'err':_0xd454ba}),_0x416974[_0x180ddb(0xa5)](0x1f4)[_0x180ddb(0x8f)]({'error':_0x180ddb(0x96)});return;}if(!_0x25fc98){_0x416974['status'](0x191)[_0x180ddb(0x8f)]({'error':_0x180ddb(0xa0)});return;}let _0x14ac23=_0x25fc98['folder_name'];if(!_0x14ac23){_0x14ac23=randomUUID();try{await conn[_0x180ddb(0xb3)]()[_0x180ddb(0xac)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x14ac23,_0xfea0e3[_0x180ddb(0xbd)][_0x180ddb(0x87)]]);}catch(_0x1f4cc8){console['log']({'err':_0x1f4cc8}),_0x416974[_0x180ddb(0xa5)](0x1f4)[_0x180ddb(0x8f)]({'error':_0x180ddb(0x96)});return;}}const _0x4baffc=_0x180ddb(0xb6)+_0x14ac23;!fs[_0x180ddb(0xb2)](_0x4baffc)&&fs[_0x180ddb(0x8b)](_0x4baffc);if(!_0x456e4b){const _0x191c22=new Error('Please\x20upload\x20a\x20file');return _0x191c22[_0x180ddb(0x92)]=0x190,_0x2ab3d6(_0x191c22);}const _0x2a21ea=fs[_0x180ddb(0x8a)](_0x4baffc)[_0x180ddb(0xb0)]+_0x456e4b[_0x180ddb(0xb0)];console[_0x180ddb(0xa7)]({'numberOfSize':_0x2a21ea});if(_0x2a21ea>userFolderMaximumFiles)return _0x416974['status'](0x190)['json']({'error':_0x180ddb(0x9e)+userFolderMaximumFiles+_0x180ddb(0x89)});const _0x22edd8=fs[_0x180ddb(0x8a)](_0x4baffc)[_0x180ddb(0xb7)]((_0x1d2470,_0x11fbec)=>_0x1d2470+fs['statSync'](_0x4baffc+'/'+_0x11fbec)[_0x180ddb(0x9f)],0x0),_0x35a667=_0x456e4b['reduce']((_0x50d7c2,_0x5d631e)=>_0x50d7c2+_0x5d631e[_0x180ddb(0x9f)],0x0);console[_0x180ddb(0xa7)]({'totalSize':_0x22edd8,'uploadedSize':_0x35a667});if(_0x35a667+_0x22edd8>userFolderMaximumSizeInMB*0x400*0x400)return _0x416974[_0x180ddb(0xa5)](0x190)[_0x180ddb(0x8f)]({'error':_0x180ddb(0x9e)+userFolderMaximumSizeInMB+_0x180ddb(0xa1)});_0x456e4b[_0x180ddb(0xb9)](_0x5b9cbb=>{const _0x2eb6f8=_0x180ddb;fs[_0x2eb6f8(0x8d)](_0x5b9cbb['path'],_0x4baffc+'/'+_0x5b9cbb['originalname']),fs[_0x2eb6f8(0xa8)](_0x5b9cbb['path']);}),_0x416974[_0x180ddb(0x91)]({'files':_0x456e4b[_0x180ddb(0x9a)](_0x389448=>({..._0x389448,'path':_0x4baffc+'/'+_0x389448[_0x180ddb(0xa6)]}))});}),router[a9_0x43be2f(0x9c)](a9_0x43be2f(0xae),verifyToken,async(_0x129217,_0x3252ff)=>{const _0x81df1a=a9_0x43be2f,{path:_0x5190c8,folder_name:_0x3574b8}=_0x129217[_0x81df1a(0x97)];console[_0x81df1a(0xa7)]({'path':_0x5190c8,'folder_name':_0x3574b8});if(!_0x5190c8)return _0x3252ff[_0x81df1a(0xa5)](0x190)['json']({'error':_0x81df1a(0x94)});if(!_0x3574b8)return _0x3252ff[_0x81df1a(0xa5)](0x190)[_0x81df1a(0x8f)]({'error':_0x81df1a(0xa4)});const _0x266ebb=_0x5190c8+'/'+_0x3574b8;!fs[_0x81df1a(0xb2)](_0x266ebb)&&fs[_0x81df1a(0x8b)](_0x266ebb),_0x3252ff[_0x81df1a(0x91)]({'path':_0x266ebb});}),router['delete'](a9_0x43be2f(0x98),verifyToken,async(_0x1fa41e,_0x3adf9e)=>{const _0x2ae8c4=a9_0x43be2f,{isFolder:_0x34f093,path:_0x519354}=_0x1fa41e[_0x2ae8c4(0x97)];!_0x34f093?fs['unlinkSync'](_0x519354):fs['rmdirSync'](_0x519354,{'recursive':!![]}),_0x3adf9e[_0x2ae8c4(0x91)]({'success':!![]});}),module[a9_0x43be2f(0x9d)]=router;