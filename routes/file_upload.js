const a8_0x3bd9f9=a8_0x1f4c;(function(_0x5dbb87,_0x74c74c){const _0x33d792=a8_0x1f4c,_0x28a117=_0x5dbb87();while(!![]){try{const _0x2a2d9d=parseInt(_0x33d792(0x190))/0x1+parseInt(_0x33d792(0x17e))/0x2*(parseInt(_0x33d792(0x1aa))/0x3)+parseInt(_0x33d792(0x1a8))/0x4+-parseInt(_0x33d792(0x194))/0x5*(-parseInt(_0x33d792(0x1b8))/0x6)+-parseInt(_0x33d792(0x1ac))/0x7*(parseInt(_0x33d792(0x1a6))/0x8)+parseInt(_0x33d792(0x191))/0x9+-parseInt(_0x33d792(0x19e))/0xa;if(_0x2a2d9d===_0x74c74c)break;else _0x28a117['push'](_0x28a117['shift']());}catch(_0x53603a){_0x28a117['push'](_0x28a117['shift']());}}}(a8_0x29e8,0xef4a0));function a8_0x29e8(){const _0x18c005=['renameSync','../libs/jwt','209778BsculG','/folder','express','size','Path\x20is\x20required','map','body','../CADViewer_config.json','../libs/mysql.js','log','array','originalname','exports','reduce','crypto','readdirSync','existsSync','/files','356597ubsNBq','1608210qQQYWt','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','json','35XLEgrt','rmdirSync','mkdirSync','send','statSync','user','email','Error!\x20Something\x20went\x20wrong.','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','forEach','11442990WdXsTn','Router','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','length','execute','folderLocation','./uploads/','path','8ugqClJ','status','5184480pLzOUc','diskStorage','39mhvTnp','promise','8258257FXErMb','/remove','files','httpStatusCode','Folder\x20name\x20is\x20required','./uploads','\x20files','unlinkSync','verifyToken','Invalid\x20user','folder_name','Please\x20upload\x20a\x20file','93612mEYmOM','post','delete'];a8_0x29e8=function(){return _0x18c005;};return a8_0x29e8();}const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a8_0x3bd9f9(0x18c)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require(a8_0x3bd9f9(0x186)),verifyToken=require(a8_0x3bd9f9(0x1bc))[a8_0x3bd9f9(0x1b4)],dir=a8_0x3bd9f9(0x1b1);function a8_0x1f4c(_0xd2806d,_0x5c6c03){const _0x29e8f3=a8_0x29e8();return a8_0x1f4c=function(_0x1f4cac,_0x22526e){_0x1f4cac=_0x1f4cac-0x17e;let _0x21d06c=_0x29e8f3[_0x1f4cac];return _0x21d06c;},a8_0x1f4c(_0xd2806d,_0x5c6c03);}!fs[a8_0x3bd9f9(0x18e)](dir)&&fs['mkdirSync'](dir);const express=require(a8_0x3bd9f9(0x180)),router=express[a8_0x3bd9f9(0x19f)](),config=require(a8_0x3bd9f9(0x185)),storage=multer[a8_0x3bd9f9(0x1a9)]({'destination':function(_0x35f4a3,_0x568d5c,_0x3d5000){_0x3d5000(null,'uploads');}}),upload=multer({'storage':storage});router[a8_0x3bd9f9(0x1b9)](a8_0x3bd9f9(0x18f),upload[a8_0x3bd9f9(0x188)](a8_0x3bd9f9(0x1ae)),verifyToken,async(_0x4cfdd7,_0x1c3d61,_0x54105c)=>{const _0x28814a=a8_0x3bd9f9,_0x427ae8=_0x4cfdd7['files'],{global:_0x42f3b7,path:_0x2b71f6}=_0x4cfdd7[_0x28814a(0x184)],_0x2da204=config[_0x28814a(0x1a3)];console[_0x28814a(0x187)]({'global':_0x42f3b7}),console[_0x28814a(0x187)](_0x427ae8),console[_0x28814a(0x187)]({'user':_0x4cfdd7['user']});if(_0x42f3b7){_0x427ae8[_0x28814a(0x19d)](_0x2e264e=>{const _0x38f7eb=_0x28814a;fs[_0x38f7eb(0x1bb)](_0x2e264e[_0x38f7eb(0x1a5)],(_0x2b71f6||_0x2da204)+'/'+_0x2e264e[_0x38f7eb(0x189)]);}),_0x1c3d61[_0x28814a(0x197)]({'files':_0x427ae8['map'](_0x17ad9c=>({..._0x17ad9c,'path':(_0x2b71f6||_0x2da204)+'/'+_0x17ad9c['originalname']}))});return;}let _0x4db994;try{const [_0x5b8555]=await conn[_0x28814a(0x1ab)]()[_0x28814a(0x1a2)](_0x28814a(0x19c),[_0x4cfdd7['user'][_0x28814a(0x19a)]]);_0x5b8555[_0x28814a(0x1a1)]>0x0&&(_0x4db994=_0x5b8555[0x0]);}catch(_0x30d360){console['log']({'err':_0x30d360}),_0x1c3d61[_0x28814a(0x1a7)](0x1f4)[_0x28814a(0x193)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x4db994){_0x1c3d61['status'](0x191)['json']({'error':_0x28814a(0x1b5)});return;}let _0x2a9f58=_0x4db994[_0x28814a(0x1b6)];if(!_0x2a9f58){_0x2a9f58=randomUUID();try{await conn[_0x28814a(0x1ab)]()['execute'](_0x28814a(0x192),[_0x2a9f58,_0x4cfdd7[_0x28814a(0x199)][_0x28814a(0x19a)]]);}catch(_0x19ca5d){console[_0x28814a(0x187)]({'err':_0x19ca5d}),_0x1c3d61[_0x28814a(0x1a7)](0x1f4)[_0x28814a(0x193)]({'error':_0x28814a(0x19b)});return;}}const _0xd8641c=_0x28814a(0x1a4)+_0x2a9f58;!fs[_0x28814a(0x18e)](_0xd8641c)&&fs[_0x28814a(0x196)](_0xd8641c);if(!_0x427ae8){const _0x4300f4=new Error(_0x28814a(0x1b7));return _0x4300f4[_0x28814a(0x1af)]=0x190,_0x54105c(_0x4300f4);}const _0x37625c=fs[_0x28814a(0x18d)](_0xd8641c)[_0x28814a(0x1a1)]+_0x427ae8[_0x28814a(0x1a1)];console[_0x28814a(0x187)]({'numberOfSize':_0x37625c});if(_0x37625c>userFolderMaximumFiles)return _0x1c3d61[_0x28814a(0x1a7)](0x190)['json']({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+_0x28814a(0x1b2)});const _0x281a86=fs[_0x28814a(0x18d)](_0xd8641c)[_0x28814a(0x18b)]((_0x352ee5,_0xb344c9)=>_0x352ee5+fs[_0x28814a(0x198)](_0xd8641c+'/'+_0xb344c9)[_0x28814a(0x181)],0x0),_0x17519b=_0x427ae8['reduce']((_0x298cae,_0x3a1f15)=>_0x298cae+_0x3a1f15[_0x28814a(0x181)],0x0);console[_0x28814a(0x187)]({'totalSize':_0x281a86,'uploadedSize':_0x17519b});if(_0x17519b+_0x281a86>userFolderMaximumSizeInMB*0x400*0x400)return _0x1c3d61[_0x28814a(0x1a7)](0x190)['json']({'error':_0x28814a(0x1a0)+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x427ae8[_0x28814a(0x19d)](_0x4d476e=>{const _0x1e824b=_0x28814a;fs[_0x1e824b(0x1bb)](_0x4d476e['path'],_0xd8641c+'/'+_0x4d476e[_0x1e824b(0x189)]);}),_0x1c3d61['send']({'files':_0x427ae8[_0x28814a(0x183)](_0x1b40d7=>({..._0x1b40d7,'path':_0xd8641c+'/'+_0x1b40d7[_0x28814a(0x189)]}))});}),router[a8_0x3bd9f9(0x1b9)](a8_0x3bd9f9(0x17f),verifyToken,async(_0x2045d4,_0x3ec562)=>{const _0x33a587=a8_0x3bd9f9,{path:_0x5a1c23,folder_name:_0x2c4e35}=_0x2045d4['body'],_0x4989eb=config[_0x33a587(0x1a3)];console[_0x33a587(0x187)]({'path':_0x5a1c23,'folder_name':_0x2c4e35});if(!_0x5a1c23)return _0x3ec562[_0x33a587(0x1a7)](0x190)[_0x33a587(0x193)]({'error':_0x33a587(0x182)});if(!_0x2c4e35)return _0x3ec562[_0x33a587(0x1a7)](0x190)[_0x33a587(0x193)]({'error':_0x33a587(0x1b0)});const _0x2ab343=_0x5a1c23+'/'+_0x2c4e35;!fs['existsSync'](_0x2ab343)&&fs[_0x33a587(0x196)](_0x2ab343),_0x3ec562['send']({'path':_0x2ab343});}),router[a8_0x3bd9f9(0x1ba)](a8_0x3bd9f9(0x1ad),verifyToken,async(_0x419edb,_0x5edf07)=>{const _0x5b313b=a8_0x3bd9f9,{isFolder:_0x2d4544,path:_0x4586a4}=_0x419edb[_0x5b313b(0x184)];!_0x2d4544?fs[_0x5b313b(0x1b3)](_0x4586a4):fs[_0x5b313b(0x195)](_0x4586a4,{'recursive':!![]}),_0x5edf07[_0x5b313b(0x197)]({'success':!![]});}),module[a8_0x3bd9f9(0x18a)]=router;