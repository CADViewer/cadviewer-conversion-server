const a8_0x2facb9=a8_0xb739;function a8_0x40fd(){const _0x5ebba1=['622750KWTkxB','map','json','body','Folder\x20name\x20is\x20required','1620mvplRU','9BjnFcC','../CADViewer_config.json','email','send','forEach','size','unlinkSync','express','580GqQGnD','22dnUuay','713682zVvQQO','path','promise','existsSync','3751980GmBZUL','length','array','1206681DlGUwC','files','folder_name','/remove','multer','copyFileSync','Path\x20is\x20required','readdirSync','user','diskStorage','originalname','933mfZJkv','./uploads','mkdirSync','log','exports','\x20MB\x20of\x20files','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','/folder','Router','status','folderLocation','/files','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','../libs/mysql.js','rmdirSync','29856QQLxZu','Invalid\x20user','execute','Error!\x20Something\x20went\x20wrong.','3986256qEmDAb','reduce','delete','../libs/jwt','verifyToken','post'];a8_0x40fd=function(){return _0x5ebba1;};return a8_0x40fd();}(function(_0x90e27e,_0x5062ca){const _0x3d6873=a8_0xb739,_0x44c571=_0x90e27e();while(!![]){try{const _0x537fa8=parseInt(_0x3d6873(0x1f0))/0x1+parseInt(_0x3d6873(0x21b))/0x2+parseInt(_0x3d6873(0x202))/0x3*(-parseInt(_0x3d6873(0x1e5))/0x4)+-parseInt(_0x3d6873(0x1ee))/0x5*(-parseInt(_0x3d6873(0x211))/0x6)+parseInt(_0x3d6873(0x1f7))/0x7+parseInt(_0x3d6873(0x215))/0x8*(-parseInt(_0x3d6873(0x1e6))/0x9)+parseInt(_0x3d6873(0x1f4))/0xa*(-parseInt(_0x3d6873(0x1ef))/0xb);if(_0x537fa8===_0x5062ca)break;else _0x44c571['push'](_0x44c571['shift']());}catch(_0x572792){_0x44c571['push'](_0x44c571['shift']());}}}(a8_0x40fd,0x61a97));const multer=require(a8_0x2facb9(0x1fb)),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require(a8_0x2facb9(0x20f)),verifyToken=require(a8_0x2facb9(0x218))[a8_0x2facb9(0x219)],dir=a8_0x2facb9(0x203);!fs[a8_0x2facb9(0x1f3)](dir)&&fs[a8_0x2facb9(0x204)](dir);const express=require(a8_0x2facb9(0x1ed)),router=express[a8_0x2facb9(0x20a)](),config=require(a8_0x2facb9(0x1e7)),storage=multer[a8_0x2facb9(0x200)]({'destination':function(_0x5a83fe,_0x555bbe,_0x251bf1){_0x251bf1(null,'uploads');}}),upload=multer({'storage':storage});function a8_0xb739(_0x739714,_0x299836){const _0x40fdff=a8_0x40fd();return a8_0xb739=function(_0xb739eb,_0x4a0eef){_0xb739eb=_0xb739eb-0x1e1;let _0x210d65=_0x40fdff[_0xb739eb];return _0x210d65;},a8_0xb739(_0x739714,_0x299836);}router[a8_0x2facb9(0x21a)](a8_0x2facb9(0x20d),upload[a8_0x2facb9(0x1f6)](a8_0x2facb9(0x1f8)),verifyToken,async(_0x33063a,_0x5d9f36,_0x3e8f91)=>{const _0x44ccd7=a8_0x2facb9,_0x313ce9=_0x33063a[_0x44ccd7(0x1f8)],{global:_0xd97e4a,path:_0x4f4267}=_0x33063a[_0x44ccd7(0x1e3)],_0x3e3ca6=config[_0x44ccd7(0x20c)];console[_0x44ccd7(0x205)]({'global':_0xd97e4a}),console['log'](_0x313ce9),console[_0x44ccd7(0x205)]({'user':_0x33063a[_0x44ccd7(0x1ff)]});if(_0xd97e4a){_0x313ce9['forEach'](_0x476cf7=>{const _0x5f415b=_0x44ccd7;fs[_0x5f415b(0x1fc)](_0x476cf7[_0x5f415b(0x1f1)],(_0x4f4267||_0x3e3ca6)+'/'+_0x476cf7[_0x5f415b(0x201)]),fs['unlinkSync'](_0x476cf7[_0x5f415b(0x1f1)]);}),_0x5d9f36[_0x44ccd7(0x1e9)]({'files':_0x313ce9['map'](_0x248a61=>({..._0x248a61,'path':(_0x4f4267||_0x3e3ca6)+'/'+_0x248a61[_0x44ccd7(0x201)]}))});return;}let _0x30348f;try{const [_0x2c55a5]=await conn[_0x44ccd7(0x1f2)]()[_0x44ccd7(0x213)](_0x44ccd7(0x20e),[_0x33063a['user']['email']]);_0x2c55a5[_0x44ccd7(0x1f5)]>0x0&&(_0x30348f=_0x2c55a5[0x0]);}catch(_0x1ec796){console['log']({'err':_0x1ec796}),_0x5d9f36[_0x44ccd7(0x20b)](0x1f4)[_0x44ccd7(0x1e2)]({'error':_0x44ccd7(0x214)});return;}if(!_0x30348f){_0x5d9f36[_0x44ccd7(0x20b)](0x191)[_0x44ccd7(0x1e2)]({'error':_0x44ccd7(0x212)});return;}let _0x18593f=_0x30348f[_0x44ccd7(0x1f9)];if(!_0x18593f){_0x18593f=randomUUID();try{await conn[_0x44ccd7(0x1f2)]()[_0x44ccd7(0x213)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x18593f,_0x33063a[_0x44ccd7(0x1ff)][_0x44ccd7(0x1e8)]]);}catch(_0x3567f9){console['log']({'err':_0x3567f9}),_0x5d9f36[_0x44ccd7(0x20b)](0x1f4)[_0x44ccd7(0x1e2)]({'error':_0x44ccd7(0x214)});return;}}const _0x5598b3='./uploads/'+_0x18593f;!fs['existsSync'](_0x5598b3)&&fs['mkdirSync'](_0x5598b3);if(!_0x313ce9){const _0x59219f=new Error('Please\x20upload\x20a\x20file');return _0x59219f['httpStatusCode']=0x190,_0x3e8f91(_0x59219f);}const _0x37252c=fs[_0x44ccd7(0x1fe)](_0x5598b3)[_0x44ccd7(0x1f5)]+_0x313ce9[_0x44ccd7(0x1f5)];console[_0x44ccd7(0x205)]({'numberOfSize':_0x37252c});if(_0x37252c>userFolderMaximumFiles)return _0x5d9f36['status'](0x190)[_0x44ccd7(0x1e2)]({'error':_0x44ccd7(0x208)+userFolderMaximumFiles+'\x20files'});const _0x411d8e=fs[_0x44ccd7(0x1fe)](_0x5598b3)[_0x44ccd7(0x216)]((_0x4cd712,_0x362476)=>_0x4cd712+fs['statSync'](_0x5598b3+'/'+_0x362476)['size'],0x0),_0xf336c1=_0x313ce9[_0x44ccd7(0x216)]((_0x4e229a,_0x246175)=>_0x4e229a+_0x246175[_0x44ccd7(0x1eb)],0x0);console[_0x44ccd7(0x205)]({'totalSize':_0x411d8e,'uploadedSize':_0xf336c1});if(_0xf336c1+_0x411d8e>userFolderMaximumSizeInMB*0x400*0x400)return _0x5d9f36[_0x44ccd7(0x20b)](0x190)[_0x44ccd7(0x1e2)]({'error':_0x44ccd7(0x208)+userFolderMaximumSizeInMB+_0x44ccd7(0x207)});_0x313ce9[_0x44ccd7(0x1ea)](_0x343119=>{const _0x3c6c80=_0x44ccd7;fs[_0x3c6c80(0x1fc)](_0x343119[_0x3c6c80(0x1f1)],_0x5598b3+'/'+_0x343119[_0x3c6c80(0x201)]),fs[_0x3c6c80(0x1ec)](_0x343119[_0x3c6c80(0x1f1)]);}),_0x5d9f36['send']({'files':_0x313ce9[_0x44ccd7(0x1e1)](_0x514689=>({..._0x514689,'path':_0x5598b3+'/'+_0x514689['originalname']}))});}),router['post'](a8_0x2facb9(0x209),verifyToken,async(_0x2a21fe,_0x5a2c11)=>{const _0x1f70ae=a8_0x2facb9,{path:_0x408af1,folder_name:_0x4d14bb}=_0x2a21fe[_0x1f70ae(0x1e3)];console[_0x1f70ae(0x205)]({'path':_0x408af1,'folder_name':_0x4d14bb});if(!_0x408af1)return _0x5a2c11[_0x1f70ae(0x20b)](0x190)[_0x1f70ae(0x1e2)]({'error':_0x1f70ae(0x1fd)});if(!_0x4d14bb)return _0x5a2c11[_0x1f70ae(0x20b)](0x190)['json']({'error':_0x1f70ae(0x1e4)});const _0x1b2487=_0x408af1+'/'+_0x4d14bb;!fs[_0x1f70ae(0x1f3)](_0x1b2487)&&fs['mkdirSync'](_0x1b2487),_0x5a2c11[_0x1f70ae(0x1e9)]({'path':_0x1b2487});}),router[a8_0x2facb9(0x217)](a8_0x2facb9(0x1fa),verifyToken,async(_0x36fe50,_0x331728)=>{const _0x6e834a=a8_0x2facb9,{isFolder:_0x2dd3da,path:_0x47026c}=_0x36fe50[_0x6e834a(0x1e3)];!_0x2dd3da?fs[_0x6e834a(0x1ec)](_0x47026c):fs[_0x6e834a(0x210)](_0x47026c,{'recursive':!![]}),_0x331728[_0x6e834a(0x1e9)]({'success':!![]});}),module[a8_0x2facb9(0x206)]=router;