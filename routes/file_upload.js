const a9_0x4b69c8=a9_0x3706;function a9_0x21b0(){const _0xf24ebb=['path','reduce','90NBRDoY','json','files','crypto','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','diskStorage','uploads','\x20MB\x20of\x20files','log','status','post','/folder','httpStatusCode','../CADViewer_config.json','381830XyOhsV','forEach','originalname','9lqUqbt','Path\x20is\x20required','existsSync','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','readdirSync','unlinkSync','array','../libs/jwt','mkdirSync','user','copyFileSync','Invalid\x20user','email','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','length','6NExTmO','./uploads','execute','verifyToken','rmdirSync','1034096QcxaXA','size','Please\x20upload\x20a\x20file','Error!\x20Something\x20went\x20wrong.','promise','exports','368747cEImes','Folder\x20name\x20is\x20required','/files','send','folderLocation','body','folder_name','/remove','704jyGUic','Router','map','14512278AVdhkM','12821640WTHySK','65214rYuJKi','2112212xRLvNp','express'];a9_0x21b0=function(){return _0xf24ebb;};return a9_0x21b0();}(function(_0x41d0c5,_0x525fe4){const _0x45032d=a9_0x3706,_0x282912=_0x41d0c5();while(!![]){try{const _0x25e8f5=parseInt(_0x45032d(0x1e2))/0x1*(parseInt(_0x45032d(0x1d7))/0x2)+-parseInt(_0x45032d(0x1c8))/0x3*(-parseInt(_0x45032d(0x1f0))/0x4)+parseInt(_0x45032d(0x1c5))/0x5*(-parseInt(_0x45032d(0x1f4))/0x6)+-parseInt(_0x45032d(0x1dc))/0x7+-parseInt(_0x45032d(0x1ea))/0x8*(parseInt(_0x45032d(0x1ef))/0x9)+-parseInt(_0x45032d(0x1ee))/0xa+parseInt(_0x45032d(0x1ed))/0xb;if(_0x25e8f5===_0x525fe4)break;else _0x282912['push'](_0x282912['shift']());}catch(_0x5931d3){_0x282912['push'](_0x282912['shift']());}}}(a9_0x21b0,0xc27fc));const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a9_0x4b69c8(0x1f7)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a9_0x4b69c8(0x1c4)),conn=require('../libs/mysql.js'),verifyToken=require(a9_0x4b69c8(0x1cf))[a9_0x4b69c8(0x1da)],dir=a9_0x4b69c8(0x1d8);function a9_0x3706(_0x3a738a,_0x416d72){const _0x21b078=a9_0x21b0();return a9_0x3706=function(_0x370615,_0xf63751){_0x370615=_0x370615-0x1bf;let _0x42e17a=_0x21b078[_0x370615];return _0x42e17a;},a9_0x3706(_0x3a738a,_0x416d72);}!fs['existsSync'](dir)&&fs[a9_0x4b69c8(0x1d0)](dir);const express=require(a9_0x4b69c8(0x1f1)),router=express[a9_0x4b69c8(0x1eb)](),config=require(a9_0x4b69c8(0x1c4)),storage=multer[a9_0x4b69c8(0x1f9)]({'destination':function(_0x377800,_0x51536e,_0x414fc4){const _0x3a728a=a9_0x4b69c8;_0x414fc4(null,_0x3a728a(0x1fa));}}),upload=multer({'storage':storage});router[a9_0x4b69c8(0x1c1)](a9_0x4b69c8(0x1e4),upload[a9_0x4b69c8(0x1ce)](a9_0x4b69c8(0x1f6)),verifyToken,async(_0x125d0c,_0xfe96fc,_0x33e16a)=>{const _0x3ed41d=a9_0x4b69c8,_0x19816a=_0x125d0c[_0x3ed41d(0x1f6)],{global:_0x22e9d9,path:_0x1a3226}=_0x125d0c[_0x3ed41d(0x1e7)],_0x5a6f7d=config[_0x3ed41d(0x1e6)];console['log']({'global':_0x22e9d9}),console[_0x3ed41d(0x1bf)](_0x19816a),console['log']({'user':_0x125d0c[_0x3ed41d(0x1d1)]});if(_0x22e9d9){_0x19816a[_0x3ed41d(0x1c6)](_0x21b192=>{const _0x3313d2=_0x3ed41d;fs[_0x3313d2(0x1d2)](_0x21b192['path'],(_0x1a3226||_0x5a6f7d)+'/'+_0x21b192[_0x3313d2(0x1c7)]),fs[_0x3313d2(0x1cd)](_0x21b192[_0x3313d2(0x1f2)]);}),_0xfe96fc[_0x3ed41d(0x1e5)]({'files':_0x19816a['map'](_0x451aba=>({..._0x451aba,'path':(_0x1a3226||_0x5a6f7d)+'/'+_0x451aba['originalname']}))});return;}let _0x5a8e30;try{const [_0xedd077]=await conn[_0x3ed41d(0x1e0)]()[_0x3ed41d(0x1d9)](_0x3ed41d(0x1f8),[_0x125d0c['user'][_0x3ed41d(0x1d4)]]);_0xedd077[_0x3ed41d(0x1d6)]>0x0&&(_0x5a8e30=_0xedd077[0x0]);}catch(_0x42f206){console[_0x3ed41d(0x1bf)]({'err':_0x42f206}),_0xfe96fc[_0x3ed41d(0x1c0)](0x1f4)[_0x3ed41d(0x1f5)]({'error':_0x3ed41d(0x1df)});return;}if(!_0x5a8e30){_0xfe96fc[_0x3ed41d(0x1c0)](0x191)[_0x3ed41d(0x1f5)]({'error':_0x3ed41d(0x1d3)});return;}let _0x85d2ca=_0x5a8e30[_0x3ed41d(0x1e8)];if(!_0x85d2ca){_0x85d2ca=randomUUID();try{await conn[_0x3ed41d(0x1e0)]()[_0x3ed41d(0x1d9)](_0x3ed41d(0x1d5),[_0x85d2ca,_0x125d0c[_0x3ed41d(0x1d1)]['email']]);}catch(_0xe27081){console[_0x3ed41d(0x1bf)]({'err':_0xe27081}),_0xfe96fc[_0x3ed41d(0x1c0)](0x1f4)[_0x3ed41d(0x1f5)]({'error':_0x3ed41d(0x1df)});return;}}const _0x45355e='./uploads/'+_0x85d2ca;!fs[_0x3ed41d(0x1ca)](_0x45355e)&&fs['mkdirSync'](_0x45355e);if(!_0x19816a){const _0x5353cc=new Error(_0x3ed41d(0x1de));return _0x5353cc[_0x3ed41d(0x1c3)]=0x190,_0x33e16a(_0x5353cc);}const _0x3fa1e9=fs[_0x3ed41d(0x1cc)](_0x45355e)[_0x3ed41d(0x1d6)]+_0x19816a['length'];console[_0x3ed41d(0x1bf)]({'numberOfSize':_0x3fa1e9});if(_0x3fa1e9>userFolderMaximumFiles)return _0xfe96fc[_0x3ed41d(0x1c0)](0x190)[_0x3ed41d(0x1f5)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+'\x20files'});const _0x1f2815=fs[_0x3ed41d(0x1cc)](_0x45355e)[_0x3ed41d(0x1f3)]((_0x26f2d2,_0x411985)=>_0x26f2d2+fs['statSync'](_0x45355e+'/'+_0x411985)['size'],0x0),_0x409758=_0x19816a[_0x3ed41d(0x1f3)]((_0x279cfc,_0x44297a)=>_0x279cfc+_0x44297a[_0x3ed41d(0x1dd)],0x0);console[_0x3ed41d(0x1bf)]({'totalSize':_0x1f2815,'uploadedSize':_0x409758});if(_0x409758+_0x1f2815>userFolderMaximumSizeInMB*0x400*0x400)return _0xfe96fc['status'](0x190)['json']({'error':_0x3ed41d(0x1cb)+userFolderMaximumSizeInMB+_0x3ed41d(0x1fb)});_0x19816a[_0x3ed41d(0x1c6)](_0x45584f=>{const _0x1848ce=_0x3ed41d;fs['copyFileSync'](_0x45584f[_0x1848ce(0x1f2)],_0x45355e+'/'+_0x45584f['originalname']),fs[_0x1848ce(0x1cd)](_0x45584f[_0x1848ce(0x1f2)]);}),_0xfe96fc[_0x3ed41d(0x1e5)]({'files':_0x19816a[_0x3ed41d(0x1ec)](_0xe4cdf=>({..._0xe4cdf,'path':_0x45355e+'/'+_0xe4cdf[_0x3ed41d(0x1c7)]}))});}),router[a9_0x4b69c8(0x1c1)](a9_0x4b69c8(0x1c2),verifyToken,async(_0x17d721,_0x45c454)=>{const _0x3f163c=a9_0x4b69c8,{path:_0x561e56,folder_name:_0x57695c}=_0x17d721[_0x3f163c(0x1e7)];console[_0x3f163c(0x1bf)]({'path':_0x561e56,'folder_name':_0x57695c});if(!_0x561e56)return _0x45c454[_0x3f163c(0x1c0)](0x190)['json']({'error':_0x3f163c(0x1c9)});if(!_0x57695c)return _0x45c454[_0x3f163c(0x1c0)](0x190)[_0x3f163c(0x1f5)]({'error':_0x3f163c(0x1e3)});const _0xaaf895=_0x561e56+'/'+_0x57695c;!fs[_0x3f163c(0x1ca)](_0xaaf895)&&fs[_0x3f163c(0x1d0)](_0xaaf895),_0x45c454['send']({'path':_0xaaf895});}),router['delete'](a9_0x4b69c8(0x1e9),verifyToken,async(_0x28a068,_0x4951e2)=>{const _0x3553ce=a9_0x4b69c8,{isFolder:_0x313eab,path:_0x194750}=_0x28a068[_0x3553ce(0x1e7)];!_0x313eab?fs[_0x3553ce(0x1cd)](_0x194750):fs[_0x3553ce(0x1db)](_0x194750,{'recursive':!![]}),_0x4951e2[_0x3553ce(0x1e5)]({'success':!![]});}),module[a9_0x4b69c8(0x1e1)]=router;