const a8_0x300625=a8_0x4907;function a8_0x5228(){const _0x55cae6=['multer','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','Folder\x20name\x20is\x20required','forEach','/folder','20TbQbqM','17aYumqd','log','originalname','httpStatusCode','4iRsqxH','8138494udEcHt','1423088BBeRTj','5279952labzjA','json','3095691AbxiLT','Error!\x20Something\x20went\x20wrong.','folder_name','path','existsSync','../libs/jwt','unlinkSync','copyFileSync','size','readdirSync','post','mkdirSync','../libs/mysql.js','express','1717190uhJABV','\x20files','./uploads','delete','/remove','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','diskStorage','execute','send','files','length','body','../CADViewer_config.json','111420pIPBcj','./uploads/','email','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','map','verifyToken','13395402kGbvel','promise','status','exports','reduce','rmdirSync','user'];a8_0x5228=function(){return _0x55cae6;};return a8_0x5228();}(function(_0x130697,_0x791b3f){const _0x5ad047=a8_0x4907,_0x2202e6=_0x130697();while(!![]){try{const _0x248c4a=parseInt(_0x5ad047(0x200))/0x1*(parseInt(_0x5ad047(0x1ed))/0x2)+parseInt(_0x5ad047(0x209))/0x3*(-parseInt(_0x5ad047(0x204))/0x4)+-parseInt(_0x5ad047(0x1e0))/0x5+-parseInt(_0x5ad047(0x207))/0x6+-parseInt(_0x5ad047(0x205))/0x7+parseInt(_0x5ad047(0x206))/0x8+parseInt(_0x5ad047(0x1f3))/0x9*(parseInt(_0x5ad047(0x1ff))/0xa);if(_0x248c4a===_0x791b3f)break;else _0x2202e6['push'](_0x2202e6['shift']());}catch(_0x48f6f0){_0x2202e6['push'](_0x2202e6['shift']());}}}(a8_0x5228,0xa6edf));const multer=require(a8_0x300625(0x1fa)),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x300625(0x1ec)),conn=require(a8_0x300625(0x1de)),verifyToken=require(a8_0x300625(0x1d7))[a8_0x300625(0x1f2)],dir=a8_0x300625(0x1e2);!fs[a8_0x300625(0x1d6)](dir)&&fs[a8_0x300625(0x1dd)](dir);const express=require(a8_0x300625(0x1df)),router=express['Router'](),config=require(a8_0x300625(0x1ec)),storage=multer[a8_0x300625(0x1e6)]({'destination':function(_0xb33779,_0x1a74ba,_0x14e956){_0x14e956(null,'uploads');}}),upload=multer({'storage':storage});function a8_0x4907(_0x2cbcd7,_0x437ed9){const _0x5228b7=a8_0x5228();return a8_0x4907=function(_0x490771,_0x41209c){_0x490771=_0x490771-0x1d3;let _0x4e1154=_0x5228b7[_0x490771];return _0x4e1154;},a8_0x4907(_0x2cbcd7,_0x437ed9);}router[a8_0x300625(0x1dc)]('/files',upload['array'](a8_0x300625(0x1e9)),verifyToken,async(_0x324701,_0x3cf790,_0xeedb84)=>{const _0x113653=a8_0x300625,_0x53ee0c=_0x324701[_0x113653(0x1e9)],{global:_0x397306,path:_0xcb7a20}=_0x324701[_0x113653(0x1eb)],_0x41d4ef=config['folderLocation'];console[_0x113653(0x201)]({'global':_0x397306}),console[_0x113653(0x201)](_0x53ee0c),console[_0x113653(0x201)]({'user':_0x324701[_0x113653(0x1f9)]});if(_0x397306){_0x53ee0c[_0x113653(0x1fd)](_0xbb00a4=>{const _0xdb55cc=_0x113653;fs[_0xdb55cc(0x1d9)](_0xbb00a4[_0xdb55cc(0x1d5)],(_0xcb7a20||_0x41d4ef)+'/'+_0xbb00a4[_0xdb55cc(0x202)]),fs[_0xdb55cc(0x1d8)](_0xbb00a4[_0xdb55cc(0x1d5)]);}),_0x3cf790[_0x113653(0x1e8)]({'files':_0x53ee0c[_0x113653(0x1f1)](_0x1b63b1=>({..._0x1b63b1,'path':(_0xcb7a20||_0x41d4ef)+'/'+_0x1b63b1[_0x113653(0x202)]}))});return;}let _0x4604a7;try{const [_0x33382f]=await conn[_0x113653(0x1f4)]()['execute'](_0x113653(0x1e5),[_0x324701[_0x113653(0x1f9)][_0x113653(0x1ef)]]);_0x33382f[_0x113653(0x1ea)]>0x0&&(_0x4604a7=_0x33382f[0x0]);}catch(_0x3ef50b){console[_0x113653(0x201)]({'err':_0x3ef50b}),_0x3cf790['status'](0x1f4)[_0x113653(0x208)]({'error':_0x113653(0x1d3)});return;}if(!_0x4604a7){_0x3cf790[_0x113653(0x1f5)](0x191)[_0x113653(0x208)]({'error':'Invalid\x20user'});return;}let _0x3c78f3=_0x4604a7[_0x113653(0x1d4)];if(!_0x3c78f3){_0x3c78f3=randomUUID();try{await conn[_0x113653(0x1f4)]()[_0x113653(0x1e7)](_0x113653(0x1fb),[_0x3c78f3,_0x324701[_0x113653(0x1f9)][_0x113653(0x1ef)]]);}catch(_0x20fe46){console[_0x113653(0x201)]({'err':_0x20fe46}),_0x3cf790[_0x113653(0x1f5)](0x1f4)[_0x113653(0x208)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x1ab51e=_0x113653(0x1ee)+_0x3c78f3;!fs[_0x113653(0x1d6)](_0x1ab51e)&&fs[_0x113653(0x1dd)](_0x1ab51e);if(!_0x53ee0c){const _0x23e749=new Error('Please\x20upload\x20a\x20file');return _0x23e749[_0x113653(0x203)]=0x190,_0xeedb84(_0x23e749);}const _0x33dc13=fs[_0x113653(0x1db)](_0x1ab51e)[_0x113653(0x1ea)]+_0x53ee0c[_0x113653(0x1ea)];console[_0x113653(0x201)]({'numberOfSize':_0x33dc13});if(_0x33dc13>userFolderMaximumFiles)return _0x3cf790[_0x113653(0x1f5)](0x190)[_0x113653(0x208)]({'error':_0x113653(0x1f0)+userFolderMaximumFiles+_0x113653(0x1e1)});const _0x3d1263=fs['readdirSync'](_0x1ab51e)['reduce']((_0x50731b,_0x5634fc)=>_0x50731b+fs['statSync'](_0x1ab51e+'/'+_0x5634fc)[_0x113653(0x1da)],0x0),_0x3f44a5=_0x53ee0c[_0x113653(0x1f7)]((_0x4a2337,_0xb8a8c8)=>_0x4a2337+_0xb8a8c8[_0x113653(0x1da)],0x0);console[_0x113653(0x201)]({'totalSize':_0x3d1263,'uploadedSize':_0x3f44a5});if(_0x3f44a5+_0x3d1263>userFolderMaximumSizeInMB*0x400*0x400)return _0x3cf790[_0x113653(0x1f5)](0x190)[_0x113653(0x208)]({'error':_0x113653(0x1f0)+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x53ee0c[_0x113653(0x1fd)](_0x35da8f=>{const _0x352c33=_0x113653;fs[_0x352c33(0x1d9)](_0x35da8f['path'],_0x1ab51e+'/'+_0x35da8f[_0x352c33(0x202)]),fs['unlinkSync'](_0x35da8f[_0x352c33(0x1d5)]);}),_0x3cf790[_0x113653(0x1e8)]({'files':_0x53ee0c[_0x113653(0x1f1)](_0x18557f=>({..._0x18557f,'path':_0x1ab51e+'/'+_0x18557f[_0x113653(0x202)]}))});}),router['post'](a8_0x300625(0x1fe),verifyToken,async(_0x45d604,_0x37cd75)=>{const _0x5af0c7=a8_0x300625,{path:_0x49dd28,folder_name:_0x1b6f4b}=_0x45d604[_0x5af0c7(0x1eb)];console[_0x5af0c7(0x201)]({'path':_0x49dd28,'folder_name':_0x1b6f4b});if(!_0x49dd28)return _0x37cd75[_0x5af0c7(0x1f5)](0x190)[_0x5af0c7(0x208)]({'error':'Path\x20is\x20required'});if(!_0x1b6f4b)return _0x37cd75[_0x5af0c7(0x1f5)](0x190)[_0x5af0c7(0x208)]({'error':_0x5af0c7(0x1fc)});const _0x583bb6=_0x49dd28+'/'+_0x1b6f4b;!fs['existsSync'](_0x583bb6)&&fs['mkdirSync'](_0x583bb6),_0x37cd75[_0x5af0c7(0x1e8)]({'path':_0x583bb6});}),router[a8_0x300625(0x1e3)](a8_0x300625(0x1e4),verifyToken,async(_0x457090,_0x1c5330)=>{const _0x39de61=a8_0x300625,{isFolder:_0x52dcb2,path:_0x5cd3b2}=_0x457090[_0x39de61(0x1eb)];!_0x52dcb2?fs[_0x39de61(0x1d8)](_0x5cd3b2):fs[_0x39de61(0x1f8)](_0x5cd3b2,{'recursive':!![]}),_0x1c5330['send']({'success':!![]});}),module[a8_0x300625(0x1f6)]=router;