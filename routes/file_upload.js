const a9_0x4c6f0d=a9_0x5713;function a9_0x5713(_0x4d76dd,_0x231e25){const _0x2b9053=a9_0x2b90();return a9_0x5713=function(_0x5713f1,_0xbcdbf6){_0x5713f1=_0x5713f1-0xf4;let _0x194188=_0x2b9053[_0x5713f1];return _0x194188;},a9_0x5713(_0x4d76dd,_0x231e25);}function a9_0x2b90(){const _0x4b7b2a=['post','readdirSync','7OGcujN','../libs/mysql.js','log','length','Please\x20upload\x20a\x20file','rmdirSync','20QXTtya','/files','11772IslcaK','size','./uploads','files','execute','../CADViewer_config.json','existsSync','14041264gqDaOE','copyFileSync','mkdirSync','Router','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','uploads','map','\x20files','2012940IwZXkl','diskStorage','unlinkSync','express','787998bAsdCZ','/folder','\x20MB\x20of\x20files','email','22933933rEwNKO','7207038wssHBf','folderLocation','body','delete','reduce','array','verifyToken','folder_name','/remove','crypto','11350zvTMjk','user','179boyvle','6112QsjTyS','statSync','exports','status','originalname','../libs/jwt','Folder\x20name\x20is\x20required','send','Error!\x20Something\x20went\x20wrong.','promise','path','json'];a9_0x2b90=function(){return _0x4b7b2a;};return a9_0x2b90();}(function(_0x51dcb1,_0x106698){const _0x7f24c=a9_0x5713,_0x5d886c=_0x51dcb1();while(!![]){try{const _0x9eff1d=parseInt(_0x7f24c(0x126))/0x1*(-parseInt(_0x7f24c(0x127))/0x2)+parseInt(_0x7f24c(0x115))/0x3*(parseInt(_0x7f24c(0x100))/0x4)+-parseInt(_0x7f24c(0x111))/0x5+-parseInt(_0x7f24c(0x11a))/0x6*(parseInt(_0x7f24c(0xfa))/0x7)+-parseInt(_0x7f24c(0x109))/0x8+-parseInt(_0x7f24c(0x102))/0x9*(-parseInt(_0x7f24c(0x124))/0xa)+parseInt(_0x7f24c(0x119))/0xb;if(_0x9eff1d===_0x106698)break;else _0x5d886c['push'](_0x5d886c['shift']());}catch(_0x12fef0){_0x5d886c['push'](_0x5d886c['shift']());}}}(a9_0x2b90,0xee7e6));const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a9_0x4c6f0d(0x123)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a9_0x4c6f0d(0x107)),conn=require(a9_0x4c6f0d(0xfb)),verifyToken=require(a9_0x4c6f0d(0x12c))[a9_0x4c6f0d(0x120)],dir=a9_0x4c6f0d(0x104);!fs[a9_0x4c6f0d(0x108)](dir)&&fs[a9_0x4c6f0d(0x10b)](dir);const express=require(a9_0x4c6f0d(0x114)),router=express[a9_0x4c6f0d(0x10c)](),config=require('../CADViewer_config.json'),storage=multer[a9_0x4c6f0d(0x112)]({'destination':function(_0x5b01df,_0x1fcc43,_0x4d3640){const _0x4bea14=a9_0x4c6f0d;_0x4d3640(null,_0x4bea14(0x10e));}}),upload=multer({'storage':storage});router[a9_0x4c6f0d(0xf8)](a9_0x4c6f0d(0x101),upload[a9_0x4c6f0d(0x11f)](a9_0x4c6f0d(0x105)),verifyToken,async(_0x2c77e0,_0x53c5ec,_0x2b9df5)=>{const _0x379714=a9_0x4c6f0d,_0x1fdba8=_0x2c77e0[_0x379714(0x105)],{global:_0x1b6720,path:_0xa28b1d}=_0x2c77e0[_0x379714(0x11c)],_0x247e04=config[_0x379714(0x11b)];console[_0x379714(0xfc)]({'global':_0x1b6720}),console[_0x379714(0xfc)](_0x1fdba8),console[_0x379714(0xfc)]({'user':_0x2c77e0[_0x379714(0x125)]});if(_0x1b6720){_0x1fdba8['forEach'](_0x2ce01f=>{const _0x327891=_0x379714;fs['copyFileSync'](_0x2ce01f[_0x327891(0xf6)],(_0xa28b1d||_0x247e04)+'/'+_0x2ce01f[_0x327891(0x12b)]),fs[_0x327891(0x113)](_0x2ce01f['path']);}),_0x53c5ec[_0x379714(0x12e)]({'files':_0x1fdba8[_0x379714(0x10f)](_0x14a0a7=>({..._0x14a0a7,'path':(_0xa28b1d||_0x247e04)+'/'+_0x14a0a7['originalname']}))});return;}let _0x230cce;try{const [_0x262c3c]=await conn[_0x379714(0xf5)]()[_0x379714(0x106)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x2c77e0[_0x379714(0x125)][_0x379714(0x118)]]);_0x262c3c[_0x379714(0xfd)]>0x0&&(_0x230cce=_0x262c3c[0x0]);}catch(_0x9d34ba){console[_0x379714(0xfc)]({'err':_0x9d34ba}),_0x53c5ec['status'](0x1f4)['json']({'error':_0x379714(0xf4)});return;}if(!_0x230cce){_0x53c5ec[_0x379714(0x12a)](0x191)['json']({'error':'Invalid\x20user'});return;}let _0x5c2121=_0x230cce[_0x379714(0x121)];if(!_0x5c2121){_0x5c2121=randomUUID();try{await conn[_0x379714(0xf5)]()[_0x379714(0x106)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x5c2121,_0x2c77e0[_0x379714(0x125)][_0x379714(0x118)]]);}catch(_0x192cb1){console[_0x379714(0xfc)]({'err':_0x192cb1}),_0x53c5ec[_0x379714(0x12a)](0x1f4)['json']({'error':_0x379714(0xf4)});return;}}const _0x1a894='./uploads/'+_0x5c2121;!fs[_0x379714(0x108)](_0x1a894)&&fs[_0x379714(0x10b)](_0x1a894);if(!_0x1fdba8){const _0x3471d9=new Error(_0x379714(0xfe));return _0x3471d9['httpStatusCode']=0x190,_0x2b9df5(_0x3471d9);}const _0x82b84d=fs[_0x379714(0xf9)](_0x1a894)[_0x379714(0xfd)]+_0x1fdba8[_0x379714(0xfd)];console['log']({'numberOfSize':_0x82b84d});if(_0x82b84d>userFolderMaximumFiles)return _0x53c5ec[_0x379714(0x12a)](0x190)[_0x379714(0xf7)]({'error':_0x379714(0x10d)+userFolderMaximumFiles+_0x379714(0x110)});const _0x4d180c=fs['readdirSync'](_0x1a894)[_0x379714(0x11e)]((_0x25107f,_0x1d0cc0)=>_0x25107f+fs[_0x379714(0x128)](_0x1a894+'/'+_0x1d0cc0)[_0x379714(0x103)],0x0),_0x49c95d=_0x1fdba8['reduce']((_0x22797f,_0xd0b667)=>_0x22797f+_0xd0b667[_0x379714(0x103)],0x0);console[_0x379714(0xfc)]({'totalSize':_0x4d180c,'uploadedSize':_0x49c95d});if(_0x49c95d+_0x4d180c>userFolderMaximumSizeInMB*0x400*0x400)return _0x53c5ec['status'](0x190)[_0x379714(0xf7)]({'error':_0x379714(0x10d)+userFolderMaximumSizeInMB+_0x379714(0x117)});_0x1fdba8['forEach'](_0x3f0680=>{const _0x2903c7=_0x379714;fs[_0x2903c7(0x10a)](_0x3f0680['path'],_0x1a894+'/'+_0x3f0680[_0x2903c7(0x12b)]),fs[_0x2903c7(0x113)](_0x3f0680[_0x2903c7(0xf6)]);}),_0x53c5ec[_0x379714(0x12e)]({'files':_0x1fdba8[_0x379714(0x10f)](_0x588efa=>({..._0x588efa,'path':_0x1a894+'/'+_0x588efa['originalname']}))});}),router[a9_0x4c6f0d(0xf8)](a9_0x4c6f0d(0x116),verifyToken,async(_0x39420e,_0x37f9d6)=>{const _0x111cec=a9_0x4c6f0d,{path:_0x5a3506,folder_name:_0x1d3a8f}=_0x39420e[_0x111cec(0x11c)];console[_0x111cec(0xfc)]({'path':_0x5a3506,'folder_name':_0x1d3a8f});if(!_0x5a3506)return _0x37f9d6[_0x111cec(0x12a)](0x190)[_0x111cec(0xf7)]({'error':'Path\x20is\x20required'});if(!_0x1d3a8f)return _0x37f9d6['status'](0x190)['json']({'error':_0x111cec(0x12d)});const _0x24ba66=_0x5a3506+'/'+_0x1d3a8f;!fs['existsSync'](_0x24ba66)&&fs[_0x111cec(0x10b)](_0x24ba66),_0x37f9d6[_0x111cec(0x12e)]({'path':_0x24ba66});}),router[a9_0x4c6f0d(0x11d)](a9_0x4c6f0d(0x122),verifyToken,async(_0x5211f0,_0x1f6f21)=>{const _0xfc778f=a9_0x4c6f0d,{isFolder:_0x11c210,path:_0x4f58ae}=_0x5211f0['body'];!_0x11c210?fs[_0xfc778f(0x113)](_0x4f58ae):fs[_0xfc778f(0xff)](_0x4f58ae,{'recursive':!![]}),_0x1f6f21[_0xfc778f(0x12e)]({'success':!![]});}),module[a9_0x4c6f0d(0x129)]=router;