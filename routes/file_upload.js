const a8_0x11c25a=a8_0x10d6;function a8_0x10d6(_0x1985d2,_0x4a185f){const _0x375b4b=a8_0x375b();return a8_0x10d6=function(_0x10d68f,_0x59b093){_0x10d68f=_0x10d68f-0x88;let _0xc82e6b=_0x375b4b[_0x10d68f];return _0xc82e6b;},a8_0x10d6(_0x1985d2,_0x4a185f);}(function(_0xb4f44e,_0x3e5773){const _0x4d45d3=a8_0x10d6,_0x4fce45=_0xb4f44e();while(!![]){try{const _0x4e5350=parseInt(_0x4d45d3(0xb9))/0x1*(-parseInt(_0x4d45d3(0xb1))/0x2)+parseInt(_0x4d45d3(0xa0))/0x3+parseInt(_0x4d45d3(0xc0))/0x4+parseInt(_0x4d45d3(0x98))/0x5*(parseInt(_0x4d45d3(0xa5))/0x6)+parseInt(_0x4d45d3(0x9c))/0x7+parseInt(_0x4d45d3(0x9d))/0x8*(parseInt(_0x4d45d3(0x89))/0x9)+parseInt(_0x4d45d3(0xb2))/0xa;if(_0x4e5350===_0x3e5773)break;else _0x4fce45['push'](_0x4fce45['shift']());}catch(_0x352b2d){_0x4fce45['push'](_0x4fce45['shift']());}}}(a8_0x375b,0x708d0));function a8_0x375b(){const _0x657b96=['user','log','array','/remove','execute','unlinkSync','Folder\x20name\x20is\x20required','reduce','promise','renameSync','express','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','../libs/jwt','crypto','5LwhMRY','readdirSync','uploads','json','5292oBdBaj','7768fsTJeE','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','verifyToken','1870032gHgeYx','email','statSync','files','Error!\x20Something\x20went\x20wrong.','2079702iUzifC','./uploads/','delete','size','multer','status','path','mkdirSync','../CADViewer_config.json','forEach','\x20MB\x20of\x20files','Path\x20is\x20required','2IRZhGa','545790GCPkFf','send','Router','folderLocation','body','length','httpStatusCode','775858FmFIoz','folder_name','diskStorage','existsSync','Please\x20upload\x20a\x20file','Invalid\x20user','\x20files','733644FkawPf','post','../libs/mysql.js','originalname','exports','261GPzXdu'];a8_0x375b=function(){return _0x657b96;};return a8_0x375b();}const multer=require(a8_0x11c25a(0xa9)),fs=require('fs'),{randomUUID}=require(a8_0x11c25a(0x97)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x11c25a(0xad)),conn=require(a8_0x11c25a(0xc2)),verifyToken=require(a8_0x11c25a(0x96))[a8_0x11c25a(0x9f)],dir='./uploads';!fs[a8_0x11c25a(0xbc)](dir)&&fs[a8_0x11c25a(0xac)](dir);const express=require(a8_0x11c25a(0x94)),router=express[a8_0x11c25a(0xb4)](),config=require(a8_0x11c25a(0xad)),storage=multer[a8_0x11c25a(0xbb)]({'destination':function(_0x1f4a15,_0x9ed3af,_0x48a7bb){const _0x5f0651=a8_0x11c25a;_0x48a7bb(null,_0x5f0651(0x9a));}}),upload=multer({'storage':storage});router[a8_0x11c25a(0xc1)]('/files',upload[a8_0x11c25a(0x8c)](a8_0x11c25a(0xa3)),verifyToken,async(_0x17f684,_0x1f75a4,_0x380bc1)=>{const _0x1a6d60=a8_0x11c25a,_0x5ce61c=_0x17f684['files'],{global:_0x514390,path:_0x578910}=_0x17f684[_0x1a6d60(0xb6)],_0x5afb78=config[_0x1a6d60(0xb5)];console[_0x1a6d60(0x8b)]({'global':_0x514390}),console[_0x1a6d60(0x8b)](_0x5ce61c),console[_0x1a6d60(0x8b)]({'user':_0x17f684[_0x1a6d60(0x8a)]});if(_0x514390){_0x5ce61c[_0x1a6d60(0xae)](_0x27a37b=>{const _0x5b46e4=_0x1a6d60;fs[_0x5b46e4(0x93)](_0x27a37b[_0x5b46e4(0xab)],(_0x578910||_0x5afb78)+'/'+_0x27a37b['originalname']);}),_0x1f75a4[_0x1a6d60(0xb3)]({'files':_0x5ce61c['map'](_0xeb681=>({..._0xeb681,'path':(_0x578910||_0x5afb78)+'/'+_0xeb681[_0x1a6d60(0xc3)]}))});return;}let _0x1a5ee6;try{const [_0x514f47]=await conn[_0x1a6d60(0x92)]()[_0x1a6d60(0x8e)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x17f684[_0x1a6d60(0x8a)]['email']]);_0x514f47[_0x1a6d60(0xb7)]>0x0&&(_0x1a5ee6=_0x514f47[0x0]);}catch(_0xdb137d){console[_0x1a6d60(0x8b)]({'err':_0xdb137d}),_0x1f75a4[_0x1a6d60(0xaa)](0x1f4)[_0x1a6d60(0x9b)]({'error':_0x1a6d60(0xa4)});return;}if(!_0x1a5ee6){_0x1f75a4[_0x1a6d60(0xaa)](0x191)[_0x1a6d60(0x9b)]({'error':_0x1a6d60(0xbe)});return;}let _0x2e6de1=_0x1a5ee6[_0x1a6d60(0xba)];if(!_0x2e6de1){_0x2e6de1=randomUUID();try{await conn['promise']()[_0x1a6d60(0x8e)](_0x1a6d60(0x95),[_0x2e6de1,_0x17f684[_0x1a6d60(0x8a)][_0x1a6d60(0xa1)]]);}catch(_0x4d0a0e){console[_0x1a6d60(0x8b)]({'err':_0x4d0a0e}),_0x1f75a4['status'](0x1f4)[_0x1a6d60(0x9b)]({'error':_0x1a6d60(0xa4)});return;}}const _0x44dfe3=_0x1a6d60(0xa6)+_0x2e6de1;!fs[_0x1a6d60(0xbc)](_0x44dfe3)&&fs[_0x1a6d60(0xac)](_0x44dfe3);if(!_0x5ce61c){const _0x3bcf5=new Error(_0x1a6d60(0xbd));return _0x3bcf5[_0x1a6d60(0xb8)]=0x190,_0x380bc1(_0x3bcf5);}const _0x1eb089=fs[_0x1a6d60(0x99)](_0x44dfe3)[_0x1a6d60(0xb7)]+_0x5ce61c['length'];console['log']({'numberOfSize':_0x1eb089});if(_0x1eb089>userFolderMaximumFiles)return _0x1f75a4[_0x1a6d60(0xaa)](0x190)['json']({'error':_0x1a6d60(0x9e)+userFolderMaximumFiles+_0x1a6d60(0xbf)});const _0x376a57=fs['readdirSync'](_0x44dfe3)['reduce']((_0xbf3d93,_0x199ad6)=>_0xbf3d93+fs[_0x1a6d60(0xa2)](_0x44dfe3+'/'+_0x199ad6)[_0x1a6d60(0xa8)],0x0),_0x16ec88=_0x5ce61c[_0x1a6d60(0x91)]((_0x234810,_0x1554bd)=>_0x234810+_0x1554bd[_0x1a6d60(0xa8)],0x0);console[_0x1a6d60(0x8b)]({'totalSize':_0x376a57,'uploadedSize':_0x16ec88});if(_0x16ec88+_0x376a57>userFolderMaximumSizeInMB*0x400*0x400)return _0x1f75a4[_0x1a6d60(0xaa)](0x190)[_0x1a6d60(0x9b)]({'error':_0x1a6d60(0x9e)+userFolderMaximumSizeInMB+_0x1a6d60(0xaf)});_0x5ce61c[_0x1a6d60(0xae)](_0x2302d3=>{const _0x35d4ff=_0x1a6d60;fs[_0x35d4ff(0x93)](_0x2302d3[_0x35d4ff(0xab)],_0x44dfe3+'/'+_0x2302d3[_0x35d4ff(0xc3)]);}),_0x1f75a4['send']({'files':_0x5ce61c['map'](_0x4862cd=>({..._0x4862cd,'path':_0x44dfe3+'/'+_0x4862cd[_0x1a6d60(0xc3)]}))});}),router['post']('/folder',verifyToken,async(_0x485ddb,_0x21525e)=>{const _0x50d10a=a8_0x11c25a,{path:_0x1e19e8,folder_name:_0x55e050}=_0x485ddb[_0x50d10a(0xb6)],_0x2245c8=config[_0x50d10a(0xb5)];console['log']({'path':_0x1e19e8,'folder_name':_0x55e050});if(!_0x1e19e8)return _0x21525e[_0x50d10a(0xaa)](0x190)[_0x50d10a(0x9b)]({'error':_0x50d10a(0xb0)});if(!_0x55e050)return _0x21525e['status'](0x190)[_0x50d10a(0x9b)]({'error':_0x50d10a(0x90)});const _0x10ba3d=_0x1e19e8+'/'+_0x55e050;!fs[_0x50d10a(0xbc)](_0x10ba3d)&&fs[_0x50d10a(0xac)](_0x10ba3d),_0x21525e[_0x50d10a(0xb3)]({'path':_0x10ba3d});}),router[a8_0x11c25a(0xa7)](a8_0x11c25a(0x8d),verifyToken,async(_0x302076,_0x1c406b)=>{const _0x251011=a8_0x11c25a,{isFolder:_0x40a7ce,path:_0x2fcf86}=_0x302076[_0x251011(0xb6)];!_0x40a7ce?fs[_0x251011(0x8f)](_0x2fcf86):fs['rmdirSync'](_0x2fcf86,{'recursive':!![]}),_0x1c406b[_0x251011(0xb3)]({'success':!![]});}),module[a8_0x11c25a(0x88)]=router;