const a8_0x7141e9=a8_0x3b1e;(function(_0x2ce3cb,_0x2577ce){const _0x390b56=a8_0x3b1e,_0x2f0742=_0x2ce3cb();while(!![]){try{const _0x82e2eb=parseInt(_0x390b56(0x123))/0x1+-parseInt(_0x390b56(0xec))/0x2*(-parseInt(_0x390b56(0x11e))/0x3)+parseInt(_0x390b56(0x11d))/0x4+parseInt(_0x390b56(0x115))/0x5*(-parseInt(_0x390b56(0xf0))/0x6)+-parseInt(_0x390b56(0x11f))/0x7*(parseInt(_0x390b56(0x101))/0x8)+-parseInt(_0x390b56(0xfd))/0x9+parseInt(_0x390b56(0x100))/0xa;if(_0x82e2eb===_0x2577ce)break;else _0x2f0742['push'](_0x2f0742['shift']());}catch(_0x17288f){_0x2f0742['push'](_0x2f0742['shift']());}}}(a8_0x412f,0x4c4e1));const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a8_0x7141e9(0x11c)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x7141e9(0xf9)),conn=require(a8_0x7141e9(0xee)),verifyToken=require(a8_0x7141e9(0xf2))[a8_0x7141e9(0xf5)],dir=a8_0x7141e9(0x121);function a8_0x3b1e(_0x24b190,_0xe130b7){const _0x412fd9=a8_0x412f();return a8_0x3b1e=function(_0x3b1ee1,_0x224a0a){_0x3b1ee1=_0x3b1ee1-0xeb;let _0xdf33d=_0x412fd9[_0x3b1ee1];return _0xdf33d;},a8_0x3b1e(_0x24b190,_0xe130b7);}!fs['existsSync'](dir)&&fs['mkdirSync'](dir);function a8_0x412f(){const _0x2c6303=['SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','size','array','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','/folder','diskStorage','promise','210866qIIvbq','httpStatusCode','../libs/mysql.js','body','6QjafIw','existsSync','../libs/jwt','post','copyFileSync','verifyToken','\x20MB\x20of\x20files','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','execute','../CADViewer_config.json','path','/files','originalname','626967oSJeuS','delete','unlinkSync','3826920XVrFuT','8gxZyuU','readdirSync','reduce','Path\x20is\x20required','Error!\x20Something\x20went\x20wrong.','send','user','Router','length','files','statSync','/remove','email','express','folderLocation','map','Invalid\x20user','Folder\x20name\x20is\x20required','rmdirSync','exports','134315CTlOTh','Please\x20upload\x20a\x20file','forEach','status','json','\x20files','./uploads/','crypto','209488AJtXJD','6gOYYZd','4066909uOFYLL','log','./uploads','uploads','344128MqdJvZ','folder_name','mkdirSync'];a8_0x412f=function(){return _0x2c6303;};return a8_0x412f();}const express=require(a8_0x7141e9(0x10e)),router=express[a8_0x7141e9(0x108)](),config=require('../CADViewer_config.json'),storage=multer[a8_0x7141e9(0x12b)]({'destination':function(_0x523c36,_0x2e6ab1,_0x3f2f74){const _0x4d168e=a8_0x7141e9;_0x3f2f74(null,_0x4d168e(0x122));}}),upload=multer({'storage':storage});router[a8_0x7141e9(0xf3)](a8_0x7141e9(0xfb),upload[a8_0x7141e9(0x128)](a8_0x7141e9(0x10a)),verifyToken,async(_0x367f0d,_0x3e5472,_0x3b6623)=>{const _0x2dfd1a=a8_0x7141e9,_0x56c83e=_0x367f0d[_0x2dfd1a(0x10a)],{global:_0x5041e5,path:_0x17971f}=_0x367f0d[_0x2dfd1a(0xef)],_0x2f8d08=config[_0x2dfd1a(0x10f)];console[_0x2dfd1a(0x120)]({'global':_0x5041e5}),console[_0x2dfd1a(0x120)](_0x56c83e),console[_0x2dfd1a(0x120)]({'user':_0x367f0d['user']});if(_0x5041e5){_0x56c83e[_0x2dfd1a(0x117)](_0x1e2807=>{const _0x2d9d35=_0x2dfd1a;fs['copyFileSync'](_0x1e2807[_0x2d9d35(0xfa)],(_0x17971f||_0x2f8d08)+'/'+_0x1e2807[_0x2d9d35(0xfc)]),fs['unlinkSync'](_0x1e2807[_0x2d9d35(0xfa)]);}),_0x3e5472['send']({'files':_0x56c83e['map'](_0x2d2abe=>({..._0x2d2abe,'path':(_0x17971f||_0x2f8d08)+'/'+_0x2d2abe[_0x2dfd1a(0xfc)]}))});return;}let _0x5675c0;try{const [_0x1c0b56]=await conn[_0x2dfd1a(0xeb)]()[_0x2dfd1a(0xf8)](_0x2dfd1a(0x126),[_0x367f0d[_0x2dfd1a(0x107)][_0x2dfd1a(0x10d)]]);_0x1c0b56[_0x2dfd1a(0x109)]>0x0&&(_0x5675c0=_0x1c0b56[0x0]);}catch(_0x667bbc){console[_0x2dfd1a(0x120)]({'err':_0x667bbc}),_0x3e5472[_0x2dfd1a(0x118)](0x1f4)[_0x2dfd1a(0x119)]({'error':_0x2dfd1a(0x105)});return;}if(!_0x5675c0){_0x3e5472[_0x2dfd1a(0x118)](0x191)['json']({'error':_0x2dfd1a(0x111)});return;}let _0x48dc98=_0x5675c0[_0x2dfd1a(0x124)];if(!_0x48dc98){_0x48dc98=randomUUID();try{await conn['promise']()['execute'](_0x2dfd1a(0x129),[_0x48dc98,_0x367f0d[_0x2dfd1a(0x107)][_0x2dfd1a(0x10d)]]);}catch(_0x38b897){console[_0x2dfd1a(0x120)]({'err':_0x38b897}),_0x3e5472[_0x2dfd1a(0x118)](0x1f4)[_0x2dfd1a(0x119)]({'error':_0x2dfd1a(0x105)});return;}}const _0x2ff812=_0x2dfd1a(0x11b)+_0x48dc98;!fs[_0x2dfd1a(0xf1)](_0x2ff812)&&fs['mkdirSync'](_0x2ff812);if(!_0x56c83e){const _0x2d7bc0=new Error(_0x2dfd1a(0x116));return _0x2d7bc0[_0x2dfd1a(0xed)]=0x190,_0x3b6623(_0x2d7bc0);}const _0x5bb793=fs[_0x2dfd1a(0x102)](_0x2ff812)[_0x2dfd1a(0x109)]+_0x56c83e[_0x2dfd1a(0x109)];console[_0x2dfd1a(0x120)]({'numberOfSize':_0x5bb793});if(_0x5bb793>userFolderMaximumFiles)return _0x3e5472[_0x2dfd1a(0x118)](0x190)[_0x2dfd1a(0x119)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+_0x2dfd1a(0x11a)});const _0x45ca35=fs['readdirSync'](_0x2ff812)[_0x2dfd1a(0x103)]((_0x488b4f,_0x4450f7)=>_0x488b4f+fs[_0x2dfd1a(0x10b)](_0x2ff812+'/'+_0x4450f7)['size'],0x0),_0x438e77=_0x56c83e[_0x2dfd1a(0x103)]((_0x48a5f3,_0x318f01)=>_0x48a5f3+_0x318f01[_0x2dfd1a(0x127)],0x0);console[_0x2dfd1a(0x120)]({'totalSize':_0x45ca35,'uploadedSize':_0x438e77});if(_0x438e77+_0x45ca35>userFolderMaximumSizeInMB*0x400*0x400)return _0x3e5472['status'](0x190)[_0x2dfd1a(0x119)]({'error':_0x2dfd1a(0xf7)+userFolderMaximumSizeInMB+_0x2dfd1a(0xf6)});_0x56c83e[_0x2dfd1a(0x117)](_0x59a1b7=>{const _0x2e185b=_0x2dfd1a;fs[_0x2e185b(0xf4)](_0x59a1b7[_0x2e185b(0xfa)],_0x2ff812+'/'+_0x59a1b7[_0x2e185b(0xfc)]),fs[_0x2e185b(0xff)](_0x59a1b7[_0x2e185b(0xfa)]);}),_0x3e5472[_0x2dfd1a(0x106)]({'files':_0x56c83e[_0x2dfd1a(0x110)](_0x5ca4c8=>({..._0x5ca4c8,'path':_0x2ff812+'/'+_0x5ca4c8[_0x2dfd1a(0xfc)]}))});}),router[a8_0x7141e9(0xf3)](a8_0x7141e9(0x12a),verifyToken,async(_0x27b115,_0x41fcd8)=>{const _0x2a454e=a8_0x7141e9,{path:_0x3875da,folder_name:_0x2543ef}=_0x27b115[_0x2a454e(0xef)];console[_0x2a454e(0x120)]({'path':_0x3875da,'folder_name':_0x2543ef});if(!_0x3875da)return _0x41fcd8['status'](0x190)['json']({'error':_0x2a454e(0x104)});if(!_0x2543ef)return _0x41fcd8[_0x2a454e(0x118)](0x190)[_0x2a454e(0x119)]({'error':_0x2a454e(0x112)});const _0x243b06=_0x3875da+'/'+_0x2543ef;!fs['existsSync'](_0x243b06)&&fs[_0x2a454e(0x125)](_0x243b06),_0x41fcd8[_0x2a454e(0x106)]({'path':_0x243b06});}),router[a8_0x7141e9(0xfe)](a8_0x7141e9(0x10c),verifyToken,async(_0x111b92,_0x1d76b2)=>{const _0x215024=a8_0x7141e9,{isFolder:_0x216b91,path:_0x38ce31}=_0x111b92['body'];!_0x216b91?fs[_0x215024(0xff)](_0x38ce31):fs[_0x215024(0x113)](_0x38ce31,{'recursive':!![]}),_0x1d76b2[_0x215024(0x106)]({'success':!![]});}),module[a8_0x7141e9(0x114)]=router;