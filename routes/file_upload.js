const a8_0x54ecac=a8_0x9d12;function a8_0x9d12(_0x208a07,_0x47517a){const _0x3f4390=a8_0x3f43();return a8_0x9d12=function(_0x9d12b3,_0x45598d){_0x9d12b3=_0x9d12b3-0x1d6;let _0x34540c=_0x3f4390[_0x9d12b3];return _0x34540c;},a8_0x9d12(_0x208a07,_0x47517a);}function a8_0x3f43(){const _0x1e8d3f=['originalname','crypto','statSync','Folder\x20name\x20is\x20required','Path\x20is\x20required','93fhKQLM','./uploads/','copyFileSync','Router','length','8mloBbt','send','json','map','1901124OGBLhW','exports','size','path','email','1120245mmxrmc','\x20files','folderLocation','/folder','1289508ihuvXg','post','status','httpStatusCode','files','11909905WJHhpS','mkdirSync','uploads','multer','forEach','Error!\x20Something\x20went\x20wrong.','../libs/mysql.js','array','log','execute','Please\x20upload\x20a\x20file','express','/files','1598QDNKMk','10LLePyF','delete','/remove','existsSync','body','readdirSync','reduce','6zLXupZ','diskStorage','user','promise','../libs/jwt','968945qJyPtH','verifyToken','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','10853721fdIGYv','unlinkSync','275PlgSgq','../CADViewer_config.json','./uploads'];a8_0x3f43=function(){return _0x1e8d3f;};return a8_0x3f43();}(function(_0x164468,_0x364293){const _0x3844ee=a8_0x9d12,_0x3a10c5=_0x164468();while(!![]){try{const _0x55f9a4=-parseInt(_0x3844ee(0x20a))/0x1*(-parseInt(_0x3844ee(0x1f0))/0x2)+parseInt(_0x3844ee(0x1da))/0x3+-parseInt(_0x3844ee(0x1de))/0x4+parseInt(_0x3844ee(0x1fd))/0x5*(-parseInt(_0x3844ee(0x1f8))/0x6)+-parseInt(_0x3844ee(0x1e3))/0x7*(parseInt(_0x3844ee(0x20f))/0x8)+-parseInt(_0x3844ee(0x200))/0x9*(parseInt(_0x3844ee(0x1f1))/0xa)+-parseInt(_0x3844ee(0x202))/0xb*(-parseInt(_0x3844ee(0x213))/0xc);if(_0x55f9a4===_0x364293)break;else _0x3a10c5['push'](_0x3a10c5['shift']());}catch(_0x7e4721){_0x3a10c5['push'](_0x3a10c5['shift']());}}}(a8_0x3f43,0xf070f));const multer=require(a8_0x54ecac(0x1e6)),fs=require('fs'),{randomUUID}=require(a8_0x54ecac(0x206)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x54ecac(0x203)),conn=require(a8_0x54ecac(0x1e9)),verifyToken=require(a8_0x54ecac(0x1fc))[a8_0x54ecac(0x1fe)],dir=a8_0x54ecac(0x204);!fs[a8_0x54ecac(0x1f4)](dir)&&fs[a8_0x54ecac(0x1e4)](dir);const express=require(a8_0x54ecac(0x1ee)),router=express[a8_0x54ecac(0x20d)](),config=require(a8_0x54ecac(0x203)),storage=multer[a8_0x54ecac(0x1f9)]({'destination':function(_0x1cbb5f,_0x20ad64,_0x293865){const _0x1b793b=a8_0x54ecac;_0x293865(null,_0x1b793b(0x1e5));}}),upload=multer({'storage':storage});router[a8_0x54ecac(0x1df)](a8_0x54ecac(0x1ef),upload[a8_0x54ecac(0x1ea)](a8_0x54ecac(0x1e2)),verifyToken,async(_0x52169c,_0x55816e,_0x286c12)=>{const _0x35ec47=a8_0x54ecac,_0x21f438=_0x52169c[_0x35ec47(0x1e2)],{global:_0x5cd6b6,path:_0x24b851}=_0x52169c['body'],_0x2633fc=config[_0x35ec47(0x1dc)];console[_0x35ec47(0x1eb)]({'global':_0x5cd6b6}),console['log'](_0x21f438),console[_0x35ec47(0x1eb)]({'user':_0x52169c['user']});if(_0x5cd6b6){_0x21f438[_0x35ec47(0x1e7)](_0x2e37b0=>{const _0x2f2e63=_0x35ec47;fs[_0x2f2e63(0x20c)](_0x2e37b0[_0x2f2e63(0x1d8)],(_0x24b851||_0x2633fc)+'/'+_0x2e37b0[_0x2f2e63(0x205)]),fs['unlinkSync'](_0x2e37b0[_0x2f2e63(0x1d8)]);}),_0x55816e[_0x35ec47(0x210)]({'files':_0x21f438[_0x35ec47(0x212)](_0x5c0c77=>({..._0x5c0c77,'path':(_0x24b851||_0x2633fc)+'/'+_0x5c0c77[_0x35ec47(0x205)]}))});return;}let _0x1d4847;try{const [_0x2b3701]=await conn[_0x35ec47(0x1fb)]()[_0x35ec47(0x1ec)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x52169c[_0x35ec47(0x1fa)]['email']]);_0x2b3701[_0x35ec47(0x20e)]>0x0&&(_0x1d4847=_0x2b3701[0x0]);}catch(_0x2bae22){console[_0x35ec47(0x1eb)]({'err':_0x2bae22}),_0x55816e[_0x35ec47(0x1e0)](0x1f4)[_0x35ec47(0x211)]({'error':_0x35ec47(0x1e8)});return;}if(!_0x1d4847){_0x55816e[_0x35ec47(0x1e0)](0x191)[_0x35ec47(0x211)]({'error':'Invalid\x20user'});return;}let _0x228c8a=_0x1d4847['folder_name'];if(!_0x228c8a){_0x228c8a=randomUUID();try{await conn['promise']()[_0x35ec47(0x1ec)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x228c8a,_0x52169c[_0x35ec47(0x1fa)][_0x35ec47(0x1d9)]]);}catch(_0x49c446){console[_0x35ec47(0x1eb)]({'err':_0x49c446}),_0x55816e[_0x35ec47(0x1e0)](0x1f4)[_0x35ec47(0x211)]({'error':_0x35ec47(0x1e8)});return;}}const _0x1b2802=_0x35ec47(0x20b)+_0x228c8a;!fs['existsSync'](_0x1b2802)&&fs[_0x35ec47(0x1e4)](_0x1b2802);if(!_0x21f438){const _0x58ac8e=new Error(_0x35ec47(0x1ed));return _0x58ac8e[_0x35ec47(0x1e1)]=0x190,_0x286c12(_0x58ac8e);}const _0x37dd03=fs[_0x35ec47(0x1f6)](_0x1b2802)[_0x35ec47(0x20e)]+_0x21f438['length'];console[_0x35ec47(0x1eb)]({'numberOfSize':_0x37dd03});if(_0x37dd03>userFolderMaximumFiles)return _0x55816e[_0x35ec47(0x1e0)](0x190)[_0x35ec47(0x211)]({'error':_0x35ec47(0x1ff)+userFolderMaximumFiles+_0x35ec47(0x1db)});const _0x1b30d2=fs[_0x35ec47(0x1f6)](_0x1b2802)['reduce']((_0x4d3bc4,_0x3b73d4)=>_0x4d3bc4+fs[_0x35ec47(0x207)](_0x1b2802+'/'+_0x3b73d4)['size'],0x0),_0x4ebdd5=_0x21f438[_0x35ec47(0x1f7)]((_0x172cad,_0x4fde9a)=>_0x172cad+_0x4fde9a[_0x35ec47(0x1d7)],0x0);console['log']({'totalSize':_0x1b30d2,'uploadedSize':_0x4ebdd5});if(_0x4ebdd5+_0x1b30d2>userFolderMaximumSizeInMB*0x400*0x400)return _0x55816e[_0x35ec47(0x1e0)](0x190)[_0x35ec47(0x211)]({'error':_0x35ec47(0x1ff)+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x21f438['forEach'](_0x43378f=>{const _0x56dabe=_0x35ec47;fs['copyFileSync'](_0x43378f['path'],_0x1b2802+'/'+_0x43378f[_0x56dabe(0x205)]),fs[_0x56dabe(0x201)](_0x43378f[_0x56dabe(0x1d8)]);}),_0x55816e[_0x35ec47(0x210)]({'files':_0x21f438[_0x35ec47(0x212)](_0x27521e=>({..._0x27521e,'path':_0x1b2802+'/'+_0x27521e[_0x35ec47(0x205)]}))});}),router[a8_0x54ecac(0x1df)](a8_0x54ecac(0x1dd),verifyToken,async(_0x30ed6f,_0x52a105)=>{const _0xce725e=a8_0x54ecac,{path:_0x1b854d,folder_name:_0x44f865}=_0x30ed6f[_0xce725e(0x1f5)];console['log']({'path':_0x1b854d,'folder_name':_0x44f865});if(!_0x1b854d)return _0x52a105['status'](0x190)[_0xce725e(0x211)]({'error':_0xce725e(0x209)});if(!_0x44f865)return _0x52a105['status'](0x190)['json']({'error':_0xce725e(0x208)});const _0x3102eb=_0x1b854d+'/'+_0x44f865;!fs[_0xce725e(0x1f4)](_0x3102eb)&&fs[_0xce725e(0x1e4)](_0x3102eb),_0x52a105['send']({'path':_0x3102eb});}),router[a8_0x54ecac(0x1f2)](a8_0x54ecac(0x1f3),verifyToken,async(_0x146fae,_0x3d1c31)=>{const _0x271c1f=a8_0x54ecac,{isFolder:_0x461204,path:_0x458475}=_0x146fae[_0x271c1f(0x1f5)];!_0x461204?fs[_0x271c1f(0x201)](_0x458475):fs['rmdirSync'](_0x458475,{'recursive':!![]}),_0x3d1c31[_0x271c1f(0x210)]({'success':!![]});}),module[a8_0x54ecac(0x1d6)]=router;