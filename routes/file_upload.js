const a9_0x164336=a9_0x5f5d;function a9_0x2c11(){const _0x1c744e=['path','existsSync','httpStatusCode','unlinkSync','map','1589PhiuoF','./uploads','length','459544pbFrty','../libs/jwt','13959900AVnPNz','post','Please\x20upload\x20a\x20file','express','116260Zlqsvp','/remove','verifyToken','user','execute','uploads','../CADViewer_config.json','\x20files','3258wKCOIe','Folder\x20name\x20is\x20required','readdirSync','1XZjOeT','email','mkdirSync','json','286EPbslW','diskStorage','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','./uploads/','Invalid\x20user','\x20MB\x20of\x20files','883805iXYMFK','forEach','folderLocation','folder_name','Error!\x20Something\x20went\x20wrong.','/folder','send','/files','exports','reduce','files','log','array','410878XdlOxK','5256jlxskM','status','copyFileSync','2826qCtYlk','12cOrJCG','size','originalname'];a9_0x2c11=function(){return _0x1c744e;};return a9_0x2c11();}(function(_0x30e7ce,_0x2fd7e6){const _0x5bdde2=a9_0x5f5d,_0x57f96a=_0x30e7ce();while(!![]){try{const _0x203a9e=-parseInt(_0x5bdde2(0x1f9))/0x1*(-parseInt(_0x5bdde2(0x211))/0x2)+-parseInt(_0x5bdde2(0x1dd))/0x3*(-parseInt(_0x5bdde2(0x1e8))/0x4)+parseInt(_0x5bdde2(0x204))/0x5+-parseInt(_0x5bdde2(0x1dc))/0x6*(-parseInt(_0x5bdde2(0x1e5))/0x7)+-parseInt(_0x5bdde2(0x1d9))/0x8*(-parseInt(_0x5bdde2(0x1f6))/0x9)+-parseInt(_0x5bdde2(0x1ee))/0xa*(-parseInt(_0x5bdde2(0x1fd))/0xb)+-parseInt(_0x5bdde2(0x1ea))/0xc;if(_0x203a9e===_0x2fd7e6)break;else _0x57f96a['push'](_0x57f96a['shift']());}catch(_0x2e3b73){_0x57f96a['push'](_0x57f96a['shift']());}}}(a9_0x2c11,0x4f746));const multer=require('multer'),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a9_0x164336(0x1f4)),conn=require('../libs/mysql.js'),verifyToken=require(a9_0x164336(0x1e9))[a9_0x164336(0x1f0)],dir=a9_0x164336(0x1e6);!fs[a9_0x164336(0x1e1)](dir)&&fs[a9_0x164336(0x1fb)](dir);function a9_0x5f5d(_0x76593,_0x375317){const _0x2c1168=a9_0x2c11();return a9_0x5f5d=function(_0x5f5d09,_0x561e21){_0x5f5d09=_0x5f5d09-0x1d9;let _0x13b363=_0x2c1168[_0x5f5d09];return _0x13b363;},a9_0x5f5d(_0x76593,_0x375317);}const express=require(a9_0x164336(0x1ed)),router=express['Router'](),config=require(a9_0x164336(0x1f4)),storage=multer[a9_0x164336(0x1fe)]({'destination':function(_0x4f3098,_0xf4c827,_0x23bd03){const _0x3eff0c=a9_0x164336;_0x23bd03(null,_0x3eff0c(0x1f3));}}),upload=multer({'storage':storage});router['post'](a9_0x164336(0x20b),upload[a9_0x164336(0x210)](a9_0x164336(0x20e)),verifyToken,async(_0x530416,_0x5e4fa6,_0x1292e4)=>{const _0x57dc36=a9_0x164336,_0x3d8ace=_0x530416[_0x57dc36(0x20e)],{global:_0x580824,path:_0x4a9df6}=_0x530416['body'],_0x409de1=config[_0x57dc36(0x206)];console[_0x57dc36(0x20f)]({'global':_0x580824}),console['log'](_0x3d8ace),console['log']({'user':_0x530416[_0x57dc36(0x1f1)]});if(_0x580824){_0x3d8ace[_0x57dc36(0x205)](_0x4470f4=>{const _0x42a752=_0x57dc36;fs[_0x42a752(0x1db)](_0x4470f4['path'],(_0x4a9df6||_0x409de1)+'/'+_0x4470f4['originalname']),fs[_0x42a752(0x1e3)](_0x4470f4[_0x42a752(0x1e0)]);}),_0x5e4fa6[_0x57dc36(0x20a)]({'files':_0x3d8ace[_0x57dc36(0x1e4)](_0x5ddb4e=>({..._0x5ddb4e,'path':(_0x4a9df6||_0x409de1)+'/'+_0x5ddb4e[_0x57dc36(0x1df)]}))});return;}let _0x4c396b;try{const [_0x25f1a2]=await conn['promise']()['execute'](_0x57dc36(0x200),[_0x530416['user'][_0x57dc36(0x1fa)]]);_0x25f1a2['length']>0x0&&(_0x4c396b=_0x25f1a2[0x0]);}catch(_0x4aa4a2){console[_0x57dc36(0x20f)]({'err':_0x4aa4a2}),_0x5e4fa6[_0x57dc36(0x1da)](0x1f4)['json']({'error':_0x57dc36(0x208)});return;}if(!_0x4c396b){_0x5e4fa6[_0x57dc36(0x1da)](0x191)[_0x57dc36(0x1fc)]({'error':_0x57dc36(0x202)});return;}let _0x199670=_0x4c396b[_0x57dc36(0x207)];if(!_0x199670){_0x199670=randomUUID();try{await conn['promise']()[_0x57dc36(0x1f2)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x199670,_0x530416[_0x57dc36(0x1f1)][_0x57dc36(0x1fa)]]);}catch(_0x38696d){console[_0x57dc36(0x20f)]({'err':_0x38696d}),_0x5e4fa6[_0x57dc36(0x1da)](0x1f4)['json']({'error':_0x57dc36(0x208)});return;}}const _0x293142=_0x57dc36(0x201)+_0x199670;!fs[_0x57dc36(0x1e1)](_0x293142)&&fs[_0x57dc36(0x1fb)](_0x293142);if(!_0x3d8ace){const _0x27d6bb=new Error(_0x57dc36(0x1ec));return _0x27d6bb[_0x57dc36(0x1e2)]=0x190,_0x1292e4(_0x27d6bb);}const _0x2c73c9=fs[_0x57dc36(0x1f8)](_0x293142)[_0x57dc36(0x1e7)]+_0x3d8ace[_0x57dc36(0x1e7)];console['log']({'numberOfSize':_0x2c73c9});if(_0x2c73c9>userFolderMaximumFiles)return _0x5e4fa6[_0x57dc36(0x1da)](0x190)[_0x57dc36(0x1fc)]({'error':_0x57dc36(0x1ff)+userFolderMaximumFiles+_0x57dc36(0x1f5)});const _0x197683=fs[_0x57dc36(0x1f8)](_0x293142)[_0x57dc36(0x20d)]((_0x4c5410,_0x18e7c9)=>_0x4c5410+fs['statSync'](_0x293142+'/'+_0x18e7c9)[_0x57dc36(0x1de)],0x0),_0x381176=_0x3d8ace['reduce']((_0x1ccc7a,_0x100348)=>_0x1ccc7a+_0x100348['size'],0x0);console['log']({'totalSize':_0x197683,'uploadedSize':_0x381176});if(_0x381176+_0x197683>userFolderMaximumSizeInMB*0x400*0x400)return _0x5e4fa6['status'](0x190)['json']({'error':_0x57dc36(0x1ff)+userFolderMaximumSizeInMB+_0x57dc36(0x203)});_0x3d8ace[_0x57dc36(0x205)](_0x52f412=>{const _0x166c7e=_0x57dc36;fs[_0x166c7e(0x1db)](_0x52f412[_0x166c7e(0x1e0)],_0x293142+'/'+_0x52f412[_0x166c7e(0x1df)]),fs['unlinkSync'](_0x52f412[_0x166c7e(0x1e0)]);}),_0x5e4fa6[_0x57dc36(0x20a)]({'files':_0x3d8ace[_0x57dc36(0x1e4)](_0x529ca4=>({..._0x529ca4,'path':_0x293142+'/'+_0x529ca4[_0x57dc36(0x1df)]}))});}),router[a9_0x164336(0x1eb)](a9_0x164336(0x209),verifyToken,async(_0x5585c8,_0x3ed337)=>{const _0x473d32=a9_0x164336,{path:_0x10dec7,folder_name:_0x596d8f}=_0x5585c8['body'];console['log']({'path':_0x10dec7,'folder_name':_0x596d8f});if(!_0x10dec7)return _0x3ed337[_0x473d32(0x1da)](0x190)['json']({'error':'Path\x20is\x20required'});if(!_0x596d8f)return _0x3ed337[_0x473d32(0x1da)](0x190)['json']({'error':_0x473d32(0x1f7)});const _0x1231bf=_0x10dec7+'/'+_0x596d8f;!fs['existsSync'](_0x1231bf)&&fs[_0x473d32(0x1fb)](_0x1231bf),_0x3ed337[_0x473d32(0x20a)]({'path':_0x1231bf});}),router['delete'](a9_0x164336(0x1ef),verifyToken,async(_0x5e1be2,_0x14a7ce)=>{const _0x554982=a9_0x164336,{isFolder:_0x4baa5b,path:_0x5b86f7}=_0x5e1be2['body'];!_0x4baa5b?fs[_0x554982(0x1e3)](_0x5b86f7):fs['rmdirSync'](_0x5b86f7,{'recursive':!![]}),_0x14a7ce['send']({'success':!![]});}),module[a9_0x164336(0x20c)]=router;