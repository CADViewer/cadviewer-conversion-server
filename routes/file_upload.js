function a8_0x5443(_0x48897f,_0x166f76){const _0x2c4928=a8_0x2c49();return a8_0x5443=function(_0x5443ab,_0x1bdd39){_0x5443ab=_0x5443ab-0x14d;let _0x33ee7c=_0x2c4928[_0x5443ab];return _0x33ee7c;},a8_0x5443(_0x48897f,_0x166f76);}const a8_0x57c918=a8_0x5443;(function(_0x2b6286,_0x493f44){const _0x499c97=a8_0x5443,_0x441fa9=_0x2b6286();while(!![]){try{const _0x4ac2a5=-parseInt(_0x499c97(0x17e))/0x1*(parseInt(_0x499c97(0x15c))/0x2)+parseInt(_0x499c97(0x159))/0x3+parseInt(_0x499c97(0x180))/0x4+-parseInt(_0x499c97(0x158))/0x5*(-parseInt(_0x499c97(0x17d))/0x6)+-parseInt(_0x499c97(0x16d))/0x7*(parseInt(_0x499c97(0x157))/0x8)+parseInt(_0x499c97(0x156))/0x9+parseInt(_0x499c97(0x17b))/0xa*(parseInt(_0x499c97(0x15e))/0xb);if(_0x4ac2a5===_0x493f44)break;else _0x441fa9['push'](_0x441fa9['shift']());}catch(_0x313ecb){_0x441fa9['push'](_0x441fa9['shift']());}}}(a8_0x2c49,0x3332c));const multer=require(a8_0x57c918(0x154)),fs=require('fs'),{randomUUID}=require(a8_0x57c918(0x182)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x57c918(0x153)),conn=require(a8_0x57c918(0x176)),verifyToken=require('../libs/jwt')[a8_0x57c918(0x162)],dir=a8_0x57c918(0x175);function a8_0x2c49(){const _0xd4e7c4=['130qYxIsO','path','78InmKIF','8744rqtLCV','statSync','659152HhtSDP','folder_name','crypto','folderLocation','email','reduce','status','existsSync','forEach','../CADViewer_config.json','multer','unlinkSync','1675107ApSglO','2187352VfEPFg','38020kOwPIX','1250073tXAHFW','body','./uploads/','90ymlBWc','Error!\x20Something\x20went\x20wrong.','8591MezMZA','files','log','post','verifyToken','length','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','map','mkdirSync','/files','readdirSync','express','size','originalname','promise','7YRzooX','exports','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','Router','/remove','\x20files','send','json','./uploads','../libs/mysql.js','httpStatusCode','Path\x20is\x20required','user','Please\x20upload\x20a\x20file'];a8_0x2c49=function(){return _0xd4e7c4;};return a8_0x2c49();}!fs[a8_0x57c918(0x151)](dir)&&fs['mkdirSync'](dir);const express=require(a8_0x57c918(0x169)),router=express[a8_0x57c918(0x170)](),config=require('../CADViewer_config.json'),storage=multer['diskStorage']({'destination':function(_0x24d0fd,_0x3005d3,_0x297bd9){_0x297bd9(null,'uploads');}}),upload=multer({'storage':storage});router[a8_0x57c918(0x161)](a8_0x57c918(0x167),upload['array'](a8_0x57c918(0x15f)),verifyToken,async(_0x3ade87,_0x320cfb,_0x37404e)=>{const _0x2b679a=a8_0x57c918,_0x1d0745=_0x3ade87[_0x2b679a(0x15f)],{global:_0x40ff4c,path:_0x27956a}=_0x3ade87[_0x2b679a(0x15a)],_0x35c1dd=config['folderLocation'];console['log']({'global':_0x40ff4c}),console[_0x2b679a(0x160)](_0x1d0745),console[_0x2b679a(0x160)]({'user':_0x3ade87[_0x2b679a(0x179)]});if(_0x40ff4c){_0x1d0745[_0x2b679a(0x152)](_0x539bb2=>{const _0x21134e=_0x2b679a;fs['renameSync'](_0x539bb2[_0x21134e(0x17c)],(_0x27956a||_0x35c1dd)+'/'+_0x539bb2[_0x21134e(0x16b)]);}),_0x320cfb[_0x2b679a(0x173)]({'files':_0x1d0745[_0x2b679a(0x165)](_0x49e627=>({..._0x49e627,'path':(_0x27956a||_0x35c1dd)+'/'+_0x49e627[_0x2b679a(0x16b)]}))});return;}let _0x236607;try{const [_0xb52a43]=await conn['promise']()['execute'](_0x2b679a(0x164),[_0x3ade87['user'][_0x2b679a(0x14e)]]);_0xb52a43[_0x2b679a(0x163)]>0x0&&(_0x236607=_0xb52a43[0x0]);}catch(_0x5ee2a6){console[_0x2b679a(0x160)]({'err':_0x5ee2a6}),_0x320cfb[_0x2b679a(0x150)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x236607){_0x320cfb[_0x2b679a(0x150)](0x191)['json']({'error':'Invalid\x20user'});return;}let _0xd22fa0=_0x236607[_0x2b679a(0x181)];if(!_0xd22fa0){_0xd22fa0=randomUUID();try{await conn[_0x2b679a(0x16c)]()['execute']('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0xd22fa0,_0x3ade87[_0x2b679a(0x179)][_0x2b679a(0x14e)]]);}catch(_0x201e46){console[_0x2b679a(0x160)]({'err':_0x201e46}),_0x320cfb['status'](0x1f4)['json']({'error':_0x2b679a(0x15d)});return;}}const _0xf80f5d=_0x2b679a(0x15b)+_0xd22fa0;!fs[_0x2b679a(0x151)](_0xf80f5d)&&fs[_0x2b679a(0x166)](_0xf80f5d);if(!_0x1d0745){const _0x17db69=new Error(_0x2b679a(0x17a));return _0x17db69[_0x2b679a(0x177)]=0x190,_0x37404e(_0x17db69);}const _0x5a0f7b=fs[_0x2b679a(0x168)](_0xf80f5d)[_0x2b679a(0x163)]+_0x1d0745['length'];console[_0x2b679a(0x160)]({'numberOfSize':_0x5a0f7b});if(_0x5a0f7b>userFolderMaximumFiles)return _0x320cfb[_0x2b679a(0x150)](0x190)[_0x2b679a(0x174)]({'error':_0x2b679a(0x16f)+userFolderMaximumFiles+_0x2b679a(0x172)});const _0x1d6f8f=fs['readdirSync'](_0xf80f5d)[_0x2b679a(0x14f)]((_0x21f2e1,_0x253d4c)=>_0x21f2e1+fs[_0x2b679a(0x17f)](_0xf80f5d+'/'+_0x253d4c)[_0x2b679a(0x16a)],0x0),_0xa597dd=_0x1d0745[_0x2b679a(0x14f)]((_0xa7f37f,_0x7af862)=>_0xa7f37f+_0x7af862[_0x2b679a(0x16a)],0x0);console[_0x2b679a(0x160)]({'totalSize':_0x1d6f8f,'uploadedSize':_0xa597dd});if(_0xa597dd+_0x1d6f8f>userFolderMaximumSizeInMB*0x400*0x400)return _0x320cfb[_0x2b679a(0x150)](0x190)[_0x2b679a(0x174)]({'error':_0x2b679a(0x16f)+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x1d0745[_0x2b679a(0x152)](_0x21ce99=>{const _0x1c7ae4=_0x2b679a;fs['renameSync'](_0x21ce99[_0x1c7ae4(0x17c)],_0xf80f5d+'/'+_0x21ce99['originalname']);}),_0x320cfb['send']({'files':_0x1d0745[_0x2b679a(0x165)](_0x57cddd=>({..._0x57cddd,'path':_0xf80f5d+'/'+_0x57cddd[_0x2b679a(0x16b)]}))});}),router[a8_0x57c918(0x161)]('/folder',verifyToken,async(_0x146332,_0x1c44c3)=>{const _0x10f178=a8_0x57c918,{path:_0x3ba7b1,folder_name:_0x3d8db5}=_0x146332['body'],_0x55058b=config[_0x10f178(0x14d)];console['log']({'path':_0x3ba7b1,'folder_name':_0x3d8db5});if(!_0x3ba7b1)return _0x1c44c3[_0x10f178(0x150)](0x190)[_0x10f178(0x174)]({'error':_0x10f178(0x178)});if(!_0x3d8db5)return _0x1c44c3[_0x10f178(0x150)](0x190)[_0x10f178(0x174)]({'error':'Folder\x20name\x20is\x20required'});const _0x43fe3c=_0x3ba7b1+'/'+_0x3d8db5;!fs[_0x10f178(0x151)](_0x43fe3c)&&fs[_0x10f178(0x166)](_0x43fe3c),_0x1c44c3[_0x10f178(0x173)]({'path':_0x43fe3c});}),router['delete'](a8_0x57c918(0x171),verifyToken,async(_0x462d1a,_0xf1ded0)=>{const _0x404f55=a8_0x57c918,{isFolder:_0x25bb5b,path:_0x36ea94}=_0x462d1a[_0x404f55(0x15a)];!_0x25bb5b?fs[_0x404f55(0x155)](_0x36ea94):fs['rmdirSync'](_0x36ea94,{'recursive':!![]}),_0xf1ded0[_0x404f55(0x173)]({'success':!![]});}),module[a8_0x57c918(0x16e)]=router;