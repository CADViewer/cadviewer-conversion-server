const a8_0x4488d0=a8_0x1cb4;function a8_0x1cb4(_0x3b5824,_0x32d1ea){const _0x32e05f=a8_0x32e0();return a8_0x1cb4=function(_0x1cb434,_0x36349c){_0x1cb434=_0x1cb434-0x17f;let _0x3c5adc=_0x32e05f[_0x1cb434];return _0x3c5adc;},a8_0x1cb4(_0x3b5824,_0x32d1ea);}(function(_0x32c4af,_0x277c83){const _0x4ef6be=a8_0x1cb4,_0x133ec8=_0x32c4af();while(!![]){try{const _0x3e62e0=parseInt(_0x4ef6be(0x1b5))/0x1*(parseInt(_0x4ef6be(0x1ac))/0x2)+parseInt(_0x4ef6be(0x1aa))/0x3+-parseInt(_0x4ef6be(0x1a3))/0x4+parseInt(_0x4ef6be(0x198))/0x5*(-parseInt(_0x4ef6be(0x1b2))/0x6)+-parseInt(_0x4ef6be(0x1ae))/0x7+-parseInt(_0x4ef6be(0x18c))/0x8*(-parseInt(_0x4ef6be(0x185))/0x9)+parseInt(_0x4ef6be(0x196))/0xa;if(_0x3e62e0===_0x277c83)break;else _0x133ec8['push'](_0x133ec8['shift']());}catch(_0x105ebd){_0x133ec8['push'](_0x133ec8['shift']());}}}(a8_0x32e0,0x59b05));const multer=require(a8_0x4488d0(0x19b)),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x4488d0(0x181)),conn=require(a8_0x4488d0(0x18e)),verifyToken=require(a8_0x4488d0(0x1a9))[a8_0x4488d0(0x18b)],dir='./uploads';!fs['existsSync'](dir)&&fs['mkdirSync'](dir);function a8_0x32e0(){const _0x46c0dd=['Folder\x20name\x20is\x20required','../libs/mysql.js','map','uploads','files','express','unlinkSync','body','folder_name','13136180mWKJyE','folderLocation','139115sDLVcF','json','size','multer','readdirSync','path','/folder','send','originalname','user','Please\x20upload\x20a\x20file','2413032wpyTFu','length','post','\x20MB\x20of\x20files','array','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','../libs/jwt','1155621kmGEfv','httpStatusCode','238RWEVXN','/files','3349486IjyWqy','delete','promise','existsSync','138sdMTmV','forEach','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','2738ExPGRE','execute','exports','../CADViewer_config.json','log','email','./uploads/','9SwgeKp','diskStorage','status','Path\x20is\x20required','mkdirSync','reduce','verifyToken','515224eGvdlz'];a8_0x32e0=function(){return _0x46c0dd;};return a8_0x32e0();}const express=require(a8_0x4488d0(0x192)),router=express['Router'](),config=require('../CADViewer_config.json'),storage=multer[a8_0x4488d0(0x186)]({'destination':function(_0x5a2b70,_0x1f4a9f,_0x2fee91){const _0x26bac0=a8_0x4488d0;_0x2fee91(null,_0x26bac0(0x190));}}),upload=multer({'storage':storage});router[a8_0x4488d0(0x1a5)](a8_0x4488d0(0x1ad),upload[a8_0x4488d0(0x1a7)](a8_0x4488d0(0x191)),verifyToken,async(_0x5e1cc0,_0x2b4665,_0x51a803)=>{const _0xb8bc0b=a8_0x4488d0,_0x4df4a8=_0x5e1cc0[_0xb8bc0b(0x191)],{global:_0x5a38b8,path:_0x2d1654}=_0x5e1cc0['body'],_0x2d10a1=config[_0xb8bc0b(0x197)];console['log']({'global':_0x5a38b8}),console['log'](_0x4df4a8),console[_0xb8bc0b(0x182)]({'user':_0x5e1cc0[_0xb8bc0b(0x1a1)]});if(_0x5a38b8){_0x4df4a8[_0xb8bc0b(0x1b3)](_0x15d0f2=>{const _0x1596c6=_0xb8bc0b;fs['renameSync'](_0x15d0f2[_0x1596c6(0x19d)],(_0x2d1654||_0x2d10a1)+'/'+_0x15d0f2['originalname']);}),_0x2b4665['send']({'files':_0x4df4a8[_0xb8bc0b(0x18f)](_0xd56757=>({..._0xd56757,'path':(_0x2d1654||_0x2d10a1)+'/'+_0xd56757['originalname']}))});return;}let _0x54bd74;try{const [_0x57c446]=await conn[_0xb8bc0b(0x1b0)]()[_0xb8bc0b(0x17f)](_0xb8bc0b(0x1b4),[_0x5e1cc0[_0xb8bc0b(0x1a1)]['email']]);_0x57c446[_0xb8bc0b(0x1a4)]>0x0&&(_0x54bd74=_0x57c446[0x0]);}catch(_0xb547ec){console[_0xb8bc0b(0x182)]({'err':_0xb547ec}),_0x2b4665[_0xb8bc0b(0x187)](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x54bd74){_0x2b4665[_0xb8bc0b(0x187)](0x191)[_0xb8bc0b(0x199)]({'error':'Invalid\x20user'});return;}let _0x26e4f0=_0x54bd74[_0xb8bc0b(0x195)];if(!_0x26e4f0){_0x26e4f0=randomUUID();try{await conn[_0xb8bc0b(0x1b0)]()[_0xb8bc0b(0x17f)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x26e4f0,_0x5e1cc0[_0xb8bc0b(0x1a1)][_0xb8bc0b(0x183)]]);}catch(_0x2f4a03){console['log']({'err':_0x2f4a03}),_0x2b4665[_0xb8bc0b(0x187)](0x1f4)[_0xb8bc0b(0x199)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x2bfa80=_0xb8bc0b(0x184)+_0x26e4f0;!fs[_0xb8bc0b(0x1b1)](_0x2bfa80)&&fs[_0xb8bc0b(0x189)](_0x2bfa80);if(!_0x4df4a8){const _0x3d60a3=new Error(_0xb8bc0b(0x1a2));return _0x3d60a3[_0xb8bc0b(0x1ab)]=0x190,_0x51a803(_0x3d60a3);}const _0x69533=fs[_0xb8bc0b(0x19c)](_0x2bfa80)[_0xb8bc0b(0x1a4)]+_0x4df4a8['length'];console['log']({'numberOfSize':_0x69533});if(_0x69533>userFolderMaximumFiles)return _0x2b4665[_0xb8bc0b(0x187)](0x190)[_0xb8bc0b(0x199)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+'\x20files'});const _0x512eeb=fs[_0xb8bc0b(0x19c)](_0x2bfa80)[_0xb8bc0b(0x18a)]((_0x4f4403,_0x1596c4)=>_0x4f4403+fs['statSync'](_0x2bfa80+'/'+_0x1596c4)[_0xb8bc0b(0x19a)],0x0),_0x50a61c=_0x4df4a8[_0xb8bc0b(0x18a)]((_0x31ab4,_0x54263b)=>_0x31ab4+_0x54263b[_0xb8bc0b(0x19a)],0x0);console[_0xb8bc0b(0x182)]({'totalSize':_0x512eeb,'uploadedSize':_0x50a61c});if(_0x50a61c+_0x512eeb>userFolderMaximumSizeInMB*0x400*0x400)return _0x2b4665[_0xb8bc0b(0x187)](0x190)[_0xb8bc0b(0x199)]({'error':_0xb8bc0b(0x1a8)+userFolderMaximumSizeInMB+_0xb8bc0b(0x1a6)});_0x4df4a8[_0xb8bc0b(0x1b3)](_0x40da16=>{const _0x46ecef=_0xb8bc0b;fs['renameSync'](_0x40da16[_0x46ecef(0x19d)],_0x2bfa80+'/'+_0x40da16[_0x46ecef(0x1a0)]);}),_0x2b4665[_0xb8bc0b(0x19f)]({'files':_0x4df4a8['map'](_0x22a6e2=>({..._0x22a6e2,'path':_0x2bfa80+'/'+_0x22a6e2[_0xb8bc0b(0x1a0)]}))});}),router['post'](a8_0x4488d0(0x19e),verifyToken,async(_0x4cd259,_0x3b990f)=>{const _0x305a3a=a8_0x4488d0,{path:_0x2dbaee,folder_name:_0x21b8f9}=_0x4cd259[_0x305a3a(0x194)],_0x405107=config[_0x305a3a(0x197)];console[_0x305a3a(0x182)]({'path':_0x2dbaee,'folder_name':_0x21b8f9});if(!_0x2dbaee)return _0x3b990f[_0x305a3a(0x187)](0x190)['json']({'error':_0x305a3a(0x188)});if(!_0x21b8f9)return _0x3b990f[_0x305a3a(0x187)](0x190)[_0x305a3a(0x199)]({'error':_0x305a3a(0x18d)});const _0x1767cf=_0x2dbaee+'/'+_0x21b8f9;!fs['existsSync'](_0x1767cf)&&fs[_0x305a3a(0x189)](_0x1767cf),_0x3b990f[_0x305a3a(0x19f)]({'path':_0x1767cf});}),router[a8_0x4488d0(0x1af)]('/remove',verifyToken,async(_0x6e86e6,_0x1bc285)=>{const _0x35f4ca=a8_0x4488d0,{isFolder:_0x304e66,path:_0x90daa6}=_0x6e86e6['body'];!_0x304e66?fs[_0x35f4ca(0x193)](_0x90daa6):fs['rmdirSync'](_0x90daa6,{'recursive':!![]}),_0x1bc285['send']({'success':!![]});}),module[a8_0x4488d0(0x180)]=router;