function a8_0x2d79(_0x151780,_0x3cbac9){const _0x3d24ba=a8_0x3d24();return a8_0x2d79=function(_0x2d793d,_0x166225){_0x2d793d=_0x2d793d-0x1e8;let _0x385765=_0x3d24ba[_0x2d793d];return _0x385765;},a8_0x2d79(_0x151780,_0x3cbac9);}const a8_0x1a09e3=a8_0x2d79;(function(_0x54e6dc,_0x18f28b){const _0x25d3b7=a8_0x2d79,_0x48412e=_0x54e6dc();while(!![]){try{const _0x32ff7e=-parseInt(_0x25d3b7(0x215))/0x1+-parseInt(_0x25d3b7(0x1ee))/0x2+parseInt(_0x25d3b7(0x219))/0x3*(parseInt(_0x25d3b7(0x213))/0x4)+-parseInt(_0x25d3b7(0x20f))/0x5+parseInt(_0x25d3b7(0x21b))/0x6+parseInt(_0x25d3b7(0x1f2))/0x7+parseInt(_0x25d3b7(0x1e9))/0x8*(parseInt(_0x25d3b7(0x1ed))/0x9);if(_0x32ff7e===_0x18f28b)break;else _0x48412e['push'](_0x48412e['shift']());}catch(_0x91af3e){_0x48412e['push'](_0x48412e['shift']());}}}(a8_0x3d24,0xd1a07));const multer=require(a8_0x1a09e3(0x1e8)),fs=require('fs'),{randomUUID}=require(a8_0x1a09e3(0x1f0)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x1a09e3(0x217)),conn=require(a8_0x1a09e3(0x214)),verifyToken=require('../libs/jwt')[a8_0x1a09e3(0x216)],dir=a8_0x1a09e3(0x208);!fs['existsSync'](dir)&&fs[a8_0x1a09e3(0x210)](dir);function a8_0x3d24(){const _0x300258=['files','reduce','18673803iLtpOM','2925338GMWkTe','map','crypto','\x20MB\x20of\x20files','2217663mdunjL','promise','folderLocation','json','./uploads/','Error!\x20Something\x20went\x20wrong.','unlinkSync','post','delete','originalname','Router','/remove','exports','folder_name','body','existsSync','log','user','/files','diskStorage','array','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','./uploads','uploads','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','send','readdirSync','email','Please\x20upload\x20a\x20file','7481445RgNwgP','mkdirSync','length','execute','88heScVI','../libs/mysql.js','629644yXRiIZ','verifyToken','../CADViewer_config.json','statSync','115131Bhpzko','size','7267578CZluJp','status','multer','8rokWcD','\x20files'];a8_0x3d24=function(){return _0x300258;};return a8_0x3d24();}const express=require('express'),router=express[a8_0x1a09e3(0x1fc)](),config=require('../CADViewer_config.json'),storage=multer[a8_0x1a09e3(0x205)]({'destination':function(_0xb3d34a,_0x124891,_0x35b138){const _0x50482e=a8_0x1a09e3;_0x35b138(null,_0x50482e(0x209));}}),upload=multer({'storage':storage});router[a8_0x1a09e3(0x1f9)](a8_0x1a09e3(0x204),upload[a8_0x1a09e3(0x206)](a8_0x1a09e3(0x1eb)),verifyToken,async(_0x21fb84,_0x432956,_0x285d12)=>{const _0x567855=a8_0x1a09e3,_0x439e88=_0x21fb84[_0x567855(0x1eb)],{global:_0x1d9712,path:_0x1c5bf0}=_0x21fb84['body'],_0x532e51=config[_0x567855(0x1f4)];console[_0x567855(0x202)]({'global':_0x1d9712}),console[_0x567855(0x202)](_0x439e88),console[_0x567855(0x202)]({'user':_0x21fb84[_0x567855(0x203)]});if(_0x1d9712){_0x439e88['forEach'](_0x565353=>{fs['renameSync'](_0x565353['path'],(_0x1c5bf0||_0x532e51)+'/'+_0x565353['originalname']);}),_0x432956[_0x567855(0x20b)]({'files':_0x439e88[_0x567855(0x1ef)](_0x3f4feb=>({..._0x3f4feb,'path':(_0x1c5bf0||_0x532e51)+'/'+_0x3f4feb[_0x567855(0x1fb)]}))});return;}let _0x501d51;try{const [_0xf88301]=await conn[_0x567855(0x1f3)]()['execute'](_0x567855(0x20a),[_0x21fb84[_0x567855(0x203)][_0x567855(0x20d)]]);_0xf88301[_0x567855(0x211)]>0x0&&(_0x501d51=_0xf88301[0x0]);}catch(_0x4a1f34){console[_0x567855(0x202)]({'err':_0x4a1f34}),_0x432956['status'](0x1f4)[_0x567855(0x1f5)]({'error':_0x567855(0x1f7)});return;}if(!_0x501d51){_0x432956[_0x567855(0x21c)](0x191)[_0x567855(0x1f5)]({'error':'Invalid\x20user'});return;}let _0x26aa35=_0x501d51[_0x567855(0x1ff)];if(!_0x26aa35){_0x26aa35=randomUUID();try{await conn['promise']()[_0x567855(0x212)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x26aa35,_0x21fb84['user'][_0x567855(0x20d)]]);}catch(_0x344b35){console['log']({'err':_0x344b35}),_0x432956[_0x567855(0x21c)](0x1f4)[_0x567855(0x1f5)]({'error':_0x567855(0x1f7)});return;}}const _0xb2f7b0=_0x567855(0x1f6)+_0x26aa35;!fs[_0x567855(0x201)](_0xb2f7b0)&&fs[_0x567855(0x210)](_0xb2f7b0);if(!_0x439e88){const _0x2e97e2=new Error(_0x567855(0x20e));return _0x2e97e2['httpStatusCode']=0x190,_0x285d12(_0x2e97e2);}const _0x5e2759=fs['readdirSync'](_0xb2f7b0)[_0x567855(0x211)]+_0x439e88[_0x567855(0x211)];console[_0x567855(0x202)]({'numberOfSize':_0x5e2759});if(_0x5e2759>userFolderMaximumFiles)return _0x432956[_0x567855(0x21c)](0x190)[_0x567855(0x1f5)]({'error':_0x567855(0x207)+userFolderMaximumFiles+_0x567855(0x1ea)});const _0x319488=fs[_0x567855(0x20c)](_0xb2f7b0)[_0x567855(0x1ec)]((_0x2000d1,_0x20fc59)=>_0x2000d1+fs[_0x567855(0x218)](_0xb2f7b0+'/'+_0x20fc59)['size'],0x0),_0xd3b884=_0x439e88['reduce']((_0x156b48,_0x397658)=>_0x156b48+_0x397658[_0x567855(0x21a)],0x0);console[_0x567855(0x202)]({'totalSize':_0x319488,'uploadedSize':_0xd3b884});if(_0xd3b884+_0x319488>userFolderMaximumSizeInMB*0x400*0x400)return _0x432956[_0x567855(0x21c)](0x190)['json']({'error':_0x567855(0x207)+userFolderMaximumSizeInMB+_0x567855(0x1f1)});_0x439e88['forEach'](_0x35a782=>{const _0x579b6b=_0x567855;fs['renameSync'](_0x35a782['path'],_0xb2f7b0+'/'+_0x35a782[_0x579b6b(0x1fb)]);}),_0x432956['send']({'files':_0x439e88[_0x567855(0x1ef)](_0x2c0367=>({..._0x2c0367,'path':_0xb2f7b0+'/'+_0x2c0367[_0x567855(0x1fb)]}))});}),router[a8_0x1a09e3(0x1f9)]('/folder',verifyToken,async(_0x3a7a05,_0x5faaf6)=>{const _0x63cc55=a8_0x1a09e3,{path:_0x525128,folder_name:_0x546b42}=_0x3a7a05[_0x63cc55(0x200)],_0x5cec9b=config[_0x63cc55(0x1f4)];console[_0x63cc55(0x202)]({'path':_0x525128,'folder_name':_0x546b42});if(!_0x525128)return _0x5faaf6[_0x63cc55(0x21c)](0x190)[_0x63cc55(0x1f5)]({'error':'Path\x20is\x20required'});if(!_0x546b42)return _0x5faaf6[_0x63cc55(0x21c)](0x190)[_0x63cc55(0x1f5)]({'error':'Folder\x20name\x20is\x20required'});const _0x454e83=_0x525128+'/'+_0x546b42;!fs[_0x63cc55(0x201)](_0x454e83)&&fs[_0x63cc55(0x210)](_0x454e83),_0x5faaf6[_0x63cc55(0x20b)]({'path':_0x454e83});}),router[a8_0x1a09e3(0x1fa)](a8_0x1a09e3(0x1fd),verifyToken,async(_0x4ea85e,_0x31f98c)=>{const _0x16d7ef=a8_0x1a09e3,{isFolder:_0x19a164,path:_0x111f51}=_0x4ea85e['body'];!_0x19a164?fs[_0x16d7ef(0x1f8)](_0x111f51):fs['rmdirSync'](_0x111f51,{'recursive':!![]}),_0x31f98c[_0x16d7ef(0x20b)]({'success':!![]});}),module[a8_0x1a09e3(0x1fe)]=router;