function a8_0x4d7e(){const _0x220731=['status','renameSync','existsSync','readdirSync','/folder','5884268AvzntQ','\x20MB\x20of\x20files','user','Invalid\x20user','forEach','array','2877278IojGXd','promise','files','map','../CADViewer_config.json','uploads','Router','path','/remove','crypto','body','email','length','./uploads/','1766226QMSAYp','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','Folder\x20name\x20is\x20required','11660411kkuHYu','size','log','\x20files','1474843RSCGxx','../libs/jwt','Error!\x20Something\x20went\x20wrong.','statSync','send','reduce','./uploads','execute','verifyToken','1553448YCMynY','json','folder_name','mkdirSync','1461460AYGpKs','post','folderLocation','originalname','delete','unlinkSync','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'];a8_0x4d7e=function(){return _0x220731;};return a8_0x4d7e();}const a8_0x406aa4=a8_0x5ea3;(function(_0x477d77,_0x410711){const _0x3c9c34=a8_0x5ea3,_0x290dfe=_0x477d77();while(!![]){try{const _0x221bf3=parseInt(_0x3c9c34(0x1a4))/0x1+parseInt(_0x3c9c34(0x18e))/0x2+parseInt(_0x3c9c34(0x1ad))/0x3+-parseInt(_0x3c9c34(0x188))/0x4+parseInt(_0x3c9c34(0x17c))/0x5+parseInt(_0x3c9c34(0x19c))/0x6+-parseInt(_0x3c9c34(0x1a0))/0x7;if(_0x221bf3===_0x410711)break;else _0x290dfe['push'](_0x290dfe['shift']());}catch(_0x52aaa1){_0x290dfe['push'](_0x290dfe['shift']());}}}(a8_0x4d7e,0xd71e1));const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a8_0x406aa4(0x197)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x406aa4(0x192)),conn=require('../libs/mysql.js'),verifyToken=require(a8_0x406aa4(0x1a5))[a8_0x406aa4(0x1ac)],dir=a8_0x406aa4(0x1aa);!fs[a8_0x406aa4(0x185)](dir)&&fs['mkdirSync'](dir);function a8_0x5ea3(_0x2e3250,_0x218d25){const _0x4d7e71=a8_0x4d7e();return a8_0x5ea3=function(_0x5ea388,_0x12897f){_0x5ea388=_0x5ea388-0x179;let _0x177001=_0x4d7e71[_0x5ea388];return _0x177001;},a8_0x5ea3(_0x2e3250,_0x218d25);}const express=require('express'),router=express[a8_0x406aa4(0x194)](),config=require(a8_0x406aa4(0x192)),storage=multer['diskStorage']({'destination':function(_0x3d3d22,_0xc728f,_0x3aa72b){const _0x1a23f2=a8_0x406aa4;_0x3aa72b(null,_0x1a23f2(0x193));}}),upload=multer({'storage':storage});router[a8_0x406aa4(0x17d)]('/files',upload[a8_0x406aa4(0x18d)](a8_0x406aa4(0x190)),verifyToken,async(_0x27ae1d,_0x3166a1,_0x2fc4df)=>{const _0x1a70d1=a8_0x406aa4,_0x4b034c=_0x27ae1d[_0x1a70d1(0x190)],{global:_0x25765a,path:_0x1d7ff5}=_0x27ae1d[_0x1a70d1(0x198)],_0x10f2bf=config[_0x1a70d1(0x17e)];console[_0x1a70d1(0x1a2)]({'global':_0x25765a}),console['log'](_0x4b034c),console[_0x1a70d1(0x1a2)]({'user':_0x27ae1d[_0x1a70d1(0x18a)]});if(_0x25765a){_0x4b034c[_0x1a70d1(0x18c)](_0x3a490c=>{const _0x49c64b=_0x1a70d1;fs['renameSync'](_0x3a490c[_0x49c64b(0x195)],(_0x1d7ff5||_0x10f2bf)+'/'+_0x3a490c['originalname']);}),_0x3166a1[_0x1a70d1(0x1a8)]({'files':_0x4b034c[_0x1a70d1(0x191)](_0x5e998f=>({..._0x5e998f,'path':(_0x1d7ff5||_0x10f2bf)+'/'+_0x5e998f['originalname']}))});return;}let _0x2cbae3;try{const [_0x464f98]=await conn[_0x1a70d1(0x18f)]()['execute'](_0x1a70d1(0x19d),[_0x27ae1d[_0x1a70d1(0x18a)][_0x1a70d1(0x199)]]);_0x464f98[_0x1a70d1(0x19a)]>0x0&&(_0x2cbae3=_0x464f98[0x0]);}catch(_0xbd8cb6){console['log']({'err':_0xbd8cb6}),_0x3166a1[_0x1a70d1(0x183)](0x1f4)['json']({'error':_0x1a70d1(0x1a6)});return;}if(!_0x2cbae3){_0x3166a1[_0x1a70d1(0x183)](0x191)[_0x1a70d1(0x179)]({'error':_0x1a70d1(0x18b)});return;}let _0x462a83=_0x2cbae3[_0x1a70d1(0x17a)];if(!_0x462a83){_0x462a83=randomUUID();try{await conn[_0x1a70d1(0x18f)]()[_0x1a70d1(0x1ab)](_0x1a70d1(0x19e),[_0x462a83,_0x27ae1d['user'][_0x1a70d1(0x199)]]);}catch(_0x2a6fc9){console[_0x1a70d1(0x1a2)]({'err':_0x2a6fc9}),_0x3166a1[_0x1a70d1(0x183)](0x1f4)[_0x1a70d1(0x179)]({'error':_0x1a70d1(0x1a6)});return;}}const _0xceba15=_0x1a70d1(0x19b)+_0x462a83;!fs[_0x1a70d1(0x185)](_0xceba15)&&fs['mkdirSync'](_0xceba15);if(!_0x4b034c){const _0xbd973a=new Error('Please\x20upload\x20a\x20file');return _0xbd973a['httpStatusCode']=0x190,_0x2fc4df(_0xbd973a);}const _0x55adee=fs['readdirSync'](_0xceba15)[_0x1a70d1(0x19a)]+_0x4b034c[_0x1a70d1(0x19a)];console[_0x1a70d1(0x1a2)]({'numberOfSize':_0x55adee});if(_0x55adee>userFolderMaximumFiles)return _0x3166a1[_0x1a70d1(0x183)](0x190)['json']({'error':_0x1a70d1(0x182)+userFolderMaximumFiles+_0x1a70d1(0x1a3)});const _0x5b0552=fs[_0x1a70d1(0x186)](_0xceba15)[_0x1a70d1(0x1a9)]((_0x35537f,_0x2ea672)=>_0x35537f+fs[_0x1a70d1(0x1a7)](_0xceba15+'/'+_0x2ea672)[_0x1a70d1(0x1a1)],0x0),_0x11d429=_0x4b034c[_0x1a70d1(0x1a9)]((_0x4030cb,_0xb90d36)=>_0x4030cb+_0xb90d36[_0x1a70d1(0x1a1)],0x0);console['log']({'totalSize':_0x5b0552,'uploadedSize':_0x11d429});if(_0x11d429+_0x5b0552>userFolderMaximumSizeInMB*0x400*0x400)return _0x3166a1['status'](0x190)[_0x1a70d1(0x179)]({'error':_0x1a70d1(0x182)+userFolderMaximumSizeInMB+_0x1a70d1(0x189)});_0x4b034c[_0x1a70d1(0x18c)](_0x5b0d35=>{const _0x43ff87=_0x1a70d1;fs[_0x43ff87(0x184)](_0x5b0d35[_0x43ff87(0x195)],_0xceba15+'/'+_0x5b0d35[_0x43ff87(0x17f)]);}),_0x3166a1[_0x1a70d1(0x1a8)]({'files':_0x4b034c[_0x1a70d1(0x191)](_0xa25068=>({..._0xa25068,'path':_0xceba15+'/'+_0xa25068[_0x1a70d1(0x17f)]}))});}),router[a8_0x406aa4(0x17d)](a8_0x406aa4(0x187),verifyToken,async(_0x52f7c5,_0x3fc0e9)=>{const _0x17e4fd=a8_0x406aa4,{path:_0x32d08d,folder_name:_0x2c8076}=_0x52f7c5[_0x17e4fd(0x198)],_0x2d5e99=config[_0x17e4fd(0x17e)];console[_0x17e4fd(0x1a2)]({'path':_0x32d08d,'folder_name':_0x2c8076});if(!_0x32d08d)return _0x3fc0e9[_0x17e4fd(0x183)](0x190)['json']({'error':'Path\x20is\x20required'});if(!_0x2c8076)return _0x3fc0e9['status'](0x190)[_0x17e4fd(0x179)]({'error':_0x17e4fd(0x19f)});const _0x21106c=_0x32d08d+'/'+_0x2c8076;!fs['existsSync'](_0x21106c)&&fs[_0x17e4fd(0x17b)](_0x21106c),_0x3fc0e9[_0x17e4fd(0x1a8)]({'path':_0x21106c});}),router[a8_0x406aa4(0x180)](a8_0x406aa4(0x196),verifyToken,async(_0xbe7650,_0x2bab37)=>{const _0x216e0d=a8_0x406aa4,{isFolder:_0xde7520,path:_0x3ebf6b}=_0xbe7650[_0x216e0d(0x198)];!_0xde7520?fs[_0x216e0d(0x181)](_0x3ebf6b):fs['rmdirSync'](_0x3ebf6b,{'recursive':!![]}),_0x2bab37['send']({'success':!![]});}),module['exports']=router;