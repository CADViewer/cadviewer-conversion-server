const a8_0x3d6c3a=a8_0x2d49;(function(_0x56d035,_0x5853f2){const _0x4a5b6e=a8_0x2d49,_0x19150a=_0x56d035();while(!![]){try{const _0x1bed91=-parseInt(_0x4a5b6e(0xa6))/0x1*(parseInt(_0x4a5b6e(0xab))/0x2)+-parseInt(_0x4a5b6e(0xaa))/0x3*(-parseInt(_0x4a5b6e(0x9a))/0x4)+-parseInt(_0x4a5b6e(0xb6))/0x5+-parseInt(_0x4a5b6e(0xae))/0x6*(-parseInt(_0x4a5b6e(0xa3))/0x7)+parseInt(_0x4a5b6e(0xb5))/0x8+-parseInt(_0x4a5b6e(0xa8))/0x9*(-parseInt(_0x4a5b6e(0xac))/0xa)+parseInt(_0x4a5b6e(0xa0))/0xb;if(_0x1bed91===_0x5853f2)break;else _0x19150a['push'](_0x19150a['shift']());}catch(_0x5d4230){_0x19150a['push'](_0x19150a['shift']());}}}(a8_0x10ee,0xc667c));const multer=require(a8_0x3d6c3a(0xc2)),fs=require('fs'),{randomUUID}=require(a8_0x3d6c3a(0xa7)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x3d6c3a(0xbd)),conn=require(a8_0x3d6c3a(0xb0)),verifyToken=require('../libs/jwt')[a8_0x3d6c3a(0x9f)],dir=a8_0x3d6c3a(0xce);!fs[a8_0x3d6c3a(0xc1)](dir)&&fs[a8_0x3d6c3a(0xb8)](dir);function a8_0x2d49(_0x405a11,_0x3cd6fb){const _0x10ee03=a8_0x10ee();return a8_0x2d49=function(_0x2d49e6,_0xe618c){_0x2d49e6=_0x2d49e6-0x99;let _0x3269d0=_0x10ee03[_0x2d49e6];return _0x3269d0;},a8_0x2d49(_0x405a11,_0x3cd6fb);}const express=require(a8_0x3d6c3a(0xbc)),router=express[a8_0x3d6c3a(0xaf)](),config=require(a8_0x3d6c3a(0xbd)),storage=multer[a8_0x3d6c3a(0xb9)]({'destination':function(_0xcaa822,_0x2eeb4a,_0xef28c2){const _0x2e0565=a8_0x3d6c3a;_0xef28c2(null,_0x2e0565(0xd0));}}),upload=multer({'storage':storage});function a8_0x10ee(){const _0x6ef042=['post','verifyToken','3559589gdluYh','files','length','413UdiLVX','Error!\x20Something\x20went\x20wrong.','folder_name','3281GNqNig','crypto','447480JrTkuv','readdirSync','3734733MaSLvV','954mhrPdN','30ZQmIfz','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','23646ALVCpU','Router','../libs/mysql.js','rmdirSync','size','promise','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','4086456FGxqad','416455ONzXyM','email','mkdirSync','diskStorage','log','path','express','../CADViewer_config.json','map','body','Path\x20is\x20required','existsSync','multer','\x20MB\x20of\x20files','copyFileSync','unlinkSync','reduce','delete','./uploads/','originalname','status','exports','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','forEach','./uploads','json','uploads','statSync','4mTBmTS','/remove','send','user'];a8_0x10ee=function(){return _0x6ef042;};return a8_0x10ee();}router[a8_0x3d6c3a(0x9e)]('/files',upload['array'](a8_0x3d6c3a(0xa1)),verifyToken,async(_0x79e651,_0xebeba4,_0x1e4c36)=>{const _0x9bd63f=a8_0x3d6c3a,_0x53a93a=_0x79e651[_0x9bd63f(0xa1)],{global:_0x25c285,path:_0x2c6fa5}=_0x79e651[_0x9bd63f(0xbf)],_0x73984c=config['folderLocation'];console['log']({'global':_0x25c285}),console[_0x9bd63f(0xba)](_0x53a93a),console[_0x9bd63f(0xba)]({'user':_0x79e651['user']});if(_0x25c285){_0x53a93a[_0x9bd63f(0xcd)](_0x414d75=>{const _0x1b10b7=_0x9bd63f;fs[_0x1b10b7(0xc4)](_0x414d75[_0x1b10b7(0xbb)],(_0x2c6fa5||_0x73984c)+'/'+_0x414d75[_0x1b10b7(0xc9)]),fs['unlinkSync'](_0x414d75[_0x1b10b7(0xbb)]);}),_0xebeba4[_0x9bd63f(0x9c)]({'files':_0x53a93a[_0x9bd63f(0xbe)](_0x4e6efe=>({..._0x4e6efe,'path':(_0x2c6fa5||_0x73984c)+'/'+_0x4e6efe['originalname']}))});return;}let _0x320784;try{const [_0x2c9fc5]=await conn['promise']()['execute'](_0x9bd63f(0xb4),[_0x79e651[_0x9bd63f(0x9d)]['email']]);_0x2c9fc5[_0x9bd63f(0xa2)]>0x0&&(_0x320784=_0x2c9fc5[0x0]);}catch(_0x2322b7){console['log']({'err':_0x2322b7}),_0xebeba4[_0x9bd63f(0xca)](0x1f4)[_0x9bd63f(0xcf)]({'error':_0x9bd63f(0xa4)});return;}if(!_0x320784){_0xebeba4['status'](0x191)[_0x9bd63f(0xcf)]({'error':'Invalid\x20user'});return;}let _0x5e642c=_0x320784[_0x9bd63f(0xa5)];if(!_0x5e642c){_0x5e642c=randomUUID();try{await conn[_0x9bd63f(0xb3)]()['execute'](_0x9bd63f(0xad),[_0x5e642c,_0x79e651[_0x9bd63f(0x9d)][_0x9bd63f(0xb7)]]);}catch(_0x1e606c){console[_0x9bd63f(0xba)]({'err':_0x1e606c}),_0xebeba4[_0x9bd63f(0xca)](0x1f4)[_0x9bd63f(0xcf)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x38e203=_0x9bd63f(0xc8)+_0x5e642c;!fs[_0x9bd63f(0xc1)](_0x38e203)&&fs['mkdirSync'](_0x38e203);if(!_0x53a93a){const _0x2ad030=new Error('Please\x20upload\x20a\x20file');return _0x2ad030['httpStatusCode']=0x190,_0x1e4c36(_0x2ad030);}const _0x105505=fs[_0x9bd63f(0xa9)](_0x38e203)[_0x9bd63f(0xa2)]+_0x53a93a['length'];console[_0x9bd63f(0xba)]({'numberOfSize':_0x105505});if(_0x105505>userFolderMaximumFiles)return _0xebeba4[_0x9bd63f(0xca)](0x190)[_0x9bd63f(0xcf)]({'error':_0x9bd63f(0xcc)+userFolderMaximumFiles+'\x20files'});const _0x43d47c=fs[_0x9bd63f(0xa9)](_0x38e203)[_0x9bd63f(0xc6)]((_0x8e1b4,_0x1680b8)=>_0x8e1b4+fs[_0x9bd63f(0x99)](_0x38e203+'/'+_0x1680b8)[_0x9bd63f(0xb2)],0x0),_0x3828eb=_0x53a93a[_0x9bd63f(0xc6)]((_0x18a855,_0x1490a3)=>_0x18a855+_0x1490a3[_0x9bd63f(0xb2)],0x0);console[_0x9bd63f(0xba)]({'totalSize':_0x43d47c,'uploadedSize':_0x3828eb});if(_0x3828eb+_0x43d47c>userFolderMaximumSizeInMB*0x400*0x400)return _0xebeba4[_0x9bd63f(0xca)](0x190)[_0x9bd63f(0xcf)]({'error':_0x9bd63f(0xcc)+userFolderMaximumSizeInMB+_0x9bd63f(0xc3)});_0x53a93a[_0x9bd63f(0xcd)](_0x5d2297=>{const _0x2ffb22=_0x9bd63f;fs[_0x2ffb22(0xc4)](_0x5d2297['path'],_0x38e203+'/'+_0x5d2297[_0x2ffb22(0xc9)]),fs[_0x2ffb22(0xc5)](_0x5d2297[_0x2ffb22(0xbb)]);}),_0xebeba4[_0x9bd63f(0x9c)]({'files':_0x53a93a[_0x9bd63f(0xbe)](_0x238b8d=>({..._0x238b8d,'path':_0x38e203+'/'+_0x238b8d[_0x9bd63f(0xc9)]}))});}),router[a8_0x3d6c3a(0x9e)]('/folder',verifyToken,async(_0x122c68,_0x5f3ca5)=>{const _0x2ce0a6=a8_0x3d6c3a,{path:_0x461532,folder_name:_0xe68297}=_0x122c68[_0x2ce0a6(0xbf)];console['log']({'path':_0x461532,'folder_name':_0xe68297});if(!_0x461532)return _0x5f3ca5['status'](0x190)['json']({'error':_0x2ce0a6(0xc0)});if(!_0xe68297)return _0x5f3ca5['status'](0x190)[_0x2ce0a6(0xcf)]({'error':'Folder\x20name\x20is\x20required'});const _0x39affe=_0x461532+'/'+_0xe68297;!fs[_0x2ce0a6(0xc1)](_0x39affe)&&fs['mkdirSync'](_0x39affe),_0x5f3ca5['send']({'path':_0x39affe});}),router[a8_0x3d6c3a(0xc7)](a8_0x3d6c3a(0x9b),verifyToken,async(_0xa21b3a,_0x2c3c5b)=>{const _0x351b49=a8_0x3d6c3a,{isFolder:_0x5d8b54,path:_0x3031a4}=_0xa21b3a['body'];!_0x5d8b54?fs[_0x351b49(0xc5)](_0x3031a4):fs[_0x351b49(0xb1)](_0x3031a4,{'recursive':!![]}),_0x2c3c5b[_0x351b49(0x9c)]({'success':!![]});}),module[a8_0x3d6c3a(0xcb)]=router;