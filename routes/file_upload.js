const a8_0x36d360=a8_0xc49a;(function(_0x4fde79,_0x22912e){const _0x41bc4f=a8_0xc49a,_0xd70dcf=_0x4fde79();while(!![]){try{const _0x5144c9=parseInt(_0x41bc4f(0xbe))/0x1*(parseInt(_0x41bc4f(0xba))/0x2)+parseInt(_0x41bc4f(0xc3))/0x3*(-parseInt(_0x41bc4f(0xd3))/0x4)+parseInt(_0x41bc4f(0xd0))/0x5*(-parseInt(_0x41bc4f(0xbd))/0x6)+parseInt(_0x41bc4f(0xb0))/0x7*(-parseInt(_0x41bc4f(0xc0))/0x8)+-parseInt(_0x41bc4f(0xcb))/0x9*(-parseInt(_0x41bc4f(0xe0))/0xa)+parseInt(_0x41bc4f(0xac))/0xb+parseInt(_0x41bc4f(0xb4))/0xc;if(_0x5144c9===_0x22912e)break;else _0xd70dcf['push'](_0xd70dcf['shift']());}catch(_0x1269b2){_0xd70dcf['push'](_0xd70dcf['shift']());}}}(a8_0x4dba,0x29217));const multer=require(a8_0x36d360(0xda)),fs=require('fs'),{randomUUID}=require(a8_0x36d360(0xc4)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x36d360(0xdb)),conn=require('../libs/mysql.js'),verifyToken=require('../libs/jwt')[a8_0x36d360(0xd4)],dir=a8_0x36d360(0xb9);function a8_0xc49a(_0x133208,_0x2262eb){const _0x4dba27=a8_0x4dba();return a8_0xc49a=function(_0xc49a5f,_0x434d58){_0xc49a5f=_0xc49a5f-0xab;let _0x13f8a5=_0x4dba27[_0xc49a5f];return _0x13f8a5;},a8_0xc49a(_0x133208,_0x2262eb);}!fs[a8_0x36d360(0xd1)](dir)&&fs[a8_0x36d360(0xe5)](dir);const express=require('express'),router=express[a8_0x36d360(0xce)](),config=require(a8_0x36d360(0xdb)),storage=multer[a8_0x36d360(0xd7)]({'destination':function(_0xcf885a,_0x50f99d,_0xe2b7a6){const _0x55c46e=a8_0x36d360;_0xe2b7a6(null,_0x55c46e(0xe3));}}),upload=multer({'storage':storage});router['post'](a8_0x36d360(0xb6),upload['array'](a8_0x36d360(0xdd)),verifyToken,async(_0x5c0f61,_0x286cc0,_0x5917d0)=>{const _0x311792=a8_0x36d360,_0x32209f=_0x5c0f61['files'],{global:_0x1af965,path:_0x43c6e5}=_0x5c0f61[_0x311792(0xbc)],_0x43dcb7=config[_0x311792(0xd2)];console[_0x311792(0xd5)]({'global':_0x1af965}),console[_0x311792(0xd5)](_0x32209f),console['log']({'user':_0x5c0f61[_0x311792(0xc9)]});if(_0x1af965){_0x32209f['forEach'](_0x5aeb7c=>{const _0x22df8f=_0x311792;fs[_0x22df8f(0xb1)](_0x5aeb7c[_0x22df8f(0xca)],(_0x43c6e5||_0x43dcb7)+'/'+_0x5aeb7c['originalname']);}),_0x286cc0[_0x311792(0xcf)]({'files':_0x32209f[_0x311792(0xc2)](_0x5500ef=>({..._0x5500ef,'path':(_0x43c6e5||_0x43dcb7)+'/'+_0x5500ef[_0x311792(0xe4)]}))});return;}let _0x2a325c;try{const [_0x16e187]=await conn[_0x311792(0xdf)]()[_0x311792(0xcd)](_0x311792(0xb8),[_0x5c0f61[_0x311792(0xc9)][_0x311792(0xde)]]);_0x16e187[_0x311792(0xbf)]>0x0&&(_0x2a325c=_0x16e187[0x0]);}catch(_0x43c3b6){console[_0x311792(0xd5)]({'err':_0x43c3b6}),_0x286cc0['status'](0x1f4)[_0x311792(0xcc)]({'error':_0x311792(0xae)});return;}if(!_0x2a325c){_0x286cc0['status'](0x191)[_0x311792(0xcc)]({'error':_0x311792(0xd6)});return;}let _0x4e6e47=_0x2a325c[_0x311792(0xb3)];if(!_0x4e6e47){_0x4e6e47=randomUUID();try{await conn[_0x311792(0xdf)]()[_0x311792(0xcd)](_0x311792(0xc8),[_0x4e6e47,_0x5c0f61['user'][_0x311792(0xde)]]);}catch(_0x3fd24e){console[_0x311792(0xd5)]({'err':_0x3fd24e}),_0x286cc0['status'](0x1f4)[_0x311792(0xcc)]({'error':_0x311792(0xae)});return;}}const _0x4a913f='./uploads/'+_0x4e6e47;!fs[_0x311792(0xd1)](_0x4a913f)&&fs[_0x311792(0xe5)](_0x4a913f);if(!_0x32209f){const _0x3d2a62=new Error(_0x311792(0xc7));return _0x3d2a62[_0x311792(0xc6)]=0x190,_0x5917d0(_0x3d2a62);}const _0x195dbc=fs[_0x311792(0xe2)](_0x4a913f)['length']+_0x32209f[_0x311792(0xbf)];console[_0x311792(0xd5)]({'numberOfSize':_0x195dbc});if(_0x195dbc>userFolderMaximumFiles)return _0x286cc0[_0x311792(0xab)](0x190)['json']({'error':_0x311792(0xb5)+userFolderMaximumFiles+'\x20files'});const _0x43237b=fs[_0x311792(0xe2)](_0x4a913f)['reduce']((_0x253825,_0x6ceb58)=>_0x253825+fs[_0x311792(0xbb)](_0x4a913f+'/'+_0x6ceb58)[_0x311792(0xd8)],0x0),_0x493b13=_0x32209f['reduce']((_0x1442b9,_0xcee127)=>_0x1442b9+_0xcee127['size'],0x0);console[_0x311792(0xd5)]({'totalSize':_0x43237b,'uploadedSize':_0x493b13});if(_0x493b13+_0x43237b>userFolderMaximumSizeInMB*0x400*0x400)return _0x286cc0['status'](0x190)['json']({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+_0x311792(0xb7)});_0x32209f['forEach'](_0x53f225=>{const _0x2cf4f=_0x311792;fs[_0x2cf4f(0xb1)](_0x53f225[_0x2cf4f(0xca)],_0x4a913f+'/'+_0x53f225[_0x2cf4f(0xe4)]);}),_0x286cc0[_0x311792(0xcf)]({'files':_0x32209f[_0x311792(0xc2)](_0x560f1f=>({..._0x560f1f,'path':_0x4a913f+'/'+_0x560f1f[_0x311792(0xe4)]}))});}),router['post'](a8_0x36d360(0xe1),verifyToken,async(_0x5d296f,_0x2064e9)=>{const _0x39d92d=a8_0x36d360,{path:_0x48eece,folder_name:_0x1e39bd}=_0x5d296f[_0x39d92d(0xbc)],_0x38988b=config[_0x39d92d(0xd2)];console['log']({'path':_0x48eece,'folder_name':_0x1e39bd});if(!_0x48eece)return _0x2064e9[_0x39d92d(0xab)](0x190)[_0x39d92d(0xcc)]({'error':_0x39d92d(0xd9)});if(!_0x1e39bd)return _0x2064e9[_0x39d92d(0xab)](0x190)['json']({'error':_0x39d92d(0xb2)});const _0x4b5362=_0x48eece+'/'+_0x1e39bd;!fs['existsSync'](_0x4b5362)&&fs[_0x39d92d(0xe5)](_0x4b5362),_0x2064e9[_0x39d92d(0xcf)]({'path':_0x4b5362});}),router[a8_0x36d360(0xad)](a8_0x36d360(0xaf),verifyToken,async(_0x1137a,_0x176b96)=>{const _0x197cdd=a8_0x36d360,{isFolder:_0x377ee7,path:_0x317274}=_0x1137a['body'];!_0x377ee7?fs[_0x197cdd(0xc5)](_0x317274):fs[_0x197cdd(0xdc)](_0x317274,{'recursive':!![]}),_0x176b96[_0x197cdd(0xcf)]({'success':!![]});}),module[a8_0x36d360(0xc1)]=router;function a8_0x4dba(){const _0x53389a=['send','19995dIvnxP','existsSync','folderLocation','30412VDFwtX','verifyToken','log','Invalid\x20user','diskStorage','size','Path\x20is\x20required','multer','../CADViewer_config.json','rmdirSync','files','email','promise','20rElYUO','/folder','readdirSync','uploads','originalname','mkdirSync','status','781308JCiczI','delete','Error!\x20Something\x20went\x20wrong.','/remove','119PEwSqQ','renameSync','Folder\x20name\x20is\x20required','folder_name','989100PIxZYp','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','/files','\x20MB\x20of\x20files','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','./uploads','8TCxTWk','statSync','body','198tEoJIt','38629MvrZzO','length','13312mNUmlD','exports','map','93xVEpqC','crypto','unlinkSync','httpStatusCode','Please\x20upload\x20a\x20file','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','user','path','1154025KCqTqt','json','execute','Router'];a8_0x4dba=function(){return _0x53389a;};return a8_0x4dba();}