const a8_0x30c190=a8_0x3c7d;(function(_0x2496d1,_0x4bab12){const _0xb006f=a8_0x3c7d,_0x183c30=_0x2496d1();while(!![]){try{const _0xa41fdb=parseInt(_0xb006f(0xc1))/0x1+-parseInt(_0xb006f(0xbc))/0x2+parseInt(_0xb006f(0x9e))/0x3*(-parseInt(_0xb006f(0xbd))/0x4)+parseInt(_0xb006f(0xa1))/0x5+parseInt(_0xb006f(0x9c))/0x6*(parseInt(_0xb006f(0xd0))/0x7)+parseInt(_0xb006f(0xba))/0x8*(-parseInt(_0xb006f(0xaf))/0x9)+-parseInt(_0xb006f(0x9d))/0xa*(parseInt(_0xb006f(0xb0))/0xb);if(_0xa41fdb===_0x4bab12)break;else _0x183c30['push'](_0x183c30['shift']());}catch(_0x26c186){_0x183c30['push'](_0x183c30['shift']());}}}(a8_0x573c,0x3d2ab));function a8_0x573c(){const _0x28f9c6=['promise','1408900kWErWJ','existsSync','body','./uploads','originalname','/folder','uploads','json','Error!\x20Something\x20went\x20wrong.','folderLocation','readdirSync','email','status','/remove','2952513HKUOYS','559735YonqDr','diskStorage','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','/files','reduce','send','execute','mkdirSync','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','../libs/jwt','8IaPFia','delete','561302kLOxGt','4uRRtNm','express','post','array','290457niisno','log','user','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','exports','Invalid\x20user','length','size','rmdirSync','forEach','./uploads/','unlinkSync','Please\x20upload\x20a\x20file','copyFileSync','Folder\x20name\x20is\x20required','75117erMquE','\x20files','../CADViewer_config.json','map','multer','\x20MB\x20of\x20files','234AggXhI','10Vwoetn','241842MlvsKR','httpStatusCode'];a8_0x573c=function(){return _0x28f9c6;};return a8_0x573c();}const multer=require(a8_0x30c190(0x9a)),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x30c190(0x98)),conn=require('../libs/mysql.js'),verifyToken=require(a8_0x30c190(0xb9))['verifyToken'],dir=a8_0x30c190(0xa4);!fs[a8_0x30c190(0xa2)](dir)&&fs[a8_0x30c190(0xb7)](dir);const express=require(a8_0x30c190(0xbe)),router=express['Router'](),config=require(a8_0x30c190(0x98)),storage=multer[a8_0x30c190(0xb1)]({'destination':function(_0x33ab91,_0x4856b6,_0x4c9584){const _0x311e68=a8_0x30c190;_0x4c9584(null,_0x311e68(0xa7));}}),upload=multer({'storage':storage});function a8_0x3c7d(_0x19a138,_0x2fbb06){const _0x573c3d=a8_0x573c();return a8_0x3c7d=function(_0x3c7d90,_0xeef2f){_0x3c7d90=_0x3c7d90-0x98;let _0x338d5b=_0x573c3d[_0x3c7d90];return _0x338d5b;},a8_0x3c7d(_0x19a138,_0x2fbb06);}router[a8_0x30c190(0xbf)](a8_0x30c190(0xb3),upload[a8_0x30c190(0xc0)]('files'),verifyToken,async(_0x1cfb01,_0x54f6fa,_0x286bb3)=>{const _0x2c8955=a8_0x30c190,_0x2d5727=_0x1cfb01['files'],{global:_0x19941a,path:_0x57ee95}=_0x1cfb01[_0x2c8955(0xa3)],_0x3e76f3=config[_0x2c8955(0xaa)];console[_0x2c8955(0xc2)]({'global':_0x19941a}),console[_0x2c8955(0xc2)](_0x2d5727),console[_0x2c8955(0xc2)]({'user':_0x1cfb01[_0x2c8955(0xc3)]});if(_0x19941a){_0x2d5727['forEach'](_0x157d06=>{const _0x5261fd=_0x2c8955;fs['copyFileSync'](_0x157d06['path'],(_0x57ee95||_0x3e76f3)+'/'+_0x157d06[_0x5261fd(0xa5)]),fs['unlinkSync'](_0x157d06['path']);}),_0x54f6fa[_0x2c8955(0xb5)]({'files':_0x2d5727['map'](_0x4e52b1=>({..._0x4e52b1,'path':(_0x57ee95||_0x3e76f3)+'/'+_0x4e52b1[_0x2c8955(0xa5)]}))});return;}let _0x5cd704;try{const [_0x515fc2]=await conn['promise']()[_0x2c8955(0xb6)](_0x2c8955(0xb2),[_0x1cfb01[_0x2c8955(0xc3)][_0x2c8955(0xac)]]);_0x515fc2[_0x2c8955(0xc7)]>0x0&&(_0x5cd704=_0x515fc2[0x0]);}catch(_0x20a7ff){console[_0x2c8955(0xc2)]({'err':_0x20a7ff}),_0x54f6fa[_0x2c8955(0xad)](0x1f4)['json']({'error':_0x2c8955(0xa9)});return;}if(!_0x5cd704){_0x54f6fa[_0x2c8955(0xad)](0x191)[_0x2c8955(0xa8)]({'error':_0x2c8955(0xc6)});return;}let _0x4a58a2=_0x5cd704['folder_name'];if(!_0x4a58a2){_0x4a58a2=randomUUID();try{await conn[_0x2c8955(0xa0)]()['execute'](_0x2c8955(0xb8),[_0x4a58a2,_0x1cfb01[_0x2c8955(0xc3)][_0x2c8955(0xac)]]);}catch(_0xb9bcec){console[_0x2c8955(0xc2)]({'err':_0xb9bcec}),_0x54f6fa[_0x2c8955(0xad)](0x1f4)[_0x2c8955(0xa8)]({'error':_0x2c8955(0xa9)});return;}}const _0x4b947a=_0x2c8955(0xcb)+_0x4a58a2;!fs[_0x2c8955(0xa2)](_0x4b947a)&&fs[_0x2c8955(0xb7)](_0x4b947a);if(!_0x2d5727){const _0x445b7a=new Error(_0x2c8955(0xcd));return _0x445b7a[_0x2c8955(0x9f)]=0x190,_0x286bb3(_0x445b7a);}const _0x1a874f=fs[_0x2c8955(0xab)](_0x4b947a)[_0x2c8955(0xc7)]+_0x2d5727['length'];console[_0x2c8955(0xc2)]({'numberOfSize':_0x1a874f});if(_0x1a874f>userFolderMaximumFiles)return _0x54f6fa[_0x2c8955(0xad)](0x190)[_0x2c8955(0xa8)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+_0x2c8955(0xd1)});const _0x2c78a8=fs[_0x2c8955(0xab)](_0x4b947a)[_0x2c8955(0xb4)]((_0x13cd28,_0x374383)=>_0x13cd28+fs['statSync'](_0x4b947a+'/'+_0x374383)[_0x2c8955(0xc8)],0x0),_0x21532d=_0x2d5727[_0x2c8955(0xb4)]((_0x584668,_0x142625)=>_0x584668+_0x142625[_0x2c8955(0xc8)],0x0);console[_0x2c8955(0xc2)]({'totalSize':_0x2c78a8,'uploadedSize':_0x21532d});if(_0x21532d+_0x2c78a8>userFolderMaximumSizeInMB*0x400*0x400)return _0x54f6fa[_0x2c8955(0xad)](0x190)[_0x2c8955(0xa8)]({'error':_0x2c8955(0xc4)+userFolderMaximumSizeInMB+_0x2c8955(0x9b)});_0x2d5727[_0x2c8955(0xca)](_0x3fbbba=>{const _0x52fa24=_0x2c8955;fs[_0x52fa24(0xce)](_0x3fbbba['path'],_0x4b947a+'/'+_0x3fbbba['originalname']),fs[_0x52fa24(0xcc)](_0x3fbbba['path']);}),_0x54f6fa['send']({'files':_0x2d5727[_0x2c8955(0x99)](_0x493680=>({..._0x493680,'path':_0x4b947a+'/'+_0x493680[_0x2c8955(0xa5)]}))});}),router[a8_0x30c190(0xbf)](a8_0x30c190(0xa6),verifyToken,async(_0x11ef35,_0x4a3b96)=>{const _0x3ff427=a8_0x30c190,{path:_0x47e2c8,folder_name:_0x32bea9}=_0x11ef35[_0x3ff427(0xa3)];console[_0x3ff427(0xc2)]({'path':_0x47e2c8,'folder_name':_0x32bea9});if(!_0x47e2c8)return _0x4a3b96[_0x3ff427(0xad)](0x190)[_0x3ff427(0xa8)]({'error':'Path\x20is\x20required'});if(!_0x32bea9)return _0x4a3b96[_0x3ff427(0xad)](0x190)[_0x3ff427(0xa8)]({'error':_0x3ff427(0xcf)});const _0x14325b=_0x47e2c8+'/'+_0x32bea9;!fs[_0x3ff427(0xa2)](_0x14325b)&&fs[_0x3ff427(0xb7)](_0x14325b),_0x4a3b96[_0x3ff427(0xb5)]({'path':_0x14325b});}),router[a8_0x30c190(0xbb)](a8_0x30c190(0xae),verifyToken,async(_0x4f4da0,_0x541e8b)=>{const _0x1a8b73=a8_0x30c190,{isFolder:_0x3784b7,path:_0x4f0d56}=_0x4f4da0[_0x1a8b73(0xa3)];!_0x3784b7?fs[_0x1a8b73(0xcc)](_0x4f0d56):fs[_0x1a8b73(0xc9)](_0x4f0d56,{'recursive':!![]}),_0x541e8b['send']({'success':!![]});}),module[a8_0x30c190(0xc5)]=router;