const a8_0x1e8192=a8_0x20a9;function a8_0x20a9(_0x448578,_0x48b7df){const _0xd75888=a8_0xd758();return a8_0x20a9=function(_0x20a96c,_0x2cdccd){_0x20a96c=_0x20a96c-0x16b;let _0x2e0da6=_0xd75888[_0x20a96c];return _0x2e0da6;},a8_0x20a9(_0x448578,_0x48b7df);}function a8_0xd758(){const _0x321e96=['array','\x20files','195byceLG','post','40708uDfTZZ','renameSync','\x20MB\x20of\x20files','folder_name','statSync','112511uHjCpR','forEach','314LvCGSI','path','/folder','files','Please\x20upload\x20a\x20file','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','length','./uploads/','mkdirSync','299328HuZELs','149280TTFGBu','198jnEybl','Invalid\x20user','296RbPlFR','15RnaIao','./uploads','uploads','promise','status','Router','36wMxlIF','4238DSVtks','verifyToken','email','unlinkSync','execute','multer','send','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','map','exports','body','size','readdirSync','/remove','1559529JvtzcC','originalname','crypto','json','user','folderLocation','log','httpStatusCode','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','270845rhPigf','existsSync','../CADViewer_config.json','reduce'];a8_0xd758=function(){return _0x321e96;};return a8_0xd758();}(function(_0x33560f,_0x1c8685){const _0xf7a62c=a8_0x20a9,_0x5d6b59=_0x33560f();while(!![]){try{const _0x1411cf=parseInt(_0xf7a62c(0x195))/0x1*(-parseInt(_0xf7a62c(0x180))/0x2)+-parseInt(_0xf7a62c(0x18e))/0x3*(-parseInt(_0xf7a62c(0x179))/0x4)+-parseInt(_0xf7a62c(0x171))/0x5*(-parseInt(_0xf7a62c(0x194))/0x6)+parseInt(_0xf7a62c(0x17e))/0x7*(parseInt(_0xf7a62c(0x18d))/0x8)+parseInt(_0xf7a62c(0x1a3))/0x9+-parseInt(_0xf7a62c(0x18a))/0xa*(-parseInt(_0xf7a62c(0x18b))/0xb)+parseInt(_0xf7a62c(0x189))/0xc*(-parseInt(_0xf7a62c(0x177))/0xd);if(_0x1411cf===_0x1c8685)break;else _0x5d6b59['push'](_0x5d6b59['shift']());}catch(_0x30c4d4){_0x5d6b59['push'](_0x5d6b59['shift']());}}}(a8_0xd758,0x5b143));const multer=require(a8_0x1e8192(0x19a)),fs=require('fs'),{randomUUID}=require(a8_0x1e8192(0x1a5)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require('../libs/mysql.js'),verifyToken=require('../libs/jwt')[a8_0x1e8192(0x196)],dir=a8_0x1e8192(0x18f);!fs[a8_0x1e8192(0x172)](dir)&&fs[a8_0x1e8192(0x188)](dir);const express=require('express'),router=express[a8_0x1e8192(0x193)](),config=require(a8_0x1e8192(0x173)),storage=multer['diskStorage']({'destination':function(_0x4f7371,_0x402c65,_0x302137){const _0x4f4638=a8_0x1e8192;_0x302137(null,_0x4f4638(0x190));}}),upload=multer({'storage':storage});router[a8_0x1e8192(0x178)]('/files',upload[a8_0x1e8192(0x175)](a8_0x1e8192(0x183)),verifyToken,async(_0x349e4d,_0x49f888,_0x5a79c8)=>{const _0x4681ab=a8_0x1e8192,_0x249967=_0x349e4d[_0x4681ab(0x183)],{global:_0x3380c4,path:_0x439352}=_0x349e4d[_0x4681ab(0x19f)],_0x77368=config[_0x4681ab(0x16d)];console[_0x4681ab(0x16e)]({'global':_0x3380c4}),console['log'](_0x249967),console['log']({'user':_0x349e4d['user']});if(_0x3380c4){_0x249967[_0x4681ab(0x17f)](_0x25de03=>{const _0x2128fe=_0x4681ab;fs[_0x2128fe(0x17a)](_0x25de03[_0x2128fe(0x181)],(_0x439352||_0x77368)+'/'+_0x25de03[_0x2128fe(0x1a4)]);}),_0x49f888['send']({'files':_0x249967[_0x4681ab(0x19d)](_0x1f003e=>({..._0x1f003e,'path':(_0x439352||_0x77368)+'/'+_0x1f003e[_0x4681ab(0x1a4)]}))});return;}let _0x45d4a7;try{const [_0x17defc]=await conn[_0x4681ab(0x191)]()[_0x4681ab(0x199)](_0x4681ab(0x170),[_0x349e4d[_0x4681ab(0x16c)][_0x4681ab(0x197)]]);_0x17defc[_0x4681ab(0x186)]>0x0&&(_0x45d4a7=_0x17defc[0x0]);}catch(_0x792f8a){console['log']({'err':_0x792f8a}),_0x49f888[_0x4681ab(0x192)](0x1f4)[_0x4681ab(0x16b)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x45d4a7){_0x49f888[_0x4681ab(0x192)](0x191)[_0x4681ab(0x16b)]({'error':_0x4681ab(0x18c)});return;}let _0x9f3ebc=_0x45d4a7[_0x4681ab(0x17c)];if(!_0x9f3ebc){_0x9f3ebc=randomUUID();try{await conn[_0x4681ab(0x191)]()['execute'](_0x4681ab(0x19c),[_0x9f3ebc,_0x349e4d[_0x4681ab(0x16c)]['email']]);}catch(_0x166497){console[_0x4681ab(0x16e)]({'err':_0x166497}),_0x49f888[_0x4681ab(0x192)](0x1f4)[_0x4681ab(0x16b)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x44d6dc=_0x4681ab(0x187)+_0x9f3ebc;!fs['existsSync'](_0x44d6dc)&&fs['mkdirSync'](_0x44d6dc);if(!_0x249967){const _0x56eb3d=new Error(_0x4681ab(0x184));return _0x56eb3d[_0x4681ab(0x16f)]=0x190,_0x5a79c8(_0x56eb3d);}const _0x111486=fs[_0x4681ab(0x1a1)](_0x44d6dc)[_0x4681ab(0x186)]+_0x249967['length'];console[_0x4681ab(0x16e)]({'numberOfSize':_0x111486});if(_0x111486>userFolderMaximumFiles)return _0x49f888[_0x4681ab(0x192)](0x190)[_0x4681ab(0x16b)]({'error':_0x4681ab(0x185)+userFolderMaximumFiles+_0x4681ab(0x176)});const _0x239375=fs[_0x4681ab(0x1a1)](_0x44d6dc)[_0x4681ab(0x174)]((_0x4b7af7,_0x21f5fd)=>_0x4b7af7+fs[_0x4681ab(0x17d)](_0x44d6dc+'/'+_0x21f5fd)[_0x4681ab(0x1a0)],0x0),_0x54f359=_0x249967[_0x4681ab(0x174)]((_0x355b27,_0x2c65f2)=>_0x355b27+_0x2c65f2[_0x4681ab(0x1a0)],0x0);console['log']({'totalSize':_0x239375,'uploadedSize':_0x54f359});if(_0x54f359+_0x239375>userFolderMaximumSizeInMB*0x400*0x400)return _0x49f888['status'](0x190)['json']({'error':_0x4681ab(0x185)+userFolderMaximumSizeInMB+_0x4681ab(0x17b)});_0x249967[_0x4681ab(0x17f)](_0x285a73=>{const _0x53a18c=_0x4681ab;fs['renameSync'](_0x285a73[_0x53a18c(0x181)],_0x44d6dc+'/'+_0x285a73['originalname']);}),_0x49f888[_0x4681ab(0x19b)]({'files':_0x249967[_0x4681ab(0x19d)](_0x249fcf=>({..._0x249fcf,'path':_0x44d6dc+'/'+_0x249fcf['originalname']}))});}),router[a8_0x1e8192(0x178)](a8_0x1e8192(0x182),verifyToken,async(_0x27b457,_0x210207)=>{const _0x44a8ca=a8_0x1e8192,{path:_0xde25a8,folder_name:_0x3caccd}=_0x27b457[_0x44a8ca(0x19f)],_0x554de7=config[_0x44a8ca(0x16d)];console['log']({'path':_0xde25a8,'folder_name':_0x3caccd});if(!_0xde25a8)return _0x210207['status'](0x190)[_0x44a8ca(0x16b)]({'error':'Path\x20is\x20required'});if(!_0x3caccd)return _0x210207[_0x44a8ca(0x192)](0x190)['json']({'error':'Folder\x20name\x20is\x20required'});const _0x91d890=_0xde25a8+'/'+_0x3caccd;!fs[_0x44a8ca(0x172)](_0x91d890)&&fs['mkdirSync'](_0x91d890),_0x210207[_0x44a8ca(0x19b)]({'path':_0x91d890});}),router['delete'](a8_0x1e8192(0x1a2),verifyToken,async(_0x8e489d,_0x43ca51)=>{const _0x539ec3=a8_0x1e8192,{isFolder:_0x3fe87c,path:_0x5e98ee}=_0x8e489d[_0x539ec3(0x19f)];!_0x3fe87c?fs[_0x539ec3(0x198)](_0x5e98ee):fs['rmdirSync'](_0x5e98ee,{'recursive':!![]}),_0x43ca51['send']({'success':!![]});}),module[a8_0x1e8192(0x19e)]=router;