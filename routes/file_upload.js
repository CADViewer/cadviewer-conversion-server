function a9_0x22c2(_0x365ee2,_0x512057){const _0x42923a=a9_0x4292();return a9_0x22c2=function(_0x22c215,_0x53ce29){_0x22c215=_0x22c215-0x76;let _0x547b90=_0x42923a[_0x22c215];return _0x547b90;},a9_0x22c2(_0x365ee2,_0x512057);}const a9_0x36fe19=a9_0x22c2;function a9_0x4292(){const _0x27b0cc=['map','length','copyFileSync','8OptePI','verifyToken','12USRcyT','post','array','Error!\x20Something\x20went\x20wrong.','./uploads','mkdirSync','email','5842260CcYScG','path','14307363PMtcFm','rmdirSync','existsSync','2365950SkvubN','8931944sbbqaL','promise','Invalid\x20user','size','crypto','log','send','unlinkSync','originalname','Router','status','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','../libs/jwt','/files','forEach','/remove','body','readdirSync','45897770KnunWP','\x20files','../libs/mysql.js','execute','2iFpukm','../CADViewer_config.json','httpStatusCode','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','reduce','statSync','exports','files','user','delete','json','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','1379943ktSdAS','1504826nmIGtK','diskStorage'];a9_0x4292=function(){return _0x27b0cc;};return a9_0x4292();}(function(_0x147c06,_0x1a95b1){const _0x594441=a9_0x22c2,_0x454038=_0x147c06();while(!![]){try{const _0x314f29=parseInt(_0x594441(0xa2))/0x1*(-parseInt(_0x594441(0x95))/0x2)+-parseInt(_0x594441(0xa1))/0x3*(parseInt(_0x594441(0xa9))/0x4)+parseInt(_0x594441(0x7e))/0x5+-parseInt(_0x594441(0x79))/0x6+-parseInt(_0x594441(0x7f))/0x7*(-parseInt(_0x594441(0xa7))/0x8)+-parseInt(_0x594441(0x7b))/0x9+parseInt(_0x594441(0x91))/0xa;if(_0x314f29===_0x1a95b1)break;else _0x454038['push'](_0x454038['shift']());}catch(_0x130e96){_0x454038['push'](_0x454038['shift']());}}}(a9_0x4292,0xd9795));const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a9_0x36fe19(0x83)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a9_0x36fe19(0x96)),conn=require(a9_0x36fe19(0x93)),verifyToken=require(a9_0x36fe19(0x8b))[a9_0x36fe19(0xa8)],dir=a9_0x36fe19(0x76);!fs['existsSync'](dir)&&fs[a9_0x36fe19(0x77)](dir);const express=require('express'),router=express[a9_0x36fe19(0x88)](),config=require('../CADViewer_config.json'),storage=multer[a9_0x36fe19(0xa3)]({'destination':function(_0xe2772f,_0x3a5276,_0x3820c7){_0x3820c7(null,'uploads');}}),upload=multer({'storage':storage});router[a9_0x36fe19(0xaa)](a9_0x36fe19(0x8c),upload[a9_0x36fe19(0xab)](a9_0x36fe19(0x9c)),verifyToken,async(_0x29d428,_0x4a4cc4,_0x2bff3a)=>{const _0x4ce23a=a9_0x36fe19,_0x408d64=_0x29d428[_0x4ce23a(0x9c)],{global:_0x45efda,path:_0x33f10b}=_0x29d428[_0x4ce23a(0x8f)],_0x3893dc=config['folderLocation'];console[_0x4ce23a(0x84)]({'global':_0x45efda}),console[_0x4ce23a(0x84)](_0x408d64),console['log']({'user':_0x29d428['user']});if(_0x45efda){_0x408d64[_0x4ce23a(0x8d)](_0x339d06=>{const _0x5b7b35=_0x4ce23a;fs[_0x5b7b35(0xa6)](_0x339d06[_0x5b7b35(0x7a)],(_0x33f10b||_0x3893dc)+'/'+_0x339d06[_0x5b7b35(0x87)]),fs[_0x5b7b35(0x86)](_0x339d06[_0x5b7b35(0x7a)]);}),_0x4a4cc4[_0x4ce23a(0x85)]({'files':_0x408d64[_0x4ce23a(0xa4)](_0x3d40ae=>({..._0x3d40ae,'path':(_0x33f10b||_0x3893dc)+'/'+_0x3d40ae['originalname']}))});return;}let _0x597eea;try{const [_0x183316]=await conn[_0x4ce23a(0x80)]()[_0x4ce23a(0x94)](_0x4ce23a(0x8a),[_0x29d428[_0x4ce23a(0x9d)][_0x4ce23a(0x78)]]);_0x183316[_0x4ce23a(0xa5)]>0x0&&(_0x597eea=_0x183316[0x0]);}catch(_0xc5fcd2){console['log']({'err':_0xc5fcd2}),_0x4a4cc4[_0x4ce23a(0x89)](0x1f4)[_0x4ce23a(0x9f)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x597eea){_0x4a4cc4[_0x4ce23a(0x89)](0x191)['json']({'error':_0x4ce23a(0x81)});return;}let _0xa08b11=_0x597eea['folder_name'];if(!_0xa08b11){_0xa08b11=randomUUID();try{await conn[_0x4ce23a(0x80)]()['execute'](_0x4ce23a(0x98),[_0xa08b11,_0x29d428['user'][_0x4ce23a(0x78)]]);}catch(_0x1bab02){console[_0x4ce23a(0x84)]({'err':_0x1bab02}),_0x4a4cc4['status'](0x1f4)[_0x4ce23a(0x9f)]({'error':_0x4ce23a(0xac)});return;}}const _0x250cfa='./uploads/'+_0xa08b11;!fs[_0x4ce23a(0x7d)](_0x250cfa)&&fs[_0x4ce23a(0x77)](_0x250cfa);if(!_0x408d64){const _0x33716c=new Error('Please\x20upload\x20a\x20file');return _0x33716c[_0x4ce23a(0x97)]=0x190,_0x2bff3a(_0x33716c);}const _0x2e1aa8=fs['readdirSync'](_0x250cfa)['length']+_0x408d64[_0x4ce23a(0xa5)];console[_0x4ce23a(0x84)]({'numberOfSize':_0x2e1aa8});if(_0x2e1aa8>userFolderMaximumFiles)return _0x4a4cc4['status'](0x190)['json']({'error':_0x4ce23a(0xa0)+userFolderMaximumFiles+_0x4ce23a(0x92)});const _0xddf505=fs[_0x4ce23a(0x90)](_0x250cfa)[_0x4ce23a(0x99)]((_0x3f837c,_0x52bff5)=>_0x3f837c+fs[_0x4ce23a(0x9a)](_0x250cfa+'/'+_0x52bff5)[_0x4ce23a(0x82)],0x0),_0x4a676f=_0x408d64[_0x4ce23a(0x99)]((_0x273ca7,_0x2544cc)=>_0x273ca7+_0x2544cc['size'],0x0);console[_0x4ce23a(0x84)]({'totalSize':_0xddf505,'uploadedSize':_0x4a676f});if(_0x4a676f+_0xddf505>userFolderMaximumSizeInMB*0x400*0x400)return _0x4a4cc4['status'](0x190)[_0x4ce23a(0x9f)]({'error':_0x4ce23a(0xa0)+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x408d64[_0x4ce23a(0x8d)](_0x43a1b3=>{const _0x28774f=_0x4ce23a;fs[_0x28774f(0xa6)](_0x43a1b3[_0x28774f(0x7a)],_0x250cfa+'/'+_0x43a1b3[_0x28774f(0x87)]),fs['unlinkSync'](_0x43a1b3[_0x28774f(0x7a)]);}),_0x4a4cc4[_0x4ce23a(0x85)]({'files':_0x408d64['map'](_0xb9aec7=>({..._0xb9aec7,'path':_0x250cfa+'/'+_0xb9aec7[_0x4ce23a(0x87)]}))});}),router['post']('/folder',verifyToken,async(_0x565b64,_0x33f0b6)=>{const _0x5b8cd6=a9_0x36fe19,{path:_0x173826,folder_name:_0x4aa8c9}=_0x565b64[_0x5b8cd6(0x8f)];console['log']({'path':_0x173826,'folder_name':_0x4aa8c9});if(!_0x173826)return _0x33f0b6['status'](0x190)['json']({'error':'Path\x20is\x20required'});if(!_0x4aa8c9)return _0x33f0b6['status'](0x190)[_0x5b8cd6(0x9f)]({'error':'Folder\x20name\x20is\x20required'});const _0x249aaa=_0x173826+'/'+_0x4aa8c9;!fs['existsSync'](_0x249aaa)&&fs[_0x5b8cd6(0x77)](_0x249aaa),_0x33f0b6[_0x5b8cd6(0x85)]({'path':_0x249aaa});}),router[a9_0x36fe19(0x9e)](a9_0x36fe19(0x8e),verifyToken,async(_0x132339,_0x421d0c)=>{const _0x23326e=a9_0x36fe19,{isFolder:_0x202fa1,path:_0xe525fd}=_0x132339[_0x23326e(0x8f)];!_0x202fa1?fs[_0x23326e(0x86)](_0xe525fd):fs[_0x23326e(0x7c)](_0xe525fd,{'recursive':!![]}),_0x421d0c['send']({'success':!![]});}),module[a9_0x36fe19(0x9b)]=router;