const a8_0x4a447d=a8_0x33a6;(function(_0x35d02b,_0x4770cc){const _0x19fd66=a8_0x33a6,_0x5a6cd5=_0x35d02b();while(!![]){try{const _0x4bb847=parseInt(_0x19fd66(0x169))/0x1+-parseInt(_0x19fd66(0x166))/0x2+-parseInt(_0x19fd66(0x159))/0x3*(-parseInt(_0x19fd66(0x158))/0x4)+-parseInt(_0x19fd66(0x172))/0x5+-parseInt(_0x19fd66(0x15a))/0x6+-parseInt(_0x19fd66(0x175))/0x7+-parseInt(_0x19fd66(0x173))/0x8*(-parseInt(_0x19fd66(0x17d))/0x9);if(_0x4bb847===_0x4770cc)break;else _0x5a6cd5['push'](_0x5a6cd5['shift']());}catch(_0x5aaf59){_0x5a6cd5['push'](_0x5a6cd5['shift']());}}}(a8_0x1fde,0xf08d3));const multer=require(a8_0x4a447d(0x16c)),fs=require('fs'),{randomUUID}=require(a8_0x4a447d(0x165)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x4a447d(0x156)),conn=require(a8_0x4a447d(0x16d)),verifyToken=require(a8_0x4a447d(0x14f))['verifyToken'],dir='./uploads';function a8_0x1fde(){const _0x184ce4=['folderLocation','../libs/jwt','readdirSync','express','log','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','map','Error!\x20Something\x20went\x20wrong.','../CADViewer_config.json','statSync','4bYDKSe','4851921Dfpuoo','10533978XchTnM','status','array','length','Invalid\x20user','reduce','forEach','delete','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','email','body','crypto','2589812duELLm','uploads','unlinkSync','1375183eFNYGn','send','/files','multer','../libs/mysql.js','post','originalname','Folder\x20name\x20is\x20required','execute','2332990zAyKBE','152lXMIMS','httpStatusCode','8378013bIgxco','json','existsSync','files','exports','renameSync','\x20MB\x20of\x20files','mkdirSync','1282185ISJsJH','promise','user','Please\x20upload\x20a\x20file','size','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?'];a8_0x1fde=function(){return _0x184ce4;};return a8_0x1fde();}!fs[a8_0x4a447d(0x177)](dir)&&fs['mkdirSync'](dir);const express=require(a8_0x4a447d(0x151)),router=express['Router'](),config=require(a8_0x4a447d(0x156)),storage=multer['diskStorage']({'destination':function(_0x1d92d6,_0x338a19,_0x3cdc5b){const _0x2f1340=a8_0x4a447d;_0x3cdc5b(null,_0x2f1340(0x167));}}),upload=multer({'storage':storage});function a8_0x33a6(_0x5c6651,_0x37328e){const _0x1fdef2=a8_0x1fde();return a8_0x33a6=function(_0x33a6f5,_0x192a19){_0x33a6f5=_0x33a6f5-0x14e;let _0x2374df=_0x1fdef2[_0x33a6f5];return _0x2374df;},a8_0x33a6(_0x5c6651,_0x37328e);}router[a8_0x4a447d(0x16e)](a8_0x4a447d(0x16b),upload[a8_0x4a447d(0x15c)](a8_0x4a447d(0x178)),verifyToken,async(_0xbf9204,_0x52a26e,_0x3a71b5)=>{const _0xe7d380=a8_0x4a447d,_0x4cd954=_0xbf9204[_0xe7d380(0x178)],{global:_0x32eafa,path:_0xbd8321}=_0xbf9204[_0xe7d380(0x164)],_0x1c97d9=config[_0xe7d380(0x14e)];console[_0xe7d380(0x152)]({'global':_0x32eafa}),console[_0xe7d380(0x152)](_0x4cd954),console[_0xe7d380(0x152)]({'user':_0xbf9204[_0xe7d380(0x17f)]});if(_0x32eafa){_0x4cd954[_0xe7d380(0x160)](_0x1f5167=>{const _0x449c64=_0xe7d380;fs[_0x449c64(0x17a)](_0x1f5167['path'],(_0xbd8321||_0x1c97d9)+'/'+_0x1f5167[_0x449c64(0x16f)]);}),_0x52a26e['send']({'files':_0x4cd954[_0xe7d380(0x154)](_0x438974=>({..._0x438974,'path':(_0xbd8321||_0x1c97d9)+'/'+_0x438974[_0xe7d380(0x16f)]}))});return;}let _0x22df6a;try{const [_0x1930bd]=await conn[_0xe7d380(0x17e)]()[_0xe7d380(0x171)](_0xe7d380(0x182),[_0xbf9204['user'][_0xe7d380(0x163)]]);_0x1930bd[_0xe7d380(0x15d)]>0x0&&(_0x22df6a=_0x1930bd[0x0]);}catch(_0x2a4930){console[_0xe7d380(0x152)]({'err':_0x2a4930}),_0x52a26e[_0xe7d380(0x15b)](0x1f4)[_0xe7d380(0x176)]({'error':_0xe7d380(0x155)});return;}if(!_0x22df6a){_0x52a26e['status'](0x191)[_0xe7d380(0x176)]({'error':_0xe7d380(0x15e)});return;}let _0x420803=_0x22df6a['folder_name'];if(!_0x420803){_0x420803=randomUUID();try{await conn['promise']()['execute'](_0xe7d380(0x153),[_0x420803,_0xbf9204['user'][_0xe7d380(0x163)]]);}catch(_0x254682){console[_0xe7d380(0x152)]({'err':_0x254682}),_0x52a26e[_0xe7d380(0x15b)](0x1f4)[_0xe7d380(0x176)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x442d7c='./uploads/'+_0x420803;!fs[_0xe7d380(0x177)](_0x442d7c)&&fs[_0xe7d380(0x17c)](_0x442d7c);if(!_0x4cd954){const _0x505071=new Error(_0xe7d380(0x180));return _0x505071[_0xe7d380(0x174)]=0x190,_0x3a71b5(_0x505071);}const _0x31ea89=fs[_0xe7d380(0x150)](_0x442d7c)[_0xe7d380(0x15d)]+_0x4cd954['length'];console['log']({'numberOfSize':_0x31ea89});if(_0x31ea89>userFolderMaximumFiles)return _0x52a26e[_0xe7d380(0x15b)](0x190)[_0xe7d380(0x176)]({'error':_0xe7d380(0x162)+userFolderMaximumFiles+'\x20files'});const _0x11cb10=fs[_0xe7d380(0x150)](_0x442d7c)['reduce']((_0x23bacf,_0x2fe76b)=>_0x23bacf+fs[_0xe7d380(0x157)](_0x442d7c+'/'+_0x2fe76b)[_0xe7d380(0x181)],0x0),_0x2ef5fb=_0x4cd954[_0xe7d380(0x15f)]((_0x380690,_0x415f5d)=>_0x380690+_0x415f5d[_0xe7d380(0x181)],0x0);console[_0xe7d380(0x152)]({'totalSize':_0x11cb10,'uploadedSize':_0x2ef5fb});if(_0x2ef5fb+_0x11cb10>userFolderMaximumSizeInMB*0x400*0x400)return _0x52a26e['status'](0x190)[_0xe7d380(0x176)]({'error':_0xe7d380(0x162)+userFolderMaximumSizeInMB+_0xe7d380(0x17b)});_0x4cd954[_0xe7d380(0x160)](_0x126aaa=>{const _0x33b103=_0xe7d380;fs['renameSync'](_0x126aaa['path'],_0x442d7c+'/'+_0x126aaa[_0x33b103(0x16f)]);}),_0x52a26e[_0xe7d380(0x16a)]({'files':_0x4cd954[_0xe7d380(0x154)](_0xd17fe8=>({..._0xd17fe8,'path':_0x442d7c+'/'+_0xd17fe8[_0xe7d380(0x16f)]}))});}),router[a8_0x4a447d(0x16e)]('/folder',verifyToken,async(_0x6a3151,_0x330b6c)=>{const _0x25f7ac=a8_0x4a447d,{path:_0x37083a,folder_name:_0x139ab2}=_0x6a3151[_0x25f7ac(0x164)],_0x2355f0=config['folderLocation'];console[_0x25f7ac(0x152)]({'path':_0x37083a,'folder_name':_0x139ab2});if(!_0x37083a)return _0x330b6c['status'](0x190)[_0x25f7ac(0x176)]({'error':'Path\x20is\x20required'});if(!_0x139ab2)return _0x330b6c[_0x25f7ac(0x15b)](0x190)[_0x25f7ac(0x176)]({'error':_0x25f7ac(0x170)});const _0x17da71=_0x37083a+'/'+_0x139ab2;!fs[_0x25f7ac(0x177)](_0x17da71)&&fs['mkdirSync'](_0x17da71),_0x330b6c[_0x25f7ac(0x16a)]({'path':_0x17da71});}),router[a8_0x4a447d(0x161)]('/remove',verifyToken,async(_0x1d0a7c,_0x472bef)=>{const _0x543b0f=a8_0x4a447d,{isFolder:_0x27e4d7,path:_0xaecbcf}=_0x1d0a7c[_0x543b0f(0x164)];!_0x27e4d7?fs[_0x543b0f(0x168)](_0xaecbcf):fs['rmdirSync'](_0xaecbcf,{'recursive':!![]}),_0x472bef[_0x543b0f(0x16a)]({'success':!![]});}),module[a8_0x4a447d(0x179)]=router;