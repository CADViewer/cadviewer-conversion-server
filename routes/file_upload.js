const a8_0x3ac9fb=a8_0x500f;(function(_0x3a9a5c,_0x3e8bc9){const _0x21a68b=a8_0x500f,_0x440a1c=_0x3a9a5c();while(!![]){try{const _0x56df73=parseInt(_0x21a68b(0x12c))/0x1+parseInt(_0x21a68b(0x135))/0x2*(parseInt(_0x21a68b(0x128))/0x3)+-parseInt(_0x21a68b(0x139))/0x4+-parseInt(_0x21a68b(0x13d))/0x5+parseInt(_0x21a68b(0x130))/0x6*(-parseInt(_0x21a68b(0x148))/0x7)+parseInt(_0x21a68b(0x127))/0x8+parseInt(_0x21a68b(0x138))/0x9;if(_0x56df73===_0x3e8bc9)break;else _0x440a1c['push'](_0x440a1c['shift']());}catch(_0x3ed1c1){_0x440a1c['push'](_0x440a1c['shift']());}}}(a8_0x5e7e,0x89ccf));const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a8_0x3ac9fb(0x126)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x3ac9fb(0x153)),conn=require(a8_0x3ac9fb(0x145)),verifyToken=require('../libs/jwt')['verifyToken'],dir=a8_0x3ac9fb(0x14d);function a8_0x5e7e(){const _0x4b0165=['Router','existsSync','/remove','3512455wJzXNr','statSync','Please\x20upload\x20a\x20file','promise','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','Folder\x20name\x20is\x20required','express','\x20MB\x20of\x20files','../libs/mysql.js','uploads','execute','7ePwyZf','httpStatusCode','Path\x20is\x20required','/folder','post','./uploads','rmdirSync','Error!\x20Something\x20went\x20wrong.','user','diskStorage','log','../CADViewer_config.json','mkdirSync','size','renameSync','\x20files','files','length','send','folderLocation','unlinkSync','exports','./uploads/','json','path','delete','crypto','2298064yjdhlP','4887UOBlPW','readdirSync','body','/files','434253xrlvzc','email','reduce','Invalid\x20user','4434036wdYlTN','map','array','status','forEach','842DzVZAu','originalname','folder_name','10279332XpZNig','2174160ZBKeDd'];a8_0x5e7e=function(){return _0x4b0165;};return a8_0x5e7e();}!fs[a8_0x3ac9fb(0x13b)](dir)&&fs[a8_0x3ac9fb(0x154)](dir);const express=require(a8_0x3ac9fb(0x143)),router=express[a8_0x3ac9fb(0x13a)](),config=require(a8_0x3ac9fb(0x153)),storage=multer[a8_0x3ac9fb(0x151)]({'destination':function(_0x55b3c6,_0x4a96a9,_0x4b4854){const _0x94c17e=a8_0x3ac9fb;_0x4b4854(null,_0x94c17e(0x146));}}),upload=multer({'storage':storage});function a8_0x500f(_0x37bae2,_0x1efcc1){const _0x5e7e74=a8_0x5e7e();return a8_0x500f=function(_0x500fab,_0x1d09ac){_0x500fab=_0x500fab-0x11d;let _0x177dec=_0x5e7e74[_0x500fab];return _0x177dec;},a8_0x500f(_0x37bae2,_0x1efcc1);}router[a8_0x3ac9fb(0x14c)](a8_0x3ac9fb(0x12b),upload[a8_0x3ac9fb(0x132)](a8_0x3ac9fb(0x158)),verifyToken,async(_0x325610,_0x54e681,_0x39a14c)=>{const _0x4697ab=a8_0x3ac9fb,_0x23a8d8=_0x325610[_0x4697ab(0x158)],{global:_0x56f69d,path:_0x575ca4}=_0x325610[_0x4697ab(0x12a)],_0x46e9e2=config[_0x4697ab(0x11f)];console['log']({'global':_0x56f69d}),console[_0x4697ab(0x152)](_0x23a8d8),console[_0x4697ab(0x152)]({'user':_0x325610[_0x4697ab(0x150)]});if(_0x56f69d){_0x23a8d8['forEach'](_0x117708=>{const _0x8ab275=_0x4697ab;fs[_0x8ab275(0x156)](_0x117708[_0x8ab275(0x124)],(_0x575ca4||_0x46e9e2)+'/'+_0x117708[_0x8ab275(0x136)]);}),_0x54e681[_0x4697ab(0x11e)]({'files':_0x23a8d8[_0x4697ab(0x131)](_0x560a7b=>({..._0x560a7b,'path':(_0x575ca4||_0x46e9e2)+'/'+_0x560a7b[_0x4697ab(0x136)]}))});return;}let _0x547ddc;try{const [_0x2fbb4d]=await conn[_0x4697ab(0x140)]()[_0x4697ab(0x147)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x325610[_0x4697ab(0x150)][_0x4697ab(0x12d)]]);_0x2fbb4d[_0x4697ab(0x11d)]>0x0&&(_0x547ddc=_0x2fbb4d[0x0]);}catch(_0x9b0150){console[_0x4697ab(0x152)]({'err':_0x9b0150}),_0x54e681[_0x4697ab(0x133)](0x1f4)[_0x4697ab(0x123)]({'error':_0x4697ab(0x14f)});return;}if(!_0x547ddc){_0x54e681[_0x4697ab(0x133)](0x191)[_0x4697ab(0x123)]({'error':_0x4697ab(0x12f)});return;}let _0x444f1d=_0x547ddc[_0x4697ab(0x137)];if(!_0x444f1d){_0x444f1d=randomUUID();try{await conn[_0x4697ab(0x140)]()[_0x4697ab(0x147)]('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x444f1d,_0x325610[_0x4697ab(0x150)]['email']]);}catch(_0x32143c){console[_0x4697ab(0x152)]({'err':_0x32143c}),_0x54e681[_0x4697ab(0x133)](0x1f4)[_0x4697ab(0x123)]({'error':_0x4697ab(0x14f)});return;}}const _0x1682e3=_0x4697ab(0x122)+_0x444f1d;!fs[_0x4697ab(0x13b)](_0x1682e3)&&fs[_0x4697ab(0x154)](_0x1682e3);if(!_0x23a8d8){const _0x5cf1f9=new Error(_0x4697ab(0x13f));return _0x5cf1f9[_0x4697ab(0x149)]=0x190,_0x39a14c(_0x5cf1f9);}const _0x35fe85=fs[_0x4697ab(0x129)](_0x1682e3)[_0x4697ab(0x11d)]+_0x23a8d8[_0x4697ab(0x11d)];console[_0x4697ab(0x152)]({'numberOfSize':_0x35fe85});if(_0x35fe85>userFolderMaximumFiles)return _0x54e681[_0x4697ab(0x133)](0x190)[_0x4697ab(0x123)]({'error':_0x4697ab(0x141)+userFolderMaximumFiles+_0x4697ab(0x157)});const _0x3061cf=fs['readdirSync'](_0x1682e3)[_0x4697ab(0x12e)]((_0x4c5bf4,_0x3f792f)=>_0x4c5bf4+fs[_0x4697ab(0x13e)](_0x1682e3+'/'+_0x3f792f)[_0x4697ab(0x155)],0x0),_0x138596=_0x23a8d8['reduce']((_0x3652cc,_0x4c4ba5)=>_0x3652cc+_0x4c4ba5[_0x4697ab(0x155)],0x0);console[_0x4697ab(0x152)]({'totalSize':_0x3061cf,'uploadedSize':_0x138596});if(_0x138596+_0x3061cf>userFolderMaximumSizeInMB*0x400*0x400)return _0x54e681[_0x4697ab(0x133)](0x190)['json']({'error':_0x4697ab(0x141)+userFolderMaximumSizeInMB+_0x4697ab(0x144)});_0x23a8d8[_0x4697ab(0x134)](_0x1926d8=>{const _0xb280a=_0x4697ab;fs['renameSync'](_0x1926d8[_0xb280a(0x124)],_0x1682e3+'/'+_0x1926d8[_0xb280a(0x136)]);}),_0x54e681[_0x4697ab(0x11e)]({'files':_0x23a8d8[_0x4697ab(0x131)](_0x5adf21=>({..._0x5adf21,'path':_0x1682e3+'/'+_0x5adf21[_0x4697ab(0x136)]}))});}),router[a8_0x3ac9fb(0x14c)](a8_0x3ac9fb(0x14b),verifyToken,async(_0x2400c0,_0x4ee305)=>{const _0x3dd1ad=a8_0x3ac9fb,{path:_0x1f7f1c,folder_name:_0x2b51e4}=_0x2400c0['body'],_0x50c60e=config['folderLocation'];console[_0x3dd1ad(0x152)]({'path':_0x1f7f1c,'folder_name':_0x2b51e4});if(!_0x1f7f1c)return _0x4ee305[_0x3dd1ad(0x133)](0x190)['json']({'error':_0x3dd1ad(0x14a)});if(!_0x2b51e4)return _0x4ee305[_0x3dd1ad(0x133)](0x190)[_0x3dd1ad(0x123)]({'error':_0x3dd1ad(0x142)});const _0x5a0c23=_0x1f7f1c+'/'+_0x2b51e4;!fs[_0x3dd1ad(0x13b)](_0x5a0c23)&&fs[_0x3dd1ad(0x154)](_0x5a0c23),_0x4ee305[_0x3dd1ad(0x11e)]({'path':_0x5a0c23});}),router[a8_0x3ac9fb(0x125)](a8_0x3ac9fb(0x13c),verifyToken,async(_0x16a5dd,_0x51b3c7)=>{const _0x3a7eb4=a8_0x3ac9fb,{isFolder:_0x108dec,path:_0x4324a8}=_0x16a5dd['body'];!_0x108dec?fs[_0x3a7eb4(0x120)](_0x4324a8):fs[_0x3a7eb4(0x14e)](_0x4324a8,{'recursive':!![]}),_0x51b3c7[_0x3a7eb4(0x11e)]({'success':!![]});}),module[a8_0x3ac9fb(0x121)]=router;