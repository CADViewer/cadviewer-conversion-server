const a8_0x2b71b5=a8_0x418d;function a8_0x481e(){const _0x4ce6eb=['132771XwVMtp','express','forEach','\x20files','user','json','2476770RXBHVC','/folder','./uploads','rmdirSync','httpStatusCode','2921211EvSecp','98vjzXoK','mkdirSync','Invalid\x20user','/remove','copyFileSync','1914759wfFeGx','files','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','promise','Error!\x20Something\x20went\x20wrong.','statSync','body','15566zTGhVd','log','send','Path\x20is\x20required','existsSync','reduce','map','188HvaVjg','../CADViewer_config.json','5448512kVdnbr','delete','21325FwAdjJ','Folder\x20name\x20is\x20required','folderLocation','originalname','multer','unlinkSync','length','folder_name','diskStorage','size','status','verifyToken','./uploads/','readdirSync','path','../libs/mysql.js','post','crypto','../libs/jwt','exports','email'];a8_0x481e=function(){return _0x4ce6eb;};return a8_0x481e();}(function(_0x57dd3e,_0x2fc67b){const _0x543cb8=a8_0x418d,_0x11d694=_0x57dd3e();while(!![]){try{const _0x4ec036=parseInt(_0x543cb8(0x15d))/0x1*(parseInt(_0x543cb8(0x151))/0x2)+-parseInt(_0x543cb8(0x145))/0x3+-parseInt(_0x543cb8(0x164))/0x4*(-parseInt(_0x543cb8(0x168))/0x5)+-parseInt(_0x543cb8(0x14b))/0x6+parseInt(_0x543cb8(0x156))/0x7+-parseInt(_0x543cb8(0x166))/0x8+parseInt(_0x543cb8(0x150))/0x9;if(_0x4ec036===_0x2fc67b)break;else _0x11d694['push'](_0x11d694['shift']());}catch(_0x352ee0){_0x11d694['push'](_0x11d694['shift']());}}}(a8_0x481e,0x67515));const multer=require(a8_0x2b71b5(0x134)),fs=require('fs'),{randomUUID}=require(a8_0x2b71b5(0x141)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x2b71b5(0x165)),conn=require(a8_0x2b71b5(0x13f)),verifyToken=require(a8_0x2b71b5(0x142))[a8_0x2b71b5(0x13b)],dir=a8_0x2b71b5(0x14d);!fs[a8_0x2b71b5(0x161)](dir)&&fs[a8_0x2b71b5(0x152)](dir);function a8_0x418d(_0x4a009f,_0x50c384){const _0x481e77=a8_0x481e();return a8_0x418d=function(_0x418d79,_0x25c617){_0x418d79=_0x418d79-0x134;let _0x173174=_0x481e77[_0x418d79];return _0x173174;},a8_0x418d(_0x4a009f,_0x50c384);}const express=require(a8_0x2b71b5(0x146)),router=express['Router'](),config=require(a8_0x2b71b5(0x165)),storage=multer[a8_0x2b71b5(0x138)]({'destination':function(_0x47a96c,_0x56e347,_0x5a5403){_0x5a5403(null,'uploads');}}),upload=multer({'storage':storage});router[a8_0x2b71b5(0x140)]('/files',upload['array']('files'),verifyToken,async(_0x2d497f,_0x178013,_0x8be407)=>{const _0x494f0f=a8_0x2b71b5,_0x5673a0=_0x2d497f[_0x494f0f(0x157)],{global:_0x4d1293,path:_0x22401d}=_0x2d497f['body'],_0x32caec=config[_0x494f0f(0x16a)];console[_0x494f0f(0x15e)]({'global':_0x4d1293}),console[_0x494f0f(0x15e)](_0x5673a0),console[_0x494f0f(0x15e)]({'user':_0x2d497f[_0x494f0f(0x149)]});if(_0x4d1293){_0x5673a0[_0x494f0f(0x147)](_0x14f67f=>{const _0x19c3f2=_0x494f0f;fs[_0x19c3f2(0x155)](_0x14f67f[_0x19c3f2(0x13e)],(_0x22401d||_0x32caec)+'/'+_0x14f67f[_0x19c3f2(0x16b)]),fs[_0x19c3f2(0x135)](_0x14f67f[_0x19c3f2(0x13e)]);}),_0x178013[_0x494f0f(0x15f)]({'files':_0x5673a0['map'](_0x398d7c=>({..._0x398d7c,'path':(_0x22401d||_0x32caec)+'/'+_0x398d7c[_0x494f0f(0x16b)]}))});return;}let _0xcdc528;try{const [_0x3859f5]=await conn[_0x494f0f(0x159)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x2d497f[_0x494f0f(0x149)][_0x494f0f(0x144)]]);_0x3859f5[_0x494f0f(0x136)]>0x0&&(_0xcdc528=_0x3859f5[0x0]);}catch(_0x884a3a){console[_0x494f0f(0x15e)]({'err':_0x884a3a}),_0x178013[_0x494f0f(0x13a)](0x1f4)['json']({'error':_0x494f0f(0x15a)});return;}if(!_0xcdc528){_0x178013[_0x494f0f(0x13a)](0x191)['json']({'error':_0x494f0f(0x153)});return;}let _0x38303c=_0xcdc528[_0x494f0f(0x137)];if(!_0x38303c){_0x38303c=randomUUID();try{await conn[_0x494f0f(0x159)]()['execute']('UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?',[_0x38303c,_0x2d497f['user'][_0x494f0f(0x144)]]);}catch(_0x310343){console[_0x494f0f(0x15e)]({'err':_0x310343}),_0x178013[_0x494f0f(0x13a)](0x1f4)[_0x494f0f(0x14a)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0x380743=_0x494f0f(0x13c)+_0x38303c;!fs[_0x494f0f(0x161)](_0x380743)&&fs[_0x494f0f(0x152)](_0x380743);if(!_0x5673a0){const _0x25f498=new Error('Please\x20upload\x20a\x20file');return _0x25f498[_0x494f0f(0x14f)]=0x190,_0x8be407(_0x25f498);}const _0x2751e3=fs[_0x494f0f(0x13d)](_0x380743)[_0x494f0f(0x136)]+_0x5673a0['length'];console[_0x494f0f(0x15e)]({'numberOfSize':_0x2751e3});if(_0x2751e3>userFolderMaximumFiles)return _0x178013[_0x494f0f(0x13a)](0x190)[_0x494f0f(0x14a)]({'error':_0x494f0f(0x158)+userFolderMaximumFiles+_0x494f0f(0x148)});const _0x408944=fs[_0x494f0f(0x13d)](_0x380743)[_0x494f0f(0x162)]((_0x4e8aa3,_0x752550)=>_0x4e8aa3+fs[_0x494f0f(0x15b)](_0x380743+'/'+_0x752550)[_0x494f0f(0x139)],0x0),_0xa5aa9a=_0x5673a0[_0x494f0f(0x162)]((_0x33f284,_0x5826f7)=>_0x33f284+_0x5826f7[_0x494f0f(0x139)],0x0);console[_0x494f0f(0x15e)]({'totalSize':_0x408944,'uploadedSize':_0xa5aa9a});if(_0xa5aa9a+_0x408944>userFolderMaximumSizeInMB*0x400*0x400)return _0x178013[_0x494f0f(0x13a)](0x190)[_0x494f0f(0x14a)]({'error':_0x494f0f(0x158)+userFolderMaximumSizeInMB+'\x20MB\x20of\x20files'});_0x5673a0[_0x494f0f(0x147)](_0x17909f=>{const _0x4ec0c6=_0x494f0f;fs[_0x4ec0c6(0x155)](_0x17909f[_0x4ec0c6(0x13e)],_0x380743+'/'+_0x17909f[_0x4ec0c6(0x16b)]),fs[_0x4ec0c6(0x135)](_0x17909f[_0x4ec0c6(0x13e)]);}),_0x178013['send']({'files':_0x5673a0[_0x494f0f(0x163)](_0x54ff90=>({..._0x54ff90,'path':_0x380743+'/'+_0x54ff90[_0x494f0f(0x16b)]}))});}),router[a8_0x2b71b5(0x140)](a8_0x2b71b5(0x14c),verifyToken,async(_0x33ed3b,_0x19d693)=>{const _0x3f82a4=a8_0x2b71b5,{path:_0x426453,folder_name:_0x4971ef}=_0x33ed3b['body'];console[_0x3f82a4(0x15e)]({'path':_0x426453,'folder_name':_0x4971ef});if(!_0x426453)return _0x19d693[_0x3f82a4(0x13a)](0x190)[_0x3f82a4(0x14a)]({'error':_0x3f82a4(0x160)});if(!_0x4971ef)return _0x19d693[_0x3f82a4(0x13a)](0x190)['json']({'error':_0x3f82a4(0x169)});const _0x4cef8c=_0x426453+'/'+_0x4971ef;!fs[_0x3f82a4(0x161)](_0x4cef8c)&&fs[_0x3f82a4(0x152)](_0x4cef8c),_0x19d693[_0x3f82a4(0x15f)]({'path':_0x4cef8c});}),router[a8_0x2b71b5(0x167)](a8_0x2b71b5(0x154),verifyToken,async(_0x1a2b22,_0x182154)=>{const _0x4d8ad6=a8_0x2b71b5,{isFolder:_0x3fe841,path:_0x3c0fa6}=_0x1a2b22[_0x4d8ad6(0x15c)];!_0x3fe841?fs[_0x4d8ad6(0x135)](_0x3c0fa6):fs[_0x4d8ad6(0x14e)](_0x3c0fa6,{'recursive':!![]}),_0x182154[_0x4d8ad6(0x15f)]({'success':!![]});}),module[a8_0x2b71b5(0x143)]=router;