const a9_0x293c55=a9_0x270a;function a9_0x270a(_0x4c60b0,_0x4f97dc){const _0x382ab2=a9_0x382a();return a9_0x270a=function(_0x270a09,_0x1d450c){_0x270a09=_0x270a09-0x112;let _0x1ddb06=_0x382ab2[_0x270a09];return _0x1ddb06;},a9_0x270a(_0x4c60b0,_0x4f97dc);}function a9_0x382a(){const _0x2e599f=['3GzeJik','14840pRiKQP','map','Invalid\x20user','Please\x20upload\x20a\x20file','mkdirSync','json','log','/files','express','441820zhwrko','multer','user','existsSync','Error!\x20Something\x20went\x20wrong.','Folder\x20name\x20is\x20required','27517YITXOq','Router','files','diskStorage','execute','originalname','post','../libs/jwt','readdirSync','108320XZXGNS','email','forEach','378lPpnuI','exports','rmdirSync','body','../CADViewer_config.json','./uploads','length','unlinkSync','status','\x20MB\x20of\x20files','20kfPxdw','folderLocation','path','\x20files','verifyToken','size','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','promise','664VBCkqk','statSync','array','reduce','send','3549029pyEUgK','281275IyVJdT','uploads','1423578KCdJNQ','crypto','copyFileSync'];a9_0x382a=function(){return _0x2e599f;};return a9_0x382a();}(function(_0x10ca04,_0x37f2f6){const _0x35ccc1=a9_0x270a,_0x5106aa=_0x10ca04();while(!![]){try{const _0x27ef3e=parseInt(_0x35ccc1(0x139))/0x1+parseInt(_0x35ccc1(0x142))/0x2*(-parseInt(_0x35ccc1(0x138))/0x3)+-parseInt(_0x35ccc1(0x125))/0x4*(-parseInt(_0x35ccc1(0x133))/0x5)+-parseInt(_0x35ccc1(0x135))/0x6+-parseInt(_0x35ccc1(0x148))/0x7*(-parseInt(_0x35ccc1(0x12d))/0x8)+parseInt(_0x35ccc1(0x11b))/0x9*(parseInt(_0x35ccc1(0x118))/0xa)+-parseInt(_0x35ccc1(0x132))/0xb;if(_0x27ef3e===_0x37f2f6)break;else _0x5106aa['push'](_0x5106aa['shift']());}catch(_0x4dc0e1){_0x5106aa['push'](_0x5106aa['shift']());}}}(a9_0x382a,0x48648));const multer=require(a9_0x293c55(0x143)),fs=require('fs'),{randomUUID}=require(a9_0x293c55(0x136)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a9_0x293c55(0x11f)),conn=require('../libs/mysql.js'),verifyToken=require(a9_0x293c55(0x116))[a9_0x293c55(0x129)],dir=a9_0x293c55(0x120);!fs[a9_0x293c55(0x145)](dir)&&fs[a9_0x293c55(0x13d)](dir);const express=require(a9_0x293c55(0x141)),router=express[a9_0x293c55(0x149)](),config=require('../CADViewer_config.json'),storage=multer[a9_0x293c55(0x112)]({'destination':function(_0x754fd5,_0x527717,_0x2c0d64){const _0x54805f=a9_0x293c55;_0x2c0d64(null,_0x54805f(0x134));}}),upload=multer({'storage':storage});router[a9_0x293c55(0x115)](a9_0x293c55(0x140),upload[a9_0x293c55(0x12f)](a9_0x293c55(0x14a)),verifyToken,async(_0x8daae4,_0x2d22e9,_0xa49d27)=>{const _0x24d3cf=a9_0x293c55,_0x2b4142=_0x8daae4['files'],{global:_0x126dd6,path:_0x18201e}=_0x8daae4['body'],_0x2409fa=config[_0x24d3cf(0x126)];console[_0x24d3cf(0x13f)]({'global':_0x126dd6}),console[_0x24d3cf(0x13f)](_0x2b4142),console[_0x24d3cf(0x13f)]({'user':_0x8daae4[_0x24d3cf(0x144)]});if(_0x126dd6){_0x2b4142['forEach'](_0x1c1703=>{const _0x46f0f4=_0x24d3cf;fs[_0x46f0f4(0x137)](_0x1c1703[_0x46f0f4(0x127)],(_0x18201e||_0x2409fa)+'/'+_0x1c1703[_0x46f0f4(0x114)]),fs[_0x46f0f4(0x122)](_0x1c1703[_0x46f0f4(0x127)]);}),_0x2d22e9[_0x24d3cf(0x131)]({'files':_0x2b4142[_0x24d3cf(0x13a)](_0x574675=>({..._0x574675,'path':(_0x18201e||_0x2409fa)+'/'+_0x574675['originalname']}))});return;}let _0x55a863;try{const [_0x76b756]=await conn['promise']()[_0x24d3cf(0x113)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x8daae4[_0x24d3cf(0x144)][_0x24d3cf(0x119)]]);_0x76b756[_0x24d3cf(0x121)]>0x0&&(_0x55a863=_0x76b756[0x0]);}catch(_0x5d14a5){console[_0x24d3cf(0x13f)]({'err':_0x5d14a5}),_0x2d22e9[_0x24d3cf(0x123)](0x1f4)[_0x24d3cf(0x13e)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x55a863){_0x2d22e9[_0x24d3cf(0x123)](0x191)[_0x24d3cf(0x13e)]({'error':_0x24d3cf(0x13b)});return;}let _0x4164f8=_0x55a863['folder_name'];if(!_0x4164f8){_0x4164f8=randomUUID();try{await conn[_0x24d3cf(0x12c)]()[_0x24d3cf(0x113)](_0x24d3cf(0x12b),[_0x4164f8,_0x8daae4['user']['email']]);}catch(_0x393b9a){console[_0x24d3cf(0x13f)]({'err':_0x393b9a}),_0x2d22e9[_0x24d3cf(0x123)](0x1f4)[_0x24d3cf(0x13e)]({'error':_0x24d3cf(0x146)});return;}}const _0x12ba69='./uploads/'+_0x4164f8;!fs[_0x24d3cf(0x145)](_0x12ba69)&&fs[_0x24d3cf(0x13d)](_0x12ba69);if(!_0x2b4142){const _0x35c6c7=new Error(_0x24d3cf(0x13c));return _0x35c6c7['httpStatusCode']=0x190,_0xa49d27(_0x35c6c7);}const _0x537cdc=fs[_0x24d3cf(0x117)](_0x12ba69)[_0x24d3cf(0x121)]+_0x2b4142[_0x24d3cf(0x121)];console['log']({'numberOfSize':_0x537cdc});if(_0x537cdc>userFolderMaximumFiles)return _0x2d22e9[_0x24d3cf(0x123)](0x190)[_0x24d3cf(0x13e)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumFiles+_0x24d3cf(0x128)});const _0x35ecd2=fs[_0x24d3cf(0x117)](_0x12ba69)[_0x24d3cf(0x130)]((_0xc5315,_0xf3f2b8)=>_0xc5315+fs[_0x24d3cf(0x12e)](_0x12ba69+'/'+_0xf3f2b8)[_0x24d3cf(0x12a)],0x0),_0x5f483c=_0x2b4142[_0x24d3cf(0x130)]((_0x1514c6,_0x109749)=>_0x1514c6+_0x109749['size'],0x0);console['log']({'totalSize':_0x35ecd2,'uploadedSize':_0x5f483c});if(_0x5f483c+_0x35ecd2>userFolderMaximumSizeInMB*0x400*0x400)return _0x2d22e9['status'](0x190)['json']({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+_0x24d3cf(0x124)});_0x2b4142[_0x24d3cf(0x11a)](_0x52d894=>{const _0x6779cb=_0x24d3cf;fs[_0x6779cb(0x137)](_0x52d894[_0x6779cb(0x127)],_0x12ba69+'/'+_0x52d894[_0x6779cb(0x114)]),fs[_0x6779cb(0x122)](_0x52d894[_0x6779cb(0x127)]);}),_0x2d22e9['send']({'files':_0x2b4142[_0x24d3cf(0x13a)](_0x90cbd2=>({..._0x90cbd2,'path':_0x12ba69+'/'+_0x90cbd2['originalname']}))});}),router[a9_0x293c55(0x115)]('/folder',verifyToken,async(_0x3c7855,_0x34d418)=>{const _0x279ede=a9_0x293c55,{path:_0x37808b,folder_name:_0x162cf5}=_0x3c7855[_0x279ede(0x11e)];console[_0x279ede(0x13f)]({'path':_0x37808b,'folder_name':_0x162cf5});if(!_0x37808b)return _0x34d418[_0x279ede(0x123)](0x190)['json']({'error':'Path\x20is\x20required'});if(!_0x162cf5)return _0x34d418[_0x279ede(0x123)](0x190)['json']({'error':_0x279ede(0x147)});const _0x26b78a=_0x37808b+'/'+_0x162cf5;!fs['existsSync'](_0x26b78a)&&fs[_0x279ede(0x13d)](_0x26b78a),_0x34d418[_0x279ede(0x131)]({'path':_0x26b78a});}),router['delete']('/remove',verifyToken,async(_0x225dfa,_0x166028)=>{const _0x4b8189=a9_0x293c55,{isFolder:_0x27cbad,path:_0x2ee407}=_0x225dfa[_0x4b8189(0x11e)];!_0x27cbad?fs['unlinkSync'](_0x2ee407):fs[_0x4b8189(0x11d)](_0x2ee407,{'recursive':!![]}),_0x166028[_0x4b8189(0x131)]({'success':!![]});}),module[a9_0x293c55(0x11c)]=router;