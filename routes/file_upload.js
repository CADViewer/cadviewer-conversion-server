const a8_0x439816=a8_0x23bd;function a8_0x23bd(_0x39584d,_0x50e527){const _0x1f1c61=a8_0x1f1c();return a8_0x23bd=function(_0x23bd00,_0x5a05f0){_0x23bd00=_0x23bd00-0x16b;let _0x29b5e7=_0x1f1c61[_0x23bd00];return _0x29b5e7;},a8_0x23bd(_0x39584d,_0x50e527);}(function(_0x35bb26,_0x554fb9){const _0x4f1398=a8_0x23bd,_0x45ee81=_0x35bb26();while(!![]){try{const _0x2d11f8=parseInt(_0x4f1398(0x18c))/0x1+parseInt(_0x4f1398(0x192))/0x2*(-parseInt(_0x4f1398(0x17c))/0x3)+parseInt(_0x4f1398(0x196))/0x4+-parseInt(_0x4f1398(0x19d))/0x5+-parseInt(_0x4f1398(0x18f))/0x6*(parseInt(_0x4f1398(0x19e))/0x7)+parseInt(_0x4f1398(0x18d))/0x8+parseInt(_0x4f1398(0x187))/0x9;if(_0x2d11f8===_0x554fb9)break;else _0x45ee81['push'](_0x45ee81['shift']());}catch(_0x3fe95c){_0x45ee81['push'](_0x45ee81['shift']());}}}(a8_0x1f1c,0xa7153));function a8_0x1f1c(){const _0x27d338=['12254067booQmv','folderLocation','files','renameSync','promise','529027nLOiyf','890984eTSMCm','readdirSync','1836600QBNuUr','multer','../libs/jwt','1179978zaqaou','Path\x20is\x20required','verifyToken','json','2184840wOBiZL','size','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','\x20files','../CADViewer_config.json','/files','array','247065YWdKfb','28Tpwzgf','mkdirSync','user','exports','status','diskStorage','path','/folder','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','./uploads','send','length','Folder\x20name\x20is\x20required','email','execute','Please\x20upload\x20a\x20file','reduce','../libs/mysql.js','forEach','Router','map','\x20MB\x20of\x20files','folder_name','Error!\x20Something\x20went\x20wrong.','3AndhFW','unlinkSync','rmdirSync','body','uploads','originalname','httpStatusCode','existsSync','/remove','log','./uploads/'];a8_0x1f1c=function(){return _0x27d338;};return a8_0x1f1c();}const multer=require(a8_0x439816(0x190)),fs=require('fs'),{randomUUID}=require('crypto'),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require(a8_0x439816(0x175)),verifyToken=require(a8_0x439816(0x191))[a8_0x439816(0x194)],dir=a8_0x439816(0x16d);!fs['existsSync'](dir)&&fs[a8_0x439816(0x19f)](dir);const express=require('express'),router=express[a8_0x439816(0x177)](),config=require(a8_0x439816(0x19a)),storage=multer[a8_0x439816(0x1a3)]({'destination':function(_0x3d77a0,_0x5f1d4e,_0x110df6){const _0xac90ea=a8_0x439816;_0x110df6(null,_0xac90ea(0x180));}}),upload=multer({'storage':storage});router['post'](a8_0x439816(0x19b),upload[a8_0x439816(0x19c)](a8_0x439816(0x189)),verifyToken,async(_0x148ad8,_0x2d6287,_0x42bb37)=>{const _0x155c66=a8_0x439816,_0x152e4e=_0x148ad8[_0x155c66(0x189)],{global:_0xcc434d,path:_0x2a660c}=_0x148ad8['body'],_0x551a4e=config[_0x155c66(0x188)];console[_0x155c66(0x185)]({'global':_0xcc434d}),console['log'](_0x152e4e),console[_0x155c66(0x185)]({'user':_0x148ad8[_0x155c66(0x1a0)]});if(_0xcc434d){_0x152e4e[_0x155c66(0x176)](_0x33524b=>{const _0x6030ab=_0x155c66;fs[_0x6030ab(0x18a)](_0x33524b[_0x6030ab(0x1a4)],(_0x2a660c||_0x551a4e)+'/'+_0x33524b[_0x6030ab(0x181)]);}),_0x2d6287['send']({'files':_0x152e4e['map'](_0x4ad297=>({..._0x4ad297,'path':(_0x2a660c||_0x551a4e)+'/'+_0x4ad297[_0x155c66(0x181)]}))});return;}let _0x3e3abd;try{const [_0x353a6b]=await conn[_0x155c66(0x18b)]()['execute']('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x148ad8[_0x155c66(0x1a0)][_0x155c66(0x171)]]);_0x353a6b[_0x155c66(0x16f)]>0x0&&(_0x3e3abd=_0x353a6b[0x0]);}catch(_0x38d68d){console[_0x155c66(0x185)]({'err':_0x38d68d}),_0x2d6287[_0x155c66(0x1a2)](0x1f4)[_0x155c66(0x195)]({'error':_0x155c66(0x17b)});return;}if(!_0x3e3abd){_0x2d6287['status'](0x191)['json']({'error':'Invalid\x20user'});return;}let _0x9c22d1=_0x3e3abd[_0x155c66(0x17a)];if(!_0x9c22d1){_0x9c22d1=randomUUID();try{await conn[_0x155c66(0x18b)]()[_0x155c66(0x172)](_0x155c66(0x16c),[_0x9c22d1,_0x148ad8[_0x155c66(0x1a0)][_0x155c66(0x171)]]);}catch(_0x2e2b20){console['log']({'err':_0x2e2b20}),_0x2d6287['status'](0x1f4)[_0x155c66(0x195)]({'error':_0x155c66(0x17b)});return;}}const _0x5eaa06=_0x155c66(0x186)+_0x9c22d1;!fs[_0x155c66(0x183)](_0x5eaa06)&&fs[_0x155c66(0x19f)](_0x5eaa06);if(!_0x152e4e){const _0x546f5f=new Error(_0x155c66(0x173));return _0x546f5f[_0x155c66(0x182)]=0x190,_0x42bb37(_0x546f5f);}const _0x574f61=fs['readdirSync'](_0x5eaa06)['length']+_0x152e4e['length'];console[_0x155c66(0x185)]({'numberOfSize':_0x574f61});if(_0x574f61>userFolderMaximumFiles)return _0x2d6287[_0x155c66(0x1a2)](0x190)[_0x155c66(0x195)]({'error':_0x155c66(0x198)+userFolderMaximumFiles+_0x155c66(0x199)});const _0x57c334=fs[_0x155c66(0x18e)](_0x5eaa06)['reduce']((_0x1366c9,_0x250f6b)=>_0x1366c9+fs['statSync'](_0x5eaa06+'/'+_0x250f6b)[_0x155c66(0x197)],0x0),_0x32e4e1=_0x152e4e[_0x155c66(0x174)]((_0x33e439,_0x217c83)=>_0x33e439+_0x217c83[_0x155c66(0x197)],0x0);console[_0x155c66(0x185)]({'totalSize':_0x57c334,'uploadedSize':_0x32e4e1});if(_0x32e4e1+_0x57c334>userFolderMaximumSizeInMB*0x400*0x400)return _0x2d6287['status'](0x190)[_0x155c66(0x195)]({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+_0x155c66(0x179)});_0x152e4e[_0x155c66(0x176)](_0x3f6a53=>{const _0x412303=_0x155c66;fs['renameSync'](_0x3f6a53[_0x412303(0x1a4)],_0x5eaa06+'/'+_0x3f6a53[_0x412303(0x181)]);}),_0x2d6287[_0x155c66(0x16e)]({'files':_0x152e4e[_0x155c66(0x178)](_0x48ece3=>({..._0x48ece3,'path':_0x5eaa06+'/'+_0x48ece3[_0x155c66(0x181)]}))});}),router['post'](a8_0x439816(0x16b),verifyToken,async(_0x4bb584,_0x32673b)=>{const _0x1920de=a8_0x439816,{path:_0x311cb2,folder_name:_0x285d57}=_0x4bb584[_0x1920de(0x17f)],_0x200c9a=config['folderLocation'];console[_0x1920de(0x185)]({'path':_0x311cb2,'folder_name':_0x285d57});if(!_0x311cb2)return _0x32673b[_0x1920de(0x1a2)](0x190)['json']({'error':_0x1920de(0x193)});if(!_0x285d57)return _0x32673b[_0x1920de(0x1a2)](0x190)[_0x1920de(0x195)]({'error':_0x1920de(0x170)});const _0x500703=_0x311cb2+'/'+_0x285d57;!fs[_0x1920de(0x183)](_0x500703)&&fs[_0x1920de(0x19f)](_0x500703),_0x32673b['send']({'path':_0x500703});}),router['delete'](a8_0x439816(0x184),verifyToken,async(_0x2c533f,_0xa48ba7)=>{const _0x5eb3c8=a8_0x439816,{isFolder:_0x59d76e,path:_0xb2faba}=_0x2c533f['body'];!_0x59d76e?fs[_0x5eb3c8(0x17d)](_0xb2faba):fs[_0x5eb3c8(0x17e)](_0xb2faba,{'recursive':!![]}),_0xa48ba7[_0x5eb3c8(0x16e)]({'success':!![]});}),module[a8_0x439816(0x1a1)]=router;