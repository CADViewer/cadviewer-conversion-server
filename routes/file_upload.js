function a8_0x15e4(_0x4da906,_0x28ea7c){const _0x58b833=a8_0x58b8();return a8_0x15e4=function(_0x15e4ac,_0x31972b){_0x15e4ac=_0x15e4ac-0x1b3;let _0x5eb77f=_0x58b833[_0x15e4ac];return _0x5eb77f;},a8_0x15e4(_0x4da906,_0x28ea7c);}function a8_0x58b8(){const _0x15b230=['email','\x20files','Folder\x20name\x20is\x20required','originalname','631513MMMmrU','array','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','body','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','delete','user','existsSync','send','mkdirSync','../CADViewer_config.json','renameSync','readdirSync','folder_name','reduce','express','Error!\x20Something\x20went\x20wrong.','/folder','Invalid\x20user','3608423kNAVXS','2MSuUQo','Path\x20is\x20required','log','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','length','promise','../libs/jwt','294952MxpTtz','crypto','3uNeETX','/remove','files','forEach','verifyToken','post','1857500yYnCml','./uploads','size','folderLocation','execute','statSync','1258227bIwLXv','\x20MB\x20of\x20files','path','4067736UosHFw','unlinkSync','json','3762426jtUZnw','exports','status'];a8_0x58b8=function(){return _0x15b230;};return a8_0x58b8();}const a8_0x4973e9=a8_0x15e4;(function(_0x584064,_0x3c812b){const _0x133a13=a8_0x15e4,_0x12bd33=_0x584064();while(!![]){try{const _0x2c0c74=-parseInt(_0x133a13(0x1e5))/0x1*(parseInt(_0x133a13(0x1c3))/0x2)+parseInt(_0x133a13(0x1cc))/0x3*(-parseInt(_0x133a13(0x1ca))/0x4)+-parseInt(_0x133a13(0x1d2))/0x5+parseInt(_0x133a13(0x1de))/0x6+parseInt(_0x133a13(0x1c2))/0x7+parseInt(_0x133a13(0x1db))/0x8+-parseInt(_0x133a13(0x1d8))/0x9;if(_0x2c0c74===_0x3c812b)break;else _0x12bd33['push'](_0x12bd33['shift']());}catch(_0x55c2cd){_0x12bd33['push'](_0x12bd33['shift']());}}}(a8_0x58b8,0x6a129));const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a8_0x4973e9(0x1cb)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x4973e9(0x1b9)),conn=require('../libs/mysql.js'),verifyToken=require(a8_0x4973e9(0x1c9))[a8_0x4973e9(0x1d0)],dir=a8_0x4973e9(0x1d3);!fs[a8_0x4973e9(0x1b6)](dir)&&fs['mkdirSync'](dir);const express=require(a8_0x4973e9(0x1be)),router=express['Router'](),config=require('../CADViewer_config.json'),storage=multer['diskStorage']({'destination':function(_0x280b32,_0x19f8f9,_0x28cf96){_0x28cf96(null,'uploads');}}),upload=multer({'storage':storage});router['post']('/files',upload[a8_0x4973e9(0x1e6)](a8_0x4973e9(0x1ce)),verifyToken,async(_0x331cc5,_0x24cf62,_0xbb04a0)=>{const _0x349c3c=a8_0x4973e9,_0x48bc47=_0x331cc5[_0x349c3c(0x1ce)],{global:_0x2179b0,path:_0x4e8637}=_0x331cc5['body'],_0x18d14f=config['folderLocation'];console[_0x349c3c(0x1c5)]({'global':_0x2179b0}),console['log'](_0x48bc47),console[_0x349c3c(0x1c5)]({'user':_0x331cc5[_0x349c3c(0x1b5)]});if(_0x2179b0){_0x48bc47[_0x349c3c(0x1cf)](_0x2909e8=>{const _0x51de0b=_0x349c3c;fs['renameSync'](_0x2909e8['path'],(_0x4e8637||_0x18d14f)+'/'+_0x2909e8[_0x51de0b(0x1e4)]);}),_0x24cf62[_0x349c3c(0x1b7)]({'files':_0x48bc47['map'](_0x303c40=>({..._0x303c40,'path':(_0x4e8637||_0x18d14f)+'/'+_0x303c40[_0x349c3c(0x1e4)]}))});return;}let _0x125fe4;try{const [_0x2c59a3]=await conn[_0x349c3c(0x1c8)]()[_0x349c3c(0x1d6)](_0x349c3c(0x1e7),[_0x331cc5[_0x349c3c(0x1b5)]['email']]);_0x2c59a3[_0x349c3c(0x1c7)]>0x0&&(_0x125fe4=_0x2c59a3[0x0]);}catch(_0x2dbbc6){console['log']({'err':_0x2dbbc6}),_0x24cf62[_0x349c3c(0x1e0)](0x1f4)[_0x349c3c(0x1dd)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x125fe4){_0x24cf62[_0x349c3c(0x1e0)](0x191)['json']({'error':_0x349c3c(0x1c1)});return;}let _0x284a81=_0x125fe4[_0x349c3c(0x1bc)];if(!_0x284a81){_0x284a81=randomUUID();try{await conn['promise']()[_0x349c3c(0x1d6)](_0x349c3c(0x1c6),[_0x284a81,_0x331cc5['user'][_0x349c3c(0x1e1)]]);}catch(_0x4cb3db){console[_0x349c3c(0x1c5)]({'err':_0x4cb3db}),_0x24cf62[_0x349c3c(0x1e0)](0x1f4)[_0x349c3c(0x1dd)]({'error':_0x349c3c(0x1bf)});return;}}const _0x1421e5='./uploads/'+_0x284a81;!fs[_0x349c3c(0x1b6)](_0x1421e5)&&fs[_0x349c3c(0x1b8)](_0x1421e5);if(!_0x48bc47){const _0x44f64e=new Error('Please\x20upload\x20a\x20file');return _0x44f64e['httpStatusCode']=0x190,_0xbb04a0(_0x44f64e);}const _0x1d3145=fs['readdirSync'](_0x1421e5)[_0x349c3c(0x1c7)]+_0x48bc47['length'];console[_0x349c3c(0x1c5)]({'numberOfSize':_0x1d3145});if(_0x1d3145>userFolderMaximumFiles)return _0x24cf62[_0x349c3c(0x1e0)](0x190)[_0x349c3c(0x1dd)]({'error':_0x349c3c(0x1b3)+userFolderMaximumFiles+_0x349c3c(0x1e2)});const _0x3a6520=fs[_0x349c3c(0x1bb)](_0x1421e5)['reduce']((_0x3dba47,_0x245f91)=>_0x3dba47+fs[_0x349c3c(0x1d7)](_0x1421e5+'/'+_0x245f91)['size'],0x0),_0x43fb9c=_0x48bc47[_0x349c3c(0x1bd)]((_0x1f363b,_0x375297)=>_0x1f363b+_0x375297[_0x349c3c(0x1d4)],0x0);console[_0x349c3c(0x1c5)]({'totalSize':_0x3a6520,'uploadedSize':_0x43fb9c});if(_0x43fb9c+_0x3a6520>userFolderMaximumSizeInMB*0x400*0x400)return _0x24cf62[_0x349c3c(0x1e0)](0x190)['json']({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+_0x349c3c(0x1d9)});_0x48bc47[_0x349c3c(0x1cf)](_0x177064=>{const _0x56eac8=_0x349c3c;fs[_0x56eac8(0x1ba)](_0x177064[_0x56eac8(0x1da)],_0x1421e5+'/'+_0x177064['originalname']);}),_0x24cf62[_0x349c3c(0x1b7)]({'files':_0x48bc47['map'](_0x233c3e=>({..._0x233c3e,'path':_0x1421e5+'/'+_0x233c3e[_0x349c3c(0x1e4)]}))});}),router[a8_0x4973e9(0x1d1)](a8_0x4973e9(0x1c0),verifyToken,async(_0x52f52f,_0x460281)=>{const _0x232032=a8_0x4973e9,{path:_0x10b021,folder_name:_0x56e914}=_0x52f52f[_0x232032(0x1e8)],_0x93726b=config[_0x232032(0x1d5)];console[_0x232032(0x1c5)]({'path':_0x10b021,'folder_name':_0x56e914});if(!_0x10b021)return _0x460281['status'](0x190)[_0x232032(0x1dd)]({'error':_0x232032(0x1c4)});if(!_0x56e914)return _0x460281[_0x232032(0x1e0)](0x190)[_0x232032(0x1dd)]({'error':_0x232032(0x1e3)});const _0x215897=_0x10b021+'/'+_0x56e914;!fs[_0x232032(0x1b6)](_0x215897)&&fs['mkdirSync'](_0x215897),_0x460281[_0x232032(0x1b7)]({'path':_0x215897});}),router[a8_0x4973e9(0x1b4)](a8_0x4973e9(0x1cd),verifyToken,async(_0x2b83cc,_0x30e527)=>{const _0x54a7ad=a8_0x4973e9,{isFolder:_0x454e97,path:_0x2cc84b}=_0x2b83cc[_0x54a7ad(0x1e8)];!_0x454e97?fs[_0x54a7ad(0x1dc)](_0x2cc84b):fs['rmdirSync'](_0x2cc84b,{'recursive':!![]}),_0x30e527[_0x54a7ad(0x1b7)]({'success':!![]});}),module[a8_0x4973e9(0x1df)]=router;