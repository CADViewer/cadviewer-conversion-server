const a8_0x245256=a8_0x6c88;(function(_0x2b0aef,_0xce6504){const _0x361de3=a8_0x6c88,_0x3547a6=_0x2b0aef();while(!![]){try{const _0x5d3107=-parseInt(_0x361de3(0x1b6))/0x1+-parseInt(_0x361de3(0x192))/0x2+parseInt(_0x361de3(0x194))/0x3*(parseInt(_0x361de3(0x1a0))/0x4)+-parseInt(_0x361de3(0x193))/0x5+-parseInt(_0x361de3(0x1ba))/0x6+-parseInt(_0x361de3(0x1ab))/0x7+parseInt(_0x361de3(0x1a3))/0x8;if(_0x5d3107===_0xce6504)break;else _0x3547a6['push'](_0x3547a6['shift']());}catch(_0x38d89d){_0x3547a6['push'](_0x3547a6['shift']());}}}(a8_0x1ed5,0x27285));const multer=require('multer'),fs=require('fs'),{randomUUID}=require(a8_0x245256(0x1b8)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require(a8_0x245256(0x1c1)),verifyToken=require(a8_0x245256(0x190))[a8_0x245256(0x1a6)],dir=a8_0x245256(0x1a4);!fs[a8_0x245256(0x1be)](dir)&&fs[a8_0x245256(0x1bb)](dir);function a8_0x6c88(_0x47c33c,_0x56bcbc){const _0x1ed5d3=a8_0x1ed5();return a8_0x6c88=function(_0x6c88e9,_0x194c3b){_0x6c88e9=_0x6c88e9-0x18b;let _0x2537cd=_0x1ed5d3[_0x6c88e9];return _0x2537cd;},a8_0x6c88(_0x47c33c,_0x56bcbc);}const express=require(a8_0x245256(0x19b)),router=express[a8_0x245256(0x199)](),config=require('../CADViewer_config.json'),storage=multer['diskStorage']({'destination':function(_0x500749,_0xad90e6,_0x1794c6){_0x1794c6(null,'uploads');}}),upload=multer({'storage':storage});router['post'](a8_0x245256(0x1ac),upload['array']('files'),verifyToken,async(_0x4c01c9,_0x5d7714,_0x4af31d)=>{const _0x119450=a8_0x245256,_0x5cb2a1=_0x4c01c9[_0x119450(0x19e)],{global:_0x259b02,path:_0x2cf7ab}=_0x4c01c9[_0x119450(0x1b1)],_0xce213b=config[_0x119450(0x1a2)];console[_0x119450(0x1bf)]({'global':_0x259b02}),console[_0x119450(0x1bf)](_0x5cb2a1),console[_0x119450(0x1bf)]({'user':_0x4c01c9[_0x119450(0x1aa)]});if(_0x259b02){_0x5cb2a1[_0x119450(0x1b3)](_0x288651=>{const _0x188b0a=_0x119450;fs[_0x188b0a(0x1a9)](_0x288651[_0x188b0a(0x1a7)],(_0x2cf7ab||_0xce213b)+'/'+_0x288651[_0x188b0a(0x1b5)]);}),_0x5d7714[_0x119450(0x1a5)]({'files':_0x5cb2a1[_0x119450(0x1b7)](_0x14f093=>({..._0x14f093,'path':(_0x2cf7ab||_0xce213b)+'/'+_0x14f093[_0x119450(0x1b5)]}))});return;}let _0x4de63f;try{const [_0x342c0b]=await conn[_0x119450(0x1b9)]()[_0x119450(0x197)]('SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?',[_0x4c01c9['user']['email']]);_0x342c0b['length']>0x0&&(_0x4de63f=_0x342c0b[0x0]);}catch(_0xa71f62){console[_0x119450(0x1bf)]({'err':_0xa71f62}),_0x5d7714[_0x119450(0x198)](0x1f4)[_0x119450(0x1b0)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x4de63f){_0x5d7714[_0x119450(0x198)](0x191)[_0x119450(0x1b0)]({'error':_0x119450(0x1bc)});return;}let _0x4bde02=_0x4de63f[_0x119450(0x1c2)];if(!_0x4bde02){_0x4bde02=randomUUID();try{await conn[_0x119450(0x1b9)]()[_0x119450(0x197)](_0x119450(0x18c),[_0x4bde02,_0x4c01c9[_0x119450(0x1aa)][_0x119450(0x18e)]]);}catch(_0x34d85){console[_0x119450(0x1bf)]({'err':_0x34d85}),_0x5d7714[_0x119450(0x198)](0x1f4)[_0x119450(0x1b0)]({'error':_0x119450(0x19d)});return;}}const _0x1691ae=_0x119450(0x191)+_0x4bde02;!fs[_0x119450(0x1be)](_0x1691ae)&&fs[_0x119450(0x1bb)](_0x1691ae);if(!_0x5cb2a1){const _0x176429=new Error(_0x119450(0x1af));return _0x176429[_0x119450(0x1b2)]=0x190,_0x4af31d(_0x176429);}const _0x47b47b=fs[_0x119450(0x1bd)](_0x1691ae)['length']+_0x5cb2a1[_0x119450(0x1c0)];console[_0x119450(0x1bf)]({'numberOfSize':_0x47b47b});if(_0x47b47b>userFolderMaximumFiles)return _0x5d7714[_0x119450(0x198)](0x190)[_0x119450(0x1b0)]({'error':_0x119450(0x1a1)+userFolderMaximumFiles+_0x119450(0x18b)});const _0x362eab=fs[_0x119450(0x1bd)](_0x1691ae)['reduce']((_0x37fef0,_0x1ae149)=>_0x37fef0+fs[_0x119450(0x19a)](_0x1691ae+'/'+_0x1ae149)['size'],0x0),_0x16649c=_0x5cb2a1[_0x119450(0x195)]((_0x55574e,_0x461dc3)=>_0x55574e+_0x461dc3[_0x119450(0x18f)],0x0);console[_0x119450(0x1bf)]({'totalSize':_0x362eab,'uploadedSize':_0x16649c});if(_0x16649c+_0x362eab>userFolderMaximumSizeInMB*0x400*0x400)return _0x5d7714[_0x119450(0x198)](0x190)[_0x119450(0x1b0)]({'error':_0x119450(0x1a1)+userFolderMaximumSizeInMB+_0x119450(0x1ae)});_0x5cb2a1[_0x119450(0x1b3)](_0x218b6c=>{const _0x41d701=_0x119450;fs['renameSync'](_0x218b6c[_0x41d701(0x1a7)],_0x1691ae+'/'+_0x218b6c[_0x41d701(0x1b5)]);}),_0x5d7714[_0x119450(0x1a5)]({'files':_0x5cb2a1[_0x119450(0x1b7)](_0x46e25c=>({..._0x46e25c,'path':_0x1691ae+'/'+_0x46e25c[_0x119450(0x1b5)]}))});}),router[a8_0x245256(0x18d)](a8_0x245256(0x19f),verifyToken,async(_0x418df3,_0x38c170)=>{const _0x3c959c=a8_0x245256,{path:_0x1b53f1,folder_name:_0x5dd6cd}=_0x418df3['body'],_0x1d98e0=config[_0x3c959c(0x1a2)];console[_0x3c959c(0x1bf)]({'path':_0x1b53f1,'folder_name':_0x5dd6cd});if(!_0x1b53f1)return _0x38c170[_0x3c959c(0x198)](0x190)[_0x3c959c(0x1b0)]({'error':_0x3c959c(0x1ad)});if(!_0x5dd6cd)return _0x38c170[_0x3c959c(0x198)](0x190)[_0x3c959c(0x1b0)]({'error':'Folder\x20name\x20is\x20required'});const _0x121388=_0x1b53f1+'/'+_0x5dd6cd;!fs[_0x3c959c(0x1be)](_0x121388)&&fs['mkdirSync'](_0x121388),_0x38c170[_0x3c959c(0x1a5)]({'path':_0x121388});}),router[a8_0x245256(0x196)](a8_0x245256(0x1b4),verifyToken,async(_0x37bf24,_0x37e8b3)=>{const _0x4796d9=a8_0x245256,{isFolder:_0x15897f,path:_0x54ad73}=_0x37bf24[_0x4796d9(0x1b1)];!_0x15897f?fs[_0x4796d9(0x19c)](_0x54ad73):fs['rmdirSync'](_0x54ad73,{'recursive':!![]}),_0x37e8b3[_0x4796d9(0x1a5)]({'success':!![]});}),module[a8_0x245256(0x1a8)]=router;function a8_0x1ed5(){const _0x4d1715=['../libs/mysql.js','folder_name','\x20files','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','post','email','size','../libs/jwt','./uploads/','522408GCyZqE','1469655ZBntXJ','3639HpfaID','reduce','delete','execute','status','Router','statSync','express','unlinkSync','Error!\x20Something\x20went\x20wrong.','files','/folder','104comQVC','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','folderLocation','7841600ZjSRdR','./uploads','send','verifyToken','path','exports','renameSync','user','570612hsgIbW','/files','Path\x20is\x20required','\x20MB\x20of\x20files','Please\x20upload\x20a\x20file','json','body','httpStatusCode','forEach','/remove','originalname','31917BPhEWG','map','crypto','promise','1096686aHejfr','mkdirSync','Invalid\x20user','readdirSync','existsSync','log','length'];a8_0x1ed5=function(){return _0x4d1715;};return a8_0x1ed5();}