const a8_0x545f33=a8_0x350d;(function(_0x42a584,_0x3995eb){const _0x340795=a8_0x350d,_0x35b1d2=_0x42a584();while(!![]){try{const _0x50f6ec=-parseInt(_0x340795(0x99))/0x1+parseInt(_0x340795(0x73))/0x2*(parseInt(_0x340795(0xac))/0x3)+-parseInt(_0x340795(0x91))/0x4*(-parseInt(_0x340795(0x7a))/0x5)+parseInt(_0x340795(0x80))/0x6*(parseInt(_0x340795(0x86))/0x7)+parseInt(_0x340795(0x8b))/0x8+-parseInt(_0x340795(0x88))/0x9+-parseInt(_0x340795(0x9a))/0xa*(-parseInt(_0x340795(0x97))/0xb);if(_0x50f6ec===_0x3995eb)break;else _0x35b1d2['push'](_0x35b1d2['shift']());}catch(_0x848245){_0x35b1d2['push'](_0x35b1d2['shift']());}}}(a8_0x3831,0x93845));const multer=require(a8_0x545f33(0x92)),fs=require('fs'),{randomUUID}=require(a8_0x545f33(0x72)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require(a8_0x545f33(0x8c)),conn=require(a8_0x545f33(0x81)),verifyToken=require('../libs/jwt')[a8_0x545f33(0x7d)],dir=a8_0x545f33(0x9b);!fs[a8_0x545f33(0x8a)](dir)&&fs[a8_0x545f33(0x79)](dir);function a8_0x350d(_0x4f45b5,_0x3d656e){const _0x38317a=a8_0x3831();return a8_0x350d=function(_0x350d14,_0x35d190){_0x350d14=_0x350d14-0x72;let _0x18a1d6=_0x38317a[_0x350d14];return _0x18a1d6;},a8_0x350d(_0x4f45b5,_0x3d656e);}const express=require(a8_0x545f33(0x93)),router=express[a8_0x545f33(0x9f)](),config=require(a8_0x545f33(0x8c)),storage=multer[a8_0x545f33(0x8e)]({'destination':function(_0x5adc35,_0x2ec8dc,_0x492ce0){_0x492ce0(null,'uploads');}}),upload=multer({'storage':storage});router[a8_0x545f33(0xa7)](a8_0x545f33(0xab),upload[a8_0x545f33(0x85)](a8_0x545f33(0xa4)),verifyToken,async(_0x4841b4,_0x61a407,_0x402b70)=>{const _0x1b5364=a8_0x545f33,_0x5a8302=_0x4841b4[_0x1b5364(0xa4)],{global:_0x499c91,path:_0x1fc227}=_0x4841b4[_0x1b5364(0x7c)],_0x969894=config['folderLocation'];console[_0x1b5364(0x90)]({'global':_0x499c91}),console[_0x1b5364(0x90)](_0x5a8302),console[_0x1b5364(0x90)]({'user':_0x4841b4[_0x1b5364(0xa6)]});if(_0x499c91){_0x5a8302[_0x1b5364(0x84)](_0x544c1a=>{const _0x55c439=_0x1b5364;fs['copyFileSync'](_0x544c1a['path'],(_0x1fc227||_0x969894)+'/'+_0x544c1a[_0x55c439(0x95)]),fs[_0x55c439(0x78)](_0x544c1a[_0x55c439(0xa0)]);}),_0x61a407['send']({'files':_0x5a8302[_0x1b5364(0x83)](_0xa5eea=>({..._0xa5eea,'path':(_0x1fc227||_0x969894)+'/'+_0xa5eea[_0x1b5364(0x95)]}))});return;}let _0x515bee;try{const [_0x3b74e7]=await conn[_0x1b5364(0x75)]()['execute'](_0x1b5364(0x87),[_0x4841b4[_0x1b5364(0xa6)][_0x1b5364(0xa8)]]);_0x3b74e7[_0x1b5364(0x9c)]>0x0&&(_0x515bee=_0x3b74e7[0x0]);}catch(_0xb421af){console['log']({'err':_0xb421af}),_0x61a407['status'](0x1f4)['json']({'error':'Error!\x20Something\x20went\x20wrong.'});return;}if(!_0x515bee){_0x61a407[_0x1b5364(0x96)](0x191)[_0x1b5364(0x7e)]({'error':_0x1b5364(0x89)});return;}let _0x84bf85=_0x515bee['folder_name'];if(!_0x84bf85){_0x84bf85=randomUUID();try{await conn[_0x1b5364(0x75)]()['execute'](_0x1b5364(0x82),[_0x84bf85,_0x4841b4[_0x1b5364(0xa6)]['email']]);}catch(_0x4041b7){console[_0x1b5364(0x90)]({'err':_0x4041b7}),_0x61a407[_0x1b5364(0x96)](0x1f4)[_0x1b5364(0x7e)]({'error':'Error!\x20Something\x20went\x20wrong.'});return;}}const _0xfa4a7e=_0x1b5364(0x7b)+_0x84bf85;!fs['existsSync'](_0xfa4a7e)&&fs['mkdirSync'](_0xfa4a7e);if(!_0x5a8302){const _0x1ebf23=new Error(_0x1b5364(0xaa));return _0x1ebf23[_0x1b5364(0x9d)]=0x190,_0x402b70(_0x1ebf23);}const _0x34e868=fs[_0x1b5364(0x74)](_0xfa4a7e)[_0x1b5364(0x9c)]+_0x5a8302[_0x1b5364(0x9c)];console[_0x1b5364(0x90)]({'numberOfSize':_0x34e868});if(_0x34e868>userFolderMaximumFiles)return _0x61a407['status'](0x190)[_0x1b5364(0x7e)]({'error':_0x1b5364(0xa5)+userFolderMaximumFiles+_0x1b5364(0x8d)});const _0x1798ae=fs[_0x1b5364(0x74)](_0xfa4a7e)['reduce']((_0x4a479e,_0x1e44e9)=>_0x4a479e+fs[_0x1b5364(0xa9)](_0xfa4a7e+'/'+_0x1e44e9)[_0x1b5364(0x7f)],0x0),_0x22a822=_0x5a8302['reduce']((_0x2c4e5e,_0x4f1a29)=>_0x2c4e5e+_0x4f1a29[_0x1b5364(0x7f)],0x0);console['log']({'totalSize':_0x1798ae,'uploadedSize':_0x22a822});if(_0x22a822+_0x1798ae>userFolderMaximumSizeInMB*0x400*0x400)return _0x61a407[_0x1b5364(0x96)](0x190)['json']({'error':'You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20'+userFolderMaximumSizeInMB+_0x1b5364(0x94)});_0x5a8302[_0x1b5364(0x84)](_0x4cce3a=>{const _0x1e64db=_0x1b5364;fs[_0x1e64db(0x76)](_0x4cce3a['path'],_0xfa4a7e+'/'+_0x4cce3a['originalname']),fs[_0x1e64db(0x78)](_0x4cce3a[_0x1e64db(0xa0)]);}),_0x61a407[_0x1b5364(0x98)]({'files':_0x5a8302[_0x1b5364(0x83)](_0x2f1e24=>({..._0x2f1e24,'path':_0xfa4a7e+'/'+_0x2f1e24['originalname']}))});}),router['post'](a8_0x545f33(0x9e),verifyToken,async(_0x440489,_0x2c9f86)=>{const _0x302c51=a8_0x545f33,{path:_0x3b5626,folder_name:_0x3ca802}=_0x440489[_0x302c51(0x7c)];console[_0x302c51(0x90)]({'path':_0x3b5626,'folder_name':_0x3ca802});if(!_0x3b5626)return _0x2c9f86[_0x302c51(0x96)](0x190)[_0x302c51(0x7e)]({'error':_0x302c51(0xa2)});if(!_0x3ca802)return _0x2c9f86[_0x302c51(0x96)](0x190)[_0x302c51(0x7e)]({'error':'Folder\x20name\x20is\x20required'});const _0x33ae2a=_0x3b5626+'/'+_0x3ca802;!fs[_0x302c51(0x8a)](_0x33ae2a)&&fs[_0x302c51(0x79)](_0x33ae2a),_0x2c9f86['send']({'path':_0x33ae2a});}),router[a8_0x545f33(0xa1)](a8_0x545f33(0x77),verifyToken,async(_0x457c8c,_0x2f0c14)=>{const _0x439fdc=a8_0x545f33,{isFolder:_0x1f38fe,path:_0x1aa953}=_0x457c8c[_0x439fdc(0x7c)];!_0x1f38fe?fs[_0x439fdc(0x78)](_0x1aa953):fs[_0x439fdc(0xa3)](_0x1aa953,{'recursive':!![]}),_0x2f0c14[_0x439fdc(0x98)]({'success':!![]});}),module[a8_0x545f33(0x8f)]=router;function a8_0x3831(){const _0x454a81=['Invalid\x20user','existsSync','3837552WYlYHG','../CADViewer_config.json','\x20files','diskStorage','exports','log','1272972wQvKsZ','multer','express','\x20MB\x20of\x20files','originalname','status','220erBycr','send','750769GAMdGD','89510qYzoBr','./uploads','length','httpStatusCode','/folder','Router','path','delete','Path\x20is\x20required','rmdirSync','files','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','user','post','email','statSync','Please\x20upload\x20a\x20file','/files','9eQnFrm','crypto','21442NrBsYh','readdirSync','promise','copyFileSync','/remove','unlinkSync','mkdirSync','15irxewv','./uploads/','body','verifyToken','json','size','3305388bZTnew','../libs/mysql.js','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','map','forEach','array','7uANEIa','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','7573554jNiKHA'];a8_0x3831=function(){return _0x454a81;};return a8_0x3831();}