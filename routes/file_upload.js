const a8_0x43b9e2=a8_0x14da;(function(_0x4775d1,_0xcb4719){const _0x200346=a8_0x14da,_0x205987=_0x4775d1();while(!![]){try{const _0x3aeffd=-parseInt(_0x200346(0x116))/0x1+parseInt(_0x200346(0xf8))/0x2+-parseInt(_0x200346(0xf1))/0x3*(parseInt(_0x200346(0x107))/0x4)+-parseInt(_0x200346(0xf0))/0x5+parseInt(_0x200346(0x114))/0x6*(-parseInt(_0x200346(0x100))/0x7)+-parseInt(_0x200346(0xeb))/0x8+-parseInt(_0x200346(0xdb))/0x9*(-parseInt(_0x200346(0x10d))/0xa);if(_0x3aeffd===_0xcb4719)break;else _0x205987['push'](_0x205987['shift']());}catch(_0xea9f58){_0x205987['push'](_0x205987['shift']());}}}(a8_0x4702,0x7ae5b));const multer=require(a8_0x43b9e2(0xdc)),fs=require('fs'),{randomUUID}=require(a8_0x43b9e2(0x10b)),{userFolderMaximumFiles,userFolderMaximumSizeInMB}=require('../CADViewer_config.json'),conn=require(a8_0x43b9e2(0xf9)),verifyToken=require(a8_0x43b9e2(0x115))[a8_0x43b9e2(0xfb)],dir=a8_0x43b9e2(0xe4);function a8_0x14da(_0x8e9f09,_0x5f2c88){const _0x4702f0=a8_0x4702();return a8_0x14da=function(_0x14da83,_0x104980){_0x14da83=_0x14da83-0xda;let _0x5bb407=_0x4702f0[_0x14da83];return _0x5bb407;},a8_0x14da(_0x8e9f09,_0x5f2c88);}!fs[a8_0x43b9e2(0xf4)](dir)&&fs[a8_0x43b9e2(0x10e)](dir);const express=require('express'),router=express[a8_0x43b9e2(0xfa)](),config=require(a8_0x43b9e2(0xe6)),storage=multer[a8_0x43b9e2(0xff)]({'destination':function(_0x1d8ce5,_0x41c8dc,_0x5a79f5){const _0x10d7ec=a8_0x43b9e2;_0x5a79f5(null,_0x10d7ec(0xf5));}}),upload=multer({'storage':storage});function a8_0x4702(){const _0x593b36=['23082129pUqRtO','multer','exports','path','map','originalname','user','httpStatusCode','copyFileSync','./uploads','SELECT\x20*\x20FROM\x20`users`\x20WHERE\x20`email`\x20=\x20?','../CADViewer_config.json','size','rmdirSync','\x20files','json','1942264hvVAIl','Invalid\x20user','You\x20can\x20only\x20upload\x20a\x20maximum\x20of\x20','/files','/folder','2941920TkHzoi','130482hijkJk','Please\x20upload\x20a\x20file','length','existsSync','uploads','send','readdirSync','86660ItRZAy','../libs/mysql.js','Router','verifyToken','Path\x20is\x20required','\x20MB\x20of\x20files','status','diskStorage','7bKIIri','execute','./uploads/','post','UPDATE\x20`users`\x20SET\x20`folder_name`\x20=\x20?\x20WHERE\x20`email`\x20=\x20?','/remove','statSync','76YTMoLj','forEach','unlinkSync','email','crypto','files','10ljePRG','mkdirSync','reduce','folder_name','folderLocation','Error!\x20Something\x20went\x20wrong.','log','888150qkXaIj','../libs/jwt','299046VwtijX','body','promise'];a8_0x4702=function(){return _0x593b36;};return a8_0x4702();}router[a8_0x43b9e2(0x103)](a8_0x43b9e2(0xee),upload['array'](a8_0x43b9e2(0x10c)),verifyToken,async(_0x468c88,_0x50b264,_0x52ac29)=>{const _0x51f963=a8_0x43b9e2,_0x16e6bf=_0x468c88['files'],{global:_0x55cc5d,path:_0x50add2}=_0x468c88[_0x51f963(0x117)],_0x192b13=config[_0x51f963(0x111)];console['log']({'global':_0x55cc5d}),console[_0x51f963(0x113)](_0x16e6bf),console[_0x51f963(0x113)]({'user':_0x468c88[_0x51f963(0xe1)]});if(_0x55cc5d){_0x16e6bf['forEach'](_0x3c0389=>{const _0x2eee4f=_0x51f963;fs['copyFileSync'](_0x3c0389[_0x2eee4f(0xde)],(_0x50add2||_0x192b13)+'/'+_0x3c0389['originalname']),fs[_0x2eee4f(0x109)](_0x3c0389[_0x2eee4f(0xde)]);}),_0x50b264[_0x51f963(0xf6)]({'files':_0x16e6bf[_0x51f963(0xdf)](_0x386ff8=>({..._0x386ff8,'path':(_0x50add2||_0x192b13)+'/'+_0x386ff8['originalname']}))});return;}let _0x28fbca;try{const [_0x444ef2]=await conn[_0x51f963(0xda)]()[_0x51f963(0x101)](_0x51f963(0xe5),[_0x468c88[_0x51f963(0xe1)]['email']]);_0x444ef2[_0x51f963(0xf3)]>0x0&&(_0x28fbca=_0x444ef2[0x0]);}catch(_0x24b130){console[_0x51f963(0x113)]({'err':_0x24b130}),_0x50b264[_0x51f963(0xfe)](0x1f4)[_0x51f963(0xea)]({'error':_0x51f963(0x112)});return;}if(!_0x28fbca){_0x50b264['status'](0x191)['json']({'error':_0x51f963(0xec)});return;}let _0x2fe938=_0x28fbca[_0x51f963(0x110)];if(!_0x2fe938){_0x2fe938=randomUUID();try{await conn[_0x51f963(0xda)]()[_0x51f963(0x101)](_0x51f963(0x104),[_0x2fe938,_0x468c88[_0x51f963(0xe1)][_0x51f963(0x10a)]]);}catch(_0x81b0a3){console[_0x51f963(0x113)]({'err':_0x81b0a3}),_0x50b264[_0x51f963(0xfe)](0x1f4)[_0x51f963(0xea)]({'error':_0x51f963(0x112)});return;}}const _0x5e7e2a=_0x51f963(0x102)+_0x2fe938;!fs[_0x51f963(0xf4)](_0x5e7e2a)&&fs[_0x51f963(0x10e)](_0x5e7e2a);if(!_0x16e6bf){const _0x353d00=new Error(_0x51f963(0xf2));return _0x353d00[_0x51f963(0xe2)]=0x190,_0x52ac29(_0x353d00);}const _0xc4ddab=fs['readdirSync'](_0x5e7e2a)[_0x51f963(0xf3)]+_0x16e6bf[_0x51f963(0xf3)];console[_0x51f963(0x113)]({'numberOfSize':_0xc4ddab});if(_0xc4ddab>userFolderMaximumFiles)return _0x50b264[_0x51f963(0xfe)](0x190)[_0x51f963(0xea)]({'error':_0x51f963(0xed)+userFolderMaximumFiles+_0x51f963(0xe9)});const _0x4ad23e=fs[_0x51f963(0xf7)](_0x5e7e2a)[_0x51f963(0x10f)]((_0x56ead7,_0x2fb3b3)=>_0x56ead7+fs[_0x51f963(0x106)](_0x5e7e2a+'/'+_0x2fb3b3)[_0x51f963(0xe7)],0x0),_0x4ae656=_0x16e6bf['reduce']((_0x4b346e,_0x39fcd2)=>_0x4b346e+_0x39fcd2[_0x51f963(0xe7)],0x0);console[_0x51f963(0x113)]({'totalSize':_0x4ad23e,'uploadedSize':_0x4ae656});if(_0x4ae656+_0x4ad23e>userFolderMaximumSizeInMB*0x400*0x400)return _0x50b264['status'](0x190)['json']({'error':_0x51f963(0xed)+userFolderMaximumSizeInMB+_0x51f963(0xfd)});_0x16e6bf[_0x51f963(0x108)](_0x6b4caf=>{const _0x5a6cb7=_0x51f963;fs[_0x5a6cb7(0xe3)](_0x6b4caf[_0x5a6cb7(0xde)],_0x5e7e2a+'/'+_0x6b4caf[_0x5a6cb7(0xe0)]),fs[_0x5a6cb7(0x109)](_0x6b4caf[_0x5a6cb7(0xde)]);}),_0x50b264[_0x51f963(0xf6)]({'files':_0x16e6bf[_0x51f963(0xdf)](_0x2eb156=>({..._0x2eb156,'path':_0x5e7e2a+'/'+_0x2eb156[_0x51f963(0xe0)]}))});}),router[a8_0x43b9e2(0x103)](a8_0x43b9e2(0xef),verifyToken,async(_0x179225,_0x2be314)=>{const _0x283c4b=a8_0x43b9e2,{path:_0x3ba0e0,folder_name:_0x174d82}=_0x179225['body'];console['log']({'path':_0x3ba0e0,'folder_name':_0x174d82});if(!_0x3ba0e0)return _0x2be314[_0x283c4b(0xfe)](0x190)[_0x283c4b(0xea)]({'error':_0x283c4b(0xfc)});if(!_0x174d82)return _0x2be314[_0x283c4b(0xfe)](0x190)[_0x283c4b(0xea)]({'error':'Folder\x20name\x20is\x20required'});const _0x9fb08d=_0x3ba0e0+'/'+_0x174d82;!fs[_0x283c4b(0xf4)](_0x9fb08d)&&fs[_0x283c4b(0x10e)](_0x9fb08d),_0x2be314[_0x283c4b(0xf6)]({'path':_0x9fb08d});}),router['delete'](a8_0x43b9e2(0x105),verifyToken,async(_0x365c6d,_0x332a9c)=>{const _0x5e9031=a8_0x43b9e2,{isFolder:_0x3fb506,path:_0x3e4219}=_0x365c6d[_0x5e9031(0x117)];!_0x3fb506?fs[_0x5e9031(0x109)](_0x3e4219):fs[_0x5e9031(0xe8)](_0x3e4219,{'recursive':!![]}),_0x332a9c[_0x5e9031(0xf6)]({'success':!![]});}),module[a8_0x43b9e2(0xdd)]=router;