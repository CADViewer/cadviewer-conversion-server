const a1_0x5cf062=a1_0x27c1;function a1_0x27c1(_0x17b7f0,_0x1e55af){const _0x280af8=a1_0x280a();return a1_0x27c1=function(_0x27c1c1,_0x389e73){_0x27c1c1=_0x27c1c1-0x1f0;let _0x57e804=_0x280af8[_0x27c1c1];return _0x57e804;},a1_0x27c1(_0x17b7f0,_0x1e55af);}(function(_0x3792e9,_0x5b5ea4){const _0x5ccd33=a1_0x27c1,_0x1e9fb3=_0x3792e9();while(!![]){try{const _0x5999b9=parseInt(_0x5ccd33(0x1f2))/0x1+parseInt(_0x5ccd33(0x201))/0x2+parseInt(_0x5ccd33(0x1ff))/0x3*(parseInt(_0x5ccd33(0x213))/0x4)+parseInt(_0x5ccd33(0x22c))/0x5+parseInt(_0x5ccd33(0x20d))/0x6+-parseInt(_0x5ccd33(0x1f4))/0x7*(parseInt(_0x5ccd33(0x215))/0x8)+-parseInt(_0x5ccd33(0x21d))/0x9*(parseInt(_0x5ccd33(0x210))/0xa);if(_0x5999b9===_0x5b5ea4)break;else _0x1e9fb3['push'](_0x1e9fb3['shift']());}catch(_0x32ccfd){_0x1e9fb3['push'](_0x1e9fb3['shift']());}}}(a1_0x280a,0x5176d));const fs=require('fs')[a1_0x5cf062(0x1f9)],osu=require(a1_0x5cf062(0x22d));class RequestMonitor{static [a1_0x5cf062(0x207)]=a1_0x5cf062(0x232);static ['httpCodesStoragePath']='cadviewer/settings/http-codes-24h.json';static [a1_0x5cf062(0x227)]='cadviewer/settings/ressources-usage-stats.json';static [a1_0x5cf062(0x226)]=[];static [a1_0x5cf062(0x205)]=[];static [a1_0x5cf062(0x228)]={};static [a1_0x5cf062(0x221)]=Math[a1_0x5cf062(0x223)](Date[a1_0x5cf062(0x230)]()/0x3e8/0x3c);static [a1_0x5cf062(0x222)]=0x0;static async['init'](){const _0x4416f0=a1_0x5cf062;console[_0x4416f0(0x239)](_0x4416f0(0x211));try{const _0x3e477a=await fs[_0x4416f0(0x209)](RequestMonitor[_0x4416f0(0x207)],_0x4416f0(0x220));RequestMonitor[_0x4416f0(0x226)]=JSON['parse'](_0x3e477a);}catch(_0x552485){RequestMonitor['rpsData']=[];}try{const _0x1954fd=await fs[_0x4416f0(0x209)](RequestMonitor[_0x4416f0(0x217)],_0x4416f0(0x220));RequestMonitor['httpCodesData']=JSON[_0x4416f0(0x1fe)](_0x1954fd);}catch(_0x564eb5){RequestMonitor[_0x4416f0(0x205)]=[];}try{const _0xa596bb=await fs[_0x4416f0(0x209)](RequestMonitor[_0x4416f0(0x227)],'utf8');RequestMonitor[_0x4416f0(0x228)]=JSON['parse'](_0xa596bb),!RequestMonitor[_0x4416f0(0x228)]['cpu']&&(RequestMonitor[_0x4416f0(0x228)][_0x4416f0(0x200)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x4416f0(0x20f)]&&(RequestMonitor[_0x4416f0(0x228)][_0x4416f0(0x20f)]=[]),!RequestMonitor[_0x4416f0(0x228)][_0x4416f0(0x219)]&&(RequestMonitor[_0x4416f0(0x228)][_0x4416f0(0x219)]=[]);}catch(_0xcf993){RequestMonitor[_0x4416f0(0x228)]={'cpu':[],'memory':[],'network':[]};}console['log']('Request\x20monitor\x20initialized.');}static[a1_0x5cf062(0x21f)](_0x60a006,_0x184e29,_0x33490d){const _0x21278a=a1_0x5cf062;if(_0x60a006['path'][_0x21278a(0x204)](_0x21278a(0x225)))return _0x33490d();console[_0x21278a(0x239)](_0x21278a(0x20a));let _0x146714=Date[_0x21278a(0x230)](),_0x34885d=Math['floor'](_0x146714/0x3e8/0x3c);console[_0x21278a(0x239)]('=======>');const _0x512b4c=_0x184e29[_0x21278a(0x1f3)];_0x184e29['end']=(..._0xd82454)=>{const _0x263c60=_0x21278a;console['log'](_0x34885d,{'currentMinute':_0x34885d});_0x34885d>RequestMonitor[_0x263c60(0x221)]&&(RequestMonitor[_0x263c60(0x226)][_0x263c60(0x231)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x263c60(0x222)]}),RequestMonitor[_0x263c60(0x222)]=0x0,RequestMonitor[_0x263c60(0x221)]=_0x34885d);RequestMonitor[_0x263c60(0x222)]++,RequestMonitor['httpCodesData'][_0x263c60(0x231)]({'timestamp':Date[_0x263c60(0x230)](),'statusCode':_0x184e29[_0x263c60(0x218)],'path':_0x60a006[_0x263c60(0x1fa)],'method':_0x60a006['method']});const _0x2beb4b=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x263c60(0x205)]=RequestMonitor[_0x263c60(0x205)][_0x263c60(0x238)](_0x20205c=>_0x20205c[_0x263c60(0x216)]>_0x2beb4b),_0x512b4c[_0x263c60(0x1f6)](_0x184e29,_0xd82454);},_0x33490d();}static async[a1_0x5cf062(0x1fd)](){const _0x27fd4c=a1_0x5cf062;try{RequestMonitor['lastMinute']!==Math[_0x27fd4c(0x223)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x27fd4c(0x226)][_0x27fd4c(0x231)]({'timestamp':RequestMonitor[_0x27fd4c(0x221)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x27fd4c(0x222)]=0x0,RequestMonitor[_0x27fd4c(0x221)]=Math[_0x27fd4c(0x223)](Date[_0x27fd4c(0x230)]()/0x3e8/0x3c)),await fs[_0x27fd4c(0x21e)](RequestMonitor[_0x27fd4c(0x207)],JSON[_0x27fd4c(0x236)](RequestMonitor[_0x27fd4c(0x226)],null,0x2)),await fs['writeFile'](RequestMonitor[_0x27fd4c(0x217)],JSON[_0x27fd4c(0x236)](RequestMonitor[_0x27fd4c(0x205)],null,0x2));}catch(_0x56966e){console['error'](_0x27fd4c(0x235),_0x56966e);}}static async[a1_0x5cf062(0x212)](){const _0x45f28b=a1_0x5cf062;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x21b4c7=a1_0x27c1;RequestMonitor[_0x21b4c7(0x237)]()[_0x21b4c7(0x202)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x45f28b(0x237)]()[_0x45f28b(0x202)](()=>{});}static async[a1_0x5cf062(0x237)](){const _0x42858d=a1_0x5cf062,_0x5b0322=osu[_0x42858d(0x200)],_0x25ae70=osu[_0x42858d(0x22a)],_0x24be77=osu[_0x42858d(0x214)],_0x2fd2be={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x231151=await _0x24be77[_0x42858d(0x224)]();_0x2fd2be[_0x42858d(0x234)][_0x42858d(0x20e)]=_0x231151['total'][_0x42858d(0x20e)],_0x2fd2be[_0x42858d(0x234)][_0x42858d(0x1f0)]=_0x231151[_0x42858d(0x234)][_0x42858d(0x1f0)];}catch(_0x3ef2ba){}let _0x28aa8a=0x0;try{_0x28aa8a=await _0x5b0322[_0x42858d(0x1fb)]();}catch(_0x1ec79e){console[_0x42858d(0x239)](_0x42858d(0x22b),_0x1ec79e);}const _0x19f13e={'usedMemMb':0x0};try{const _0x3fe180=await _0x25ae70[_0x42858d(0x229)]();_0x19f13e['usedMemMb']=_0x3fe180[_0x42858d(0x1f1)];}catch(_0x4180f0){console['log'](_0x42858d(0x21b),_0x4180f0);}const _0x250e24=new Date()[_0x42858d(0x1f5)]()[_0x42858d(0x21c)]()['padStart'](0x2,'0')+':'+new Date()[_0x42858d(0x22f)]()[_0x42858d(0x21c)]()[_0x42858d(0x1fc)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x42858d(0x200)]=RequestMonitor['ressourcesUsageStats']['cpu'][_0x42858d(0x203)](-0x3c)[_0x42858d(0x238)](_0x338e14=>_0x338e14['time']!==_0x250e24),RequestMonitor['ressourcesUsageStats'][_0x42858d(0x20f)]=RequestMonitor[_0x42858d(0x228)]['memory'][_0x42858d(0x203)](-0x3c)[_0x42858d(0x238)](_0x16be4f=>_0x16be4f[_0x42858d(0x1f8)]!==_0x250e24),RequestMonitor[_0x42858d(0x228)][_0x42858d(0x219)]=RequestMonitor[_0x42858d(0x228)][_0x42858d(0x219)][_0x42858d(0x203)](-0x3c)[_0x42858d(0x238)](_0x488155=>_0x488155[_0x42858d(0x1f8)]!==_0x250e24),RequestMonitor[_0x42858d(0x228)][_0x42858d(0x200)][_0x42858d(0x231)]({'time':_0x250e24,'usage':_0x28aa8a}),RequestMonitor['ressourcesUsageStats']['memory'][_0x42858d(0x231)]({'time':_0x250e24,'usage':(_0x19f13e[_0x42858d(0x1f1)]/0x3e8)[_0x42858d(0x1f7)](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x42858d(0x219)][_0x42858d(0x231)]({'time':_0x250e24,'usage':{'in':_0x2fd2be['total']?.[_0x42858d(0x20e)]??0x0,'out':_0x2fd2be[_0x42858d(0x234)]?.[_0x42858d(0x1f0)]??0x0}});try{await fs['writeFile'](RequestMonitor['ressourcesUsageStatsPath'],JSON[_0x42858d(0x236)](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x4cf7e8){console['error'](_0x42858d(0x235),_0x4cf7e8);}}static[a1_0x5cf062(0x233)](){const _0x1008ad=a1_0x5cf062,_0x4c35e3=Date[_0x1008ad(0x230)](),_0x327909=_0x4c35e3-0x3c*0x3c*0x3e8,_0x21e8ef=_0x4c35e3-0x18*0x3c*0x3c*0x3e8,_0x38870a=RequestMonitor[_0x1008ad(0x226)][_0x1008ad(0x238)](_0x4ca2c8=>_0x4ca2c8['timestamp']>_0x327909),_0x1f92e5={'total':RequestMonitor[_0x1008ad(0x205)]['length'],'byCodes':{},'byPath':{}};return RequestMonitor[_0x1008ad(0x205)][_0x1008ad(0x208)](_0xf82795=>{const _0x1750a9=_0x1008ad;_0x1f92e5[_0x1750a9(0x22e)][_0xf82795[_0x1750a9(0x218)]]=(_0x1f92e5[_0x1750a9(0x22e)][_0xf82795[_0x1750a9(0x218)]]||0x0)+0x1;const _0x4fa0a5=_0xf82795[_0x1750a9(0x20c)]+'\x20'+_0xf82795[_0x1750a9(0x1fa)];!_0x1f92e5[_0x1750a9(0x21a)][_0x4fa0a5]&&(_0x1f92e5[_0x1750a9(0x21a)][_0x4fa0a5]={'total':0x0,'codes':{}}),_0x1f92e5[_0x1750a9(0x21a)][_0x4fa0a5][_0x1750a9(0x234)]++,_0x1f92e5['byPath'][_0x4fa0a5][_0x1750a9(0x20b)][_0xf82795['statusCode']]=(_0x1f92e5[_0x1750a9(0x21a)][_0x4fa0a5][_0x1750a9(0x20b)][_0xf82795[_0x1750a9(0x218)]]||0x0)+0x1;}),{'rps':_0x38870a,'httpCodes':_0x1f92e5,'ressourcesUsageStats':RequestMonitor[_0x1008ad(0x228)]};}}RequestMonitor[a1_0x5cf062(0x206)]()[a1_0x5cf062(0x202)](()=>{}),RequestMonitor[a1_0x5cf062(0x212)]();function a1_0x280a(){const _0x5a3c53=['cadviewer/settings/requests-per-minute.json','getStats','total','Error\x20saving\x20monitoring\x20data:','stringify','getUsageRessourcesStatsAndSave','filter','log','outputMb','usedMemMb','478537iIYEFz','end','396403luoqBp','getHours','apply','toFixed','time','promises','path','usage','padStart','save','parse','30iuePiN','cpu','236978KLBXmN','then','slice','includes','httpCodesData','init','rpsStoragePath','forEach','readFile','Request\x20monitor\x20middleware','codes','method','655908GEOwvi','inputMb','memory','10744660tvoiVg','Initializing\x20request\x20monitor...','startPeriodicSave','233476CmBkZl','netstat','40MxpiDt','timestamp','httpCodesStoragePath','statusCode','network','byPath','Error\x20getting\x20memory\x20usage:','toString','9hEWzDj','writeFile','middleware','utf8','lastMinute','currentRequests','floor','inOut','/metrics','rpsData','ressourcesUsageStatsPath','ressourcesUsageStats','info','mem','Error\x20getting\x20CPU\x20usage:','2006270ZzPjFG','node-os-utils','byCodes','getMinutes','now','push'];a1_0x280a=function(){return _0x5a3c53;};return a1_0x280a();}const counter=RequestMonitor;module['exports']=counter;