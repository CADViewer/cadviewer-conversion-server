const a1_0x143684=a1_0x20f5;(function(_0x58c2c1,_0x3373ab){const _0x18fe34=a1_0x20f5,_0x20105f=_0x58c2c1();while(!![]){try{const _0x553d01=parseInt(_0x18fe34(0x1e1))/0x1*(-parseInt(_0x18fe34(0x1d4))/0x2)+-parseInt(_0x18fe34(0x1de))/0x3+parseInt(_0x18fe34(0x1e0))/0x4+-parseInt(_0x18fe34(0x1e4))/0x5*(parseInt(_0x18fe34(0x1d6))/0x6)+-parseInt(_0x18fe34(0x1c9))/0x7+parseInt(_0x18fe34(0x1fa))/0x8+parseInt(_0x18fe34(0x1ed))/0x9*(parseInt(_0x18fe34(0x1ce))/0xa);if(_0x553d01===_0x3373ab)break;else _0x20105f['push'](_0x20105f['shift']());}catch(_0x10de04){_0x20105f['push'](_0x20105f['shift']());}}}(a1_0x4626,0xa251a));const fs=require('fs')[a1_0x143684(0x1b8)],osu=require(a1_0x143684(0x1bf));class RequestMonitor{static [a1_0x143684(0x1b6)]=a1_0x143684(0x1e9);static [a1_0x143684(0x1c1)]=a1_0x143684(0x1c4);static [a1_0x143684(0x1ec)]=a1_0x143684(0x1c8);static [a1_0x143684(0x1dd)]=[];static [a1_0x143684(0x1f1)]=[];static [a1_0x143684(0x1d7)]={};static [a1_0x143684(0x1fb)]=Math['floor'](Date['now']()/0x3e8/0x3c);static [a1_0x143684(0x1f4)]=0x0;static async[a1_0x143684(0x1b5)](){const _0x172110=a1_0x143684;console[_0x172110(0x1b7)](_0x172110(0x1bd));try{const _0x22c899=await fs[_0x172110(0x1ea)](RequestMonitor[_0x172110(0x1b6)],_0x172110(0x1f5));RequestMonitor[_0x172110(0x1dd)]=JSON['parse'](_0x22c899);}catch(_0x3f5d71){RequestMonitor['rpsData']=[];}try{const _0x471991=await fs['readFile'](RequestMonitor['httpCodesStoragePath'],_0x172110(0x1f5));RequestMonitor['httpCodesData']=JSON[_0x172110(0x1e2)](_0x471991);}catch(_0x5a41e1){RequestMonitor['httpCodesData']=[];}try{const _0x5a5b39=await fs[_0x172110(0x1ea)](RequestMonitor[_0x172110(0x1ec)],_0x172110(0x1f5));RequestMonitor[_0x172110(0x1d7)]=JSON[_0x172110(0x1e2)](_0x5a5b39),!RequestMonitor['ressourcesUsageStats'][_0x172110(0x1ee)]&&(RequestMonitor['ressourcesUsageStats'][_0x172110(0x1ee)]=[]),!RequestMonitor[_0x172110(0x1d7)][_0x172110(0x1c7)]&&(RequestMonitor[_0x172110(0x1d7)]['memory']=[]),!RequestMonitor[_0x172110(0x1d7)][_0x172110(0x1d3)]&&(RequestMonitor[_0x172110(0x1d7)][_0x172110(0x1d3)]=[]);}catch(_0xbdad70){RequestMonitor[_0x172110(0x1d7)]={'cpu':[],'memory':[],'network':[]};}console[_0x172110(0x1b7)]('Request\x20monitor\x20initialized.');}static[a1_0x143684(0x1d1)](_0x52b7a0,_0x4d7255,_0x9c83d2){const _0x4acb6f=a1_0x143684;if(_0x52b7a0[_0x4acb6f(0x1fc)]['includes'](_0x4acb6f(0x1e7)))return _0x9c83d2();console[_0x4acb6f(0x1b7)](_0x4acb6f(0x1d5));let _0x11e037=Date['now'](),_0x30d7d8=Math[_0x4acb6f(0x1c6)](_0x11e037/0x3e8/0x3c);console[_0x4acb6f(0x1b7)](_0x4acb6f(0x1f9));const _0x518f76=_0x4d7255[_0x4acb6f(0x1be)];_0x4d7255[_0x4acb6f(0x1be)]=(..._0x10c8ac)=>{const _0x1bef90=_0x4acb6f;console[_0x1bef90(0x1b7)](_0x30d7d8,{'currentMinute':_0x30d7d8});_0x30d7d8>RequestMonitor[_0x1bef90(0x1fb)]&&(RequestMonitor['rpsData'][_0x1bef90(0x1d8)]({'timestamp':RequestMonitor[_0x1bef90(0x1fb)]*0x3e8*0x3c,'requests':RequestMonitor[_0x1bef90(0x1f4)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor['lastMinute']=_0x30d7d8);RequestMonitor[_0x1bef90(0x1f4)]++,RequestMonitor[_0x1bef90(0x1f1)][_0x1bef90(0x1d8)]({'timestamp':Date[_0x1bef90(0x1c2)](),'statusCode':_0x4d7255[_0x1bef90(0x1e3)],'path':_0x52b7a0[_0x1bef90(0x1fc)],'method':_0x52b7a0[_0x1bef90(0x1f3)]});const _0x40e72d=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x1bef90(0x1f1)]=RequestMonitor[_0x1bef90(0x1f1)][_0x1bef90(0x1ef)](_0x12fa8f=>_0x12fa8f['timestamp']>_0x40e72d),_0x518f76['apply'](_0x4d7255,_0x10c8ac);},_0x9c83d2();}static async[a1_0x143684(0x1db)](){const _0x386bda=a1_0x143684;try{RequestMonitor[_0x386bda(0x1fb)]!==Math['floor'](Date[_0x386bda(0x1c2)]()/0x3e8/0x3c)&&(RequestMonitor[_0x386bda(0x1dd)]['push']({'timestamp':RequestMonitor[_0x386bda(0x1fb)]*0x3e8*0x3c,'requests':RequestMonitor[_0x386bda(0x1f4)]}),RequestMonitor[_0x386bda(0x1f4)]=0x0,RequestMonitor[_0x386bda(0x1fb)]=Math[_0x386bda(0x1c6)](Date['now']()/0x3e8/0x3c)),await fs['writeFile'](RequestMonitor[_0x386bda(0x1b6)],JSON[_0x386bda(0x1d0)](RequestMonitor['rpsData'],null,0x2)),await fs[_0x386bda(0x1f6)](RequestMonitor[_0x386bda(0x1c1)],JSON[_0x386bda(0x1d0)](RequestMonitor[_0x386bda(0x1f1)],null,0x2));}catch(_0x85456e){console[_0x386bda(0x1b9)](_0x386bda(0x1bb),_0x85456e);}}static async['startPeriodicSave'](){const _0x3cbe07=a1_0x143684;setInterval(()=>RequestMonitor[_0x3cbe07(0x1db)](),0x3c*0x3e8),setInterval(()=>{const _0x41dd0d=_0x3cbe07;RequestMonitor[_0x41dd0d(0x1f8)]()['then'](()=>{});},0x3c*0x3e8),RequestMonitor[_0x3cbe07(0x1f8)]()[_0x3cbe07(0x1d9)](()=>{});}static async[a1_0x143684(0x1f8)](){const _0x1a3239=a1_0x143684,_0x27fbd9=osu['cpu'],_0x3d1181=osu[_0x1a3239(0x1bc)],_0x24aed2=osu['netstat'],_0x46afc8={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x2d0e01=await _0x24aed2[_0x1a3239(0x1dc)]();_0x46afc8[_0x1a3239(0x1c5)][_0x1a3239(0x1cd)]=_0x2d0e01['total'][_0x1a3239(0x1cd)],_0x46afc8[_0x1a3239(0x1c5)][_0x1a3239(0x1e5)]=_0x2d0e01[_0x1a3239(0x1c5)][_0x1a3239(0x1e5)];}catch(_0x405c11){}let _0x158a95=0x0;try{_0x158a95=await _0x27fbd9[_0x1a3239(0x1cb)]();}catch(_0x27bd52){console[_0x1a3239(0x1b7)]('Error\x20getting\x20CPU\x20usage:',_0x27bd52);}const _0x19ecf9={'usedMemMb':0x0};try{const _0x42f4cf=await _0x3d1181[_0x1a3239(0x1da)]();_0x19ecf9[_0x1a3239(0x1df)]=_0x42f4cf[_0x1a3239(0x1df)];}catch(_0x335a2e){console['log'](_0x1a3239(0x1e8),_0x335a2e);}const _0x2728d3=new Date()[_0x1a3239(0x1f2)]()['toString']()['padStart'](0x2,'0')+':'+new Date()[_0x1a3239(0x1d2)]()['toString']()['padStart'](0x2,'0');RequestMonitor[_0x1a3239(0x1d7)]['cpu']=RequestMonitor['ressourcesUsageStats'][_0x1a3239(0x1ee)]['slice'](-0x3c)[_0x1a3239(0x1ef)](_0x59e4fe=>_0x59e4fe['time']!==_0x2728d3),RequestMonitor[_0x1a3239(0x1d7)][_0x1a3239(0x1c7)]=RequestMonitor[_0x1a3239(0x1d7)][_0x1a3239(0x1c7)][_0x1a3239(0x1cf)](-0x3c)[_0x1a3239(0x1ef)](_0x11e366=>_0x11e366[_0x1a3239(0x1f7)]!==_0x2728d3),RequestMonitor[_0x1a3239(0x1d7)][_0x1a3239(0x1d3)]=RequestMonitor[_0x1a3239(0x1d7)]['network'][_0x1a3239(0x1cf)](-0x3c)[_0x1a3239(0x1ef)](_0x4d700f=>_0x4d700f[_0x1a3239(0x1f7)]!==_0x2728d3),RequestMonitor['ressourcesUsageStats'][_0x1a3239(0x1ee)][_0x1a3239(0x1d8)]({'time':_0x2728d3,'usage':_0x158a95}),RequestMonitor['ressourcesUsageStats'][_0x1a3239(0x1c7)][_0x1a3239(0x1d8)]({'time':_0x2728d3,'usage':(_0x19ecf9[_0x1a3239(0x1df)]/0x3e8)['toFixed'](0x2)}),RequestMonitor['ressourcesUsageStats']['network'][_0x1a3239(0x1d8)]({'time':_0x2728d3,'usage':{'in':_0x46afc8[_0x1a3239(0x1c5)]?.[_0x1a3239(0x1cd)]??0x0,'out':_0x46afc8[_0x1a3239(0x1c5)]?.[_0x1a3239(0x1e5)]??0x0}});try{await fs[_0x1a3239(0x1f6)](RequestMonitor[_0x1a3239(0x1ec)],JSON[_0x1a3239(0x1d0)](RequestMonitor[_0x1a3239(0x1d7)],null,0x2));}catch(_0x5574c3){console['error'](_0x1a3239(0x1bb),_0x5574c3);}}static[a1_0x143684(0x1eb)](){const _0xacbd5=a1_0x143684,_0x3dff25=Date[_0xacbd5(0x1c2)](),_0x308d34=_0x3dff25-0x3c*0x3c*0x3e8,_0x90f0a1=_0x3dff25-0x18*0x3c*0x3c*0x3e8,_0x35dcc9=RequestMonitor[_0xacbd5(0x1dd)][_0xacbd5(0x1ef)](_0x51c0fa=>_0x51c0fa[_0xacbd5(0x1c0)]>_0x308d34),_0x332f53={'total':RequestMonitor[_0xacbd5(0x1f1)][_0xacbd5(0x1c3)],'byCodes':{},'byPath':{}};return RequestMonitor[_0xacbd5(0x1f1)][_0xacbd5(0x1ca)](_0x2ca9c1=>{const _0x333c13=_0xacbd5;_0x332f53[_0x333c13(0x1f0)][_0x2ca9c1[_0x333c13(0x1e3)]]=(_0x332f53[_0x333c13(0x1f0)][_0x2ca9c1[_0x333c13(0x1e3)]]||0x0)+0x1;const _0xcd60f1=_0x2ca9c1[_0x333c13(0x1f3)]+'\x20'+_0x2ca9c1['path'];!_0x332f53[_0x333c13(0x1ba)][_0xcd60f1]&&(_0x332f53[_0x333c13(0x1ba)][_0xcd60f1]={'total':0x0,'codes':{}}),_0x332f53[_0x333c13(0x1ba)][_0xcd60f1]['total']++,_0x332f53['byPath'][_0xcd60f1][_0x333c13(0x1cc)][_0x2ca9c1[_0x333c13(0x1e3)]]=(_0x332f53[_0x333c13(0x1ba)][_0xcd60f1][_0x333c13(0x1cc)][_0x2ca9c1['statusCode']]||0x0)+0x1;}),{'rps':_0x35dcc9,'httpCodes':_0x332f53,'ressourcesUsageStats':RequestMonitor['ressourcesUsageStats']};}}function a1_0x20f5(_0x3669a9,_0x19b6e1){const _0x4626aa=a1_0x4626();return a1_0x20f5=function(_0x20f5af,_0x4b6e5a){_0x20f5af=_0x20f5af-0x1b5;let _0x3ab6c6=_0x4626aa[_0x20f5af];return _0x3ab6c6;},a1_0x20f5(_0x3669a9,_0x19b6e1);}RequestMonitor[a1_0x143684(0x1b5)]()[a1_0x143684(0x1d9)](()=>{}),RequestMonitor[a1_0x143684(0x1e6)]();const counter=RequestMonitor;function a1_0x4626(){const _0x341abc=['parse','statusCode','708460bAxlvn','outputMb','startPeriodicSave','/metrics','Error\x20getting\x20memory\x20usage:','cadviewer/settings/requests-per-minute.json','readFile','getStats','ressourcesUsageStatsPath','81EWfMWS','cpu','filter','byCodes','httpCodesData','getHours','method','currentRequests','utf8','writeFile','time','getUsageRessourcesStatsAndSave','=======>','2317000LgoVzp','lastMinute','path','init','rpsStoragePath','log','promises','error','byPath','Error\x20saving\x20monitoring\x20data:','mem','Initializing\x20request\x20monitor...','end','node-os-utils','timestamp','httpCodesStoragePath','now','length','cadviewer/settings/http-codes-24h.json','total','floor','memory','cadviewer/settings/ressources-usage-stats.json','7826238PPBmmT','forEach','usage','codes','inputMb','2184890OhFhSU','slice','stringify','middleware','getMinutes','network','130778XAqhDQ','Request\x20monitor\x20middleware','24PoQGci','ressourcesUsageStats','push','then','info','save','inOut','rpsData','1921362MUjvct','usedMemMb','5028800RsDqIN','8eXQgVL'];a1_0x4626=function(){return _0x341abc;};return a1_0x4626();}module['exports']=counter;