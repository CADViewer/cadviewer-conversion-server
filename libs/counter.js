const a1_0x257e89=a1_0xd296;(function(_0x5642dd,_0xadfd87){const _0x9cb684=a1_0xd296,_0x105636=_0x5642dd();while(!![]){try{const _0x4432ef=parseInt(_0x9cb684(0x85))/0x1*(-parseInt(_0x9cb684(0x7c))/0x2)+-parseInt(_0x9cb684(0xbb))/0x3+parseInt(_0x9cb684(0x89))/0x4+parseInt(_0x9cb684(0xa6))/0x5+-parseInt(_0x9cb684(0x77))/0x6*(-parseInt(_0x9cb684(0x8a))/0x7)+parseInt(_0x9cb684(0xbe))/0x8+-parseInt(_0x9cb684(0x9c))/0x9;if(_0x4432ef===_0xadfd87)break;else _0x105636['push'](_0x105636['shift']());}catch(_0x419f12){_0x105636['push'](_0x105636['shift']());}}}(a1_0xb0fd,0x787bc));const fs=require('fs')[a1_0x257e89(0xb4)],osu=require('node-os-utils');function a1_0xd296(_0x40657a,_0x44e23f){const _0xb0fdfa=a1_0xb0fd();return a1_0xd296=function(_0xd29607,_0x18a351){_0xd29607=_0xd29607-0x77;let _0x2fa210=_0xb0fdfa[_0xd29607];return _0x2fa210;},a1_0xd296(_0x40657a,_0x44e23f);}function a1_0xb0fd(){const _0x5536aa=['includes','netstat','length','memory','mem','getMinutes','usage','23ePWMzO','total','currentRequests','outputMb','3787964dowRKL','7tGqGmb','Error\x20getting\x20CPU\x20usage:','lastMinute','getHours','cpu','Request\x20monitor\x20initialized.','writeFile','cadviewer/settings/requests-per-minute.json','log','timestamp','stringify','cadviewer/settings/http-codes-24h.json','byPath','middleware','error','padStart','Error\x20saving\x20monitoring\x20data:','then','18200610LJJUcL','statusCode','Error\x20getting\x20memory\x20usage:','method','forEach','startPeriodicSave','httpCodesData','apply','usedMemMb','inputMb','2481570RMCWIF','rpsData','info','init','end','cadviewer/settings/ressources-usage-stats.json','network','toString','floor','getUsageRessourcesStatsAndSave','readFile','push','utf8','rpsStoragePath','promises','toFixed','ressourcesUsageStatsPath','filter','httpCodesStoragePath','codes','/metrics','993978hnEPfo','now','=======>','4639400mIUTgb','path','save','5179848wDzCXE','byCodes','slice','time','parse','3428HVeiMv','ressourcesUsageStats'];a1_0xb0fd=function(){return _0x5536aa;};return a1_0xb0fd();}class RequestMonitor{static ['rpsStoragePath']=a1_0x257e89(0x91);static [a1_0x257e89(0xb8)]=a1_0x257e89(0x95);static [a1_0x257e89(0xb6)]=a1_0x257e89(0xab);static [a1_0x257e89(0xa7)]=[];static [a1_0x257e89(0xa2)]=[];static [a1_0x257e89(0x7d)]={};static [a1_0x257e89(0x8c)]=Math[a1_0x257e89(0xae)](Date[a1_0x257e89(0xbc)]()/0x3e8/0x3c);static [a1_0x257e89(0x87)]=0x0;static async[a1_0x257e89(0xa9)](){const _0x785ede=a1_0x257e89;console['log']('Initializing\x20request\x20monitor...');try{const _0x5301f8=await fs['readFile'](RequestMonitor['rpsStoragePath'],_0x785ede(0xb2));RequestMonitor[_0x785ede(0xa7)]=JSON[_0x785ede(0x7b)](_0x5301f8);}catch(_0x285291){RequestMonitor[_0x785ede(0xa7)]=[];}try{const _0x1c5368=await fs[_0x785ede(0xb0)](RequestMonitor[_0x785ede(0xb8)],_0x785ede(0xb2));RequestMonitor[_0x785ede(0xa2)]=JSON['parse'](_0x1c5368);}catch(_0x2aaa24){RequestMonitor['httpCodesData']=[];}try{const _0x58efc4=await fs['readFile'](RequestMonitor[_0x785ede(0xb6)],_0x785ede(0xb2));RequestMonitor[_0x785ede(0x7d)]=JSON[_0x785ede(0x7b)](_0x58efc4),!RequestMonitor[_0x785ede(0x7d)][_0x785ede(0x8e)]&&(RequestMonitor[_0x785ede(0x7d)][_0x785ede(0x8e)]=[]),!RequestMonitor[_0x785ede(0x7d)][_0x785ede(0x81)]&&(RequestMonitor[_0x785ede(0x7d)]['memory']=[]),!RequestMonitor['ressourcesUsageStats'][_0x785ede(0xac)]&&(RequestMonitor[_0x785ede(0x7d)][_0x785ede(0xac)]=[]);}catch(_0x243d8a){RequestMonitor[_0x785ede(0x7d)]={'cpu':[],'memory':[],'network':[]};}console['log'](_0x785ede(0x8f));}static[a1_0x257e89(0x97)](_0x1b2942,_0x4359c8,_0x1037dc){const _0x52af00=a1_0x257e89;if(_0x1b2942['path'][_0x52af00(0x7e)](_0x52af00(0xba)))return _0x1037dc();console['log']('Request\x20monitor\x20middleware');let _0x37eed6=Date[_0x52af00(0xbc)](),_0x506f19=Math[_0x52af00(0xae)](_0x37eed6/0x3e8/0x3c);console[_0x52af00(0x92)](_0x52af00(0xbd));const _0x4b27a5=_0x4359c8['end'];_0x4359c8[_0x52af00(0xaa)]=(..._0x3c02c7)=>{const _0x502bd5=_0x52af00;console['log'](_0x506f19,{'currentMinute':_0x506f19});_0x506f19>RequestMonitor[_0x502bd5(0x8c)]&&(RequestMonitor[_0x502bd5(0xa7)][_0x502bd5(0xb1)]({'timestamp':RequestMonitor[_0x502bd5(0x8c)]*0x3e8*0x3c,'requests':RequestMonitor[_0x502bd5(0x87)]}),RequestMonitor[_0x502bd5(0x87)]=0x0,RequestMonitor[_0x502bd5(0x8c)]=_0x506f19);RequestMonitor[_0x502bd5(0x87)]++,RequestMonitor[_0x502bd5(0xa2)][_0x502bd5(0xb1)]({'timestamp':Date['now'](),'statusCode':_0x4359c8[_0x502bd5(0x9d)],'path':_0x1b2942[_0x502bd5(0xbf)],'method':_0x1b2942[_0x502bd5(0x9f)]});const _0x344347=Date[_0x502bd5(0xbc)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x502bd5(0xa2)]=RequestMonitor[_0x502bd5(0xa2)]['filter'](_0x53697d=>_0x53697d[_0x502bd5(0x93)]>_0x344347),_0x4b27a5[_0x502bd5(0xa3)](_0x4359c8,_0x3c02c7);},_0x1037dc();}static async[a1_0x257e89(0xc0)](){const _0x5c9449=a1_0x257e89;try{RequestMonitor[_0x5c9449(0x8c)]!==Math[_0x5c9449(0xae)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x5c9449(0xa7)][_0x5c9449(0xb1)]({'timestamp':RequestMonitor[_0x5c9449(0x8c)]*0x3e8*0x3c,'requests':RequestMonitor[_0x5c9449(0x87)]}),RequestMonitor[_0x5c9449(0x87)]=0x0,RequestMonitor[_0x5c9449(0x8c)]=Math[_0x5c9449(0xae)](Date['now']()/0x3e8/0x3c)),await fs[_0x5c9449(0x90)](RequestMonitor[_0x5c9449(0xb3)],JSON[_0x5c9449(0x94)](RequestMonitor['rpsData'],null,0x2)),await fs['writeFile'](RequestMonitor['httpCodesStoragePath'],JSON['stringify'](RequestMonitor[_0x5c9449(0xa2)],null,0x2));}catch(_0x12a467){console[_0x5c9449(0x98)]('Error\x20saving\x20monitoring\x20data:',_0x12a467);}}static async[a1_0x257e89(0xa1)](){const _0x164de2=a1_0x257e89;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x519811=a1_0xd296;RequestMonitor[_0x519811(0xaf)]()[_0x519811(0x9b)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x164de2(0xaf)]()[_0x164de2(0x9b)](()=>{});}static async['getUsageRessourcesStatsAndSave'](){const _0x4eb0f2=a1_0x257e89,_0x4cbeb7=osu[_0x4eb0f2(0x8e)],_0x7084b8=osu[_0x4eb0f2(0x82)],_0x100650=osu[_0x4eb0f2(0x7f)],_0x5e672e={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x103b50=await _0x100650['inOut']();_0x5e672e[_0x4eb0f2(0x86)][_0x4eb0f2(0xa5)]=_0x103b50[_0x4eb0f2(0x86)][_0x4eb0f2(0xa5)],_0x5e672e[_0x4eb0f2(0x86)][_0x4eb0f2(0x88)]=_0x103b50[_0x4eb0f2(0x86)][_0x4eb0f2(0x88)];}catch(_0x3994de){}let _0x123f2f=0x0;try{_0x123f2f=await _0x4cbeb7[_0x4eb0f2(0x84)]();}catch(_0xd8493a){console[_0x4eb0f2(0x92)](_0x4eb0f2(0x8b),_0xd8493a);}const _0x21866c={'usedMemMb':0x0};try{const _0x56370d=await _0x7084b8[_0x4eb0f2(0xa8)]();_0x21866c[_0x4eb0f2(0xa4)]=_0x56370d[_0x4eb0f2(0xa4)];}catch(_0x3eb545){console[_0x4eb0f2(0x92)](_0x4eb0f2(0x9e),_0x3eb545);}const _0x219c02=new Date()[_0x4eb0f2(0x8d)]()[_0x4eb0f2(0xad)]()['padStart'](0x2,'0')+':'+new Date()[_0x4eb0f2(0x83)]()['toString']()[_0x4eb0f2(0x99)](0x2,'0');RequestMonitor[_0x4eb0f2(0x7d)][_0x4eb0f2(0x8e)]=RequestMonitor[_0x4eb0f2(0x7d)][_0x4eb0f2(0x8e)]['slice'](-0x3c)[_0x4eb0f2(0xb7)](_0x51a0bd=>_0x51a0bd['time']!==_0x219c02),RequestMonitor[_0x4eb0f2(0x7d)][_0x4eb0f2(0x81)]=RequestMonitor[_0x4eb0f2(0x7d)]['memory'][_0x4eb0f2(0x79)](-0x3c)[_0x4eb0f2(0xb7)](_0x47ff8f=>_0x47ff8f[_0x4eb0f2(0x7a)]!==_0x219c02),RequestMonitor[_0x4eb0f2(0x7d)][_0x4eb0f2(0xac)]=RequestMonitor[_0x4eb0f2(0x7d)][_0x4eb0f2(0xac)][_0x4eb0f2(0x79)](-0x3c)['filter'](_0x4c0a0b=>_0x4c0a0b[_0x4eb0f2(0x7a)]!==_0x219c02),RequestMonitor[_0x4eb0f2(0x7d)][_0x4eb0f2(0x8e)][_0x4eb0f2(0xb1)]({'time':_0x219c02,'usage':_0x123f2f}),RequestMonitor[_0x4eb0f2(0x7d)][_0x4eb0f2(0x81)][_0x4eb0f2(0xb1)]({'time':_0x219c02,'usage':(_0x21866c['usedMemMb']/0x3e8)[_0x4eb0f2(0xb5)](0x2)}),RequestMonitor[_0x4eb0f2(0x7d)]['network'][_0x4eb0f2(0xb1)]({'time':_0x219c02,'usage':{'in':_0x5e672e[_0x4eb0f2(0x86)]?.['inputMb']??0x0,'out':_0x5e672e[_0x4eb0f2(0x86)]?.[_0x4eb0f2(0x88)]??0x0}});try{await fs[_0x4eb0f2(0x90)](RequestMonitor[_0x4eb0f2(0xb6)],JSON[_0x4eb0f2(0x94)](RequestMonitor[_0x4eb0f2(0x7d)],null,0x2));}catch(_0x16e2f6){console[_0x4eb0f2(0x98)](_0x4eb0f2(0x9a),_0x16e2f6);}}static['getStats'](){const _0x74c7ba=a1_0x257e89,_0x22105f=Date['now'](),_0x4a1359=_0x22105f-0x3c*0x3c*0x3e8,_0x3bbaa0=_0x22105f-0x18*0x3c*0x3c*0x3e8,_0x270d5b=RequestMonitor[_0x74c7ba(0xa7)][_0x74c7ba(0xb7)](_0x306d1a=>_0x306d1a['timestamp']>_0x4a1359),_0x204a73={'total':RequestMonitor[_0x74c7ba(0xa2)][_0x74c7ba(0x80)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x74c7ba(0xa2)][_0x74c7ba(0xa0)](_0x192729=>{const _0x57849d=_0x74c7ba;_0x204a73[_0x57849d(0x78)][_0x192729['statusCode']]=(_0x204a73[_0x57849d(0x78)][_0x192729['statusCode']]||0x0)+0x1;const _0x2f9b2f=_0x192729['method']+'\x20'+_0x192729[_0x57849d(0xbf)];!_0x204a73[_0x57849d(0x96)][_0x2f9b2f]&&(_0x204a73[_0x57849d(0x96)][_0x2f9b2f]={'total':0x0,'codes':{}}),_0x204a73[_0x57849d(0x96)][_0x2f9b2f][_0x57849d(0x86)]++,_0x204a73[_0x57849d(0x96)][_0x2f9b2f][_0x57849d(0xb9)][_0x192729['statusCode']]=(_0x204a73[_0x57849d(0x96)][_0x2f9b2f][_0x57849d(0xb9)][_0x192729['statusCode']]||0x0)+0x1;}),{'rps':_0x270d5b,'httpCodes':_0x204a73,'ressourcesUsageStats':RequestMonitor[_0x74c7ba(0x7d)]};}}RequestMonitor[a1_0x257e89(0xa9)]()[a1_0x257e89(0x9b)](()=>{}),RequestMonitor['startPeriodicSave']();const counter=RequestMonitor;module['exports']=counter;