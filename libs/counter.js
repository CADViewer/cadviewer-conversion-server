const a1_0x933da7=a1_0x3fa6;(function(_0x19a6b0,_0x2378dc){const _0x1450ee=a1_0x3fa6,_0x338f18=_0x19a6b0();while(!![]){try{const _0x2c43c7=parseInt(_0x1450ee(0x1d1))/0x1+-parseInt(_0x1450ee(0x1b0))/0x2*(parseInt(_0x1450ee(0x1c6))/0x3)+parseInt(_0x1450ee(0x1af))/0x4*(parseInt(_0x1450ee(0x1c0))/0x5)+parseInt(_0x1450ee(0x1a9))/0x6*(parseInt(_0x1450ee(0x1ce))/0x7)+parseInt(_0x1450ee(0x1c4))/0x8+parseInt(_0x1450ee(0x1f0))/0x9+-parseInt(_0x1450ee(0x1e7))/0xa*(parseInt(_0x1450ee(0x1bd))/0xb);if(_0x2c43c7===_0x2378dc)break;else _0x338f18['push'](_0x338f18['shift']());}catch(_0x5ac67c){_0x338f18['push'](_0x338f18['shift']());}}}(a1_0x2f9d,0x7e7c1));const fs=require('fs')['promises'],osu=require(a1_0x933da7(0x1ec));function a1_0x2f9d(){const _0x5b3b63=['cadviewer/settings/ressources-usage-stats.json','10918370iBkEoS','codes','currentRequests','floor','writeFile','node-os-utils','memory','includes','toFixed','9093969fNXkkh','httpCodesStoragePath','save','startPeriodicSave','mem','Initializing\x20request\x20monitor...','6GNruyi','network','rpsStoragePath','filter','httpCodesData','readFile','1076cmjfCY','18GCvIwy','Error\x20saving\x20monitoring\x20data:','method','Request\x20monitor\x20middleware','exports','outputMb','usedMemMb','middleware','ressourcesUsageStats','cpu','byCodes','error','padStart','22LNPZZD','path','timestamp','16785NvLxtp','slice','ressourcesUsageStatsPath','parse','2509432PNTnEE','toString','159690MTomwe','netstat','byPath','Error\x20getting\x20memory\x20usage:','getStats','time','end','inOut','6169058txvfve','init','length','72378MXyqfF','now','/metrics','stringify','=======>','forEach','info','cadviewer/settings/requests-per-minute.json','getMinutes','lastMinute','Request\x20monitor\x20initialized.','then','rpsData','log','getUsageRessourcesStatsAndSave','push','total','usage','statusCode','utf8','inputMb'];a1_0x2f9d=function(){return _0x5b3b63;};return a1_0x2f9d();}class RequestMonitor{static [a1_0x933da7(0x1ab)]=a1_0x933da7(0x1d8);static [a1_0x933da7(0x1f1)]='cadviewer/settings/http-codes-24h.json';static [a1_0x933da7(0x1c2)]=a1_0x933da7(0x1e6);static ['rpsData']=[];static [a1_0x933da7(0x1ad)]=[];static [a1_0x933da7(0x1b8)]={};static [a1_0x933da7(0x1da)]=Math[a1_0x933da7(0x1ea)](Date[a1_0x933da7(0x1d2)]()/0x3e8/0x3c);static [a1_0x933da7(0x1e9)]=0x0;static async[a1_0x933da7(0x1cf)](){const _0x50a28e=a1_0x933da7;console[_0x50a28e(0x1de)](_0x50a28e(0x1a8));try{const _0x1222b4=await fs[_0x50a28e(0x1ae)](RequestMonitor[_0x50a28e(0x1ab)],'utf8');RequestMonitor[_0x50a28e(0x1dd)]=JSON[_0x50a28e(0x1c3)](_0x1222b4);}catch(_0x498095){RequestMonitor[_0x50a28e(0x1dd)]=[];}try{const _0x4a712c=await fs['readFile'](RequestMonitor[_0x50a28e(0x1f1)],'utf8');RequestMonitor[_0x50a28e(0x1ad)]=JSON[_0x50a28e(0x1c3)](_0x4a712c);}catch(_0x1b755a){RequestMonitor['httpCodesData']=[];}try{const _0x5efd9a=await fs[_0x50a28e(0x1ae)](RequestMonitor[_0x50a28e(0x1c2)],_0x50a28e(0x1e4));RequestMonitor[_0x50a28e(0x1b8)]=JSON['parse'](_0x5efd9a),!RequestMonitor[_0x50a28e(0x1b8)][_0x50a28e(0x1b9)]&&(RequestMonitor[_0x50a28e(0x1b8)][_0x50a28e(0x1b9)]=[]),!RequestMonitor[_0x50a28e(0x1b8)][_0x50a28e(0x1ed)]&&(RequestMonitor[_0x50a28e(0x1b8)][_0x50a28e(0x1ed)]=[]),!RequestMonitor[_0x50a28e(0x1b8)][_0x50a28e(0x1aa)]&&(RequestMonitor[_0x50a28e(0x1b8)][_0x50a28e(0x1aa)]=[]);}catch(_0x525cc5){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console['log'](_0x50a28e(0x1db));}static[a1_0x933da7(0x1b7)](_0xdb8f00,_0x3f1c0e,_0x2f8946){const _0x484c83=a1_0x933da7;if(_0xdb8f00[_0x484c83(0x1be)][_0x484c83(0x1ee)](_0x484c83(0x1d3)))return _0x2f8946();console[_0x484c83(0x1de)](_0x484c83(0x1b3));let _0x25d9ef=Date['now'](),_0x36b0b6=Math[_0x484c83(0x1ea)](_0x25d9ef/0x3e8/0x3c);console['log'](_0x484c83(0x1d5));const _0x5b495d=_0x3f1c0e[_0x484c83(0x1cc)];_0x3f1c0e[_0x484c83(0x1cc)]=(..._0x3bccc1)=>{const _0x13ac62=_0x484c83;console[_0x13ac62(0x1de)](_0x36b0b6,{'currentMinute':_0x36b0b6});_0x36b0b6>RequestMonitor['lastMinute']&&(RequestMonitor['rpsData']['push']({'timestamp':RequestMonitor[_0x13ac62(0x1da)]*0x3e8*0x3c,'requests':RequestMonitor[_0x13ac62(0x1e9)]}),RequestMonitor[_0x13ac62(0x1e9)]=0x0,RequestMonitor[_0x13ac62(0x1da)]=_0x36b0b6);RequestMonitor['currentRequests']++,RequestMonitor['httpCodesData'][_0x13ac62(0x1e0)]({'timestamp':Date[_0x13ac62(0x1d2)](),'statusCode':_0x3f1c0e[_0x13ac62(0x1e3)],'path':_0xdb8f00[_0x13ac62(0x1be)],'method':_0xdb8f00[_0x13ac62(0x1b2)]});const _0x13fd52=Date[_0x13ac62(0x1d2)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x13ac62(0x1ad)]=RequestMonitor[_0x13ac62(0x1ad)][_0x13ac62(0x1ac)](_0x276361=>_0x276361[_0x13ac62(0x1bf)]>_0x13fd52),_0x5b495d['apply'](_0x3f1c0e,_0x3bccc1);},_0x2f8946();}static async[a1_0x933da7(0x1f2)](){const _0x189969=a1_0x933da7;try{RequestMonitor[_0x189969(0x1da)]!==Math['floor'](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x189969(0x1dd)][_0x189969(0x1e0)]({'timestamp':RequestMonitor[_0x189969(0x1da)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x189969(0x1e9)]=0x0,RequestMonitor[_0x189969(0x1da)]=Math[_0x189969(0x1ea)](Date['now']()/0x3e8/0x3c)),await fs[_0x189969(0x1eb)](RequestMonitor[_0x189969(0x1ab)],JSON[_0x189969(0x1d4)](RequestMonitor['rpsData'],null,0x2)),await fs[_0x189969(0x1eb)](RequestMonitor[_0x189969(0x1f1)],JSON[_0x189969(0x1d4)](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x3f6ad0){console[_0x189969(0x1bb)](_0x189969(0x1b1),_0x3f6ad0);}}static async['startPeriodicSave'](){const _0x520644=a1_0x933da7;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x3c2ceb=a1_0x3fa6;RequestMonitor[_0x3c2ceb(0x1df)]()[_0x3c2ceb(0x1dc)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x520644(0x1df)]()[_0x520644(0x1dc)](()=>{});}static async[a1_0x933da7(0x1df)](){const _0x514350=a1_0x933da7,_0x3afe42=osu[_0x514350(0x1b9)],_0xd80d15=osu[_0x514350(0x1a7)],_0x1f0ce3=osu[_0x514350(0x1c7)],_0x29d18f={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x1aeafa=await _0x1f0ce3[_0x514350(0x1cd)]();_0x29d18f[_0x514350(0x1e1)][_0x514350(0x1e5)]=_0x1aeafa[_0x514350(0x1e1)]['inputMb'],_0x29d18f[_0x514350(0x1e1)]['outputMb']=_0x1aeafa['total'][_0x514350(0x1b5)];}catch(_0x3cc112){}let _0x508b24=0x0;try{_0x508b24=await _0x3afe42[_0x514350(0x1e2)]();}catch(_0x1adbf8){console[_0x514350(0x1de)]('Error\x20getting\x20CPU\x20usage:',_0x1adbf8);}const _0x17fcbf={'usedMemMb':0x0};try{const _0x813940=await _0xd80d15[_0x514350(0x1d7)]();_0x17fcbf['usedMemMb']=_0x813940[_0x514350(0x1b6)];}catch(_0x696c77){console['log'](_0x514350(0x1c9),_0x696c77);}const _0x169f4=new Date()['getHours']()[_0x514350(0x1c5)]()[_0x514350(0x1bc)](0x2,'0')+':'+new Date()[_0x514350(0x1d9)]()[_0x514350(0x1c5)]()[_0x514350(0x1bc)](0x2,'0');RequestMonitor[_0x514350(0x1b8)][_0x514350(0x1b9)]=RequestMonitor[_0x514350(0x1b8)][_0x514350(0x1b9)][_0x514350(0x1c1)](-0x3c)[_0x514350(0x1ac)](_0x3cf02a=>_0x3cf02a['time']!==_0x169f4),RequestMonitor['ressourcesUsageStats'][_0x514350(0x1ed)]=RequestMonitor['ressourcesUsageStats'][_0x514350(0x1ed)][_0x514350(0x1c1)](-0x3c)['filter'](_0x11da47=>_0x11da47[_0x514350(0x1cb)]!==_0x169f4),RequestMonitor[_0x514350(0x1b8)]['network']=RequestMonitor[_0x514350(0x1b8)][_0x514350(0x1aa)][_0x514350(0x1c1)](-0x3c)[_0x514350(0x1ac)](_0x3f6b69=>_0x3f6b69[_0x514350(0x1cb)]!==_0x169f4),RequestMonitor[_0x514350(0x1b8)][_0x514350(0x1b9)][_0x514350(0x1e0)]({'time':_0x169f4,'usage':_0x508b24}),RequestMonitor[_0x514350(0x1b8)][_0x514350(0x1ed)]['push']({'time':_0x169f4,'usage':(_0x17fcbf[_0x514350(0x1b6)]/0x3e8)[_0x514350(0x1ef)](0x2)}),RequestMonitor[_0x514350(0x1b8)]['network']['push']({'time':_0x169f4,'usage':{'in':_0x29d18f[_0x514350(0x1e1)]?.[_0x514350(0x1e5)]??0x0,'out':_0x29d18f[_0x514350(0x1e1)]?.[_0x514350(0x1b5)]??0x0}});try{await fs[_0x514350(0x1eb)](RequestMonitor[_0x514350(0x1c2)],JSON[_0x514350(0x1d4)](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x58b230){console[_0x514350(0x1bb)](_0x514350(0x1b1),_0x58b230);}}static[a1_0x933da7(0x1ca)](){const _0x9a567c=a1_0x933da7,_0x491dec=Date[_0x9a567c(0x1d2)](),_0x3a53ed=_0x491dec-0x3c*0x3c*0x3e8,_0x52e01b=_0x491dec-0x18*0x3c*0x3c*0x3e8,_0x3e11e6=RequestMonitor[_0x9a567c(0x1dd)][_0x9a567c(0x1ac)](_0x594632=>_0x594632[_0x9a567c(0x1bf)]>_0x3a53ed),_0x58ecf1={'total':RequestMonitor[_0x9a567c(0x1ad)][_0x9a567c(0x1d0)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x9a567c(0x1ad)][_0x9a567c(0x1d6)](_0x4eb094=>{const _0x514bfd=_0x9a567c;_0x58ecf1['byCodes'][_0x4eb094['statusCode']]=(_0x58ecf1[_0x514bfd(0x1ba)][_0x4eb094[_0x514bfd(0x1e3)]]||0x0)+0x1;const _0x38c9f0=_0x4eb094[_0x514bfd(0x1b2)]+'\x20'+_0x4eb094[_0x514bfd(0x1be)];!_0x58ecf1[_0x514bfd(0x1c8)][_0x38c9f0]&&(_0x58ecf1['byPath'][_0x38c9f0]={'total':0x0,'codes':{}}),_0x58ecf1[_0x514bfd(0x1c8)][_0x38c9f0][_0x514bfd(0x1e1)]++,_0x58ecf1[_0x514bfd(0x1c8)][_0x38c9f0][_0x514bfd(0x1e8)][_0x4eb094[_0x514bfd(0x1e3)]]=(_0x58ecf1[_0x514bfd(0x1c8)][_0x38c9f0][_0x514bfd(0x1e8)][_0x4eb094[_0x514bfd(0x1e3)]]||0x0)+0x1;}),{'rps':_0x3e11e6,'httpCodes':_0x58ecf1,'ressourcesUsageStats':RequestMonitor[_0x9a567c(0x1b8)]};}}RequestMonitor[a1_0x933da7(0x1cf)]()[a1_0x933da7(0x1dc)](()=>{}),RequestMonitor[a1_0x933da7(0x1a6)]();function a1_0x3fa6(_0x20aac5,_0x1c9e1d){const _0x2f9d70=a1_0x2f9d();return a1_0x3fa6=function(_0x3fa6aa,_0x1032db){_0x3fa6aa=_0x3fa6aa-0x1a6;let _0x2e3f86=_0x2f9d70[_0x3fa6aa];return _0x2e3f86;},a1_0x3fa6(_0x20aac5,_0x1c9e1d);}const counter=RequestMonitor;module[a1_0x933da7(0x1b4)]=counter;