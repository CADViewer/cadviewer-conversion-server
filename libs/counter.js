const a2_0x48610c=a2_0x2e0c;function a2_0x3b79(){const _0xea6dff=['cadviewer/settings/ressources-usage-stats.json','inOut','rpsStoragePath','toFixed','apply','now','/metrics','430owyDyT','toString','rpsData','2593632aeGwWY','forEach','parse','filter','cadviewer/settings/requests-per-minute.json','203680KqTKgn','readFile','path','time','Request\x20monitor\x20initialized.','middleware','outputMb','push','log','lastMinute','then','info','inputMb','startPeriodicSave','codes','usedMemMb','cpu','2268912GaPbvm','memory','error','Error\x20saving\x20monitoring\x20data:','includes','statusCode','exports','byPath','end','9604077PfzaCj','method','currentRequests','mem','getStats','byCodes','Error\x20getting\x20CPU\x20usage:','length','total','getUsageRessourcesStatsAndSave','25dCRbYS','5CQIxrj','network','stringify','httpCodesData','httpCodesStoragePath','ressourcesUsageStatsPath','10558014BxsKZM','usage','utf8','timestamp','save','writeFile','ressourcesUsageStats','getHours','549531FtywxP','Error\x20getting\x20memory\x20usage:','slice','padStart','init','floor','157454dLhjbK'];a2_0x3b79=function(){return _0xea6dff;};return a2_0x3b79();}(function(_0x284f91,_0x1a9455){const _0x389991=a2_0x2e0c,_0x4421ab=_0x284f91();while(!![]){try{const _0x2cfeb2=parseInt(_0x389991(0x1ae))/0x1*(-parseInt(_0x389991(0x1c2))/0x2)+parseInt(_0x389991(0x1cd))/0x3+parseInt(_0x389991(0x1d2))/0x4*(parseInt(_0x389991(0x1ad))/0x5)+parseInt(_0x389991(0x1b4))/0x6+parseInt(_0x389991(0x1ec))/0x7+-parseInt(_0x389991(0x1e3))/0x8+parseInt(_0x389991(0x1bc))/0x9*(-parseInt(_0x389991(0x1ca))/0xa);if(_0x2cfeb2===_0x1a9455)break;else _0x4421ab['push'](_0x4421ab['shift']());}catch(_0x2277f0){_0x4421ab['push'](_0x4421ab['shift']());}}}(a2_0x3b79,0xe7746));const fs=require('fs')['promises'],osu=require('node-os-utils');class RequestMonitor{static [a2_0x48610c(0x1c5)]=a2_0x48610c(0x1d1);static ['httpCodesStoragePath']='cadviewer/settings/http-codes-24h.json';static ['ressourcesUsageStatsPath']=a2_0x48610c(0x1c3);static [a2_0x48610c(0x1cc)]=[];static [a2_0x48610c(0x1b1)]=[];static [a2_0x48610c(0x1ba)]={};static [a2_0x48610c(0x1db)]=Math[a2_0x48610c(0x1c1)](Date[a2_0x48610c(0x1c8)]()/0x3e8/0x3c);static ['currentRequests']=0x0;static async[a2_0x48610c(0x1c0)](){const _0x3b98da=a2_0x48610c;console[_0x3b98da(0x1da)]('Initializing\x20request\x20monitor...');try{const _0x31f8d4=await fs[_0x3b98da(0x1d3)](RequestMonitor[_0x3b98da(0x1c5)],'utf8');RequestMonitor['rpsData']=JSON[_0x3b98da(0x1cf)](_0x31f8d4);}catch(_0x28fa7f){RequestMonitor[_0x3b98da(0x1cc)]=[];}try{const _0x4ab940=await fs['readFile'](RequestMonitor[_0x3b98da(0x1b2)],_0x3b98da(0x1b6));RequestMonitor[_0x3b98da(0x1b1)]=JSON[_0x3b98da(0x1cf)](_0x4ab940);}catch(_0x58df1e){RequestMonitor[_0x3b98da(0x1b1)]=[];}try{const _0x304227=await fs[_0x3b98da(0x1d3)](RequestMonitor[_0x3b98da(0x1b3)],_0x3b98da(0x1b6));RequestMonitor['ressourcesUsageStats']=JSON[_0x3b98da(0x1cf)](_0x304227),!RequestMonitor[_0x3b98da(0x1ba)]['cpu']&&(RequestMonitor[_0x3b98da(0x1ba)]['cpu']=[]),!RequestMonitor['ressourcesUsageStats'][_0x3b98da(0x1e4)]&&(RequestMonitor[_0x3b98da(0x1ba)][_0x3b98da(0x1e4)]=[]),!RequestMonitor['ressourcesUsageStats']['network']&&(RequestMonitor[_0x3b98da(0x1ba)][_0x3b98da(0x1af)]=[]);}catch(_0x42df17){RequestMonitor[_0x3b98da(0x1ba)]={'cpu':[],'memory':[],'network':[]};}console[_0x3b98da(0x1da)](_0x3b98da(0x1d6));}static[a2_0x48610c(0x1d7)](_0x1ccc4f,_0x7f3523,_0x1cf73d){const _0x4c74bb=a2_0x48610c;if(_0x1ccc4f[_0x4c74bb(0x1d4)][_0x4c74bb(0x1e7)](_0x4c74bb(0x1c9)))return _0x1cf73d();console[_0x4c74bb(0x1da)]('Request\x20monitor\x20middleware');let _0x3b14b0=Date[_0x4c74bb(0x1c8)](),_0x4e3641=Math[_0x4c74bb(0x1c1)](_0x3b14b0/0x3e8/0x3c);console[_0x4c74bb(0x1da)]('=======>');const _0x3ad998=_0x7f3523[_0x4c74bb(0x1eb)];_0x7f3523[_0x4c74bb(0x1eb)]=(..._0xb309d2)=>{const _0x26eafd=_0x4c74bb;console[_0x26eafd(0x1da)](_0x4e3641,{'currentMinute':_0x4e3641});_0x4e3641>RequestMonitor['lastMinute']&&(RequestMonitor[_0x26eafd(0x1cc)][_0x26eafd(0x1d9)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x26eafd(0x1ee)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor['lastMinute']=_0x4e3641);RequestMonitor[_0x26eafd(0x1ee)]++,RequestMonitor[_0x26eafd(0x1b1)][_0x26eafd(0x1d9)]({'timestamp':Date['now'](),'statusCode':_0x7f3523['statusCode'],'path':_0x1ccc4f[_0x26eafd(0x1d4)],'method':_0x1ccc4f[_0x26eafd(0x1ed)]});const _0x735743=Date[_0x26eafd(0x1c8)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x26eafd(0x1b1)]=RequestMonitor[_0x26eafd(0x1b1)][_0x26eafd(0x1d0)](_0xe14b1f=>_0xe14b1f[_0x26eafd(0x1b7)]>_0x735743),_0x3ad998[_0x26eafd(0x1c7)](_0x7f3523,_0xb309d2);},_0x1cf73d();}static async[a2_0x48610c(0x1b8)](){const _0x3f300d=a2_0x48610c;try{RequestMonitor[_0x3f300d(0x1db)]!==Math[_0x3f300d(0x1c1)](Date[_0x3f300d(0x1c8)]()/0x3e8/0x3c)&&(RequestMonitor[_0x3f300d(0x1cc)][_0x3f300d(0x1d9)]({'timestamp':RequestMonitor[_0x3f300d(0x1db)]*0x3e8*0x3c,'requests':RequestMonitor[_0x3f300d(0x1ee)]}),RequestMonitor[_0x3f300d(0x1ee)]=0x0,RequestMonitor[_0x3f300d(0x1db)]=Math[_0x3f300d(0x1c1)](Date['now']()/0x3e8/0x3c)),await fs[_0x3f300d(0x1b9)](RequestMonitor[_0x3f300d(0x1c5)],JSON[_0x3f300d(0x1b0)](RequestMonitor[_0x3f300d(0x1cc)],null,0x2)),await fs[_0x3f300d(0x1b9)](RequestMonitor[_0x3f300d(0x1b2)],JSON['stringify'](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x5ed2bf){console[_0x3f300d(0x1e5)]('Error\x20saving\x20monitoring\x20data:',_0x5ed2bf);}}static async['startPeriodicSave'](){const _0x267b36=a2_0x48610c;setInterval(()=>RequestMonitor[_0x267b36(0x1b8)](),0x3c*0x3e8),setInterval(()=>{const _0x138305=_0x267b36;RequestMonitor[_0x138305(0x1ac)]()[_0x138305(0x1dc)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x267b36(0x1ac)]()[_0x267b36(0x1dc)](()=>{});}static async[a2_0x48610c(0x1ac)](){const _0x53a19a=a2_0x48610c,_0x2899a8=osu['cpu'],_0x27027d=osu[_0x53a19a(0x1ef)],_0x3357bc=osu['netstat'],_0x4301b0={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x43a631=await _0x3357bc[_0x53a19a(0x1c4)]();_0x4301b0[_0x53a19a(0x1ab)]['inputMb']=_0x43a631[_0x53a19a(0x1ab)][_0x53a19a(0x1de)],_0x4301b0['total'][_0x53a19a(0x1d8)]=_0x43a631[_0x53a19a(0x1ab)][_0x53a19a(0x1d8)];}catch(_0x3be7c9){}let _0x235262=0x0;try{_0x235262=await _0x2899a8[_0x53a19a(0x1b5)]();}catch(_0x31ae71){console[_0x53a19a(0x1da)](_0x53a19a(0x1a9),_0x31ae71);}const _0x3ba870={'usedMemMb':0x0};try{const _0x345143=await _0x27027d[_0x53a19a(0x1dd)]();_0x3ba870[_0x53a19a(0x1e1)]=_0x345143['usedMemMb'];}catch(_0x3bb281){console[_0x53a19a(0x1da)](_0x53a19a(0x1bd),_0x3bb281);}const _0x366f40=new Date()[_0x53a19a(0x1bb)]()[_0x53a19a(0x1cb)]()['padStart'](0x2,'0')+':'+new Date()['getMinutes']()[_0x53a19a(0x1cb)]()[_0x53a19a(0x1bf)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x53a19a(0x1e2)]=RequestMonitor[_0x53a19a(0x1ba)][_0x53a19a(0x1e2)]['slice'](-0x3c)[_0x53a19a(0x1d0)](_0x1f9d3b=>_0x1f9d3b[_0x53a19a(0x1d5)]!==_0x366f40),RequestMonitor[_0x53a19a(0x1ba)]['memory']=RequestMonitor[_0x53a19a(0x1ba)][_0x53a19a(0x1e4)][_0x53a19a(0x1be)](-0x3c)[_0x53a19a(0x1d0)](_0x20ea53=>_0x20ea53['time']!==_0x366f40),RequestMonitor[_0x53a19a(0x1ba)]['network']=RequestMonitor[_0x53a19a(0x1ba)][_0x53a19a(0x1af)]['slice'](-0x3c)[_0x53a19a(0x1d0)](_0x365ada=>_0x365ada[_0x53a19a(0x1d5)]!==_0x366f40),RequestMonitor[_0x53a19a(0x1ba)][_0x53a19a(0x1e2)][_0x53a19a(0x1d9)]({'time':_0x366f40,'usage':_0x235262}),RequestMonitor[_0x53a19a(0x1ba)][_0x53a19a(0x1e4)][_0x53a19a(0x1d9)]({'time':_0x366f40,'usage':(_0x3ba870[_0x53a19a(0x1e1)]/0x3e8)[_0x53a19a(0x1c6)](0x2)}),RequestMonitor[_0x53a19a(0x1ba)][_0x53a19a(0x1af)][_0x53a19a(0x1d9)]({'time':_0x366f40,'usage':{'in':_0x4301b0[_0x53a19a(0x1ab)]?.[_0x53a19a(0x1de)]??0x0,'out':_0x4301b0[_0x53a19a(0x1ab)]?.[_0x53a19a(0x1d8)]??0x0}});try{await fs[_0x53a19a(0x1b9)](RequestMonitor[_0x53a19a(0x1b3)],JSON[_0x53a19a(0x1b0)](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x180cb9){console[_0x53a19a(0x1e5)](_0x53a19a(0x1e6),_0x180cb9);}}static[a2_0x48610c(0x1a7)](){const _0x556de3=a2_0x48610c,_0x56a4d6=Date[_0x556de3(0x1c8)](),_0x44d475=_0x56a4d6-0x3c*0x3c*0x3e8,_0x31d916=_0x56a4d6-0x18*0x3c*0x3c*0x3e8,_0x4b26b4=RequestMonitor[_0x556de3(0x1cc)][_0x556de3(0x1d0)](_0x2269e0=>_0x2269e0[_0x556de3(0x1b7)]>_0x44d475),_0x47f373={'total':RequestMonitor[_0x556de3(0x1b1)][_0x556de3(0x1aa)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x556de3(0x1b1)][_0x556de3(0x1ce)](_0x2ee288=>{const _0x527823=_0x556de3;_0x47f373[_0x527823(0x1a8)][_0x2ee288[_0x527823(0x1e8)]]=(_0x47f373['byCodes'][_0x2ee288[_0x527823(0x1e8)]]||0x0)+0x1;const _0x4d7359=_0x2ee288[_0x527823(0x1ed)]+'\x20'+_0x2ee288['path'];!_0x47f373['byPath'][_0x4d7359]&&(_0x47f373[_0x527823(0x1ea)][_0x4d7359]={'total':0x0,'codes':{}}),_0x47f373['byPath'][_0x4d7359][_0x527823(0x1ab)]++,_0x47f373[_0x527823(0x1ea)][_0x4d7359][_0x527823(0x1e0)][_0x2ee288[_0x527823(0x1e8)]]=(_0x47f373[_0x527823(0x1ea)][_0x4d7359][_0x527823(0x1e0)][_0x2ee288[_0x527823(0x1e8)]]||0x0)+0x1;}),{'rps':_0x4b26b4,'httpCodes':_0x47f373,'ressourcesUsageStats':RequestMonitor[_0x556de3(0x1ba)]};}}RequestMonitor[a2_0x48610c(0x1c0)]()['then'](()=>{}),RequestMonitor[a2_0x48610c(0x1df)]();const counter=RequestMonitor;function a2_0x2e0c(_0x15c8f8,_0x1f3f46){const _0x3b79c6=a2_0x3b79();return a2_0x2e0c=function(_0x2e0c7e,_0x1f5cbd){_0x2e0c7e=_0x2e0c7e-0x1a7;let _0x5de881=_0x3b79c6[_0x2e0c7e];return _0x5de881;},a2_0x2e0c(_0x15c8f8,_0x1f3f46);}module[a2_0x48610c(0x1e9)]=counter;