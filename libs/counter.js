const a1_0x12f270=a1_0x22ed;function a1_0x22ed(_0xd891a9,_0x4a380c){const _0x173231=a1_0x1732();return a1_0x22ed=function(_0x22ed57,_0x9e0fdc){_0x22ed57=_0x22ed57-0x16f;let _0x2be26d=_0x173231[_0x22ed57];return _0x2be26d;},a1_0x22ed(_0xd891a9,_0x4a380c);}(function(_0x5c1bc7,_0x429b7f){const _0x9b5f47=a1_0x22ed,_0x22c55e=_0x5c1bc7();while(!![]){try{const _0x469c46=-parseInt(_0x9b5f47(0x1a9))/0x1*(parseInt(_0x9b5f47(0x199))/0x2)+parseInt(_0x9b5f47(0x195))/0x3*(-parseInt(_0x9b5f47(0x19d))/0x4)+parseInt(_0x9b5f47(0x1a8))/0x5*(-parseInt(_0x9b5f47(0x1a1))/0x6)+-parseInt(_0x9b5f47(0x177))/0x7+-parseInt(_0x9b5f47(0x173))/0x8+-parseInt(_0x9b5f47(0x1a7))/0x9*(-parseInt(_0x9b5f47(0x186))/0xa)+parseInt(_0x9b5f47(0x190))/0xb*(parseInt(_0x9b5f47(0x1b9))/0xc);if(_0x469c46===_0x429b7f)break;else _0x22c55e['push'](_0x22c55e['shift']());}catch(_0x4f609c){_0x22c55e['push'](_0x22c55e['shift']());}}}(a1_0x1732,0xd1109));const fs=require('fs')[a1_0x12f270(0x192)],osu=require('node-os-utils');function a1_0x1732(){const _0x20a641=['100COFCAs','slice','mem','parse','87402UGHLgc','exports','forEach','memory','error','stringify','8442UlgDJX','355HLmeyG','1603458mMajDI','network','=======>','cadviewer/settings/ressources-usage-stats.json','codes','apply','Request\x20monitor\x20initialized.','statusCode','total','getStats','Error\x20saving\x20monitoring\x20data:','usage','cpu','byCodes','padStart','now','12teiGIL','byPath','toFixed','init','filter','ressourcesUsageStatsPath','3994344haMFrq','path','timestamp','end','10513293yonAyb','outputMb','inputMb','currentRequests','rpsData','getUsageRessourcesStatsAndSave','cadviewer/settings/http-codes-24h.json','getHours','method','httpCodesData','Error\x20getting\x20memory\x20usage:','Error\x20getting\x20CPU\x20usage:','ressourcesUsageStats','httpCodesStoragePath','netstat','80lzvJNj','inOut','floor','log','lastMinute','startPeriodicSave','Initializing\x20request\x20monitor...','then','usedMemMb','rpsStoragePath','68695077hiceHA','writeFile','promises','push','utf8','90873WKQpIA','info','readFile','time','2dwDDQo','length','/metrics','save'];a1_0x1732=function(){return _0x20a641;};return a1_0x1732();}class RequestMonitor{static [a1_0x12f270(0x18f)]='cadviewer/settings/requests-per-minute.json';static [a1_0x12f270(0x184)]=a1_0x12f270(0x17d);static [a1_0x12f270(0x172)]=a1_0x12f270(0x1ac);static [a1_0x12f270(0x17b)]=[];static [a1_0x12f270(0x180)]=[];static [a1_0x12f270(0x183)]={};static [a1_0x12f270(0x18a)]=Math[a1_0x12f270(0x188)](Date[a1_0x12f270(0x1b8)]()/0x3e8/0x3c);static [a1_0x12f270(0x17a)]=0x0;static async[a1_0x12f270(0x170)](){const _0x32f167=a1_0x12f270;console[_0x32f167(0x189)](_0x32f167(0x18c));try{const _0x5b4942=await fs[_0x32f167(0x197)](RequestMonitor[_0x32f167(0x18f)],'utf8');RequestMonitor[_0x32f167(0x17b)]=JSON[_0x32f167(0x1a0)](_0x5b4942);}catch(_0xe2cea6){RequestMonitor[_0x32f167(0x17b)]=[];}try{const _0x8f260c=await fs['readFile'](RequestMonitor[_0x32f167(0x184)],_0x32f167(0x194));RequestMonitor[_0x32f167(0x180)]=JSON['parse'](_0x8f260c);}catch(_0x24788c){RequestMonitor[_0x32f167(0x180)]=[];}try{const _0x5a7962=await fs[_0x32f167(0x197)](RequestMonitor['ressourcesUsageStatsPath'],'utf8');RequestMonitor[_0x32f167(0x183)]=JSON[_0x32f167(0x1a0)](_0x5a7962),!RequestMonitor[_0x32f167(0x183)]['cpu']&&(RequestMonitor[_0x32f167(0x183)]['cpu']=[]),!RequestMonitor[_0x32f167(0x183)][_0x32f167(0x1a4)]&&(RequestMonitor[_0x32f167(0x183)][_0x32f167(0x1a4)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x32f167(0x1aa)]&&(RequestMonitor[_0x32f167(0x183)]['network']=[]);}catch(_0xf3d560){RequestMonitor[_0x32f167(0x183)]={'cpu':[],'memory':[],'network':[]};}console[_0x32f167(0x189)](_0x32f167(0x1af));}static['middleware'](_0x515273,_0x4c5a59,_0x369d94){const _0x134e09=a1_0x12f270;if(_0x515273[_0x134e09(0x174)]['includes'](_0x134e09(0x19b)))return _0x369d94();console[_0x134e09(0x189)]('Request\x20monitor\x20middleware');let _0x30da50=Date[_0x134e09(0x1b8)](),_0x436a34=Math[_0x134e09(0x188)](_0x30da50/0x3e8/0x3c);console[_0x134e09(0x189)](_0x134e09(0x1ab));const _0x8bf3ad=_0x4c5a59[_0x134e09(0x176)];_0x4c5a59[_0x134e09(0x176)]=(..._0x171f67)=>{const _0x398687=_0x134e09;console['log'](_0x436a34,{'currentMinute':_0x436a34});_0x436a34>RequestMonitor['lastMinute']&&(RequestMonitor[_0x398687(0x17b)][_0x398687(0x193)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x398687(0x17a)]}),RequestMonitor[_0x398687(0x17a)]=0x0,RequestMonitor[_0x398687(0x18a)]=_0x436a34);RequestMonitor[_0x398687(0x17a)]++,RequestMonitor[_0x398687(0x180)][_0x398687(0x193)]({'timestamp':Date[_0x398687(0x1b8)](),'statusCode':_0x4c5a59[_0x398687(0x1b0)],'path':_0x515273[_0x398687(0x174)],'method':_0x515273[_0x398687(0x17f)]});const _0x49a76f=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x398687(0x180)]=RequestMonitor[_0x398687(0x180)][_0x398687(0x171)](_0xa49179=>_0xa49179[_0x398687(0x175)]>_0x49a76f),_0x8bf3ad[_0x398687(0x1ae)](_0x4c5a59,_0x171f67);},_0x369d94();}static async['save'](){const _0x43839c=a1_0x12f270;try{RequestMonitor[_0x43839c(0x18a)]!==Math[_0x43839c(0x188)](Date[_0x43839c(0x1b8)]()/0x3e8/0x3c)&&(RequestMonitor[_0x43839c(0x17b)][_0x43839c(0x193)]({'timestamp':RequestMonitor[_0x43839c(0x18a)]*0x3e8*0x3c,'requests':RequestMonitor[_0x43839c(0x17a)]}),RequestMonitor[_0x43839c(0x17a)]=0x0,RequestMonitor[_0x43839c(0x18a)]=Math['floor'](Date['now']()/0x3e8/0x3c)),await fs['writeFile'](RequestMonitor[_0x43839c(0x18f)],JSON[_0x43839c(0x1a6)](RequestMonitor[_0x43839c(0x17b)],null,0x2)),await fs[_0x43839c(0x191)](RequestMonitor['httpCodesStoragePath'],JSON[_0x43839c(0x1a6)](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x1893a3){console['error'](_0x43839c(0x1b3),_0x1893a3);}}static async[a1_0x12f270(0x18b)](){const _0x4d0cce=a1_0x12f270;setInterval(()=>RequestMonitor[_0x4d0cce(0x19c)](),0x3c*0x3e8),setInterval(()=>{const _0x319087=_0x4d0cce;RequestMonitor['getUsageRessourcesStatsAndSave']()[_0x319087(0x18d)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x4d0cce(0x17c)]()[_0x4d0cce(0x18d)](()=>{});}static async[a1_0x12f270(0x17c)](){const _0x223b1a=a1_0x12f270,_0x4602e8=osu[_0x223b1a(0x1b5)],_0x194a8b=osu[_0x223b1a(0x19f)],_0xe4c80b=osu[_0x223b1a(0x185)],_0x34d1cc={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x481898=await _0xe4c80b[_0x223b1a(0x187)]();_0x34d1cc[_0x223b1a(0x1b1)][_0x223b1a(0x179)]=_0x481898[_0x223b1a(0x1b1)][_0x223b1a(0x179)],_0x34d1cc[_0x223b1a(0x1b1)][_0x223b1a(0x178)]=_0x481898[_0x223b1a(0x1b1)]['outputMb'];}catch(_0x23d3ba){}let _0x32569c=0x0;try{_0x32569c=await _0x4602e8[_0x223b1a(0x1b4)]();}catch(_0x3bf62c){console[_0x223b1a(0x189)](_0x223b1a(0x182),_0x3bf62c);}const _0x132e3b={'usedMemMb':0x0};try{const _0x51cbc2=await _0x194a8b[_0x223b1a(0x196)]();_0x132e3b[_0x223b1a(0x18e)]=_0x51cbc2[_0x223b1a(0x18e)];}catch(_0x3e3b9d){console[_0x223b1a(0x189)](_0x223b1a(0x181),_0x3e3b9d);}const _0x2f0814=new Date()[_0x223b1a(0x17e)]()['toString']()['padStart'](0x2,'0')+':'+new Date()['getMinutes']()['toString']()[_0x223b1a(0x1b7)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x223b1a(0x1b5)]=RequestMonitor[_0x223b1a(0x183)]['cpu'][_0x223b1a(0x19e)](-0x3c)[_0x223b1a(0x171)](_0x3a4fab=>_0x3a4fab[_0x223b1a(0x198)]!==_0x2f0814),RequestMonitor[_0x223b1a(0x183)][_0x223b1a(0x1a4)]=RequestMonitor[_0x223b1a(0x183)][_0x223b1a(0x1a4)][_0x223b1a(0x19e)](-0x3c)['filter'](_0x35c82a=>_0x35c82a['time']!==_0x2f0814),RequestMonitor['ressourcesUsageStats'][_0x223b1a(0x1aa)]=RequestMonitor['ressourcesUsageStats'][_0x223b1a(0x1aa)][_0x223b1a(0x19e)](-0x3c)[_0x223b1a(0x171)](_0x549d13=>_0x549d13[_0x223b1a(0x198)]!==_0x2f0814),RequestMonitor[_0x223b1a(0x183)]['cpu']['push']({'time':_0x2f0814,'usage':_0x32569c}),RequestMonitor[_0x223b1a(0x183)][_0x223b1a(0x1a4)][_0x223b1a(0x193)]({'time':_0x2f0814,'usage':(_0x132e3b['usedMemMb']/0x3e8)[_0x223b1a(0x16f)](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x223b1a(0x1aa)][_0x223b1a(0x193)]({'time':_0x2f0814,'usage':{'in':_0x34d1cc[_0x223b1a(0x1b1)]?.[_0x223b1a(0x179)]??0x0,'out':_0x34d1cc['total']?.[_0x223b1a(0x178)]??0x0}});try{await fs[_0x223b1a(0x191)](RequestMonitor[_0x223b1a(0x172)],JSON[_0x223b1a(0x1a6)](RequestMonitor[_0x223b1a(0x183)],null,0x2));}catch(_0x493976){console[_0x223b1a(0x1a5)](_0x223b1a(0x1b3),_0x493976);}}static[a1_0x12f270(0x1b2)](){const _0x9ee476=a1_0x12f270,_0x4cf234=Date['now'](),_0x534d00=_0x4cf234-0x3c*0x3c*0x3e8,_0x1bc8d6=_0x4cf234-0x18*0x3c*0x3c*0x3e8,_0x3edfe3=RequestMonitor[_0x9ee476(0x17b)][_0x9ee476(0x171)](_0x3ffb54=>_0x3ffb54[_0x9ee476(0x175)]>_0x534d00),_0x158533={'total':RequestMonitor['httpCodesData'][_0x9ee476(0x19a)],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x9ee476(0x1a3)](_0x74dd03=>{const _0x44ebe7=_0x9ee476;_0x158533['byCodes'][_0x74dd03[_0x44ebe7(0x1b0)]]=(_0x158533[_0x44ebe7(0x1b6)][_0x74dd03[_0x44ebe7(0x1b0)]]||0x0)+0x1;const _0x1f93fa=_0x74dd03['method']+'\x20'+_0x74dd03[_0x44ebe7(0x174)];!_0x158533[_0x44ebe7(0x1ba)][_0x1f93fa]&&(_0x158533[_0x44ebe7(0x1ba)][_0x1f93fa]={'total':0x0,'codes':{}}),_0x158533['byPath'][_0x1f93fa][_0x44ebe7(0x1b1)]++,_0x158533[_0x44ebe7(0x1ba)][_0x1f93fa][_0x44ebe7(0x1ad)][_0x74dd03[_0x44ebe7(0x1b0)]]=(_0x158533[_0x44ebe7(0x1ba)][_0x1f93fa][_0x44ebe7(0x1ad)][_0x74dd03['statusCode']]||0x0)+0x1;}),{'rps':_0x3edfe3,'httpCodes':_0x158533,'ressourcesUsageStats':RequestMonitor[_0x9ee476(0x183)]};}}RequestMonitor['init']()[a1_0x12f270(0x18d)](()=>{}),RequestMonitor[a1_0x12f270(0x18b)]();const counter=RequestMonitor;module[a1_0x12f270(0x1a2)]=counter;