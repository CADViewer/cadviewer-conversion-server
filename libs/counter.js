const a1_0xa3b2cc=a1_0x1971;(function(_0x306509,_0xa0f9ab){const _0x304a6c=a1_0x1971,_0x1c10f8=_0x306509();while(!![]){try{const _0x5bfe73=parseInt(_0x304a6c(0x1cb))/0x1*(parseInt(_0x304a6c(0x1c2))/0x2)+parseInt(_0x304a6c(0x1d5))/0x3*(-parseInt(_0x304a6c(0x1f2))/0x4)+parseInt(_0x304a6c(0x1bf))/0x5*(parseInt(_0x304a6c(0x1f7))/0x6)+parseInt(_0x304a6c(0x1d9))/0x7*(parseInt(_0x304a6c(0x1d4))/0x8)+parseInt(_0x304a6c(0x1c9))/0x9*(parseInt(_0x304a6c(0x1d0))/0xa)+parseInt(_0x304a6c(0x1bc))/0xb*(-parseInt(_0x304a6c(0x1f8))/0xc)+-parseInt(_0x304a6c(0x1d8))/0xd*(parseInt(_0x304a6c(0x1e4))/0xe);if(_0x5bfe73===_0xa0f9ab)break;else _0x1c10f8['push'](_0x1c10f8['shift']());}catch(_0x43adba){_0x1c10f8['push'](_0x1c10f8['shift']());}}}(a1_0x5995,0xdfab5));const fs=require('fs')['promises'],osu=require(a1_0xa3b2cc(0x1e0));class RequestMonitor{static [a1_0xa3b2cc(0x1f3)]=a1_0xa3b2cc(0x1f1);static ['httpCodesStoragePath']='cadviewer/settings/http-codes-24h.json';static [a1_0xa3b2cc(0x1bb)]='cadviewer/settings/ressources-usage-stats.json';static ['rpsData']=[];static [a1_0xa3b2cc(0x1c7)]=[];static [a1_0xa3b2cc(0x1f9)]={};static ['lastMinute']=Math[a1_0xa3b2cc(0x1c4)](Date[a1_0xa3b2cc(0x1d3)]()/0x3e8/0x3c);static ['currentRequests']=0x0;static async[a1_0xa3b2cc(0x1cd)](){const _0x4dd54b=a1_0xa3b2cc;console[_0x4dd54b(0x1b0)](_0x4dd54b(0x1fb));try{const _0x16b573=await fs[_0x4dd54b(0x1e9)](RequestMonitor[_0x4dd54b(0x1f3)],_0x4dd54b(0x1ef));RequestMonitor[_0x4dd54b(0x1d7)]=JSON[_0x4dd54b(0x1e3)](_0x16b573);}catch(_0x1073d6){RequestMonitor['rpsData']=[];}try{const _0x49b622=await fs[_0x4dd54b(0x1e9)](RequestMonitor['httpCodesStoragePath'],_0x4dd54b(0x1ef));RequestMonitor[_0x4dd54b(0x1c7)]=JSON[_0x4dd54b(0x1e3)](_0x49b622);}catch(_0x188d5c){RequestMonitor[_0x4dd54b(0x1c7)]=[];}try{const _0xa8424b=await fs[_0x4dd54b(0x1e9)](RequestMonitor[_0x4dd54b(0x1bb)],_0x4dd54b(0x1ef));RequestMonitor[_0x4dd54b(0x1f9)]=JSON['parse'](_0xa8424b),!RequestMonitor[_0x4dd54b(0x1f9)][_0x4dd54b(0x1de)]&&(RequestMonitor['ressourcesUsageStats'][_0x4dd54b(0x1de)]=[]),!RequestMonitor[_0x4dd54b(0x1f9)][_0x4dd54b(0x1ea)]&&(RequestMonitor[_0x4dd54b(0x1f9)][_0x4dd54b(0x1ea)]=[]),!RequestMonitor[_0x4dd54b(0x1f9)][_0x4dd54b(0x1c6)]&&(RequestMonitor[_0x4dd54b(0x1f9)][_0x4dd54b(0x1c6)]=[]);}catch(_0x4f9a7){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console['log'](_0x4dd54b(0x1fa));}static[a1_0xa3b2cc(0x1f6)](_0xa5bd57,_0x1800a4,_0x753e06){const _0xd9e0a0=a1_0xa3b2cc;if(_0xa5bd57['path'][_0xd9e0a0(0x1c0)]('/metrics'))return _0x753e06();console[_0xd9e0a0(0x1b0)](_0xd9e0a0(0x1e2));let _0x5ca771=Date['now'](),_0x5c9465=Math[_0xd9e0a0(0x1c4)](_0x5ca771/0x3e8/0x3c);console['log'](_0xd9e0a0(0x1b7));const _0x3a73f9=_0x1800a4['end'];_0x1800a4[_0xd9e0a0(0x1bd)]=(..._0x1648e1)=>{const _0x25c2c9=_0xd9e0a0;console['log'](_0x5c9465,{'currentMinute':_0x5c9465});_0x5c9465>RequestMonitor[_0x25c2c9(0x1b8)]&&(RequestMonitor[_0x25c2c9(0x1d7)][_0x25c2c9(0x1c8)]({'timestamp':RequestMonitor[_0x25c2c9(0x1b8)]*0x3e8*0x3c,'requests':RequestMonitor[_0x25c2c9(0x1e8)]}),RequestMonitor[_0x25c2c9(0x1e8)]=0x0,RequestMonitor['lastMinute']=_0x5c9465);RequestMonitor['currentRequests']++,RequestMonitor['httpCodesData'][_0x25c2c9(0x1c8)]({'timestamp':Date['now'](),'statusCode':_0x1800a4[_0x25c2c9(0x1ee)],'path':_0xa5bd57[_0x25c2c9(0x1f5)],'method':_0xa5bd57['method']});const _0x3b2c19=Date[_0x25c2c9(0x1d3)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x25c2c9(0x1c7)]=RequestMonitor[_0x25c2c9(0x1c7)][_0x25c2c9(0x1cc)](_0x555008=>_0x555008[_0x25c2c9(0x1c3)]>_0x3b2c19),_0x3a73f9[_0x25c2c9(0x1b6)](_0x1800a4,_0x1648e1);},_0x753e06();}static async[a1_0xa3b2cc(0x1e5)](){const _0x2f57e5=a1_0xa3b2cc;try{RequestMonitor['lastMinute']!==Math[_0x2f57e5(0x1c4)](Date[_0x2f57e5(0x1d3)]()/0x3e8/0x3c)&&(RequestMonitor[_0x2f57e5(0x1d7)]['push']({'timestamp':RequestMonitor[_0x2f57e5(0x1b8)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x2f57e5(0x1e8)]=0x0,RequestMonitor[_0x2f57e5(0x1b8)]=Math[_0x2f57e5(0x1c4)](Date['now']()/0x3e8/0x3c)),await fs['writeFile'](RequestMonitor[_0x2f57e5(0x1f3)],JSON[_0x2f57e5(0x1b1)](RequestMonitor[_0x2f57e5(0x1d7)],null,0x2)),await fs[_0x2f57e5(0x1f0)](RequestMonitor['httpCodesStoragePath'],JSON[_0x2f57e5(0x1b1)](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x2f0337){console[_0x2f57e5(0x1d1)]('Error\x20saving\x20monitoring\x20data:',_0x2f0337);}}static async[a1_0xa3b2cc(0x1eb)](){const _0x4e8ac6=a1_0xa3b2cc;setInterval(()=>RequestMonitor[_0x4e8ac6(0x1e5)](),0x3c*0x3e8),setInterval(()=>{const _0x521004=_0x4e8ac6;RequestMonitor[_0x521004(0x1c5)]()[_0x521004(0x1e6)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x4e8ac6(0x1c5)]()[_0x4e8ac6(0x1e6)](()=>{});}static async[a1_0xa3b2cc(0x1c5)](){const _0x2191b0=a1_0xa3b2cc,_0xae4edf=osu[_0x2191b0(0x1de)],_0x2b2003=osu['mem'],_0x523aa4=osu[_0x2191b0(0x1ed)],_0x18d012={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x624e48=await _0x523aa4[_0x2191b0(0x1da)]();_0x18d012[_0x2191b0(0x1b3)][_0x2191b0(0x1ca)]=_0x624e48['total'][_0x2191b0(0x1ca)],_0x18d012['total'][_0x2191b0(0x1ec)]=_0x624e48[_0x2191b0(0x1b3)][_0x2191b0(0x1ec)];}catch(_0x38e9c6){}let _0x46bb8e=0x0;try{_0x46bb8e=await _0xae4edf['usage']();}catch(_0x121a14){console['log'](_0x2191b0(0x1b9),_0x121a14);}const _0xa01675={'usedMemMb':0x0};try{const _0x2106a0=await _0x2b2003[_0x2191b0(0x1db)]();_0xa01675['usedMemMb']=_0x2106a0[_0x2191b0(0x1ce)];}catch(_0x368646){console['log'](_0x2191b0(0x1dc),_0x368646);}const _0xfcb209=new Date()[_0x2191b0(0x1dd)]()[_0x2191b0(0x1e1)]()[_0x2191b0(0x1d6)](0x2,'0')+':'+new Date()['getMinutes']()['toString']()[_0x2191b0(0x1d6)](0x2,'0');RequestMonitor[_0x2191b0(0x1f9)]['cpu']=RequestMonitor[_0x2191b0(0x1f9)][_0x2191b0(0x1de)]['slice'](-0x3c)[_0x2191b0(0x1cc)](_0x3c26ee=>_0x3c26ee['time']!==_0xfcb209),RequestMonitor['ressourcesUsageStats'][_0x2191b0(0x1ea)]=RequestMonitor['ressourcesUsageStats'][_0x2191b0(0x1ea)][_0x2191b0(0x1c1)](-0x3c)['filter'](_0x3e025e=>_0x3e025e[_0x2191b0(0x1b5)]!==_0xfcb209),RequestMonitor[_0x2191b0(0x1f9)][_0x2191b0(0x1c6)]=RequestMonitor['ressourcesUsageStats'][_0x2191b0(0x1c6)]['slice'](-0x3c)[_0x2191b0(0x1cc)](_0x584a16=>_0x584a16[_0x2191b0(0x1b5)]!==_0xfcb209),RequestMonitor[_0x2191b0(0x1f9)][_0x2191b0(0x1de)]['push']({'time':_0xfcb209,'usage':_0x46bb8e}),RequestMonitor[_0x2191b0(0x1f9)][_0x2191b0(0x1ea)][_0x2191b0(0x1c8)]({'time':_0xfcb209,'usage':(_0xa01675[_0x2191b0(0x1ce)]/0x3e8)[_0x2191b0(0x1cf)](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x2191b0(0x1c6)][_0x2191b0(0x1c8)]({'time':_0xfcb209,'usage':{'in':_0x18d012[_0x2191b0(0x1b3)]?.[_0x2191b0(0x1ca)]??0x0,'out':_0x18d012[_0x2191b0(0x1b3)]?.[_0x2191b0(0x1ec)]??0x0}});try{await fs[_0x2191b0(0x1f0)](RequestMonitor[_0x2191b0(0x1bb)],JSON[_0x2191b0(0x1b1)](RequestMonitor[_0x2191b0(0x1f9)],null,0x2));}catch(_0x59d490){console['error'](_0x2191b0(0x1df),_0x59d490);}}static[a1_0xa3b2cc(0x1ba)](){const _0x28fef1=a1_0xa3b2cc,_0x3dc208=Date['now'](),_0x3b4f7b=_0x3dc208-0x3c*0x3c*0x3e8,_0x3a0b7d=_0x3dc208-0x18*0x3c*0x3c*0x3e8,_0x53e5bc=RequestMonitor[_0x28fef1(0x1d7)][_0x28fef1(0x1cc)](_0x3760e3=>_0x3760e3[_0x28fef1(0x1c3)]>_0x3b4f7b),_0xddeae6={'total':RequestMonitor['httpCodesData'][_0x28fef1(0x1e7)],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x28fef1(0x1d2)](_0x6827b0=>{const _0x98a35=_0x28fef1;_0xddeae6['byCodes'][_0x6827b0[_0x98a35(0x1ee)]]=(_0xddeae6[_0x98a35(0x1f4)][_0x6827b0[_0x98a35(0x1ee)]]||0x0)+0x1;const _0x58329a=_0x6827b0[_0x98a35(0x1b4)]+'\x20'+_0x6827b0[_0x98a35(0x1f5)];!_0xddeae6[_0x98a35(0x1be)][_0x58329a]&&(_0xddeae6[_0x98a35(0x1be)][_0x58329a]={'total':0x0,'codes':{}}),_0xddeae6[_0x98a35(0x1be)][_0x58329a][_0x98a35(0x1b3)]++,_0xddeae6['byPath'][_0x58329a][_0x98a35(0x1b2)][_0x6827b0['statusCode']]=(_0xddeae6[_0x98a35(0x1be)][_0x58329a][_0x98a35(0x1b2)][_0x6827b0[_0x98a35(0x1ee)]]||0x0)+0x1;}),{'rps':_0x53e5bc,'httpCodes':_0xddeae6,'ressourcesUsageStats':RequestMonitor[_0x28fef1(0x1f9)]};}}function a1_0x5995(){const _0x50dec2=['20098403IICLTh','238YqamSE','inOut','info','Error\x20getting\x20memory\x20usage:','getHours','cpu','Error\x20saving\x20monitoring\x20data:','node-os-utils','toString','Request\x20monitor\x20middleware','parse','14APoHad','save','then','length','currentRequests','readFile','memory','startPeriodicSave','outputMb','netstat','statusCode','utf8','writeFile','cadviewer/settings/requests-per-minute.json','16PlTMuE','rpsStoragePath','byCodes','path','middleware','1929822QWfroK','1117968ThTjHj','ressourcesUsageStats','Request\x20monitor\x20initialized.','Initializing\x20request\x20monitor...','log','stringify','codes','total','method','time','apply','=======>','lastMinute','Error\x20getting\x20CPU\x20usage:','getStats','ressourcesUsageStatsPath','22SxPIel','end','byPath','5RpnLxS','includes','slice','659698hYKLzX','timestamp','floor','getUsageRessourcesStatsAndSave','network','httpCodesData','push','153369yazoEI','inputMb','2iVcnXh','filter','init','usedMemMb','toFixed','670VxcLDD','error','forEach','now','264568khJImO','449241PcPnCG','padStart','rpsData'];a1_0x5995=function(){return _0x50dec2;};return a1_0x5995();}RequestMonitor[a1_0xa3b2cc(0x1cd)]()[a1_0xa3b2cc(0x1e6)](()=>{}),RequestMonitor[a1_0xa3b2cc(0x1eb)]();function a1_0x1971(_0x5b6340,_0x5bec02){const _0x5995c2=a1_0x5995();return a1_0x1971=function(_0x19718c,_0x44596d){_0x19718c=_0x19718c-0x1b0;let _0x476817=_0x5995c2[_0x19718c];return _0x476817;},a1_0x1971(_0x5b6340,_0x5bec02);}const counter=RequestMonitor;module['exports']=counter;