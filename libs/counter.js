const a1_0x22083a=a1_0x63c8;(function(_0x2c03d0,_0x20e53c){const _0x1ba2c5=a1_0x63c8,_0x193293=_0x2c03d0();while(!![]){try{const _0x574427=parseInt(_0x1ba2c5(0x15d))/0x1*(parseInt(_0x1ba2c5(0x13b))/0x2)+-parseInt(_0x1ba2c5(0x135))/0x3*(parseInt(_0x1ba2c5(0x12c))/0x4)+-parseInt(_0x1ba2c5(0x13e))/0x5*(-parseInt(_0x1ba2c5(0x169))/0x6)+-parseInt(_0x1ba2c5(0x166))/0x7+parseInt(_0x1ba2c5(0x154))/0x8+-parseInt(_0x1ba2c5(0x127))/0x9+-parseInt(_0x1ba2c5(0x136))/0xa;if(_0x574427===_0x20e53c)break;else _0x193293['push'](_0x193293['shift']());}catch(_0x29c777){_0x193293['push'](_0x193293['shift']());}}}(a1_0x1070,0x45091));const fs=require('fs')[a1_0x22083a(0x14b)],osu=require('node-os-utils');function a1_0x63c8(_0x1b8455,_0x4ba00c){const _0x1070f8=a1_0x1070();return a1_0x63c8=function(_0x63c87d,_0x3e4e93){_0x63c87d=_0x63c87d-0x127;let _0x951078=_0x1070f8[_0x63c87d];return _0x951078;},a1_0x63c8(_0x1b8455,_0x4ba00c);}class RequestMonitor{static [a1_0x22083a(0x163)]='cadviewer/settings/requests-per-minute.json';static ['httpCodesStoragePath']='cadviewer/settings/http-codes-24h.json';static ['ressourcesUsageStatsPath']='cadviewer/settings/ressources-usage-stats.json';static [a1_0x22083a(0x137)]=[];static [a1_0x22083a(0x138)]=[];static [a1_0x22083a(0x16a)]={};static [a1_0x22083a(0x148)]=Math[a1_0x22083a(0x141)](Date[a1_0x22083a(0x157)]()/0x3e8/0x3c);static [a1_0x22083a(0x144)]=0x0;static async[a1_0x22083a(0x158)](){const _0x2dd4fc=a1_0x22083a;console[_0x2dd4fc(0x143)](_0x2dd4fc(0x131));try{const _0x2409f4=await fs[_0x2dd4fc(0x16b)](RequestMonitor[_0x2dd4fc(0x163)],_0x2dd4fc(0x132));RequestMonitor[_0x2dd4fc(0x137)]=JSON[_0x2dd4fc(0x146)](_0x2409f4);}catch(_0x271cd7){RequestMonitor['rpsData']=[];}try{const _0x440c02=await fs['readFile'](RequestMonitor[_0x2dd4fc(0x142)],'utf8');RequestMonitor[_0x2dd4fc(0x138)]=JSON[_0x2dd4fc(0x146)](_0x440c02);}catch(_0x31533e){RequestMonitor[_0x2dd4fc(0x138)]=[];}try{const _0x20b5d1=await fs['readFile'](RequestMonitor['ressourcesUsageStatsPath'],_0x2dd4fc(0x132));RequestMonitor[_0x2dd4fc(0x16a)]=JSON[_0x2dd4fc(0x146)](_0x20b5d1),!RequestMonitor[_0x2dd4fc(0x16a)][_0x2dd4fc(0x12e)]&&(RequestMonitor[_0x2dd4fc(0x16a)][_0x2dd4fc(0x12e)]=[]),!RequestMonitor[_0x2dd4fc(0x16a)][_0x2dd4fc(0x13c)]&&(RequestMonitor[_0x2dd4fc(0x16a)]['memory']=[]),!RequestMonitor['ressourcesUsageStats'][_0x2dd4fc(0x134)]&&(RequestMonitor[_0x2dd4fc(0x16a)][_0x2dd4fc(0x134)]=[]);}catch(_0x3f8f2e){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console['log'](_0x2dd4fc(0x128));}static[a1_0x22083a(0x162)](_0x436005,_0x474fa7,_0x1369fe){const _0x1e3aa1=a1_0x22083a;if(_0x436005['path'][_0x1e3aa1(0x155)]('/metrics'))return _0x1369fe();console[_0x1e3aa1(0x143)](_0x1e3aa1(0x150));let _0x2c4f55=Date[_0x1e3aa1(0x157)](),_0x2d61c=Math[_0x1e3aa1(0x141)](_0x2c4f55/0x3e8/0x3c);console[_0x1e3aa1(0x143)](_0x1e3aa1(0x12d));const _0x2d4948=_0x474fa7[_0x1e3aa1(0x156)];_0x474fa7[_0x1e3aa1(0x156)]=(..._0x579cfb)=>{const _0x13259a=_0x1e3aa1;console[_0x13259a(0x143)](_0x2d61c,{'currentMinute':_0x2d61c});_0x2d61c>RequestMonitor[_0x13259a(0x148)]&&(RequestMonitor['rpsData']['push']({'timestamp':RequestMonitor[_0x13259a(0x148)]*0x3e8*0x3c,'requests':RequestMonitor[_0x13259a(0x144)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x13259a(0x148)]=_0x2d61c);RequestMonitor[_0x13259a(0x144)]++,RequestMonitor[_0x13259a(0x138)]['push']({'timestamp':Date[_0x13259a(0x157)](),'statusCode':_0x474fa7[_0x13259a(0x129)],'path':_0x436005[_0x13259a(0x153)],'method':_0x436005['method']});const _0x271bfd=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x13259a(0x138)]=RequestMonitor[_0x13259a(0x138)]['filter'](_0x4ea356=>_0x4ea356['timestamp']>_0x271bfd),_0x2d4948[_0x13259a(0x167)](_0x474fa7,_0x579cfb);},_0x1369fe();}static async[a1_0x22083a(0x13f)](){const _0x4d2e02=a1_0x22083a;try{RequestMonitor['lastMinute']!==Math['floor'](Date[_0x4d2e02(0x157)]()/0x3e8/0x3c)&&(RequestMonitor[_0x4d2e02(0x137)][_0x4d2e02(0x14d)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x4d2e02(0x144)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x4d2e02(0x148)]=Math[_0x4d2e02(0x141)](Date[_0x4d2e02(0x157)]()/0x3e8/0x3c)),await fs[_0x4d2e02(0x15f)](RequestMonitor['rpsStoragePath'],JSON['stringify'](RequestMonitor[_0x4d2e02(0x137)],null,0x2)),await fs['writeFile'](RequestMonitor[_0x4d2e02(0x142)],JSON['stringify'](RequestMonitor[_0x4d2e02(0x138)],null,0x2));}catch(_0x30de35){console[_0x4d2e02(0x13d)](_0x4d2e02(0x14e),_0x30de35);}}static async[a1_0x22083a(0x133)](){const _0x3c369e=a1_0x22083a;setInterval(()=>RequestMonitor[_0x3c369e(0x13f)](),0x3c*0x3e8),setInterval(()=>{const _0x433080=_0x3c369e;RequestMonitor[_0x433080(0x159)]()['then'](()=>{});},0x3c*0x3e8),RequestMonitor['getUsageRessourcesStatsAndSave']()[_0x3c369e(0x160)](()=>{});}static async[a1_0x22083a(0x159)](){const _0x10a1c5=a1_0x22083a,_0x5a4964=osu[_0x10a1c5(0x12e)],_0x1ef488=osu['mem'],_0x5b817b=osu[_0x10a1c5(0x15e)],_0x485aa1={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x814dff=await _0x5b817b['inOut']();_0x485aa1['total'][_0x10a1c5(0x14a)]=_0x814dff[_0x10a1c5(0x14c)][_0x10a1c5(0x14a)],_0x485aa1[_0x10a1c5(0x14c)]['outputMb']=_0x814dff[_0x10a1c5(0x14c)][_0x10a1c5(0x168)];}catch(_0x2cd996){}let _0x1ef7a9=0x0;try{_0x1ef7a9=await _0x5a4964[_0x10a1c5(0x165)]();}catch(_0x358cb2){console[_0x10a1c5(0x143)](_0x10a1c5(0x164),_0x358cb2);}const _0xa00b40={'usedMemMb':0x0};try{const _0x4a0c7a=await _0x1ef488['info']();_0xa00b40['usedMemMb']=_0x4a0c7a[_0x10a1c5(0x15a)];}catch(_0x369b23){console[_0x10a1c5(0x143)](_0x10a1c5(0x149),_0x369b23);}const _0x3669e2=new Date()[_0x10a1c5(0x12f)]()[_0x10a1c5(0x130)]()[_0x10a1c5(0x15c)](0x2,'0')+':'+new Date()[_0x10a1c5(0x151)]()[_0x10a1c5(0x130)]()[_0x10a1c5(0x15c)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x10a1c5(0x12e)]=RequestMonitor[_0x10a1c5(0x16a)][_0x10a1c5(0x12e)][_0x10a1c5(0x161)](-0x3c)['filter'](_0x5873b9=>_0x5873b9[_0x10a1c5(0x14f)]!==_0x3669e2),RequestMonitor[_0x10a1c5(0x16a)][_0x10a1c5(0x13c)]=RequestMonitor['ressourcesUsageStats'][_0x10a1c5(0x13c)][_0x10a1c5(0x161)](-0x3c)[_0x10a1c5(0x12a)](_0x34ea23=>_0x34ea23[_0x10a1c5(0x14f)]!==_0x3669e2),RequestMonitor[_0x10a1c5(0x16a)][_0x10a1c5(0x134)]=RequestMonitor[_0x10a1c5(0x16a)][_0x10a1c5(0x134)][_0x10a1c5(0x161)](-0x3c)[_0x10a1c5(0x12a)](_0x2ac613=>_0x2ac613[_0x10a1c5(0x14f)]!==_0x3669e2),RequestMonitor[_0x10a1c5(0x16a)][_0x10a1c5(0x12e)][_0x10a1c5(0x14d)]({'time':_0x3669e2,'usage':_0x1ef7a9}),RequestMonitor['ressourcesUsageStats'][_0x10a1c5(0x13c)][_0x10a1c5(0x14d)]({'time':_0x3669e2,'usage':(_0xa00b40[_0x10a1c5(0x15a)]/0x3e8)[_0x10a1c5(0x152)](0x2)}),RequestMonitor[_0x10a1c5(0x16a)][_0x10a1c5(0x134)]['push']({'time':_0x3669e2,'usage':{'in':_0x485aa1['total']?.[_0x10a1c5(0x14a)]??0x0,'out':_0x485aa1['total']?.[_0x10a1c5(0x168)]??0x0}});try{await fs[_0x10a1c5(0x15f)](RequestMonitor[_0x10a1c5(0x15b)],JSON['stringify'](RequestMonitor[_0x10a1c5(0x16a)],null,0x2));}catch(_0x21d5d3){console['error'](_0x10a1c5(0x14e),_0x21d5d3);}}static[a1_0x22083a(0x147)](){const _0x34e25d=a1_0x22083a,_0x2bb09b=Date[_0x34e25d(0x157)](),_0x4d55ba=_0x2bb09b-0x3c*0x3c*0x3e8,_0x36ab90=_0x2bb09b-0x18*0x3c*0x3c*0x3e8,_0x267fa7=RequestMonitor[_0x34e25d(0x137)][_0x34e25d(0x12a)](_0xb8b197=>_0xb8b197[_0x34e25d(0x13a)]>_0x4d55ba),_0x4c2867={'total':RequestMonitor[_0x34e25d(0x138)]['length'],'byCodes':{},'byPath':{}};return RequestMonitor[_0x34e25d(0x138)][_0x34e25d(0x139)](_0x238fec=>{const _0x883d43=_0x34e25d;_0x4c2867['byCodes'][_0x238fec[_0x883d43(0x129)]]=(_0x4c2867['byCodes'][_0x238fec[_0x883d43(0x129)]]||0x0)+0x1;const _0x412b07=_0x238fec['method']+'\x20'+_0x238fec['path'];!_0x4c2867[_0x883d43(0x140)][_0x412b07]&&(_0x4c2867[_0x883d43(0x140)][_0x412b07]={'total':0x0,'codes':{}}),_0x4c2867[_0x883d43(0x140)][_0x412b07][_0x883d43(0x14c)]++,_0x4c2867['byPath'][_0x412b07][_0x883d43(0x145)][_0x238fec[_0x883d43(0x129)]]=(_0x4c2867[_0x883d43(0x140)][_0x412b07]['codes'][_0x238fec[_0x883d43(0x129)]]||0x0)+0x1;}),{'rps':_0x267fa7,'httpCodes':_0x4c2867,'ressourcesUsageStats':RequestMonitor[_0x34e25d(0x16a)]};}}RequestMonitor[a1_0x22083a(0x158)]()['then'](()=>{}),RequestMonitor['startPeriodicSave']();function a1_0x1070(){const _0x40ee23=['save','byPath','floor','httpCodesStoragePath','log','currentRequests','codes','parse','getStats','lastMinute','Error\x20getting\x20memory\x20usage:','inputMb','promises','total','push','Error\x20saving\x20monitoring\x20data:','time','Request\x20monitor\x20middleware','getMinutes','toFixed','path','4377456QFGIkJ','includes','end','now','init','getUsageRessourcesStatsAndSave','usedMemMb','ressourcesUsageStatsPath','padStart','29zziZXu','netstat','writeFile','then','slice','middleware','rpsStoragePath','Error\x20getting\x20CPU\x20usage:','usage','1527988TTZITQ','apply','outputMb','37902TrUAWL','ressourcesUsageStats','readFile','3003732FyzOTE','Request\x20monitor\x20initialized.','statusCode','filter','exports','40fQQRpG','=======>','cpu','getHours','toString','Initializing\x20request\x20monitor...','utf8','startPeriodicSave','network','111327USJEBQ','556140hkRgLS','rpsData','httpCodesData','forEach','timestamp','36194BZpHQk','memory','error','150ViLnIb'];a1_0x1070=function(){return _0x40ee23;};return a1_0x1070();}const counter=RequestMonitor;module[a1_0x22083a(0x12b)]=counter;