const a1_0x20bbd8=a1_0x2dda;(function(_0x1b1e1c,_0x2ba289){const _0x4070ef=a1_0x2dda,_0x504d55=_0x1b1e1c();while(!![]){try{const _0x3a33f4=-parseInt(_0x4070ef(0x230))/0x1*(-parseInt(_0x4070ef(0x207))/0x2)+-parseInt(_0x4070ef(0x212))/0x3*(parseInt(_0x4070ef(0x227))/0x4)+parseInt(_0x4070ef(0x205))/0x5+-parseInt(_0x4070ef(0x22f))/0x6*(parseInt(_0x4070ef(0x1fe))/0x7)+parseInt(_0x4070ef(0x211))/0x8*(-parseInt(_0x4070ef(0x232))/0x9)+-parseInt(_0x4070ef(0x236))/0xa+-parseInt(_0x4070ef(0x216))/0xb*(-parseInt(_0x4070ef(0x203))/0xc);if(_0x3a33f4===_0x2ba289)break;else _0x504d55['push'](_0x504d55['shift']());}catch(_0x15cfa2){_0x504d55['push'](_0x504d55['shift']());}}}(a1_0x517b,0xce15b));const fs=require('fs')[a1_0x20bbd8(0x229)],osu=require(a1_0x20bbd8(0x1ee));function a1_0x2dda(_0xd60192,_0x4aef79){const _0x517b47=a1_0x517b();return a1_0x2dda=function(_0x2dda57,_0x4ae4e7){_0x2dda57=_0x2dda57-0x1e9;let _0x46c028=_0x517b47[_0x2dda57];return _0x46c028;},a1_0x2dda(_0xd60192,_0x4aef79);}class RequestMonitor{static [a1_0x20bbd8(0x20d)]=a1_0x20bbd8(0x1f0);static [a1_0x20bbd8(0x200)]=a1_0x20bbd8(0x1ff);static [a1_0x20bbd8(0x1f9)]=a1_0x20bbd8(0x1f6);static [a1_0x20bbd8(0x1fa)]=[];static [a1_0x20bbd8(0x1f7)]=[];static ['ressourcesUsageStats']={};static [a1_0x20bbd8(0x1f1)]=Math[a1_0x20bbd8(0x1ed)](Date['now']()/0x3e8/0x3c);static [a1_0x20bbd8(0x219)]=0x0;static async[a1_0x20bbd8(0x234)](){const _0x3367a6=a1_0x20bbd8;console[_0x3367a6(0x1f2)](_0x3367a6(0x235));try{const _0x430b5a=await fs[_0x3367a6(0x1ef)](RequestMonitor[_0x3367a6(0x20d)],_0x3367a6(0x20e));RequestMonitor[_0x3367a6(0x1fa)]=JSON[_0x3367a6(0x22d)](_0x430b5a);}catch(_0xf3c963){RequestMonitor['rpsData']=[];}try{const _0x36b8cf=await fs['readFile'](RequestMonitor[_0x3367a6(0x200)],_0x3367a6(0x20e));RequestMonitor[_0x3367a6(0x1f7)]=JSON['parse'](_0x36b8cf);}catch(_0x44943a){RequestMonitor[_0x3367a6(0x1f7)]=[];}try{const _0xdbbd05=await fs[_0x3367a6(0x1ef)](RequestMonitor['ressourcesUsageStatsPath'],_0x3367a6(0x20e));RequestMonitor['ressourcesUsageStats']=JSON[_0x3367a6(0x22d)](_0xdbbd05),!RequestMonitor[_0x3367a6(0x225)][_0x3367a6(0x201)]&&(RequestMonitor[_0x3367a6(0x225)][_0x3367a6(0x201)]=[]),!RequestMonitor[_0x3367a6(0x225)][_0x3367a6(0x21f)]&&(RequestMonitor[_0x3367a6(0x225)]['memory']=[]),!RequestMonitor[_0x3367a6(0x225)]['network']&&(RequestMonitor[_0x3367a6(0x225)]['network']=[]);}catch(_0x4125d1){RequestMonitor[_0x3367a6(0x225)]={'cpu':[],'memory':[],'network':[]};}console[_0x3367a6(0x1f2)](_0x3367a6(0x231));}static[a1_0x20bbd8(0x1fc)](_0x2fa292,_0x2f7933,_0x5670b6){const _0x51cb8b=a1_0x20bbd8;if(_0x2fa292[_0x51cb8b(0x1f8)][_0x51cb8b(0x1e9)](_0x51cb8b(0x204)))return _0x5670b6();console[_0x51cb8b(0x1f2)]('Request\x20monitor\x20middleware');let _0x4da726=Date['now'](),_0x193646=Math[_0x51cb8b(0x1ed)](_0x4da726/0x3e8/0x3c);console[_0x51cb8b(0x1f2)]('=======>');const _0x5fd407=_0x2f7933[_0x51cb8b(0x1fd)];_0x2f7933[_0x51cb8b(0x1fd)]=(..._0x221afe)=>{const _0x1c5803=_0x51cb8b;console['log'](_0x193646,{'currentMinute':_0x193646});_0x193646>RequestMonitor[_0x1c5803(0x1f1)]&&(RequestMonitor[_0x1c5803(0x1fa)][_0x1c5803(0x1f4)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x1c5803(0x219)]}),RequestMonitor[_0x1c5803(0x219)]=0x0,RequestMonitor['lastMinute']=_0x193646);RequestMonitor[_0x1c5803(0x219)]++,RequestMonitor[_0x1c5803(0x1f7)][_0x1c5803(0x1f4)]({'timestamp':Date[_0x1c5803(0x210)](),'statusCode':_0x2f7933[_0x1c5803(0x218)],'path':_0x2fa292[_0x1c5803(0x1f8)],'method':_0x2fa292[_0x1c5803(0x222)]});const _0xad5baf=Date[_0x1c5803(0x210)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor['httpCodesData']['filter'](_0x1767db=>_0x1767db[_0x1c5803(0x20b)]>_0xad5baf),_0x5fd407['apply'](_0x2f7933,_0x221afe);},_0x5670b6();}static async['save'](){const _0x91e740=a1_0x20bbd8;try{RequestMonitor[_0x91e740(0x1f1)]!==Math[_0x91e740(0x1ed)](Date[_0x91e740(0x210)]()/0x3e8/0x3c)&&(RequestMonitor[_0x91e740(0x1fa)]['push']({'timestamp':RequestMonitor[_0x91e740(0x1f1)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x91e740(0x219)]=0x0,RequestMonitor[_0x91e740(0x1f1)]=Math[_0x91e740(0x1ed)](Date[_0x91e740(0x210)]()/0x3e8/0x3c)),await fs[_0x91e740(0x20a)](RequestMonitor['rpsStoragePath'],JSON[_0x91e740(0x22a)](RequestMonitor['rpsData'],null,0x2)),await fs[_0x91e740(0x20a)](RequestMonitor[_0x91e740(0x200)],JSON[_0x91e740(0x22a)](RequestMonitor[_0x91e740(0x1f7)],null,0x2));}catch(_0x116583){console[_0x91e740(0x1ec)](_0x91e740(0x233),_0x116583);}}static async['startPeriodicSave'](){const _0x525a2c=a1_0x20bbd8;setInterval(()=>RequestMonitor[_0x525a2c(0x202)](),0x3c*0x3e8),setInterval(()=>{const _0x140f6f=_0x525a2c;RequestMonitor[_0x140f6f(0x21e)]()[_0x140f6f(0x215)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x525a2c(0x21e)]()[_0x525a2c(0x215)](()=>{});}static async['getUsageRessourcesStatsAndSave'](){const _0x441c1f=a1_0x20bbd8,_0x5b2233=osu[_0x441c1f(0x201)],_0x175aee=osu[_0x441c1f(0x213)],_0x77ca8f=osu[_0x441c1f(0x221)],_0x411208={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x35f82f=await _0x77ca8f[_0x441c1f(0x20c)]();_0x411208[_0x441c1f(0x21d)][_0x441c1f(0x21b)]=_0x35f82f[_0x441c1f(0x21d)][_0x441c1f(0x21b)],_0x411208[_0x441c1f(0x21d)][_0x441c1f(0x1fb)]=_0x35f82f[_0x441c1f(0x21d)][_0x441c1f(0x1fb)];}catch(_0x378f11){}let _0x4fe772=0x0;try{_0x4fe772=await _0x5b2233['usage']();}catch(_0x166a92){console['log'](_0x441c1f(0x22c),_0x166a92);}const _0x29739c={'usedMemMb':0x0};try{const _0x40ea66=await _0x175aee[_0x441c1f(0x220)]();_0x29739c[_0x441c1f(0x1ea)]=_0x40ea66[_0x441c1f(0x1ea)];}catch(_0x4c6915){console['log'](_0x441c1f(0x223),_0x4c6915);}const _0xec26fb=new Date()[_0x441c1f(0x1f5)]()[_0x441c1f(0x214)]()[_0x441c1f(0x206)](0x2,'0')+':'+new Date()[_0x441c1f(0x21c)]()[_0x441c1f(0x214)]()[_0x441c1f(0x206)](0x2,'0');RequestMonitor[_0x441c1f(0x225)][_0x441c1f(0x201)]=RequestMonitor[_0x441c1f(0x225)][_0x441c1f(0x201)][_0x441c1f(0x22b)](-0x3c)['filter'](_0x53b411=>_0x53b411[_0x441c1f(0x208)]!==_0xec26fb),RequestMonitor[_0x441c1f(0x225)][_0x441c1f(0x21f)]=RequestMonitor[_0x441c1f(0x225)][_0x441c1f(0x21f)][_0x441c1f(0x22b)](-0x3c)[_0x441c1f(0x226)](_0x40d3ba=>_0x40d3ba['time']!==_0xec26fb),RequestMonitor[_0x441c1f(0x225)][_0x441c1f(0x22e)]=RequestMonitor[_0x441c1f(0x225)][_0x441c1f(0x22e)]['slice'](-0x3c)[_0x441c1f(0x226)](_0xf5f563=>_0xf5f563[_0x441c1f(0x208)]!==_0xec26fb),RequestMonitor[_0x441c1f(0x225)][_0x441c1f(0x201)][_0x441c1f(0x1f4)]({'time':_0xec26fb,'usage':_0x4fe772}),RequestMonitor['ressourcesUsageStats'][_0x441c1f(0x21f)][_0x441c1f(0x1f4)]({'time':_0xec26fb,'usage':(_0x29739c[_0x441c1f(0x1ea)]/0x3e8)[_0x441c1f(0x224)](0x2)}),RequestMonitor[_0x441c1f(0x225)][_0x441c1f(0x22e)][_0x441c1f(0x1f4)]({'time':_0xec26fb,'usage':{'in':_0x411208[_0x441c1f(0x21d)]?.[_0x441c1f(0x21b)]??0x0,'out':_0x411208['total']?.[_0x441c1f(0x1fb)]??0x0}});try{await fs[_0x441c1f(0x20a)](RequestMonitor['ressourcesUsageStatsPath'],JSON[_0x441c1f(0x22a)](RequestMonitor[_0x441c1f(0x225)],null,0x2));}catch(_0x428d21){console[_0x441c1f(0x1ec)](_0x441c1f(0x233),_0x428d21);}}static[a1_0x20bbd8(0x209)](){const _0x2bd07e=a1_0x20bbd8,_0x190825=Date[_0x2bd07e(0x210)](),_0x2a1725=_0x190825-0x3c*0x3c*0x3e8,_0x2bb872=_0x190825-0x18*0x3c*0x3c*0x3e8,_0x146226=RequestMonitor[_0x2bd07e(0x1fa)]['filter'](_0x4e367c=>_0x4e367c[_0x2bd07e(0x20b)]>_0x2a1725),_0x37e3d0={'total':RequestMonitor[_0x2bd07e(0x1f7)][_0x2bd07e(0x20f)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x2bd07e(0x1f7)][_0x2bd07e(0x21a)](_0x4beb84=>{const _0x217b8f=_0x2bd07e;_0x37e3d0[_0x217b8f(0x217)][_0x4beb84[_0x217b8f(0x218)]]=(_0x37e3d0[_0x217b8f(0x217)][_0x4beb84[_0x217b8f(0x218)]]||0x0)+0x1;const _0x366c94=_0x4beb84['method']+'\x20'+_0x4beb84[_0x217b8f(0x1f8)];!_0x37e3d0['byPath'][_0x366c94]&&(_0x37e3d0[_0x217b8f(0x1f3)][_0x366c94]={'total':0x0,'codes':{}}),_0x37e3d0['byPath'][_0x366c94][_0x217b8f(0x21d)]++,_0x37e3d0[_0x217b8f(0x1f3)][_0x366c94][_0x217b8f(0x228)][_0x4beb84[_0x217b8f(0x218)]]=(_0x37e3d0[_0x217b8f(0x1f3)][_0x366c94][_0x217b8f(0x228)][_0x4beb84[_0x217b8f(0x218)]]||0x0)+0x1;}),{'rps':_0x146226,'httpCodes':_0x37e3d0,'ressourcesUsageStats':RequestMonitor[_0x2bd07e(0x225)]};}}RequestMonitor[a1_0x20bbd8(0x234)]()[a1_0x20bbd8(0x215)](()=>{}),RequestMonitor[a1_0x20bbd8(0x1eb)]();const counter=RequestMonitor;module['exports']=counter;function a1_0x517b(){const _0x47ce8e=['codes','promises','stringify','slice','Error\x20getting\x20CPU\x20usage:','parse','network','6IWaatf','8741joebOn','Request\x20monitor\x20initialized.','45BKNnsg','Error\x20saving\x20monitoring\x20data:','init','Initializing\x20request\x20monitor...','8472860lkTFim','includes','usedMemMb','startPeriodicSave','error','floor','node-os-utils','readFile','cadviewer/settings/requests-per-minute.json','lastMinute','log','byPath','push','getHours','cadviewer/settings/ressources-usage-stats.json','httpCodesData','path','ressourcesUsageStatsPath','rpsData','outputMb','middleware','end','4626566RwCXYc','cadviewer/settings/http-codes-24h.json','httpCodesStoragePath','cpu','save','12526368Ddowxx','/metrics','6893230ourBVM','padStart','68VIsZhI','time','getStats','writeFile','timestamp','inOut','rpsStoragePath','utf8','length','now','2064784oYtpfb','3493785NDiwjs','mem','toString','then','33mxxCzR','byCodes','statusCode','currentRequests','forEach','inputMb','getMinutes','total','getUsageRessourcesStatsAndSave','memory','info','netstat','method','Error\x20getting\x20memory\x20usage:','toFixed','ressourcesUsageStats','filter','4oWAocx'];a1_0x517b=function(){return _0x47ce8e;};return a1_0x517b();}