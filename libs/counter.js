const a1_0x42afdd=a1_0x4188;(function(_0x2e616f,_0x292f21){const _0x570951=a1_0x4188,_0x3c68b0=_0x2e616f();while(!![]){try{const _0x307b26=-parseInt(_0x570951(0x109))/0x1*(parseInt(_0x570951(0x110))/0x2)+parseInt(_0x570951(0x124))/0x3*(parseInt(_0x570951(0x123))/0x4)+-parseInt(_0x570951(0x11d))/0x5+parseInt(_0x570951(0xf2))/0x6*(parseInt(_0x570951(0x126))/0x7)+-parseInt(_0x570951(0x11c))/0x8+parseInt(_0x570951(0xed))/0x9+-parseInt(_0x570951(0x116))/0xa*(-parseInt(_0x570951(0xf7))/0xb);if(_0x307b26===_0x292f21)break;else _0x3c68b0['push'](_0x3c68b0['shift']());}catch(_0x17421b){_0x3c68b0['push'](_0x3c68b0['shift']());}}}(a1_0x163f,0xba4ec));const fs=require('fs')[a1_0x42afdd(0xe7)],osu=require(a1_0x42afdd(0x108));class RequestMonitor{static [a1_0x42afdd(0x129)]='cadviewer/settings/requests-per-minute.json';static [a1_0x42afdd(0x111)]=a1_0x42afdd(0x105);static [a1_0x42afdd(0x125)]=a1_0x42afdd(0x119);static [a1_0x42afdd(0xfd)]=[];static [a1_0x42afdd(0x10e)]=[];static [a1_0x42afdd(0x120)]={};static ['lastMinute']=Math[a1_0x42afdd(0xe4)](Date[a1_0x42afdd(0x128)]()/0x3e8/0x3c);static [a1_0x42afdd(0x101)]=0x0;static async[a1_0x42afdd(0xf6)](){const _0x47b257=a1_0x42afdd;console['log'](_0x47b257(0x112));try{const _0x15fc30=await fs[_0x47b257(0x117)](RequestMonitor['rpsStoragePath'],_0x47b257(0x118));RequestMonitor[_0x47b257(0xfd)]=JSON[_0x47b257(0xf3)](_0x15fc30);}catch(_0x49480b){RequestMonitor['rpsData']=[];}try{const _0x4a7d86=await fs['readFile'](RequestMonitor[_0x47b257(0x111)],_0x47b257(0x118));RequestMonitor['httpCodesData']=JSON['parse'](_0x4a7d86);}catch(_0x4c01c7){RequestMonitor[_0x47b257(0x10e)]=[];}try{const _0x9e96a2=await fs[_0x47b257(0x117)](RequestMonitor[_0x47b257(0x125)],'utf8');RequestMonitor[_0x47b257(0x120)]=JSON[_0x47b257(0xf3)](_0x9e96a2),!RequestMonitor[_0x47b257(0x120)]['cpu']&&(RequestMonitor[_0x47b257(0x120)][_0x47b257(0x103)]=[]),!RequestMonitor[_0x47b257(0x120)][_0x47b257(0xeb)]&&(RequestMonitor[_0x47b257(0x120)][_0x47b257(0xeb)]=[]),!RequestMonitor[_0x47b257(0x120)][_0x47b257(0x12c)]&&(RequestMonitor[_0x47b257(0x120)][_0x47b257(0x12c)]=[]);}catch(_0x2866bb){RequestMonitor[_0x47b257(0x120)]={'cpu':[],'memory':[],'network':[]};}console[_0x47b257(0x122)]('Request\x20monitor\x20initialized.');}static[a1_0x42afdd(0xf8)](_0x2d2b30,_0x29d301,_0x450046){const _0x14cd21=a1_0x42afdd;if(_0x2d2b30[_0x14cd21(0xea)][_0x14cd21(0x11a)](_0x14cd21(0x121)))return _0x450046();console[_0x14cd21(0x122)]('Request\x20monitor\x20middleware');let _0x4169fe=Date[_0x14cd21(0x128)](),_0x373c09=Math['floor'](_0x4169fe/0x3e8/0x3c);console['log'](_0x14cd21(0xec));const _0x56324f=_0x29d301[_0x14cd21(0x102)];_0x29d301['end']=(..._0x55c961)=>{const _0x34f240=_0x14cd21;console[_0x34f240(0x122)](_0x373c09,{'currentMinute':_0x373c09});_0x373c09>RequestMonitor[_0x34f240(0x107)]&&(RequestMonitor[_0x34f240(0xfd)][_0x34f240(0xe5)]({'timestamp':RequestMonitor[_0x34f240(0x107)]*0x3e8*0x3c,'requests':RequestMonitor[_0x34f240(0x101)]}),RequestMonitor[_0x34f240(0x101)]=0x0,RequestMonitor['lastMinute']=_0x373c09);RequestMonitor['currentRequests']++,RequestMonitor['httpCodesData'][_0x34f240(0xe5)]({'timestamp':Date[_0x34f240(0x128)](),'statusCode':_0x29d301[_0x34f240(0x100)],'path':_0x2d2b30[_0x34f240(0xea)],'method':_0x2d2b30[_0x34f240(0xfa)]});const _0x451f6a=Date[_0x34f240(0x128)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x34f240(0x10e)]=RequestMonitor[_0x34f240(0x10e)]['filter'](_0x4adad6=>_0x4adad6[_0x34f240(0x10b)]>_0x451f6a),_0x56324f[_0x34f240(0xff)](_0x29d301,_0x55c961);},_0x450046();}static async[a1_0x42afdd(0xf1)](){const _0x2064ac=a1_0x42afdd;try{RequestMonitor[_0x2064ac(0x107)]!==Math[_0x2064ac(0xe4)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x2064ac(0xfd)][_0x2064ac(0xe5)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x2064ac(0x101)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x2064ac(0x107)]=Math[_0x2064ac(0xe4)](Date['now']()/0x3e8/0x3c)),await fs[_0x2064ac(0xf4)](RequestMonitor[_0x2064ac(0x129)],JSON[_0x2064ac(0xf0)](RequestMonitor['rpsData'],null,0x2)),await fs['writeFile'](RequestMonitor[_0x2064ac(0x111)],JSON[_0x2064ac(0xf0)](RequestMonitor[_0x2064ac(0x10e)],null,0x2));}catch(_0x456c57){console[_0x2064ac(0xe8)]('Error\x20saving\x20monitoring\x20data:',_0x456c57);}}static async['startPeriodicSave'](){const _0x2dd492=a1_0x42afdd;setInterval(()=>RequestMonitor[_0x2dd492(0xf1)](),0x3c*0x3e8),setInterval(()=>{const _0x52108e=_0x2dd492;RequestMonitor['getUsageRessourcesStatsAndSave']()[_0x52108e(0x115)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x2dd492(0xf5)]()['then'](()=>{});}static async[a1_0x42afdd(0xf5)](){const _0x216c22=a1_0x42afdd,_0x22182a=osu[_0x216c22(0x103)],_0x28fe65=osu[_0x216c22(0x10f)],_0x8e0078=osu['netstat'],_0x12a274={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x5603be=await _0x8e0078[_0x216c22(0x127)]();_0x12a274[_0x216c22(0xe6)][_0x216c22(0xee)]=_0x5603be[_0x216c22(0xe6)][_0x216c22(0xee)],_0x12a274[_0x216c22(0xe6)][_0x216c22(0x113)]=_0x5603be['total'][_0x216c22(0x113)];}catch(_0x591350){}let _0x40bd94=0x0;try{_0x40bd94=await _0x22182a['usage']();}catch(_0x54c697){console['log'](_0x216c22(0xfb),_0x54c697);}const _0x105c46={'usedMemMb':0x0};try{const _0x236af4=await _0x28fe65['info']();_0x105c46[_0x216c22(0xf9)]=_0x236af4[_0x216c22(0xf9)];}catch(_0x13f28d){console[_0x216c22(0x122)]('Error\x20getting\x20memory\x20usage:',_0x13f28d);}const _0x177af6=new Date()[_0x216c22(0x12a)]()['toString']()['padStart'](0x2,'0')+':'+new Date()[_0x216c22(0x114)]()['toString']()[_0x216c22(0xe9)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x216c22(0x103)]=RequestMonitor[_0x216c22(0x120)]['cpu'][_0x216c22(0x11b)](-0x3c)['filter'](_0x14da81=>_0x14da81[_0x216c22(0x12b)]!==_0x177af6),RequestMonitor[_0x216c22(0x120)]['memory']=RequestMonitor['ressourcesUsageStats'][_0x216c22(0xeb)][_0x216c22(0x11b)](-0x3c)['filter'](_0x51038f=>_0x51038f[_0x216c22(0x12b)]!==_0x177af6),RequestMonitor['ressourcesUsageStats'][_0x216c22(0x12c)]=RequestMonitor['ressourcesUsageStats'][_0x216c22(0x12c)][_0x216c22(0x11b)](-0x3c)[_0x216c22(0x11e)](_0x4e2165=>_0x4e2165[_0x216c22(0x12b)]!==_0x177af6),RequestMonitor[_0x216c22(0x120)][_0x216c22(0x103)][_0x216c22(0xe5)]({'time':_0x177af6,'usage':_0x40bd94}),RequestMonitor['ressourcesUsageStats']['memory'][_0x216c22(0xe5)]({'time':_0x177af6,'usage':(_0x105c46[_0x216c22(0xf9)]/0x3e8)['toFixed'](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x216c22(0x12c)][_0x216c22(0xe5)]({'time':_0x177af6,'usage':{'in':_0x12a274[_0x216c22(0xe6)]?.[_0x216c22(0xee)]??0x0,'out':_0x12a274[_0x216c22(0xe6)]?.[_0x216c22(0x113)]??0x0}});try{await fs[_0x216c22(0xf4)](RequestMonitor[_0x216c22(0x125)],JSON[_0x216c22(0xf0)](RequestMonitor[_0x216c22(0x120)],null,0x2));}catch(_0x2e82b3){console['error'](_0x216c22(0x104),_0x2e82b3);}}static[a1_0x42afdd(0x11f)](){const _0x4afc48=a1_0x42afdd,_0x8f7bcd=Date[_0x4afc48(0x128)](),_0x46f939=_0x8f7bcd-0x3c*0x3c*0x3e8,_0x8a053c=_0x8f7bcd-0x18*0x3c*0x3c*0x3e8,_0x4b6546=RequestMonitor[_0x4afc48(0xfd)][_0x4afc48(0x11e)](_0x499005=>_0x499005[_0x4afc48(0x10b)]>_0x46f939),_0x269f4d={'total':RequestMonitor['httpCodesData'][_0x4afc48(0xfe)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x4afc48(0x10e)][_0x4afc48(0x10c)](_0x81ecc4=>{const _0x4e3d6b=_0x4afc48;_0x269f4d['byCodes'][_0x81ecc4[_0x4e3d6b(0x100)]]=(_0x269f4d[_0x4e3d6b(0x106)][_0x81ecc4[_0x4e3d6b(0x100)]]||0x0)+0x1;const _0x7915f6=_0x81ecc4[_0x4e3d6b(0xfa)]+'\x20'+_0x81ecc4[_0x4e3d6b(0xea)];!_0x269f4d['byPath'][_0x7915f6]&&(_0x269f4d[_0x4e3d6b(0x10d)][_0x7915f6]={'total':0x0,'codes':{}}),_0x269f4d[_0x4e3d6b(0x10d)][_0x7915f6]['total']++,_0x269f4d['byPath'][_0x7915f6][_0x4e3d6b(0x10a)][_0x81ecc4['statusCode']]=(_0x269f4d[_0x4e3d6b(0x10d)][_0x7915f6]['codes'][_0x81ecc4[_0x4e3d6b(0x100)]]||0x0)+0x1;}),{'rps':_0x4b6546,'httpCodes':_0x269f4d,'ressourcesUsageStats':RequestMonitor[_0x4afc48(0x120)]};}}RequestMonitor['init']()[a1_0x42afdd(0x115)](()=>{}),RequestMonitor[a1_0x42afdd(0xfc)]();function a1_0x163f(){const _0x154822=['11rvKkwt','middleware','usedMemMb','method','Error\x20getting\x20CPU\x20usage:','startPeriodicSave','rpsData','length','apply','statusCode','currentRequests','end','cpu','Error\x20saving\x20monitoring\x20data:','cadviewer/settings/http-codes-24h.json','byCodes','lastMinute','node-os-utils','6LJhKza','codes','timestamp','forEach','byPath','httpCodesData','mem','373408lznLJJ','httpCodesStoragePath','Initializing\x20request\x20monitor...','outputMb','getMinutes','then','1411790ItxOLl','readFile','utf8','cadviewer/settings/ressources-usage-stats.json','includes','slice','701608glnKbL','1291920QeiSZd','filter','getStats','ressourcesUsageStats','/metrics','log','4FIUAgg','2835411kDTNmv','ressourcesUsageStatsPath','28PtNSPr','inOut','now','rpsStoragePath','getHours','time','network','floor','push','total','promises','error','padStart','path','memory','=======>','3395925SGvxyl','inputMb','exports','stringify','save','1148676amMkaH','parse','writeFile','getUsageRessourcesStatsAndSave','init'];a1_0x163f=function(){return _0x154822;};return a1_0x163f();}function a1_0x4188(_0x379468,_0x1fb61f){const _0x163fea=a1_0x163f();return a1_0x4188=function(_0x4188ee,_0x5b3079){_0x4188ee=_0x4188ee-0xe4;let _0x5c3df5=_0x163fea[_0x4188ee];return _0x5c3df5;},a1_0x4188(_0x379468,_0x1fb61f);}const counter=RequestMonitor;module[a1_0x42afdd(0xef)]=counter;