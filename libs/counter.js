const a1_0x74e9b5=a1_0x3066;(function(_0x133c87,_0x23f715){const _0x5d5220=a1_0x3066,_0x36988c=_0x133c87();while(!![]){try{const _0x3a177a=-parseInt(_0x5d5220(0x18c))/0x1+-parseInt(_0x5d5220(0x19e))/0x2*(parseInt(_0x5d5220(0x1a5))/0x3)+parseInt(_0x5d5220(0x19a))/0x4+parseInt(_0x5d5220(0x18f))/0x5*(-parseInt(_0x5d5220(0x191))/0x6)+-parseInt(_0x5d5220(0x160))/0x7*(parseInt(_0x5d5220(0x190))/0x8)+-parseInt(_0x5d5220(0x1a7))/0x9*(-parseInt(_0x5d5220(0x19c))/0xa)+parseInt(_0x5d5220(0x162))/0xb;if(_0x3a177a===_0x23f715)break;else _0x36988c['push'](_0x36988c['shift']());}catch(_0x53ffce){_0x36988c['push'](_0x36988c['shift']());}}}(a1_0x34dd,0x6beea));function a1_0x3066(_0x7685a0,_0x2f9b43){const _0x34dd04=a1_0x34dd();return a1_0x3066=function(_0x30669a,_0xbce7a0){_0x30669a=_0x30669a-0x160;let _0x263428=_0x34dd04[_0x30669a];return _0x263428;},a1_0x3066(_0x7685a0,_0x2f9b43);}const fs=require('fs')['promises'],osu=require(a1_0x74e9b5(0x184));class RequestMonitor{static [a1_0x74e9b5(0x16f)]='cadviewer/settings/requests-per-minute.json';static [a1_0x74e9b5(0x167)]=a1_0x74e9b5(0x183);static [a1_0x74e9b5(0x16b)]=a1_0x74e9b5(0x186);static ['rpsData']=[];static ['httpCodesData']=[];static [a1_0x74e9b5(0x194)]={};static [a1_0x74e9b5(0x197)]=Math['floor'](Date[a1_0x74e9b5(0x174)]()/0x3e8/0x3c);static [a1_0x74e9b5(0x195)]=0x0;static async[a1_0x74e9b5(0x18d)](){const _0x32905c=a1_0x74e9b5;console[_0x32905c(0x169)](_0x32905c(0x1a6));try{const _0x38ad7a=await fs[_0x32905c(0x19d)](RequestMonitor['rpsStoragePath'],_0x32905c(0x196));RequestMonitor[_0x32905c(0x170)]=JSON[_0x32905c(0x17e)](_0x38ad7a);}catch(_0x53d3da){RequestMonitor[_0x32905c(0x170)]=[];}try{const _0x1937a9=await fs[_0x32905c(0x19d)](RequestMonitor[_0x32905c(0x167)],_0x32905c(0x196));RequestMonitor['httpCodesData']=JSON[_0x32905c(0x17e)](_0x1937a9);}catch(_0x863b23){RequestMonitor['httpCodesData']=[];}try{const _0xe952c8=await fs[_0x32905c(0x19d)](RequestMonitor['ressourcesUsageStatsPath'],'utf8');RequestMonitor[_0x32905c(0x194)]=JSON[_0x32905c(0x17e)](_0xe952c8),!RequestMonitor[_0x32905c(0x194)][_0x32905c(0x192)]&&(RequestMonitor[_0x32905c(0x194)][_0x32905c(0x192)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x32905c(0x18b)]&&(RequestMonitor['ressourcesUsageStats'][_0x32905c(0x18b)]=[]),!RequestMonitor[_0x32905c(0x194)][_0x32905c(0x180)]&&(RequestMonitor[_0x32905c(0x194)][_0x32905c(0x180)]=[]);}catch(_0x29b6ef){RequestMonitor[_0x32905c(0x194)]={'cpu':[],'memory':[],'network':[]};}console[_0x32905c(0x169)](_0x32905c(0x17f));}static['middleware'](_0x42ce48,_0x1352fd,_0x1605b4){const _0x174dd7=a1_0x74e9b5;if(_0x42ce48[_0x174dd7(0x1a2)]['includes'](_0x174dd7(0x176)))return _0x1605b4();console['log'](_0x174dd7(0x199));let _0x10765f=Date[_0x174dd7(0x174)](),_0x5c6b24=Math[_0x174dd7(0x1a0)](_0x10765f/0x3e8/0x3c);console[_0x174dd7(0x169)]('=======>');const _0x190f08=_0x1352fd['end'];_0x1352fd['end']=(..._0x14838f)=>{const _0x3eeecb=_0x174dd7;console[_0x3eeecb(0x169)](_0x5c6b24,{'currentMinute':_0x5c6b24});_0x5c6b24>RequestMonitor['lastMinute']&&(RequestMonitor[_0x3eeecb(0x170)]['push']({'timestamp':RequestMonitor[_0x3eeecb(0x197)]*0x3e8*0x3c,'requests':RequestMonitor[_0x3eeecb(0x195)]}),RequestMonitor[_0x3eeecb(0x195)]=0x0,RequestMonitor[_0x3eeecb(0x197)]=_0x5c6b24);RequestMonitor[_0x3eeecb(0x195)]++,RequestMonitor[_0x3eeecb(0x163)][_0x3eeecb(0x189)]({'timestamp':Date[_0x3eeecb(0x174)](),'statusCode':_0x1352fd['statusCode'],'path':_0x42ce48[_0x3eeecb(0x1a2)],'method':_0x42ce48[_0x3eeecb(0x165)]});const _0x5a531e=Date[_0x3eeecb(0x174)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor[_0x3eeecb(0x163)][_0x3eeecb(0x198)](_0x28bdff=>_0x28bdff[_0x3eeecb(0x18e)]>_0x5a531e),_0x190f08[_0x3eeecb(0x172)](_0x1352fd,_0x14838f);},_0x1605b4();}static async[a1_0x74e9b5(0x164)](){const _0x4c7b29=a1_0x74e9b5;try{RequestMonitor[_0x4c7b29(0x197)]!==Math[_0x4c7b29(0x1a0)](Date[_0x4c7b29(0x174)]()/0x3e8/0x3c)&&(RequestMonitor['rpsData'][_0x4c7b29(0x189)]({'timestamp':RequestMonitor[_0x4c7b29(0x197)]*0x3e8*0x3c,'requests':RequestMonitor[_0x4c7b29(0x195)]}),RequestMonitor[_0x4c7b29(0x195)]=0x0,RequestMonitor[_0x4c7b29(0x197)]=Math[_0x4c7b29(0x1a0)](Date[_0x4c7b29(0x174)]()/0x3e8/0x3c)),await fs[_0x4c7b29(0x187)](RequestMonitor[_0x4c7b29(0x16f)],JSON['stringify'](RequestMonitor[_0x4c7b29(0x170)],null,0x2)),await fs['writeFile'](RequestMonitor[_0x4c7b29(0x167)],JSON[_0x4c7b29(0x18a)](RequestMonitor[_0x4c7b29(0x163)],null,0x2));}catch(_0x57d216){console[_0x4c7b29(0x168)](_0x4c7b29(0x17b),_0x57d216);}}static async[a1_0x74e9b5(0x16c)](){const _0x59bc6c=a1_0x74e9b5;setInterval(()=>RequestMonitor[_0x59bc6c(0x164)](),0x3c*0x3e8),setInterval(()=>{const _0x4b7a73=_0x59bc6c;RequestMonitor[_0x4b7a73(0x16e)]()[_0x4b7a73(0x17a)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x59bc6c(0x16e)]()[_0x59bc6c(0x17a)](()=>{});}static async[a1_0x74e9b5(0x16e)](){const _0x55e020=a1_0x74e9b5,_0x39a887=osu[_0x55e020(0x192)],_0x1ed4c7=osu[_0x55e020(0x181)],_0x46015d=osu[_0x55e020(0x16a)],_0x5463a3={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x58fd15=await _0x46015d[_0x55e020(0x185)]();_0x5463a3[_0x55e020(0x166)][_0x55e020(0x17c)]=_0x58fd15[_0x55e020(0x166)][_0x55e020(0x17c)],_0x5463a3[_0x55e020(0x166)]['outputMb']=_0x58fd15['total'][_0x55e020(0x1a3)];}catch(_0x123e7e){}let _0x26d804=0x0;try{_0x26d804=await _0x39a887['usage']();}catch(_0x2baf9d){console[_0x55e020(0x169)](_0x55e020(0x19f),_0x2baf9d);}const _0x1a0af7={'usedMemMb':0x0};try{const _0x1c8eff=await _0x1ed4c7['info']();_0x1a0af7['usedMemMb']=_0x1c8eff[_0x55e020(0x19b)];}catch(_0x2f69cb){console[_0x55e020(0x169)](_0x55e020(0x179),_0x2f69cb);}const _0x3e0b19=new Date()['getHours']()[_0x55e020(0x177)]()[_0x55e020(0x1a4)](0x2,'0')+':'+new Date()[_0x55e020(0x188)]()['toString']()[_0x55e020(0x1a4)](0x2,'0');RequestMonitor[_0x55e020(0x194)]['cpu']=RequestMonitor[_0x55e020(0x194)]['cpu'][_0x55e020(0x173)](-0x3c)[_0x55e020(0x198)](_0x248e97=>_0x248e97['time']!==_0x3e0b19),RequestMonitor[_0x55e020(0x194)][_0x55e020(0x18b)]=RequestMonitor[_0x55e020(0x194)][_0x55e020(0x18b)][_0x55e020(0x173)](-0x3c)[_0x55e020(0x198)](_0x202825=>_0x202825['time']!==_0x3e0b19),RequestMonitor[_0x55e020(0x194)][_0x55e020(0x180)]=RequestMonitor['ressourcesUsageStats'][_0x55e020(0x180)][_0x55e020(0x173)](-0x3c)[_0x55e020(0x198)](_0x196742=>_0x196742['time']!==_0x3e0b19),RequestMonitor['ressourcesUsageStats']['cpu']['push']({'time':_0x3e0b19,'usage':_0x26d804}),RequestMonitor[_0x55e020(0x194)][_0x55e020(0x18b)][_0x55e020(0x189)]({'time':_0x3e0b19,'usage':(_0x1a0af7[_0x55e020(0x19b)]/0x3e8)[_0x55e020(0x182)](0x2)}),RequestMonitor[_0x55e020(0x194)][_0x55e020(0x180)]['push']({'time':_0x3e0b19,'usage':{'in':_0x5463a3['total']?.['inputMb']??0x0,'out':_0x5463a3['total']?.['outputMb']??0x0}});try{await fs[_0x55e020(0x187)](RequestMonitor['ressourcesUsageStatsPath'],JSON[_0x55e020(0x18a)](RequestMonitor[_0x55e020(0x194)],null,0x2));}catch(_0x20525d){console[_0x55e020(0x168)](_0x55e020(0x17b),_0x20525d);}}static[a1_0x74e9b5(0x178)](){const _0x3a1532=a1_0x74e9b5,_0x348287=Date[_0x3a1532(0x174)](),_0x1c5876=_0x348287-0x3c*0x3c*0x3e8,_0x4f35b0=_0x348287-0x18*0x3c*0x3c*0x3e8,_0x446fea=RequestMonitor['rpsData'][_0x3a1532(0x198)](_0x12168e=>_0x12168e[_0x3a1532(0x18e)]>_0x1c5876),_0x5d4551={'total':RequestMonitor[_0x3a1532(0x163)][_0x3a1532(0x175)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x3a1532(0x163)][_0x3a1532(0x1a1)](_0xd9d842=>{const _0x10dee1=_0x3a1532;_0x5d4551[_0x10dee1(0x16d)][_0xd9d842[_0x10dee1(0x193)]]=(_0x5d4551['byCodes'][_0xd9d842[_0x10dee1(0x193)]]||0x0)+0x1;const _0x3d566b=_0xd9d842[_0x10dee1(0x165)]+'\x20'+_0xd9d842[_0x10dee1(0x1a2)];!_0x5d4551[_0x10dee1(0x161)][_0x3d566b]&&(_0x5d4551[_0x10dee1(0x161)][_0x3d566b]={'total':0x0,'codes':{}}),_0x5d4551[_0x10dee1(0x161)][_0x3d566b]['total']++,_0x5d4551[_0x10dee1(0x161)][_0x3d566b]['codes'][_0xd9d842[_0x10dee1(0x193)]]=(_0x5d4551[_0x10dee1(0x161)][_0x3d566b][_0x10dee1(0x17d)][_0xd9d842[_0x10dee1(0x193)]]||0x0)+0x1;}),{'rps':_0x446fea,'httpCodes':_0x5d4551,'ressourcesUsageStats':RequestMonitor[_0x3a1532(0x194)]};}}RequestMonitor[a1_0x74e9b5(0x18d)]()[a1_0x74e9b5(0x17a)](()=>{}),RequestMonitor['startPeriodicSave']();const counter=RequestMonitor;module[a1_0x74e9b5(0x171)]=counter;function a1_0x34dd(){const _0x5be66b=['byPath','18897406htDCbJ','httpCodesData','save','method','total','httpCodesStoragePath','error','log','netstat','ressourcesUsageStatsPath','startPeriodicSave','byCodes','getUsageRessourcesStatsAndSave','rpsStoragePath','rpsData','exports','apply','slice','now','length','/metrics','toString','getStats','Error\x20getting\x20memory\x20usage:','then','Error\x20saving\x20monitoring\x20data:','inputMb','codes','parse','Request\x20monitor\x20initialized.','network','mem','toFixed','cadviewer/settings/http-codes-24h.json','node-os-utils','inOut','cadviewer/settings/ressources-usage-stats.json','writeFile','getMinutes','push','stringify','memory','126972eTzsjM','init','timestamp','613915frhxLW','16cmvMaw','42iRsdly','cpu','statusCode','ressourcesUsageStats','currentRequests','utf8','lastMinute','filter','Request\x20monitor\x20middleware','1887660mytTkd','usedMemMb','218570JZKFPN','readFile','18BxHkYk','Error\x20getting\x20CPU\x20usage:','floor','forEach','path','outputMb','padStart','281889hOfvgj','Initializing\x20request\x20monitor...','279nNykTa','2076263IcOxuC'];a1_0x34dd=function(){return _0x5be66b;};return a1_0x34dd();}