const a1_0x37fbba=a1_0x1daa;(function(_0x279417,_0x2a748e){const _0x550557=a1_0x1daa,_0x98cc83=_0x279417();while(!![]){try{const _0x3d7bf0=parseInt(_0x550557(0x206))/0x1*(-parseInt(_0x550557(0x220))/0x2)+-parseInt(_0x550557(0x20e))/0x3*(parseInt(_0x550557(0x217))/0x4)+parseInt(_0x550557(0x227))/0x5+-parseInt(_0x550557(0x21e))/0x6*(parseInt(_0x550557(0x1eb))/0x7)+parseInt(_0x550557(0x22a))/0x8*(-parseInt(_0x550557(0x1f0))/0x9)+parseInt(_0x550557(0x21d))/0xa+parseInt(_0x550557(0x22e))/0xb;if(_0x3d7bf0===_0x2a748e)break;else _0x98cc83['push'](_0x98cc83['shift']());}catch(_0x19e4dd){_0x98cc83['push'](_0x98cc83['shift']());}}}(a1_0x2b25,0x9f15d));const fs=require('fs')[a1_0x37fbba(0x1ee)],osu=require('node-os-utils');class RequestMonitor{static [a1_0x37fbba(0x209)]='cadviewer/settings/requests-per-minute.json';static [a1_0x37fbba(0x1fa)]=a1_0x37fbba(0x224);static [a1_0x37fbba(0x1f3)]=a1_0x37fbba(0x226);static [a1_0x37fbba(0x210)]=[];static [a1_0x37fbba(0x20a)]=[];static [a1_0x37fbba(0x231)]={};static [a1_0x37fbba(0x21b)]=Math[a1_0x37fbba(0x1e9)](Date[a1_0x37fbba(0x20b)]()/0x3e8/0x3c);static [a1_0x37fbba(0x212)]=0x0;static async['init'](){const _0x1777e5=a1_0x37fbba;console[_0x1777e5(0x20d)]('Initializing\x20request\x20monitor...');try{const _0x2923f2=await fs[_0x1777e5(0x1f8)](RequestMonitor[_0x1777e5(0x209)],'utf8');RequestMonitor[_0x1777e5(0x210)]=JSON['parse'](_0x2923f2);}catch(_0x1359b8){RequestMonitor[_0x1777e5(0x210)]=[];}try{const _0x1a980d=await fs['readFile'](RequestMonitor[_0x1777e5(0x1fa)],_0x1777e5(0x1e6));RequestMonitor[_0x1777e5(0x20a)]=JSON[_0x1777e5(0x1f5)](_0x1a980d);}catch(_0x12f0e0){RequestMonitor[_0x1777e5(0x20a)]=[];}try{const _0x24c524=await fs['readFile'](RequestMonitor[_0x1777e5(0x1f3)],_0x1777e5(0x1e6));RequestMonitor[_0x1777e5(0x231)]=JSON[_0x1777e5(0x1f5)](_0x24c524),!RequestMonitor[_0x1777e5(0x231)]['cpu']&&(RequestMonitor['ressourcesUsageStats'][_0x1777e5(0x22d)]=[]),!RequestMonitor[_0x1777e5(0x231)][_0x1777e5(0x1f7)]&&(RequestMonitor[_0x1777e5(0x231)][_0x1777e5(0x1f7)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x1777e5(0x225)]&&(RequestMonitor['ressourcesUsageStats']['network']=[]);}catch(_0x520960){RequestMonitor[_0x1777e5(0x231)]={'cpu':[],'memory':[],'network':[]};}console[_0x1777e5(0x20d)](_0x1777e5(0x203));}static[a1_0x37fbba(0x200)](_0x50d60b,_0x5019a3,_0x48576f){const _0x55688f=a1_0x37fbba;if(_0x50d60b[_0x55688f(0x1fd)][_0x55688f(0x219)](_0x55688f(0x1ed)))return _0x48576f();console[_0x55688f(0x20d)]('Request\x20monitor\x20middleware');let _0x29f235=Date['now'](),_0x28c400=Math['floor'](_0x29f235/0x3e8/0x3c);console[_0x55688f(0x20d)](_0x55688f(0x218));const _0x1557c5=_0x5019a3[_0x55688f(0x216)];_0x5019a3[_0x55688f(0x216)]=(..._0x544d7e)=>{const _0x2ece1f=_0x55688f;console[_0x2ece1f(0x20d)](_0x28c400,{'currentMinute':_0x28c400});_0x28c400>RequestMonitor[_0x2ece1f(0x21b)]&&(RequestMonitor['rpsData'][_0x2ece1f(0x222)]({'timestamp':RequestMonitor[_0x2ece1f(0x21b)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x2ece1f(0x212)]=0x0,RequestMonitor['lastMinute']=_0x28c400);RequestMonitor[_0x2ece1f(0x212)]++,RequestMonitor['httpCodesData'][_0x2ece1f(0x222)]({'timestamp':Date['now'](),'statusCode':_0x5019a3['statusCode'],'path':_0x50d60b[_0x2ece1f(0x1fd)],'method':_0x50d60b[_0x2ece1f(0x20f)]});const _0x596fb5=Date[_0x2ece1f(0x20b)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x2ece1f(0x20a)]=RequestMonitor[_0x2ece1f(0x20a)][_0x2ece1f(0x1e7)](_0x42c10a=>_0x42c10a[_0x2ece1f(0x1ea)]>_0x596fb5),_0x1557c5[_0x2ece1f(0x1ff)](_0x5019a3,_0x544d7e);},_0x48576f();}static async[a1_0x37fbba(0x1fe)](){const _0x56afc6=a1_0x37fbba;try{RequestMonitor[_0x56afc6(0x21b)]!==Math['floor'](Date[_0x56afc6(0x20b)]()/0x3e8/0x3c)&&(RequestMonitor[_0x56afc6(0x210)][_0x56afc6(0x222)]({'timestamp':RequestMonitor[_0x56afc6(0x21b)]*0x3e8*0x3c,'requests':RequestMonitor[_0x56afc6(0x212)]}),RequestMonitor[_0x56afc6(0x212)]=0x0,RequestMonitor[_0x56afc6(0x21b)]=Math['floor'](Date[_0x56afc6(0x20b)]()/0x3e8/0x3c)),await fs[_0x56afc6(0x22c)](RequestMonitor['rpsStoragePath'],JSON['stringify'](RequestMonitor[_0x56afc6(0x210)],null,0x2)),await fs['writeFile'](RequestMonitor[_0x56afc6(0x1fa)],JSON[_0x56afc6(0x207)](RequestMonitor[_0x56afc6(0x20a)],null,0x2));}catch(_0x350a41){console[_0x56afc6(0x230)](_0x56afc6(0x223),_0x350a41);}}static async['startPeriodicSave'](){const _0x48301a=a1_0x37fbba;setInterval(()=>RequestMonitor[_0x48301a(0x1fe)](),0x3c*0x3e8),setInterval(()=>{const _0x2f5df6=_0x48301a;RequestMonitor[_0x2f5df6(0x1f6)]()[_0x2f5df6(0x228)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x48301a(0x1f6)]()[_0x48301a(0x228)](()=>{});}static async[a1_0x37fbba(0x1f6)](){const _0x36db20=a1_0x37fbba,_0x597982=osu[_0x36db20(0x22d)],_0x5aee81=osu[_0x36db20(0x21f)],_0x4f1876=osu[_0x36db20(0x1fb)],_0x5dd290={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x3bcd14=await _0x4f1876[_0x36db20(0x214)]();_0x5dd290['total'][_0x36db20(0x20c)]=_0x3bcd14[_0x36db20(0x1f4)][_0x36db20(0x20c)],_0x5dd290[_0x36db20(0x1f4)][_0x36db20(0x1f1)]=_0x3bcd14[_0x36db20(0x1f4)][_0x36db20(0x1f1)];}catch(_0x17976f){}let _0x1b927b=0x0;try{_0x1b927b=await _0x597982[_0x36db20(0x229)]();}catch(_0x1bcaeb){console[_0x36db20(0x20d)]('Error\x20getting\x20CPU\x20usage:',_0x1bcaeb);}const _0x4c5ffe={'usedMemMb':0x0};try{const _0x463b86=await _0x5aee81[_0x36db20(0x21a)]();_0x4c5ffe[_0x36db20(0x221)]=_0x463b86[_0x36db20(0x221)];}catch(_0x3452a2){console[_0x36db20(0x20d)](_0x36db20(0x215),_0x3452a2);}const _0x258ce2=new Date()[_0x36db20(0x1e8)]()[_0x36db20(0x211)]()[_0x36db20(0x204)](0x2,'0')+':'+new Date()[_0x36db20(0x205)]()[_0x36db20(0x211)]()[_0x36db20(0x204)](0x2,'0');RequestMonitor[_0x36db20(0x231)][_0x36db20(0x22d)]=RequestMonitor['ressourcesUsageStats'][_0x36db20(0x22d)][_0x36db20(0x1f2)](-0x3c)[_0x36db20(0x1e7)](_0x448395=>_0x448395[_0x36db20(0x208)]!==_0x258ce2),RequestMonitor[_0x36db20(0x231)]['memory']=RequestMonitor[_0x36db20(0x231)][_0x36db20(0x1f7)][_0x36db20(0x1f2)](-0x3c)['filter'](_0x244881=>_0x244881['time']!==_0x258ce2),RequestMonitor['ressourcesUsageStats'][_0x36db20(0x225)]=RequestMonitor[_0x36db20(0x231)][_0x36db20(0x225)][_0x36db20(0x1f2)](-0x3c)[_0x36db20(0x1e7)](_0x2e110c=>_0x2e110c[_0x36db20(0x208)]!==_0x258ce2),RequestMonitor['ressourcesUsageStats'][_0x36db20(0x22d)][_0x36db20(0x222)]({'time':_0x258ce2,'usage':_0x1b927b}),RequestMonitor[_0x36db20(0x231)][_0x36db20(0x1f7)][_0x36db20(0x222)]({'time':_0x258ce2,'usage':(_0x4c5ffe['usedMemMb']/0x3e8)[_0x36db20(0x1f9)](0x2)}),RequestMonitor[_0x36db20(0x231)]['network']['push']({'time':_0x258ce2,'usage':{'in':_0x5dd290['total']?.[_0x36db20(0x20c)]??0x0,'out':_0x5dd290[_0x36db20(0x1f4)]?.['outputMb']??0x0}});try{await fs[_0x36db20(0x22c)](RequestMonitor[_0x36db20(0x1f3)],JSON['stringify'](RequestMonitor[_0x36db20(0x231)],null,0x2));}catch(_0x3b2081){console['error'](_0x36db20(0x223),_0x3b2081);}}static[a1_0x37fbba(0x201)](){const _0x3981f2=a1_0x37fbba,_0x2240ec=Date[_0x3981f2(0x20b)](),_0x56ea7e=_0x2240ec-0x3c*0x3c*0x3e8,_0x4abbc0=_0x2240ec-0x18*0x3c*0x3c*0x3e8,_0x405e65=RequestMonitor[_0x3981f2(0x210)][_0x3981f2(0x1e7)](_0x4a7527=>_0x4a7527['timestamp']>_0x56ea7e),_0x513866={'total':RequestMonitor[_0x3981f2(0x20a)][_0x3981f2(0x22f)],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x3981f2(0x1fc)](_0x5b2241=>{const _0x30d7fe=_0x3981f2;_0x513866['byCodes'][_0x5b2241[_0x30d7fe(0x21c)]]=(_0x513866[_0x30d7fe(0x22b)][_0x5b2241[_0x30d7fe(0x21c)]]||0x0)+0x1;const _0x207326=_0x5b2241['method']+'\x20'+_0x5b2241[_0x30d7fe(0x1fd)];!_0x513866[_0x30d7fe(0x202)][_0x207326]&&(_0x513866[_0x30d7fe(0x202)][_0x207326]={'total':0x0,'codes':{}}),_0x513866['byPath'][_0x207326][_0x30d7fe(0x1f4)]++,_0x513866[_0x30d7fe(0x202)][_0x207326][_0x30d7fe(0x1ec)][_0x5b2241[_0x30d7fe(0x21c)]]=(_0x513866[_0x30d7fe(0x202)][_0x207326]['codes'][_0x5b2241['statusCode']]||0x0)+0x1;}),{'rps':_0x405e65,'httpCodes':_0x513866,'ressourcesUsageStats':RequestMonitor[_0x3981f2(0x231)]};}}function a1_0x1daa(_0x448b47,_0x54182f){const _0x2b255c=a1_0x2b25();return a1_0x1daa=function(_0x1daa61,_0x55cdb7){_0x1daa61=_0x1daa61-0x1e6;let _0x6161b2=_0x2b255c[_0x1daa61];return _0x6161b2;},a1_0x1daa(_0x448b47,_0x54182f);}function a1_0x2b25(){const _0x32b6c2=['9qDpuqs','outputMb','slice','ressourcesUsageStatsPath','total','parse','getUsageRessourcesStatsAndSave','memory','readFile','toFixed','httpCodesStoragePath','netstat','forEach','path','save','apply','middleware','getStats','byPath','Request\x20monitor\x20initialized.','padStart','getMinutes','554461ESYZFa','stringify','time','rpsStoragePath','httpCodesData','now','inputMb','log','12xpTSEr','method','rpsData','toString','currentRequests','init','inOut','Error\x20getting\x20memory\x20usage:','end','515828XBoytg','=======>','includes','info','lastMinute','statusCode','12420370rCnKAg','24qIaiNC','mem','2uJqOfI','usedMemMb','push','Error\x20saving\x20monitoring\x20data:','cadviewer/settings/http-codes-24h.json','network','cadviewer/settings/ressources-usage-stats.json','2314780UhobBk','then','usage','2304280aRBhnO','byCodes','writeFile','cpu','5575900SXedhZ','length','error','ressourcesUsageStats','utf8','filter','getHours','floor','timestamp','353423GtEJCY','codes','/metrics','promises','startPeriodicSave'];a1_0x2b25=function(){return _0x32b6c2;};return a1_0x2b25();}RequestMonitor[a1_0x37fbba(0x213)]()[a1_0x37fbba(0x228)](()=>{}),RequestMonitor[a1_0x37fbba(0x1ef)]();const counter=RequestMonitor;module['exports']=counter;