const a1_0xb5767a=a1_0x1e7b;(function(_0x248d28,_0x39bfc6){const _0x18563d=a1_0x1e7b,_0x2defbe=_0x248d28();while(!![]){try{const _0x5275cb=-parseInt(_0x18563d(0x108))/0x1*(-parseInt(_0x18563d(0xf8))/0x2)+-parseInt(_0x18563d(0x114))/0x3*(parseInt(_0x18563d(0x122))/0x4)+parseInt(_0x18563d(0x10a))/0x5+parseInt(_0x18563d(0xff))/0x6*(-parseInt(_0x18563d(0x116))/0x7)+parseInt(_0x18563d(0x121))/0x8*(-parseInt(_0x18563d(0x12a))/0x9)+-parseInt(_0x18563d(0x11b))/0xa+parseInt(_0x18563d(0xf6))/0xb;if(_0x5275cb===_0x39bfc6)break;else _0x2defbe['push'](_0x2defbe['shift']());}catch(_0x5b2167){_0x2defbe['push'](_0x2defbe['shift']());}}}(a1_0x239a,0x5e451));const fs=require('fs')[a1_0xb5767a(0xfb)],osu=require('node-os-utils');class RequestMonitor{static [a1_0xb5767a(0x110)]=a1_0xb5767a(0x113);static [a1_0xb5767a(0xf3)]='cadviewer/settings/http-codes-24h.json';static [a1_0xb5767a(0x12e)]='cadviewer/settings/ressources-usage-stats.json';static [a1_0xb5767a(0x128)]=[];static [a1_0xb5767a(0x133)]=[];static ['ressourcesUsageStats']={};static ['lastMinute']=Math['floor'](Date[a1_0xb5767a(0xfe)]()/0x3e8/0x3c);static [a1_0xb5767a(0x10c)]=0x0;static async['init'](){const _0x39db8e=a1_0xb5767a;console[_0x39db8e(0x105)]('Initializing\x20request\x20monitor...');try{const _0x578548=await fs[_0x39db8e(0x125)](RequestMonitor[_0x39db8e(0x110)],'utf8');RequestMonitor[_0x39db8e(0x128)]=JSON['parse'](_0x578548);}catch(_0x4d9a8b){RequestMonitor['rpsData']=[];}try{const _0x4a5f68=await fs[_0x39db8e(0x125)](RequestMonitor[_0x39db8e(0xf3)],'utf8');RequestMonitor[_0x39db8e(0x133)]=JSON['parse'](_0x4a5f68);}catch(_0x146045){RequestMonitor[_0x39db8e(0x133)]=[];}try{const _0x1474f0=await fs[_0x39db8e(0x125)](RequestMonitor['ressourcesUsageStatsPath'],_0x39db8e(0x11e));RequestMonitor[_0x39db8e(0x123)]=JSON[_0x39db8e(0xf4)](_0x1474f0),!RequestMonitor['ressourcesUsageStats'][_0x39db8e(0x124)]&&(RequestMonitor[_0x39db8e(0x123)][_0x39db8e(0x124)]=[]),!RequestMonitor[_0x39db8e(0x123)]['memory']&&(RequestMonitor['ressourcesUsageStats'][_0x39db8e(0xfc)]=[]),!RequestMonitor[_0x39db8e(0x123)][_0x39db8e(0x136)]&&(RequestMonitor[_0x39db8e(0x123)][_0x39db8e(0x136)]=[]);}catch(_0x2f018b){RequestMonitor[_0x39db8e(0x123)]={'cpu':[],'memory':[],'network':[]};}console[_0x39db8e(0x105)](_0x39db8e(0xfd));}static['middleware'](_0x1404cc,_0x279928,_0x181741){const _0x1f59c8=a1_0xb5767a;if(_0x1404cc[_0x1f59c8(0x138)][_0x1f59c8(0x11c)](_0x1f59c8(0x135)))return _0x181741();console['log'](_0x1f59c8(0x106));let _0x3e5494=Date[_0x1f59c8(0xfe)](),_0x51be7e=Math['floor'](_0x3e5494/0x3e8/0x3c);console[_0x1f59c8(0x105)](_0x1f59c8(0x103));const _0x1a097b=_0x279928['end'];_0x279928[_0x1f59c8(0x111)]=(..._0x4422a9)=>{const _0x2fdbe4=_0x1f59c8;console['log'](_0x51be7e,{'currentMinute':_0x51be7e});_0x51be7e>RequestMonitor['lastMinute']&&(RequestMonitor[_0x2fdbe4(0x128)]['push']({'timestamp':RequestMonitor[_0x2fdbe4(0x102)]*0x3e8*0x3c,'requests':RequestMonitor[_0x2fdbe4(0x10c)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x2fdbe4(0x102)]=_0x51be7e);RequestMonitor['currentRequests']++,RequestMonitor[_0x2fdbe4(0x133)][_0x2fdbe4(0x12c)]({'timestamp':Date[_0x2fdbe4(0xfe)](),'statusCode':_0x279928[_0x2fdbe4(0x100)],'path':_0x1404cc['path'],'method':_0x1404cc[_0x2fdbe4(0x126)]});const _0x4d18b6=Date[_0x2fdbe4(0xfe)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x2fdbe4(0x133)]=RequestMonitor[_0x2fdbe4(0x133)][_0x2fdbe4(0x12d)](_0x3dfc3d=>_0x3dfc3d[_0x2fdbe4(0x10e)]>_0x4d18b6),_0x1a097b[_0x2fdbe4(0x11f)](_0x279928,_0x4422a9);},_0x181741();}static async[a1_0xb5767a(0x10f)](){const _0x382729=a1_0xb5767a;try{RequestMonitor[_0x382729(0x102)]!==Math[_0x382729(0x112)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x382729(0x128)][_0x382729(0x12c)]({'timestamp':RequestMonitor[_0x382729(0x102)]*0x3e8*0x3c,'requests':RequestMonitor[_0x382729(0x10c)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x382729(0x102)]=Math[_0x382729(0x112)](Date[_0x382729(0xfe)]()/0x3e8/0x3c)),await fs['writeFile'](RequestMonitor['rpsStoragePath'],JSON['stringify'](RequestMonitor[_0x382729(0x128)],null,0x2)),await fs[_0x382729(0x132)](RequestMonitor[_0x382729(0xf3)],JSON[_0x382729(0x134)](RequestMonitor[_0x382729(0x133)],null,0x2));}catch(_0x44188d){console[_0x382729(0x101)](_0x382729(0x131),_0x44188d);}}static async['startPeriodicSave'](){const _0x2f5185=a1_0xb5767a;setInterval(()=>RequestMonitor[_0x2f5185(0x10f)](),0x3c*0x3e8),setInterval(()=>{const _0x3c23b4=_0x2f5185;RequestMonitor[_0x3c23b4(0x11d)]()[_0x3c23b4(0x137)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x2f5185(0x11d)]()[_0x2f5185(0x137)](()=>{});}static async[a1_0xb5767a(0x11d)](){const _0x1adf64=a1_0xb5767a,_0x1fd5af=osu[_0x1adf64(0x124)],_0x507709=osu[_0x1adf64(0xfa)],_0x312527=osu[_0x1adf64(0x117)],_0x598dfd={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x19ae16=await _0x312527['inOut']();_0x598dfd[_0x1adf64(0x129)][_0x1adf64(0x120)]=_0x19ae16[_0x1adf64(0x129)]['inputMb'],_0x598dfd['total'][_0x1adf64(0x118)]=_0x19ae16[_0x1adf64(0x129)][_0x1adf64(0x118)];}catch(_0x4181b9){}let _0x1d240d=0x0;try{_0x1d240d=await _0x1fd5af[_0x1adf64(0x115)]();}catch(_0x323f36){console[_0x1adf64(0x105)]('Error\x20getting\x20CPU\x20usage:',_0x323f36);}const _0x55b509={'usedMemMb':0x0};try{const _0x355fd5=await _0x507709[_0x1adf64(0xf9)]();_0x55b509['usedMemMb']=_0x355fd5[_0x1adf64(0x119)];}catch(_0x297f2d){console[_0x1adf64(0x105)]('Error\x20getting\x20memory\x20usage:',_0x297f2d);}const _0x4b7d52=new Date()[_0x1adf64(0xf5)]()[_0x1adf64(0x12b)]()[_0x1adf64(0x139)](0x2,'0')+':'+new Date()[_0x1adf64(0x10d)]()[_0x1adf64(0x12b)]()[_0x1adf64(0x139)](0x2,'0');RequestMonitor[_0x1adf64(0x123)][_0x1adf64(0x124)]=RequestMonitor[_0x1adf64(0x123)]['cpu']['slice'](-0x3c)[_0x1adf64(0x12d)](_0x4c690c=>_0x4c690c[_0x1adf64(0x10b)]!==_0x4b7d52),RequestMonitor['ressourcesUsageStats'][_0x1adf64(0xfc)]=RequestMonitor[_0x1adf64(0x123)][_0x1adf64(0xfc)]['slice'](-0x3c)[_0x1adf64(0x12d)](_0x3123c6=>_0x3123c6[_0x1adf64(0x10b)]!==_0x4b7d52),RequestMonitor['ressourcesUsageStats'][_0x1adf64(0x136)]=RequestMonitor['ressourcesUsageStats']['network']['slice'](-0x3c)[_0x1adf64(0x12d)](_0x34b902=>_0x34b902[_0x1adf64(0x10b)]!==_0x4b7d52),RequestMonitor[_0x1adf64(0x123)][_0x1adf64(0x124)][_0x1adf64(0x12c)]({'time':_0x4b7d52,'usage':_0x1d240d}),RequestMonitor['ressourcesUsageStats'][_0x1adf64(0xfc)]['push']({'time':_0x4b7d52,'usage':(_0x55b509[_0x1adf64(0x119)]/0x3e8)[_0x1adf64(0x12f)](0x2)}),RequestMonitor[_0x1adf64(0x123)][_0x1adf64(0x136)]['push']({'time':_0x4b7d52,'usage':{'in':_0x598dfd[_0x1adf64(0x129)]?.[_0x1adf64(0x120)]??0x0,'out':_0x598dfd[_0x1adf64(0x129)]?.[_0x1adf64(0x118)]??0x0}});try{await fs[_0x1adf64(0x132)](RequestMonitor['ressourcesUsageStatsPath'],JSON[_0x1adf64(0x134)](RequestMonitor[_0x1adf64(0x123)],null,0x2));}catch(_0x2e8d87){console[_0x1adf64(0x101)]('Error\x20saving\x20monitoring\x20data:',_0x2e8d87);}}static[a1_0xb5767a(0x11a)](){const _0x55464b=a1_0xb5767a,_0x205118=Date[_0x55464b(0xfe)](),_0x4fe800=_0x205118-0x3c*0x3c*0x3e8,_0x3f9bb1=_0x205118-0x18*0x3c*0x3c*0x3e8,_0x349dc3=RequestMonitor['rpsData'][_0x55464b(0x12d)](_0x205a10=>_0x205a10['timestamp']>_0x4fe800),_0x23f88a={'total':RequestMonitor['httpCodesData']['length'],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData']['forEach'](_0xaec62f=>{const _0x10d59d=_0x55464b;_0x23f88a[_0x10d59d(0x127)][_0xaec62f['statusCode']]=(_0x23f88a[_0x10d59d(0x127)][_0xaec62f['statusCode']]||0x0)+0x1;const _0x49c09e=_0xaec62f[_0x10d59d(0x126)]+'\x20'+_0xaec62f[_0x10d59d(0x138)];!_0x23f88a[_0x10d59d(0x109)][_0x49c09e]&&(_0x23f88a['byPath'][_0x49c09e]={'total':0x0,'codes':{}}),_0x23f88a[_0x10d59d(0x109)][_0x49c09e][_0x10d59d(0x129)]++,_0x23f88a[_0x10d59d(0x109)][_0x49c09e]['codes'][_0xaec62f['statusCode']]=(_0x23f88a[_0x10d59d(0x109)][_0x49c09e][_0x10d59d(0xf7)][_0xaec62f['statusCode']]||0x0)+0x1;}),{'rps':_0x349dc3,'httpCodes':_0x23f88a,'ressourcesUsageStats':RequestMonitor['ressourcesUsageStats']};}}RequestMonitor[a1_0xb5767a(0x104)]()['then'](()=>{}),RequestMonitor[a1_0xb5767a(0x130)]();const counter=RequestMonitor;function a1_0x1e7b(_0x10efea,_0x5b6e14){const _0x239ac8=a1_0x239a();return a1_0x1e7b=function(_0x1e7b13,_0x3ce973){_0x1e7b13=_0x1e7b13-0xf3;let _0x8fb2be=_0x239ac8[_0x1e7b13];return _0x8fb2be;},a1_0x1e7b(_0x10efea,_0x5b6e14);}module[a1_0xb5767a(0x107)]=counter;function a1_0x239a(){const _0x2ee9e3=['parse','getHours','14096588hJxIPQ','codes','1095462pISUIa','info','mem','promises','memory','Request\x20monitor\x20initialized.','now','45216dRitro','statusCode','error','lastMinute','=======>','init','log','Request\x20monitor\x20middleware','exports','1SmxxEW','byPath','1557645KufqNa','time','currentRequests','getMinutes','timestamp','save','rpsStoragePath','end','floor','cadviewer/settings/requests-per-minute.json','3vmTtMu','usage','679ZukOKh','netstat','outputMb','usedMemMb','getStats','2029510BOlxPk','includes','getUsageRessourcesStatsAndSave','utf8','apply','inputMb','1196904wKrVHU','2684332fawjEb','ressourcesUsageStats','cpu','readFile','method','byCodes','rpsData','total','9AlXenO','toString','push','filter','ressourcesUsageStatsPath','toFixed','startPeriodicSave','Error\x20saving\x20monitoring\x20data:','writeFile','httpCodesData','stringify','/metrics','network','then','path','padStart','httpCodesStoragePath'];a1_0x239a=function(){return _0x2ee9e3;};return a1_0x239a();}