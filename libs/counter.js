const a1_0x3ebe3f=a1_0x5c61;(function(_0x4bd9d8,_0x3bc8c0){const _0xc5dbda=a1_0x5c61,_0xb8e1e4=_0x4bd9d8();while(!![]){try{const _0x3b0520=-parseInt(_0xc5dbda(0xf6))/0x1+parseInt(_0xc5dbda(0x10f))/0x2*(parseInt(_0xc5dbda(0xfc))/0x3)+parseInt(_0xc5dbda(0xe8))/0x4*(parseInt(_0xc5dbda(0xd9))/0x5)+parseInt(_0xc5dbda(0x109))/0x6+parseInt(_0xc5dbda(0x103))/0x7*(-parseInt(_0xc5dbda(0x10c))/0x8)+parseInt(_0xc5dbda(0xe2))/0x9*(-parseInt(_0xc5dbda(0xd0))/0xa)+parseInt(_0xc5dbda(0xde))/0xb;if(_0x3b0520===_0x3bc8c0)break;else _0xb8e1e4['push'](_0xb8e1e4['shift']());}catch(_0x4cc124){_0xb8e1e4['push'](_0xb8e1e4['shift']());}}}(a1_0x502d,0x51a58));const fs=require('fs')[a1_0x3ebe3f(0xed)],osu=require('node-os-utils');class RequestMonitor{static [a1_0x3ebe3f(0xff)]='cadviewer/settings/requests-per-minute.json';static [a1_0x3ebe3f(0xf1)]=a1_0x3ebe3f(0xd2);static [a1_0x3ebe3f(0xd1)]='cadviewer/settings/ressources-usage-stats.json';static [a1_0x3ebe3f(0x10b)]=[];static [a1_0x3ebe3f(0x107)]=[];static ['ressourcesUsageStats']={};static ['lastMinute']=Math[a1_0x3ebe3f(0xe5)](Date[a1_0x3ebe3f(0xe1)]()/0x3e8/0x3c);static [a1_0x3ebe3f(0xe4)]=0x0;static async[a1_0x3ebe3f(0xf2)](){const _0x4c8505=a1_0x3ebe3f;console['log'](_0x4c8505(0x110));try{const _0x47caa1=await fs[_0x4c8505(0xdd)](RequestMonitor[_0x4c8505(0xff)],_0x4c8505(0xe9));RequestMonitor[_0x4c8505(0x10b)]=JSON[_0x4c8505(0xf0)](_0x47caa1);}catch(_0x210e45){RequestMonitor[_0x4c8505(0x10b)]=[];}try{const _0x42d38e=await fs[_0x4c8505(0xdd)](RequestMonitor['httpCodesStoragePath'],_0x4c8505(0xe9));RequestMonitor[_0x4c8505(0x107)]=JSON[_0x4c8505(0xf0)](_0x42d38e);}catch(_0x108729){RequestMonitor[_0x4c8505(0x107)]=[];}try{const _0x11efc7=await fs[_0x4c8505(0xdd)](RequestMonitor[_0x4c8505(0xd1)],_0x4c8505(0xe9));RequestMonitor[_0x4c8505(0xeb)]=JSON[_0x4c8505(0xf0)](_0x11efc7),!RequestMonitor['ressourcesUsageStats']['cpu']&&(RequestMonitor['ressourcesUsageStats'][_0x4c8505(0xdb)]=[]),!RequestMonitor['ressourcesUsageStats']['memory']&&(RequestMonitor['ressourcesUsageStats'][_0x4c8505(0x10a)]=[]),!RequestMonitor['ressourcesUsageStats']['network']&&(RequestMonitor[_0x4c8505(0xeb)][_0x4c8505(0xec)]=[]);}catch(_0x5d3ecf){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console[_0x4c8505(0xe7)](_0x4c8505(0xda));}static[a1_0x3ebe3f(0xfa)](_0x374f59,_0x233717,_0x4f30b0){const _0x2046a4=a1_0x3ebe3f;if(_0x374f59[_0x2046a4(0xfb)]['includes'](_0x2046a4(0xd5)))return _0x4f30b0();console[_0x2046a4(0xe7)](_0x2046a4(0xf7));let _0x75f29a=Date[_0x2046a4(0xe1)](),_0x5fce45=Math[_0x2046a4(0xe5)](_0x75f29a/0x3e8/0x3c);console[_0x2046a4(0xe7)](_0x2046a4(0x104));const _0x8eadac=_0x233717['end'];_0x233717['end']=(..._0x3c47e8)=>{const _0x3d8d09=_0x2046a4;console[_0x3d8d09(0xe7)](_0x5fce45,{'currentMinute':_0x5fce45});_0x5fce45>RequestMonitor[_0x3d8d09(0x10d)]&&(RequestMonitor[_0x3d8d09(0x10b)][_0x3d8d09(0xfd)]({'timestamp':RequestMonitor[_0x3d8d09(0x10d)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x3d8d09(0xe4)]=0x0,RequestMonitor['lastMinute']=_0x5fce45);RequestMonitor[_0x3d8d09(0xe4)]++,RequestMonitor['httpCodesData']['push']({'timestamp':Date[_0x3d8d09(0xe1)](),'statusCode':_0x233717[_0x3d8d09(0xe0)],'path':_0x374f59[_0x3d8d09(0xfb)],'method':_0x374f59[_0x3d8d09(0xdc)]});const _0x2c8ad8=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x3d8d09(0x107)]=RequestMonitor[_0x3d8d09(0x107)][_0x3d8d09(0xf9)](_0x1d2d03=>_0x1d2d03['timestamp']>_0x2c8ad8),_0x8eadac['apply'](_0x233717,_0x3c47e8);},_0x4f30b0();}static async[a1_0x3ebe3f(0xfe)](){const _0x556629=a1_0x3ebe3f;try{RequestMonitor[_0x556629(0x10d)]!==Math[_0x556629(0xe5)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x556629(0x10b)][_0x556629(0xfd)]({'timestamp':RequestMonitor[_0x556629(0x10d)]*0x3e8*0x3c,'requests':RequestMonitor[_0x556629(0xe4)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x556629(0x10d)]=Math[_0x556629(0xe5)](Date[_0x556629(0xe1)]()/0x3e8/0x3c)),await fs[_0x556629(0x112)](RequestMonitor[_0x556629(0xff)],JSON[_0x556629(0xe3)](RequestMonitor[_0x556629(0x10b)],null,0x2)),await fs[_0x556629(0x112)](RequestMonitor[_0x556629(0xf1)],JSON[_0x556629(0xe3)](RequestMonitor[_0x556629(0x107)],null,0x2));}catch(_0x1760ce){console['error'](_0x556629(0xef),_0x1760ce);}}static async[a1_0x3ebe3f(0x111)](){const _0x4a725d=a1_0x3ebe3f;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x17b292=a1_0x5c61;RequestMonitor[_0x17b292(0xee)]()[_0x17b292(0x10e)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x4a725d(0xee)]()['then'](()=>{});}static async[a1_0x3ebe3f(0xee)](){const _0x4c65ca=a1_0x3ebe3f,_0x2dc205=osu[_0x4c65ca(0xdb)],_0x5aee92=osu[_0x4c65ca(0xd7)],_0x3ed79f=osu['netstat'],_0x8a5eeb={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x3cc1ab=await _0x3ed79f[_0x4c65ca(0xcd)]();_0x8a5eeb['total'][_0x4c65ca(0xd4)]=_0x3cc1ab[_0x4c65ca(0xdf)][_0x4c65ca(0xd4)],_0x8a5eeb['total'][_0x4c65ca(0x108)]=_0x3cc1ab[_0x4c65ca(0xdf)][_0x4c65ca(0x108)];}catch(_0x305191){}let _0x2d117a=0x0;try{_0x2d117a=await _0x2dc205[_0x4c65ca(0xcc)]();}catch(_0x2c8186){console['log'](_0x4c65ca(0xf4),_0x2c8186);}const _0xf3e7e9={'usedMemMb':0x0};try{const _0x5933f9=await _0x5aee92[_0x4c65ca(0x102)]();_0xf3e7e9['usedMemMb']=_0x5933f9[_0x4c65ca(0xea)];}catch(_0x1a4683){console[_0x4c65ca(0xe7)](_0x4c65ca(0x105),_0x1a4683);}const _0x3648c8=new Date()['getHours']()[_0x4c65ca(0xcf)]()[_0x4c65ca(0xf3)](0x2,'0')+':'+new Date()['getMinutes']()[_0x4c65ca(0xcf)]()[_0x4c65ca(0xf3)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x4c65ca(0xdb)]=RequestMonitor[_0x4c65ca(0xeb)][_0x4c65ca(0xdb)][_0x4c65ca(0x101)](-0x3c)[_0x4c65ca(0xf9)](_0x1b05b9=>_0x1b05b9[_0x4c65ca(0xd6)]!==_0x3648c8),RequestMonitor['ressourcesUsageStats'][_0x4c65ca(0x10a)]=RequestMonitor[_0x4c65ca(0xeb)][_0x4c65ca(0x10a)][_0x4c65ca(0x101)](-0x3c)[_0x4c65ca(0xf9)](_0x594be1=>_0x594be1[_0x4c65ca(0xd6)]!==_0x3648c8),RequestMonitor[_0x4c65ca(0xeb)]['network']=RequestMonitor[_0x4c65ca(0xeb)][_0x4c65ca(0xec)]['slice'](-0x3c)['filter'](_0xd9c7e1=>_0xd9c7e1[_0x4c65ca(0xd6)]!==_0x3648c8),RequestMonitor[_0x4c65ca(0xeb)][_0x4c65ca(0xdb)][_0x4c65ca(0xfd)]({'time':_0x3648c8,'usage':_0x2d117a}),RequestMonitor[_0x4c65ca(0xeb)]['memory'][_0x4c65ca(0xfd)]({'time':_0x3648c8,'usage':(_0xf3e7e9[_0x4c65ca(0xea)]/0x3e8)[_0x4c65ca(0xe6)](0x2)}),RequestMonitor[_0x4c65ca(0xeb)][_0x4c65ca(0xec)][_0x4c65ca(0xfd)]({'time':_0x3648c8,'usage':{'in':_0x8a5eeb[_0x4c65ca(0xdf)]?.['inputMb']??0x0,'out':_0x8a5eeb['total']?.[_0x4c65ca(0x108)]??0x0}});try{await fs[_0x4c65ca(0x112)](RequestMonitor['ressourcesUsageStatsPath'],JSON[_0x4c65ca(0xe3)](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x272eb6){console[_0x4c65ca(0xf5)]('Error\x20saving\x20monitoring\x20data:',_0x272eb6);}}static[a1_0x3ebe3f(0xd8)](){const _0x3bc8b3=a1_0x3ebe3f,_0x359516=Date[_0x3bc8b3(0xe1)](),_0x5e8498=_0x359516-0x3c*0x3c*0x3e8,_0x7886f1=_0x359516-0x18*0x3c*0x3c*0x3e8,_0x1aacf5=RequestMonitor[_0x3bc8b3(0x10b)][_0x3bc8b3(0xf9)](_0xe8003f=>_0xe8003f['timestamp']>_0x5e8498),_0x30e759={'total':RequestMonitor[_0x3bc8b3(0x107)][_0x3bc8b3(0x106)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x3bc8b3(0x107)][_0x3bc8b3(0xd3)](_0xd87723=>{const _0x51491c=_0x3bc8b3;_0x30e759['byCodes'][_0xd87723[_0x51491c(0xe0)]]=(_0x30e759['byCodes'][_0xd87723[_0x51491c(0xe0)]]||0x0)+0x1;const _0xe39291=_0xd87723[_0x51491c(0xdc)]+'\x20'+_0xd87723[_0x51491c(0xfb)];!_0x30e759['byPath'][_0xe39291]&&(_0x30e759['byPath'][_0xe39291]={'total':0x0,'codes':{}}),_0x30e759[_0x51491c(0x100)][_0xe39291][_0x51491c(0xdf)]++,_0x30e759['byPath'][_0xe39291][_0x51491c(0xf8)][_0xd87723[_0x51491c(0xe0)]]=(_0x30e759[_0x51491c(0x100)][_0xe39291][_0x51491c(0xf8)][_0xd87723[_0x51491c(0xe0)]]||0x0)+0x1;}),{'rps':_0x1aacf5,'httpCodes':_0x30e759,'ressourcesUsageStats':RequestMonitor[_0x3bc8b3(0xeb)]};}}RequestMonitor['init']()[a1_0x3ebe3f(0x10e)](()=>{}),RequestMonitor[a1_0x3ebe3f(0x111)]();function a1_0x5c61(_0x5d251f,_0x2411f6){const _0x502d76=a1_0x502d();return a1_0x5c61=function(_0x5c6199,_0x322696){_0x5c6199=_0x5c6199-0xcc;let _0x41d2a9=_0x502d76[_0x5c6199];return _0x41d2a9;},a1_0x5c61(_0x5d251f,_0x2411f6);}const counter=RequestMonitor;function a1_0x502d(){const _0x5d6c2e=['lastMinute','then','24zjpIBp','Initializing\x20request\x20monitor...','startPeriodicSave','writeFile','usage','inOut','exports','toString','17170Vbizyf','ressourcesUsageStatsPath','cadviewer/settings/http-codes-24h.json','forEach','inputMb','/metrics','time','mem','getStats','5DZJiZP','Request\x20monitor\x20initialized.','cpu','method','readFile','1790690VWgZuB','total','statusCode','now','1467dlNoGj','stringify','currentRequests','floor','toFixed','log','154808KbNsMz','utf8','usedMemMb','ressourcesUsageStats','network','promises','getUsageRessourcesStatsAndSave','Error\x20saving\x20monitoring\x20data:','parse','httpCodesStoragePath','init','padStart','Error\x20getting\x20CPU\x20usage:','error','417322AMYCRW','Request\x20monitor\x20middleware','codes','filter','middleware','path','142527FNRYFm','push','save','rpsStoragePath','byPath','slice','info','651854DqXZMQ','=======>','Error\x20getting\x20memory\x20usage:','length','httpCodesData','outputMb','3795030NeqUZZ','memory','rpsData','32TvPGFH'];a1_0x502d=function(){return _0x5d6c2e;};return a1_0x502d();}module[a1_0x3ebe3f(0xce)]=counter;