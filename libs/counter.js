const a1_0x56fea2=a1_0x111c;(function(_0x805b0d,_0x1fb3b3){const _0x48652e=a1_0x111c,_0x35fa37=_0x805b0d();while(!![]){try{const _0x19b339=parseInt(_0x48652e(0x11e))/0x1*(parseInt(_0x48652e(0x11f))/0x2)+-parseInt(_0x48652e(0xf0))/0x3+parseInt(_0x48652e(0xe5))/0x4+parseInt(_0x48652e(0xe9))/0x5*(parseInt(_0x48652e(0x113))/0x6)+parseInt(_0x48652e(0x111))/0x7+parseInt(_0x48652e(0x10e))/0x8*(-parseInt(_0x48652e(0xf8))/0x9)+-parseInt(_0x48652e(0xf3))/0xa;if(_0x19b339===_0x1fb3b3)break;else _0x35fa37['push'](_0x35fa37['shift']());}catch(_0x4790aa){_0x35fa37['push'](_0x35fa37['shift']());}}}(a1_0x1600,0x23414));const fs=require('fs')[a1_0x56fea2(0xdf)],osu=require(a1_0x56fea2(0xe2));class RequestMonitor{static [a1_0x56fea2(0x125)]=a1_0x56fea2(0x108);static ['httpCodesStoragePath']=a1_0x56fea2(0x121);static [a1_0x56fea2(0x115)]='cadviewer/settings/ressources-usage-stats.json';static ['rpsData']=[];static [a1_0x56fea2(0xff)]=[];static [a1_0x56fea2(0xe0)]={};static ['lastMinute']=Math[a1_0x56fea2(0x11c)](Date[a1_0x56fea2(0x10a)]()/0x3e8/0x3c);static [a1_0x56fea2(0xdc)]=0x0;static async[a1_0x56fea2(0xfd)](){const _0xc7ce88=a1_0x56fea2;console[_0xc7ce88(0x104)](_0xc7ce88(0xfb));try{const _0xbe8641=await fs[_0xc7ce88(0xe3)](RequestMonitor[_0xc7ce88(0x125)],'utf8');RequestMonitor[_0xc7ce88(0x112)]=JSON[_0xc7ce88(0xfe)](_0xbe8641);}catch(_0x3730bc){RequestMonitor[_0xc7ce88(0x112)]=[];}try{const _0x22fede=await fs[_0xc7ce88(0xe3)](RequestMonitor[_0xc7ce88(0xf7)],_0xc7ce88(0x126));RequestMonitor[_0xc7ce88(0xff)]=JSON[_0xc7ce88(0xfe)](_0x22fede);}catch(_0x3ea914){RequestMonitor[_0xc7ce88(0xff)]=[];}try{const _0x1c763a=await fs['readFile'](RequestMonitor['ressourcesUsageStatsPath'],_0xc7ce88(0x126));RequestMonitor[_0xc7ce88(0xe0)]=JSON[_0xc7ce88(0xfe)](_0x1c763a),!RequestMonitor[_0xc7ce88(0xe0)][_0xc7ce88(0x120)]&&(RequestMonitor[_0xc7ce88(0xe0)][_0xc7ce88(0x120)]=[]),!RequestMonitor['ressourcesUsageStats'][_0xc7ce88(0xef)]&&(RequestMonitor[_0xc7ce88(0xe0)][_0xc7ce88(0xef)]=[]),!RequestMonitor[_0xc7ce88(0xe0)][_0xc7ce88(0x124)]&&(RequestMonitor[_0xc7ce88(0xe0)][_0xc7ce88(0x124)]=[]);}catch(_0x3b3880){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console[_0xc7ce88(0x104)](_0xc7ce88(0xec));}static[a1_0x56fea2(0x123)](_0x13e870,_0x3071bc,_0xceb9c1){const _0xe571e1=a1_0x56fea2;if(_0x13e870['path'][_0xe571e1(0x11b)](_0xe571e1(0x100)))return _0xceb9c1();console[_0xe571e1(0x104)](_0xe571e1(0xe8));let _0x12e76b=Date['now'](),_0x379551=Math[_0xe571e1(0x11c)](_0x12e76b/0x3e8/0x3c);console[_0xe571e1(0x104)](_0xe571e1(0x107));const _0x531bb3=_0x3071bc[_0xe571e1(0x10b)];_0x3071bc[_0xe571e1(0x10b)]=(..._0x1862a6)=>{const _0x10e10b=_0xe571e1;console[_0x10e10b(0x104)](_0x379551,{'currentMinute':_0x379551});_0x379551>RequestMonitor[_0x10e10b(0x118)]&&(RequestMonitor['rpsData']['push']({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x10e10b(0x118)]=_0x379551);RequestMonitor[_0x10e10b(0xdc)]++,RequestMonitor[_0x10e10b(0xff)][_0x10e10b(0xe6)]({'timestamp':Date['now'](),'statusCode':_0x3071bc['statusCode'],'path':_0x13e870[_0x10e10b(0x119)],'method':_0x13e870['method']});const _0x2145c5=Date[_0x10e10b(0x10a)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x10e10b(0xff)]=RequestMonitor[_0x10e10b(0xff)]['filter'](_0x5e1a08=>_0x5e1a08[_0x10e10b(0xeb)]>_0x2145c5),_0x531bb3[_0x10e10b(0xf1)](_0x3071bc,_0x1862a6);},_0xceb9c1();}static async[a1_0x56fea2(0x110)](){const _0x54008e=a1_0x56fea2;try{RequestMonitor[_0x54008e(0x118)]!==Math[_0x54008e(0x11c)](Date[_0x54008e(0x10a)]()/0x3e8/0x3c)&&(RequestMonitor['rpsData'][_0x54008e(0xe6)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x54008e(0xdc)]}),RequestMonitor[_0x54008e(0xdc)]=0x0,RequestMonitor[_0x54008e(0x118)]=Math[_0x54008e(0x11c)](Date[_0x54008e(0x10a)]()/0x3e8/0x3c)),await fs['writeFile'](RequestMonitor[_0x54008e(0x125)],JSON[_0x54008e(0xe7)](RequestMonitor[_0x54008e(0x112)],null,0x2)),await fs[_0x54008e(0x122)](RequestMonitor[_0x54008e(0xf7)],JSON['stringify'](RequestMonitor[_0x54008e(0xff)],null,0x2));}catch(_0x326c21){console[_0x54008e(0xf5)](_0x54008e(0x103),_0x326c21);}}static async['startPeriodicSave'](){const _0x48c58a=a1_0x56fea2;setInterval(()=>RequestMonitor[_0x48c58a(0x110)](),0x3c*0x3e8),setInterval(()=>{const _0x5e6889=_0x48c58a;RequestMonitor[_0x5e6889(0x101)]()['then'](()=>{});},0x3c*0x3e8),RequestMonitor[_0x48c58a(0x101)]()['then'](()=>{});}static async[a1_0x56fea2(0x101)](){const _0x151a5b=a1_0x56fea2,_0x578974=osu[_0x151a5b(0x120)],_0xa39471=osu['mem'],_0x56f430=osu[_0x151a5b(0x11a)],_0x15c009={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x113964=await _0x56f430[_0x151a5b(0xfc)]();_0x15c009[_0x151a5b(0xf9)]['inputMb']=_0x113964[_0x151a5b(0xf9)][_0x151a5b(0x106)],_0x15c009[_0x151a5b(0xf9)][_0x151a5b(0xee)]=_0x113964[_0x151a5b(0xf9)][_0x151a5b(0xee)];}catch(_0x387b6f){}let _0x1f17e9=0x0;try{_0x1f17e9=await _0x578974['usage']();}catch(_0x4d16a7){console[_0x151a5b(0x104)](_0x151a5b(0xf2),_0x4d16a7);}const _0x242840={'usedMemMb':0x0};try{const _0x3f4afd=await _0xa39471[_0x151a5b(0x11d)]();_0x242840['usedMemMb']=_0x3f4afd[_0x151a5b(0xea)];}catch(_0x25f53f){console[_0x151a5b(0x104)](_0x151a5b(0x10f),_0x25f53f);}const _0xc05469=new Date()[_0x151a5b(0xda)]()[_0x151a5b(0x105)]()[_0x151a5b(0xe1)](0x2,'0')+':'+new Date()[_0x151a5b(0x114)]()[_0x151a5b(0x105)]()[_0x151a5b(0xe1)](0x2,'0');RequestMonitor[_0x151a5b(0xe0)][_0x151a5b(0x120)]=RequestMonitor[_0x151a5b(0xe0)][_0x151a5b(0x120)]['slice'](-0x3c)[_0x151a5b(0xdd)](_0x986ab8=>_0x986ab8[_0x151a5b(0xfa)]!==_0xc05469),RequestMonitor[_0x151a5b(0xe0)][_0x151a5b(0xef)]=RequestMonitor['ressourcesUsageStats'][_0x151a5b(0xef)][_0x151a5b(0x10d)](-0x3c)[_0x151a5b(0xdd)](_0x383bc4=>_0x383bc4[_0x151a5b(0xfa)]!==_0xc05469),RequestMonitor[_0x151a5b(0xe0)][_0x151a5b(0x124)]=RequestMonitor['ressourcesUsageStats'][_0x151a5b(0x124)][_0x151a5b(0x10d)](-0x3c)[_0x151a5b(0xdd)](_0x372e06=>_0x372e06['time']!==_0xc05469),RequestMonitor[_0x151a5b(0xe0)][_0x151a5b(0x120)][_0x151a5b(0xe6)]({'time':_0xc05469,'usage':_0x1f17e9}),RequestMonitor[_0x151a5b(0xe0)][_0x151a5b(0xef)][_0x151a5b(0xe6)]({'time':_0xc05469,'usage':(_0x242840[_0x151a5b(0xea)]/0x3e8)[_0x151a5b(0xed)](0x2)}),RequestMonitor[_0x151a5b(0xe0)][_0x151a5b(0x124)][_0x151a5b(0xe6)]({'time':_0xc05469,'usage':{'in':_0x15c009[_0x151a5b(0xf9)]?.[_0x151a5b(0x106)]??0x0,'out':_0x15c009[_0x151a5b(0xf9)]?.[_0x151a5b(0xee)]??0x0}});try{await fs[_0x151a5b(0x122)](RequestMonitor[_0x151a5b(0x115)],JSON[_0x151a5b(0xe7)](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x409ae1){console[_0x151a5b(0xf5)]('Error\x20saving\x20monitoring\x20data:',_0x409ae1);}}static[a1_0x56fea2(0x102)](){const _0x2fb248=a1_0x56fea2,_0x3eb6a5=Date[_0x2fb248(0x10a)](),_0x2f3b7c=_0x3eb6a5-0x3c*0x3c*0x3e8,_0x3924e2=_0x3eb6a5-0x18*0x3c*0x3c*0x3e8,_0x1d225c=RequestMonitor[_0x2fb248(0x112)]['filter'](_0x3935cc=>_0x3935cc['timestamp']>_0x2f3b7c),_0x347333={'total':RequestMonitor[_0x2fb248(0xff)][_0x2fb248(0x116)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x2fb248(0xff)][_0x2fb248(0xe4)](_0x273db1=>{const _0x62b603=_0x2fb248;_0x347333[_0x62b603(0xf6)][_0x273db1[_0x62b603(0xf4)]]=(_0x347333[_0x62b603(0xf6)][_0x273db1[_0x62b603(0xf4)]]||0x0)+0x1;const _0x3e512d=_0x273db1['method']+'\x20'+_0x273db1[_0x62b603(0x119)];!_0x347333[_0x62b603(0xde)][_0x3e512d]&&(_0x347333['byPath'][_0x3e512d]={'total':0x0,'codes':{}}),_0x347333[_0x62b603(0xde)][_0x3e512d]['total']++,_0x347333[_0x62b603(0xde)][_0x3e512d][_0x62b603(0x109)][_0x273db1[_0x62b603(0xf4)]]=(_0x347333[_0x62b603(0xde)][_0x3e512d][_0x62b603(0x109)][_0x273db1[_0x62b603(0xf4)]]||0x0)+0x1;}),{'rps':_0x1d225c,'httpCodes':_0x347333,'ressourcesUsageStats':RequestMonitor[_0x2fb248(0xe0)]};}}RequestMonitor[a1_0x56fea2(0xfd)]()[a1_0x56fea2(0x10c)](()=>{}),RequestMonitor[a1_0x56fea2(0xdb)]();const counter=RequestMonitor;function a1_0x111c(_0x14cc9,_0x89a832){const _0x160092=a1_0x1600();return a1_0x111c=function(_0x111ca5,_0x591351){_0x111ca5=_0x111ca5-0xda;let _0x50364e=_0x160092[_0x111ca5];return _0x50364e;},a1_0x111c(_0x14cc9,_0x89a832);}function a1_0x1600(){const _0x3889c1=['currentRequests','filter','byPath','promises','ressourcesUsageStats','padStart','node-os-utils','readFile','forEach','929160RvUaSA','push','stringify','Request\x20monitor\x20middleware','40dxEcHo','usedMemMb','timestamp','Request\x20monitor\x20initialized.','toFixed','outputMb','memory','86910yyLWMo','apply','Error\x20getting\x20CPU\x20usage:','4567490jTTXGN','statusCode','error','byCodes','httpCodesStoragePath','9FaKHcT','total','time','Initializing\x20request\x20monitor...','inOut','init','parse','httpCodesData','/metrics','getUsageRessourcesStatsAndSave','getStats','Error\x20saving\x20monitoring\x20data:','log','toString','inputMb','=======>','cadviewer/settings/requests-per-minute.json','codes','now','end','then','slice','1154920dBRPhe','Error\x20getting\x20memory\x20usage:','save','532035LteYOI','rpsData','133542ACNyWZ','getMinutes','ressourcesUsageStatsPath','length','exports','lastMinute','path','netstat','includes','floor','info','1ZTEIwu','576274ryTCZS','cpu','cadviewer/settings/http-codes-24h.json','writeFile','middleware','network','rpsStoragePath','utf8','getHours','startPeriodicSave'];a1_0x1600=function(){return _0x3889c1;};return a1_0x1600();}module[a1_0x56fea2(0x117)]=counter;