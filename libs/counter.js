const a1_0x4e26c2=a1_0x21d2;(function(_0x29e424,_0x16fb15){const _0x33c2bd=a1_0x21d2,_0xb50283=_0x29e424();while(!![]){try{const _0x2e3a5c=parseInt(_0x33c2bd(0x1a4))/0x1*(parseInt(_0x33c2bd(0x1a5))/0x2)+-parseInt(_0x33c2bd(0x194))/0x3*(parseInt(_0x33c2bd(0x1ab))/0x4)+parseInt(_0x33c2bd(0x196))/0x5+-parseInt(_0x33c2bd(0x181))/0x6+-parseInt(_0x33c2bd(0x16f))/0x7+-parseInt(_0x33c2bd(0x1a7))/0x8*(parseInt(_0x33c2bd(0x1a3))/0x9)+parseInt(_0x33c2bd(0x18b))/0xa;if(_0x2e3a5c===_0x16fb15)break;else _0xb50283['push'](_0xb50283['shift']());}catch(_0x4e8dcc){_0xb50283['push'](_0xb50283['shift']());}}}(a1_0x5a70,0xf1e8f));function a1_0x21d2(_0x4d568b,_0x575929){const _0x5a70cd=a1_0x5a70();return a1_0x21d2=function(_0x21d248,_0x42a4a8){_0x21d248=_0x21d248-0x16f;let _0x28f07a=_0x5a70cd[_0x21d248];return _0x28f07a;},a1_0x21d2(_0x4d568b,_0x575929);}const fs=require('fs')['promises'],osu=require(a1_0x4e26c2(0x18d));class RequestMonitor{static [a1_0x4e26c2(0x197)]=a1_0x4e26c2(0x190);static [a1_0x4e26c2(0x186)]=a1_0x4e26c2(0x1ac);static [a1_0x4e26c2(0x19b)]=a1_0x4e26c2(0x193);static [a1_0x4e26c2(0x177)]=[];static [a1_0x4e26c2(0x1a9)]=[];static [a1_0x4e26c2(0x18a)]={};static [a1_0x4e26c2(0x1b6)]=Math[a1_0x4e26c2(0x1a1)](Date[a1_0x4e26c2(0x17a)]()/0x3e8/0x3c);static [a1_0x4e26c2(0x170)]=0x0;static async[a1_0x4e26c2(0x19f)](){const _0x27929e=a1_0x4e26c2;console[_0x27929e(0x17d)](_0x27929e(0x173));try{const _0x2db155=await fs[_0x27929e(0x192)](RequestMonitor[_0x27929e(0x197)],'utf8');RequestMonitor['rpsData']=JSON[_0x27929e(0x178)](_0x2db155);}catch(_0x29a45f){RequestMonitor['rpsData']=[];}try{const _0x41bc2a=await fs[_0x27929e(0x192)](RequestMonitor[_0x27929e(0x186)],_0x27929e(0x174));RequestMonitor[_0x27929e(0x1a9)]=JSON[_0x27929e(0x178)](_0x41bc2a);}catch(_0x3c1c4f){RequestMonitor[_0x27929e(0x1a9)]=[];}try{const _0x59729f=await fs[_0x27929e(0x192)](RequestMonitor['ressourcesUsageStatsPath'],_0x27929e(0x174));RequestMonitor['ressourcesUsageStats']=JSON[_0x27929e(0x178)](_0x59729f),!RequestMonitor[_0x27929e(0x18a)][_0x27929e(0x1b4)]&&(RequestMonitor[_0x27929e(0x18a)][_0x27929e(0x1b4)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x27929e(0x18c)]&&(RequestMonitor[_0x27929e(0x18a)]['memory']=[]),!RequestMonitor[_0x27929e(0x18a)][_0x27929e(0x1b7)]&&(RequestMonitor[_0x27929e(0x18a)][_0x27929e(0x1b7)]=[]);}catch(_0x2aca26){RequestMonitor[_0x27929e(0x18a)]={'cpu':[],'memory':[],'network':[]};}console[_0x27929e(0x17d)](_0x27929e(0x175));}static[a1_0x4e26c2(0x19e)](_0x42f8e4,_0xb0178f,_0x15e130){const _0x15111f=a1_0x4e26c2;if(_0x42f8e4[_0x15111f(0x1b2)][_0x15111f(0x189)](_0x15111f(0x18e)))return _0x15e130();console[_0x15111f(0x17d)]('Request\x20monitor\x20middleware');let _0x184c1a=Date['now'](),_0x22e488=Math[_0x15111f(0x1a1)](_0x184c1a/0x3e8/0x3c);console[_0x15111f(0x17d)](_0x15111f(0x1ae));const _0x1398d7=_0xb0178f[_0x15111f(0x188)];_0xb0178f[_0x15111f(0x188)]=(..._0x3d2a37)=>{const _0x273d48=_0x15111f;console[_0x273d48(0x17d)](_0x22e488,{'currentMinute':_0x22e488});_0x22e488>RequestMonitor[_0x273d48(0x1b6)]&&(RequestMonitor[_0x273d48(0x177)][_0x273d48(0x19c)]({'timestamp':RequestMonitor[_0x273d48(0x1b6)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x273d48(0x170)]=0x0,RequestMonitor[_0x273d48(0x1b6)]=_0x22e488);RequestMonitor['currentRequests']++,RequestMonitor[_0x273d48(0x1a9)]['push']({'timestamp':Date[_0x273d48(0x17a)](),'statusCode':_0xb0178f[_0x273d48(0x185)],'path':_0x42f8e4[_0x273d48(0x1b2)],'method':_0x42f8e4['method']});const _0x39301f=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x273d48(0x1a9)]=RequestMonitor['httpCodesData'][_0x273d48(0x1af)](_0x1cfffd=>_0x1cfffd[_0x273d48(0x17b)]>_0x39301f),_0x1398d7[_0x273d48(0x199)](_0xb0178f,_0x3d2a37);},_0x15e130();}static async[a1_0x4e26c2(0x191)](){const _0x45d15f=a1_0x4e26c2;try{RequestMonitor['lastMinute']!==Math[_0x45d15f(0x1a1)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x45d15f(0x177)][_0x45d15f(0x19c)]({'timestamp':RequestMonitor[_0x45d15f(0x1b6)]*0x3e8*0x3c,'requests':RequestMonitor[_0x45d15f(0x170)]}),RequestMonitor[_0x45d15f(0x170)]=0x0,RequestMonitor[_0x45d15f(0x1b6)]=Math[_0x45d15f(0x1a1)](Date[_0x45d15f(0x17a)]()/0x3e8/0x3c)),await fs[_0x45d15f(0x1b9)](RequestMonitor[_0x45d15f(0x197)],JSON[_0x45d15f(0x182)](RequestMonitor[_0x45d15f(0x177)],null,0x2)),await fs[_0x45d15f(0x1b9)](RequestMonitor[_0x45d15f(0x186)],JSON[_0x45d15f(0x182)](RequestMonitor[_0x45d15f(0x1a9)],null,0x2));}catch(_0x102d7c){console[_0x45d15f(0x1b0)](_0x45d15f(0x198),_0x102d7c);}}static async[a1_0x4e26c2(0x18f)](){const _0x166dd5=a1_0x4e26c2;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x33b733=a1_0x21d2;RequestMonitor[_0x33b733(0x17e)]()['then'](()=>{});},0x3c*0x3e8),RequestMonitor[_0x166dd5(0x17e)]()[_0x166dd5(0x1aa)](()=>{});}static async['getUsageRessourcesStatsAndSave'](){const _0x57091d=a1_0x4e26c2,_0x43137e=osu[_0x57091d(0x1b4)],_0x395ec5=osu[_0x57091d(0x171)],_0x20d7b2=osu[_0x57091d(0x176)],_0x585a57={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x574a5d=await _0x20d7b2[_0x57091d(0x187)]();_0x585a57['total'][_0x57091d(0x1a0)]=_0x574a5d['total'][_0x57091d(0x1a0)],_0x585a57[_0x57091d(0x19a)]['outputMb']=_0x574a5d['total'][_0x57091d(0x1b8)];}catch(_0x45ed02){}let _0xa61b3=0x0;try{_0xa61b3=await _0x43137e[_0x57091d(0x184)]();}catch(_0x3bf43c){console[_0x57091d(0x17d)](_0x57091d(0x172),_0x3bf43c);}const _0x53bbf6={'usedMemMb':0x0};try{const _0x53361b=await _0x395ec5[_0x57091d(0x195)]();_0x53bbf6[_0x57091d(0x17c)]=_0x53361b[_0x57091d(0x17c)];}catch(_0x1c3c45){console['log'](_0x57091d(0x1b1),_0x1c3c45);}const _0x585868=new Date()[_0x57091d(0x1a8)]()[_0x57091d(0x179)]()['padStart'](0x2,'0')+':'+new Date()['getMinutes']()['toString']()['padStart'](0x2,'0');RequestMonitor[_0x57091d(0x18a)]['cpu']=RequestMonitor[_0x57091d(0x18a)][_0x57091d(0x1b4)][_0x57091d(0x183)](-0x3c)['filter'](_0x17d7f7=>_0x17d7f7[_0x57091d(0x1b3)]!==_0x585868),RequestMonitor['ressourcesUsageStats']['memory']=RequestMonitor['ressourcesUsageStats'][_0x57091d(0x18c)][_0x57091d(0x183)](-0x3c)[_0x57091d(0x1af)](_0xf57042=>_0xf57042[_0x57091d(0x1b3)]!==_0x585868),RequestMonitor[_0x57091d(0x18a)][_0x57091d(0x1b7)]=RequestMonitor[_0x57091d(0x18a)]['network'][_0x57091d(0x183)](-0x3c)[_0x57091d(0x1af)](_0x5432f6=>_0x5432f6[_0x57091d(0x1b3)]!==_0x585868),RequestMonitor[_0x57091d(0x18a)][_0x57091d(0x1b4)]['push']({'time':_0x585868,'usage':_0xa61b3}),RequestMonitor[_0x57091d(0x18a)][_0x57091d(0x18c)][_0x57091d(0x19c)]({'time':_0x585868,'usage':(_0x53bbf6[_0x57091d(0x17c)]/0x3e8)['toFixed'](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x57091d(0x1b7)][_0x57091d(0x19c)]({'time':_0x585868,'usage':{'in':_0x585a57[_0x57091d(0x19a)]?.[_0x57091d(0x1a0)]??0x0,'out':_0x585a57[_0x57091d(0x19a)]?.['outputMb']??0x0}});try{await fs[_0x57091d(0x1b9)](RequestMonitor[_0x57091d(0x19b)],JSON[_0x57091d(0x182)](RequestMonitor[_0x57091d(0x18a)],null,0x2));}catch(_0x23f1f5){console[_0x57091d(0x1b0)](_0x57091d(0x198),_0x23f1f5);}}static[a1_0x4e26c2(0x1ad)](){const _0x2a8111=a1_0x4e26c2,_0x1e06a4=Date[_0x2a8111(0x17a)](),_0xf2cb77=_0x1e06a4-0x3c*0x3c*0x3e8,_0x1929ad=_0x1e06a4-0x18*0x3c*0x3c*0x3e8,_0x49dbe8=RequestMonitor[_0x2a8111(0x177)]['filter'](_0x384dc2=>_0x384dc2[_0x2a8111(0x17b)]>_0xf2cb77),_0x37a981={'total':RequestMonitor[_0x2a8111(0x1a9)][_0x2a8111(0x1b5)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x2a8111(0x1a9)][_0x2a8111(0x1a2)](_0x3eeb2c=>{const _0x12475f=_0x2a8111;_0x37a981[_0x12475f(0x19d)][_0x3eeb2c[_0x12475f(0x185)]]=(_0x37a981['byCodes'][_0x3eeb2c[_0x12475f(0x185)]]||0x0)+0x1;const _0x5aadbe=_0x3eeb2c[_0x12475f(0x1a6)]+'\x20'+_0x3eeb2c[_0x12475f(0x1b2)];!_0x37a981[_0x12475f(0x180)][_0x5aadbe]&&(_0x37a981['byPath'][_0x5aadbe]={'total':0x0,'codes':{}}),_0x37a981[_0x12475f(0x180)][_0x5aadbe][_0x12475f(0x19a)]++,_0x37a981[_0x12475f(0x180)][_0x5aadbe][_0x12475f(0x17f)][_0x3eeb2c[_0x12475f(0x185)]]=(_0x37a981[_0x12475f(0x180)][_0x5aadbe]['codes'][_0x3eeb2c[_0x12475f(0x185)]]||0x0)+0x1;}),{'rps':_0x49dbe8,'httpCodes':_0x37a981,'ressourcesUsageStats':RequestMonitor[_0x2a8111(0x18a)]};}}function a1_0x5a70(){const _0x580cb0=['path','time','cpu','length','lastMinute','network','outputMb','writeFile','4027611GvGhYv','currentRequests','mem','Error\x20getting\x20CPU\x20usage:','Initializing\x20request\x20monitor...','utf8','Request\x20monitor\x20initialized.','netstat','rpsData','parse','toString','now','timestamp','usedMemMb','log','getUsageRessourcesStatsAndSave','codes','byPath','2220276MNdLKL','stringify','slice','usage','statusCode','httpCodesStoragePath','inOut','end','includes','ressourcesUsageStats','37204200jaNBcY','memory','node-os-utils','/metrics','startPeriodicSave','cadviewer/settings/requests-per-minute.json','save','readFile','cadviewer/settings/ressources-usage-stats.json','4336296WHwjhu','info','7147480ouNitP','rpsStoragePath','Error\x20saving\x20monitoring\x20data:','apply','total','ressourcesUsageStatsPath','push','byCodes','middleware','init','inputMb','floor','forEach','119115ILocTx','3461UBahhC','26SsVRYj','method','1096YEXdSp','getHours','httpCodesData','then','4WsxIwC','cadviewer/settings/http-codes-24h.json','getStats','=======>','filter','error','Error\x20getting\x20memory\x20usage:'];a1_0x5a70=function(){return _0x580cb0;};return a1_0x5a70();}RequestMonitor['init']()[a1_0x4e26c2(0x1aa)](()=>{}),RequestMonitor['startPeriodicSave']();const counter=RequestMonitor;module['exports']=counter;