const a1_0x3f9912=a1_0x2854;(function(_0x31e82c,_0x459c36){const _0x8a8cc9=a1_0x2854,_0x29c39e=_0x31e82c();while(!![]){try{const _0xdffcd0=-parseInt(_0x8a8cc9(0x12b))/0x1*(parseInt(_0x8a8cc9(0xf1))/0x2)+parseInt(_0x8a8cc9(0xe2))/0x3*(-parseInt(_0x8a8cc9(0xe5))/0x4)+parseInt(_0x8a8cc9(0x129))/0x5+parseInt(_0x8a8cc9(0xfb))/0x6*(parseInt(_0x8a8cc9(0x126))/0x7)+parseInt(_0x8a8cc9(0x10e))/0x8*(parseInt(_0x8a8cc9(0xf4))/0x9)+-parseInt(_0x8a8cc9(0x10a))/0xa*(-parseInt(_0x8a8cc9(0xeb))/0xb)+-parseInt(_0x8a8cc9(0xe4))/0xc;if(_0xdffcd0===_0x459c36)break;else _0x29c39e['push'](_0x29c39e['shift']());}catch(_0x4c7aa7){_0x29c39e['push'](_0x29c39e['shift']());}}}(a1_0x7b2c,0x49f40));const fs=require('fs')[a1_0x3f9912(0xed)],osu=require(a1_0x3f9912(0x118));class RequestMonitor{static ['rpsStoragePath']=a1_0x3f9912(0xe7);static [a1_0x3f9912(0xf8)]=a1_0x3f9912(0x121);static [a1_0x3f9912(0x11b)]='cadviewer/settings/ressources-usage-stats.json';static ['rpsData']=[];static [a1_0x3f9912(0xe1)]=[];static ['ressourcesUsageStats']={};static [a1_0x3f9912(0xf0)]=Math[a1_0x3f9912(0x11f)](Date[a1_0x3f9912(0xe8)]()/0x3e8/0x3c);static ['currentRequests']=0x0;static async[a1_0x3f9912(0xe9)](){const _0x425418=a1_0x3f9912;console[_0x425418(0x112)](_0x425418(0x127));try{const _0x50502c=await fs[_0x425418(0x10b)](RequestMonitor[_0x425418(0x10f)],_0x425418(0x116));RequestMonitor[_0x425418(0x102)]=JSON['parse'](_0x50502c);}catch(_0x2b3332){RequestMonitor['rpsData']=[];}try{const _0x22e2f2=await fs[_0x425418(0x10b)](RequestMonitor['httpCodesStoragePath'],_0x425418(0x116));RequestMonitor['httpCodesData']=JSON['parse'](_0x22e2f2);}catch(_0x3c437e){RequestMonitor[_0x425418(0xe1)]=[];}try{const _0xeaf3e5=await fs[_0x425418(0x10b)](RequestMonitor[_0x425418(0x11b)],_0x425418(0x116));RequestMonitor[_0x425418(0x110)]=JSON['parse'](_0xeaf3e5),!RequestMonitor['ressourcesUsageStats']['cpu']&&(RequestMonitor[_0x425418(0x110)][_0x425418(0x108)]=[]),!RequestMonitor[_0x425418(0x110)][_0x425418(0xfa)]&&(RequestMonitor[_0x425418(0x110)][_0x425418(0xfa)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x425418(0xf5)]&&(RequestMonitor[_0x425418(0x110)][_0x425418(0xf5)]=[]);}catch(_0x8a39cc){RequestMonitor[_0x425418(0x110)]={'cpu':[],'memory':[],'network':[]};}console['log']('Request\x20monitor\x20initialized.');}static[a1_0x3f9912(0x124)](_0x3e6379,_0x5a28b3,_0x32e215){const _0x43e06c=a1_0x3f9912;if(_0x3e6379['path'][_0x43e06c(0xfd)]('/metrics'))return _0x32e215();console[_0x43e06c(0x112)](_0x43e06c(0xff));let _0xa3b205=Date[_0x43e06c(0xe8)](),_0x138ffd=Math['floor'](_0xa3b205/0x3e8/0x3c);console[_0x43e06c(0x112)](_0x43e06c(0xea));const _0x3128f3=_0x5a28b3[_0x43e06c(0x113)];_0x5a28b3['end']=(..._0x1e61d4)=>{const _0x3d067b=_0x43e06c;console[_0x3d067b(0x112)](_0x138ffd,{'currentMinute':_0x138ffd});_0x138ffd>RequestMonitor[_0x3d067b(0xf0)]&&(RequestMonitor['rpsData'][_0x3d067b(0xe3)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x3d067b(0x105)]}),RequestMonitor[_0x3d067b(0x105)]=0x0,RequestMonitor[_0x3d067b(0xf0)]=_0x138ffd);RequestMonitor['currentRequests']++,RequestMonitor[_0x3d067b(0xe1)][_0x3d067b(0xe3)]({'timestamp':Date[_0x3d067b(0xe8)](),'statusCode':_0x5a28b3['statusCode'],'path':_0x3e6379[_0x3d067b(0x101)],'method':_0x3e6379['method']});const _0x218d23=Date[_0x3d067b(0xe8)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x3d067b(0xe1)]=RequestMonitor[_0x3d067b(0xe1)][_0x3d067b(0x11c)](_0x1488ed=>_0x1488ed[_0x3d067b(0x109)]>_0x218d23),_0x3128f3[_0x3d067b(0xf9)](_0x5a28b3,_0x1e61d4);},_0x32e215();}static async[a1_0x3f9912(0xef)](){const _0x2df2ef=a1_0x3f9912;try{RequestMonitor[_0x2df2ef(0xf0)]!==Math[_0x2df2ef(0x11f)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x2df2ef(0x102)][_0x2df2ef(0xe3)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x2df2ef(0x105)]=0x0,RequestMonitor[_0x2df2ef(0xf0)]=Math[_0x2df2ef(0x11f)](Date[_0x2df2ef(0xe8)]()/0x3e8/0x3c)),await fs[_0x2df2ef(0x10c)](RequestMonitor['rpsStoragePath'],JSON[_0x2df2ef(0xf2)](RequestMonitor['rpsData'],null,0x2)),await fs[_0x2df2ef(0x10c)](RequestMonitor[_0x2df2ef(0xf8)],JSON[_0x2df2ef(0xf2)](RequestMonitor[_0x2df2ef(0xe1)],null,0x2));}catch(_0x1e8914){console['error'](_0x2df2ef(0x125),_0x1e8914);}}static async[a1_0x3f9912(0x114)](){const _0x25653e=a1_0x3f9912;setInterval(()=>RequestMonitor[_0x25653e(0xef)](),0x3c*0x3e8),setInterval(()=>{const _0x3152c3=_0x25653e;RequestMonitor[_0x3152c3(0x128)]()[_0x3152c3(0xf3)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x25653e(0x128)]()[_0x25653e(0xf3)](()=>{});}static async['getUsageRessourcesStatsAndSave'](){const _0x25bffd=a1_0x3f9912,_0x411a72=osu[_0x25bffd(0x108)],_0x355317=osu[_0x25bffd(0x10d)],_0x502921=osu['netstat'],_0x11a1a9={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x5d97ca=await _0x502921[_0x25bffd(0x123)]();_0x11a1a9[_0x25bffd(0xee)][_0x25bffd(0x11e)]=_0x5d97ca[_0x25bffd(0xee)]['inputMb'],_0x11a1a9[_0x25bffd(0xee)][_0x25bffd(0x11d)]=_0x5d97ca[_0x25bffd(0xee)][_0x25bffd(0x11d)];}catch(_0x27ca2c){}let _0x20fed1=0x0;try{_0x20fed1=await _0x411a72[_0x25bffd(0x115)]();}catch(_0x52adbd){console[_0x25bffd(0x112)](_0x25bffd(0x120),_0x52adbd);}const _0x275eff={'usedMemMb':0x0};try{const _0x18f14a=await _0x355317[_0x25bffd(0x103)]();_0x275eff['usedMemMb']=_0x18f14a[_0x25bffd(0xf6)];}catch(_0x41b0ba){console['log'](_0x25bffd(0x111),_0x41b0ba);}const _0x262ad0=new Date()['getHours']()[_0x25bffd(0xe6)]()[_0x25bffd(0x12a)](0x2,'0')+':'+new Date()[_0x25bffd(0xec)]()[_0x25bffd(0xe6)]()['padStart'](0x2,'0');RequestMonitor[_0x25bffd(0x110)][_0x25bffd(0x108)]=RequestMonitor[_0x25bffd(0x110)][_0x25bffd(0x108)][_0x25bffd(0x11a)](-0x3c)[_0x25bffd(0x11c)](_0x5d608d=>_0x5d608d[_0x25bffd(0x100)]!==_0x262ad0),RequestMonitor[_0x25bffd(0x110)][_0x25bffd(0xfa)]=RequestMonitor[_0x25bffd(0x110)][_0x25bffd(0xfa)][_0x25bffd(0x11a)](-0x3c)[_0x25bffd(0x11c)](_0x59c1a8=>_0x59c1a8[_0x25bffd(0x100)]!==_0x262ad0),RequestMonitor['ressourcesUsageStats']['network']=RequestMonitor[_0x25bffd(0x110)][_0x25bffd(0xf5)]['slice'](-0x3c)[_0x25bffd(0x11c)](_0x178f0f=>_0x178f0f[_0x25bffd(0x100)]!==_0x262ad0),RequestMonitor[_0x25bffd(0x110)][_0x25bffd(0x108)][_0x25bffd(0xe3)]({'time':_0x262ad0,'usage':_0x20fed1}),RequestMonitor[_0x25bffd(0x110)][_0x25bffd(0xfa)][_0x25bffd(0xe3)]({'time':_0x262ad0,'usage':(_0x275eff[_0x25bffd(0xf6)]/0x3e8)['toFixed'](0x2)}),RequestMonitor[_0x25bffd(0x110)][_0x25bffd(0xf5)][_0x25bffd(0xe3)]({'time':_0x262ad0,'usage':{'in':_0x11a1a9['total']?.['inputMb']??0x0,'out':_0x11a1a9[_0x25bffd(0xee)]?.['outputMb']??0x0}});try{await fs[_0x25bffd(0x10c)](RequestMonitor[_0x25bffd(0x11b)],JSON['stringify'](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x2e8490){console[_0x25bffd(0x117)](_0x25bffd(0x125),_0x2e8490);}}static[a1_0x3f9912(0x119)](){const _0x2fc5e6=a1_0x3f9912,_0x55149a=Date[_0x2fc5e6(0xe8)](),_0x5a6aa9=_0x55149a-0x3c*0x3c*0x3e8,_0x2cc39a=_0x55149a-0x18*0x3c*0x3c*0x3e8,_0x291657=RequestMonitor[_0x2fc5e6(0x102)][_0x2fc5e6(0x11c)](_0x1ef7fc=>_0x1ef7fc[_0x2fc5e6(0x109)]>_0x5a6aa9),_0x38abf5={'total':RequestMonitor[_0x2fc5e6(0xe1)][_0x2fc5e6(0x104)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x2fc5e6(0xe1)][_0x2fc5e6(0xe0)](_0x1c781e=>{const _0x5439e7=_0x2fc5e6;_0x38abf5[_0x5439e7(0x107)][_0x1c781e[_0x5439e7(0xf7)]]=(_0x38abf5['byCodes'][_0x1c781e['statusCode']]||0x0)+0x1;const _0x13ed1f=_0x1c781e[_0x5439e7(0x122)]+'\x20'+_0x1c781e[_0x5439e7(0x101)];!_0x38abf5[_0x5439e7(0xfe)][_0x13ed1f]&&(_0x38abf5[_0x5439e7(0xfe)][_0x13ed1f]={'total':0x0,'codes':{}}),_0x38abf5[_0x5439e7(0xfe)][_0x13ed1f][_0x5439e7(0xee)]++,_0x38abf5[_0x5439e7(0xfe)][_0x13ed1f]['codes'][_0x1c781e[_0x5439e7(0xf7)]]=(_0x38abf5[_0x5439e7(0xfe)][_0x13ed1f][_0x5439e7(0x106)][_0x1c781e[_0x5439e7(0xf7)]]||0x0)+0x1;}),{'rps':_0x291657,'httpCodes':_0x38abf5,'ressourcesUsageStats':RequestMonitor[_0x2fc5e6(0x110)]};}}function a1_0x2854(_0x5d9a02,_0x3bdb6f){const _0x7b2cd0=a1_0x7b2c();return a1_0x2854=function(_0x285490,_0xe78469){_0x285490=_0x285490-0xe0;let _0xc3999a=_0x7b2cd0[_0x285490];return _0xc3999a;},a1_0x2854(_0x5d9a02,_0x3bdb6f);}function a1_0x7b2c(){const _0x26a53b=['usage','utf8','error','node-os-utils','getStats','slice','ressourcesUsageStatsPath','filter','outputMb','inputMb','floor','Error\x20getting\x20CPU\x20usage:','cadviewer/settings/http-codes-24h.json','method','inOut','middleware','Error\x20saving\x20monitoring\x20data:','5747lJqJJh','Initializing\x20request\x20monitor...','getUsageRessourcesStatsAndSave','2030730JoLLFr','padStart','79334nZWhea','forEach','httpCodesData','15kSPDMD','push','4843284XkoIZF','341708QLCLEA','toString','cadviewer/settings/requests-per-minute.json','now','init','=======>','55363YKLzJz','getMinutes','promises','total','save','lastMinute','8dyGQEf','stringify','then','480294eaTEAJ','network','usedMemMb','statusCode','httpCodesStoragePath','apply','memory','2118ISPRUp','exports','includes','byPath','Request\x20monitor\x20middleware','time','path','rpsData','info','length','currentRequests','codes','byCodes','cpu','timestamp','970QTLaSn','readFile','writeFile','mem','40cBIqje','rpsStoragePath','ressourcesUsageStats','Error\x20getting\x20memory\x20usage:','log','end','startPeriodicSave'];a1_0x7b2c=function(){return _0x26a53b;};return a1_0x7b2c();}RequestMonitor[a1_0x3f9912(0xe9)]()[a1_0x3f9912(0xf3)](()=>{}),RequestMonitor[a1_0x3f9912(0x114)]();const counter=RequestMonitor;module[a1_0x3f9912(0xfc)]=counter;