const a1_0x56d596=a1_0x3cc7;(function(_0x33022e,_0x213da7){const _0x35eddc=a1_0x3cc7,_0x407839=_0x33022e();while(!![]){try{const _0x4760e9=-parseInt(_0x35eddc(0x117))/0x1+parseInt(_0x35eddc(0x10d))/0x2+-parseInt(_0x35eddc(0x112))/0x3+-parseInt(_0x35eddc(0x12e))/0x4*(-parseInt(_0x35eddc(0x14b))/0x5)+parseInt(_0x35eddc(0x134))/0x6+-parseInt(_0x35eddc(0x10c))/0x7*(-parseInt(_0x35eddc(0x145))/0x8)+-parseInt(_0x35eddc(0x14a))/0x9;if(_0x4760e9===_0x213da7)break;else _0x407839['push'](_0x407839['shift']());}catch(_0x32803c){_0x407839['push'](_0x407839['shift']());}}}(a1_0x4646,0x895b9));const fs=require('fs')[a1_0x56d596(0x12d)],osu=require('node-os-utils');function a1_0x4646(){const _0x2d21ce=['rpsStoragePath','writeFile','time','memory','7SjZASf','556394LvRdxB','total','includes','getMinutes','timestamp','3216216FeRclq','getUsageRessourcesStatsAndSave','startPeriodicSave','Request\x20monitor\x20middleware','Request\x20monitor\x20initialized.','9273bCyThC','httpCodesStoragePath','utf8','then','codes','=======>','apply','method','outputMb','inOut','readFile','rpsData','cpu','usedMemMb','currentRequests','Error\x20saving\x20monitoring\x20data:','getStats','inputMb','Initializing\x20request\x20monitor...','push','lastMinute','/metrics','promises','436808ICtKTI','parse','filter','netstat','ressourcesUsageStatsPath','ressourcesUsageStats','5126196HoJpqL','cadviewer/settings/http-codes-24h.json','slice','Error\x20getting\x20memory\x20usage:','byPath','save','getHours','forEach','stringify','error','log','floor','cadviewer/settings/ressources-usage-stats.json','middleware','statusCode','now','toString','3835784VOXLfk','padStart','exports','byCodes','end','2661120rUdUnr','15dYLDYZ','usage','mem','network','httpCodesData','init'];a1_0x4646=function(){return _0x2d21ce;};return a1_0x4646();}class RequestMonitor{static ['rpsStoragePath']='cadviewer/settings/requests-per-minute.json';static [a1_0x56d596(0x118)]=a1_0x56d596(0x135);static [a1_0x56d596(0x132)]=a1_0x56d596(0x140);static [a1_0x56d596(0x122)]=[];static [a1_0x56d596(0x14f)]=[];static ['ressourcesUsageStats']={};static ['lastMinute']=Math[a1_0x56d596(0x13f)](Date[a1_0x56d596(0x143)]()/0x3e8/0x3c);static [a1_0x56d596(0x125)]=0x0;static async[a1_0x56d596(0x107)](){const _0x677e6b=a1_0x56d596;console[_0x677e6b(0x13e)](_0x677e6b(0x129));try{const _0x11b6ed=await fs[_0x677e6b(0x121)](RequestMonitor[_0x677e6b(0x108)],_0x677e6b(0x119));RequestMonitor['rpsData']=JSON[_0x677e6b(0x12f)](_0x11b6ed);}catch(_0x58d248){RequestMonitor['rpsData']=[];}try{const _0x363bd9=await fs[_0x677e6b(0x121)](RequestMonitor[_0x677e6b(0x118)],_0x677e6b(0x119));RequestMonitor[_0x677e6b(0x14f)]=JSON['parse'](_0x363bd9);}catch(_0x553ec7){RequestMonitor[_0x677e6b(0x14f)]=[];}try{const _0x5ddec9=await fs[_0x677e6b(0x121)](RequestMonitor[_0x677e6b(0x132)],'utf8');RequestMonitor[_0x677e6b(0x133)]=JSON[_0x677e6b(0x12f)](_0x5ddec9),!RequestMonitor[_0x677e6b(0x133)]['cpu']&&(RequestMonitor[_0x677e6b(0x133)][_0x677e6b(0x123)]=[]),!RequestMonitor[_0x677e6b(0x133)]['memory']&&(RequestMonitor['ressourcesUsageStats'][_0x677e6b(0x10b)]=[]),!RequestMonitor[_0x677e6b(0x133)][_0x677e6b(0x14e)]&&(RequestMonitor['ressourcesUsageStats'][_0x677e6b(0x14e)]=[]);}catch(_0x298007){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console[_0x677e6b(0x13e)](_0x677e6b(0x116));}static[a1_0x56d596(0x141)](_0x5cf5ba,_0x371759,_0x3bfc84){const _0x26d7c7=a1_0x56d596;if(_0x5cf5ba['path'][_0x26d7c7(0x10f)](_0x26d7c7(0x12c)))return _0x3bfc84();console[_0x26d7c7(0x13e)](_0x26d7c7(0x115));let _0x566352=Date[_0x26d7c7(0x143)](),_0x4c6ce1=Math[_0x26d7c7(0x13f)](_0x566352/0x3e8/0x3c);console['log'](_0x26d7c7(0x11c));const _0x278928=_0x371759[_0x26d7c7(0x149)];_0x371759[_0x26d7c7(0x149)]=(..._0x499fea)=>{const _0x43b2c7=_0x26d7c7;console['log'](_0x4c6ce1,{'currentMinute':_0x4c6ce1});_0x4c6ce1>RequestMonitor[_0x43b2c7(0x12b)]&&(RequestMonitor['rpsData'][_0x43b2c7(0x12a)]({'timestamp':RequestMonitor[_0x43b2c7(0x12b)]*0x3e8*0x3c,'requests':RequestMonitor[_0x43b2c7(0x125)]}),RequestMonitor[_0x43b2c7(0x125)]=0x0,RequestMonitor[_0x43b2c7(0x12b)]=_0x4c6ce1);RequestMonitor[_0x43b2c7(0x125)]++,RequestMonitor[_0x43b2c7(0x14f)][_0x43b2c7(0x12a)]({'timestamp':Date[_0x43b2c7(0x143)](),'statusCode':_0x371759['statusCode'],'path':_0x5cf5ba['path'],'method':_0x5cf5ba[_0x43b2c7(0x11e)]});const _0x4bd4ae=Date[_0x43b2c7(0x143)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x43b2c7(0x14f)]=RequestMonitor[_0x43b2c7(0x14f)][_0x43b2c7(0x130)](_0x5672f4=>_0x5672f4[_0x43b2c7(0x111)]>_0x4bd4ae),_0x278928[_0x43b2c7(0x11d)](_0x371759,_0x499fea);},_0x3bfc84();}static async[a1_0x56d596(0x139)](){const _0x41e400=a1_0x56d596;try{RequestMonitor[_0x41e400(0x12b)]!==Math['floor'](Date[_0x41e400(0x143)]()/0x3e8/0x3c)&&(RequestMonitor[_0x41e400(0x122)][_0x41e400(0x12a)]({'timestamp':RequestMonitor[_0x41e400(0x12b)]*0x3e8*0x3c,'requests':RequestMonitor[_0x41e400(0x125)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x41e400(0x12b)]=Math[_0x41e400(0x13f)](Date[_0x41e400(0x143)]()/0x3e8/0x3c)),await fs[_0x41e400(0x109)](RequestMonitor[_0x41e400(0x108)],JSON['stringify'](RequestMonitor[_0x41e400(0x122)],null,0x2)),await fs['writeFile'](RequestMonitor[_0x41e400(0x118)],JSON[_0x41e400(0x13c)](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x3f8342){console[_0x41e400(0x13d)](_0x41e400(0x126),_0x3f8342);}}static async[a1_0x56d596(0x114)](){const _0x17512b=a1_0x56d596;setInterval(()=>RequestMonitor[_0x17512b(0x139)](),0x3c*0x3e8),setInterval(()=>{const _0x2870ea=_0x17512b;RequestMonitor[_0x2870ea(0x113)]()[_0x2870ea(0x11a)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x17512b(0x113)]()[_0x17512b(0x11a)](()=>{});}static async[a1_0x56d596(0x113)](){const _0x1f3b25=a1_0x56d596,_0x5d771b=osu[_0x1f3b25(0x123)],_0x1273f3=osu[_0x1f3b25(0x14d)],_0xf9ba21=osu[_0x1f3b25(0x131)],_0x5cfcaa={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x3f691d=await _0xf9ba21[_0x1f3b25(0x120)]();_0x5cfcaa[_0x1f3b25(0x10e)][_0x1f3b25(0x128)]=_0x3f691d[_0x1f3b25(0x10e)]['inputMb'],_0x5cfcaa['total']['outputMb']=_0x3f691d[_0x1f3b25(0x10e)][_0x1f3b25(0x11f)];}catch(_0xe93661){}let _0x190a37=0x0;try{_0x190a37=await _0x5d771b[_0x1f3b25(0x14c)]();}catch(_0x3f64ca){console[_0x1f3b25(0x13e)]('Error\x20getting\x20CPU\x20usage:',_0x3f64ca);}const _0x4e5aa8={'usedMemMb':0x0};try{const _0x4613e1=await _0x1273f3['info']();_0x4e5aa8[_0x1f3b25(0x124)]=_0x4613e1[_0x1f3b25(0x124)];}catch(_0x34d777){console[_0x1f3b25(0x13e)](_0x1f3b25(0x137),_0x34d777);}const _0x4e4bf0=new Date()[_0x1f3b25(0x13a)]()[_0x1f3b25(0x144)]()[_0x1f3b25(0x146)](0x2,'0')+':'+new Date()[_0x1f3b25(0x110)]()[_0x1f3b25(0x144)]()[_0x1f3b25(0x146)](0x2,'0');RequestMonitor[_0x1f3b25(0x133)][_0x1f3b25(0x123)]=RequestMonitor['ressourcesUsageStats'][_0x1f3b25(0x123)][_0x1f3b25(0x136)](-0x3c)[_0x1f3b25(0x130)](_0xdc7b8d=>_0xdc7b8d[_0x1f3b25(0x10a)]!==_0x4e4bf0),RequestMonitor['ressourcesUsageStats']['memory']=RequestMonitor[_0x1f3b25(0x133)][_0x1f3b25(0x10b)][_0x1f3b25(0x136)](-0x3c)[_0x1f3b25(0x130)](_0x86c96b=>_0x86c96b[_0x1f3b25(0x10a)]!==_0x4e4bf0),RequestMonitor['ressourcesUsageStats'][_0x1f3b25(0x14e)]=RequestMonitor[_0x1f3b25(0x133)][_0x1f3b25(0x14e)]['slice'](-0x3c)[_0x1f3b25(0x130)](_0x585873=>_0x585873[_0x1f3b25(0x10a)]!==_0x4e4bf0),RequestMonitor['ressourcesUsageStats']['cpu'][_0x1f3b25(0x12a)]({'time':_0x4e4bf0,'usage':_0x190a37}),RequestMonitor[_0x1f3b25(0x133)][_0x1f3b25(0x10b)][_0x1f3b25(0x12a)]({'time':_0x4e4bf0,'usage':(_0x4e5aa8[_0x1f3b25(0x124)]/0x3e8)['toFixed'](0x2)}),RequestMonitor[_0x1f3b25(0x133)][_0x1f3b25(0x14e)][_0x1f3b25(0x12a)]({'time':_0x4e4bf0,'usage':{'in':_0x5cfcaa[_0x1f3b25(0x10e)]?.[_0x1f3b25(0x128)]??0x0,'out':_0x5cfcaa[_0x1f3b25(0x10e)]?.[_0x1f3b25(0x11f)]??0x0}});try{await fs[_0x1f3b25(0x109)](RequestMonitor[_0x1f3b25(0x132)],JSON[_0x1f3b25(0x13c)](RequestMonitor[_0x1f3b25(0x133)],null,0x2));}catch(_0x5d8794){console[_0x1f3b25(0x13d)](_0x1f3b25(0x126),_0x5d8794);}}static[a1_0x56d596(0x127)](){const _0xf17d97=a1_0x56d596,_0x18aca6=Date[_0xf17d97(0x143)](),_0x403796=_0x18aca6-0x3c*0x3c*0x3e8,_0x22bc36=_0x18aca6-0x18*0x3c*0x3c*0x3e8,_0x57ccee=RequestMonitor[_0xf17d97(0x122)]['filter'](_0x5178e6=>_0x5178e6['timestamp']>_0x403796),_0x3c2da2={'total':RequestMonitor[_0xf17d97(0x14f)]['length'],'byCodes':{},'byPath':{}};return RequestMonitor[_0xf17d97(0x14f)][_0xf17d97(0x13b)](_0x1ede93=>{const _0x32c9cb=_0xf17d97;_0x3c2da2['byCodes'][_0x1ede93[_0x32c9cb(0x142)]]=(_0x3c2da2[_0x32c9cb(0x148)][_0x1ede93[_0x32c9cb(0x142)]]||0x0)+0x1;const _0x25b738=_0x1ede93[_0x32c9cb(0x11e)]+'\x20'+_0x1ede93['path'];!_0x3c2da2[_0x32c9cb(0x138)][_0x25b738]&&(_0x3c2da2[_0x32c9cb(0x138)][_0x25b738]={'total':0x0,'codes':{}}),_0x3c2da2['byPath'][_0x25b738][_0x32c9cb(0x10e)]++,_0x3c2da2['byPath'][_0x25b738][_0x32c9cb(0x11b)][_0x1ede93[_0x32c9cb(0x142)]]=(_0x3c2da2['byPath'][_0x25b738]['codes'][_0x1ede93[_0x32c9cb(0x142)]]||0x0)+0x1;}),{'rps':_0x57ccee,'httpCodes':_0x3c2da2,'ressourcesUsageStats':RequestMonitor[_0xf17d97(0x133)]};}}RequestMonitor[a1_0x56d596(0x107)]()[a1_0x56d596(0x11a)](()=>{}),RequestMonitor[a1_0x56d596(0x114)]();function a1_0x3cc7(_0x4c118a,_0x41a9b0){const _0x4646a0=a1_0x4646();return a1_0x3cc7=function(_0x3cc7e2,_0x2ac598){_0x3cc7e2=_0x3cc7e2-0x107;let _0x171e36=_0x4646a0[_0x3cc7e2];return _0x171e36;},a1_0x3cc7(_0x4c118a,_0x41a9b0);}const counter=RequestMonitor;module[a1_0x56d596(0x147)]=counter;