const a1_0x1c0d90=a1_0x3cd6;(function(_0xdc352a,_0x4b93b9){const _0x1a2d9c=a1_0x3cd6,_0x1e1675=_0xdc352a();while(!![]){try{const _0x3b6a78=parseInt(_0x1a2d9c(0x10b))/0x1*(-parseInt(_0x1a2d9c(0x110))/0x2)+parseInt(_0x1a2d9c(0xfb))/0x3*(-parseInt(_0x1a2d9c(0xff))/0x4)+-parseInt(_0x1a2d9c(0x11e))/0x5+parseInt(_0x1a2d9c(0xfd))/0x6+-parseInt(_0x1a2d9c(0xd3))/0x7*(-parseInt(_0x1a2d9c(0x10a))/0x8)+-parseInt(_0x1a2d9c(0xf8))/0x9*(parseInt(_0x1a2d9c(0x10d))/0xa)+parseInt(_0x1a2d9c(0xe0))/0xb*(parseInt(_0x1a2d9c(0x10f))/0xc);if(_0x3b6a78===_0x4b93b9)break;else _0x1e1675['push'](_0x1e1675['shift']());}catch(_0xb0f0b4){_0x1e1675['push'](_0x1e1675['shift']());}}}(a1_0x4476,0x19454));const fs=require('fs')[a1_0x1c0d90(0xd9)],osu=require(a1_0x1c0d90(0x10c));class RequestMonitor{static ['rpsStoragePath']='cadviewer/settings/requests-per-minute.json';static [a1_0x1c0d90(0xe1)]=a1_0x1c0d90(0x119);static [a1_0x1c0d90(0x117)]=a1_0x1c0d90(0xd7);static [a1_0x1c0d90(0xf6)]=[];static [a1_0x1c0d90(0xf2)]=[];static ['ressourcesUsageStats']={};static [a1_0x1c0d90(0xea)]=Math['floor'](Date[a1_0x1c0d90(0xd5)]()/0x3e8/0x3c);static [a1_0x1c0d90(0xd6)]=0x0;static async['init'](){const _0x11820b=a1_0x1c0d90;console[_0x11820b(0xf3)](_0x11820b(0xde));try{const _0x45c5b0=await fs[_0x11820b(0xe5)](RequestMonitor['rpsStoragePath'],_0x11820b(0xf1));RequestMonitor['rpsData']=JSON[_0x11820b(0xec)](_0x45c5b0);}catch(_0x5e876c){RequestMonitor['rpsData']=[];}try{const _0x3dab78=await fs['readFile'](RequestMonitor[_0x11820b(0xe1)],_0x11820b(0xf1));RequestMonitor[_0x11820b(0xf2)]=JSON['parse'](_0x3dab78);}catch(_0x33b572){RequestMonitor['httpCodesData']=[];}try{const _0x54c452=await fs['readFile'](RequestMonitor[_0x11820b(0x117)],'utf8');RequestMonitor[_0x11820b(0xda)]=JSON[_0x11820b(0xec)](_0x54c452),!RequestMonitor[_0x11820b(0xda)][_0x11820b(0x115)]&&(RequestMonitor[_0x11820b(0xda)]['cpu']=[]),!RequestMonitor['ressourcesUsageStats'][_0x11820b(0xf7)]&&(RequestMonitor[_0x11820b(0xda)][_0x11820b(0xf7)]=[]),!RequestMonitor[_0x11820b(0xda)]['network']&&(RequestMonitor['ressourcesUsageStats'][_0x11820b(0xe9)]=[]);}catch(_0x5bd611){RequestMonitor[_0x11820b(0xda)]={'cpu':[],'memory':[],'network':[]};}console[_0x11820b(0xf3)](_0x11820b(0x106));}static[a1_0x1c0d90(0xdf)](_0x73b476,_0x376fe7,_0x12ad6a){const _0x2eb093=a1_0x1c0d90;if(_0x73b476[_0x2eb093(0x100)][_0x2eb093(0xf4)](_0x2eb093(0x11c)))return _0x12ad6a();console['log'](_0x2eb093(0xdb));let _0x20c6de=Date['now'](),_0x3e447b=Math['floor'](_0x20c6de/0x3e8/0x3c);console[_0x2eb093(0xf3)]('=======>');const _0x5f3dfe=_0x376fe7[_0x2eb093(0xfa)];_0x376fe7[_0x2eb093(0xfa)]=(..._0x4a0d51)=>{const _0x2df6d8=_0x2eb093;console[_0x2df6d8(0xf3)](_0x3e447b,{'currentMinute':_0x3e447b});_0x3e447b>RequestMonitor[_0x2df6d8(0xea)]&&(RequestMonitor[_0x2df6d8(0xf6)]['push']({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x2df6d8(0xd6)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x2df6d8(0xea)]=_0x3e447b);RequestMonitor[_0x2df6d8(0xd6)]++,RequestMonitor['httpCodesData'][_0x2df6d8(0xe3)]({'timestamp':Date['now'](),'statusCode':_0x376fe7[_0x2df6d8(0x107)],'path':_0x73b476[_0x2df6d8(0x100)],'method':_0x73b476[_0x2df6d8(0xfc)]});const _0x445617=Date[_0x2df6d8(0xd5)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x2df6d8(0xf2)]=RequestMonitor[_0x2df6d8(0xf2)]['filter'](_0x2be64c=>_0x2be64c[_0x2df6d8(0xe2)]>_0x445617),_0x5f3dfe[_0x2df6d8(0x118)](_0x376fe7,_0x4a0d51);},_0x12ad6a();}static async[a1_0x1c0d90(0xe8)](){const _0x258d92=a1_0x1c0d90;try{RequestMonitor[_0x258d92(0xea)]!==Math[_0x258d92(0x111)](Date[_0x258d92(0xd5)]()/0x3e8/0x3c)&&(RequestMonitor[_0x258d92(0xf6)][_0x258d92(0xe3)]({'timestamp':RequestMonitor[_0x258d92(0xea)]*0x3e8*0x3c,'requests':RequestMonitor[_0x258d92(0xd6)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x258d92(0xea)]=Math[_0x258d92(0x111)](Date[_0x258d92(0xd5)]()/0x3e8/0x3c)),await fs['writeFile'](RequestMonitor[_0x258d92(0x113)],JSON['stringify'](RequestMonitor[_0x258d92(0xf6)],null,0x2)),await fs[_0x258d92(0xdc)](RequestMonitor[_0x258d92(0xe1)],JSON['stringify'](RequestMonitor[_0x258d92(0xf2)],null,0x2));}catch(_0x5dd8f6){console[_0x258d92(0xd8)](_0x258d92(0x102),_0x5dd8f6);}}static async[a1_0x1c0d90(0xf9)](){const _0x26065f=a1_0x1c0d90;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x45eeb2=a1_0x3cd6;RequestMonitor[_0x45eeb2(0x10e)]()[_0x45eeb2(0x11a)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x26065f(0x10e)]()[_0x26065f(0x11a)](()=>{});}static async[a1_0x1c0d90(0x10e)](){const _0x737601=a1_0x1c0d90,_0x38b34f=osu[_0x737601(0x115)],_0x2b9c0b=osu[_0x737601(0xeb)],_0x5807d1=osu['netstat'],_0x41bb57={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x131aea=await _0x5807d1[_0x737601(0x114)]();_0x41bb57[_0x737601(0x105)][_0x737601(0x108)]=_0x131aea[_0x737601(0x105)][_0x737601(0x108)],_0x41bb57[_0x737601(0x105)][_0x737601(0xfe)]=_0x131aea[_0x737601(0x105)][_0x737601(0xfe)];}catch(_0x1b8938){}let _0x1c77ed=0x0;try{_0x1c77ed=await _0x38b34f[_0x737601(0xd4)]();}catch(_0x5f309c){console[_0x737601(0xf3)](_0x737601(0xdd),_0x5f309c);}const _0xa2b8ce={'usedMemMb':0x0};try{const _0x226646=await _0x2b9c0b[_0x737601(0x11b)]();_0xa2b8ce[_0x737601(0xf5)]=_0x226646[_0x737601(0xf5)];}catch(_0x35907b){console[_0x737601(0xf3)](_0x737601(0x103),_0x35907b);}const _0x1c4471=new Date()[_0x737601(0x116)]()[_0x737601(0x11d)]()[_0x737601(0xe4)](0x2,'0')+':'+new Date()[_0x737601(0xee)]()[_0x737601(0x11d)]()[_0x737601(0xe4)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x737601(0x115)]=RequestMonitor[_0x737601(0xda)][_0x737601(0x115)][_0x737601(0xe7)](-0x3c)['filter'](_0x2eaa94=>_0x2eaa94['time']!==_0x1c4471),RequestMonitor['ressourcesUsageStats']['memory']=RequestMonitor[_0x737601(0xda)]['memory'][_0x737601(0xe7)](-0x3c)['filter'](_0xb9f5f=>_0xb9f5f[_0x737601(0x112)]!==_0x1c4471),RequestMonitor['ressourcesUsageStats'][_0x737601(0xe9)]=RequestMonitor[_0x737601(0xda)]['network'][_0x737601(0xe7)](-0x3c)['filter'](_0x320acc=>_0x320acc[_0x737601(0x112)]!==_0x1c4471),RequestMonitor[_0x737601(0xda)]['cpu'][_0x737601(0xe3)]({'time':_0x1c4471,'usage':_0x1c77ed}),RequestMonitor['ressourcesUsageStats'][_0x737601(0xf7)]['push']({'time':_0x1c4471,'usage':(_0xa2b8ce[_0x737601(0xf5)]/0x3e8)['toFixed'](0x2)}),RequestMonitor[_0x737601(0xda)][_0x737601(0xe9)][_0x737601(0xe3)]({'time':_0x1c4471,'usage':{'in':_0x41bb57[_0x737601(0x105)]?.[_0x737601(0x108)]??0x0,'out':_0x41bb57[_0x737601(0x105)]?.['outputMb']??0x0}});try{await fs['writeFile'](RequestMonitor[_0x737601(0x117)],JSON[_0x737601(0x109)](RequestMonitor[_0x737601(0xda)],null,0x2));}catch(_0x4ec733){console[_0x737601(0xd8)](_0x737601(0x102),_0x4ec733);}}static['getStats'](){const _0x21a2e8=a1_0x1c0d90,_0x2d37fe=Date[_0x21a2e8(0xd5)](),_0x5454a6=_0x2d37fe-0x3c*0x3c*0x3e8,_0x1a4ae1=_0x2d37fe-0x18*0x3c*0x3c*0x3e8,_0xa0daf8=RequestMonitor[_0x21a2e8(0xf6)][_0x21a2e8(0x101)](_0x506682=>_0x506682['timestamp']>_0x5454a6),_0x2e4647={'total':RequestMonitor['httpCodesData'][_0x21a2e8(0xe6)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x21a2e8(0xf2)][_0x21a2e8(0xf0)](_0x44622f=>{const _0x583ef3=_0x21a2e8;_0x2e4647['byCodes'][_0x44622f[_0x583ef3(0x107)]]=(_0x2e4647['byCodes'][_0x44622f[_0x583ef3(0x107)]]||0x0)+0x1;const _0x520c64=_0x44622f[_0x583ef3(0xfc)]+'\x20'+_0x44622f['path'];!_0x2e4647[_0x583ef3(0xef)][_0x520c64]&&(_0x2e4647[_0x583ef3(0xef)][_0x520c64]={'total':0x0,'codes':{}}),_0x2e4647['byPath'][_0x520c64][_0x583ef3(0x105)]++,_0x2e4647[_0x583ef3(0xef)][_0x520c64][_0x583ef3(0x11f)][_0x44622f[_0x583ef3(0x107)]]=(_0x2e4647[_0x583ef3(0xef)][_0x520c64][_0x583ef3(0x11f)][_0x44622f[_0x583ef3(0x107)]]||0x0)+0x1;}),{'rps':_0xa0daf8,'httpCodes':_0x2e4647,'ressourcesUsageStats':RequestMonitor[_0x21a2e8(0xda)]};}}RequestMonitor[a1_0x1c0d90(0xed)]()[a1_0x1c0d90(0x11a)](()=>{}),RequestMonitor['startPeriodicSave']();const counter=RequestMonitor;function a1_0x3cd6(_0x10570a,_0x22a9ae){const _0x44764e=a1_0x4476();return a1_0x3cd6=function(_0x3cd6db,_0x49a72a){_0x3cd6db=_0x3cd6db-0xd3;let _0x17c5bb=_0x44764e[_0x3cd6db];return _0x17c5bb;},a1_0x3cd6(_0x10570a,_0x22a9ae);}module[a1_0x1c0d90(0x104)]=counter;function a1_0x4476(){const _0x5c4912=['usedMemMb','rpsData','memory','27roDBAD','startPeriodicSave','end','262791OOIJIs','method','114288bEvjfj','outputMb','8ngWjVP','path','filter','Error\x20saving\x20monitoring\x20data:','Error\x20getting\x20memory\x20usage:','exports','total','Request\x20monitor\x20initialized.','statusCode','inputMb','stringify','2184HdcQJP','8FaXKzQ','node-os-utils','247140YsgGVW','getUsageRessourcesStatsAndSave','96564xNaDqW','32756CqXJGi','floor','time','rpsStoragePath','inOut','cpu','getHours','ressourcesUsageStatsPath','apply','cadviewer/settings/http-codes-24h.json','then','info','/metrics','toString','9725uzNHbS','codes','1239WeYvnA','usage','now','currentRequests','cadviewer/settings/ressources-usage-stats.json','error','promises','ressourcesUsageStats','Request\x20monitor\x20middleware','writeFile','Error\x20getting\x20CPU\x20usage:','Initializing\x20request\x20monitor...','middleware','572bVNYwN','httpCodesStoragePath','timestamp','push','padStart','readFile','length','slice','save','network','lastMinute','mem','parse','init','getMinutes','byPath','forEach','utf8','httpCodesData','log','includes'];a1_0x4476=function(){return _0x5c4912;};return a1_0x4476();}