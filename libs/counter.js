const a1_0x49e18a=a1_0x59bf;(function(_0x404132,_0x2435d1){const _0xf853a5=a1_0x59bf,_0x157661=_0x404132();while(!![]){try{const _0x97018c=-parseInt(_0xf853a5(0xec))/0x1*(-parseInt(_0xf853a5(0xe8))/0x2)+-parseInt(_0xf853a5(0xcd))/0x3*(parseInt(_0xf853a5(0xc3))/0x4)+-parseInt(_0xf853a5(0xdb))/0x5*(parseInt(_0xf853a5(0xcb))/0x6)+-parseInt(_0xf853a5(0xc1))/0x7+-parseInt(_0xf853a5(0xb6))/0x8*(parseInt(_0xf853a5(0xc4))/0x9)+parseInt(_0xf853a5(0xe6))/0xa*(-parseInt(_0xf853a5(0xc6))/0xb)+parseInt(_0xf853a5(0xe5))/0xc*(parseInt(_0xf853a5(0xc0))/0xd);if(_0x97018c===_0x2435d1)break;else _0x157661['push'](_0x157661['shift']());}catch(_0x20d903){_0x157661['push'](_0x157661['shift']());}}}(a1_0x13d0,0x9eab7));function a1_0x13d0(){const _0x213e04=['getUsageRessourcesStatsAndSave','startPeriodicSave','inOut','Error\x20saving\x20monitoring\x20data:','currentRequests','Error\x20getting\x20memory\x20usage:','exports','network','parse','byPath','toString','Initializing\x20request\x20monitor...','log','1432965XESuBq','httpCodesStoragePath','then','outputMb','stringify','Request\x20monitor\x20middleware','cadviewer/settings/ressources-usage-stats.json','ressourcesUsageStats','=======>','forEach','11940FtILEz','40QROXTZ','utf8','8ufuPpA','length','rpsData','httpCodesData','212714HhVnna','end','filter','apply','Request\x20monitor\x20initialized.','getMinutes','rpsStoragePath','push','slice','method','lastMinute','middleware','usage','getStats','cadviewer/settings/requests-per-minute.json','save','codes','now','padStart','error','usedMemMb','byCodes','node-os-utils','24efkWSQ','memory','getHours','init','total','path','mem','netstat','readFile','inputMb','20605KcOmys','1024681IXfVyd','cpu','788kcrpfV','2163393EdTOSQ','cadviewer/settings/http-codes-24h.json','1669712HXYfbM','info','floor','statusCode','time','6PQEqpo','ressourcesUsageStatsPath','255ZuCaFo'];a1_0x13d0=function(){return _0x213e04;};return a1_0x13d0();}const fs=require('fs')['promises'],osu=require(a1_0x49e18a(0xb5));function a1_0x59bf(_0x547c41,_0x250d90){const _0x13d06d=a1_0x13d0();return a1_0x59bf=function(_0x59bf0e,_0x36d6e9){_0x59bf0e=_0x59bf0e-0xb4;let _0x314bf0=_0x13d06d[_0x59bf0e];return _0x314bf0;},a1_0x59bf(_0x547c41,_0x250d90);}class RequestMonitor{static [a1_0x49e18a(0xf2)]=a1_0x49e18a(0xfa);static [a1_0x49e18a(0xdc)]=a1_0x49e18a(0xc5);static [a1_0x49e18a(0xcc)]=a1_0x49e18a(0xe1);static ['rpsData']=[];static [a1_0x49e18a(0xeb)]=[];static [a1_0x49e18a(0xe2)]={};static [a1_0x49e18a(0xf6)]=Math[a1_0x49e18a(0xc8)](Date[a1_0x49e18a(0xfd)]()/0x3e8/0x3c);static [a1_0x49e18a(0xd2)]=0x0;static async[a1_0x49e18a(0xb9)](){const _0x36ef3d=a1_0x49e18a;console[_0x36ef3d(0xda)](_0x36ef3d(0xd9));try{const _0x179e83=await fs['readFile'](RequestMonitor['rpsStoragePath'],_0x36ef3d(0xe7));RequestMonitor['rpsData']=JSON[_0x36ef3d(0xd6)](_0x179e83);}catch(_0x5ccc07){RequestMonitor[_0x36ef3d(0xea)]=[];}try{const _0x43d12b=await fs[_0x36ef3d(0xbe)](RequestMonitor[_0x36ef3d(0xdc)],'utf8');RequestMonitor[_0x36ef3d(0xeb)]=JSON[_0x36ef3d(0xd6)](_0x43d12b);}catch(_0x4991e8){RequestMonitor[_0x36ef3d(0xeb)]=[];}try{const _0x41778a=await fs[_0x36ef3d(0xbe)](RequestMonitor['ressourcesUsageStatsPath'],_0x36ef3d(0xe7));RequestMonitor['ressourcesUsageStats']=JSON[_0x36ef3d(0xd6)](_0x41778a),!RequestMonitor[_0x36ef3d(0xe2)][_0x36ef3d(0xc2)]&&(RequestMonitor[_0x36ef3d(0xe2)][_0x36ef3d(0xc2)]=[]),!RequestMonitor[_0x36ef3d(0xe2)][_0x36ef3d(0xb7)]&&(RequestMonitor[_0x36ef3d(0xe2)][_0x36ef3d(0xb7)]=[]),!RequestMonitor[_0x36ef3d(0xe2)][_0x36ef3d(0xd5)]&&(RequestMonitor[_0x36ef3d(0xe2)][_0x36ef3d(0xd5)]=[]);}catch(_0x77aac4){RequestMonitor[_0x36ef3d(0xe2)]={'cpu':[],'memory':[],'network':[]};}console['log'](_0x36ef3d(0xf0));}static[a1_0x49e18a(0xf7)](_0xb810e,_0x2c6e60,_0x643a7c){const _0x15a3e0=a1_0x49e18a;if(_0xb810e[_0x15a3e0(0xbb)]['includes']('/metrics'))return _0x643a7c();console[_0x15a3e0(0xda)](_0x15a3e0(0xe0));let _0xcb84c6=Date[_0x15a3e0(0xfd)](),_0x4c2ad6=Math[_0x15a3e0(0xc8)](_0xcb84c6/0x3e8/0x3c);console['log'](_0x15a3e0(0xe3));const _0x51bfe3=_0x2c6e60[_0x15a3e0(0xed)];_0x2c6e60[_0x15a3e0(0xed)]=(..._0x16c080)=>{const _0x21501c=_0x15a3e0;console[_0x21501c(0xda)](_0x4c2ad6,{'currentMinute':_0x4c2ad6});_0x4c2ad6>RequestMonitor[_0x21501c(0xf6)]&&(RequestMonitor[_0x21501c(0xea)][_0x21501c(0xf3)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x21501c(0xd2)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x21501c(0xf6)]=_0x4c2ad6);RequestMonitor[_0x21501c(0xd2)]++,RequestMonitor[_0x21501c(0xeb)]['push']({'timestamp':Date['now'](),'statusCode':_0x2c6e60[_0x21501c(0xc9)],'path':_0xb810e['path'],'method':_0xb810e['method']});const _0x22e20f=Date[_0x21501c(0xfd)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x21501c(0xeb)]=RequestMonitor[_0x21501c(0xeb)][_0x21501c(0xee)](_0x5a2ac7=>_0x5a2ac7['timestamp']>_0x22e20f),_0x51bfe3[_0x21501c(0xef)](_0x2c6e60,_0x16c080);},_0x643a7c();}static async['save'](){const _0x18219b=a1_0x49e18a;try{RequestMonitor[_0x18219b(0xf6)]!==Math[_0x18219b(0xc8)](Date[_0x18219b(0xfd)]()/0x3e8/0x3c)&&(RequestMonitor['rpsData'][_0x18219b(0xf3)]({'timestamp':RequestMonitor[_0x18219b(0xf6)]*0x3e8*0x3c,'requests':RequestMonitor[_0x18219b(0xd2)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x18219b(0xf6)]=Math[_0x18219b(0xc8)](Date[_0x18219b(0xfd)]()/0x3e8/0x3c)),await fs['writeFile'](RequestMonitor[_0x18219b(0xf2)],JSON[_0x18219b(0xdf)](RequestMonitor[_0x18219b(0xea)],null,0x2)),await fs['writeFile'](RequestMonitor[_0x18219b(0xdc)],JSON['stringify'](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x5bd85b){console[_0x18219b(0xff)]('Error\x20saving\x20monitoring\x20data:',_0x5bd85b);}}static async[a1_0x49e18a(0xcf)](){const _0x2b7f52=a1_0x49e18a;setInterval(()=>RequestMonitor[_0x2b7f52(0xfb)](),0x3c*0x3e8),setInterval(()=>{const _0x32be91=_0x2b7f52;RequestMonitor[_0x32be91(0xce)]()['then'](()=>{});},0x3c*0x3e8),RequestMonitor[_0x2b7f52(0xce)]()[_0x2b7f52(0xdd)](()=>{});}static async['getUsageRessourcesStatsAndSave'](){const _0x2957e4=a1_0x49e18a,_0x59c1e9=osu[_0x2957e4(0xc2)],_0x5c07c3=osu[_0x2957e4(0xbc)],_0x36ab17=osu[_0x2957e4(0xbd)],_0x1e2c42={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x168642=await _0x36ab17[_0x2957e4(0xd0)]();_0x1e2c42[_0x2957e4(0xba)][_0x2957e4(0xbf)]=_0x168642[_0x2957e4(0xba)][_0x2957e4(0xbf)],_0x1e2c42[_0x2957e4(0xba)][_0x2957e4(0xde)]=_0x168642[_0x2957e4(0xba)][_0x2957e4(0xde)];}catch(_0x17b08a){}let _0x5eaa4a=0x0;try{_0x5eaa4a=await _0x59c1e9[_0x2957e4(0xf8)]();}catch(_0x3ca125){console[_0x2957e4(0xda)]('Error\x20getting\x20CPU\x20usage:',_0x3ca125);}const _0x390818={'usedMemMb':0x0};try{const _0x330435=await _0x5c07c3[_0x2957e4(0xc7)]();_0x390818['usedMemMb']=_0x330435[_0x2957e4(0x100)];}catch(_0x1e2326){console[_0x2957e4(0xda)](_0x2957e4(0xd3),_0x1e2326);}const _0x3924ba=new Date()[_0x2957e4(0xb8)]()[_0x2957e4(0xd8)]()[_0x2957e4(0xfe)](0x2,'0')+':'+new Date()[_0x2957e4(0xf1)]()[_0x2957e4(0xd8)]()['padStart'](0x2,'0');RequestMonitor[_0x2957e4(0xe2)][_0x2957e4(0xc2)]=RequestMonitor[_0x2957e4(0xe2)][_0x2957e4(0xc2)]['slice'](-0x3c)['filter'](_0x57645c=>_0x57645c[_0x2957e4(0xca)]!==_0x3924ba),RequestMonitor['ressourcesUsageStats']['memory']=RequestMonitor[_0x2957e4(0xe2)]['memory']['slice'](-0x3c)['filter'](_0x1dff18=>_0x1dff18[_0x2957e4(0xca)]!==_0x3924ba),RequestMonitor[_0x2957e4(0xe2)]['network']=RequestMonitor[_0x2957e4(0xe2)][_0x2957e4(0xd5)][_0x2957e4(0xf4)](-0x3c)['filter'](_0x4c069c=>_0x4c069c[_0x2957e4(0xca)]!==_0x3924ba),RequestMonitor['ressourcesUsageStats'][_0x2957e4(0xc2)]['push']({'time':_0x3924ba,'usage':_0x5eaa4a}),RequestMonitor[_0x2957e4(0xe2)][_0x2957e4(0xb7)][_0x2957e4(0xf3)]({'time':_0x3924ba,'usage':(_0x390818[_0x2957e4(0x100)]/0x3e8)['toFixed'](0x2)}),RequestMonitor[_0x2957e4(0xe2)][_0x2957e4(0xd5)][_0x2957e4(0xf3)]({'time':_0x3924ba,'usage':{'in':_0x1e2c42['total']?.[_0x2957e4(0xbf)]??0x0,'out':_0x1e2c42[_0x2957e4(0xba)]?.['outputMb']??0x0}});try{await fs['writeFile'](RequestMonitor[_0x2957e4(0xcc)],JSON[_0x2957e4(0xdf)](RequestMonitor[_0x2957e4(0xe2)],null,0x2));}catch(_0xf6992f){console[_0x2957e4(0xff)](_0x2957e4(0xd1),_0xf6992f);}}static[a1_0x49e18a(0xf9)](){const _0x440d1d=a1_0x49e18a,_0x322ccf=Date[_0x440d1d(0xfd)](),_0x1d7543=_0x322ccf-0x3c*0x3c*0x3e8,_0x43a975=_0x322ccf-0x18*0x3c*0x3c*0x3e8,_0x157a23=RequestMonitor[_0x440d1d(0xea)]['filter'](_0x986387=>_0x986387['timestamp']>_0x1d7543),_0x6178c4={'total':RequestMonitor[_0x440d1d(0xeb)][_0x440d1d(0xe9)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x440d1d(0xeb)][_0x440d1d(0xe4)](_0xebbd9a=>{const _0x197ba6=_0x440d1d;_0x6178c4[_0x197ba6(0xb4)][_0xebbd9a['statusCode']]=(_0x6178c4[_0x197ba6(0xb4)][_0xebbd9a[_0x197ba6(0xc9)]]||0x0)+0x1;const _0x2a7ed2=_0xebbd9a[_0x197ba6(0xf5)]+'\x20'+_0xebbd9a[_0x197ba6(0xbb)];!_0x6178c4[_0x197ba6(0xd7)][_0x2a7ed2]&&(_0x6178c4[_0x197ba6(0xd7)][_0x2a7ed2]={'total':0x0,'codes':{}}),_0x6178c4[_0x197ba6(0xd7)][_0x2a7ed2][_0x197ba6(0xba)]++,_0x6178c4[_0x197ba6(0xd7)][_0x2a7ed2][_0x197ba6(0xfc)][_0xebbd9a[_0x197ba6(0xc9)]]=(_0x6178c4[_0x197ba6(0xd7)][_0x2a7ed2][_0x197ba6(0xfc)][_0xebbd9a[_0x197ba6(0xc9)]]||0x0)+0x1;}),{'rps':_0x157a23,'httpCodes':_0x6178c4,'ressourcesUsageStats':RequestMonitor[_0x440d1d(0xe2)]};}}RequestMonitor['init']()[a1_0x49e18a(0xdd)](()=>{}),RequestMonitor['startPeriodicSave']();const counter=RequestMonitor;module[a1_0x49e18a(0xd4)]=counter;