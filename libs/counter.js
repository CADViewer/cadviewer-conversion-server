const a1_0x41f330=a1_0x2488;function a1_0x2488(_0x469970,_0x392094){const _0x3f3d16=a1_0x3f3d();return a1_0x2488=function(_0x2488dd,_0x197e6b){_0x2488dd=_0x2488dd-0xde;let _0x1d64ab=_0x3f3d16[_0x2488dd];return _0x1d64ab;},a1_0x2488(_0x469970,_0x392094);}(function(_0x20dfef,_0x7cb49f){const _0x45b861=a1_0x2488,_0x2d7eb9=_0x20dfef();while(!![]){try{const _0x2f6df5=-parseInt(_0x45b861(0xf6))/0x1*(parseInt(_0x45b861(0x111))/0x2)+-parseInt(_0x45b861(0xeb))/0x3*(parseInt(_0x45b861(0x107))/0x4)+parseInt(_0x45b861(0xe7))/0x5*(parseInt(_0x45b861(0xe9))/0x6)+-parseInt(_0x45b861(0x128))/0x7*(-parseInt(_0x45b861(0xf5))/0x8)+parseInt(_0x45b861(0x109))/0x9*(parseInt(_0x45b861(0x120))/0xa)+parseInt(_0x45b861(0xfc))/0xb+-parseInt(_0x45b861(0x10c))/0xc;if(_0x2f6df5===_0x7cb49f)break;else _0x2d7eb9['push'](_0x2d7eb9['shift']());}catch(_0x1b3727){_0x2d7eb9['push'](_0x2d7eb9['shift']());}}}(a1_0x3f3d,0x91136));const fs=require('fs')[a1_0x41f330(0x112)],osu=require('node-os-utils');class RequestMonitor{static ['rpsStoragePath']=a1_0x41f330(0x114);static [a1_0x41f330(0xea)]=a1_0x41f330(0x11d);static ['ressourcesUsageStatsPath']=a1_0x41f330(0xe5);static [a1_0x41f330(0xf3)]=[];static ['httpCodesData']=[];static ['ressourcesUsageStats']={};static [a1_0x41f330(0xe3)]=Math[a1_0x41f330(0x103)](Date[a1_0x41f330(0x10b)]()/0x3e8/0x3c);static [a1_0x41f330(0x11e)]=0x0;static async[a1_0x41f330(0x123)](){const _0x1ec5f2=a1_0x41f330;console['log'](_0x1ec5f2(0x11c));try{const _0x750005=await fs[_0x1ec5f2(0xf9)](RequestMonitor[_0x1ec5f2(0x115)],_0x1ec5f2(0xe6));RequestMonitor['rpsData']=JSON[_0x1ec5f2(0x127)](_0x750005);}catch(_0x67cd63){RequestMonitor[_0x1ec5f2(0xf3)]=[];}try{const _0xec0a40=await fs[_0x1ec5f2(0xf9)](RequestMonitor['httpCodesStoragePath'],_0x1ec5f2(0xe6));RequestMonitor[_0x1ec5f2(0xfa)]=JSON['parse'](_0xec0a40);}catch(_0x24434a){RequestMonitor[_0x1ec5f2(0xfa)]=[];}try{const _0x1993f1=await fs[_0x1ec5f2(0xf9)](RequestMonitor[_0x1ec5f2(0x104)],_0x1ec5f2(0xe6));RequestMonitor['ressourcesUsageStats']=JSON[_0x1ec5f2(0x127)](_0x1993f1),!RequestMonitor['ressourcesUsageStats'][_0x1ec5f2(0x11a)]&&(RequestMonitor[_0x1ec5f2(0xf8)]['cpu']=[]),!RequestMonitor[_0x1ec5f2(0xf8)][_0x1ec5f2(0x110)]&&(RequestMonitor[_0x1ec5f2(0xf8)]['memory']=[]),!RequestMonitor[_0x1ec5f2(0xf8)]['network']&&(RequestMonitor[_0x1ec5f2(0xf8)][_0x1ec5f2(0xef)]=[]);}catch(_0x22c7a5){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console[_0x1ec5f2(0x100)](_0x1ec5f2(0xdf));}static['middleware'](_0x34f734,_0x471d87,_0x14e12c){const _0x47b18d=a1_0x41f330;if(_0x34f734[_0x47b18d(0x126)][_0x47b18d(0xff)](_0x47b18d(0xfb)))return _0x14e12c();console[_0x47b18d(0x100)](_0x47b18d(0xf1));let _0xf6937d=Date[_0x47b18d(0x10b)](),_0x3d8d7b=Math[_0x47b18d(0x103)](_0xf6937d/0x3e8/0x3c);console[_0x47b18d(0x100)](_0x47b18d(0x117));const _0x262f9e=_0x471d87[_0x47b18d(0x125)];_0x471d87[_0x47b18d(0x125)]=(..._0x501902)=>{const _0xee4112=_0x47b18d;console['log'](_0x3d8d7b,{'currentMinute':_0x3d8d7b});_0x3d8d7b>RequestMonitor['lastMinute']&&(RequestMonitor['rpsData'][_0xee4112(0x108)]({'timestamp':RequestMonitor[_0xee4112(0xe3)]*0x3e8*0x3c,'requests':RequestMonitor[_0xee4112(0x11e)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0xee4112(0xe3)]=_0x3d8d7b);RequestMonitor[_0xee4112(0x11e)]++,RequestMonitor[_0xee4112(0xfa)][_0xee4112(0x108)]({'timestamp':Date[_0xee4112(0x10b)](),'statusCode':_0x471d87[_0xee4112(0x118)],'path':_0x34f734['path'],'method':_0x34f734[_0xee4112(0xde)]});const _0x4d63ab=Date[_0xee4112(0x10b)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0xee4112(0xfa)]=RequestMonitor[_0xee4112(0xfa)][_0xee4112(0xfe)](_0x1d7ec1=>_0x1d7ec1[_0xee4112(0x10e)]>_0x4d63ab),_0x262f9e[_0xee4112(0xf7)](_0x471d87,_0x501902);},_0x14e12c();}static async[a1_0x41f330(0xf4)](){const _0x590017=a1_0x41f330;try{RequestMonitor[_0x590017(0xe3)]!==Math['floor'](Date[_0x590017(0x10b)]()/0x3e8/0x3c)&&(RequestMonitor[_0x590017(0xf3)][_0x590017(0x108)]({'timestamp':RequestMonitor[_0x590017(0xe3)]*0x3e8*0x3c,'requests':RequestMonitor[_0x590017(0x11e)]}),RequestMonitor[_0x590017(0x11e)]=0x0,RequestMonitor['lastMinute']=Math[_0x590017(0x103)](Date[_0x590017(0x10b)]()/0x3e8/0x3c)),await fs[_0x590017(0xf0)](RequestMonitor[_0x590017(0x115)],JSON[_0x590017(0x129)](RequestMonitor[_0x590017(0xf3)],null,0x2)),await fs['writeFile'](RequestMonitor[_0x590017(0xea)],JSON['stringify'](RequestMonitor[_0x590017(0xfa)],null,0x2));}catch(_0x42702e){console[_0x590017(0x11b)](_0x590017(0xfd),_0x42702e);}}static async[a1_0x41f330(0x121)](){setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{RequestMonitor['getUsageRessourcesStatsAndSave']()['then'](()=>{});},0x3c*0x3e8),RequestMonitor['getUsageRessourcesStatsAndSave']()['then'](()=>{});}static async['getUsageRessourcesStatsAndSave'](){const _0x56f598=a1_0x41f330,_0x326c01=osu[_0x56f598(0x11a)],_0x2205e4=osu[_0x56f598(0xe0)],_0x3119f4=osu[_0x56f598(0x10f)],_0x512425={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x459f4d=await _0x3119f4[_0x56f598(0x10d)]();_0x512425[_0x56f598(0xf2)][_0x56f598(0xe4)]=_0x459f4d[_0x56f598(0xf2)][_0x56f598(0xe4)],_0x512425[_0x56f598(0xf2)][_0x56f598(0x101)]=_0x459f4d[_0x56f598(0xf2)][_0x56f598(0x101)];}catch(_0x53740e){}let _0x138588=0x0;try{_0x138588=await _0x326c01['usage']();}catch(_0x318254){console[_0x56f598(0x100)](_0x56f598(0xee),_0x318254);}const _0x5dafd1={'usedMemMb':0x0};try{const _0x49740f=await _0x2205e4['info']();_0x5dafd1[_0x56f598(0x113)]=_0x49740f[_0x56f598(0x113)];}catch(_0xf492fc){console[_0x56f598(0x100)](_0x56f598(0xec),_0xf492fc);}const _0x5143ca=new Date()[_0x56f598(0xe1)]()['toString']()[_0x56f598(0x11f)](0x2,'0')+':'+new Date()[_0x56f598(0x105)]()[_0x56f598(0x124)]()['padStart'](0x2,'0');RequestMonitor[_0x56f598(0xf8)][_0x56f598(0x11a)]=RequestMonitor[_0x56f598(0xf8)][_0x56f598(0x11a)][_0x56f598(0x10a)](-0x3c)[_0x56f598(0xfe)](_0x59c252=>_0x59c252[_0x56f598(0x102)]!==_0x5143ca),RequestMonitor['ressourcesUsageStats'][_0x56f598(0x110)]=RequestMonitor[_0x56f598(0xf8)][_0x56f598(0x110)][_0x56f598(0x10a)](-0x3c)['filter'](_0x249c32=>_0x249c32[_0x56f598(0x102)]!==_0x5143ca),RequestMonitor[_0x56f598(0xf8)]['network']=RequestMonitor[_0x56f598(0xf8)][_0x56f598(0xef)][_0x56f598(0x10a)](-0x3c)[_0x56f598(0xfe)](_0x3dc127=>_0x3dc127[_0x56f598(0x102)]!==_0x5143ca),RequestMonitor[_0x56f598(0xf8)][_0x56f598(0x11a)]['push']({'time':_0x5143ca,'usage':_0x138588}),RequestMonitor[_0x56f598(0xf8)][_0x56f598(0x110)][_0x56f598(0x108)]({'time':_0x5143ca,'usage':(_0x5dafd1[_0x56f598(0x113)]/0x3e8)[_0x56f598(0xe2)](0x2)}),RequestMonitor[_0x56f598(0xf8)][_0x56f598(0xef)][_0x56f598(0x108)]({'time':_0x5143ca,'usage':{'in':_0x512425[_0x56f598(0xf2)]?.[_0x56f598(0xe4)]??0x0,'out':_0x512425[_0x56f598(0xf2)]?.[_0x56f598(0x101)]??0x0}});try{await fs[_0x56f598(0xf0)](RequestMonitor['ressourcesUsageStatsPath'],JSON['stringify'](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x157173){console[_0x56f598(0x11b)]('Error\x20saving\x20monitoring\x20data:',_0x157173);}}static[a1_0x41f330(0x122)](){const _0x3b5ed0=a1_0x41f330,_0x50deea=Date[_0x3b5ed0(0x10b)](),_0xba71d7=_0x50deea-0x3c*0x3c*0x3e8,_0x27f9aa=_0x50deea-0x18*0x3c*0x3c*0x3e8,_0x4fbd4e=RequestMonitor[_0x3b5ed0(0xf3)][_0x3b5ed0(0xfe)](_0x203b1e=>_0x203b1e['timestamp']>_0xba71d7),_0x2df50c={'total':RequestMonitor['httpCodesData'][_0x3b5ed0(0x119)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x3b5ed0(0xfa)][_0x3b5ed0(0x106)](_0x3c7ab6=>{const _0x21563c=_0x3b5ed0;_0x2df50c[_0x21563c(0xed)][_0x3c7ab6['statusCode']]=(_0x2df50c[_0x21563c(0xed)][_0x3c7ab6[_0x21563c(0x118)]]||0x0)+0x1;const _0x38244c=_0x3c7ab6[_0x21563c(0xde)]+'\x20'+_0x3c7ab6[_0x21563c(0x126)];!_0x2df50c[_0x21563c(0x116)][_0x38244c]&&(_0x2df50c[_0x21563c(0x116)][_0x38244c]={'total':0x0,'codes':{}}),_0x2df50c[_0x21563c(0x116)][_0x38244c][_0x21563c(0xf2)]++,_0x2df50c['byPath'][_0x38244c]['codes'][_0x3c7ab6[_0x21563c(0x118)]]=(_0x2df50c['byPath'][_0x38244c]['codes'][_0x3c7ab6[_0x21563c(0x118)]]||0x0)+0x1;}),{'rps':_0x4fbd4e,'httpCodes':_0x2df50c,'ressourcesUsageStats':RequestMonitor[_0x3b5ed0(0xf8)]};}}function a1_0x3f3d(){const _0x45181a=['method','Request\x20monitor\x20initialized.','mem','getHours','toFixed','lastMinute','inputMb','cadviewer/settings/ressources-usage-stats.json','utf8','2885ygbMzS','exports','5682hcpYGi','httpCodesStoragePath','188841QbYdiW','Error\x20getting\x20memory\x20usage:','byCodes','Error\x20getting\x20CPU\x20usage:','network','writeFile','Request\x20monitor\x20middleware','total','rpsData','save','152LzFSAO','5YkRzaa','apply','ressourcesUsageStats','readFile','httpCodesData','/metrics','11796213HUcJJK','Error\x20saving\x20monitoring\x20data:','filter','includes','log','outputMb','time','floor','ressourcesUsageStatsPath','getMinutes','forEach','4PFMBea','push','1102248mGRBYH','slice','now','16770492AOITVh','inOut','timestamp','netstat','memory','400366UCLTtX','promises','usedMemMb','cadviewer/settings/requests-per-minute.json','rpsStoragePath','byPath','=======>','statusCode','length','cpu','error','Initializing\x20request\x20monitor...','cadviewer/settings/http-codes-24h.json','currentRequests','padStart','30VAmJGb','startPeriodicSave','getStats','init','toString','end','path','parse','393995zxPCCO','stringify'];a1_0x3f3d=function(){return _0x45181a;};return a1_0x3f3d();}RequestMonitor[a1_0x41f330(0x123)]()['then'](()=>{}),RequestMonitor[a1_0x41f330(0x121)]();const counter=RequestMonitor;module[a1_0x41f330(0xe8)]=counter;