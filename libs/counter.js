const a2_0x2e0e93=a2_0x2370;(function(_0x5622ee,_0x4cdcf7){const _0x4f595d=a2_0x2370,_0x57b4e1=_0x5622ee();while(!![]){try{const _0x4caa71=-parseInt(_0x4f595d(0x104))/0x1+parseInt(_0x4f595d(0xd4))/0x2+-parseInt(_0x4f595d(0xdf))/0x3*(-parseInt(_0x4f595d(0xdd))/0x4)+-parseInt(_0x4f595d(0xef))/0x5*(-parseInt(_0x4f595d(0xf2))/0x6)+-parseInt(_0x4f595d(0xe7))/0x7*(parseInt(_0x4f595d(0xed))/0x8)+parseInt(_0x4f595d(0xe5))/0x9*(-parseInt(_0x4f595d(0x118))/0xa)+parseInt(_0x4f595d(0x117))/0xb*(-parseInt(_0x4f595d(0xe3))/0xc);if(_0x4caa71===_0x4cdcf7)break;else _0x57b4e1['push'](_0x57b4e1['shift']());}catch(_0x1aae73){_0x57b4e1['push'](_0x57b4e1['shift']());}}}(a2_0x27c7,0xa311f));function a2_0x2370(_0x4300a1,_0x2c861c){const _0x27c73c=a2_0x27c7();return a2_0x2370=function(_0x237003,_0x410625){_0x237003=_0x237003-0xd0;let _0x753f69=_0x27c73c[_0x237003];return _0x753f69;},a2_0x2370(_0x4300a1,_0x2c861c);}const fs=require('fs')[a2_0x2e0e93(0xe9)],osu=require('node-os-utils');class RequestMonitor{static [a2_0x2e0e93(0xff)]=a2_0x2e0e93(0xdb);static ['httpCodesStoragePath']=a2_0x2e0e93(0x110);static [a2_0x2e0e93(0xda)]=a2_0x2e0e93(0xe0);static ['rpsData']=[];static [a2_0x2e0e93(0xea)]=[];static [a2_0x2e0e93(0xe2)]={};static [a2_0x2e0e93(0xd3)]=Math[a2_0x2e0e93(0xeb)](Date[a2_0x2e0e93(0xf8)]()/0x3e8/0x3c);static [a2_0x2e0e93(0xd6)]=0x0;static async['init'](){const _0x394686=a2_0x2e0e93;console['log'](_0x394686(0xd0));try{const _0x2f10b6=await fs[_0x394686(0x105)](RequestMonitor[_0x394686(0xff)],_0x394686(0xfb));RequestMonitor['rpsData']=JSON[_0x394686(0xf7)](_0x2f10b6);}catch(_0x563faf){RequestMonitor['rpsData']=[];}try{const _0x18fb3c=await fs[_0x394686(0x105)](RequestMonitor[_0x394686(0x10f)],'utf8');RequestMonitor[_0x394686(0xea)]=JSON['parse'](_0x18fb3c);}catch(_0x4a33bc){RequestMonitor[_0x394686(0xea)]=[];}try{const _0x3f8e79=await fs[_0x394686(0x105)](RequestMonitor[_0x394686(0xda)],_0x394686(0xfb));RequestMonitor[_0x394686(0xe2)]=JSON[_0x394686(0xf7)](_0x3f8e79),!RequestMonitor[_0x394686(0xe2)]['cpu']&&(RequestMonitor[_0x394686(0xe2)][_0x394686(0xee)]=[]),!RequestMonitor[_0x394686(0xe2)][_0x394686(0xe6)]&&(RequestMonitor['ressourcesUsageStats'][_0x394686(0xe6)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x394686(0xf3)]&&(RequestMonitor[_0x394686(0xe2)][_0x394686(0xf3)]=[]);}catch(_0x555fa1){RequestMonitor[_0x394686(0xe2)]={'cpu':[],'memory':[],'network':[]};}console[_0x394686(0x10c)](_0x394686(0xf0));}static[a2_0x2e0e93(0xfa)](_0xf6edbd,_0x318240,_0x49f0b7){const _0x21acbd=a2_0x2e0e93;if(_0xf6edbd[_0x21acbd(0x102)]['includes'](_0x21acbd(0x107)))return _0x49f0b7();console[_0x21acbd(0x10c)](_0x21acbd(0xf6));let _0x5ed8b5=Date['now'](),_0x3e6c4a=Math[_0x21acbd(0xeb)](_0x5ed8b5/0x3e8/0x3c);console[_0x21acbd(0x10c)]('=======>');const _0x2723b5=_0x318240[_0x21acbd(0x10d)];_0x318240[_0x21acbd(0x10d)]=(..._0x129cd0)=>{const _0x4a2518=_0x21acbd;console['log'](_0x3e6c4a,{'currentMinute':_0x3e6c4a});_0x3e6c4a>RequestMonitor[_0x4a2518(0xd3)]&&(RequestMonitor[_0x4a2518(0xd9)]['push']({'timestamp':RequestMonitor[_0x4a2518(0xd3)]*0x3e8*0x3c,'requests':RequestMonitor[_0x4a2518(0xd6)]}),RequestMonitor[_0x4a2518(0xd6)]=0x0,RequestMonitor['lastMinute']=_0x3e6c4a);RequestMonitor['currentRequests']++,RequestMonitor['httpCodesData']['push']({'timestamp':Date[_0x4a2518(0xf8)](),'statusCode':_0x318240[_0x4a2518(0xd1)],'path':_0xf6edbd['path'],'method':_0xf6edbd[_0x4a2518(0xd2)]});const _0x31522a=Date[_0x4a2518(0xf8)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x4a2518(0xea)]=RequestMonitor['httpCodesData'][_0x4a2518(0x10e)](_0x2a7425=>_0x2a7425[_0x4a2518(0x103)]>_0x31522a),_0x2723b5[_0x4a2518(0xd8)](_0x318240,_0x129cd0);},_0x49f0b7();}static async[a2_0x2e0e93(0x114)](){const _0x1b50f5=a2_0x2e0e93;try{RequestMonitor['lastMinute']!==Math[_0x1b50f5(0xeb)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor['rpsData'][_0x1b50f5(0xfc)]({'timestamp':RequestMonitor[_0x1b50f5(0xd3)]*0x3e8*0x3c,'requests':RequestMonitor[_0x1b50f5(0xd6)]}),RequestMonitor[_0x1b50f5(0xd6)]=0x0,RequestMonitor[_0x1b50f5(0xd3)]=Math['floor'](Date['now']()/0x3e8/0x3c)),await fs[_0x1b50f5(0x112)](RequestMonitor[_0x1b50f5(0xff)],JSON['stringify'](RequestMonitor[_0x1b50f5(0xd9)],null,0x2)),await fs[_0x1b50f5(0x112)](RequestMonitor['httpCodesStoragePath'],JSON[_0x1b50f5(0x10b)](RequestMonitor[_0x1b50f5(0xea)],null,0x2));}catch(_0x3daa0c){console[_0x1b50f5(0x115)](_0x1b50f5(0xf9),_0x3daa0c);}}static async[a2_0x2e0e93(0xfd)](){const _0x852c81=a2_0x2e0e93;setInterval(()=>RequestMonitor[_0x852c81(0x114)](),0x3c*0x3e8),setInterval(()=>{const _0x54f8e0=_0x852c81;RequestMonitor[_0x54f8e0(0xe4)]()[_0x54f8e0(0xd7)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x852c81(0xe4)]()[_0x852c81(0xd7)](()=>{});}static async['getUsageRessourcesStatsAndSave'](){const _0x1e1709=a2_0x2e0e93,_0x2cd709=osu[_0x1e1709(0xee)],_0x3be19c=osu[_0x1e1709(0x111)],_0x377fcb=osu[_0x1e1709(0x116)],_0x208485={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x5201b9=await _0x377fcb['inOut']();_0x208485[_0x1e1709(0x113)][_0x1e1709(0xfe)]=_0x5201b9[_0x1e1709(0x113)][_0x1e1709(0xfe)],_0x208485['total']['outputMb']=_0x5201b9['total'][_0x1e1709(0x101)];}catch(_0xb87eb3){}let _0x4d603a=0x0;try{_0x4d603a=await _0x2cd709[_0x1e1709(0xd5)]();}catch(_0x5541dc){console['log']('Error\x20getting\x20CPU\x20usage:',_0x5541dc);}const _0x2cf959={'usedMemMb':0x0};try{const _0x245c48=await _0x3be19c[_0x1e1709(0x106)]();_0x2cf959[_0x1e1709(0xf5)]=_0x245c48[_0x1e1709(0xf5)];}catch(_0x347e0b){console['log'](_0x1e1709(0xf4),_0x347e0b);}const _0x47a904=new Date()['getHours']()[_0x1e1709(0x11a)]()[_0x1e1709(0xe8)](0x2,'0')+':'+new Date()['getMinutes']()[_0x1e1709(0x11a)]()[_0x1e1709(0xe8)](0x2,'0');RequestMonitor[_0x1e1709(0xe2)][_0x1e1709(0xee)]=RequestMonitor[_0x1e1709(0xe2)]['cpu'][_0x1e1709(0x10a)](-0x3c)[_0x1e1709(0x10e)](_0x245ed7=>_0x245ed7['time']!==_0x47a904),RequestMonitor[_0x1e1709(0xe2)]['memory']=RequestMonitor[_0x1e1709(0xe2)][_0x1e1709(0xe6)][_0x1e1709(0x10a)](-0x3c)[_0x1e1709(0x10e)](_0x599a72=>_0x599a72[_0x1e1709(0xf1)]!==_0x47a904),RequestMonitor[_0x1e1709(0xe2)][_0x1e1709(0xf3)]=RequestMonitor[_0x1e1709(0xe2)][_0x1e1709(0xf3)]['slice'](-0x3c)['filter'](_0x227905=>_0x227905[_0x1e1709(0xf1)]!==_0x47a904),RequestMonitor[_0x1e1709(0xe2)][_0x1e1709(0xee)][_0x1e1709(0xfc)]({'time':_0x47a904,'usage':_0x4d603a}),RequestMonitor['ressourcesUsageStats'][_0x1e1709(0xe6)][_0x1e1709(0xfc)]({'time':_0x47a904,'usage':(_0x2cf959[_0x1e1709(0xf5)]/0x3e8)[_0x1e1709(0x108)](0x2)}),RequestMonitor[_0x1e1709(0xe2)]['network']['push']({'time':_0x47a904,'usage':{'in':_0x208485[_0x1e1709(0x113)]?.[_0x1e1709(0xfe)]??0x0,'out':_0x208485['total']?.[_0x1e1709(0x101)]??0x0}});try{await fs['writeFile'](RequestMonitor['ressourcesUsageStatsPath'],JSON[_0x1e1709(0x10b)](RequestMonitor[_0x1e1709(0xe2)],null,0x2));}catch(_0x1227c9){console[_0x1e1709(0x115)](_0x1e1709(0xf9),_0x1227c9);}}static[a2_0x2e0e93(0xde)](){const _0x37ca21=a2_0x2e0e93,_0x1f92ec=Date[_0x37ca21(0xf8)](),_0x180bb6=_0x1f92ec-0x3c*0x3c*0x3e8,_0x4364d1=_0x1f92ec-0x18*0x3c*0x3c*0x3e8,_0x34583b=RequestMonitor[_0x37ca21(0xd9)]['filter'](_0xa40d5d=>_0xa40d5d['timestamp']>_0x180bb6),_0x1cb644={'total':RequestMonitor[_0x37ca21(0xea)][_0x37ca21(0x109)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x37ca21(0xea)][_0x37ca21(0x119)](_0x2015a7=>{const _0x575967=_0x37ca21;_0x1cb644[_0x575967(0xe1)][_0x2015a7[_0x575967(0xd1)]]=(_0x1cb644[_0x575967(0xe1)][_0x2015a7[_0x575967(0xd1)]]||0x0)+0x1;const _0x21b09e=_0x2015a7[_0x575967(0xd2)]+'\x20'+_0x2015a7['path'];!_0x1cb644[_0x575967(0xdc)][_0x21b09e]&&(_0x1cb644[_0x575967(0xdc)][_0x21b09e]={'total':0x0,'codes':{}}),_0x1cb644[_0x575967(0xdc)][_0x21b09e]['total']++,_0x1cb644[_0x575967(0xdc)][_0x21b09e]['codes'][_0x2015a7[_0x575967(0xd1)]]=(_0x1cb644[_0x575967(0xdc)][_0x21b09e][_0x575967(0x100)][_0x2015a7[_0x575967(0xd1)]]||0x0)+0x1;}),{'rps':_0x34583b,'httpCodes':_0x1cb644,'ressourcesUsageStats':RequestMonitor[_0x37ca21(0xe2)]};}}function a2_0x27c7(){const _0x35319e=['byPath','4lIVdtl','getStats','3664263TDVMCT','cadviewer/settings/ressources-usage-stats.json','byCodes','ressourcesUsageStats','19927032oSOsTO','getUsageRessourcesStatsAndSave','1170QaDKLk','memory','7zHaiwG','padStart','promises','httpCodesData','floor','init','700696ugxsOO','cpu','290KeAbLy','Request\x20monitor\x20initialized.','time','127476YKCsNs','network','Error\x20getting\x20memory\x20usage:','usedMemMb','Request\x20monitor\x20middleware','parse','now','Error\x20saving\x20monitoring\x20data:','middleware','utf8','push','startPeriodicSave','inputMb','rpsStoragePath','codes','outputMb','path','timestamp','78008JjDQfk','readFile','info','/metrics','toFixed','length','slice','stringify','log','end','filter','httpCodesStoragePath','cadviewer/settings/http-codes-24h.json','mem','writeFile','total','save','error','netstat','11vNrqVx','41530auSeTv','forEach','toString','Initializing\x20request\x20monitor...','statusCode','method','lastMinute','1160634AkipmS','usage','currentRequests','then','apply','rpsData','ressourcesUsageStatsPath','cadviewer/settings/requests-per-minute.json'];a2_0x27c7=function(){return _0x35319e;};return a2_0x27c7();}RequestMonitor[a2_0x2e0e93(0xec)]()[a2_0x2e0e93(0xd7)](()=>{}),RequestMonitor[a2_0x2e0e93(0xfd)]();const counter=RequestMonitor;module['exports']=counter;