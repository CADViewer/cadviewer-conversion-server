const a1_0x57fb42=a1_0x10d1;(function(_0x4925a7,_0x46a4b1){const _0x373f86=a1_0x10d1,_0xa1d82f=_0x4925a7();while(!![]){try{const _0x968e22=parseInt(_0x373f86(0xe0))/0x1+parseInt(_0x373f86(0xd7))/0x2+parseInt(_0x373f86(0x115))/0x3+parseInt(_0x373f86(0xe4))/0x4*(-parseInt(_0x373f86(0xfc))/0x5)+parseInt(_0x373f86(0xf7))/0x6*(parseInt(_0x373f86(0xdf))/0x7)+-parseInt(_0x373f86(0x118))/0x8+-parseInt(_0x373f86(0x110))/0x9;if(_0x968e22===_0x46a4b1)break;else _0xa1d82f['push'](_0xa1d82f['shift']());}catch(_0x2e21f8){_0xa1d82f['push'](_0xa1d82f['shift']());}}}(a1_0x471f,0x5ddb8));const fs=require('fs')['promises'],osu=require(a1_0x57fb42(0xf1));class RequestMonitor{static [a1_0x57fb42(0x111)]=a1_0x57fb42(0xd1);static [a1_0x57fb42(0x10f)]='cadviewer/settings/http-codes-24h.json';static [a1_0x57fb42(0x10d)]=a1_0x57fb42(0xf4);static [a1_0x57fb42(0xe1)]=[];static [a1_0x57fb42(0xd9)]=[];static [a1_0x57fb42(0xe9)]={};static [a1_0x57fb42(0xde)]=Math[a1_0x57fb42(0xd8)](Date[a1_0x57fb42(0x101)]()/0x3e8/0x3c);static [a1_0x57fb42(0xe2)]=0x0;static async[a1_0x57fb42(0xeb)](){const _0x27066d=a1_0x57fb42;console[_0x27066d(0xe3)](_0x27066d(0x103));try{const _0x492d47=await fs[_0x27066d(0xf0)](RequestMonitor[_0x27066d(0x111)],_0x27066d(0xee));RequestMonitor[_0x27066d(0xe1)]=JSON[_0x27066d(0xd6)](_0x492d47);}catch(_0x18464e){RequestMonitor[_0x27066d(0xe1)]=[];}try{const _0x5a4f44=await fs[_0x27066d(0xf0)](RequestMonitor['httpCodesStoragePath'],_0x27066d(0xee));RequestMonitor[_0x27066d(0xd9)]=JSON[_0x27066d(0xd6)](_0x5a4f44);}catch(_0x13bd1d){RequestMonitor[_0x27066d(0xd9)]=[];}try{const _0x1db1cb=await fs[_0x27066d(0xf0)](RequestMonitor[_0x27066d(0x10d)],_0x27066d(0xee));RequestMonitor[_0x27066d(0xe9)]=JSON[_0x27066d(0xd6)](_0x1db1cb),!RequestMonitor[_0x27066d(0xe9)][_0x27066d(0x108)]&&(RequestMonitor[_0x27066d(0xe9)][_0x27066d(0x108)]=[]),!RequestMonitor[_0x27066d(0xe9)][_0x27066d(0xe8)]&&(RequestMonitor[_0x27066d(0xe9)][_0x27066d(0xe8)]=[]),!RequestMonitor[_0x27066d(0xe9)][_0x27066d(0xe7)]&&(RequestMonitor[_0x27066d(0xe9)][_0x27066d(0xe7)]=[]);}catch(_0x1fdabb){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console[_0x27066d(0xe3)](_0x27066d(0xda));}static[a1_0x57fb42(0x10a)](_0x460692,_0x53f1ca,_0x13fe48){const _0x416b07=a1_0x57fb42;if(_0x460692[_0x416b07(0xd2)]['includes'](_0x416b07(0xd3)))return _0x13fe48();console[_0x416b07(0xe3)]('Request\x20monitor\x20middleware');let _0x1faaeb=Date[_0x416b07(0x101)](),_0x3793d8=Math[_0x416b07(0xd8)](_0x1faaeb/0x3e8/0x3c);console[_0x416b07(0xe3)](_0x416b07(0xfa));const _0x52f6be=_0x53f1ca[_0x416b07(0xfe)];_0x53f1ca['end']=(..._0x995a2b)=>{const _0x522af8=_0x416b07;console[_0x522af8(0xe3)](_0x3793d8,{'currentMinute':_0x3793d8});_0x3793d8>RequestMonitor[_0x522af8(0xde)]&&(RequestMonitor[_0x522af8(0xe1)][_0x522af8(0x107)]({'timestamp':RequestMonitor[_0x522af8(0xde)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x522af8(0xe2)]=0x0,RequestMonitor[_0x522af8(0xde)]=_0x3793d8);RequestMonitor[_0x522af8(0xe2)]++,RequestMonitor[_0x522af8(0xd9)][_0x522af8(0x107)]({'timestamp':Date['now'](),'statusCode':_0x53f1ca[_0x522af8(0x117)],'path':_0x460692[_0x522af8(0xd2)],'method':_0x460692[_0x522af8(0xf3)]});const _0x5967d3=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor['httpCodesData'][_0x522af8(0xfb)](_0x37e88a=>_0x37e88a[_0x522af8(0x10b)]>_0x5967d3),_0x52f6be[_0x522af8(0xfd)](_0x53f1ca,_0x995a2b);},_0x13fe48();}static async[a1_0x57fb42(0xed)](){const _0x53a5ff=a1_0x57fb42;try{RequestMonitor[_0x53a5ff(0xde)]!==Math[_0x53a5ff(0xd8)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x53a5ff(0xe1)][_0x53a5ff(0x107)]({'timestamp':RequestMonitor[_0x53a5ff(0xde)]*0x3e8*0x3c,'requests':RequestMonitor[_0x53a5ff(0xe2)]}),RequestMonitor[_0x53a5ff(0xe2)]=0x0,RequestMonitor[_0x53a5ff(0xde)]=Math['floor'](Date['now']()/0x3e8/0x3c)),await fs[_0x53a5ff(0x114)](RequestMonitor['rpsStoragePath'],JSON[_0x53a5ff(0xe6)](RequestMonitor[_0x53a5ff(0xe1)],null,0x2)),await fs[_0x53a5ff(0x114)](RequestMonitor[_0x53a5ff(0x10f)],JSON[_0x53a5ff(0xe6)](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x41d49f){console[_0x53a5ff(0xf5)](_0x53a5ff(0xe5),_0x41d49f);}}static async[a1_0x57fb42(0x102)](){const _0x590c2d=a1_0x57fb42;setInterval(()=>RequestMonitor[_0x590c2d(0xed)](),0x3c*0x3e8),setInterval(()=>{const _0x527ca2=_0x590c2d;RequestMonitor[_0x527ca2(0x100)]()[_0x527ca2(0x10c)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x590c2d(0x100)]()[_0x590c2d(0x10c)](()=>{});}static async[a1_0x57fb42(0x100)](){const _0x4d9cee=a1_0x57fb42,_0x743fa3=osu[_0x4d9cee(0x108)],_0x3d907a=osu[_0x4d9cee(0x104)],_0x5aa021=osu[_0x4d9cee(0xec)],_0x217fc3={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x1ae203=await _0x5aa021[_0x4d9cee(0xf6)]();_0x217fc3[_0x4d9cee(0x116)][_0x4d9cee(0xf8)]=_0x1ae203[_0x4d9cee(0x116)][_0x4d9cee(0xf8)],_0x217fc3[_0x4d9cee(0x116)][_0x4d9cee(0x112)]=_0x1ae203[_0x4d9cee(0x116)][_0x4d9cee(0x112)];}catch(_0x3ddb50){}let _0x38a29e=0x0;try{_0x38a29e=await _0x743fa3[_0x4d9cee(0xff)]();}catch(_0x39ae1e){console[_0x4d9cee(0xe3)]('Error\x20getting\x20CPU\x20usage:',_0x39ae1e);}const _0x27ecff={'usedMemMb':0x0};try{const _0x45ba28=await _0x3d907a['info']();_0x27ecff['usedMemMb']=_0x45ba28[_0x4d9cee(0xdc)];}catch(_0x5c1250){console[_0x4d9cee(0xe3)](_0x4d9cee(0xf2),_0x5c1250);}const _0x44e322=new Date()[_0x4d9cee(0xdb)]()[_0x4d9cee(0xdd)]()[_0x4d9cee(0x105)](0x2,'0')+':'+new Date()[_0x4d9cee(0xd5)]()[_0x4d9cee(0xdd)]()['padStart'](0x2,'0');RequestMonitor[_0x4d9cee(0xe9)][_0x4d9cee(0x108)]=RequestMonitor[_0x4d9cee(0xe9)][_0x4d9cee(0x108)]['slice'](-0x3c)[_0x4d9cee(0xfb)](_0x4bbca9=>_0x4bbca9[_0x4d9cee(0xd4)]!==_0x44e322),RequestMonitor[_0x4d9cee(0xe9)][_0x4d9cee(0xe8)]=RequestMonitor[_0x4d9cee(0xe9)][_0x4d9cee(0xe8)][_0x4d9cee(0x113)](-0x3c)['filter'](_0x231630=>_0x231630[_0x4d9cee(0xd4)]!==_0x44e322),RequestMonitor[_0x4d9cee(0xe9)][_0x4d9cee(0xe7)]=RequestMonitor['ressourcesUsageStats'][_0x4d9cee(0xe7)][_0x4d9cee(0x113)](-0x3c)[_0x4d9cee(0xfb)](_0x579a26=>_0x579a26[_0x4d9cee(0xd4)]!==_0x44e322),RequestMonitor[_0x4d9cee(0xe9)][_0x4d9cee(0x108)][_0x4d9cee(0x107)]({'time':_0x44e322,'usage':_0x38a29e}),RequestMonitor[_0x4d9cee(0xe9)][_0x4d9cee(0xe8)]['push']({'time':_0x44e322,'usage':(_0x27ecff[_0x4d9cee(0xdc)]/0x3e8)[_0x4d9cee(0x10e)](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x4d9cee(0xe7)][_0x4d9cee(0x107)]({'time':_0x44e322,'usage':{'in':_0x217fc3[_0x4d9cee(0x116)]?.['inputMb']??0x0,'out':_0x217fc3[_0x4d9cee(0x116)]?.[_0x4d9cee(0x112)]??0x0}});try{await fs[_0x4d9cee(0x114)](RequestMonitor[_0x4d9cee(0x10d)],JSON[_0x4d9cee(0xe6)](RequestMonitor[_0x4d9cee(0xe9)],null,0x2));}catch(_0x569a6e){console[_0x4d9cee(0xf5)](_0x4d9cee(0xe5),_0x569a6e);}}static[a1_0x57fb42(0xf9)](){const _0x5602ee=a1_0x57fb42,_0x12c905=Date[_0x5602ee(0x101)](),_0x30c50e=_0x12c905-0x3c*0x3c*0x3e8,_0x530a70=_0x12c905-0x18*0x3c*0x3c*0x3e8,_0x2bc619=RequestMonitor['rpsData'][_0x5602ee(0xfb)](_0x3e0cfc=>_0x3e0cfc[_0x5602ee(0x10b)]>_0x30c50e),_0x5123eb={'total':RequestMonitor[_0x5602ee(0xd9)]['length'],'byCodes':{},'byPath':{}};return RequestMonitor[_0x5602ee(0xd9)][_0x5602ee(0x109)](_0x5e3255=>{const _0x110826=_0x5602ee;_0x5123eb['byCodes'][_0x5e3255[_0x110826(0x117)]]=(_0x5123eb[_0x110826(0xd0)][_0x5e3255[_0x110826(0x117)]]||0x0)+0x1;const _0x2197d8=_0x5e3255[_0x110826(0xf3)]+'\x20'+_0x5e3255[_0x110826(0xd2)];!_0x5123eb[_0x110826(0xea)][_0x2197d8]&&(_0x5123eb[_0x110826(0xea)][_0x2197d8]={'total':0x0,'codes':{}}),_0x5123eb[_0x110826(0xea)][_0x2197d8]['total']++,_0x5123eb[_0x110826(0xea)][_0x2197d8][_0x110826(0x106)][_0x5e3255[_0x110826(0x117)]]=(_0x5123eb[_0x110826(0xea)][_0x2197d8]['codes'][_0x5e3255[_0x110826(0x117)]]||0x0)+0x1;}),{'rps':_0x2bc619,'httpCodes':_0x5123eb,'ressourcesUsageStats':RequestMonitor[_0x5602ee(0xe9)]};}}RequestMonitor[a1_0x57fb42(0xeb)]()[a1_0x57fb42(0x10c)](()=>{}),RequestMonitor[a1_0x57fb42(0x102)]();function a1_0x471f(){const _0x285405=['ressourcesUsageStats','byPath','init','netstat','save','utf8','exports','readFile','node-os-utils','Error\x20getting\x20memory\x20usage:','method','cadviewer/settings/ressources-usage-stats.json','error','inOut','7422yIMCPD','inputMb','getStats','=======>','filter','15drNTgN','apply','end','usage','getUsageRessourcesStatsAndSave','now','startPeriodicSave','Initializing\x20request\x20monitor...','mem','padStart','codes','push','cpu','forEach','middleware','timestamp','then','ressourcesUsageStatsPath','toFixed','httpCodesStoragePath','6895323CZTLcm','rpsStoragePath','outputMb','slice','writeFile','381228DgqcSe','total','statusCode','1333136gpyBwk','byCodes','cadviewer/settings/requests-per-minute.json','path','/metrics','time','getMinutes','parse','796738ZyMcMA','floor','httpCodesData','Request\x20monitor\x20initialized.','getHours','usedMemMb','toString','lastMinute','3339kWRYfk','376614PnCMkz','rpsData','currentRequests','log','233172mVVAut','Error\x20saving\x20monitoring\x20data:','stringify','network','memory'];a1_0x471f=function(){return _0x285405;};return a1_0x471f();}function a1_0x10d1(_0x3532c8,_0x4f73a1){const _0x471f30=a1_0x471f();return a1_0x10d1=function(_0x10d120,_0x3ce26f){_0x10d120=_0x10d120-0xd0;let _0xe3724d=_0x471f30[_0x10d120];return _0xe3724d;},a1_0x10d1(_0x3532c8,_0x4f73a1);}const counter=RequestMonitor;module[a1_0x57fb42(0xef)]=counter;