const a1_0x27b79f=a1_0x4398;(function(_0xe9e71,_0x10e7e9){const _0xc9ca04=a1_0x4398,_0x1eb526=_0xe9e71();while(!![]){try{const _0x13b98c=-parseInt(_0xc9ca04(0x95))/0x1+parseInt(_0xc9ca04(0x93))/0x2*(-parseInt(_0xc9ca04(0x81))/0x3)+parseInt(_0xc9ca04(0x8b))/0x4+-parseInt(_0xc9ca04(0x82))/0x5+-parseInt(_0xc9ca04(0x80))/0x6+-parseInt(_0xc9ca04(0x86))/0x7*(parseInt(_0xc9ca04(0x8c))/0x8)+parseInt(_0xc9ca04(0x89))/0x9;if(_0x13b98c===_0x10e7e9)break;else _0x1eb526['push'](_0x1eb526['shift']());}catch(_0x31a794){_0x1eb526['push'](_0x1eb526['shift']());}}}(a1_0x4095,0xecb2a));function a1_0x4095(){const _0x2e910c=['ressourcesUsageStatsPath','6010212EEyieE','1569462GMWRcI','5987165UOODhR','utf8','Error\x20getting\x20CPU\x20usage:','startPeriodicSave','651KPbCNo','currentRequests','outputMb','53539587bKakpn','end','564796CoAqys','111312fuQQNP','rpsData','init','method','then','Request\x20monitor\x20initialized.','floor','2JXIQWb','httpCodesStoragePath','1104237PFLuMg','apply','httpCodesData','writeFile','getUsageRessourcesStatsAndSave','path','cadviewer/settings/requests-per-minute.json','codes','Initializing\x20request\x20monitor...','error','Error\x20saving\x20monitoring\x20data:','inputMb','padStart','Error\x20getting\x20memory\x20usage:','slice','toFixed','usage','Request\x20monitor\x20middleware','total','stringify','time','lastMinute','inOut','push','filter','cpu','toString','exports','network','cadviewer/settings/http-codes-24h.json','getMinutes','statusCode','rpsStoragePath','ressourcesUsageStats','timestamp','length','memory','log','byPath','now','includes','readFile','node-os-utils','netstat','middleware','parse','usedMemMb','mem','byCodes'];a1_0x4095=function(){return _0x2e910c;};return a1_0x4095();}const fs=require('fs')['promises'],osu=require(a1_0x27b79f(0x78));class RequestMonitor{static ['rpsStoragePath']=a1_0x27b79f(0x9b);static [a1_0x27b79f(0x94)]=a1_0x27b79f(0xb2);static [a1_0x27b79f(0x7f)]='cadviewer/settings/ressources-usage-stats.json';static [a1_0x27b79f(0x8d)]=[];static ['httpCodesData']=[];static ['ressourcesUsageStats']={};static [a1_0x27b79f(0xaa)]=Math['floor'](Date['now']()/0x3e8/0x3c);static [a1_0x27b79f(0x87)]=0x0;static async[a1_0x27b79f(0x8e)](){const _0x5aba42=a1_0x27b79f;console[_0x5aba42(0xba)](_0x5aba42(0x9d));try{const _0x240a19=await fs[_0x5aba42(0x77)](RequestMonitor[_0x5aba42(0xb5)],_0x5aba42(0x83));RequestMonitor['rpsData']=JSON[_0x5aba42(0x7b)](_0x240a19);}catch(_0x20027a){RequestMonitor['rpsData']=[];}try{const _0x4e8661=await fs[_0x5aba42(0x77)](RequestMonitor[_0x5aba42(0x94)],_0x5aba42(0x83));RequestMonitor[_0x5aba42(0x97)]=JSON[_0x5aba42(0x7b)](_0x4e8661);}catch(_0x1ef8b0){RequestMonitor[_0x5aba42(0x97)]=[];}try{const _0x583faf=await fs[_0x5aba42(0x77)](RequestMonitor[_0x5aba42(0x7f)],_0x5aba42(0x83));RequestMonitor[_0x5aba42(0xb6)]=JSON[_0x5aba42(0x7b)](_0x583faf),!RequestMonitor[_0x5aba42(0xb6)]['cpu']&&(RequestMonitor['ressourcesUsageStats'][_0x5aba42(0xae)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x5aba42(0xb9)]&&(RequestMonitor[_0x5aba42(0xb6)][_0x5aba42(0xb9)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x5aba42(0xb1)]&&(RequestMonitor[_0x5aba42(0xb6)][_0x5aba42(0xb1)]=[]);}catch(_0x5e71d7){RequestMonitor[_0x5aba42(0xb6)]={'cpu':[],'memory':[],'network':[]};}console[_0x5aba42(0xba)](_0x5aba42(0x91));}static[a1_0x27b79f(0x7a)](_0x4e7775,_0x2feb1e,_0x1a4aaa){const _0x2f38d4=a1_0x27b79f;if(_0x4e7775[_0x2f38d4(0x9a)][_0x2f38d4(0x76)]('/metrics'))return _0x1a4aaa();console[_0x2f38d4(0xba)](_0x2f38d4(0xa6));let _0x5c9493=Date['now'](),_0x1d4d86=Math[_0x2f38d4(0x92)](_0x5c9493/0x3e8/0x3c);console[_0x2f38d4(0xba)]('=======>');const _0xc3bdd0=_0x2feb1e[_0x2f38d4(0x8a)];_0x2feb1e[_0x2f38d4(0x8a)]=(..._0x1fc916)=>{const _0x267bd0=_0x2f38d4;console[_0x267bd0(0xba)](_0x1d4d86,{'currentMinute':_0x1d4d86});_0x1d4d86>RequestMonitor[_0x267bd0(0xaa)]&&(RequestMonitor[_0x267bd0(0x8d)][_0x267bd0(0xac)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x267bd0(0x87)]}),RequestMonitor[_0x267bd0(0x87)]=0x0,RequestMonitor['lastMinute']=_0x1d4d86);RequestMonitor['currentRequests']++,RequestMonitor[_0x267bd0(0x97)][_0x267bd0(0xac)]({'timestamp':Date[_0x267bd0(0xbc)](),'statusCode':_0x2feb1e[_0x267bd0(0xb4)],'path':_0x4e7775[_0x267bd0(0x9a)],'method':_0x4e7775[_0x267bd0(0x8f)]});const _0x2615fa=Date[_0x267bd0(0xbc)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x267bd0(0x97)]=RequestMonitor[_0x267bd0(0x97)][_0x267bd0(0xad)](_0x4c3b16=>_0x4c3b16[_0x267bd0(0xb7)]>_0x2615fa),_0xc3bdd0[_0x267bd0(0x96)](_0x2feb1e,_0x1fc916);},_0x1a4aaa();}static async['save'](){const _0x220dee=a1_0x27b79f;try{RequestMonitor[_0x220dee(0xaa)]!==Math[_0x220dee(0x92)](Date[_0x220dee(0xbc)]()/0x3e8/0x3c)&&(RequestMonitor['rpsData'][_0x220dee(0xac)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x220dee(0x87)]=0x0,RequestMonitor[_0x220dee(0xaa)]=Math[_0x220dee(0x92)](Date[_0x220dee(0xbc)]()/0x3e8/0x3c)),await fs[_0x220dee(0x98)](RequestMonitor[_0x220dee(0xb5)],JSON[_0x220dee(0xa8)](RequestMonitor[_0x220dee(0x8d)],null,0x2)),await fs[_0x220dee(0x98)](RequestMonitor['httpCodesStoragePath'],JSON[_0x220dee(0xa8)](RequestMonitor[_0x220dee(0x97)],null,0x2));}catch(_0x593881){console[_0x220dee(0x9e)](_0x220dee(0x9f),_0x593881);}}static async['startPeriodicSave'](){setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x57a953=a1_0x4398;RequestMonitor[_0x57a953(0x99)]()[_0x57a953(0x90)](()=>{});},0x3c*0x3e8),RequestMonitor['getUsageRessourcesStatsAndSave']()['then'](()=>{});}static async['getUsageRessourcesStatsAndSave'](){const _0x4115e5=a1_0x27b79f,_0x446435=osu[_0x4115e5(0xae)],_0x4669b7=osu[_0x4115e5(0x7d)],_0x173769=osu[_0x4115e5(0x79)],_0x11ef55={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x1fef5e=await _0x173769[_0x4115e5(0xab)]();_0x11ef55[_0x4115e5(0xa7)][_0x4115e5(0xa0)]=_0x1fef5e['total'][_0x4115e5(0xa0)],_0x11ef55['total']['outputMb']=_0x1fef5e[_0x4115e5(0xa7)][_0x4115e5(0x88)];}catch(_0x77b8){}let _0x3f390f=0x0;try{_0x3f390f=await _0x446435[_0x4115e5(0xa5)]();}catch(_0x5a2c42){console['log'](_0x4115e5(0x84),_0x5a2c42);}const _0x242501={'usedMemMb':0x0};try{const _0x2244d5=await _0x4669b7['info']();_0x242501[_0x4115e5(0x7c)]=_0x2244d5['usedMemMb'];}catch(_0x20d50a){console[_0x4115e5(0xba)](_0x4115e5(0xa2),_0x20d50a);}const _0x31ff56=new Date()['getHours']()[_0x4115e5(0xaf)]()[_0x4115e5(0xa1)](0x2,'0')+':'+new Date()[_0x4115e5(0xb3)]()[_0x4115e5(0xaf)]()[_0x4115e5(0xa1)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x4115e5(0xae)]=RequestMonitor[_0x4115e5(0xb6)][_0x4115e5(0xae)]['slice'](-0x3c)[_0x4115e5(0xad)](_0x5cddd7=>_0x5cddd7[_0x4115e5(0xa9)]!==_0x31ff56),RequestMonitor[_0x4115e5(0xb6)]['memory']=RequestMonitor['ressourcesUsageStats'][_0x4115e5(0xb9)][_0x4115e5(0xa3)](-0x3c)[_0x4115e5(0xad)](_0x42b483=>_0x42b483[_0x4115e5(0xa9)]!==_0x31ff56),RequestMonitor[_0x4115e5(0xb6)][_0x4115e5(0xb1)]=RequestMonitor[_0x4115e5(0xb6)]['network'][_0x4115e5(0xa3)](-0x3c)['filter'](_0xd04a8d=>_0xd04a8d[_0x4115e5(0xa9)]!==_0x31ff56),RequestMonitor[_0x4115e5(0xb6)][_0x4115e5(0xae)][_0x4115e5(0xac)]({'time':_0x31ff56,'usage':_0x3f390f}),RequestMonitor[_0x4115e5(0xb6)]['memory'][_0x4115e5(0xac)]({'time':_0x31ff56,'usage':(_0x242501[_0x4115e5(0x7c)]/0x3e8)[_0x4115e5(0xa4)](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x4115e5(0xb1)][_0x4115e5(0xac)]({'time':_0x31ff56,'usage':{'in':_0x11ef55[_0x4115e5(0xa7)]?.['inputMb']??0x0,'out':_0x11ef55[_0x4115e5(0xa7)]?.[_0x4115e5(0x88)]??0x0}});try{await fs[_0x4115e5(0x98)](RequestMonitor[_0x4115e5(0x7f)],JSON[_0x4115e5(0xa8)](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x33f5b0){console[_0x4115e5(0x9e)](_0x4115e5(0x9f),_0x33f5b0);}}static['getStats'](){const _0xfafab=a1_0x27b79f,_0x3e456f=Date[_0xfafab(0xbc)](),_0x40d79b=_0x3e456f-0x3c*0x3c*0x3e8,_0x138d7a=_0x3e456f-0x18*0x3c*0x3c*0x3e8,_0xc66cf6=RequestMonitor[_0xfafab(0x8d)][_0xfafab(0xad)](_0x2fa2f3=>_0x2fa2f3[_0xfafab(0xb7)]>_0x40d79b),_0x5b50bd={'total':RequestMonitor[_0xfafab(0x97)][_0xfafab(0xb8)],'byCodes':{},'byPath':{}};return RequestMonitor[_0xfafab(0x97)]['forEach'](_0x4c44f4=>{const _0x4fcd42=_0xfafab;_0x5b50bd[_0x4fcd42(0x7e)][_0x4c44f4[_0x4fcd42(0xb4)]]=(_0x5b50bd[_0x4fcd42(0x7e)][_0x4c44f4[_0x4fcd42(0xb4)]]||0x0)+0x1;const _0x2c63c0=_0x4c44f4[_0x4fcd42(0x8f)]+'\x20'+_0x4c44f4[_0x4fcd42(0x9a)];!_0x5b50bd['byPath'][_0x2c63c0]&&(_0x5b50bd['byPath'][_0x2c63c0]={'total':0x0,'codes':{}}),_0x5b50bd['byPath'][_0x2c63c0][_0x4fcd42(0xa7)]++,_0x5b50bd['byPath'][_0x2c63c0][_0x4fcd42(0x9c)][_0x4c44f4[_0x4fcd42(0xb4)]]=(_0x5b50bd[_0x4fcd42(0xbb)][_0x2c63c0][_0x4fcd42(0x9c)][_0x4c44f4[_0x4fcd42(0xb4)]]||0x0)+0x1;}),{'rps':_0xc66cf6,'httpCodes':_0x5b50bd,'ressourcesUsageStats':RequestMonitor[_0xfafab(0xb6)]};}}RequestMonitor['init']()[a1_0x27b79f(0x90)](()=>{}),RequestMonitor[a1_0x27b79f(0x85)]();function a1_0x4398(_0x1fda75,_0x41b4c9){const _0x4095d7=a1_0x4095();return a1_0x4398=function(_0x4398df,_0x202eb7){_0x4398df=_0x4398df-0x76;let _0x43f331=_0x4095d7[_0x4398df];return _0x43f331;},a1_0x4398(_0x1fda75,_0x41b4c9);}const counter=RequestMonitor;module[a1_0x27b79f(0xb0)]=counter;