const a1_0x207aa0=a1_0xf40d;(function(_0x57171b,_0x5923f4){const _0x21a0a3=a1_0xf40d,_0x3590df=_0x57171b();while(!![]){try{const _0x3c8121=parseInt(_0x21a0a3(0xae))/0x1*(-parseInt(_0x21a0a3(0xcd))/0x2)+parseInt(_0x21a0a3(0xa3))/0x3+parseInt(_0x21a0a3(0xc2))/0x4*(-parseInt(_0x21a0a3(0xda))/0x5)+parseInt(_0x21a0a3(0xa5))/0x6+parseInt(_0x21a0a3(0xd0))/0x7+-parseInt(_0x21a0a3(0xce))/0x8+-parseInt(_0x21a0a3(0xc4))/0x9*(-parseInt(_0x21a0a3(0xe2))/0xa);if(_0x3c8121===_0x5923f4)break;else _0x3590df['push'](_0x3590df['shift']());}catch(_0x36ec5d){_0x3590df['push'](_0x3590df['shift']());}}}(a1_0x1ab4,0x8a389));const fs=require('fs')['promises'],osu=require(a1_0x207aa0(0xd3));function a1_0xf40d(_0x3f3eec,_0x30c1af){const _0x1ab494=a1_0x1ab4();return a1_0xf40d=function(_0xf40dd8,_0x564b91){_0xf40dd8=_0xf40dd8-0xa1;let _0x580758=_0x1ab494[_0xf40dd8];return _0x580758;},a1_0xf40d(_0x3f3eec,_0x30c1af);}class RequestMonitor{static [a1_0x207aa0(0xb9)]=a1_0x207aa0(0xa6);static [a1_0x207aa0(0xcc)]='cadviewer/settings/http-codes-24h.json';static [a1_0x207aa0(0xbe)]='cadviewer/settings/ressources-usage-stats.json';static ['rpsData']=[];static ['httpCodesData']=[];static [a1_0x207aa0(0xb0)]={};static [a1_0x207aa0(0xb7)]=Math['floor'](Date[a1_0x207aa0(0xbc)]()/0x3e8/0x3c);static [a1_0x207aa0(0xad)]=0x0;static async['init'](){const _0x19cd99=a1_0x207aa0;console[_0x19cd99(0xc0)](_0x19cd99(0xcf));try{const _0x1624ae=await fs[_0x19cd99(0xc6)](RequestMonitor['rpsStoragePath'],'utf8');RequestMonitor['rpsData']=JSON[_0x19cd99(0xa7)](_0x1624ae);}catch(_0x1350dc){RequestMonitor[_0x19cd99(0xe1)]=[];}try{const _0x66c8a1=await fs[_0x19cd99(0xc6)](RequestMonitor[_0x19cd99(0xcc)],_0x19cd99(0xa9));RequestMonitor[_0x19cd99(0xc9)]=JSON[_0x19cd99(0xa7)](_0x66c8a1);}catch(_0x3f1287){RequestMonitor['httpCodesData']=[];}try{const _0x3a5b84=await fs[_0x19cd99(0xc6)](RequestMonitor['ressourcesUsageStatsPath'],'utf8');RequestMonitor[_0x19cd99(0xb0)]=JSON[_0x19cd99(0xa7)](_0x3a5b84),!RequestMonitor[_0x19cd99(0xb0)][_0x19cd99(0xdf)]&&(RequestMonitor['ressourcesUsageStats'][_0x19cd99(0xdf)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x19cd99(0xc5)]&&(RequestMonitor[_0x19cd99(0xb0)]['memory']=[]),!RequestMonitor['ressourcesUsageStats'][_0x19cd99(0xe7)]&&(RequestMonitor['ressourcesUsageStats'][_0x19cd99(0xe7)]=[]);}catch(_0x685f2d){RequestMonitor[_0x19cd99(0xb0)]={'cpu':[],'memory':[],'network':[]};}console[_0x19cd99(0xc0)](_0x19cd99(0xe4));}static[a1_0x207aa0(0xb2)](_0x161ef9,_0x495f8b,_0x17b6de){const _0x232e68=a1_0x207aa0;if(_0x161ef9[_0x232e68(0xc8)]['includes'](_0x232e68(0xca)))return _0x17b6de();console['log'](_0x232e68(0xe0));let _0x4db499=Date[_0x232e68(0xbc)](),_0x438107=Math[_0x232e68(0xd2)](_0x4db499/0x3e8/0x3c);console[_0x232e68(0xc0)](_0x232e68(0xd8));const _0x51f023=_0x495f8b[_0x232e68(0xd5)];_0x495f8b[_0x232e68(0xd5)]=(..._0x4e1beb)=>{const _0x384155=_0x232e68;console[_0x384155(0xc0)](_0x438107,{'currentMinute':_0x438107});_0x438107>RequestMonitor[_0x384155(0xb7)]&&(RequestMonitor['rpsData'][_0x384155(0xc3)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x384155(0xad)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x384155(0xb7)]=_0x438107);RequestMonitor[_0x384155(0xad)]++,RequestMonitor[_0x384155(0xc9)][_0x384155(0xc3)]({'timestamp':Date['now'](),'statusCode':_0x495f8b[_0x384155(0xb1)],'path':_0x161ef9[_0x384155(0xc8)],'method':_0x161ef9['method']});const _0x5974ec=Date[_0x384155(0xbc)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor[_0x384155(0xc9)][_0x384155(0xd9)](_0x121d37=>_0x121d37[_0x384155(0xc7)]>_0x5974ec),_0x51f023[_0x384155(0xbf)](_0x495f8b,_0x4e1beb);},_0x17b6de();}static async[a1_0x207aa0(0xa4)](){const _0xe3b546=a1_0x207aa0;try{RequestMonitor[_0xe3b546(0xb7)]!==Math[_0xe3b546(0xd2)](Date[_0xe3b546(0xbc)]()/0x3e8/0x3c)&&(RequestMonitor[_0xe3b546(0xe1)][_0xe3b546(0xc3)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0xe3b546(0xad)]}),RequestMonitor[_0xe3b546(0xad)]=0x0,RequestMonitor[_0xe3b546(0xb7)]=Math['floor'](Date[_0xe3b546(0xbc)]()/0x3e8/0x3c)),await fs[_0xe3b546(0xb3)](RequestMonitor[_0xe3b546(0xb9)],JSON[_0xe3b546(0xdd)](RequestMonitor[_0xe3b546(0xe1)],null,0x2)),await fs[_0xe3b546(0xb3)](RequestMonitor[_0xe3b546(0xcc)],JSON['stringify'](RequestMonitor[_0xe3b546(0xc9)],null,0x2));}catch(_0x494ef2){console[_0xe3b546(0xcb)](_0xe3b546(0xa2),_0x494ef2);}}static async['startPeriodicSave'](){const _0x245651=a1_0x207aa0;setInterval(()=>RequestMonitor[_0x245651(0xa4)](),0x3c*0x3e8),setInterval(()=>{const _0x937106=_0x245651;RequestMonitor[_0x937106(0xaa)]()[_0x937106(0xa1)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x245651(0xaa)]()[_0x245651(0xa1)](()=>{});}static async[a1_0x207aa0(0xaa)](){const _0xf25e7f=a1_0x207aa0,_0x168916=osu[_0xf25e7f(0xdf)],_0x29727f=osu['mem'],_0x5b1247=osu[_0xf25e7f(0xd6)],_0x11c0e7={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x20be5f=await _0x5b1247[_0xf25e7f(0xb6)]();_0x11c0e7[_0xf25e7f(0xe5)][_0xf25e7f(0xba)]=_0x20be5f[_0xf25e7f(0xe5)][_0xf25e7f(0xba)],_0x11c0e7[_0xf25e7f(0xe5)][_0xf25e7f(0xc1)]=_0x20be5f[_0xf25e7f(0xe5)]['outputMb'];}catch(_0x47f56b){}let _0x49ca87=0x0;try{_0x49ca87=await _0x168916[_0xf25e7f(0xab)]();}catch(_0x2eebf8){console['log'](_0xf25e7f(0xa8),_0x2eebf8);}const _0x337160={'usedMemMb':0x0};try{const _0x2815b4=await _0x29727f[_0xf25e7f(0xdc)]();_0x337160['usedMemMb']=_0x2815b4['usedMemMb'];}catch(_0x312a75){console['log'](_0xf25e7f(0xe9),_0x312a75);}const _0x52ba7c=new Date()[_0xf25e7f(0xdb)]()[_0xf25e7f(0xe6)]()['padStart'](0x2,'0')+':'+new Date()[_0xf25e7f(0xe8)]()[_0xf25e7f(0xe6)]()[_0xf25e7f(0xbb)](0x2,'0');RequestMonitor[_0xf25e7f(0xb0)]['cpu']=RequestMonitor[_0xf25e7f(0xb0)]['cpu'][_0xf25e7f(0xd1)](-0x3c)[_0xf25e7f(0xd9)](_0xafb1c6=>_0xafb1c6[_0xf25e7f(0xaf)]!==_0x52ba7c),RequestMonitor[_0xf25e7f(0xb0)][_0xf25e7f(0xc5)]=RequestMonitor[_0xf25e7f(0xb0)][_0xf25e7f(0xc5)][_0xf25e7f(0xd1)](-0x3c)[_0xf25e7f(0xd9)](_0x5a2bc4=>_0x5a2bc4[_0xf25e7f(0xaf)]!==_0x52ba7c),RequestMonitor['ressourcesUsageStats'][_0xf25e7f(0xe7)]=RequestMonitor['ressourcesUsageStats'][_0xf25e7f(0xe7)]['slice'](-0x3c)['filter'](_0x507e65=>_0x507e65[_0xf25e7f(0xaf)]!==_0x52ba7c),RequestMonitor[_0xf25e7f(0xb0)][_0xf25e7f(0xdf)][_0xf25e7f(0xc3)]({'time':_0x52ba7c,'usage':_0x49ca87}),RequestMonitor[_0xf25e7f(0xb0)][_0xf25e7f(0xc5)]['push']({'time':_0x52ba7c,'usage':(_0x337160[_0xf25e7f(0xd7)]/0x3e8)[_0xf25e7f(0xbd)](0x2)}),RequestMonitor[_0xf25e7f(0xb0)][_0xf25e7f(0xe7)][_0xf25e7f(0xc3)]({'time':_0x52ba7c,'usage':{'in':_0x11c0e7[_0xf25e7f(0xe5)]?.[_0xf25e7f(0xba)]??0x0,'out':_0x11c0e7[_0xf25e7f(0xe5)]?.[_0xf25e7f(0xc1)]??0x0}});try{await fs['writeFile'](RequestMonitor[_0xf25e7f(0xbe)],JSON['stringify'](RequestMonitor[_0xf25e7f(0xb0)],null,0x2));}catch(_0x4bf8b3){console[_0xf25e7f(0xcb)](_0xf25e7f(0xa2),_0x4bf8b3);}}static['getStats'](){const _0x159089=a1_0x207aa0,_0x58dc35=Date[_0x159089(0xbc)](),_0x4aac50=_0x58dc35-0x3c*0x3c*0x3e8,_0x101725=_0x58dc35-0x18*0x3c*0x3c*0x3e8,_0x8da4f3=RequestMonitor[_0x159089(0xe1)][_0x159089(0xd9)](_0x109d00=>_0x109d00[_0x159089(0xc7)]>_0x4aac50),_0x3d0b6d={'total':RequestMonitor[_0x159089(0xc9)][_0x159089(0xd4)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x159089(0xc9)]['forEach'](_0x3d15e8=>{const _0xc0b80d=_0x159089;_0x3d0b6d[_0xc0b80d(0xb8)][_0x3d15e8[_0xc0b80d(0xb1)]]=(_0x3d0b6d[_0xc0b80d(0xb8)][_0x3d15e8['statusCode']]||0x0)+0x1;const _0x10ea69=_0x3d15e8['method']+'\x20'+_0x3d15e8[_0xc0b80d(0xc8)];!_0x3d0b6d[_0xc0b80d(0xb5)][_0x10ea69]&&(_0x3d0b6d['byPath'][_0x10ea69]={'total':0x0,'codes':{}}),_0x3d0b6d[_0xc0b80d(0xb5)][_0x10ea69][_0xc0b80d(0xe5)]++,_0x3d0b6d['byPath'][_0x10ea69]['codes'][_0x3d15e8['statusCode']]=(_0x3d0b6d[_0xc0b80d(0xb5)][_0x10ea69][_0xc0b80d(0xac)][_0x3d15e8[_0xc0b80d(0xb1)]]||0x0)+0x1;}),{'rps':_0x8da4f3,'httpCodes':_0x3d0b6d,'ressourcesUsageStats':RequestMonitor['ressourcesUsageStats']};}}RequestMonitor[a1_0x207aa0(0xe3)]()[a1_0x207aa0(0xa1)](()=>{}),RequestMonitor[a1_0x207aa0(0xde)]();const counter=RequestMonitor;module[a1_0x207aa0(0xb4)]=counter;function a1_0x1ab4(){const _0x592b19=['290UHXQxA','init','Request\x20monitor\x20initialized.','total','toString','network','getMinutes','Error\x20getting\x20memory\x20usage:','then','Error\x20saving\x20monitoring\x20data:','797637YSYOKC','save','3033168aKBOyI','cadviewer/settings/requests-per-minute.json','parse','Error\x20getting\x20CPU\x20usage:','utf8','getUsageRessourcesStatsAndSave','usage','codes','currentRequests','420949gbRjcR','time','ressourcesUsageStats','statusCode','middleware','writeFile','exports','byPath','inOut','lastMinute','byCodes','rpsStoragePath','inputMb','padStart','now','toFixed','ressourcesUsageStatsPath','apply','log','outputMb','452648gymImX','push','127863DVlxUY','memory','readFile','timestamp','path','httpCodesData','/metrics','error','httpCodesStoragePath','2yEVnWB','2724128EKeNsW','Initializing\x20request\x20monitor...','3385858UBfXFP','slice','floor','node-os-utils','length','end','netstat','usedMemMb','=======>','filter','15IUeoiR','getHours','info','stringify','startPeriodicSave','cpu','Request\x20monitor\x20middleware','rpsData'];a1_0x1ab4=function(){return _0x592b19;};return a1_0x1ab4();}