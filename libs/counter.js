function a1_0x2e10(_0x5e0a48,_0x33f09e){const _0x29b179=a1_0x29b1();return a1_0x2e10=function(_0x2e10f1,_0x59a83f){_0x2e10f1=_0x2e10f1-0x118;let _0x723496=_0x29b179[_0x2e10f1];return _0x723496;},a1_0x2e10(_0x5e0a48,_0x33f09e);}const a1_0x2194bd=a1_0x2e10;(function(_0x5122d8,_0x36c0a1){const _0x2ddcff=a1_0x2e10,_0x492f04=_0x5122d8();while(!![]){try{const _0x90b692=-parseInt(_0x2ddcff(0x159))/0x1*(parseInt(_0x2ddcff(0x160))/0x2)+parseInt(_0x2ddcff(0x137))/0x3+parseInt(_0x2ddcff(0x14e))/0x4*(parseInt(_0x2ddcff(0x132))/0x5)+-parseInt(_0x2ddcff(0x13a))/0x6*(parseInt(_0x2ddcff(0x131))/0x7)+-parseInt(_0x2ddcff(0x15d))/0x8*(-parseInt(_0x2ddcff(0x121))/0x9)+-parseInt(_0x2ddcff(0x138))/0xa*(parseInt(_0x2ddcff(0x14c))/0xb)+-parseInt(_0x2ddcff(0x155))/0xc;if(_0x90b692===_0x36c0a1)break;else _0x492f04['push'](_0x492f04['shift']());}catch(_0x2872d2){_0x492f04['push'](_0x492f04['shift']());}}}(a1_0x29b1,0xd65cf));const fs=require('fs')['promises'],osu=require(a1_0x2194bd(0x141));class RequestMonitor{static [a1_0x2194bd(0x13f)]=a1_0x2194bd(0x12b);static [a1_0x2194bd(0x122)]='cadviewer/settings/http-codes-24h.json';static ['ressourcesUsageStatsPath']=a1_0x2194bd(0x15f);static ['rpsData']=[];static [a1_0x2194bd(0x145)]=[];static [a1_0x2194bd(0x136)]={};static [a1_0x2194bd(0x14b)]=Math[a1_0x2194bd(0x153)](Date[a1_0x2194bd(0x11c)]()/0x3e8/0x3c);static ['currentRequests']=0x0;static async[a1_0x2194bd(0x13e)](){const _0x407b24=a1_0x2194bd;console[_0x407b24(0x126)](_0x407b24(0x13c));try{const _0x249b8a=await fs['readFile'](RequestMonitor['rpsStoragePath'],_0x407b24(0x161));RequestMonitor[_0x407b24(0x140)]=JSON['parse'](_0x249b8a);}catch(_0xd7fc16){RequestMonitor[_0x407b24(0x140)]=[];}try{const _0x182ef1=await fs[_0x407b24(0x134)](RequestMonitor[_0x407b24(0x122)],_0x407b24(0x161));RequestMonitor[_0x407b24(0x145)]=JSON[_0x407b24(0x152)](_0x182ef1);}catch(_0x5bfd79){RequestMonitor[_0x407b24(0x145)]=[];}try{const _0x521303=await fs[_0x407b24(0x134)](RequestMonitor[_0x407b24(0x12a)],'utf8');RequestMonitor['ressourcesUsageStats']=JSON[_0x407b24(0x152)](_0x521303),!RequestMonitor[_0x407b24(0x136)]['cpu']&&(RequestMonitor[_0x407b24(0x136)][_0x407b24(0x13b)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x407b24(0x14a)]&&(RequestMonitor[_0x407b24(0x136)][_0x407b24(0x14a)]=[]),!RequestMonitor[_0x407b24(0x136)][_0x407b24(0x11b)]&&(RequestMonitor[_0x407b24(0x136)]['network']=[]);}catch(_0x5af5a6){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console[_0x407b24(0x126)](_0x407b24(0x147));}static[a1_0x2194bd(0x14f)](_0x528741,_0x114dc8,_0x5b5597){const _0x17d7b6=a1_0x2194bd;if(_0x528741[_0x17d7b6(0x13d)][_0x17d7b6(0x146)]('/metrics'))return _0x5b5597();console[_0x17d7b6(0x126)](_0x17d7b6(0x139));let _0x136536=Date[_0x17d7b6(0x11c)](),_0x2e9718=Math[_0x17d7b6(0x153)](_0x136536/0x3e8/0x3c);console[_0x17d7b6(0x126)]('=======>');const _0xc0ba2e=_0x114dc8['end'];_0x114dc8[_0x17d7b6(0x15c)]=(..._0x1be417)=>{const _0x254afe=_0x17d7b6;console[_0x254afe(0x126)](_0x2e9718,{'currentMinute':_0x2e9718});_0x2e9718>RequestMonitor[_0x254afe(0x14b)]&&(RequestMonitor['rpsData'][_0x254afe(0x143)]({'timestamp':RequestMonitor[_0x254afe(0x14b)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x254afe(0x135)]=0x0,RequestMonitor['lastMinute']=_0x2e9718);RequestMonitor[_0x254afe(0x135)]++,RequestMonitor[_0x254afe(0x145)][_0x254afe(0x143)]({'timestamp':Date['now'](),'statusCode':_0x114dc8['statusCode'],'path':_0x528741['path'],'method':_0x528741['method']});const _0x21ebdc=Date[_0x254afe(0x11c)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor['httpCodesData'][_0x254afe(0x118)](_0x4443ea=>_0x4443ea[_0x254afe(0x11d)]>_0x21ebdc),_0xc0ba2e[_0x254afe(0x12d)](_0x114dc8,_0x1be417);},_0x5b5597();}static async[a1_0x2194bd(0x142)](){const _0x56b288=a1_0x2194bd;try{RequestMonitor['lastMinute']!==Math[_0x56b288(0x153)](Date[_0x56b288(0x11c)]()/0x3e8/0x3c)&&(RequestMonitor[_0x56b288(0x140)]['push']({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x56b288(0x135)]}),RequestMonitor[_0x56b288(0x135)]=0x0,RequestMonitor[_0x56b288(0x14b)]=Math[_0x56b288(0x153)](Date['now']()/0x3e8/0x3c)),await fs[_0x56b288(0x149)](RequestMonitor[_0x56b288(0x13f)],JSON[_0x56b288(0x157)](RequestMonitor['rpsData'],null,0x2)),await fs[_0x56b288(0x149)](RequestMonitor[_0x56b288(0x122)],JSON[_0x56b288(0x157)](RequestMonitor[_0x56b288(0x145)],null,0x2));}catch(_0x42c3cb){console[_0x56b288(0x11e)](_0x56b288(0x148),_0x42c3cb);}}static async['startPeriodicSave'](){const _0x25d9e3=a1_0x2194bd;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x264a2c=a1_0x2e10;RequestMonitor['getUsageRessourcesStatsAndSave']()[_0x264a2c(0x129)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x25d9e3(0x11f)]()[_0x25d9e3(0x129)](()=>{});}static async[a1_0x2194bd(0x11f)](){const _0x4d376b=a1_0x2194bd,_0x286c4e=osu[_0x4d376b(0x13b)],_0x26d738=osu[_0x4d376b(0x154)],_0x12b1a8=osu[_0x4d376b(0x150)],_0x5e8d3c={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x1c88ed=await _0x12b1a8[_0x4d376b(0x15a)]();_0x5e8d3c['total'][_0x4d376b(0x14d)]=_0x1c88ed[_0x4d376b(0x133)][_0x4d376b(0x14d)],_0x5e8d3c[_0x4d376b(0x133)][_0x4d376b(0x156)]=_0x1c88ed[_0x4d376b(0x133)][_0x4d376b(0x156)];}catch(_0x26a6ee){}let _0x5e8b06=0x0;try{_0x5e8b06=await _0x286c4e['usage']();}catch(_0x3a5aaa){console[_0x4d376b(0x126)](_0x4d376b(0x163),_0x3a5aaa);}const _0x5823eb={'usedMemMb':0x0};try{const _0x5c0dfb=await _0x26d738[_0x4d376b(0x12c)]();_0x5823eb['usedMemMb']=_0x5c0dfb[_0x4d376b(0x12f)];}catch(_0x8c6fba){console['log'](_0x4d376b(0x15b),_0x8c6fba);}const _0x579d94=new Date()[_0x4d376b(0x11a)]()[_0x4d376b(0x130)]()['padStart'](0x2,'0')+':'+new Date()[_0x4d376b(0x144)]()['toString']()[_0x4d376b(0x119)](0x2,'0');RequestMonitor[_0x4d376b(0x136)][_0x4d376b(0x13b)]=RequestMonitor[_0x4d376b(0x136)]['cpu'][_0x4d376b(0x15e)](-0x3c)[_0x4d376b(0x118)](_0x3ef0d8=>_0x3ef0d8[_0x4d376b(0x162)]!==_0x579d94),RequestMonitor[_0x4d376b(0x136)]['memory']=RequestMonitor['ressourcesUsageStats']['memory']['slice'](-0x3c)[_0x4d376b(0x118)](_0x3c1f53=>_0x3c1f53[_0x4d376b(0x162)]!==_0x579d94),RequestMonitor[_0x4d376b(0x136)][_0x4d376b(0x11b)]=RequestMonitor[_0x4d376b(0x136)][_0x4d376b(0x11b)][_0x4d376b(0x15e)](-0x3c)[_0x4d376b(0x118)](_0x2ff08e=>_0x2ff08e['time']!==_0x579d94),RequestMonitor['ressourcesUsageStats']['cpu'][_0x4d376b(0x143)]({'time':_0x579d94,'usage':_0x5e8b06}),RequestMonitor[_0x4d376b(0x136)][_0x4d376b(0x14a)]['push']({'time':_0x579d94,'usage':(_0x5823eb[_0x4d376b(0x12f)]/0x3e8)[_0x4d376b(0x158)](0x2)}),RequestMonitor[_0x4d376b(0x136)]['network'][_0x4d376b(0x143)]({'time':_0x579d94,'usage':{'in':_0x5e8d3c[_0x4d376b(0x133)]?.[_0x4d376b(0x14d)]??0x0,'out':_0x5e8d3c[_0x4d376b(0x133)]?.[_0x4d376b(0x156)]??0x0}});try{await fs[_0x4d376b(0x149)](RequestMonitor['ressourcesUsageStatsPath'],JSON['stringify'](RequestMonitor[_0x4d376b(0x136)],null,0x2));}catch(_0x12e3b1){console[_0x4d376b(0x11e)](_0x4d376b(0x148),_0x12e3b1);}}static['getStats'](){const _0x2d5f16=a1_0x2194bd,_0x54b8c9=Date[_0x2d5f16(0x11c)](),_0x2855bd=_0x54b8c9-0x3c*0x3c*0x3e8,_0x1ce2c8=_0x54b8c9-0x18*0x3c*0x3c*0x3e8,_0x23d119=RequestMonitor[_0x2d5f16(0x140)][_0x2d5f16(0x118)](_0x2a7e4e=>_0x2a7e4e['timestamp']>_0x2855bd),_0x50e84f={'total':RequestMonitor[_0x2d5f16(0x145)][_0x2d5f16(0x120)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x2d5f16(0x145)][_0x2d5f16(0x151)](_0x42ebf2=>{const _0x5fb4b5=_0x2d5f16;_0x50e84f[_0x5fb4b5(0x124)][_0x42ebf2[_0x5fb4b5(0x12e)]]=(_0x50e84f[_0x5fb4b5(0x124)][_0x42ebf2[_0x5fb4b5(0x12e)]]||0x0)+0x1;const _0x226c5a=_0x42ebf2[_0x5fb4b5(0x128)]+'\x20'+_0x42ebf2[_0x5fb4b5(0x13d)];!_0x50e84f[_0x5fb4b5(0x125)][_0x226c5a]&&(_0x50e84f[_0x5fb4b5(0x125)][_0x226c5a]={'total':0x0,'codes':{}}),_0x50e84f['byPath'][_0x226c5a][_0x5fb4b5(0x133)]++,_0x50e84f['byPath'][_0x226c5a]['codes'][_0x42ebf2['statusCode']]=(_0x50e84f[_0x5fb4b5(0x125)][_0x226c5a][_0x5fb4b5(0x127)][_0x42ebf2[_0x5fb4b5(0x12e)]]||0x0)+0x1;}),{'rps':_0x23d119,'httpCodes':_0x50e84f,'ressourcesUsageStats':RequestMonitor[_0x2d5f16(0x136)]};}}RequestMonitor['init']()[a1_0x2194bd(0x129)](()=>{}),RequestMonitor[a1_0x2194bd(0x123)]();function a1_0x29b1(){const _0x395edd=['toString','7xWrkWg','5aNYJSr','total','readFile','currentRequests','ressourcesUsageStats','5135664cyIiAB','245290VACJJg','Request\x20monitor\x20middleware','664554MzVDik','cpu','Initializing\x20request\x20monitor...','path','init','rpsStoragePath','rpsData','node-os-utils','save','push','getMinutes','httpCodesData','includes','Request\x20monitor\x20initialized.','Error\x20saving\x20monitoring\x20data:','writeFile','memory','lastMinute','143rLzseQ','inputMb','1580092UxVPgB','middleware','netstat','forEach','parse','floor','mem','1609884TUszeK','outputMb','stringify','toFixed','97sbIpuQ','inOut','Error\x20getting\x20memory\x20usage:','end','200hBXuPJ','slice','cadviewer/settings/ressources-usage-stats.json','33392ehUoTQ','utf8','time','Error\x20getting\x20CPU\x20usage:','filter','padStart','getHours','network','now','timestamp','error','getUsageRessourcesStatsAndSave','length','343593CAuMKc','httpCodesStoragePath','startPeriodicSave','byCodes','byPath','log','codes','method','then','ressourcesUsageStatsPath','cadviewer/settings/requests-per-minute.json','info','apply','statusCode','usedMemMb'];a1_0x29b1=function(){return _0x395edd;};return a1_0x29b1();}const counter=RequestMonitor;module['exports']=counter;