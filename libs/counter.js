const a2_0x2a2d9a=a2_0x1fb6;(function(_0x4aec39,_0x4c0fdd){const _0x2db2bd=a2_0x1fb6,_0x57dd1c=_0x4aec39();while(!![]){try{const _0x4e8abd=parseInt(_0x2db2bd(0x1ec))/0x1+-parseInt(_0x2db2bd(0x1f9))/0x2*(parseInt(_0x2db2bd(0x1f4))/0x3)+-parseInt(_0x2db2bd(0x1c7))/0x4*(-parseInt(_0x2db2bd(0x1ee))/0x5)+-parseInt(_0x2db2bd(0x1e9))/0x6+parseInt(_0x2db2bd(0x1c9))/0x7+parseInt(_0x2db2bd(0x1cf))/0x8*(-parseInt(_0x2db2bd(0x1eb))/0x9)+-parseInt(_0x2db2bd(0x20e))/0xa*(parseInt(_0x2db2bd(0x1cc))/0xb);if(_0x4e8abd===_0x4c0fdd)break;else _0x57dd1c['push'](_0x57dd1c['shift']());}catch(_0x1f5136){_0x57dd1c['push'](_0x57dd1c['shift']());}}}(a2_0x16da,0x9b1b9));const fs=require('fs')[a2_0x2a2d9a(0x1fe)],osu=require(a2_0x2a2d9a(0x20c));class RequestMonitor{static [a2_0x2a2d9a(0x20d)]=a2_0x2a2d9a(0x1fa);static ['httpCodesStoragePath']=a2_0x2a2d9a(0x203);static [a2_0x2a2d9a(0x1d4)]=a2_0x2a2d9a(0x204);static ['rpsData']=[];static [a2_0x2a2d9a(0x202)]=[];static ['ressourcesUsageStats']={};static [a2_0x2a2d9a(0x1f2)]=Math['floor'](Date['now']()/0x3e8/0x3c);static [a2_0x2a2d9a(0x211)]=0x0;static async[a2_0x2a2d9a(0x1d2)](){const _0x1a6d24=a2_0x2a2d9a;console[_0x1a6d24(0x20f)](_0x1a6d24(0x1e7));try{const _0x469b58=await fs[_0x1a6d24(0x1ef)](RequestMonitor[_0x1a6d24(0x20d)],_0x1a6d24(0x1f7));RequestMonitor[_0x1a6d24(0x1dc)]=JSON['parse'](_0x469b58);}catch(_0x1f70de){RequestMonitor['rpsData']=[];}try{const _0x20395d=await fs[_0x1a6d24(0x1ef)](RequestMonitor['httpCodesStoragePath'],_0x1a6d24(0x1f7));RequestMonitor['httpCodesData']=JSON[_0x1a6d24(0x20b)](_0x20395d);}catch(_0x5f747b){RequestMonitor[_0x1a6d24(0x202)]=[];}try{const _0x4f8595=await fs[_0x1a6d24(0x1ef)](RequestMonitor['ressourcesUsageStatsPath'],_0x1a6d24(0x1f7));RequestMonitor[_0x1a6d24(0x1ea)]=JSON[_0x1a6d24(0x20b)](_0x4f8595),!RequestMonitor[_0x1a6d24(0x1ea)][_0x1a6d24(0x1fc)]&&(RequestMonitor[_0x1a6d24(0x1ea)]['cpu']=[]),!RequestMonitor['ressourcesUsageStats'][_0x1a6d24(0x1f6)]&&(RequestMonitor['ressourcesUsageStats'][_0x1a6d24(0x1f6)]=[]),!RequestMonitor[_0x1a6d24(0x1ea)]['network']&&(RequestMonitor[_0x1a6d24(0x1ea)][_0x1a6d24(0x207)]=[]);}catch(_0xe9649d){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console[_0x1a6d24(0x20f)](_0x1a6d24(0x200));}static[a2_0x2a2d9a(0x1d9)](_0x2b716e,_0x3c8366,_0x589c89){const _0xf28b48=a2_0x2a2d9a;if(_0x2b716e[_0xf28b48(0x1f3)][_0xf28b48(0x1df)](_0xf28b48(0x1dd)))return _0x589c89();console['log']('Request\x20monitor\x20middleware');let _0x1f7a94=Date[_0xf28b48(0x1d8)](),_0x2bfe6b=Math[_0xf28b48(0x1d6)](_0x1f7a94/0x3e8/0x3c);console[_0xf28b48(0x20f)](_0xf28b48(0x1fb));const _0x392690=_0x3c8366[_0xf28b48(0x1cd)];_0x3c8366[_0xf28b48(0x1cd)]=(..._0x2bb9f2)=>{const _0x1764ee=_0xf28b48;console[_0x1764ee(0x20f)](_0x2bfe6b,{'currentMinute':_0x2bfe6b});_0x2bfe6b>RequestMonitor[_0x1764ee(0x1f2)]&&(RequestMonitor[_0x1764ee(0x1dc)][_0x1764ee(0x1d1)]({'timestamp':RequestMonitor[_0x1764ee(0x1f2)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x1764ee(0x211)]=0x0,RequestMonitor[_0x1764ee(0x1f2)]=_0x2bfe6b);RequestMonitor['currentRequests']++,RequestMonitor[_0x1764ee(0x202)][_0x1764ee(0x1d1)]({'timestamp':Date[_0x1764ee(0x1d8)](),'statusCode':_0x3c8366[_0x1764ee(0x1e4)],'path':_0x2b716e[_0x1764ee(0x1f3)],'method':_0x2b716e[_0x1764ee(0x1d5)]});const _0x21ccf3=Date[_0x1764ee(0x1d8)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x1764ee(0x202)]=RequestMonitor['httpCodesData'][_0x1764ee(0x1d0)](_0x252fd7=>_0x252fd7[_0x1764ee(0x1fd)]>_0x21ccf3),_0x392690[_0x1764ee(0x1e6)](_0x3c8366,_0x2bb9f2);},_0x589c89();}static async[a2_0x2a2d9a(0x201)](){const _0x2a9b13=a2_0x2a2d9a;try{RequestMonitor[_0x2a9b13(0x1f2)]!==Math[_0x2a9b13(0x1d6)](Date[_0x2a9b13(0x1d8)]()/0x3e8/0x3c)&&(RequestMonitor['rpsData']['push']({'timestamp':RequestMonitor[_0x2a9b13(0x1f2)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x2a9b13(0x211)]=0x0,RequestMonitor[_0x2a9b13(0x1f2)]=Math[_0x2a9b13(0x1d6)](Date['now']()/0x3e8/0x3c)),await fs[_0x2a9b13(0x20a)](RequestMonitor['rpsStoragePath'],JSON['stringify'](RequestMonitor[_0x2a9b13(0x1dc)],null,0x2)),await fs[_0x2a9b13(0x20a)](RequestMonitor[_0x2a9b13(0x206)],JSON[_0x2a9b13(0x1e0)](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x90c730){console[_0x2a9b13(0x210)](_0x2a9b13(0x205),_0x90c730);}}static async['startPeriodicSave'](){const _0x1a0bab=a2_0x2a2d9a;setInterval(()=>RequestMonitor[_0x1a0bab(0x201)](),0x3c*0x3e8),setInterval(()=>{const _0x213cd0=_0x1a0bab;RequestMonitor[_0x213cd0(0x1e1)]()[_0x213cd0(0x1f0)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x1a0bab(0x1e1)]()[_0x1a0bab(0x1f0)](()=>{});}static async[a2_0x2a2d9a(0x1e1)](){const _0x371b83=a2_0x2a2d9a,_0x3b4357=osu[_0x371b83(0x1fc)],_0x5da031=osu[_0x371b83(0x1ca)],_0x13ebc6=osu[_0x371b83(0x1f1)],_0x321148={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x23b17f=await _0x13ebc6['inOut']();_0x321148['total'][_0x371b83(0x1ed)]=_0x23b17f[_0x371b83(0x1d7)]['inputMb'],_0x321148[_0x371b83(0x1d7)]['outputMb']=_0x23b17f['total']['outputMb'];}catch(_0x265db3){}let _0x3966a3=0x0;try{_0x3966a3=await _0x3b4357['usage']();}catch(_0x2c31ed){console['log']('Error\x20getting\x20CPU\x20usage:',_0x2c31ed);}const _0xdc6e36={'usedMemMb':0x0};try{const _0x340ae0=await _0x5da031[_0x371b83(0x1cb)]();_0xdc6e36[_0x371b83(0x212)]=_0x340ae0['usedMemMb'];}catch(_0x41ae5b){console['log']('Error\x20getting\x20memory\x20usage:',_0x41ae5b);}const _0x4c5662=new Date()[_0x371b83(0x1e8)]()['toString']()[_0x371b83(0x1e5)](0x2,'0')+':'+new Date()[_0x371b83(0x1da)]()[_0x371b83(0x208)]()[_0x371b83(0x1e5)](0x2,'0');RequestMonitor[_0x371b83(0x1ea)][_0x371b83(0x1fc)]=RequestMonitor[_0x371b83(0x1ea)][_0x371b83(0x1fc)][_0x371b83(0x209)](-0x3c)[_0x371b83(0x1d0)](_0x3f3afd=>_0x3f3afd['time']!==_0x4c5662),RequestMonitor[_0x371b83(0x1ea)]['memory']=RequestMonitor[_0x371b83(0x1ea)][_0x371b83(0x1f6)][_0x371b83(0x209)](-0x3c)[_0x371b83(0x1d0)](_0x49a215=>_0x49a215[_0x371b83(0x1ff)]!==_0x4c5662),RequestMonitor[_0x371b83(0x1ea)][_0x371b83(0x207)]=RequestMonitor[_0x371b83(0x1ea)][_0x371b83(0x207)][_0x371b83(0x209)](-0x3c)[_0x371b83(0x1d0)](_0x4bad10=>_0x4bad10[_0x371b83(0x1ff)]!==_0x4c5662),RequestMonitor['ressourcesUsageStats']['cpu'][_0x371b83(0x1d1)]({'time':_0x4c5662,'usage':_0x3966a3}),RequestMonitor['ressourcesUsageStats']['memory'][_0x371b83(0x1d1)]({'time':_0x4c5662,'usage':(_0xdc6e36[_0x371b83(0x212)]/0x3e8)[_0x371b83(0x1e3)](0x2)}),RequestMonitor[_0x371b83(0x1ea)]['network'][_0x371b83(0x1d1)]({'time':_0x4c5662,'usage':{'in':_0x321148[_0x371b83(0x1d7)]?.[_0x371b83(0x1ed)]??0x0,'out':_0x321148[_0x371b83(0x1d7)]?.[_0x371b83(0x1de)]??0x0}});try{await fs[_0x371b83(0x20a)](RequestMonitor[_0x371b83(0x1d4)],JSON[_0x371b83(0x1e0)](RequestMonitor[_0x371b83(0x1ea)],null,0x2));}catch(_0x5a1e71){console[_0x371b83(0x210)]('Error\x20saving\x20monitoring\x20data:',_0x5a1e71);}}static['getStats'](){const _0x5ba526=a2_0x2a2d9a,_0x53e24e=Date[_0x5ba526(0x1d8)](),_0x289f72=_0x53e24e-0x3c*0x3c*0x3e8,_0x56371f=_0x53e24e-0x18*0x3c*0x3c*0x3e8,_0x3cf53e=RequestMonitor[_0x5ba526(0x1dc)][_0x5ba526(0x1d0)](_0xce8615=>_0xce8615['timestamp']>_0x289f72),_0x344c3a={'total':RequestMonitor[_0x5ba526(0x202)][_0x5ba526(0x1f5)],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x5ba526(0x1c8)](_0x4d75c7=>{const _0x5ec1f9=_0x5ba526;_0x344c3a['byCodes'][_0x4d75c7['statusCode']]=(_0x344c3a[_0x5ec1f9(0x1ce)][_0x4d75c7['statusCode']]||0x0)+0x1;const _0x439b63=_0x4d75c7[_0x5ec1f9(0x1d5)]+'\x20'+_0x4d75c7[_0x5ec1f9(0x1f3)];!_0x344c3a['byPath'][_0x439b63]&&(_0x344c3a['byPath'][_0x439b63]={'total':0x0,'codes':{}}),_0x344c3a[_0x5ec1f9(0x1db)][_0x439b63][_0x5ec1f9(0x1d7)]++,_0x344c3a[_0x5ec1f9(0x1db)][_0x439b63]['codes'][_0x4d75c7['statusCode']]=(_0x344c3a[_0x5ec1f9(0x1db)][_0x439b63][_0x5ec1f9(0x1f8)][_0x4d75c7[_0x5ec1f9(0x1e4)]]||0x0)+0x1;}),{'rps':_0x3cf53e,'httpCodes':_0x344c3a,'ressourcesUsageStats':RequestMonitor['ressourcesUsageStats']};}}RequestMonitor[a2_0x2a2d9a(0x1d2)]()[a2_0x2a2d9a(0x1f0)](()=>{}),RequestMonitor[a2_0x2a2d9a(0x1d3)]();function a2_0x1fb6(_0x15c31d,_0x585d54){const _0x16da0b=a2_0x16da();return a2_0x1fb6=function(_0x1fb6e8,_0x3209a4){_0x1fb6e8=_0x1fb6e8-0x1c7;let _0x3f24ea=_0x16da0b[_0x1fb6e8];return _0x3f24ea;},a2_0x1fb6(_0x15c31d,_0x585d54);}const counter=RequestMonitor;function a2_0x16da(){const _0x4f830e=['10jNVCVK','log','error','currentRequests','usedMemMb','8CDuoTp','forEach','5425742VPdiTL','mem','info','90552swgCAW','end','byCodes','4686448BhRRjo','filter','push','init','startPeriodicSave','ressourcesUsageStatsPath','method','floor','total','now','middleware','getMinutes','byPath','rpsData','/metrics','outputMb','includes','stringify','getUsageRessourcesStatsAndSave','exports','toFixed','statusCode','padStart','apply','Initializing\x20request\x20monitor...','getHours','973326nibARL','ressourcesUsageStats','9OwkRsC','240821Uzxsqw','inputMb','2727065FQMQts','readFile','then','netstat','lastMinute','path','1887YOZijw','length','memory','utf8','codes','2274liQjAH','cadviewer/settings/requests-per-minute.json','=======>','cpu','timestamp','promises','time','Request\x20monitor\x20initialized.','save','httpCodesData','cadviewer/settings/http-codes-24h.json','cadviewer/settings/ressources-usage-stats.json','Error\x20saving\x20monitoring\x20data:','httpCodesStoragePath','network','toString','slice','writeFile','parse','node-os-utils','rpsStoragePath'];a2_0x16da=function(){return _0x4f830e;};return a2_0x16da();}module[a2_0x2a2d9a(0x1e2)]=counter;