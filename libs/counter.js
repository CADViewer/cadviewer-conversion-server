const a1_0x3863a2=a1_0x5e39;(function(_0x5d42a8,_0x276dbd){const _0xe22600=a1_0x5e39,_0x24c476=_0x5d42a8();while(!![]){try{const _0x525842=parseInt(_0xe22600(0x82))/0x1+parseInt(_0xe22600(0xa3))/0x2*(-parseInt(_0xe22600(0x88))/0x3)+-parseInt(_0xe22600(0xc7))/0x4*(parseInt(_0xe22600(0x86))/0x5)+-parseInt(_0xe22600(0x81))/0x6+parseInt(_0xe22600(0xbf))/0x7+-parseInt(_0xe22600(0x89))/0x8+parseInt(_0xe22600(0xb9))/0x9*(parseInt(_0xe22600(0xc8))/0xa);if(_0x525842===_0x276dbd)break;else _0x24c476['push'](_0x24c476['shift']());}catch(_0x54353){_0x24c476['push'](_0x24c476['shift']());}}}(a1_0x5131,0x549ab));const fs=require('fs')[a1_0x3863a2(0x8c)],osu=require(a1_0x3863a2(0x8b));function a1_0x5e39(_0x11cdd1,_0x379ccf){const _0x513137=a1_0x5131();return a1_0x5e39=function(_0x5e399c,_0x538ac7){_0x5e399c=_0x5e399c-0x81;let _0x48417a=_0x513137[_0x5e399c];return _0x48417a;},a1_0x5e39(_0x11cdd1,_0x379ccf);}function a1_0x5131(){const _0x44c0b8=['toFixed','getMinutes','end','mem','push','apply','readFile','566UpzQRn','total','forEach','path','byPath','Error\x20getting\x20CPU\x20usage:','Error\x20getting\x20memory\x20usage:','stringify','then','inOut','usage','usedMemMb','ressourcesUsageStatsPath','utf8','save','Request\x20monitor\x20middleware','statusCode','currentRequests','Error\x20saving\x20monitoring\x20data:','padStart','middleware','Initializing\x20request\x20monitor...','279Wjxtnf','httpCodesStoragePath','memory','timestamp','codes','method','646681lHeUpc','inputMb','info','byCodes','cadviewer/settings/http-codes-24h.json','rpsData','netstat','/metrics','1809052ehLOZh','481910XVrpnm','writeFile','4093674aZTxaA','394562AlkCdv','now','httpCodesData','ressourcesUsageStats','5TKXbzk','slice','2094FeQSUS','2418008YwJXbO','filter','node-os-utils','promises','floor','log','cadviewer/settings/ressources-usage-stats.json','rpsStoragePath','parse','outputMb','time','network','toString','lastMinute','getUsageRessourcesStatsAndSave','Request\x20monitor\x20initialized.','error','includes','cpu'];a1_0x5131=function(){return _0x44c0b8;};return a1_0x5131();}class RequestMonitor{static ['rpsStoragePath']='cadviewer/settings/requests-per-minute.json';static ['httpCodesStoragePath']=a1_0x3863a2(0xc3);static [a1_0x3863a2(0xaf)]=a1_0x3863a2(0x8f);static [a1_0x3863a2(0xc4)]=[];static [a1_0x3863a2(0x84)]=[];static [a1_0x3863a2(0x85)]={};static [a1_0x3863a2(0x96)]=Math[a1_0x3863a2(0x8d)](Date[a1_0x3863a2(0x83)]()/0x3e8/0x3c);static [a1_0x3863a2(0xb4)]=0x0;static async['init'](){const _0x4c6b59=a1_0x3863a2;console[_0x4c6b59(0x8e)](_0x4c6b59(0xb8));try{const _0x48c73c=await fs[_0x4c6b59(0xa2)](RequestMonitor['rpsStoragePath'],_0x4c6b59(0xb0));RequestMonitor[_0x4c6b59(0xc4)]=JSON[_0x4c6b59(0x91)](_0x48c73c);}catch(_0x344e58){RequestMonitor[_0x4c6b59(0xc4)]=[];}try{const _0x57c5ae=await fs[_0x4c6b59(0xa2)](RequestMonitor[_0x4c6b59(0xba)],_0x4c6b59(0xb0));RequestMonitor[_0x4c6b59(0x84)]=JSON[_0x4c6b59(0x91)](_0x57c5ae);}catch(_0x33616f){RequestMonitor[_0x4c6b59(0x84)]=[];}try{const _0x29fc4b=await fs['readFile'](RequestMonitor[_0x4c6b59(0xaf)],_0x4c6b59(0xb0));RequestMonitor['ressourcesUsageStats']=JSON[_0x4c6b59(0x91)](_0x29fc4b),!RequestMonitor[_0x4c6b59(0x85)][_0x4c6b59(0x9b)]&&(RequestMonitor[_0x4c6b59(0x85)][_0x4c6b59(0x9b)]=[]),!RequestMonitor[_0x4c6b59(0x85)][_0x4c6b59(0xbb)]&&(RequestMonitor[_0x4c6b59(0x85)]['memory']=[]),!RequestMonitor[_0x4c6b59(0x85)][_0x4c6b59(0x94)]&&(RequestMonitor['ressourcesUsageStats'][_0x4c6b59(0x94)]=[]);}catch(_0x1b8e27){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console[_0x4c6b59(0x8e)](_0x4c6b59(0x98));}static[a1_0x3863a2(0xb7)](_0x349d83,_0x467005,_0x4e2217){const _0x49b557=a1_0x3863a2;if(_0x349d83[_0x49b557(0xa6)][_0x49b557(0x9a)](_0x49b557(0xc6)))return _0x4e2217();console['log'](_0x49b557(0xb2));let _0x49c6f0=Date[_0x49b557(0x83)](),_0x5f2c73=Math[_0x49b557(0x8d)](_0x49c6f0/0x3e8/0x3c);console[_0x49b557(0x8e)]('=======>');const _0x52b49b=_0x467005[_0x49b557(0x9e)];_0x467005[_0x49b557(0x9e)]=(..._0x5701ed)=>{const _0x2d3d10=_0x49b557;console[_0x2d3d10(0x8e)](_0x5f2c73,{'currentMinute':_0x5f2c73});_0x5f2c73>RequestMonitor[_0x2d3d10(0x96)]&&(RequestMonitor[_0x2d3d10(0xc4)]['push']({'timestamp':RequestMonitor[_0x2d3d10(0x96)]*0x3e8*0x3c,'requests':RequestMonitor[_0x2d3d10(0xb4)]}),RequestMonitor[_0x2d3d10(0xb4)]=0x0,RequestMonitor[_0x2d3d10(0x96)]=_0x5f2c73);RequestMonitor[_0x2d3d10(0xb4)]++,RequestMonitor['httpCodesData']['push']({'timestamp':Date[_0x2d3d10(0x83)](),'statusCode':_0x467005[_0x2d3d10(0xb3)],'path':_0x349d83['path'],'method':_0x349d83[_0x2d3d10(0xbe)]});const _0x595803=Date[_0x2d3d10(0x83)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x2d3d10(0x84)]=RequestMonitor['httpCodesData'][_0x2d3d10(0x8a)](_0x4195b6=>_0x4195b6[_0x2d3d10(0xbc)]>_0x595803),_0x52b49b[_0x2d3d10(0xa1)](_0x467005,_0x5701ed);},_0x4e2217();}static async[a1_0x3863a2(0xb1)](){const _0x574d68=a1_0x3863a2;try{RequestMonitor[_0x574d68(0x96)]!==Math[_0x574d68(0x8d)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x574d68(0xc4)][_0x574d68(0xa0)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x574d68(0xb4)]}),RequestMonitor[_0x574d68(0xb4)]=0x0,RequestMonitor[_0x574d68(0x96)]=Math[_0x574d68(0x8d)](Date[_0x574d68(0x83)]()/0x3e8/0x3c)),await fs[_0x574d68(0xc9)](RequestMonitor[_0x574d68(0x90)],JSON['stringify'](RequestMonitor[_0x574d68(0xc4)],null,0x2)),await fs[_0x574d68(0xc9)](RequestMonitor[_0x574d68(0xba)],JSON[_0x574d68(0xaa)](RequestMonitor[_0x574d68(0x84)],null,0x2));}catch(_0x5bb8ac){console[_0x574d68(0x99)](_0x574d68(0xb5),_0x5bb8ac);}}static async['startPeriodicSave'](){const _0x31db7a=a1_0x3863a2;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x41666b=a1_0x5e39;RequestMonitor[_0x41666b(0x97)]()['then'](()=>{});},0x3c*0x3e8),RequestMonitor['getUsageRessourcesStatsAndSave']()[_0x31db7a(0xab)](()=>{});}static async['getUsageRessourcesStatsAndSave'](){const _0x559827=a1_0x3863a2,_0x2e0b35=osu[_0x559827(0x9b)],_0x1f4852=osu[_0x559827(0x9f)],_0x3e287d=osu[_0x559827(0xc5)],_0x54bdf1={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x14a83d=await _0x3e287d[_0x559827(0xac)]();_0x54bdf1[_0x559827(0xa4)][_0x559827(0xc0)]=_0x14a83d[_0x559827(0xa4)][_0x559827(0xc0)],_0x54bdf1[_0x559827(0xa4)][_0x559827(0x92)]=_0x14a83d[_0x559827(0xa4)]['outputMb'];}catch(_0x277a12){}let _0x417b9f=0x0;try{_0x417b9f=await _0x2e0b35[_0x559827(0xad)]();}catch(_0x5f2412){console[_0x559827(0x8e)](_0x559827(0xa8),_0x5f2412);}const _0x21a461={'usedMemMb':0x0};try{const _0x332985=await _0x1f4852[_0x559827(0xc1)]();_0x21a461['usedMemMb']=_0x332985[_0x559827(0xae)];}catch(_0x436057){console[_0x559827(0x8e)](_0x559827(0xa9),_0x436057);}const _0x4a465a=new Date()['getHours']()[_0x559827(0x95)]()['padStart'](0x2,'0')+':'+new Date()[_0x559827(0x9d)]()[_0x559827(0x95)]()[_0x559827(0xb6)](0x2,'0');RequestMonitor[_0x559827(0x85)]['cpu']=RequestMonitor[_0x559827(0x85)][_0x559827(0x9b)][_0x559827(0x87)](-0x3c)[_0x559827(0x8a)](_0x231cec=>_0x231cec[_0x559827(0x93)]!==_0x4a465a),RequestMonitor[_0x559827(0x85)][_0x559827(0xbb)]=RequestMonitor['ressourcesUsageStats'][_0x559827(0xbb)][_0x559827(0x87)](-0x3c)['filter'](_0x48983a=>_0x48983a['time']!==_0x4a465a),RequestMonitor['ressourcesUsageStats'][_0x559827(0x94)]=RequestMonitor[_0x559827(0x85)][_0x559827(0x94)]['slice'](-0x3c)[_0x559827(0x8a)](_0x4b97d4=>_0x4b97d4['time']!==_0x4a465a),RequestMonitor[_0x559827(0x85)][_0x559827(0x9b)][_0x559827(0xa0)]({'time':_0x4a465a,'usage':_0x417b9f}),RequestMonitor[_0x559827(0x85)][_0x559827(0xbb)][_0x559827(0xa0)]({'time':_0x4a465a,'usage':(_0x21a461['usedMemMb']/0x3e8)[_0x559827(0x9c)](0x2)}),RequestMonitor[_0x559827(0x85)][_0x559827(0x94)][_0x559827(0xa0)]({'time':_0x4a465a,'usage':{'in':_0x54bdf1[_0x559827(0xa4)]?.[_0x559827(0xc0)]??0x0,'out':_0x54bdf1['total']?.[_0x559827(0x92)]??0x0}});try{await fs[_0x559827(0xc9)](RequestMonitor[_0x559827(0xaf)],JSON['stringify'](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x23bcf7){console[_0x559827(0x99)](_0x559827(0xb5),_0x23bcf7);}}static['getStats'](){const _0x2355db=a1_0x3863a2,_0x38e752=Date[_0x2355db(0x83)](),_0x27c096=_0x38e752-0x3c*0x3c*0x3e8,_0x168911=_0x38e752-0x18*0x3c*0x3c*0x3e8,_0x588c58=RequestMonitor[_0x2355db(0xc4)][_0x2355db(0x8a)](_0x3bb86a=>_0x3bb86a['timestamp']>_0x27c096),_0x107581={'total':RequestMonitor[_0x2355db(0x84)]['length'],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x2355db(0xa5)](_0x3ca40a=>{const _0xe51890=_0x2355db;_0x107581['byCodes'][_0x3ca40a[_0xe51890(0xb3)]]=(_0x107581[_0xe51890(0xc2)][_0x3ca40a['statusCode']]||0x0)+0x1;const _0x4c375f=_0x3ca40a[_0xe51890(0xbe)]+'\x20'+_0x3ca40a[_0xe51890(0xa6)];!_0x107581[_0xe51890(0xa7)][_0x4c375f]&&(_0x107581[_0xe51890(0xa7)][_0x4c375f]={'total':0x0,'codes':{}}),_0x107581[_0xe51890(0xa7)][_0x4c375f][_0xe51890(0xa4)]++,_0x107581[_0xe51890(0xa7)][_0x4c375f]['codes'][_0x3ca40a['statusCode']]=(_0x107581[_0xe51890(0xa7)][_0x4c375f][_0xe51890(0xbd)][_0x3ca40a[_0xe51890(0xb3)]]||0x0)+0x1;}),{'rps':_0x588c58,'httpCodes':_0x107581,'ressourcesUsageStats':RequestMonitor[_0x2355db(0x85)]};}}RequestMonitor['init']()[a1_0x3863a2(0xab)](()=>{}),RequestMonitor['startPeriodicSave']();const counter=RequestMonitor;module['exports']=counter;