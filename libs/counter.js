const a1_0x1fc8fc=a1_0xce13;(function(_0x3db545,_0x87e3b1){const _0x185fba=a1_0xce13,_0x1ca60f=_0x3db545();while(!![]){try{const _0x1fbb62=-parseInt(_0x185fba(0x12b))/0x1*(-parseInt(_0x185fba(0x13d))/0x2)+-parseInt(_0x185fba(0x13b))/0x3*(parseInt(_0x185fba(0x14f))/0x4)+-parseInt(_0x185fba(0x11c))/0x5+-parseInt(_0x185fba(0x113))/0x6+parseInt(_0x185fba(0x135))/0x7+parseInt(_0x185fba(0x11f))/0x8+-parseInt(_0x185fba(0x119))/0x9;if(_0x1fbb62===_0x87e3b1)break;else _0x1ca60f['push'](_0x1ca60f['shift']());}catch(_0xb53287){_0x1ca60f['push'](_0x1ca60f['shift']());}}}(a1_0x5e26,0x9a208));const fs=require('fs')[a1_0x1fc8fc(0x14c)],osu=require(a1_0x1fc8fc(0x120));function a1_0x5e26(){const _0x5cf606=['ressourcesUsageStats','currentRequests','writeFile','816300qVYgSj','inOut','rpsData','outputMb','filter','utf8','4123071MPOIfs','toString','length','1856495ZZhjgm','error','init','3205104knqzss','node-os-utils','getMinutes','method','getStats','push','codes','now','end','startPeriodicSave','time','save','16555uttsLH','/metrics','log','usedMemMb','rpsStoragePath','cpu','usage','netstat','lastMinute','ressourcesUsageStatsPath','5323668tacRCd','mem','byPath','parse','Error\x20getting\x20memory\x20usage:','path','2219385bCFtgj','Request\x20monitor\x20middleware','142FKKGIP','total','includes','network','inputMb','floor','then','toFixed','Initializing\x20request\x20monitor...','stringify','memory','info','timestamp','padStart','getUsageRessourcesStatsAndSave','promises','slice','Error\x20getting\x20CPU\x20usage:','4ZCYCby','statusCode','middleware','cadviewer/settings/requests-per-minute.json','byCodes','Error\x20saving\x20monitoring\x20data:','httpCodesData','getHours','httpCodesStoragePath','readFile'];a1_0x5e26=function(){return _0x5cf606;};return a1_0x5e26();}class RequestMonitor{static [a1_0x1fc8fc(0x12f)]=a1_0x1fc8fc(0x109);static [a1_0x1fc8fc(0x10e)]='cadviewer/settings/http-codes-24h.json';static [a1_0x1fc8fc(0x134)]='cadviewer/settings/ressources-usage-stats.json';static [a1_0x1fc8fc(0x115)]=[];static [a1_0x1fc8fc(0x10c)]=[];static [a1_0x1fc8fc(0x110)]={};static ['lastMinute']=Math[a1_0x1fc8fc(0x142)](Date[a1_0x1fc8fc(0x126)]()/0x3e8/0x3c);static [a1_0x1fc8fc(0x111)]=0x0;static async[a1_0x1fc8fc(0x11e)](){const _0x4a5a6c=a1_0x1fc8fc;console['log'](_0x4a5a6c(0x145));try{const _0x29745e=await fs['readFile'](RequestMonitor[_0x4a5a6c(0x12f)],'utf8');RequestMonitor[_0x4a5a6c(0x115)]=JSON[_0x4a5a6c(0x138)](_0x29745e);}catch(_0x4807e5){RequestMonitor[_0x4a5a6c(0x115)]=[];}try{const _0x6a5bee=await fs[_0x4a5a6c(0x10f)](RequestMonitor[_0x4a5a6c(0x10e)],_0x4a5a6c(0x118));RequestMonitor['httpCodesData']=JSON[_0x4a5a6c(0x138)](_0x6a5bee);}catch(_0x1c2dc4){RequestMonitor[_0x4a5a6c(0x10c)]=[];}try{const _0x5ab60d=await fs['readFile'](RequestMonitor['ressourcesUsageStatsPath'],_0x4a5a6c(0x118));RequestMonitor[_0x4a5a6c(0x110)]=JSON['parse'](_0x5ab60d),!RequestMonitor[_0x4a5a6c(0x110)]['cpu']&&(RequestMonitor[_0x4a5a6c(0x110)][_0x4a5a6c(0x130)]=[]),!RequestMonitor[_0x4a5a6c(0x110)][_0x4a5a6c(0x147)]&&(RequestMonitor['ressourcesUsageStats'][_0x4a5a6c(0x147)]=[]),!RequestMonitor[_0x4a5a6c(0x110)][_0x4a5a6c(0x140)]&&(RequestMonitor['ressourcesUsageStats']['network']=[]);}catch(_0x3fc7d8){RequestMonitor[_0x4a5a6c(0x110)]={'cpu':[],'memory':[],'network':[]};}console['log']('Request\x20monitor\x20initialized.');}static[a1_0x1fc8fc(0x108)](_0x428670,_0x43fe79,_0x1842b6){const _0x17d390=a1_0x1fc8fc;if(_0x428670[_0x17d390(0x13a)][_0x17d390(0x13f)](_0x17d390(0x12c)))return _0x1842b6();console['log'](_0x17d390(0x13c));let _0x8e5225=Date[_0x17d390(0x126)](),_0x376503=Math['floor'](_0x8e5225/0x3e8/0x3c);console['log']('=======>');const _0x47f1f7=_0x43fe79[_0x17d390(0x127)];_0x43fe79[_0x17d390(0x127)]=(..._0x15af74)=>{const _0x11733c=_0x17d390;console['log'](_0x376503,{'currentMinute':_0x376503});_0x376503>RequestMonitor[_0x11733c(0x133)]&&(RequestMonitor['rpsData'][_0x11733c(0x124)]({'timestamp':RequestMonitor[_0x11733c(0x133)]*0x3e8*0x3c,'requests':RequestMonitor[_0x11733c(0x111)]}),RequestMonitor[_0x11733c(0x111)]=0x0,RequestMonitor[_0x11733c(0x133)]=_0x376503);RequestMonitor['currentRequests']++,RequestMonitor['httpCodesData'][_0x11733c(0x124)]({'timestamp':Date[_0x11733c(0x126)](),'statusCode':_0x43fe79[_0x11733c(0x150)],'path':_0x428670[_0x11733c(0x13a)],'method':_0x428670[_0x11733c(0x122)]});const _0xd04e22=Date[_0x11733c(0x126)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor[_0x11733c(0x10c)][_0x11733c(0x117)](_0x30ea9d=>_0x30ea9d['timestamp']>_0xd04e22),_0x47f1f7['apply'](_0x43fe79,_0x15af74);},_0x1842b6();}static async['save'](){const _0x28b768=a1_0x1fc8fc;try{RequestMonitor[_0x28b768(0x133)]!==Math[_0x28b768(0x142)](Date[_0x28b768(0x126)]()/0x3e8/0x3c)&&(RequestMonitor[_0x28b768(0x115)][_0x28b768(0x124)]({'timestamp':RequestMonitor[_0x28b768(0x133)]*0x3e8*0x3c,'requests':RequestMonitor[_0x28b768(0x111)]}),RequestMonitor[_0x28b768(0x111)]=0x0,RequestMonitor['lastMinute']=Math[_0x28b768(0x142)](Date[_0x28b768(0x126)]()/0x3e8/0x3c)),await fs[_0x28b768(0x112)](RequestMonitor[_0x28b768(0x12f)],JSON[_0x28b768(0x146)](RequestMonitor[_0x28b768(0x115)],null,0x2)),await fs[_0x28b768(0x112)](RequestMonitor[_0x28b768(0x10e)],JSON[_0x28b768(0x146)](RequestMonitor[_0x28b768(0x10c)],null,0x2));}catch(_0x3edd12){console[_0x28b768(0x11d)](_0x28b768(0x10b),_0x3edd12);}}static async[a1_0x1fc8fc(0x128)](){const _0x55fac9=a1_0x1fc8fc;setInterval(()=>RequestMonitor[_0x55fac9(0x12a)](),0x3c*0x3e8),setInterval(()=>{const _0x244cf5=_0x55fac9;RequestMonitor[_0x244cf5(0x14b)]()[_0x244cf5(0x143)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x55fac9(0x14b)]()[_0x55fac9(0x143)](()=>{});}static async[a1_0x1fc8fc(0x14b)](){const _0x54a2b6=a1_0x1fc8fc,_0x1a825e=osu['cpu'],_0x36045c=osu[_0x54a2b6(0x136)],_0x2ed5b5=osu[_0x54a2b6(0x132)],_0x3cd4d1={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x1b37c2=await _0x2ed5b5[_0x54a2b6(0x114)]();_0x3cd4d1[_0x54a2b6(0x13e)][_0x54a2b6(0x141)]=_0x1b37c2[_0x54a2b6(0x13e)][_0x54a2b6(0x141)],_0x3cd4d1[_0x54a2b6(0x13e)][_0x54a2b6(0x116)]=_0x1b37c2[_0x54a2b6(0x13e)][_0x54a2b6(0x116)];}catch(_0x335490){}let _0x5b3fd2=0x0;try{_0x5b3fd2=await _0x1a825e[_0x54a2b6(0x131)]();}catch(_0x425cc6){console[_0x54a2b6(0x12d)](_0x54a2b6(0x14e),_0x425cc6);}const _0x2db691={'usedMemMb':0x0};try{const _0x42e830=await _0x36045c[_0x54a2b6(0x148)]();_0x2db691[_0x54a2b6(0x12e)]=_0x42e830['usedMemMb'];}catch(_0xbdbb24){console[_0x54a2b6(0x12d)](_0x54a2b6(0x139),_0xbdbb24);}const _0x587ecb=new Date()[_0x54a2b6(0x10d)]()[_0x54a2b6(0x11a)]()[_0x54a2b6(0x14a)](0x2,'0')+':'+new Date()[_0x54a2b6(0x121)]()[_0x54a2b6(0x11a)]()[_0x54a2b6(0x14a)](0x2,'0');RequestMonitor[_0x54a2b6(0x110)][_0x54a2b6(0x130)]=RequestMonitor[_0x54a2b6(0x110)][_0x54a2b6(0x130)][_0x54a2b6(0x14d)](-0x3c)['filter'](_0x3343ef=>_0x3343ef[_0x54a2b6(0x129)]!==_0x587ecb),RequestMonitor['ressourcesUsageStats']['memory']=RequestMonitor[_0x54a2b6(0x110)][_0x54a2b6(0x147)]['slice'](-0x3c)[_0x54a2b6(0x117)](_0x3c88aa=>_0x3c88aa[_0x54a2b6(0x129)]!==_0x587ecb),RequestMonitor[_0x54a2b6(0x110)]['network']=RequestMonitor['ressourcesUsageStats'][_0x54a2b6(0x140)][_0x54a2b6(0x14d)](-0x3c)[_0x54a2b6(0x117)](_0x2694ab=>_0x2694ab[_0x54a2b6(0x129)]!==_0x587ecb),RequestMonitor[_0x54a2b6(0x110)][_0x54a2b6(0x130)][_0x54a2b6(0x124)]({'time':_0x587ecb,'usage':_0x5b3fd2}),RequestMonitor['ressourcesUsageStats'][_0x54a2b6(0x147)][_0x54a2b6(0x124)]({'time':_0x587ecb,'usage':(_0x2db691[_0x54a2b6(0x12e)]/0x3e8)[_0x54a2b6(0x144)](0x2)}),RequestMonitor[_0x54a2b6(0x110)][_0x54a2b6(0x140)]['push']({'time':_0x587ecb,'usage':{'in':_0x3cd4d1[_0x54a2b6(0x13e)]?.[_0x54a2b6(0x141)]??0x0,'out':_0x3cd4d1['total']?.[_0x54a2b6(0x116)]??0x0}});try{await fs[_0x54a2b6(0x112)](RequestMonitor[_0x54a2b6(0x134)],JSON[_0x54a2b6(0x146)](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x4e8e87){console[_0x54a2b6(0x11d)](_0x54a2b6(0x10b),_0x4e8e87);}}static[a1_0x1fc8fc(0x123)](){const _0x27d29f=a1_0x1fc8fc,_0x5c9d4b=Date['now'](),_0x3f8941=_0x5c9d4b-0x3c*0x3c*0x3e8,_0x456b2e=_0x5c9d4b-0x18*0x3c*0x3c*0x3e8,_0x594627=RequestMonitor[_0x27d29f(0x115)][_0x27d29f(0x117)](_0x47878b=>_0x47878b[_0x27d29f(0x149)]>_0x3f8941),_0x3f3ba8={'total':RequestMonitor[_0x27d29f(0x10c)][_0x27d29f(0x11b)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x27d29f(0x10c)]['forEach'](_0x1703df=>{const _0x592b83=_0x27d29f;_0x3f3ba8[_0x592b83(0x10a)][_0x1703df['statusCode']]=(_0x3f3ba8['byCodes'][_0x1703df[_0x592b83(0x150)]]||0x0)+0x1;const _0x44f665=_0x1703df[_0x592b83(0x122)]+'\x20'+_0x1703df[_0x592b83(0x13a)];!_0x3f3ba8['byPath'][_0x44f665]&&(_0x3f3ba8[_0x592b83(0x137)][_0x44f665]={'total':0x0,'codes':{}}),_0x3f3ba8[_0x592b83(0x137)][_0x44f665]['total']++,_0x3f3ba8[_0x592b83(0x137)][_0x44f665][_0x592b83(0x125)][_0x1703df[_0x592b83(0x150)]]=(_0x3f3ba8[_0x592b83(0x137)][_0x44f665][_0x592b83(0x125)][_0x1703df[_0x592b83(0x150)]]||0x0)+0x1;}),{'rps':_0x594627,'httpCodes':_0x3f3ba8,'ressourcesUsageStats':RequestMonitor[_0x27d29f(0x110)]};}}function a1_0xce13(_0x4ea593,_0x45adfd){const _0x5e2633=a1_0x5e26();return a1_0xce13=function(_0xce1384,_0x2a0e69){_0xce1384=_0xce1384-0x108;let _0x3a7a2b=_0x5e2633[_0xce1384];return _0x3a7a2b;},a1_0xce13(_0x4ea593,_0x45adfd);}RequestMonitor[a1_0x1fc8fc(0x11e)]()[a1_0x1fc8fc(0x143)](()=>{}),RequestMonitor[a1_0x1fc8fc(0x128)]();const counter=RequestMonitor;module['exports']=counter;