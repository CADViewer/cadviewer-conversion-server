const a1_0x32d41b=a1_0x543f;(function(_0x1fbb48,_0x1d8ad8){const _0x4ac67f=a1_0x543f,_0x121f8d=_0x1fbb48();while(!![]){try{const _0x3d111c=-parseInt(_0x4ac67f(0x136))/0x1*(-parseInt(_0x4ac67f(0x130))/0x2)+parseInt(_0x4ac67f(0x125))/0x3*(-parseInt(_0x4ac67f(0x110))/0x4)+parseInt(_0x4ac67f(0x13c))/0x5*(-parseInt(_0x4ac67f(0x11f))/0x6)+parseInt(_0x4ac67f(0x11e))/0x7+-parseInt(_0x4ac67f(0x132))/0x8*(-parseInt(_0x4ac67f(0x10c))/0x9)+-parseInt(_0x4ac67f(0x107))/0xa*(-parseInt(_0x4ac67f(0x108))/0xb)+-parseInt(_0x4ac67f(0xfe))/0xc;if(_0x3d111c===_0x1d8ad8)break;else _0x121f8d['push'](_0x121f8d['shift']());}catch(_0x43c0fc){_0x121f8d['push'](_0x121f8d['shift']());}}}(a1_0xdc40,0x21f8f));const fs=require('fs')[a1_0x32d41b(0x140)],osu=require('node-os-utils');function a1_0xdc40(){const _0x2c651e=['statusCode','usage','filter','689067OBxzuy','init','time','parse','4yihoDp','Error\x20saving\x20monitoring\x20data:','cadviewer/settings/http-codes-24h.json','slice','stringify','getUsageRessourcesStatsAndSave','rpsStoragePath','lastMinute','log','currentRequests','utf8','includes','getStats','/metrics','750764OyxKnc','108DazwTJ','inputMb','outputMb','info','usedMemMb','length','515355rnvJJM','byPath','writeFile','floor','codes','inOut','byCodes','apply','toFixed','startPeriodicSave','Request\x20monitor\x20initialized.','4LyfNow','netstat','8ZjLpYd','memory','path','mem','75029TTrwzV','exports','total','now','network','getMinutes','32090mcniip','Initializing\x20request\x20monitor...','timestamp','end','promises','ressourcesUsageStats','rpsData','cpu','method','17448KwTJPX','then','httpCodesData','push','ressourcesUsageStatsPath','httpCodesStoragePath','error','toString','cadviewer/settings/ressources-usage-stats.json','940410xRfFRC','11wHePgg'];a1_0xdc40=function(){return _0x2c651e;};return a1_0xdc40();}function a1_0x543f(_0x44dbee,_0x19535b){const _0xdc40ef=a1_0xdc40();return a1_0x543f=function(_0x543f9e,_0x18ef68){_0x543f9e=_0x543f9e-0xfd;let _0x27df52=_0xdc40ef[_0x543f9e];return _0x27df52;},a1_0x543f(_0x44dbee,_0x19535b);}class RequestMonitor{static [a1_0x32d41b(0x116)]='cadviewer/settings/requests-per-minute.json';static ['httpCodesStoragePath']=a1_0x32d41b(0x112);static ['ressourcesUsageStatsPath']=a1_0x32d41b(0x106);static ['rpsData']=[];static [a1_0x32d41b(0x100)]=[];static [a1_0x32d41b(0x141)]={};static [a1_0x32d41b(0x117)]=Math[a1_0x32d41b(0x128)](Date[a1_0x32d41b(0x139)]()/0x3e8/0x3c);static [a1_0x32d41b(0x119)]=0x0;static async[a1_0x32d41b(0x10d)](){const _0x845536=a1_0x32d41b;console['log'](_0x845536(0x13d));try{const _0x25a025=await fs['readFile'](RequestMonitor['rpsStoragePath'],_0x845536(0x11a));RequestMonitor[_0x845536(0x142)]=JSON[_0x845536(0x10f)](_0x25a025);}catch(_0x3f38b1){RequestMonitor[_0x845536(0x142)]=[];}try{const _0xd46b02=await fs['readFile'](RequestMonitor[_0x845536(0x103)],_0x845536(0x11a));RequestMonitor[_0x845536(0x100)]=JSON[_0x845536(0x10f)](_0xd46b02);}catch(_0x3cbbe5){RequestMonitor[_0x845536(0x100)]=[];}try{const _0x5a4474=await fs['readFile'](RequestMonitor[_0x845536(0x102)],'utf8');RequestMonitor['ressourcesUsageStats']=JSON[_0x845536(0x10f)](_0x5a4474),!RequestMonitor['ressourcesUsageStats'][_0x845536(0x143)]&&(RequestMonitor[_0x845536(0x141)][_0x845536(0x143)]=[]),!RequestMonitor[_0x845536(0x141)][_0x845536(0x133)]&&(RequestMonitor[_0x845536(0x141)]['memory']=[]),!RequestMonitor[_0x845536(0x141)]['network']&&(RequestMonitor[_0x845536(0x141)][_0x845536(0x13a)]=[]);}catch(_0x12d74b){RequestMonitor[_0x845536(0x141)]={'cpu':[],'memory':[],'network':[]};}console[_0x845536(0x118)](_0x845536(0x12f));}static['middleware'](_0x2f2e45,_0x4c11d8,_0x447086){const _0x294602=a1_0x32d41b;if(_0x2f2e45['path'][_0x294602(0x11b)](_0x294602(0x11d)))return _0x447086();console[_0x294602(0x118)]('Request\x20monitor\x20middleware');let _0x242da1=Date[_0x294602(0x139)](),_0x3fea21=Math[_0x294602(0x128)](_0x242da1/0x3e8/0x3c);console[_0x294602(0x118)]('=======>');const _0x6954e7=_0x4c11d8[_0x294602(0x13f)];_0x4c11d8[_0x294602(0x13f)]=(..._0x30c6c2)=>{const _0x379815=_0x294602;console[_0x379815(0x118)](_0x3fea21,{'currentMinute':_0x3fea21});_0x3fea21>RequestMonitor[_0x379815(0x117)]&&(RequestMonitor[_0x379815(0x142)][_0x379815(0x101)]({'timestamp':RequestMonitor[_0x379815(0x117)]*0x3e8*0x3c,'requests':RequestMonitor[_0x379815(0x119)]}),RequestMonitor[_0x379815(0x119)]=0x0,RequestMonitor[_0x379815(0x117)]=_0x3fea21);RequestMonitor['currentRequests']++,RequestMonitor[_0x379815(0x100)][_0x379815(0x101)]({'timestamp':Date['now'](),'statusCode':_0x4c11d8[_0x379815(0x109)],'path':_0x2f2e45[_0x379815(0x134)],'method':_0x2f2e45[_0x379815(0xfd)]});const _0x10239d=Date[_0x379815(0x139)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor[_0x379815(0x100)]['filter'](_0x505f70=>_0x505f70[_0x379815(0x13e)]>_0x10239d),_0x6954e7[_0x379815(0x12c)](_0x4c11d8,_0x30c6c2);},_0x447086();}static async['save'](){const _0x218eb4=a1_0x32d41b;try{RequestMonitor[_0x218eb4(0x117)]!==Math[_0x218eb4(0x128)](Date[_0x218eb4(0x139)]()/0x3e8/0x3c)&&(RequestMonitor[_0x218eb4(0x142)][_0x218eb4(0x101)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x218eb4(0x119)]}),RequestMonitor[_0x218eb4(0x119)]=0x0,RequestMonitor[_0x218eb4(0x117)]=Math[_0x218eb4(0x128)](Date['now']()/0x3e8/0x3c)),await fs[_0x218eb4(0x127)](RequestMonitor['rpsStoragePath'],JSON[_0x218eb4(0x114)](RequestMonitor['rpsData'],null,0x2)),await fs[_0x218eb4(0x127)](RequestMonitor[_0x218eb4(0x103)],JSON[_0x218eb4(0x114)](RequestMonitor[_0x218eb4(0x100)],null,0x2));}catch(_0x5bea57){console[_0x218eb4(0x104)](_0x218eb4(0x111),_0x5bea57);}}static async[a1_0x32d41b(0x12e)](){const _0x2dfa8d=a1_0x32d41b;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x51519b=a1_0x543f;RequestMonitor[_0x51519b(0x115)]()[_0x51519b(0xff)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x2dfa8d(0x115)]()[_0x2dfa8d(0xff)](()=>{});}static async[a1_0x32d41b(0x115)](){const _0x5b6ab2=a1_0x32d41b,_0x15d4cf=osu[_0x5b6ab2(0x143)],_0x47efa6=osu[_0x5b6ab2(0x135)],_0x415d02=osu[_0x5b6ab2(0x131)],_0xab2dfc={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x39ad75=await _0x415d02[_0x5b6ab2(0x12a)]();_0xab2dfc[_0x5b6ab2(0x138)][_0x5b6ab2(0x120)]=_0x39ad75['total'][_0x5b6ab2(0x120)],_0xab2dfc[_0x5b6ab2(0x138)][_0x5b6ab2(0x121)]=_0x39ad75['total']['outputMb'];}catch(_0x5052fd){}let _0x3d5856=0x0;try{_0x3d5856=await _0x15d4cf[_0x5b6ab2(0x10a)]();}catch(_0x57496e){console[_0x5b6ab2(0x118)]('Error\x20getting\x20CPU\x20usage:',_0x57496e);}const _0xeb160e={'usedMemMb':0x0};try{const _0x289f66=await _0x47efa6[_0x5b6ab2(0x122)]();_0xeb160e[_0x5b6ab2(0x123)]=_0x289f66[_0x5b6ab2(0x123)];}catch(_0x4ddb4c){console[_0x5b6ab2(0x118)]('Error\x20getting\x20memory\x20usage:',_0x4ddb4c);}const _0x2a59ea=new Date()['getHours']()[_0x5b6ab2(0x105)]()['padStart'](0x2,'0')+':'+new Date()[_0x5b6ab2(0x13b)]()[_0x5b6ab2(0x105)]()['padStart'](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x5b6ab2(0x143)]=RequestMonitor[_0x5b6ab2(0x141)][_0x5b6ab2(0x143)][_0x5b6ab2(0x113)](-0x3c)['filter'](_0x268355=>_0x268355[_0x5b6ab2(0x10e)]!==_0x2a59ea),RequestMonitor[_0x5b6ab2(0x141)]['memory']=RequestMonitor[_0x5b6ab2(0x141)]['memory'][_0x5b6ab2(0x113)](-0x3c)[_0x5b6ab2(0x10b)](_0x4446fb=>_0x4446fb[_0x5b6ab2(0x10e)]!==_0x2a59ea),RequestMonitor[_0x5b6ab2(0x141)][_0x5b6ab2(0x13a)]=RequestMonitor[_0x5b6ab2(0x141)][_0x5b6ab2(0x13a)][_0x5b6ab2(0x113)](-0x3c)[_0x5b6ab2(0x10b)](_0x52ffb7=>_0x52ffb7['time']!==_0x2a59ea),RequestMonitor['ressourcesUsageStats'][_0x5b6ab2(0x143)][_0x5b6ab2(0x101)]({'time':_0x2a59ea,'usage':_0x3d5856}),RequestMonitor['ressourcesUsageStats'][_0x5b6ab2(0x133)][_0x5b6ab2(0x101)]({'time':_0x2a59ea,'usage':(_0xeb160e[_0x5b6ab2(0x123)]/0x3e8)[_0x5b6ab2(0x12d)](0x2)}),RequestMonitor[_0x5b6ab2(0x141)][_0x5b6ab2(0x13a)][_0x5b6ab2(0x101)]({'time':_0x2a59ea,'usage':{'in':_0xab2dfc[_0x5b6ab2(0x138)]?.['inputMb']??0x0,'out':_0xab2dfc[_0x5b6ab2(0x138)]?.[_0x5b6ab2(0x121)]??0x0}});try{await fs[_0x5b6ab2(0x127)](RequestMonitor[_0x5b6ab2(0x102)],JSON[_0x5b6ab2(0x114)](RequestMonitor[_0x5b6ab2(0x141)],null,0x2));}catch(_0x35d4c6){console[_0x5b6ab2(0x104)]('Error\x20saving\x20monitoring\x20data:',_0x35d4c6);}}static[a1_0x32d41b(0x11c)](){const _0x88136c=a1_0x32d41b,_0x2093c0=Date[_0x88136c(0x139)](),_0x3d2287=_0x2093c0-0x3c*0x3c*0x3e8,_0x4c3390=_0x2093c0-0x18*0x3c*0x3c*0x3e8,_0x1f8817=RequestMonitor[_0x88136c(0x142)]['filter'](_0x4e6f34=>_0x4e6f34['timestamp']>_0x3d2287),_0x4a104c={'total':RequestMonitor[_0x88136c(0x100)][_0x88136c(0x124)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x88136c(0x100)]['forEach'](_0x3dfdd9=>{const _0x56c425=_0x88136c;_0x4a104c['byCodes'][_0x3dfdd9[_0x56c425(0x109)]]=(_0x4a104c[_0x56c425(0x12b)][_0x3dfdd9[_0x56c425(0x109)]]||0x0)+0x1;const _0x16cdca=_0x3dfdd9['method']+'\x20'+_0x3dfdd9['path'];!_0x4a104c[_0x56c425(0x126)][_0x16cdca]&&(_0x4a104c['byPath'][_0x16cdca]={'total':0x0,'codes':{}}),_0x4a104c[_0x56c425(0x126)][_0x16cdca][_0x56c425(0x138)]++,_0x4a104c[_0x56c425(0x126)][_0x16cdca][_0x56c425(0x129)][_0x3dfdd9[_0x56c425(0x109)]]=(_0x4a104c[_0x56c425(0x126)][_0x16cdca][_0x56c425(0x129)][_0x3dfdd9[_0x56c425(0x109)]]||0x0)+0x1;}),{'rps':_0x1f8817,'httpCodes':_0x4a104c,'ressourcesUsageStats':RequestMonitor[_0x88136c(0x141)]};}}RequestMonitor[a1_0x32d41b(0x10d)]()[a1_0x32d41b(0xff)](()=>{}),RequestMonitor[a1_0x32d41b(0x12e)]();const counter=RequestMonitor;module[a1_0x32d41b(0x137)]=counter;