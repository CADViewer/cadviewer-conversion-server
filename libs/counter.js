const a2_0x29d517=a2_0x2f3d;(function(_0x51bdf3,_0x609bac){const _0x481ca6=a2_0x2f3d,_0x2ceb05=_0x51bdf3();while(!![]){try{const _0x284e13=parseInt(_0x481ca6(0x1d2))/0x1+parseInt(_0x481ca6(0x1d0))/0x2+parseInt(_0x481ca6(0x1d5))/0x3+-parseInt(_0x481ca6(0x1d4))/0x4*(parseInt(_0x481ca6(0x1c0))/0x5)+parseInt(_0x481ca6(0x1b0))/0x6+parseInt(_0x481ca6(0x1c6))/0x7*(-parseInt(_0x481ca6(0x19d))/0x8)+-parseInt(_0x481ca6(0x1ae))/0x9*(parseInt(_0x481ca6(0x1bb))/0xa);if(_0x284e13===_0x609bac)break;else _0x2ceb05['push'](_0x2ceb05['shift']());}catch(_0x27e50c){_0x2ceb05['push'](_0x2ceb05['shift']());}}}(a2_0x421f,0xb0cd5));const fs=require('fs')[a2_0x29d517(0x1b1)],osu=require(a2_0x29d517(0x195));class RequestMonitor{static [a2_0x29d517(0x1d1)]=a2_0x29d517(0x19b);static [a2_0x29d517(0x1b7)]=a2_0x29d517(0x1c2);static [a2_0x29d517(0x1aa)]=a2_0x29d517(0x1b4);static [a2_0x29d517(0x190)]=[];static [a2_0x29d517(0x199)]=[];static [a2_0x29d517(0x196)]={};static ['lastMinute']=Math['floor'](Date[a2_0x29d517(0x192)]()/0x3e8/0x3c);static [a2_0x29d517(0x1bd)]=0x0;static async['init'](){const _0x204c99=a2_0x29d517;console['log']('Initializing\x20request\x20monitor...');try{const _0x59f37d=await fs[_0x204c99(0x1ab)](RequestMonitor['rpsStoragePath'],_0x204c99(0x1cc));RequestMonitor[_0x204c99(0x190)]=JSON[_0x204c99(0x1b6)](_0x59f37d);}catch(_0x492a61){RequestMonitor['rpsData']=[];}try{const _0x9da3a8=await fs[_0x204c99(0x1ab)](RequestMonitor[_0x204c99(0x1b7)],_0x204c99(0x1cc));RequestMonitor[_0x204c99(0x199)]=JSON[_0x204c99(0x1b6)](_0x9da3a8);}catch(_0x3d3e75){RequestMonitor[_0x204c99(0x199)]=[];}try{const _0x1684f5=await fs[_0x204c99(0x1ab)](RequestMonitor[_0x204c99(0x1aa)],_0x204c99(0x1cc));RequestMonitor[_0x204c99(0x196)]=JSON[_0x204c99(0x1b6)](_0x1684f5),!RequestMonitor[_0x204c99(0x196)]['cpu']&&(RequestMonitor['ressourcesUsageStats']['cpu']=[]),!RequestMonitor[_0x204c99(0x196)][_0x204c99(0x1cf)]&&(RequestMonitor[_0x204c99(0x196)][_0x204c99(0x1cf)]=[]),!RequestMonitor[_0x204c99(0x196)][_0x204c99(0x191)]&&(RequestMonitor[_0x204c99(0x196)][_0x204c99(0x191)]=[]);}catch(_0x43c53d){RequestMonitor[_0x204c99(0x196)]={'cpu':[],'memory':[],'network':[]};}console['log'](_0x204c99(0x1d3));}static[a2_0x29d517(0x1ba)](_0x265d56,_0x187294,_0xcf7b7b){const _0x34a171=a2_0x29d517;if(_0x265d56[_0x34a171(0x1c8)][_0x34a171(0x1c5)](_0x34a171(0x194)))return _0xcf7b7b();console['log'](_0x34a171(0x1cb));let _0x4a0408=Date[_0x34a171(0x192)](),_0x437e36=Math[_0x34a171(0x1c3)](_0x4a0408/0x3e8/0x3c);console[_0x34a171(0x1a5)]('=======>');const _0x1f3604=_0x187294[_0x34a171(0x1ac)];_0x187294[_0x34a171(0x1ac)]=(..._0x425ede)=>{const _0x20630d=_0x34a171;console['log'](_0x437e36,{'currentMinute':_0x437e36});_0x437e36>RequestMonitor[_0x20630d(0x1af)]&&(RequestMonitor[_0x20630d(0x190)]['push']({'timestamp':RequestMonitor[_0x20630d(0x1af)]*0x3e8*0x3c,'requests':RequestMonitor[_0x20630d(0x1bd)]}),RequestMonitor[_0x20630d(0x1bd)]=0x0,RequestMonitor[_0x20630d(0x1af)]=_0x437e36);RequestMonitor['currentRequests']++,RequestMonitor[_0x20630d(0x199)]['push']({'timestamp':Date[_0x20630d(0x192)](),'statusCode':_0x187294[_0x20630d(0x19c)],'path':_0x265d56['path'],'method':_0x265d56[_0x20630d(0x1ca)]});const _0x29a042=Date[_0x20630d(0x192)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor[_0x20630d(0x199)][_0x20630d(0x18e)](_0x77e3d6=>_0x77e3d6[_0x20630d(0x1a7)]>_0x29a042),_0x1f3604[_0x20630d(0x1bc)](_0x187294,_0x425ede);},_0xcf7b7b();}static async[a2_0x29d517(0x1a8)](){const _0x53d69d=a2_0x29d517;try{RequestMonitor[_0x53d69d(0x1af)]!==Math['floor'](Date[_0x53d69d(0x192)]()/0x3e8/0x3c)&&(RequestMonitor[_0x53d69d(0x190)]['push']({'timestamp':RequestMonitor[_0x53d69d(0x1af)]*0x3e8*0x3c,'requests':RequestMonitor[_0x53d69d(0x1bd)]}),RequestMonitor[_0x53d69d(0x1bd)]=0x0,RequestMonitor[_0x53d69d(0x1af)]=Math[_0x53d69d(0x1c3)](Date[_0x53d69d(0x192)]()/0x3e8/0x3c)),await fs[_0x53d69d(0x1b9)](RequestMonitor[_0x53d69d(0x1d1)],JSON['stringify'](RequestMonitor[_0x53d69d(0x190)],null,0x2)),await fs[_0x53d69d(0x1b9)](RequestMonitor[_0x53d69d(0x1b7)],JSON[_0x53d69d(0x1b2)](RequestMonitor[_0x53d69d(0x199)],null,0x2));}catch(_0x4d615e){console['error'](_0x53d69d(0x1c1),_0x4d615e);}}static async[a2_0x29d517(0x1a6)](){const _0x803e27=a2_0x29d517;setInterval(()=>RequestMonitor[_0x803e27(0x1a8)](),0x3c*0x3e8),setInterval(()=>{const _0x305833=_0x803e27;RequestMonitor[_0x305833(0x1bf)]()[_0x305833(0x1ce)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x803e27(0x1bf)]()[_0x803e27(0x1ce)](()=>{});}static async[a2_0x29d517(0x1bf)](){const _0x4f0965=a2_0x29d517,_0x35b22b=osu[_0x4f0965(0x1d7)],_0x31a758=osu[_0x4f0965(0x1b5)],_0x31e0e7=osu[_0x4f0965(0x197)],_0x120242={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0xa78bb7=await _0x31e0e7['inOut']();_0x120242[_0x4f0965(0x1a4)]['inputMb']=_0xa78bb7['total'][_0x4f0965(0x19f)],_0x120242[_0x4f0965(0x1a4)]['outputMb']=_0xa78bb7[_0x4f0965(0x1a4)]['outputMb'];}catch(_0x205080){}let _0x23fc29=0x0;try{_0x23fc29=await _0x35b22b[_0x4f0965(0x1ad)]();}catch(_0x36a157){console[_0x4f0965(0x1a5)]('Error\x20getting\x20CPU\x20usage:',_0x36a157);}const _0x79f656={'usedMemMb':0x0};try{const _0x3d82e3=await _0x31a758[_0x4f0965(0x1cd)]();_0x79f656[_0x4f0965(0x18d)]=_0x3d82e3['usedMemMb'];}catch(_0x5be882){console[_0x4f0965(0x1a5)](_0x4f0965(0x1c9),_0x5be882);}const _0x2360af=new Date()[_0x4f0965(0x193)]()[_0x4f0965(0x1a9)]()[_0x4f0965(0x1b3)](0x2,'0')+':'+new Date()[_0x4f0965(0x1d6)]()[_0x4f0965(0x1a9)]()[_0x4f0965(0x1b3)](0x2,'0');RequestMonitor[_0x4f0965(0x196)][_0x4f0965(0x1d7)]=RequestMonitor[_0x4f0965(0x196)][_0x4f0965(0x1d7)]['slice'](-0x3c)[_0x4f0965(0x18e)](_0x31ce6f=>_0x31ce6f['time']!==_0x2360af),RequestMonitor['ressourcesUsageStats'][_0x4f0965(0x1cf)]=RequestMonitor[_0x4f0965(0x196)]['memory'][_0x4f0965(0x1a1)](-0x3c)['filter'](_0x36eee9=>_0x36eee9[_0x4f0965(0x18f)]!==_0x2360af),RequestMonitor[_0x4f0965(0x196)][_0x4f0965(0x191)]=RequestMonitor[_0x4f0965(0x196)]['network']['slice'](-0x3c)[_0x4f0965(0x18e)](_0x517fd1=>_0x517fd1[_0x4f0965(0x18f)]!==_0x2360af),RequestMonitor[_0x4f0965(0x196)][_0x4f0965(0x1d7)][_0x4f0965(0x19a)]({'time':_0x2360af,'usage':_0x23fc29}),RequestMonitor['ressourcesUsageStats'][_0x4f0965(0x1cf)][_0x4f0965(0x19a)]({'time':_0x2360af,'usage':(_0x79f656[_0x4f0965(0x18d)]/0x3e8)[_0x4f0965(0x1a2)](0x2)}),RequestMonitor[_0x4f0965(0x196)][_0x4f0965(0x191)][_0x4f0965(0x19a)]({'time':_0x2360af,'usage':{'in':_0x120242[_0x4f0965(0x1a4)]?.[_0x4f0965(0x19f)]??0x0,'out':_0x120242[_0x4f0965(0x1a4)]?.[_0x4f0965(0x198)]??0x0}});try{await fs['writeFile'](RequestMonitor[_0x4f0965(0x1aa)],JSON[_0x4f0965(0x1b2)](RequestMonitor[_0x4f0965(0x196)],null,0x2));}catch(_0x10dcfb){console['error']('Error\x20saving\x20monitoring\x20data:',_0x10dcfb);}}static[a2_0x29d517(0x1a3)](){const _0x590b9d=a2_0x29d517,_0x4b9eb2=Date[_0x590b9d(0x192)](),_0x2d419c=_0x4b9eb2-0x3c*0x3c*0x3e8,_0x4975a2=_0x4b9eb2-0x18*0x3c*0x3c*0x3e8,_0x43989a=RequestMonitor['rpsData']['filter'](_0x3127c7=>_0x3127c7[_0x590b9d(0x1a7)]>_0x2d419c),_0x4faff2={'total':RequestMonitor[_0x590b9d(0x199)][_0x590b9d(0x1c4)],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x590b9d(0x1c7)](_0x1f5fa2=>{const _0x1d6cc5=_0x590b9d;_0x4faff2[_0x1d6cc5(0x1b8)][_0x1f5fa2['statusCode']]=(_0x4faff2[_0x1d6cc5(0x1b8)][_0x1f5fa2[_0x1d6cc5(0x19c)]]||0x0)+0x1;const _0x1a7e7a=_0x1f5fa2[_0x1d6cc5(0x1ca)]+'\x20'+_0x1f5fa2[_0x1d6cc5(0x1c8)];!_0x4faff2[_0x1d6cc5(0x1be)][_0x1a7e7a]&&(_0x4faff2['byPath'][_0x1a7e7a]={'total':0x0,'codes':{}}),_0x4faff2[_0x1d6cc5(0x1be)][_0x1a7e7a]['total']++,_0x4faff2[_0x1d6cc5(0x1be)][_0x1a7e7a][_0x1d6cc5(0x19e)][_0x1f5fa2[_0x1d6cc5(0x19c)]]=(_0x4faff2[_0x1d6cc5(0x1be)][_0x1a7e7a][_0x1d6cc5(0x19e)][_0x1f5fa2[_0x1d6cc5(0x19c)]]||0x0)+0x1;}),{'rps':_0x43989a,'httpCodes':_0x4faff2,'ressourcesUsageStats':RequestMonitor[_0x590b9d(0x196)]};}}RequestMonitor[a2_0x29d517(0x1a0)]()['then'](()=>{}),RequestMonitor[a2_0x29d517(0x1a6)]();function a2_0x421f(){const _0xfdf14e=['Request\x20monitor\x20middleware','utf8','info','then','memory','1158578jNiiew','rpsStoragePath','952574dtBNlk','Request\x20monitor\x20initialized.','25384zKeYmm','1287639NNVQRF','getMinutes','cpu','usedMemMb','filter','time','rpsData','network','now','getHours','/metrics','node-os-utils','ressourcesUsageStats','netstat','outputMb','httpCodesData','push','cadviewer/settings/requests-per-minute.json','statusCode','1046488JkFNlu','codes','inputMb','init','slice','toFixed','getStats','total','log','startPeriodicSave','timestamp','save','toString','ressourcesUsageStatsPath','readFile','end','usage','296766VOUTwa','lastMinute','490416vtjGjW','promises','stringify','padStart','cadviewer/settings/ressources-usage-stats.json','mem','parse','httpCodesStoragePath','byCodes','writeFile','middleware','60rsIvja','apply','currentRequests','byPath','getUsageRessourcesStatsAndSave','780yswBEb','Error\x20saving\x20monitoring\x20data:','cadviewer/settings/http-codes-24h.json','floor','length','includes','7HnfprA','forEach','path','Error\x20getting\x20memory\x20usage:','method'];a2_0x421f=function(){return _0xfdf14e;};return a2_0x421f();}function a2_0x2f3d(_0x520cd5,_0x1f3943){const _0x421f7c=a2_0x421f();return a2_0x2f3d=function(_0x2f3d32,_0x4d4640){_0x2f3d32=_0x2f3d32-0x18d;let _0x2101ef=_0x421f7c[_0x2f3d32];return _0x2101ef;},a2_0x2f3d(_0x520cd5,_0x1f3943);}const counter=RequestMonitor;module['exports']=counter;