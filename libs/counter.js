const a1_0x1a3ae5=a1_0x444c;(function(_0x3a974c,_0x4377aa){const _0x2d8543=a1_0x444c,_0x1d77cf=_0x3a974c();while(!![]){try{const _0x275f1e=-parseInt(_0x2d8543(0x1ef))/0x1*(-parseInt(_0x2d8543(0x223))/0x2)+parseInt(_0x2d8543(0x202))/0x3*(-parseInt(_0x2d8543(0x211))/0x4)+parseInt(_0x2d8543(0x1ea))/0x5+-parseInt(_0x2d8543(0x1f3))/0x6+-parseInt(_0x2d8543(0x1f1))/0x7*(parseInt(_0x2d8543(0x1ee))/0x8)+parseInt(_0x2d8543(0x225))/0x9*(-parseInt(_0x2d8543(0x1f0))/0xa)+parseInt(_0x2d8543(0x22b))/0xb;if(_0x275f1e===_0x4377aa)break;else _0x1d77cf['push'](_0x1d77cf['shift']());}catch(_0x12674){_0x1d77cf['push'](_0x1d77cf['shift']());}}}(a1_0x507a,0x6d349));const fs=require('fs')[a1_0x1a3ae5(0x213)],osu=require(a1_0x1a3ae5(0x203));class RequestMonitor{static [a1_0x1a3ae5(0x224)]=a1_0x1a3ae5(0x228);static [a1_0x1a3ae5(0x1fb)]=a1_0x1a3ae5(0x20d);static [a1_0x1a3ae5(0x1f5)]=a1_0x1a3ae5(0x1e8);static ['rpsData']=[];static [a1_0x1a3ae5(0x200)]=[];static [a1_0x1a3ae5(0x22a)]={};static ['lastMinute']=Math[a1_0x1a3ae5(0x1e5)](Date[a1_0x1a3ae5(0x204)]()/0x3e8/0x3c);static [a1_0x1a3ae5(0x1f2)]=0x0;static async[a1_0x1a3ae5(0x208)](){const _0x861680=a1_0x1a3ae5;console[_0x861680(0x220)]('Initializing\x20request\x20monitor...');try{const _0x3e0879=await fs[_0x861680(0x1ec)](RequestMonitor[_0x861680(0x224)],'utf8');RequestMonitor['rpsData']=JSON['parse'](_0x3e0879);}catch(_0x90044a){RequestMonitor[_0x861680(0x1ed)]=[];}try{const _0x3e8720=await fs[_0x861680(0x1ec)](RequestMonitor['httpCodesStoragePath'],'utf8');RequestMonitor[_0x861680(0x200)]=JSON[_0x861680(0x22c)](_0x3e8720);}catch(_0x50c12b){RequestMonitor[_0x861680(0x200)]=[];}try{const _0x4b1728=await fs[_0x861680(0x1ec)](RequestMonitor[_0x861680(0x1f5)],_0x861680(0x20b));RequestMonitor['ressourcesUsageStats']=JSON[_0x861680(0x22c)](_0x4b1728),!RequestMonitor[_0x861680(0x22a)]['cpu']&&(RequestMonitor['ressourcesUsageStats']['cpu']=[]),!RequestMonitor['ressourcesUsageStats'][_0x861680(0x217)]&&(RequestMonitor[_0x861680(0x22a)][_0x861680(0x217)]=[]),!RequestMonitor['ressourcesUsageStats']['network']&&(RequestMonitor[_0x861680(0x22a)][_0x861680(0x215)]=[]);}catch(_0x4337e8){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console[_0x861680(0x220)](_0x861680(0x210));}static[a1_0x1a3ae5(0x214)](_0x3054fb,_0x534ea0,_0x423fe2){const _0x4a5b5e=a1_0x1a3ae5;if(_0x3054fb[_0x4a5b5e(0x20e)][_0x4a5b5e(0x1e6)](_0x4a5b5e(0x229)))return _0x423fe2();console[_0x4a5b5e(0x220)]('Request\x20monitor\x20middleware');let _0x33e52e=Date[_0x4a5b5e(0x204)](),_0x21cb7d=Math[_0x4a5b5e(0x1e5)](_0x33e52e/0x3e8/0x3c);console[_0x4a5b5e(0x220)](_0x4a5b5e(0x227));const _0x175b85=_0x534ea0['end'];_0x534ea0[_0x4a5b5e(0x1fa)]=(..._0x35eb9b)=>{const _0x185978=_0x4a5b5e;console[_0x185978(0x220)](_0x21cb7d,{'currentMinute':_0x21cb7d});_0x21cb7d>RequestMonitor[_0x185978(0x21f)]&&(RequestMonitor[_0x185978(0x1ed)]['push']({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x185978(0x1f2)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x185978(0x21f)]=_0x21cb7d);RequestMonitor[_0x185978(0x1f2)]++,RequestMonitor[_0x185978(0x200)][_0x185978(0x218)]({'timestamp':Date['now'](),'statusCode':_0x534ea0[_0x185978(0x1f6)],'path':_0x3054fb[_0x185978(0x20e)],'method':_0x3054fb['method']});const _0x76b873=Date[_0x185978(0x204)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x185978(0x200)]=RequestMonitor[_0x185978(0x200)][_0x185978(0x1f7)](_0x17b102=>_0x17b102[_0x185978(0x1f8)]>_0x76b873),_0x175b85[_0x185978(0x209)](_0x534ea0,_0x35eb9b);},_0x423fe2();}static async[a1_0x1a3ae5(0x216)](){const _0x68bfed=a1_0x1a3ae5;try{RequestMonitor['lastMinute']!==Math[_0x68bfed(0x1e5)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x68bfed(0x1ed)][_0x68bfed(0x218)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x68bfed(0x1f2)]}),RequestMonitor[_0x68bfed(0x1f2)]=0x0,RequestMonitor['lastMinute']=Math[_0x68bfed(0x1e5)](Date[_0x68bfed(0x204)]()/0x3e8/0x3c)),await fs[_0x68bfed(0x21e)](RequestMonitor['rpsStoragePath'],JSON[_0x68bfed(0x207)](RequestMonitor[_0x68bfed(0x1ed)],null,0x2)),await fs[_0x68bfed(0x21e)](RequestMonitor[_0x68bfed(0x1fb)],JSON[_0x68bfed(0x207)](RequestMonitor[_0x68bfed(0x200)],null,0x2));}catch(_0x5ecbfc){console['error'](_0x68bfed(0x21a),_0x5ecbfc);}}static async['startPeriodicSave'](){const _0x2c1787=a1_0x1a3ae5;setInterval(()=>RequestMonitor[_0x2c1787(0x216)](),0x3c*0x3e8),setInterval(()=>{const _0x4cdf71=_0x2c1787;RequestMonitor['getUsageRessourcesStatsAndSave']()[_0x4cdf71(0x226)](()=>{});},0x3c*0x3e8),RequestMonitor['getUsageRessourcesStatsAndSave']()[_0x2c1787(0x226)](()=>{});}static async[a1_0x1a3ae5(0x22d)](){const _0x28eeae=a1_0x1a3ae5,_0x77c5b0=osu[_0x28eeae(0x1fe)],_0x47fc6b=osu['mem'],_0x28c73c=osu[_0x28eeae(0x1ff)],_0x18314a={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x383d30=await _0x28c73c[_0x28eeae(0x1f9)]();_0x18314a['total'][_0x28eeae(0x205)]=_0x383d30[_0x28eeae(0x1fd)][_0x28eeae(0x205)],_0x18314a[_0x28eeae(0x1fd)][_0x28eeae(0x21c)]=_0x383d30[_0x28eeae(0x1fd)][_0x28eeae(0x21c)];}catch(_0x1ad436){}let _0x77bcac=0x0;try{_0x77bcac=await _0x77c5b0['usage']();}catch(_0xf12fa7){console['log']('Error\x20getting\x20CPU\x20usage:',_0xf12fa7);}const _0x434674={'usedMemMb':0x0};try{const _0x5b3cff=await _0x47fc6b['info']();_0x434674[_0x28eeae(0x20a)]=_0x5b3cff[_0x28eeae(0x20a)];}catch(_0x1fd47a){console[_0x28eeae(0x220)](_0x28eeae(0x219),_0x1fd47a);}const _0x4dcc99=new Date()[_0x28eeae(0x201)]()[_0x28eeae(0x20c)]()['padStart'](0x2,'0')+':'+new Date()[_0x28eeae(0x1e9)]()[_0x28eeae(0x20c)]()['padStart'](0x2,'0');RequestMonitor[_0x28eeae(0x22a)][_0x28eeae(0x1fe)]=RequestMonitor[_0x28eeae(0x22a)][_0x28eeae(0x1fe)]['slice'](-0x3c)[_0x28eeae(0x1f7)](_0x5924ba=>_0x5924ba['time']!==_0x4dcc99),RequestMonitor[_0x28eeae(0x22a)]['memory']=RequestMonitor[_0x28eeae(0x22a)][_0x28eeae(0x217)][_0x28eeae(0x21d)](-0x3c)['filter'](_0x33792e=>_0x33792e[_0x28eeae(0x1f4)]!==_0x4dcc99),RequestMonitor[_0x28eeae(0x22a)][_0x28eeae(0x215)]=RequestMonitor['ressourcesUsageStats'][_0x28eeae(0x215)][_0x28eeae(0x21d)](-0x3c)[_0x28eeae(0x1f7)](_0x2880ba=>_0x2880ba['time']!==_0x4dcc99),RequestMonitor[_0x28eeae(0x22a)][_0x28eeae(0x1fe)][_0x28eeae(0x218)]({'time':_0x4dcc99,'usage':_0x77bcac}),RequestMonitor['ressourcesUsageStats'][_0x28eeae(0x217)][_0x28eeae(0x218)]({'time':_0x4dcc99,'usage':(_0x434674['usedMemMb']/0x3e8)[_0x28eeae(0x20f)](0x2)}),RequestMonitor[_0x28eeae(0x22a)][_0x28eeae(0x215)]['push']({'time':_0x4dcc99,'usage':{'in':_0x18314a[_0x28eeae(0x1fd)]?.[_0x28eeae(0x205)]??0x0,'out':_0x18314a[_0x28eeae(0x1fd)]?.['outputMb']??0x0}});try{await fs[_0x28eeae(0x21e)](RequestMonitor[_0x28eeae(0x1f5)],JSON[_0x28eeae(0x207)](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x5e9311){console[_0x28eeae(0x1e4)](_0x28eeae(0x21a),_0x5e9311);}}static[a1_0x1a3ae5(0x206)](){const _0x31120c=a1_0x1a3ae5,_0x74a9c0=Date[_0x31120c(0x204)](),_0x1b0da5=_0x74a9c0-0x3c*0x3c*0x3e8,_0x577078=_0x74a9c0-0x18*0x3c*0x3c*0x3e8,_0x2f82ab=RequestMonitor[_0x31120c(0x1ed)][_0x31120c(0x1f7)](_0x4a562c=>_0x4a562c['timestamp']>_0x1b0da5),_0x427c96={'total':RequestMonitor[_0x31120c(0x200)]['length'],'byCodes':{},'byPath':{}};return RequestMonitor[_0x31120c(0x200)][_0x31120c(0x1e7)](_0x58f6fe=>{const _0x726f7=_0x31120c;_0x427c96[_0x726f7(0x1eb)][_0x58f6fe[_0x726f7(0x1f6)]]=(_0x427c96[_0x726f7(0x1eb)][_0x58f6fe['statusCode']]||0x0)+0x1;const _0x40c174=_0x58f6fe[_0x726f7(0x212)]+'\x20'+_0x58f6fe['path'];!_0x427c96[_0x726f7(0x1fc)][_0x40c174]&&(_0x427c96[_0x726f7(0x1fc)][_0x40c174]={'total':0x0,'codes':{}}),_0x427c96[_0x726f7(0x1fc)][_0x40c174][_0x726f7(0x1fd)]++,_0x427c96[_0x726f7(0x1fc)][_0x40c174]['codes'][_0x58f6fe[_0x726f7(0x1f6)]]=(_0x427c96[_0x726f7(0x1fc)][_0x40c174][_0x726f7(0x222)][_0x58f6fe[_0x726f7(0x1f6)]]||0x0)+0x1;}),{'rps':_0x2f82ab,'httpCodes':_0x427c96,'ressourcesUsageStats':RequestMonitor[_0x31120c(0x22a)]};}}function a1_0x444c(_0xb502ce,_0x10807a){const _0x507a86=a1_0x507a();return a1_0x444c=function(_0x444c9e,_0x2ca81b){_0x444c9e=_0x444c9e-0x1e4;let _0x4439ea=_0x507a86[_0x444c9e];return _0x4439ea;},a1_0x444c(_0xb502ce,_0x10807a);}RequestMonitor[a1_0x1a3ae5(0x208)]()[a1_0x1a3ae5(0x226)](()=>{}),RequestMonitor[a1_0x1a3ae5(0x21b)]();const counter=RequestMonitor;function a1_0x507a(){const _0x98f26c=['then','=======>','cadviewer/settings/requests-per-minute.json','/metrics','ressourcesUsageStats','10120506bjmKwz','parse','getUsageRessourcesStatsAndSave','error','floor','includes','forEach','cadviewer/settings/ressources-usage-stats.json','getMinutes','3206540FcBFeb','byCodes','readFile','rpsData','8zaNdNz','693178EQbPwS','10SJZNYh','2997729Ntgzcv','currentRequests','4223688yZilIX','time','ressourcesUsageStatsPath','statusCode','filter','timestamp','inOut','end','httpCodesStoragePath','byPath','total','cpu','netstat','httpCodesData','getHours','363QjMndP','node-os-utils','now','inputMb','getStats','stringify','init','apply','usedMemMb','utf8','toString','cadviewer/settings/http-codes-24h.json','path','toFixed','Request\x20monitor\x20initialized.','5636PmBjFV','method','promises','middleware','network','save','memory','push','Error\x20getting\x20memory\x20usage:','Error\x20saving\x20monitoring\x20data:','startPeriodicSave','outputMb','slice','writeFile','lastMinute','log','exports','codes','2TqDhQQ','rpsStoragePath','4540887HyLhMw'];a1_0x507a=function(){return _0x98f26c;};return a1_0x507a();}module[a1_0x1a3ae5(0x221)]=counter;