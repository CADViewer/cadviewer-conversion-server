const a1_0x2b8007=a1_0x3d40;function a1_0x3d40(_0x5827c1,_0xd84c17){const _0x591543=a1_0x5915();return a1_0x3d40=function(_0x3d40ca,_0x67b88e){_0x3d40ca=_0x3d40ca-0x1d1;let _0x5d974a=_0x591543[_0x3d40ca];return _0x5d974a;},a1_0x3d40(_0x5827c1,_0xd84c17);}(function(_0x46e4c6,_0x57ed52){const _0xbff7b8=a1_0x3d40,_0x5d49f3=_0x46e4c6();while(!![]){try{const _0x13f56d=-parseInt(_0xbff7b8(0x1d7))/0x1+parseInt(_0xbff7b8(0x1d6))/0x2+-parseInt(_0xbff7b8(0x214))/0x3+parseInt(_0xbff7b8(0x1fb))/0x4+-parseInt(_0xbff7b8(0x1eb))/0x5+parseInt(_0xbff7b8(0x1f8))/0x6*(parseInt(_0xbff7b8(0x1f3))/0x7)+-parseInt(_0xbff7b8(0x1ec))/0x8*(parseInt(_0xbff7b8(0x200))/0x9);if(_0x13f56d===_0x57ed52)break;else _0x5d49f3['push'](_0x5d49f3['shift']());}catch(_0x50d3e7){_0x5d49f3['push'](_0x5d49f3['shift']());}}}(a1_0x5915,0xe46ef));const fs=require('fs')[a1_0x2b8007(0x201)],osu=require(a1_0x2b8007(0x1d8));function a1_0x5915(){const _0x1a2b8d=['parse','end','netstat','getMinutes','2225464EUftgY','1852265TzOgQw','node-os-utils','middleware','byCodes','slice','cadviewer/settings/ressources-usage-stats.json','path','includes','now','outputMb','utf8','total','rpsStoragePath','startPeriodicSave','floor','init','getStats','httpCodesStoragePath','lastMinute','timestamp','6205935XRLqrK','807688jldpxN','statusCode','network','mem','filter','Initializing\x20request\x20monitor...','save','3825353MBHgVr','rpsData','info','cadviewer/settings/requests-per-minute.json','getUsageRessourcesStatsAndSave','18gjTMqC','exports','byPath','7235624KmpjxZ','ressourcesUsageStatsPath','httpCodesData','push','padStart','18rHmkAT','promises','toString','usedMemMb','toFixed','Error\x20getting\x20CPU\x20usage:','cpu','error','Request\x20monitor\x20middleware','writeFile','cadviewer/settings/http-codes-24h.json','readFile','getHours','usage','Error\x20saving\x20monitoring\x20data:','time','method','memory','then','/metrics','990114EkNSog','ressourcesUsageStats','log','inputMb','currentRequests','stringify'];a1_0x5915=function(){return _0x1a2b8d;};return a1_0x5915();}class RequestMonitor{static [a1_0x2b8007(0x1e3)]=a1_0x2b8007(0x1f6);static ['httpCodesStoragePath']=a1_0x2b8007(0x20a);static [a1_0x2b8007(0x1fc)]=a1_0x2b8007(0x1dc);static [a1_0x2b8007(0x1f4)]=[];static [a1_0x2b8007(0x1fd)]=[];static [a1_0x2b8007(0x215)]={};static ['lastMinute']=Math[a1_0x2b8007(0x1e5)](Date['now']()/0x3e8/0x3c);static [a1_0x2b8007(0x218)]=0x0;static async[a1_0x2b8007(0x1e6)](){const _0x4b9e91=a1_0x2b8007;console[_0x4b9e91(0x216)](_0x4b9e91(0x1f1));try{const _0x5e02f1=await fs[_0x4b9e91(0x20b)](RequestMonitor[_0x4b9e91(0x1e3)],_0x4b9e91(0x1e1));RequestMonitor[_0x4b9e91(0x1f4)]=JSON['parse'](_0x5e02f1);}catch(_0x4de4ba){RequestMonitor['rpsData']=[];}try{const _0x4beb22=await fs['readFile'](RequestMonitor[_0x4b9e91(0x1e8)],_0x4b9e91(0x1e1));RequestMonitor[_0x4b9e91(0x1fd)]=JSON[_0x4b9e91(0x1d2)](_0x4beb22);}catch(_0x462f19){RequestMonitor['httpCodesData']=[];}try{const _0x11faae=await fs[_0x4b9e91(0x20b)](RequestMonitor[_0x4b9e91(0x1fc)],'utf8');RequestMonitor[_0x4b9e91(0x215)]=JSON['parse'](_0x11faae),!RequestMonitor[_0x4b9e91(0x215)][_0x4b9e91(0x206)]&&(RequestMonitor[_0x4b9e91(0x215)][_0x4b9e91(0x206)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x4b9e91(0x211)]&&(RequestMonitor[_0x4b9e91(0x215)][_0x4b9e91(0x211)]=[]),!RequestMonitor[_0x4b9e91(0x215)][_0x4b9e91(0x1ee)]&&(RequestMonitor[_0x4b9e91(0x215)][_0x4b9e91(0x1ee)]=[]);}catch(_0x1bdd75){RequestMonitor[_0x4b9e91(0x215)]={'cpu':[],'memory':[],'network':[]};}console[_0x4b9e91(0x216)]('Request\x20monitor\x20initialized.');}static[a1_0x2b8007(0x1d9)](_0x4fb576,_0x1242bf,_0x343132){const _0x2ce8b5=a1_0x2b8007;if(_0x4fb576[_0x2ce8b5(0x1dd)][_0x2ce8b5(0x1de)](_0x2ce8b5(0x213)))return _0x343132();console[_0x2ce8b5(0x216)](_0x2ce8b5(0x208));let _0x2ec9d2=Date[_0x2ce8b5(0x1df)](),_0x4635c3=Math[_0x2ce8b5(0x1e5)](_0x2ec9d2/0x3e8/0x3c);console['log']('=======>');const _0x153d00=_0x1242bf[_0x2ce8b5(0x1d3)];_0x1242bf['end']=(..._0x677ddc)=>{const _0x2c1129=_0x2ce8b5;console[_0x2c1129(0x216)](_0x4635c3,{'currentMinute':_0x4635c3});_0x4635c3>RequestMonitor['lastMinute']&&(RequestMonitor['rpsData']['push']({'timestamp':RequestMonitor[_0x2c1129(0x1e9)]*0x3e8*0x3c,'requests':RequestMonitor[_0x2c1129(0x218)]}),RequestMonitor[_0x2c1129(0x218)]=0x0,RequestMonitor[_0x2c1129(0x1e9)]=_0x4635c3);RequestMonitor[_0x2c1129(0x218)]++,RequestMonitor[_0x2c1129(0x1fd)][_0x2c1129(0x1fe)]({'timestamp':Date[_0x2c1129(0x1df)](),'statusCode':_0x1242bf[_0x2c1129(0x1ed)],'path':_0x4fb576['path'],'method':_0x4fb576[_0x2c1129(0x210)]});const _0x32697f=Date[_0x2c1129(0x1df)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x2c1129(0x1fd)]=RequestMonitor['httpCodesData']['filter'](_0x1b18e4=>_0x1b18e4[_0x2c1129(0x1ea)]>_0x32697f),_0x153d00['apply'](_0x1242bf,_0x677ddc);},_0x343132();}static async['save'](){const _0x4b8510=a1_0x2b8007;try{RequestMonitor[_0x4b8510(0x1e9)]!==Math[_0x4b8510(0x1e5)](Date[_0x4b8510(0x1df)]()/0x3e8/0x3c)&&(RequestMonitor['rpsData'][_0x4b8510(0x1fe)]({'timestamp':RequestMonitor[_0x4b8510(0x1e9)]*0x3e8*0x3c,'requests':RequestMonitor[_0x4b8510(0x218)]}),RequestMonitor[_0x4b8510(0x218)]=0x0,RequestMonitor[_0x4b8510(0x1e9)]=Math[_0x4b8510(0x1e5)](Date[_0x4b8510(0x1df)]()/0x3e8/0x3c)),await fs[_0x4b8510(0x209)](RequestMonitor[_0x4b8510(0x1e3)],JSON['stringify'](RequestMonitor[_0x4b8510(0x1f4)],null,0x2)),await fs[_0x4b8510(0x209)](RequestMonitor[_0x4b8510(0x1e8)],JSON[_0x4b8510(0x1d1)](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x4bd34a){console[_0x4b8510(0x207)](_0x4b8510(0x20e),_0x4bd34a);}}static async[a1_0x2b8007(0x1e4)](){const _0x22a49c=a1_0x2b8007;setInterval(()=>RequestMonitor[_0x22a49c(0x1f2)](),0x3c*0x3e8),setInterval(()=>{const _0x3ecb5e=_0x22a49c;RequestMonitor[_0x3ecb5e(0x1f7)]()[_0x3ecb5e(0x212)](()=>{});},0x3c*0x3e8),RequestMonitor['getUsageRessourcesStatsAndSave']()[_0x22a49c(0x212)](()=>{});}static async[a1_0x2b8007(0x1f7)](){const _0x15dac6=a1_0x2b8007,_0x1e1ad1=osu[_0x15dac6(0x206)],_0x3d7776=osu[_0x15dac6(0x1ef)],_0x1f7e5d=osu[_0x15dac6(0x1d4)],_0x4ea1dc={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x452f50=await _0x1f7e5d['inOut']();_0x4ea1dc['total'][_0x15dac6(0x217)]=_0x452f50[_0x15dac6(0x1e2)]['inputMb'],_0x4ea1dc[_0x15dac6(0x1e2)][_0x15dac6(0x1e0)]=_0x452f50[_0x15dac6(0x1e2)][_0x15dac6(0x1e0)];}catch(_0x55e485){}let _0x4c22bf=0x0;try{_0x4c22bf=await _0x1e1ad1[_0x15dac6(0x20d)]();}catch(_0x20c75e){console[_0x15dac6(0x216)](_0x15dac6(0x205),_0x20c75e);}const _0x589338={'usedMemMb':0x0};try{const _0x47ba8c=await _0x3d7776[_0x15dac6(0x1f5)]();_0x589338[_0x15dac6(0x203)]=_0x47ba8c[_0x15dac6(0x203)];}catch(_0x20f30d){console['log']('Error\x20getting\x20memory\x20usage:',_0x20f30d);}const _0x321639=new Date()[_0x15dac6(0x20c)]()['toString']()[_0x15dac6(0x1ff)](0x2,'0')+':'+new Date()[_0x15dac6(0x1d5)]()[_0x15dac6(0x202)]()['padStart'](0x2,'0');RequestMonitor[_0x15dac6(0x215)][_0x15dac6(0x206)]=RequestMonitor['ressourcesUsageStats'][_0x15dac6(0x206)][_0x15dac6(0x1db)](-0x3c)[_0x15dac6(0x1f0)](_0x1dbe6d=>_0x1dbe6d[_0x15dac6(0x20f)]!==_0x321639),RequestMonitor[_0x15dac6(0x215)][_0x15dac6(0x211)]=RequestMonitor[_0x15dac6(0x215)][_0x15dac6(0x211)][_0x15dac6(0x1db)](-0x3c)[_0x15dac6(0x1f0)](_0x18b6b0=>_0x18b6b0[_0x15dac6(0x20f)]!==_0x321639),RequestMonitor[_0x15dac6(0x215)][_0x15dac6(0x1ee)]=RequestMonitor[_0x15dac6(0x215)]['network'][_0x15dac6(0x1db)](-0x3c)[_0x15dac6(0x1f0)](_0x17ab47=>_0x17ab47[_0x15dac6(0x20f)]!==_0x321639),RequestMonitor[_0x15dac6(0x215)][_0x15dac6(0x206)][_0x15dac6(0x1fe)]({'time':_0x321639,'usage':_0x4c22bf}),RequestMonitor[_0x15dac6(0x215)][_0x15dac6(0x211)][_0x15dac6(0x1fe)]({'time':_0x321639,'usage':(_0x589338['usedMemMb']/0x3e8)[_0x15dac6(0x204)](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x15dac6(0x1ee)][_0x15dac6(0x1fe)]({'time':_0x321639,'usage':{'in':_0x4ea1dc[_0x15dac6(0x1e2)]?.[_0x15dac6(0x217)]??0x0,'out':_0x4ea1dc[_0x15dac6(0x1e2)]?.['outputMb']??0x0}});try{await fs[_0x15dac6(0x209)](RequestMonitor[_0x15dac6(0x1fc)],JSON[_0x15dac6(0x1d1)](RequestMonitor[_0x15dac6(0x215)],null,0x2));}catch(_0x52720d){console[_0x15dac6(0x207)]('Error\x20saving\x20monitoring\x20data:',_0x52720d);}}static[a1_0x2b8007(0x1e7)](){const _0x72d41=a1_0x2b8007,_0x56a1af=Date[_0x72d41(0x1df)](),_0x1bb629=_0x56a1af-0x3c*0x3c*0x3e8,_0x5d3909=_0x56a1af-0x18*0x3c*0x3c*0x3e8,_0x1e1013=RequestMonitor[_0x72d41(0x1f4)]['filter'](_0x3b3337=>_0x3b3337[_0x72d41(0x1ea)]>_0x1bb629),_0x394857={'total':RequestMonitor['httpCodesData']['length'],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData']['forEach'](_0x21a64d=>{const _0x109757=_0x72d41;_0x394857[_0x109757(0x1da)][_0x21a64d[_0x109757(0x1ed)]]=(_0x394857[_0x109757(0x1da)][_0x21a64d[_0x109757(0x1ed)]]||0x0)+0x1;const _0x5a138a=_0x21a64d[_0x109757(0x210)]+'\x20'+_0x21a64d[_0x109757(0x1dd)];!_0x394857[_0x109757(0x1fa)][_0x5a138a]&&(_0x394857[_0x109757(0x1fa)][_0x5a138a]={'total':0x0,'codes':{}}),_0x394857[_0x109757(0x1fa)][_0x5a138a][_0x109757(0x1e2)]++,_0x394857[_0x109757(0x1fa)][_0x5a138a]['codes'][_0x21a64d[_0x109757(0x1ed)]]=(_0x394857['byPath'][_0x5a138a]['codes'][_0x21a64d[_0x109757(0x1ed)]]||0x0)+0x1;}),{'rps':_0x1e1013,'httpCodes':_0x394857,'ressourcesUsageStats':RequestMonitor[_0x72d41(0x215)]};}}RequestMonitor['init']()[a1_0x2b8007(0x212)](()=>{}),RequestMonitor[a1_0x2b8007(0x1e4)]();const counter=RequestMonitor;module[a1_0x2b8007(0x1f9)]=counter;