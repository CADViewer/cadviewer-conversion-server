const a1_0x32b4d2=a1_0x5dc2;function a1_0x5104(){const _0x2f196e=['Request\x20monitor\x20middleware','info','error','48dPiWKR','padStart','node-os-utils','lastMinute','promises','rpsStoragePath','4iomTfG','network','includes','floor','utf8','end','now','push','inputMb','Error\x20getting\x20memory\x20usage:','currentRequests','toString','getHours','usage','path','Request\x20monitor\x20initialized.','Initializing\x20request\x20monitor...','rpsData','codes','outputMb','memory','httpCodesStoragePath','forEach','exports','log','apply','filter','statusCode','cadviewer/settings/requests-per-minute.json','cpu','parse','/metrics','readFile','stringify','inOut','2081535DPwqmd','writeFile','Error\x20saving\x20monitoring\x20data:','byCodes','toFixed','ressourcesUsageStats','startPeriodicSave','ressourcesUsageStatsPath','129069wvcUqD','634430wOqnMC','netstat','init','total','854169HqQxmT','630297XJGzEN','timestamp','getUsageRessourcesStatsAndSave','byPath','save','middleware','slice','then','usedMemMb','2263176oFWuty','httpCodesData','1266447HDLiIE','method','time','Error\x20getting\x20CPU\x20usage:'];a1_0x5104=function(){return _0x2f196e;};return a1_0x5104();}(function(_0x29e53f,_0x200fc1){const _0x38aa29=a1_0x5dc2,_0x3267e4=_0x29e53f();while(!![]){try{const _0x824d78=-parseInt(_0x38aa29(0xad))/0x1+parseInt(_0x38aa29(0xae))/0x2+parseInt(_0x38aa29(0xb2))/0x3+-parseInt(_0x38aa29(0x82))/0x4*(-parseInt(_0x38aa29(0xa5))/0x5)+-parseInt(_0x38aa29(0x73))/0x6+parseInt(_0x38aa29(0x75))/0x7+parseInt(_0x38aa29(0x7c))/0x8*(-parseInt(_0x38aa29(0xb3))/0x9);if(_0x824d78===_0x200fc1)break;else _0x3267e4['push'](_0x3267e4['shift']());}catch(_0x1ee5b3){_0x3267e4['push'](_0x3267e4['shift']());}}}(a1_0x5104,0x4293f));const fs=require('fs')[a1_0x32b4d2(0x80)],osu=require(a1_0x32b4d2(0x7e));class RequestMonitor{static ['rpsStoragePath']=a1_0x32b4d2(0x9e);static ['httpCodesStoragePath']='cadviewer/settings/http-codes-24h.json';static [a1_0x32b4d2(0xac)]='cadviewer/settings/ressources-usage-stats.json';static [a1_0x32b4d2(0x93)]=[];static [a1_0x32b4d2(0x74)]=[];static ['ressourcesUsageStats']={};static [a1_0x32b4d2(0x7f)]=Math[a1_0x32b4d2(0x85)](Date['now']()/0x3e8/0x3c);static [a1_0x32b4d2(0x8c)]=0x0;static async[a1_0x32b4d2(0xb0)](){const _0x77dac=a1_0x32b4d2;console[_0x77dac(0x9a)](_0x77dac(0x92));try{const _0x348c8b=await fs[_0x77dac(0xa2)](RequestMonitor[_0x77dac(0x81)],'utf8');RequestMonitor['rpsData']=JSON[_0x77dac(0xa0)](_0x348c8b);}catch(_0x461a62){RequestMonitor['rpsData']=[];}try{const _0x3ba211=await fs[_0x77dac(0xa2)](RequestMonitor[_0x77dac(0x97)],_0x77dac(0x86));RequestMonitor[_0x77dac(0x74)]=JSON['parse'](_0x3ba211);}catch(_0x5a3c4d){RequestMonitor[_0x77dac(0x74)]=[];}try{const _0x3ddeed=await fs[_0x77dac(0xa2)](RequestMonitor[_0x77dac(0xac)],_0x77dac(0x86));RequestMonitor[_0x77dac(0xaa)]=JSON['parse'](_0x3ddeed),!RequestMonitor[_0x77dac(0xaa)][_0x77dac(0x9f)]&&(RequestMonitor[_0x77dac(0xaa)]['cpu']=[]),!RequestMonitor[_0x77dac(0xaa)][_0x77dac(0x96)]&&(RequestMonitor['ressourcesUsageStats']['memory']=[]),!RequestMonitor['ressourcesUsageStats']['network']&&(RequestMonitor[_0x77dac(0xaa)][_0x77dac(0x83)]=[]);}catch(_0x120a3b){RequestMonitor[_0x77dac(0xaa)]={'cpu':[],'memory':[],'network':[]};}console['log'](_0x77dac(0x91));}static[a1_0x32b4d2(0x6f)](_0x2ad566,_0x4dc46f,_0x43689b){const _0x38b207=a1_0x32b4d2;if(_0x2ad566[_0x38b207(0x90)][_0x38b207(0x84)](_0x38b207(0xa1)))return _0x43689b();console['log'](_0x38b207(0x79));let _0x53b464=Date['now'](),_0x4a8df3=Math[_0x38b207(0x85)](_0x53b464/0x3e8/0x3c);console[_0x38b207(0x9a)]('=======>');const _0x250b5a=_0x4dc46f[_0x38b207(0x87)];_0x4dc46f['end']=(..._0x74be65)=>{const _0x5d1d49=_0x38b207;console['log'](_0x4a8df3,{'currentMinute':_0x4a8df3});_0x4a8df3>RequestMonitor[_0x5d1d49(0x7f)]&&(RequestMonitor[_0x5d1d49(0x93)][_0x5d1d49(0x89)]({'timestamp':RequestMonitor[_0x5d1d49(0x7f)]*0x3e8*0x3c,'requests':RequestMonitor[_0x5d1d49(0x8c)]}),RequestMonitor[_0x5d1d49(0x8c)]=0x0,RequestMonitor[_0x5d1d49(0x7f)]=_0x4a8df3);RequestMonitor[_0x5d1d49(0x8c)]++,RequestMonitor[_0x5d1d49(0x74)][_0x5d1d49(0x89)]({'timestamp':Date[_0x5d1d49(0x88)](),'statusCode':_0x4dc46f[_0x5d1d49(0x9d)],'path':_0x2ad566[_0x5d1d49(0x90)],'method':_0x2ad566[_0x5d1d49(0x76)]});const _0x5a3ce4=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x5d1d49(0x74)]=RequestMonitor['httpCodesData'][_0x5d1d49(0x9c)](_0x30006d=>_0x30006d[_0x5d1d49(0xb4)]>_0x5a3ce4),_0x250b5a[_0x5d1d49(0x9b)](_0x4dc46f,_0x74be65);},_0x43689b();}static async['save'](){const _0x13391e=a1_0x32b4d2;try{RequestMonitor[_0x13391e(0x7f)]!==Math['floor'](Date[_0x13391e(0x88)]()/0x3e8/0x3c)&&(RequestMonitor[_0x13391e(0x93)]['push']({'timestamp':RequestMonitor[_0x13391e(0x7f)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x13391e(0x7f)]=Math[_0x13391e(0x85)](Date[_0x13391e(0x88)]()/0x3e8/0x3c)),await fs[_0x13391e(0xa6)](RequestMonitor[_0x13391e(0x81)],JSON['stringify'](RequestMonitor['rpsData'],null,0x2)),await fs[_0x13391e(0xa6)](RequestMonitor['httpCodesStoragePath'],JSON[_0x13391e(0xa3)](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x2abd0d){console[_0x13391e(0x7b)]('Error\x20saving\x20monitoring\x20data:',_0x2abd0d);}}static async[a1_0x32b4d2(0xab)](){const _0x317881=a1_0x32b4d2;setInterval(()=>RequestMonitor[_0x317881(0x6e)](),0x3c*0x3e8),setInterval(()=>{const _0x211194=_0x317881;RequestMonitor[_0x211194(0x6c)]()[_0x211194(0x71)](()=>{});},0x3c*0x3e8),RequestMonitor['getUsageRessourcesStatsAndSave']()[_0x317881(0x71)](()=>{});}static async[a1_0x32b4d2(0x6c)](){const _0x9b5bf2=a1_0x32b4d2,_0x3abada=osu['cpu'],_0x1d6cba=osu['mem'],_0x1bd152=osu[_0x9b5bf2(0xaf)],_0x29b0ae={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x3680a0=await _0x1bd152[_0x9b5bf2(0xa4)]();_0x29b0ae[_0x9b5bf2(0xb1)]['inputMb']=_0x3680a0[_0x9b5bf2(0xb1)][_0x9b5bf2(0x8a)],_0x29b0ae['total'][_0x9b5bf2(0x95)]=_0x3680a0[_0x9b5bf2(0xb1)][_0x9b5bf2(0x95)];}catch(_0x3829e4){}let _0x1ec0eb=0x0;try{_0x1ec0eb=await _0x3abada[_0x9b5bf2(0x8f)]();}catch(_0x30adef){console[_0x9b5bf2(0x9a)](_0x9b5bf2(0x78),_0x30adef);}const _0x2c9170={'usedMemMb':0x0};try{const _0x2bb222=await _0x1d6cba[_0x9b5bf2(0x7a)]();_0x2c9170[_0x9b5bf2(0x72)]=_0x2bb222[_0x9b5bf2(0x72)];}catch(_0x492155){console[_0x9b5bf2(0x9a)](_0x9b5bf2(0x8b),_0x492155);}const _0x20f25a=new Date()[_0x9b5bf2(0x8e)]()[_0x9b5bf2(0x8d)]()[_0x9b5bf2(0x7d)](0x2,'0')+':'+new Date()['getMinutes']()[_0x9b5bf2(0x8d)]()[_0x9b5bf2(0x7d)](0x2,'0');RequestMonitor[_0x9b5bf2(0xaa)][_0x9b5bf2(0x9f)]=RequestMonitor[_0x9b5bf2(0xaa)][_0x9b5bf2(0x9f)][_0x9b5bf2(0x70)](-0x3c)[_0x9b5bf2(0x9c)](_0x2c1e3e=>_0x2c1e3e[_0x9b5bf2(0x77)]!==_0x20f25a),RequestMonitor[_0x9b5bf2(0xaa)]['memory']=RequestMonitor[_0x9b5bf2(0xaa)][_0x9b5bf2(0x96)][_0x9b5bf2(0x70)](-0x3c)[_0x9b5bf2(0x9c)](_0x3f79e9=>_0x3f79e9['time']!==_0x20f25a),RequestMonitor['ressourcesUsageStats']['network']=RequestMonitor[_0x9b5bf2(0xaa)][_0x9b5bf2(0x83)][_0x9b5bf2(0x70)](-0x3c)['filter'](_0x3113ed=>_0x3113ed['time']!==_0x20f25a),RequestMonitor[_0x9b5bf2(0xaa)]['cpu'][_0x9b5bf2(0x89)]({'time':_0x20f25a,'usage':_0x1ec0eb}),RequestMonitor[_0x9b5bf2(0xaa)][_0x9b5bf2(0x96)]['push']({'time':_0x20f25a,'usage':(_0x2c9170[_0x9b5bf2(0x72)]/0x3e8)[_0x9b5bf2(0xa9)](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x9b5bf2(0x83)][_0x9b5bf2(0x89)]({'time':_0x20f25a,'usage':{'in':_0x29b0ae[_0x9b5bf2(0xb1)]?.[_0x9b5bf2(0x8a)]??0x0,'out':_0x29b0ae[_0x9b5bf2(0xb1)]?.[_0x9b5bf2(0x95)]??0x0}});try{await fs['writeFile'](RequestMonitor[_0x9b5bf2(0xac)],JSON['stringify'](RequestMonitor[_0x9b5bf2(0xaa)],null,0x2));}catch(_0x71d3af){console[_0x9b5bf2(0x7b)](_0x9b5bf2(0xa7),_0x71d3af);}}static['getStats'](){const _0x3b46e3=a1_0x32b4d2,_0x5810d2=Date[_0x3b46e3(0x88)](),_0x3c97f9=_0x5810d2-0x3c*0x3c*0x3e8,_0x5b1800=_0x5810d2-0x18*0x3c*0x3c*0x3e8,_0x4770dd=RequestMonitor[_0x3b46e3(0x93)][_0x3b46e3(0x9c)](_0x33f5b6=>_0x33f5b6[_0x3b46e3(0xb4)]>_0x3c97f9),_0x11179e={'total':RequestMonitor[_0x3b46e3(0x74)]['length'],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x3b46e3(0x98)](_0x507f78=>{const _0x2b5cd9=_0x3b46e3;_0x11179e[_0x2b5cd9(0xa8)][_0x507f78[_0x2b5cd9(0x9d)]]=(_0x11179e[_0x2b5cd9(0xa8)][_0x507f78[_0x2b5cd9(0x9d)]]||0x0)+0x1;const _0x2b7b4e=_0x507f78[_0x2b5cd9(0x76)]+'\x20'+_0x507f78['path'];!_0x11179e[_0x2b5cd9(0x6d)][_0x2b7b4e]&&(_0x11179e[_0x2b5cd9(0x6d)][_0x2b7b4e]={'total':0x0,'codes':{}}),_0x11179e[_0x2b5cd9(0x6d)][_0x2b7b4e][_0x2b5cd9(0xb1)]++,_0x11179e[_0x2b5cd9(0x6d)][_0x2b7b4e][_0x2b5cd9(0x94)][_0x507f78[_0x2b5cd9(0x9d)]]=(_0x11179e[_0x2b5cd9(0x6d)][_0x2b7b4e][_0x2b5cd9(0x94)][_0x507f78[_0x2b5cd9(0x9d)]]||0x0)+0x1;}),{'rps':_0x4770dd,'httpCodes':_0x11179e,'ressourcesUsageStats':RequestMonitor[_0x3b46e3(0xaa)]};}}function a1_0x5dc2(_0x2241ea,_0x5c10bf){const _0x510444=a1_0x5104();return a1_0x5dc2=function(_0x5dc270,_0x48880d){_0x5dc270=_0x5dc270-0x6c;let _0x266ca1=_0x510444[_0x5dc270];return _0x266ca1;},a1_0x5dc2(_0x2241ea,_0x5c10bf);}RequestMonitor[a1_0x32b4d2(0xb0)]()['then'](()=>{}),RequestMonitor[a1_0x32b4d2(0xab)]();const counter=RequestMonitor;module[a1_0x32b4d2(0x99)]=counter;