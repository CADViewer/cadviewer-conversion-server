const a1_0xab45c7=a1_0x2232;(function(_0x325718,_0x5143ab){const _0x5c9c8f=a1_0x2232,_0x37dc3e=_0x325718();while(!![]){try{const _0x5cff5f=-parseInt(_0x5c9c8f(0x138))/0x1*(parseInt(_0x5c9c8f(0x149))/0x2)+parseInt(_0x5c9c8f(0x153))/0x3+-parseInt(_0x5c9c8f(0x125))/0x4+parseInt(_0x5c9c8f(0x129))/0x5*(-parseInt(_0x5c9c8f(0x133))/0x6)+-parseInt(_0x5c9c8f(0x155))/0x7*(-parseInt(_0x5c9c8f(0x156))/0x8)+-parseInt(_0x5c9c8f(0x130))/0x9*(-parseInt(_0x5c9c8f(0x140))/0xa)+-parseInt(_0x5c9c8f(0x13c))/0xb*(-parseInt(_0x5c9c8f(0x166))/0xc);if(_0x5cff5f===_0x5143ab)break;else _0x37dc3e['push'](_0x37dc3e['shift']());}catch(_0x195b5e){_0x37dc3e['push'](_0x37dc3e['shift']());}}}(a1_0x996c,0x8bcb6));function a1_0x2232(_0x2001fd,_0x10342d){const _0x996c1a=a1_0x996c();return a1_0x2232=function(_0x2232ae,_0x4b9958){_0x2232ae=_0x2232ae-0x11d;let _0x376ab9=_0x996c1a[_0x2232ae];return _0x376ab9;},a1_0x2232(_0x2001fd,_0x10342d);}const fs=require('fs')[a1_0xab45c7(0x121)],osu=require(a1_0xab45c7(0x13a));class RequestMonitor{static [a1_0xab45c7(0x12b)]=a1_0xab45c7(0x12c);static [a1_0xab45c7(0x165)]='cadviewer/settings/http-codes-24h.json';static ['ressourcesUsageStatsPath']='cadviewer/settings/ressources-usage-stats.json';static ['rpsData']=[];static ['httpCodesData']=[];static ['ressourcesUsageStats']={};static [a1_0xab45c7(0x15e)]=Math['floor'](Date[a1_0xab45c7(0x15d)]()/0x3e8/0x3c);static ['currentRequests']=0x0;static async[a1_0xab45c7(0x11e)](){const _0x31c4ea=a1_0xab45c7;console[_0x31c4ea(0x15c)](_0x31c4ea(0x14d));try{const _0x2ef1c8=await fs[_0x31c4ea(0x15b)](RequestMonitor['rpsStoragePath'],'utf8');RequestMonitor[_0x31c4ea(0x137)]=JSON[_0x31c4ea(0x160)](_0x2ef1c8);}catch(_0x592e1b){RequestMonitor[_0x31c4ea(0x137)]=[];}try{const _0x49eee7=await fs[_0x31c4ea(0x15b)](RequestMonitor['httpCodesStoragePath'],_0x31c4ea(0x163));RequestMonitor[_0x31c4ea(0x132)]=JSON[_0x31c4ea(0x160)](_0x49eee7);}catch(_0x528045){RequestMonitor['httpCodesData']=[];}try{const _0x50e4a7=await fs[_0x31c4ea(0x15b)](RequestMonitor[_0x31c4ea(0x136)],'utf8');RequestMonitor[_0x31c4ea(0x150)]=JSON[_0x31c4ea(0x160)](_0x50e4a7),!RequestMonitor[_0x31c4ea(0x150)][_0x31c4ea(0x13b)]&&(RequestMonitor[_0x31c4ea(0x150)][_0x31c4ea(0x13b)]=[]),!RequestMonitor[_0x31c4ea(0x150)][_0x31c4ea(0x14f)]&&(RequestMonitor[_0x31c4ea(0x150)][_0x31c4ea(0x14f)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x31c4ea(0x157)]&&(RequestMonitor[_0x31c4ea(0x150)][_0x31c4ea(0x157)]=[]);}catch(_0x430460){RequestMonitor[_0x31c4ea(0x150)]={'cpu':[],'memory':[],'network':[]};}console[_0x31c4ea(0x15c)]('Request\x20monitor\x20initialized.');}static[a1_0xab45c7(0x146)](_0x165bf,_0x98ad6a,_0x21adf1){const _0x3bad8a=a1_0xab45c7;if(_0x165bf['path'][_0x3bad8a(0x158)]('/metrics'))return _0x21adf1();console[_0x3bad8a(0x15c)](_0x3bad8a(0x134));let _0x78fef2=Date['now'](),_0x15b9bc=Math[_0x3bad8a(0x122)](_0x78fef2/0x3e8/0x3c);console[_0x3bad8a(0x15c)](_0x3bad8a(0x14c));const _0x2edda5=_0x98ad6a[_0x3bad8a(0x14a)];_0x98ad6a['end']=(..._0x3e21d2)=>{const _0x577709=_0x3bad8a;console['log'](_0x15b9bc,{'currentMinute':_0x15b9bc});_0x15b9bc>RequestMonitor['lastMinute']&&(RequestMonitor[_0x577709(0x137)]['push']({'timestamp':RequestMonitor[_0x577709(0x15e)]*0x3e8*0x3c,'requests':RequestMonitor[_0x577709(0x12a)]}),RequestMonitor[_0x577709(0x12a)]=0x0,RequestMonitor[_0x577709(0x15e)]=_0x15b9bc);RequestMonitor[_0x577709(0x12a)]++,RequestMonitor[_0x577709(0x132)][_0x577709(0x154)]({'timestamp':Date[_0x577709(0x15d)](),'statusCode':_0x98ad6a['statusCode'],'path':_0x165bf[_0x577709(0x164)],'method':_0x165bf[_0x577709(0x147)]});const _0x1858e7=Date[_0x577709(0x15d)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x577709(0x132)]=RequestMonitor['httpCodesData'][_0x577709(0x124)](_0x9bdd51=>_0x9bdd51[_0x577709(0x12e)]>_0x1858e7),_0x2edda5[_0x577709(0x11d)](_0x98ad6a,_0x3e21d2);},_0x21adf1();}static async[a1_0xab45c7(0x120)](){const _0x4045c9=a1_0xab45c7;try{RequestMonitor[_0x4045c9(0x15e)]!==Math[_0x4045c9(0x122)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor['rpsData']['push']({'timestamp':RequestMonitor[_0x4045c9(0x15e)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x4045c9(0x12a)]=0x0,RequestMonitor[_0x4045c9(0x15e)]=Math[_0x4045c9(0x122)](Date['now']()/0x3e8/0x3c)),await fs['writeFile'](RequestMonitor[_0x4045c9(0x12b)],JSON[_0x4045c9(0x148)](RequestMonitor['rpsData'],null,0x2)),await fs[_0x4045c9(0x162)](RequestMonitor[_0x4045c9(0x165)],JSON[_0x4045c9(0x148)](RequestMonitor[_0x4045c9(0x132)],null,0x2));}catch(_0x332427){console[_0x4045c9(0x142)](_0x4045c9(0x144),_0x332427);}}static async['startPeriodicSave'](){const _0x382bd1=a1_0xab45c7;setInterval(()=>RequestMonitor[_0x382bd1(0x120)](),0x3c*0x3e8),setInterval(()=>{const _0xbc0d22=_0x382bd1;RequestMonitor['getUsageRessourcesStatsAndSave']()[_0xbc0d22(0x127)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x382bd1(0x12d)]()[_0x382bd1(0x127)](()=>{});}static async[a1_0xab45c7(0x12d)](){const _0x5b6fb1=a1_0xab45c7,_0x261fb0=osu[_0x5b6fb1(0x13b)],_0x102842=osu['mem'],_0x1c409d=osu[_0x5b6fb1(0x126)],_0x54a0c4={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x981e09=await _0x1c409d['inOut']();_0x54a0c4[_0x5b6fb1(0x13d)][_0x5b6fb1(0x159)]=_0x981e09[_0x5b6fb1(0x13d)][_0x5b6fb1(0x159)],_0x54a0c4['total'][_0x5b6fb1(0x13f)]=_0x981e09[_0x5b6fb1(0x13d)][_0x5b6fb1(0x13f)];}catch(_0x22b916){}let _0xddda44=0x0;try{_0xddda44=await _0x261fb0['usage']();}catch(_0xf48a3e){console[_0x5b6fb1(0x15c)](_0x5b6fb1(0x151),_0xf48a3e);}const _0x1763d1={'usedMemMb':0x0};try{const _0x3fa8a1=await _0x102842['info']();_0x1763d1[_0x5b6fb1(0x14e)]=_0x3fa8a1['usedMemMb'];}catch(_0x5c3b2d){console[_0x5b6fb1(0x15c)](_0x5b6fb1(0x11f),_0x5c3b2d);}const _0xe8cff1=new Date()[_0x5b6fb1(0x13e)]()[_0x5b6fb1(0x131)]()[_0x5b6fb1(0x12f)](0x2,'0')+':'+new Date()[_0x5b6fb1(0x143)]()[_0x5b6fb1(0x131)]()['padStart'](0x2,'0');RequestMonitor[_0x5b6fb1(0x150)][_0x5b6fb1(0x13b)]=RequestMonitor[_0x5b6fb1(0x150)][_0x5b6fb1(0x13b)]['slice'](-0x3c)[_0x5b6fb1(0x124)](_0x3238b9=>_0x3238b9[_0x5b6fb1(0x141)]!==_0xe8cff1),RequestMonitor[_0x5b6fb1(0x150)][_0x5b6fb1(0x14f)]=RequestMonitor[_0x5b6fb1(0x150)][_0x5b6fb1(0x14f)][_0x5b6fb1(0x161)](-0x3c)[_0x5b6fb1(0x124)](_0x141e54=>_0x141e54[_0x5b6fb1(0x141)]!==_0xe8cff1),RequestMonitor[_0x5b6fb1(0x150)]['network']=RequestMonitor[_0x5b6fb1(0x150)]['network'][_0x5b6fb1(0x161)](-0x3c)[_0x5b6fb1(0x124)](_0x52994b=>_0x52994b[_0x5b6fb1(0x141)]!==_0xe8cff1),RequestMonitor['ressourcesUsageStats']['cpu']['push']({'time':_0xe8cff1,'usage':_0xddda44}),RequestMonitor[_0x5b6fb1(0x150)][_0x5b6fb1(0x14f)][_0x5b6fb1(0x154)]({'time':_0xe8cff1,'usage':(_0x1763d1[_0x5b6fb1(0x14e)]/0x3e8)[_0x5b6fb1(0x15a)](0x2)}),RequestMonitor[_0x5b6fb1(0x150)]['network'][_0x5b6fb1(0x154)]({'time':_0xe8cff1,'usage':{'in':_0x54a0c4['total']?.[_0x5b6fb1(0x159)]??0x0,'out':_0x54a0c4[_0x5b6fb1(0x13d)]?.[_0x5b6fb1(0x13f)]??0x0}});try{await fs['writeFile'](RequestMonitor[_0x5b6fb1(0x136)],JSON[_0x5b6fb1(0x148)](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x378247){console[_0x5b6fb1(0x142)](_0x5b6fb1(0x144),_0x378247);}}static[a1_0xab45c7(0x135)](){const _0xb92f6=a1_0xab45c7,_0x3e07a8=Date['now'](),_0x2c74b7=_0x3e07a8-0x3c*0x3c*0x3e8,_0x3e1f78=_0x3e07a8-0x18*0x3c*0x3c*0x3e8,_0x30dc27=RequestMonitor[_0xb92f6(0x137)][_0xb92f6(0x124)](_0x35e88b=>_0x35e88b['timestamp']>_0x2c74b7),_0x3197f1={'total':RequestMonitor[_0xb92f6(0x132)]['length'],'byCodes':{},'byPath':{}};return RequestMonitor[_0xb92f6(0x132)][_0xb92f6(0x14b)](_0xa7038=>{const _0x915a25=_0xb92f6;_0x3197f1['byCodes'][_0xa7038[_0x915a25(0x152)]]=(_0x3197f1[_0x915a25(0x123)][_0xa7038[_0x915a25(0x152)]]||0x0)+0x1;const _0x2880a6=_0xa7038['method']+'\x20'+_0xa7038[_0x915a25(0x164)];!_0x3197f1[_0x915a25(0x15f)][_0x2880a6]&&(_0x3197f1[_0x915a25(0x15f)][_0x2880a6]={'total':0x0,'codes':{}}),_0x3197f1[_0x915a25(0x15f)][_0x2880a6][_0x915a25(0x13d)]++,_0x3197f1[_0x915a25(0x15f)][_0x2880a6][_0x915a25(0x128)][_0xa7038['statusCode']]=(_0x3197f1[_0x915a25(0x15f)][_0x2880a6][_0x915a25(0x128)][_0xa7038[_0x915a25(0x152)]]||0x0)+0x1;}),{'rps':_0x30dc27,'httpCodes':_0x3197f1,'ressourcesUsageStats':RequestMonitor[_0xb92f6(0x150)]};}}RequestMonitor[a1_0xab45c7(0x11e)]()['then'](()=>{}),RequestMonitor[a1_0xab45c7(0x145)]();function a1_0x996c(){const _0x49c714=['inputMb','toFixed','readFile','log','now','lastMinute','byPath','parse','slice','writeFile','utf8','path','httpCodesStoragePath','621732JMDYWq','apply','init','Error\x20getting\x20memory\x20usage:','save','promises','floor','byCodes','filter','896664QUmrlC','netstat','then','codes','170Svwxbw','currentRequests','rpsStoragePath','cadviewer/settings/requests-per-minute.json','getUsageRessourcesStatsAndSave','timestamp','padStart','9cDgXKY','toString','httpCodesData','12318plECxG','Request\x20monitor\x20middleware','getStats','ressourcesUsageStatsPath','rpsData','371981NmjLWV','exports','node-os-utils','cpu','88akAiHQ','total','getHours','outputMb','4888770ROfsVg','time','error','getMinutes','Error\x20saving\x20monitoring\x20data:','startPeriodicSave','middleware','method','stringify','2EeWnYx','end','forEach','=======>','Initializing\x20request\x20monitor...','usedMemMb','memory','ressourcesUsageStats','Error\x20getting\x20CPU\x20usage:','statusCode','569343ejoJPC','push','59871MohIie','136AHeLBm','network','includes'];a1_0x996c=function(){return _0x49c714;};return a1_0x996c();}const counter=RequestMonitor;module[a1_0xab45c7(0x139)]=counter;