const a1_0x59713f=a1_0x4569;(function(_0x5002c7,_0x49c680){const _0x135917=a1_0x4569,_0x3ffb58=_0x5002c7();while(!![]){try{const _0x5147a8=-parseInt(_0x135917(0x1be))/0x1+-parseInt(_0x135917(0x1a3))/0x2*(parseInt(_0x135917(0x1db))/0x3)+parseInt(_0x135917(0x1df))/0x4*(-parseInt(_0x135917(0x1d6))/0x5)+parseInt(_0x135917(0x19e))/0x6+parseInt(_0x135917(0x1bf))/0x7+-parseInt(_0x135917(0x1cf))/0x8*(parseInt(_0x135917(0x1b0))/0x9)+-parseInt(_0x135917(0x1dc))/0xa*(-parseInt(_0x135917(0x1c1))/0xb);if(_0x5147a8===_0x49c680)break;else _0x3ffb58['push'](_0x3ffb58['shift']());}catch(_0x577b15){_0x3ffb58['push'](_0x3ffb58['shift']());}}}(a1_0x39c7,0x988d1));function a1_0x39c7(){const _0x3e0d23=['floor','memory','byCodes','exports','forEach','40InsSkD','outputMb','ressourcesUsageStats','getStats','save','60MUesCD','4110BpQhvA','total','promises','618112PFsjnQ','cadviewer/settings/requests-per-minute.json','stringify','=======>','length','push','statusCode','getHours','currentRequests','parse','4275792aNYmqU','mem','codes','cpu','Request\x20monitor\x20middleware','14610ujGfhM','includes','error','rpsData','getMinutes','log','httpCodesData','Request\x20monitor\x20initialized.','netstat','usage','network','now','node-os-utils','72cglsoz','Initializing\x20request\x20monitor...','getUsageRessourcesStatsAndSave','cadviewer/settings/http-codes-24h.json','Error\x20saving\x20monitoring\x20data:','writeFile','slice','inOut','rpsStoragePath','filter','httpCodesStoragePath','byPath','middleware','then','162871jLdvjz','6690439UWpPtw','startPeriodicSave','43307WIqwzQ','cadviewer/settings/ressources-usage-stats.json','method','ressourcesUsageStatsPath','usedMemMb','toString','path','readFile','utf8','inputMb','apply','time','end','init','1116472QAFLkZ','lastMinute'];a1_0x39c7=function(){return _0x3e0d23;};return a1_0x39c7();}const fs=require('fs')[a1_0x59713f(0x1de)],osu=require(a1_0x59713f(0x1af));function a1_0x4569(_0x523a6c,_0x42df67){const _0x39c733=a1_0x39c7();return a1_0x4569=function(_0x45694,_0x3a8ea8){_0x45694=_0x45694-0x196;let _0x4d291c=_0x39c733[_0x45694];return _0x4d291c;},a1_0x4569(_0x523a6c,_0x42df67);}class RequestMonitor{static [a1_0x59713f(0x1b8)]=a1_0x59713f(0x1e0);static ['httpCodesStoragePath']=a1_0x59713f(0x1b3);static [a1_0x59713f(0x1c4)]=a1_0x59713f(0x1c2);static ['rpsData']=[];static [a1_0x59713f(0x1a9)]=[];static [a1_0x59713f(0x1d8)]={};static [a1_0x59713f(0x1d0)]=Math[a1_0x59713f(0x1d1)](Date[a1_0x59713f(0x1ae)]()/0x3e8/0x3c);static ['currentRequests']=0x0;static async['init'](){const _0x5d406d=a1_0x59713f;console['log'](_0x5d406d(0x1b1));try{const _0x5c8280=await fs[_0x5d406d(0x1c8)](RequestMonitor[_0x5d406d(0x1b8)],_0x5d406d(0x1c9));RequestMonitor['rpsData']=JSON[_0x5d406d(0x19d)](_0x5c8280);}catch(_0x557173){RequestMonitor[_0x5d406d(0x1a6)]=[];}try{const _0x2e4f29=await fs['readFile'](RequestMonitor[_0x5d406d(0x1ba)],_0x5d406d(0x1c9));RequestMonitor['httpCodesData']=JSON['parse'](_0x2e4f29);}catch(_0x4d524d){RequestMonitor['httpCodesData']=[];}try{const _0x299a65=await fs[_0x5d406d(0x1c8)](RequestMonitor['ressourcesUsageStatsPath'],_0x5d406d(0x1c9));RequestMonitor['ressourcesUsageStats']=JSON[_0x5d406d(0x19d)](_0x299a65),!RequestMonitor[_0x5d406d(0x1d8)][_0x5d406d(0x1a1)]&&(RequestMonitor['ressourcesUsageStats'][_0x5d406d(0x1a1)]=[]),!RequestMonitor[_0x5d406d(0x1d8)][_0x5d406d(0x1d2)]&&(RequestMonitor['ressourcesUsageStats'][_0x5d406d(0x1d2)]=[]),!RequestMonitor['ressourcesUsageStats']['network']&&(RequestMonitor[_0x5d406d(0x1d8)][_0x5d406d(0x1ad)]=[]);}catch(_0x2aa4fa){RequestMonitor[_0x5d406d(0x1d8)]={'cpu':[],'memory':[],'network':[]};}console[_0x5d406d(0x1a8)](_0x5d406d(0x1aa));}static[a1_0x59713f(0x1bc)](_0x1c7bee,_0x83c1de,_0x45fa07){const _0x5003f5=a1_0x59713f;if(_0x1c7bee[_0x5003f5(0x1c7)][_0x5003f5(0x1a4)]('/metrics'))return _0x45fa07();console[_0x5003f5(0x1a8)](_0x5003f5(0x1a2));let _0xc98a09=Date[_0x5003f5(0x1ae)](),_0x4dd7af=Math[_0x5003f5(0x1d1)](_0xc98a09/0x3e8/0x3c);console[_0x5003f5(0x1a8)](_0x5003f5(0x197));const _0x523828=_0x83c1de['end'];_0x83c1de[_0x5003f5(0x1cd)]=(..._0x3e54c8)=>{const _0x4e3f8f=_0x5003f5;console[_0x4e3f8f(0x1a8)](_0x4dd7af,{'currentMinute':_0x4dd7af});_0x4dd7af>RequestMonitor['lastMinute']&&(RequestMonitor[_0x4e3f8f(0x1a6)][_0x4e3f8f(0x199)]({'timestamp':RequestMonitor[_0x4e3f8f(0x1d0)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x4e3f8f(0x19c)]=0x0,RequestMonitor[_0x4e3f8f(0x1d0)]=_0x4dd7af);RequestMonitor['currentRequests']++,RequestMonitor[_0x4e3f8f(0x1a9)]['push']({'timestamp':Date['now'](),'statusCode':_0x83c1de[_0x4e3f8f(0x19a)],'path':_0x1c7bee[_0x4e3f8f(0x1c7)],'method':_0x1c7bee['method']});const _0x4a925d=Date[_0x4e3f8f(0x1ae)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x4e3f8f(0x1a9)]=RequestMonitor['httpCodesData'][_0x4e3f8f(0x1b9)](_0x1d8bbb=>_0x1d8bbb['timestamp']>_0x4a925d),_0x523828[_0x4e3f8f(0x1cb)](_0x83c1de,_0x3e54c8);},_0x45fa07();}static async[a1_0x59713f(0x1da)](){const _0x165655=a1_0x59713f;try{RequestMonitor[_0x165655(0x1d0)]!==Math[_0x165655(0x1d1)](Date[_0x165655(0x1ae)]()/0x3e8/0x3c)&&(RequestMonitor['rpsData']['push']({'timestamp':RequestMonitor[_0x165655(0x1d0)]*0x3e8*0x3c,'requests':RequestMonitor[_0x165655(0x19c)]}),RequestMonitor[_0x165655(0x19c)]=0x0,RequestMonitor[_0x165655(0x1d0)]=Math['floor'](Date[_0x165655(0x1ae)]()/0x3e8/0x3c)),await fs[_0x165655(0x1b5)](RequestMonitor[_0x165655(0x1b8)],JSON[_0x165655(0x196)](RequestMonitor[_0x165655(0x1a6)],null,0x2)),await fs[_0x165655(0x1b5)](RequestMonitor[_0x165655(0x1ba)],JSON['stringify'](RequestMonitor[_0x165655(0x1a9)],null,0x2));}catch(_0x4f8865){console[_0x165655(0x1a5)](_0x165655(0x1b4),_0x4f8865);}}static async[a1_0x59713f(0x1c0)](){const _0x5614d0=a1_0x59713f;setInterval(()=>RequestMonitor[_0x5614d0(0x1da)](),0x3c*0x3e8),setInterval(()=>{const _0x4f869a=_0x5614d0;RequestMonitor[_0x4f869a(0x1b2)]()[_0x4f869a(0x1bd)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x5614d0(0x1b2)]()[_0x5614d0(0x1bd)](()=>{});}static async[a1_0x59713f(0x1b2)](){const _0xe8652d=a1_0x59713f,_0x5d8e2c=osu[_0xe8652d(0x1a1)],_0xbd9fba=osu[_0xe8652d(0x19f)],_0x3a351f=osu[_0xe8652d(0x1ab)],_0x4dd3f6={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x39aeae=await _0x3a351f[_0xe8652d(0x1b7)]();_0x4dd3f6['total']['inputMb']=_0x39aeae[_0xe8652d(0x1dd)][_0xe8652d(0x1ca)],_0x4dd3f6[_0xe8652d(0x1dd)]['outputMb']=_0x39aeae[_0xe8652d(0x1dd)][_0xe8652d(0x1d7)];}catch(_0x3731a6){}let _0x14e475=0x0;try{_0x14e475=await _0x5d8e2c[_0xe8652d(0x1ac)]();}catch(_0x424dc6){console[_0xe8652d(0x1a8)]('Error\x20getting\x20CPU\x20usage:',_0x424dc6);}const _0x569469={'usedMemMb':0x0};try{const _0x97ba96=await _0xbd9fba['info']();_0x569469['usedMemMb']=_0x97ba96['usedMemMb'];}catch(_0x580539){console[_0xe8652d(0x1a8)]('Error\x20getting\x20memory\x20usage:',_0x580539);}const _0x2310bf=new Date()[_0xe8652d(0x19b)]()['toString']()['padStart'](0x2,'0')+':'+new Date()[_0xe8652d(0x1a7)]()[_0xe8652d(0x1c6)]()['padStart'](0x2,'0');RequestMonitor[_0xe8652d(0x1d8)][_0xe8652d(0x1a1)]=RequestMonitor[_0xe8652d(0x1d8)]['cpu']['slice'](-0x3c)['filter'](_0x132847=>_0x132847[_0xe8652d(0x1cc)]!==_0x2310bf),RequestMonitor[_0xe8652d(0x1d8)][_0xe8652d(0x1d2)]=RequestMonitor[_0xe8652d(0x1d8)][_0xe8652d(0x1d2)][_0xe8652d(0x1b6)](-0x3c)[_0xe8652d(0x1b9)](_0x412c03=>_0x412c03[_0xe8652d(0x1cc)]!==_0x2310bf),RequestMonitor[_0xe8652d(0x1d8)][_0xe8652d(0x1ad)]=RequestMonitor[_0xe8652d(0x1d8)]['network'][_0xe8652d(0x1b6)](-0x3c)[_0xe8652d(0x1b9)](_0x1d8104=>_0x1d8104[_0xe8652d(0x1cc)]!==_0x2310bf),RequestMonitor[_0xe8652d(0x1d8)][_0xe8652d(0x1a1)][_0xe8652d(0x199)]({'time':_0x2310bf,'usage':_0x14e475}),RequestMonitor[_0xe8652d(0x1d8)][_0xe8652d(0x1d2)][_0xe8652d(0x199)]({'time':_0x2310bf,'usage':(_0x569469[_0xe8652d(0x1c5)]/0x3e8)['toFixed'](0x2)}),RequestMonitor['ressourcesUsageStats'][_0xe8652d(0x1ad)][_0xe8652d(0x199)]({'time':_0x2310bf,'usage':{'in':_0x4dd3f6[_0xe8652d(0x1dd)]?.[_0xe8652d(0x1ca)]??0x0,'out':_0x4dd3f6[_0xe8652d(0x1dd)]?.['outputMb']??0x0}});try{await fs['writeFile'](RequestMonitor['ressourcesUsageStatsPath'],JSON[_0xe8652d(0x196)](RequestMonitor[_0xe8652d(0x1d8)],null,0x2));}catch(_0x16503b){console[_0xe8652d(0x1a5)](_0xe8652d(0x1b4),_0x16503b);}}static[a1_0x59713f(0x1d9)](){const _0x1d2e2f=a1_0x59713f,_0x52d56d=Date[_0x1d2e2f(0x1ae)](),_0x1412a5=_0x52d56d-0x3c*0x3c*0x3e8,_0x3fe016=_0x52d56d-0x18*0x3c*0x3c*0x3e8,_0xac9ecd=RequestMonitor[_0x1d2e2f(0x1a6)]['filter'](_0x43c8d5=>_0x43c8d5['timestamp']>_0x1412a5),_0xddd6d1={'total':RequestMonitor[_0x1d2e2f(0x1a9)][_0x1d2e2f(0x198)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x1d2e2f(0x1a9)][_0x1d2e2f(0x1d5)](_0x490610=>{const _0x4e9bea=_0x1d2e2f;_0xddd6d1[_0x4e9bea(0x1d3)][_0x490610[_0x4e9bea(0x19a)]]=(_0xddd6d1[_0x4e9bea(0x1d3)][_0x490610[_0x4e9bea(0x19a)]]||0x0)+0x1;const _0x5b46f7=_0x490610[_0x4e9bea(0x1c3)]+'\x20'+_0x490610[_0x4e9bea(0x1c7)];!_0xddd6d1['byPath'][_0x5b46f7]&&(_0xddd6d1[_0x4e9bea(0x1bb)][_0x5b46f7]={'total':0x0,'codes':{}}),_0xddd6d1[_0x4e9bea(0x1bb)][_0x5b46f7][_0x4e9bea(0x1dd)]++,_0xddd6d1[_0x4e9bea(0x1bb)][_0x5b46f7][_0x4e9bea(0x1a0)][_0x490610[_0x4e9bea(0x19a)]]=(_0xddd6d1[_0x4e9bea(0x1bb)][_0x5b46f7][_0x4e9bea(0x1a0)][_0x490610['statusCode']]||0x0)+0x1;}),{'rps':_0xac9ecd,'httpCodes':_0xddd6d1,'ressourcesUsageStats':RequestMonitor['ressourcesUsageStats']};}}RequestMonitor[a1_0x59713f(0x1ce)]()['then'](()=>{}),RequestMonitor[a1_0x59713f(0x1c0)]();const counter=RequestMonitor;module[a1_0x59713f(0x1d4)]=counter;