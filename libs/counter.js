const a1_0x213892=a1_0x7e76;(function(_0x1e085d,_0x1b9a43){const _0x4fa876=a1_0x7e76,_0x37bc5a=_0x1e085d();while(!![]){try{const _0x6cf990=-parseInt(_0x4fa876(0x13c))/0x1+-parseInt(_0x4fa876(0x140))/0x2+-parseInt(_0x4fa876(0x137))/0x3*(parseInt(_0x4fa876(0x173))/0x4)+parseInt(_0x4fa876(0x171))/0x5+parseInt(_0x4fa876(0x14a))/0x6+parseInt(_0x4fa876(0x149))/0x7*(parseInt(_0x4fa876(0x169))/0x8)+parseInt(_0x4fa876(0x15d))/0x9;if(_0x6cf990===_0x1b9a43)break;else _0x37bc5a['push'](_0x37bc5a['shift']());}catch(_0xd39158){_0x37bc5a['push'](_0x37bc5a['shift']());}}}(a1_0x389f,0xbe8e3));const fs=require('fs')[a1_0x213892(0x131)],osu=require(a1_0x213892(0x15e));class RequestMonitor{static [a1_0x213892(0x130)]='cadviewer/settings/requests-per-minute.json';static ['httpCodesStoragePath']=a1_0x213892(0x136);static [a1_0x213892(0x143)]=a1_0x213892(0x14d);static [a1_0x213892(0x160)]=[];static [a1_0x213892(0x15a)]=[];static ['ressourcesUsageStats']={};static [a1_0x213892(0x179)]=Math[a1_0x213892(0x14b)](Date[a1_0x213892(0x16d)]()/0x3e8/0x3c);static ['currentRequests']=0x0;static async[a1_0x213892(0x174)](){const _0x12a193=a1_0x213892;console['log'](_0x12a193(0x14e));try{const _0x5a0c60=await fs[_0x12a193(0x13b)](RequestMonitor[_0x12a193(0x130)],_0x12a193(0x16c));RequestMonitor[_0x12a193(0x160)]=JSON[_0x12a193(0x150)](_0x5a0c60);}catch(_0x3ac641){RequestMonitor['rpsData']=[];}try{const _0x2f6f74=await fs['readFile'](RequestMonitor[_0x12a193(0x138)],_0x12a193(0x16c));RequestMonitor[_0x12a193(0x15a)]=JSON['parse'](_0x2f6f74);}catch(_0x252efa){RequestMonitor[_0x12a193(0x15a)]=[];}try{const _0x17e10e=await fs['readFile'](RequestMonitor[_0x12a193(0x143)],_0x12a193(0x16c));RequestMonitor[_0x12a193(0x176)]=JSON[_0x12a193(0x150)](_0x17e10e),!RequestMonitor[_0x12a193(0x176)]['cpu']&&(RequestMonitor['ressourcesUsageStats'][_0x12a193(0x156)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x12a193(0x145)]&&(RequestMonitor[_0x12a193(0x176)][_0x12a193(0x145)]=[]),!RequestMonitor[_0x12a193(0x176)][_0x12a193(0x14f)]&&(RequestMonitor[_0x12a193(0x176)][_0x12a193(0x14f)]=[]);}catch(_0x46963f){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console['log'](_0x12a193(0x158));}static[a1_0x213892(0x162)](_0x292a8f,_0x1229bc,_0x46ccc3){const _0x52b1bc=a1_0x213892;if(_0x292a8f[_0x52b1bc(0x170)][_0x52b1bc(0x161)](_0x52b1bc(0x13a)))return _0x46ccc3();console['log'](_0x52b1bc(0x12f));let _0x12dd70=Date[_0x52b1bc(0x16d)](),_0x146993=Math[_0x52b1bc(0x14b)](_0x12dd70/0x3e8/0x3c);console[_0x52b1bc(0x134)](_0x52b1bc(0x177));const _0xfd8088=_0x1229bc['end'];_0x1229bc['end']=(..._0x1eaa36)=>{const _0x2d8b55=_0x52b1bc;console[_0x2d8b55(0x134)](_0x146993,{'currentMinute':_0x146993});_0x146993>RequestMonitor['lastMinute']&&(RequestMonitor[_0x2d8b55(0x160)]['push']({'timestamp':RequestMonitor[_0x2d8b55(0x179)]*0x3e8*0x3c,'requests':RequestMonitor[_0x2d8b55(0x151)]}),RequestMonitor[_0x2d8b55(0x151)]=0x0,RequestMonitor['lastMinute']=_0x146993);RequestMonitor[_0x2d8b55(0x151)]++,RequestMonitor[_0x2d8b55(0x15a)][_0x2d8b55(0x178)]({'timestamp':Date[_0x2d8b55(0x16d)](),'statusCode':_0x1229bc[_0x2d8b55(0x153)],'path':_0x292a8f[_0x2d8b55(0x170)],'method':_0x292a8f['method']});const _0xe505fc=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x2d8b55(0x15a)]=RequestMonitor['httpCodesData'][_0x2d8b55(0x15f)](_0x3a674b=>_0x3a674b[_0x2d8b55(0x13d)]>_0xe505fc),_0xfd8088[_0x2d8b55(0x16b)](_0x1229bc,_0x1eaa36);},_0x46ccc3();}static async[a1_0x213892(0x15b)](){const _0x1b8496=a1_0x213892;try{RequestMonitor[_0x1b8496(0x179)]!==Math[_0x1b8496(0x14b)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x1b8496(0x160)]['push']({'timestamp':RequestMonitor[_0x1b8496(0x179)]*0x3e8*0x3c,'requests':RequestMonitor[_0x1b8496(0x151)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x1b8496(0x179)]=Math['floor'](Date[_0x1b8496(0x16d)]()/0x3e8/0x3c)),await fs[_0x1b8496(0x139)](RequestMonitor[_0x1b8496(0x130)],JSON[_0x1b8496(0x16f)](RequestMonitor[_0x1b8496(0x160)],null,0x2)),await fs[_0x1b8496(0x139)](RequestMonitor[_0x1b8496(0x138)],JSON['stringify'](RequestMonitor[_0x1b8496(0x15a)],null,0x2));}catch(_0x22f3bd){console[_0x1b8496(0x165)](_0x1b8496(0x144),_0x22f3bd);}}static async[a1_0x213892(0x12e)](){const _0x326121=a1_0x213892;setInterval(()=>RequestMonitor[_0x326121(0x15b)](),0x3c*0x3e8),setInterval(()=>{const _0x5a7855=_0x326121;RequestMonitor[_0x5a7855(0x135)]()[_0x5a7855(0x172)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x326121(0x135)]()[_0x326121(0x172)](()=>{});}static async[a1_0x213892(0x135)](){const _0x4b6a07=a1_0x213892,_0x3ae115=osu[_0x4b6a07(0x156)],_0x4cc8b1=osu[_0x4b6a07(0x157)],_0x1cdaa6=osu[_0x4b6a07(0x14c)],_0x17886f={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x5dc264=await _0x1cdaa6['inOut']();_0x17886f[_0x4b6a07(0x148)][_0x4b6a07(0x154)]=_0x5dc264[_0x4b6a07(0x148)]['inputMb'],_0x17886f[_0x4b6a07(0x148)]['outputMb']=_0x5dc264[_0x4b6a07(0x148)][_0x4b6a07(0x132)];}catch(_0x5e24f1){}let _0x156a78=0x0;try{_0x156a78=await _0x3ae115[_0x4b6a07(0x152)]();}catch(_0xaa22f9){console['log'](_0x4b6a07(0x13e),_0xaa22f9);}const _0x48b0a7={'usedMemMb':0x0};try{const _0x4022de=await _0x4cc8b1[_0x4b6a07(0x168)]();_0x48b0a7['usedMemMb']=_0x4022de[_0x4b6a07(0x155)];}catch(_0xc693e2){console[_0x4b6a07(0x134)](_0x4b6a07(0x146),_0xc693e2);}const _0xccd8b0=new Date()[_0x4b6a07(0x159)]()['toString']()[_0x4b6a07(0x167)](0x2,'0')+':'+new Date()[_0x4b6a07(0x15c)]()[_0x4b6a07(0x166)]()['padStart'](0x2,'0');RequestMonitor[_0x4b6a07(0x176)]['cpu']=RequestMonitor[_0x4b6a07(0x176)][_0x4b6a07(0x156)][_0x4b6a07(0x142)](-0x3c)['filter'](_0x51d84c=>_0x51d84c[_0x4b6a07(0x147)]!==_0xccd8b0),RequestMonitor[_0x4b6a07(0x176)][_0x4b6a07(0x145)]=RequestMonitor[_0x4b6a07(0x176)][_0x4b6a07(0x145)][_0x4b6a07(0x142)](-0x3c)[_0x4b6a07(0x15f)](_0x19cf85=>_0x19cf85['time']!==_0xccd8b0),RequestMonitor[_0x4b6a07(0x176)]['network']=RequestMonitor[_0x4b6a07(0x176)][_0x4b6a07(0x14f)][_0x4b6a07(0x142)](-0x3c)[_0x4b6a07(0x15f)](_0x468478=>_0x468478[_0x4b6a07(0x147)]!==_0xccd8b0),RequestMonitor[_0x4b6a07(0x176)][_0x4b6a07(0x156)][_0x4b6a07(0x178)]({'time':_0xccd8b0,'usage':_0x156a78}),RequestMonitor[_0x4b6a07(0x176)][_0x4b6a07(0x145)]['push']({'time':_0xccd8b0,'usage':(_0x48b0a7[_0x4b6a07(0x155)]/0x3e8)['toFixed'](0x2)}),RequestMonitor[_0x4b6a07(0x176)][_0x4b6a07(0x14f)][_0x4b6a07(0x178)]({'time':_0xccd8b0,'usage':{'in':_0x17886f[_0x4b6a07(0x148)]?.[_0x4b6a07(0x154)]??0x0,'out':_0x17886f[_0x4b6a07(0x148)]?.[_0x4b6a07(0x132)]??0x0}});try{await fs['writeFile'](RequestMonitor[_0x4b6a07(0x143)],JSON[_0x4b6a07(0x16f)](RequestMonitor[_0x4b6a07(0x176)],null,0x2));}catch(_0x44c50d){console[_0x4b6a07(0x165)]('Error\x20saving\x20monitoring\x20data:',_0x44c50d);}}static[a1_0x213892(0x16e)](){const _0x34353c=a1_0x213892,_0x2788cc=Date[_0x34353c(0x16d)](),_0x2e92d5=_0x2788cc-0x3c*0x3c*0x3e8,_0x2aae1f=_0x2788cc-0x18*0x3c*0x3c*0x3e8,_0x45c4dc=RequestMonitor['rpsData'][_0x34353c(0x15f)](_0x3e7134=>_0x3e7134[_0x34353c(0x13d)]>_0x2e92d5),_0x118ec4={'total':RequestMonitor[_0x34353c(0x15a)][_0x34353c(0x16a)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x34353c(0x15a)][_0x34353c(0x163)](_0x1b89b8=>{const _0x33747b=_0x34353c;_0x118ec4[_0x33747b(0x164)][_0x1b89b8[_0x33747b(0x153)]]=(_0x118ec4[_0x33747b(0x164)][_0x1b89b8['statusCode']]||0x0)+0x1;const _0x3220c7=_0x1b89b8[_0x33747b(0x133)]+'\x20'+_0x1b89b8[_0x33747b(0x170)];!_0x118ec4[_0x33747b(0x13f)][_0x3220c7]&&(_0x118ec4['byPath'][_0x3220c7]={'total':0x0,'codes':{}}),_0x118ec4[_0x33747b(0x13f)][_0x3220c7][_0x33747b(0x148)]++,_0x118ec4[_0x33747b(0x13f)][_0x3220c7][_0x33747b(0x175)][_0x1b89b8[_0x33747b(0x153)]]=(_0x118ec4[_0x33747b(0x13f)][_0x3220c7]['codes'][_0x1b89b8[_0x33747b(0x153)]]||0x0)+0x1;}),{'rps':_0x45c4dc,'httpCodes':_0x118ec4,'ressourcesUsageStats':RequestMonitor[_0x34353c(0x176)]};}}function a1_0x7e76(_0x5a2c05,_0x4d2d53){const _0x389f3a=a1_0x389f();return a1_0x7e76=function(_0x7e76e0,_0x10e61a){_0x7e76e0=_0x7e76e0-0x12e;let _0x596b9c=_0x389f3a[_0x7e76e0];return _0x596b9c;},a1_0x7e76(_0x5a2c05,_0x4d2d53);}RequestMonitor[a1_0x213892(0x174)]()[a1_0x213892(0x172)](()=>{}),RequestMonitor[a1_0x213892(0x12e)]();const counter=RequestMonitor;function a1_0x389f(){const _0x56515c=['codes','ressourcesUsageStats','=======>','push','lastMinute','startPeriodicSave','Request\x20monitor\x20middleware','rpsStoragePath','promises','outputMb','method','log','getUsageRessourcesStatsAndSave','cadviewer/settings/http-codes-24h.json','100632kqJTKi','httpCodesStoragePath','writeFile','/metrics','readFile','1360702vGDgpx','timestamp','Error\x20getting\x20CPU\x20usage:','byPath','2714940rVCsgg','exports','slice','ressourcesUsageStatsPath','Error\x20saving\x20monitoring\x20data:','memory','Error\x20getting\x20memory\x20usage:','time','total','806127VeSyOy','4767006mipSry','floor','netstat','cadviewer/settings/ressources-usage-stats.json','Initializing\x20request\x20monitor...','network','parse','currentRequests','usage','statusCode','inputMb','usedMemMb','cpu','mem','Request\x20monitor\x20initialized.','getHours','httpCodesData','save','getMinutes','28001205UlyHAa','node-os-utils','filter','rpsData','includes','middleware','forEach','byCodes','error','toString','padStart','info','72RAkRgY','length','apply','utf8','now','getStats','stringify','path','497580sPZNYR','then','184HPTEXY','init'];a1_0x389f=function(){return _0x56515c;};return a1_0x389f();}module[a1_0x213892(0x141)]=counter;