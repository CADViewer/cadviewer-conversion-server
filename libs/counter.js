const a1_0x5acff3=a1_0x2691;(function(_0x28e7b1,_0x4c330e){const _0x1064ad=a1_0x2691,_0x17cee9=_0x28e7b1();while(!![]){try{const _0x58c616=parseInt(_0x1064ad(0xb6))/0x1*(parseInt(_0x1064ad(0x90))/0x2)+-parseInt(_0x1064ad(0xc6))/0x3+parseInt(_0x1064ad(0xcf))/0x4+-parseInt(_0x1064ad(0x99))/0x5+-parseInt(_0x1064ad(0xa6))/0x6+-parseInt(_0x1064ad(0xad))/0x7+parseInt(_0x1064ad(0xbc))/0x8;if(_0x58c616===_0x4c330e)break;else _0x17cee9['push'](_0x17cee9['shift']());}catch(_0x8de4ce){_0x17cee9['push'](_0x17cee9['shift']());}}}(a1_0x5127,0x667e9));const fs=require('fs')[a1_0x5acff3(0xc7)],osu=require(a1_0x5acff3(0xc0));function a1_0x2691(_0x483b97,_0x4d58f4){const _0x512701=a1_0x5127();return a1_0x2691=function(_0x2691bf,_0x97bb8a){_0x2691bf=_0x2691bf-0x8b;let _0x3b2d28=_0x512701[_0x2691bf];return _0x3b2d28;},a1_0x2691(_0x483b97,_0x4d58f4);}class RequestMonitor{static [a1_0x5acff3(0x9e)]=a1_0x5acff3(0xa1);static ['httpCodesStoragePath']=a1_0x5acff3(0xc1);static [a1_0x5acff3(0xce)]='cadviewer/settings/ressources-usage-stats.json';static [a1_0x5acff3(0x98)]=[];static [a1_0x5acff3(0xba)]=[];static [a1_0x5acff3(0xb2)]={};static ['lastMinute']=Math[a1_0x5acff3(0xaf)](Date[a1_0x5acff3(0x97)]()/0x3e8/0x3c);static [a1_0x5acff3(0xbd)]=0x0;static async[a1_0x5acff3(0xc5)](){const _0x2eeed5=a1_0x5acff3;console[_0x2eeed5(0x9b)](_0x2eeed5(0x9d));try{const _0x3d7426=await fs[_0x2eeed5(0x96)](RequestMonitor['rpsStoragePath'],'utf8');RequestMonitor[_0x2eeed5(0x98)]=JSON[_0x2eeed5(0x93)](_0x3d7426);}catch(_0x26c732){RequestMonitor['rpsData']=[];}try{const _0x4209de=await fs[_0x2eeed5(0x96)](RequestMonitor['httpCodesStoragePath'],_0x2eeed5(0x9f));RequestMonitor[_0x2eeed5(0xba)]=JSON['parse'](_0x4209de);}catch(_0x592daf){RequestMonitor[_0x2eeed5(0xba)]=[];}try{const _0x181998=await fs['readFile'](RequestMonitor[_0x2eeed5(0xce)],_0x2eeed5(0x9f));RequestMonitor[_0x2eeed5(0xb2)]=JSON[_0x2eeed5(0x93)](_0x181998),!RequestMonitor[_0x2eeed5(0xb2)]['cpu']&&(RequestMonitor['ressourcesUsageStats'][_0x2eeed5(0xb5)]=[]),!RequestMonitor['ressourcesUsageStats']['memory']&&(RequestMonitor[_0x2eeed5(0xb2)][_0x2eeed5(0x8d)]=[]),!RequestMonitor[_0x2eeed5(0xb2)]['network']&&(RequestMonitor['ressourcesUsageStats'][_0x2eeed5(0xa7)]=[]);}catch(_0xff7ff3){RequestMonitor[_0x2eeed5(0xb2)]={'cpu':[],'memory':[],'network':[]};}console[_0x2eeed5(0x9b)]('Request\x20monitor\x20initialized.');}static[a1_0x5acff3(0xab)](_0x4851d9,_0x21341c,_0x5e12e3){const _0x36131a=a1_0x5acff3;if(_0x4851d9[_0x36131a(0xca)][_0x36131a(0xa3)](_0x36131a(0xa2)))return _0x5e12e3();console[_0x36131a(0x9b)](_0x36131a(0xaa));let _0x1f2d3c=Date['now'](),_0x16d55e=Math[_0x36131a(0xaf)](_0x1f2d3c/0x3e8/0x3c);console[_0x36131a(0x9b)](_0x36131a(0x8b));const _0x39a455=_0x21341c[_0x36131a(0xa0)];_0x21341c[_0x36131a(0xa0)]=(..._0x221634)=>{const _0x129a18=_0x36131a;console[_0x129a18(0x9b)](_0x16d55e,{'currentMinute':_0x16d55e});_0x16d55e>RequestMonitor[_0x129a18(0xbf)]&&(RequestMonitor[_0x129a18(0x98)][_0x129a18(0xa8)]({'timestamp':RequestMonitor[_0x129a18(0xbf)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x129a18(0xbd)]=0x0,RequestMonitor[_0x129a18(0xbf)]=_0x16d55e);RequestMonitor['currentRequests']++,RequestMonitor[_0x129a18(0xba)][_0x129a18(0xa8)]({'timestamp':Date['now'](),'statusCode':_0x21341c[_0x129a18(0xc9)],'path':_0x4851d9[_0x129a18(0xca)],'method':_0x4851d9[_0x129a18(0xc2)]});const _0x4d0563=Date[_0x129a18(0x97)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x129a18(0xba)]=RequestMonitor[_0x129a18(0xba)][_0x129a18(0x8c)](_0x58960a=>_0x58960a[_0x129a18(0xa5)]>_0x4d0563),_0x39a455[_0x129a18(0xbe)](_0x21341c,_0x221634);},_0x5e12e3();}static async[a1_0x5acff3(0x8e)](){const _0x1e778c=a1_0x5acff3;try{RequestMonitor[_0x1e778c(0xbf)]!==Math[_0x1e778c(0xaf)](Date[_0x1e778c(0x97)]()/0x3e8/0x3c)&&(RequestMonitor[_0x1e778c(0x98)][_0x1e778c(0xa8)]({'timestamp':RequestMonitor[_0x1e778c(0xbf)]*0x3e8*0x3c,'requests':RequestMonitor[_0x1e778c(0xbd)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x1e778c(0xbf)]=Math[_0x1e778c(0xaf)](Date[_0x1e778c(0x97)]()/0x3e8/0x3c)),await fs[_0x1e778c(0xc3)](RequestMonitor[_0x1e778c(0x9e)],JSON[_0x1e778c(0xd0)](RequestMonitor[_0x1e778c(0x98)],null,0x2)),await fs['writeFile'](RequestMonitor[_0x1e778c(0xc4)],JSON['stringify'](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x1aab2b){console[_0x1e778c(0xb9)]('Error\x20saving\x20monitoring\x20data:',_0x1aab2b);}}static async[a1_0x5acff3(0x92)](){const _0x579a03=a1_0x5acff3;setInterval(()=>RequestMonitor[_0x579a03(0x8e)](),0x3c*0x3e8),setInterval(()=>{const _0x38f555=_0x579a03;RequestMonitor[_0x38f555(0x8f)]()[_0x38f555(0x9c)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x579a03(0x8f)]()[_0x579a03(0x9c)](()=>{});}static async[a1_0x5acff3(0x8f)](){const _0x388f2b=a1_0x5acff3,_0x2e9e6a=osu[_0x388f2b(0xb5)],_0x17ead1=osu[_0x388f2b(0xb7)],_0xc6f040=osu[_0x388f2b(0x95)],_0x3fbcd8={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x378839=await _0xc6f040['inOut']();_0x3fbcd8[_0x388f2b(0xc8)]['inputMb']=_0x378839[_0x388f2b(0xc8)]['inputMb'],_0x3fbcd8[_0x388f2b(0xc8)][_0x388f2b(0xa9)]=_0x378839[_0x388f2b(0xc8)]['outputMb'];}catch(_0x39e4a9){}let _0x2e1b21=0x0;try{_0x2e1b21=await _0x2e9e6a[_0x388f2b(0xb8)]();}catch(_0x5ec1b3){console[_0x388f2b(0x9b)](_0x388f2b(0xcd),_0x5ec1b3);}const _0x2a9059={'usedMemMb':0x0};try{const _0x2e6846=await _0x17ead1['info']();_0x2a9059[_0x388f2b(0xcb)]=_0x2e6846[_0x388f2b(0xcb)];}catch(_0x2ac3d8){console[_0x388f2b(0x9b)]('Error\x20getting\x20memory\x20usage:',_0x2ac3d8);}const _0x3e992d=new Date()['getHours']()[_0x388f2b(0x91)]()[_0x388f2b(0xb4)](0x2,'0')+':'+new Date()[_0x388f2b(0xae)]()[_0x388f2b(0x91)]()[_0x388f2b(0xb4)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x388f2b(0xb5)]=RequestMonitor['ressourcesUsageStats'][_0x388f2b(0xb5)][_0x388f2b(0xb3)](-0x3c)[_0x388f2b(0x8c)](_0x1be525=>_0x1be525[_0x388f2b(0xcc)]!==_0x3e992d),RequestMonitor['ressourcesUsageStats'][_0x388f2b(0x8d)]=RequestMonitor[_0x388f2b(0xb2)][_0x388f2b(0x8d)][_0x388f2b(0xb3)](-0x3c)[_0x388f2b(0x8c)](_0x4b9210=>_0x4b9210[_0x388f2b(0xcc)]!==_0x3e992d),RequestMonitor[_0x388f2b(0xb2)][_0x388f2b(0xa7)]=RequestMonitor[_0x388f2b(0xb2)][_0x388f2b(0xa7)][_0x388f2b(0xb3)](-0x3c)[_0x388f2b(0x8c)](_0x188e1d=>_0x188e1d[_0x388f2b(0xcc)]!==_0x3e992d),RequestMonitor['ressourcesUsageStats'][_0x388f2b(0xb5)][_0x388f2b(0xa8)]({'time':_0x3e992d,'usage':_0x2e1b21}),RequestMonitor[_0x388f2b(0xb2)][_0x388f2b(0x8d)][_0x388f2b(0xa8)]({'time':_0x3e992d,'usage':(_0x2a9059[_0x388f2b(0xcb)]/0x3e8)[_0x388f2b(0xbb)](0x2)}),RequestMonitor[_0x388f2b(0xb2)]['network']['push']({'time':_0x3e992d,'usage':{'in':_0x3fbcd8[_0x388f2b(0xc8)]?.[_0x388f2b(0x9a)]??0x0,'out':_0x3fbcd8['total']?.['outputMb']??0x0}});try{await fs[_0x388f2b(0xc3)](RequestMonitor['ressourcesUsageStatsPath'],JSON[_0x388f2b(0xd0)](RequestMonitor[_0x388f2b(0xb2)],null,0x2));}catch(_0x5d68d7){console[_0x388f2b(0xb9)](_0x388f2b(0x94),_0x5d68d7);}}static['getStats'](){const _0x10d97e=a1_0x5acff3,_0x5e3fcc=Date[_0x10d97e(0x97)](),_0x50b168=_0x5e3fcc-0x3c*0x3c*0x3e8,_0x22262b=_0x5e3fcc-0x18*0x3c*0x3c*0x3e8,_0x4cb256=RequestMonitor[_0x10d97e(0x98)][_0x10d97e(0x8c)](_0x45d0fb=>_0x45d0fb['timestamp']>_0x50b168),_0x2d07d7={'total':RequestMonitor['httpCodesData']['length'],'byCodes':{},'byPath':{}};return RequestMonitor[_0x10d97e(0xba)][_0x10d97e(0xb1)](_0x531841=>{const _0x1c09b5=_0x10d97e;_0x2d07d7[_0x1c09b5(0xac)][_0x531841['statusCode']]=(_0x2d07d7[_0x1c09b5(0xac)][_0x531841[_0x1c09b5(0xc9)]]||0x0)+0x1;const _0x117b44=_0x531841[_0x1c09b5(0xc2)]+'\x20'+_0x531841[_0x1c09b5(0xca)];!_0x2d07d7[_0x1c09b5(0xb0)][_0x117b44]&&(_0x2d07d7['byPath'][_0x117b44]={'total':0x0,'codes':{}}),_0x2d07d7[_0x1c09b5(0xb0)][_0x117b44]['total']++,_0x2d07d7[_0x1c09b5(0xb0)][_0x117b44][_0x1c09b5(0xa4)][_0x531841[_0x1c09b5(0xc9)]]=(_0x2d07d7[_0x1c09b5(0xb0)][_0x117b44][_0x1c09b5(0xa4)][_0x531841['statusCode']]||0x0)+0x1;}),{'rps':_0x4cb256,'httpCodes':_0x2d07d7,'ressourcesUsageStats':RequestMonitor['ressourcesUsageStats']};}}RequestMonitor[a1_0x5acff3(0xc5)]()[a1_0x5acff3(0x9c)](()=>{}),RequestMonitor[a1_0x5acff3(0x92)]();const counter=RequestMonitor;function a1_0x5127(){const _0x1ff094=['ressourcesUsageStatsPath','1480432VrDKsO','stringify','=======>','filter','memory','save','getUsageRessourcesStatsAndSave','2ewPHLU','toString','startPeriodicSave','parse','Error\x20saving\x20monitoring\x20data:','netstat','readFile','now','rpsData','1918130nHJHCa','inputMb','log','then','Initializing\x20request\x20monitor...','rpsStoragePath','utf8','end','cadviewer/settings/requests-per-minute.json','/metrics','includes','codes','timestamp','4170204bpybzT','network','push','outputMb','Request\x20monitor\x20middleware','middleware','byCodes','565250duHnel','getMinutes','floor','byPath','forEach','ressourcesUsageStats','slice','padStart','cpu','556024fIBzlA','mem','usage','error','httpCodesData','toFixed','10484784fjbaXT','currentRequests','apply','lastMinute','node-os-utils','cadviewer/settings/http-codes-24h.json','method','writeFile','httpCodesStoragePath','init','1972509FvDoXf','promises','total','statusCode','path','usedMemMb','time','Error\x20getting\x20CPU\x20usage:'];a1_0x5127=function(){return _0x1ff094;};return a1_0x5127();}module['exports']=counter;