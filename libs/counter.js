const a1_0x4af536=a1_0x2af5;(function(_0x3e049b,_0x3fd606){const _0x3d535d=a1_0x2af5,_0x1e8695=_0x3e049b();while(!![]){try{const _0x4874c8=parseInt(_0x3d535d(0x10d))/0x1+parseInt(_0x3d535d(0x12a))/0x2+-parseInt(_0x3d535d(0x10f))/0x3*(-parseInt(_0x3d535d(0x122))/0x4)+parseInt(_0x3d535d(0xfb))/0x5+-parseInt(_0x3d535d(0xf9))/0x6+-parseInt(_0x3d535d(0x110))/0x7+parseInt(_0x3d535d(0x12b))/0x8*(-parseInt(_0x3d535d(0x107))/0x9);if(_0x4874c8===_0x3fd606)break;else _0x1e8695['push'](_0x1e8695['shift']());}catch(_0x875d05){_0x1e8695['push'](_0x1e8695['shift']());}}}(a1_0x3653,0x49bcf));const fs=require('fs')['promises'],osu=require('node-os-utils');function a1_0x2af5(_0x535526,_0x5008d1){const _0x365300=a1_0x3653();return a1_0x2af5=function(_0x2af51a,_0x4ad8e4){_0x2af51a=_0x2af51a-0xf9;let _0x4e36fd=_0x365300[_0x2af51a];return _0x4e36fd;},a1_0x2af5(_0x535526,_0x5008d1);}class RequestMonitor{static ['rpsStoragePath']=a1_0x4af536(0x114);static [a1_0x4af536(0x109)]='cadviewer/settings/http-codes-24h.json';static [a1_0x4af536(0x12d)]=a1_0x4af536(0x108);static ['rpsData']=[];static [a1_0x4af536(0x123)]=[];static [a1_0x4af536(0x125)]={};static [a1_0x4af536(0xfd)]=Math['floor'](Date[a1_0x4af536(0x133)]()/0x3e8/0x3c);static [a1_0x4af536(0xfa)]=0x0;static async[a1_0x4af536(0x11f)](){const _0x2ff15e=a1_0x4af536;console[_0x2ff15e(0x135)](_0x2ff15e(0x100));try{const _0x1b215e=await fs[_0x2ff15e(0x128)](RequestMonitor[_0x2ff15e(0x12c)],_0x2ff15e(0x11d));RequestMonitor[_0x2ff15e(0x119)]=JSON[_0x2ff15e(0xfe)](_0x1b215e);}catch(_0x499c61){RequestMonitor['rpsData']=[];}try{const _0x211d1a=await fs['readFile'](RequestMonitor['httpCodesStoragePath'],_0x2ff15e(0x11d));RequestMonitor['httpCodesData']=JSON['parse'](_0x211d1a);}catch(_0x43e06d){RequestMonitor['httpCodesData']=[];}try{const _0x9566f3=await fs[_0x2ff15e(0x128)](RequestMonitor[_0x2ff15e(0x12d)],_0x2ff15e(0x11d));RequestMonitor['ressourcesUsageStats']=JSON['parse'](_0x9566f3),!RequestMonitor[_0x2ff15e(0x125)][_0x2ff15e(0x136)]&&(RequestMonitor[_0x2ff15e(0x125)][_0x2ff15e(0x136)]=[]),!RequestMonitor[_0x2ff15e(0x125)][_0x2ff15e(0x139)]&&(RequestMonitor[_0x2ff15e(0x125)]['memory']=[]),!RequestMonitor[_0x2ff15e(0x125)]['network']&&(RequestMonitor['ressourcesUsageStats']['network']=[]);}catch(_0x45a6bb){RequestMonitor[_0x2ff15e(0x125)]={'cpu':[],'memory':[],'network':[]};}console['log'](_0x2ff15e(0x117));}static[a1_0x4af536(0x101)](_0x219891,_0x199c24,_0x2704d6){const _0x8091c2=a1_0x4af536;if(_0x219891[_0x8091c2(0x11e)][_0x8091c2(0x112)]('/metrics'))return _0x2704d6();console[_0x8091c2(0x135)]('Request\x20monitor\x20middleware');let _0x23b6f7=Date[_0x8091c2(0x133)](),_0x4d6898=Math[_0x8091c2(0x124)](_0x23b6f7/0x3e8/0x3c);console[_0x8091c2(0x135)](_0x8091c2(0x126));const _0x101032=_0x199c24[_0x8091c2(0x12f)];_0x199c24['end']=(..._0x43b43a)=>{const _0x5d966b=_0x8091c2;console[_0x5d966b(0x135)](_0x4d6898,{'currentMinute':_0x4d6898});_0x4d6898>RequestMonitor[_0x5d966b(0xfd)]&&(RequestMonitor[_0x5d966b(0x119)][_0x5d966b(0x10a)]({'timestamp':RequestMonitor[_0x5d966b(0xfd)]*0x3e8*0x3c,'requests':RequestMonitor[_0x5d966b(0xfa)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor['lastMinute']=_0x4d6898);RequestMonitor[_0x5d966b(0xfa)]++,RequestMonitor[_0x5d966b(0x123)][_0x5d966b(0x10a)]({'timestamp':Date[_0x5d966b(0x133)](),'statusCode':_0x199c24[_0x5d966b(0x10e)],'path':_0x219891[_0x5d966b(0x11e)],'method':_0x219891['method']});const _0x427337=Date[_0x5d966b(0x133)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x5d966b(0x123)]=RequestMonitor[_0x5d966b(0x123)]['filter'](_0x195017=>_0x195017[_0x5d966b(0x11c)]>_0x427337),_0x101032['apply'](_0x199c24,_0x43b43a);},_0x2704d6();}static async['save'](){const _0x4c8903=a1_0x4af536;try{RequestMonitor[_0x4c8903(0xfd)]!==Math[_0x4c8903(0x124)](Date[_0x4c8903(0x133)]()/0x3e8/0x3c)&&(RequestMonitor[_0x4c8903(0x119)]['push']({'timestamp':RequestMonitor[_0x4c8903(0xfd)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x4c8903(0xfa)]=0x0,RequestMonitor[_0x4c8903(0xfd)]=Math[_0x4c8903(0x124)](Date[_0x4c8903(0x133)]()/0x3e8/0x3c)),await fs[_0x4c8903(0x118)](RequestMonitor[_0x4c8903(0x12c)],JSON[_0x4c8903(0x105)](RequestMonitor[_0x4c8903(0x119)],null,0x2)),await fs['writeFile'](RequestMonitor[_0x4c8903(0x109)],JSON[_0x4c8903(0x105)](RequestMonitor[_0x4c8903(0x123)],null,0x2));}catch(_0x4639c5){console[_0x4c8903(0x129)](_0x4c8903(0x111),_0x4639c5);}}static async[a1_0x4af536(0x104)](){const _0x8e218b=a1_0x4af536;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x3660d8=a1_0x2af5;RequestMonitor[_0x3660d8(0x132)]()['then'](()=>{});},0x3c*0x3e8),RequestMonitor['getUsageRessourcesStatsAndSave']()[_0x8e218b(0x113)](()=>{});}static async[a1_0x4af536(0x132)](){const _0x51f5c1=a1_0x4af536,_0x350353=osu[_0x51f5c1(0x136)],_0x7ce751=osu[_0x51f5c1(0x120)],_0x25d25c=osu[_0x51f5c1(0xff)],_0x24feac={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x4585f7=await _0x25d25c[_0x51f5c1(0xfc)]();_0x24feac[_0x51f5c1(0x130)][_0x51f5c1(0x134)]=_0x4585f7[_0x51f5c1(0x130)][_0x51f5c1(0x134)],_0x24feac['total'][_0x51f5c1(0x10b)]=_0x4585f7[_0x51f5c1(0x130)][_0x51f5c1(0x10b)];}catch(_0x3c18bb){}let _0x48850a=0x0;try{_0x48850a=await _0x350353[_0x51f5c1(0x13d)]();}catch(_0x444101){console[_0x51f5c1(0x135)](_0x51f5c1(0x116),_0x444101);}const _0x491867={'usedMemMb':0x0};try{const _0x6880e8=await _0x7ce751[_0x51f5c1(0x137)]();_0x491867[_0x51f5c1(0x13a)]=_0x6880e8[_0x51f5c1(0x13a)];}catch(_0x175ba3){console[_0x51f5c1(0x135)]('Error\x20getting\x20memory\x20usage:',_0x175ba3);}const _0x1a62ec=new Date()[_0x51f5c1(0x102)]()['toString']()[_0x51f5c1(0x115)](0x2,'0')+':'+new Date()['getMinutes']()[_0x51f5c1(0x12e)]()[_0x51f5c1(0x115)](0x2,'0');RequestMonitor[_0x51f5c1(0x125)][_0x51f5c1(0x136)]=RequestMonitor[_0x51f5c1(0x125)][_0x51f5c1(0x136)][_0x51f5c1(0x11b)](-0x3c)[_0x51f5c1(0x138)](_0x59ea9d=>_0x59ea9d[_0x51f5c1(0x106)]!==_0x1a62ec),RequestMonitor[_0x51f5c1(0x125)][_0x51f5c1(0x139)]=RequestMonitor[_0x51f5c1(0x125)][_0x51f5c1(0x139)][_0x51f5c1(0x11b)](-0x3c)[_0x51f5c1(0x138)](_0x324c0b=>_0x324c0b[_0x51f5c1(0x106)]!==_0x1a62ec),RequestMonitor[_0x51f5c1(0x125)][_0x51f5c1(0x13b)]=RequestMonitor[_0x51f5c1(0x125)][_0x51f5c1(0x13b)][_0x51f5c1(0x11b)](-0x3c)[_0x51f5c1(0x138)](_0x24a3ae=>_0x24a3ae['time']!==_0x1a62ec),RequestMonitor[_0x51f5c1(0x125)][_0x51f5c1(0x136)]['push']({'time':_0x1a62ec,'usage':_0x48850a}),RequestMonitor['ressourcesUsageStats'][_0x51f5c1(0x139)][_0x51f5c1(0x10a)]({'time':_0x1a62ec,'usage':(_0x491867[_0x51f5c1(0x13a)]/0x3e8)[_0x51f5c1(0x11a)](0x2)}),RequestMonitor[_0x51f5c1(0x125)]['network']['push']({'time':_0x1a62ec,'usage':{'in':_0x24feac['total']?.[_0x51f5c1(0x134)]??0x0,'out':_0x24feac[_0x51f5c1(0x130)]?.[_0x51f5c1(0x10b)]??0x0}});try{await fs[_0x51f5c1(0x118)](RequestMonitor[_0x51f5c1(0x12d)],JSON[_0x51f5c1(0x105)](RequestMonitor[_0x51f5c1(0x125)],null,0x2));}catch(_0x366cc6){console[_0x51f5c1(0x129)](_0x51f5c1(0x111),_0x366cc6);}}static['getStats'](){const _0x84eb99=a1_0x4af536,_0x4e0dc9=Date[_0x84eb99(0x133)](),_0x382189=_0x4e0dc9-0x3c*0x3c*0x3e8,_0x23d5e9=_0x4e0dc9-0x18*0x3c*0x3c*0x3e8,_0x396f60=RequestMonitor['rpsData'][_0x84eb99(0x138)](_0x34bf48=>_0x34bf48[_0x84eb99(0x11c)]>_0x382189),_0x325ff8={'total':RequestMonitor[_0x84eb99(0x123)][_0x84eb99(0x131)],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData']['forEach'](_0x409a5e=>{const _0x2a4d59=_0x84eb99;_0x325ff8[_0x2a4d59(0x127)][_0x409a5e[_0x2a4d59(0x10e)]]=(_0x325ff8[_0x2a4d59(0x127)][_0x409a5e['statusCode']]||0x0)+0x1;const _0x480aad=_0x409a5e[_0x2a4d59(0x10c)]+'\x20'+_0x409a5e[_0x2a4d59(0x11e)];!_0x325ff8[_0x2a4d59(0x103)][_0x480aad]&&(_0x325ff8[_0x2a4d59(0x103)][_0x480aad]={'total':0x0,'codes':{}}),_0x325ff8[_0x2a4d59(0x103)][_0x480aad][_0x2a4d59(0x130)]++,_0x325ff8['byPath'][_0x480aad][_0x2a4d59(0x13c)][_0x409a5e[_0x2a4d59(0x10e)]]=(_0x325ff8[_0x2a4d59(0x103)][_0x480aad][_0x2a4d59(0x13c)][_0x409a5e[_0x2a4d59(0x10e)]]||0x0)+0x1;}),{'rps':_0x396f60,'httpCodes':_0x325ff8,'ressourcesUsageStats':RequestMonitor[_0x84eb99(0x125)]};}}RequestMonitor['init']()[a1_0x4af536(0x113)](()=>{}),RequestMonitor[a1_0x4af536(0x104)]();const counter=RequestMonitor;module[a1_0x4af536(0x121)]=counter;function a1_0x3653(){const _0x30a464=['usedMemMb','network','codes','usage','1070148QrrJJW','currentRequests','408245PpHYyu','inOut','lastMinute','parse','netstat','Initializing\x20request\x20monitor...','middleware','getHours','byPath','startPeriodicSave','stringify','time','446139zFkCnM','cadviewer/settings/ressources-usage-stats.json','httpCodesStoragePath','push','outputMb','method','380830OYeDAE','statusCode','28308qKxuxH','3499286qJKAvV','Error\x20saving\x20monitoring\x20data:','includes','then','cadviewer/settings/requests-per-minute.json','padStart','Error\x20getting\x20CPU\x20usage:','Request\x20monitor\x20initialized.','writeFile','rpsData','toFixed','slice','timestamp','utf8','path','init','mem','exports','124nCQQds','httpCodesData','floor','ressourcesUsageStats','=======>','byCodes','readFile','error','648868OdYCYa','16mrWbZa','rpsStoragePath','ressourcesUsageStatsPath','toString','end','total','length','getUsageRessourcesStatsAndSave','now','inputMb','log','cpu','info','filter','memory'];a1_0x3653=function(){return _0x30a464;};return a1_0x3653();}