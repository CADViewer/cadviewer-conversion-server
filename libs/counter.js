const a1_0x30921c=a1_0x1932;(function(_0x56bd6d,_0x410e4a){const _0x3a0a90=a1_0x1932,_0x6ce48c=_0x56bd6d();while(!![]){try{const _0x267b60=parseInt(_0x3a0a90(0x166))/0x1*(-parseInt(_0x3a0a90(0x14c))/0x2)+parseInt(_0x3a0a90(0x151))/0x3*(-parseInt(_0x3a0a90(0x140))/0x4)+-parseInt(_0x3a0a90(0x142))/0x5*(parseInt(_0x3a0a90(0x134))/0x6)+-parseInt(_0x3a0a90(0x16f))/0x7+parseInt(_0x3a0a90(0x172))/0x8*(-parseInt(_0x3a0a90(0x12e))/0x9)+-parseInt(_0x3a0a90(0x13a))/0xa+parseInt(_0x3a0a90(0x150))/0xb*(parseInt(_0x3a0a90(0x163))/0xc);if(_0x267b60===_0x410e4a)break;else _0x6ce48c['push'](_0x6ce48c['shift']());}catch(_0x4865e8){_0x6ce48c['push'](_0x6ce48c['shift']());}}}(a1_0x9fd4,0x2341f));const fs=require('fs')[a1_0x30921c(0x14e)],osu=require('node-os-utils');class RequestMonitor{static [a1_0x30921c(0x153)]=a1_0x30921c(0x13d);static [a1_0x30921c(0x15f)]=a1_0x30921c(0x14f);static ['ressourcesUsageStatsPath']='cadviewer/settings/ressources-usage-stats.json';static [a1_0x30921c(0x156)]=[];static [a1_0x30921c(0x143)]=[];static [a1_0x30921c(0x161)]={};static [a1_0x30921c(0x158)]=Math[a1_0x30921c(0x15c)](Date[a1_0x30921c(0x154)]()/0x3e8/0x3c);static [a1_0x30921c(0x132)]=0x0;static async[a1_0x30921c(0x160)](){const _0x5b2718=a1_0x30921c;console[_0x5b2718(0x12c)](_0x5b2718(0x12f));try{const _0xff36cf=await fs[_0x5b2718(0x16a)](RequestMonitor['rpsStoragePath'],'utf8');RequestMonitor[_0x5b2718(0x156)]=JSON[_0x5b2718(0x165)](_0xff36cf);}catch(_0x4bddd9){RequestMonitor[_0x5b2718(0x156)]=[];}try{const _0x3d7db0=await fs[_0x5b2718(0x16a)](RequestMonitor['httpCodesStoragePath'],'utf8');RequestMonitor['httpCodesData']=JSON[_0x5b2718(0x165)](_0x3d7db0);}catch(_0x5d89be){RequestMonitor[_0x5b2718(0x143)]=[];}try{const _0xa847b8=await fs[_0x5b2718(0x16a)](RequestMonitor[_0x5b2718(0x13e)],_0x5b2718(0x13c));RequestMonitor[_0x5b2718(0x161)]=JSON[_0x5b2718(0x165)](_0xa847b8),!RequestMonitor[_0x5b2718(0x161)][_0x5b2718(0x16b)]&&(RequestMonitor[_0x5b2718(0x161)][_0x5b2718(0x16b)]=[]),!RequestMonitor[_0x5b2718(0x161)][_0x5b2718(0x169)]&&(RequestMonitor[_0x5b2718(0x161)][_0x5b2718(0x169)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x5b2718(0x148)]&&(RequestMonitor[_0x5b2718(0x161)][_0x5b2718(0x148)]=[]);}catch(_0x315452){RequestMonitor[_0x5b2718(0x161)]={'cpu':[],'memory':[],'network':[]};}console[_0x5b2718(0x12c)](_0x5b2718(0x146));}static[a1_0x30921c(0x137)](_0x5710d6,_0x93de97,_0x5080d0){const _0x288a09=a1_0x30921c;if(_0x5710d6[_0x288a09(0x133)][_0x288a09(0x159)](_0x288a09(0x168)))return _0x5080d0();console[_0x288a09(0x12c)]('Request\x20monitor\x20middleware');let _0x451e57=Date[_0x288a09(0x154)](),_0x460c90=Math['floor'](_0x451e57/0x3e8/0x3c);console[_0x288a09(0x12c)](_0x288a09(0x131));const _0xe0ec20=_0x93de97[_0x288a09(0x14d)];_0x93de97[_0x288a09(0x14d)]=(..._0x4e61ef)=>{const _0x25f279=_0x288a09;console[_0x25f279(0x12c)](_0x460c90,{'currentMinute':_0x460c90});_0x460c90>RequestMonitor[_0x25f279(0x158)]&&(RequestMonitor[_0x25f279(0x156)][_0x25f279(0x13f)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x25f279(0x132)]}),RequestMonitor[_0x25f279(0x132)]=0x0,RequestMonitor[_0x25f279(0x158)]=_0x460c90);RequestMonitor[_0x25f279(0x132)]++,RequestMonitor[_0x25f279(0x143)][_0x25f279(0x13f)]({'timestamp':Date[_0x25f279(0x154)](),'statusCode':_0x93de97[_0x25f279(0x174)],'path':_0x5710d6[_0x25f279(0x133)],'method':_0x5710d6[_0x25f279(0x147)]});const _0x2e307d=Date[_0x25f279(0x154)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x25f279(0x143)]=RequestMonitor[_0x25f279(0x143)]['filter'](_0x1ce9ca=>_0x1ce9ca[_0x25f279(0x130)]>_0x2e307d),_0xe0ec20[_0x25f279(0x14b)](_0x93de97,_0x4e61ef);},_0x5080d0();}static async[a1_0x30921c(0x167)](){const _0x5d6f51=a1_0x30921c;try{RequestMonitor[_0x5d6f51(0x158)]!==Math[_0x5d6f51(0x15c)](Date[_0x5d6f51(0x154)]()/0x3e8/0x3c)&&(RequestMonitor['rpsData'][_0x5d6f51(0x13f)]({'timestamp':RequestMonitor[_0x5d6f51(0x158)]*0x3e8*0x3c,'requests':RequestMonitor[_0x5d6f51(0x132)]}),RequestMonitor[_0x5d6f51(0x132)]=0x0,RequestMonitor[_0x5d6f51(0x158)]=Math[_0x5d6f51(0x15c)](Date['now']()/0x3e8/0x3c)),await fs['writeFile'](RequestMonitor[_0x5d6f51(0x153)],JSON[_0x5d6f51(0x14a)](RequestMonitor[_0x5d6f51(0x156)],null,0x2)),await fs[_0x5d6f51(0x164)](RequestMonitor[_0x5d6f51(0x15f)],JSON['stringify'](RequestMonitor[_0x5d6f51(0x143)],null,0x2));}catch(_0x1a8c01){console[_0x5d6f51(0x157)]('Error\x20saving\x20monitoring\x20data:',_0x1a8c01);}}static async[a1_0x30921c(0x15e)](){const _0x4b4007=a1_0x30921c;setInterval(()=>RequestMonitor[_0x4b4007(0x167)](),0x3c*0x3e8),setInterval(()=>{const _0x42bc0e=_0x4b4007;RequestMonitor[_0x42bc0e(0x16e)]()['then'](()=>{});},0x3c*0x3e8),RequestMonitor[_0x4b4007(0x16e)]()[_0x4b4007(0x145)](()=>{});}static async[a1_0x30921c(0x16e)](){const _0x1ab05b=a1_0x30921c,_0x204499=osu[_0x1ab05b(0x16b)],_0x1032d6=osu[_0x1ab05b(0x15d)],_0x5ba0b0=osu[_0x1ab05b(0x144)],_0x1367ba={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x2fbf85=await _0x5ba0b0[_0x1ab05b(0x12b)]();_0x1367ba['total'][_0x1ab05b(0x16c)]=_0x2fbf85[_0x1ab05b(0x149)]['inputMb'],_0x1367ba[_0x1ab05b(0x149)][_0x1ab05b(0x138)]=_0x2fbf85[_0x1ab05b(0x149)][_0x1ab05b(0x138)];}catch(_0x547fba){}let _0x5b0f5d=0x0;try{_0x5b0f5d=await _0x204499['usage']();}catch(_0x3c5a48){console[_0x1ab05b(0x12c)](_0x1ab05b(0x141),_0x3c5a48);}const _0xbd3456={'usedMemMb':0x0};try{const _0x484345=await _0x1032d6['info']();_0xbd3456[_0x1ab05b(0x155)]=_0x484345['usedMemMb'];}catch(_0x37cc04){console[_0x1ab05b(0x12c)](_0x1ab05b(0x170),_0x37cc04);}const _0x389f4c=new Date()['getHours']()[_0x1ab05b(0x135)]()['padStart'](0x2,'0')+':'+new Date()[_0x1ab05b(0x12d)]()[_0x1ab05b(0x135)]()[_0x1ab05b(0x12a)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x1ab05b(0x16b)]=RequestMonitor['ressourcesUsageStats'][_0x1ab05b(0x16b)]['slice'](-0x3c)[_0x1ab05b(0x162)](_0x57953d=>_0x57953d[_0x1ab05b(0x139)]!==_0x389f4c),RequestMonitor[_0x1ab05b(0x161)]['memory']=RequestMonitor[_0x1ab05b(0x161)]['memory']['slice'](-0x3c)[_0x1ab05b(0x162)](_0x371861=>_0x371861[_0x1ab05b(0x139)]!==_0x389f4c),RequestMonitor[_0x1ab05b(0x161)][_0x1ab05b(0x148)]=RequestMonitor[_0x1ab05b(0x161)]['network'][_0x1ab05b(0x15b)](-0x3c)[_0x1ab05b(0x162)](_0x48596e=>_0x48596e['time']!==_0x389f4c),RequestMonitor[_0x1ab05b(0x161)][_0x1ab05b(0x16b)][_0x1ab05b(0x13f)]({'time':_0x389f4c,'usage':_0x5b0f5d}),RequestMonitor['ressourcesUsageStats'][_0x1ab05b(0x169)][_0x1ab05b(0x13f)]({'time':_0x389f4c,'usage':(_0xbd3456[_0x1ab05b(0x155)]/0x3e8)[_0x1ab05b(0x136)](0x2)}),RequestMonitor[_0x1ab05b(0x161)]['network'][_0x1ab05b(0x13f)]({'time':_0x389f4c,'usage':{'in':_0x1367ba['total']?.[_0x1ab05b(0x16c)]??0x0,'out':_0x1367ba[_0x1ab05b(0x149)]?.['outputMb']??0x0}});try{await fs[_0x1ab05b(0x164)](RequestMonitor[_0x1ab05b(0x13e)],JSON[_0x1ab05b(0x14a)](RequestMonitor[_0x1ab05b(0x161)],null,0x2));}catch(_0x53f8c1){console['error'](_0x1ab05b(0x173),_0x53f8c1);}}static['getStats'](){const _0x171d4d=a1_0x30921c,_0xbe408b=Date['now'](),_0x32e029=_0xbe408b-0x3c*0x3c*0x3e8,_0x5db471=_0xbe408b-0x18*0x3c*0x3c*0x3e8,_0x15d6c2=RequestMonitor[_0x171d4d(0x156)][_0x171d4d(0x162)](_0x398604=>_0x398604['timestamp']>_0x32e029),_0x25ea56={'total':RequestMonitor['httpCodesData'][_0x171d4d(0x13b)],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x171d4d(0x15a)](_0x1fc3b2=>{const _0x3fc757=_0x171d4d;_0x25ea56[_0x3fc757(0x171)][_0x1fc3b2[_0x3fc757(0x174)]]=(_0x25ea56['byCodes'][_0x1fc3b2[_0x3fc757(0x174)]]||0x0)+0x1;const _0x5308fe=_0x1fc3b2[_0x3fc757(0x147)]+'\x20'+_0x1fc3b2[_0x3fc757(0x133)];!_0x25ea56[_0x3fc757(0x152)][_0x5308fe]&&(_0x25ea56[_0x3fc757(0x152)][_0x5308fe]={'total':0x0,'codes':{}}),_0x25ea56['byPath'][_0x5308fe][_0x3fc757(0x149)]++,_0x25ea56[_0x3fc757(0x152)][_0x5308fe][_0x3fc757(0x16d)][_0x1fc3b2['statusCode']]=(_0x25ea56[_0x3fc757(0x152)][_0x5308fe]['codes'][_0x1fc3b2[_0x3fc757(0x174)]]||0x0)+0x1;}),{'rps':_0x15d6c2,'httpCodes':_0x25ea56,'ressourcesUsageStats':RequestMonitor[_0x171d4d(0x161)]};}}RequestMonitor['init']()[a1_0x30921c(0x145)](()=>{}),RequestMonitor[a1_0x30921c(0x15e)]();function a1_0x9fd4(){const _0x5a82c9=['rpsStoragePath','now','usedMemMb','rpsData','error','lastMinute','includes','forEach','slice','floor','mem','startPeriodicSave','httpCodesStoragePath','init','ressourcesUsageStats','filter','2964LBixaM','writeFile','parse','1594KLbsFj','save','/metrics','memory','readFile','cpu','inputMb','codes','getUsageRessourcesStatsAndSave','1266734TUXqiR','Error\x20getting\x20memory\x20usage:','byCodes','1329624sGNDBZ','Error\x20saving\x20monitoring\x20data:','statusCode','padStart','inOut','log','getMinutes','9NnTHpY','Initializing\x20request\x20monitor...','timestamp','=======>','currentRequests','path','1272gvVOtv','toString','toFixed','middleware','outputMb','time','2064420LUfmLn','length','utf8','cadviewer/settings/requests-per-minute.json','ressourcesUsageStatsPath','push','68608wztcHM','Error\x20getting\x20CPU\x20usage:','6665JPfHRi','httpCodesData','netstat','then','Request\x20monitor\x20initialized.','method','network','total','stringify','apply','202PDHOhG','end','promises','cadviewer/settings/http-codes-24h.json','56188cjIcoR','21pkBEMf','byPath'];a1_0x9fd4=function(){return _0x5a82c9;};return a1_0x9fd4();}const counter=RequestMonitor;function a1_0x1932(_0x4f42a8,_0x2fb694){const _0x9fd4c2=a1_0x9fd4();return a1_0x1932=function(_0x193237,_0x76ea9c){_0x193237=_0x193237-0x12a;let _0x80d0f=_0x9fd4c2[_0x193237];return _0x80d0f;},a1_0x1932(_0x4f42a8,_0x2fb694);}module['exports']=counter;