const a1_0x5dcf20=a1_0x4658;(function(_0x5073fe,_0x56a236){const _0x1c44ef=a1_0x4658,_0x2340c9=_0x5073fe();while(!![]){try{const _0x4e31e2=-parseInt(_0x1c44ef(0xda))/0x1+parseInt(_0x1c44ef(0xd4))/0x2+-parseInt(_0x1c44ef(0xff))/0x3*(parseInt(_0x1c44ef(0xdc))/0x4)+parseInt(_0x1c44ef(0x107))/0x5*(-parseInt(_0x1c44ef(0x102))/0x6)+parseInt(_0x1c44ef(0xf7))/0x7+parseInt(_0x1c44ef(0xcd))/0x8*(-parseInt(_0x1c44ef(0xc5))/0x9)+-parseInt(_0x1c44ef(0x101))/0xa*(-parseInt(_0x1c44ef(0xe7))/0xb);if(_0x4e31e2===_0x56a236)break;else _0x2340c9['push'](_0x2340c9['shift']());}catch(_0x381715){_0x2340c9['push'](_0x2340c9['shift']());}}}(a1_0x50b8,0x8e6c9));const fs=require('fs')[a1_0x5dcf20(0xe8)],osu=require('node-os-utils');function a1_0x50b8(){const _0x42017b=['stringify','rpsData','apply','timestamp','statusCode','/metrics','httpCodesStoragePath','268723boVLSq','path','filter','ressourcesUsageStats','network','writeFile','inputMb','mem','164427ixxDtv','byPath','10oOVvtB','38670BrGSRK','floor','startPeriodicSave','forEach','cpu','380mGdypQ','slice','currentRequests','exports','lastMinute','error','getUsageRessourcesStatsAndSave','method','3703239HOCjQD','outputMb','getMinutes','getHours','Error\x20getting\x20memory\x20usage:','getStats','=======>','push','16ltrTRq','time','rpsStoragePath','ressourcesUsageStatsPath','then','parse','memory','893514DHbPJW','byCodes','middleware','Request\x20monitor\x20initialized.','Error\x20saving\x20monitoring\x20data:','usedMemMb','731499FzBUco','save','12wFesYo','log','inOut','cadviewer/settings/requests-per-minute.json','length','init','toFixed','now','cadviewer/settings/http-codes-24h.json','total','info','25376021JgROxi','promises','padStart','end','httpCodesData','readFile','codes','toString','utf8'];a1_0x50b8=function(){return _0x42017b;};return a1_0x50b8();}function a1_0x4658(_0x392eeb,_0x28943e){const _0x50b87d=a1_0x50b8();return a1_0x4658=function(_0x4658e2,_0x408330){_0x4658e2=_0x4658e2-0xc5;let _0x651ff0=_0x50b87d[_0x4658e2];return _0x651ff0;},a1_0x4658(_0x392eeb,_0x28943e);}class RequestMonitor{static ['rpsStoragePath']=a1_0x5dcf20(0xdf);static [a1_0x5dcf20(0xf6)]=a1_0x5dcf20(0xe4);static [a1_0x5dcf20(0xd0)]='cadviewer/settings/ressources-usage-stats.json';static [a1_0x5dcf20(0xf1)]=[];static ['httpCodesData']=[];static [a1_0x5dcf20(0xfa)]={};static [a1_0x5dcf20(0x10b)]=Math[a1_0x5dcf20(0x103)](Date[a1_0x5dcf20(0xe3)]()/0x3e8/0x3c);static ['currentRequests']=0x0;static async[a1_0x5dcf20(0xe1)](){const _0x3a8b48=a1_0x5dcf20;console[_0x3a8b48(0xdd)]('Initializing\x20request\x20monitor...');try{const _0x2c88f6=await fs[_0x3a8b48(0xec)](RequestMonitor['rpsStoragePath'],_0x3a8b48(0xef));RequestMonitor['rpsData']=JSON[_0x3a8b48(0xd2)](_0x2c88f6);}catch(_0x5e18b4){RequestMonitor[_0x3a8b48(0xf1)]=[];}try{const _0xf823f2=await fs[_0x3a8b48(0xec)](RequestMonitor[_0x3a8b48(0xf6)],_0x3a8b48(0xef));RequestMonitor['httpCodesData']=JSON[_0x3a8b48(0xd2)](_0xf823f2);}catch(_0x541b58){RequestMonitor[_0x3a8b48(0xeb)]=[];}try{const _0x143df9=await fs[_0x3a8b48(0xec)](RequestMonitor['ressourcesUsageStatsPath'],_0x3a8b48(0xef));RequestMonitor[_0x3a8b48(0xfa)]=JSON['parse'](_0x143df9),!RequestMonitor[_0x3a8b48(0xfa)][_0x3a8b48(0x106)]&&(RequestMonitor[_0x3a8b48(0xfa)][_0x3a8b48(0x106)]=[]),!RequestMonitor[_0x3a8b48(0xfa)]['memory']&&(RequestMonitor['ressourcesUsageStats']['memory']=[]),!RequestMonitor['ressourcesUsageStats'][_0x3a8b48(0xfb)]&&(RequestMonitor[_0x3a8b48(0xfa)][_0x3a8b48(0xfb)]=[]);}catch(_0x204283){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console[_0x3a8b48(0xdd)](_0x3a8b48(0xd7));}static[a1_0x5dcf20(0xd6)](_0x27adb5,_0x4b999c,_0x3c5e60){const _0x4c838f=a1_0x5dcf20;if(_0x27adb5[_0x4c838f(0xf8)]['includes'](_0x4c838f(0xf5)))return _0x3c5e60();console['log']('Request\x20monitor\x20middleware');let _0x6209ed=Date['now'](),_0x50ef65=Math[_0x4c838f(0x103)](_0x6209ed/0x3e8/0x3c);console[_0x4c838f(0xdd)](_0x4c838f(0xcb));const _0x56ce19=_0x4b999c[_0x4c838f(0xea)];_0x4b999c[_0x4c838f(0xea)]=(..._0x1c33fb)=>{const _0x30dd3c=_0x4c838f;console[_0x30dd3c(0xdd)](_0x50ef65,{'currentMinute':_0x50ef65});_0x50ef65>RequestMonitor[_0x30dd3c(0x10b)]&&(RequestMonitor['rpsData'][_0x30dd3c(0xcc)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x30dd3c(0x109)]}),RequestMonitor[_0x30dd3c(0x109)]=0x0,RequestMonitor[_0x30dd3c(0x10b)]=_0x50ef65);RequestMonitor['currentRequests']++,RequestMonitor['httpCodesData']['push']({'timestamp':Date['now'](),'statusCode':_0x4b999c[_0x30dd3c(0xf4)],'path':_0x27adb5[_0x30dd3c(0xf8)],'method':_0x27adb5['method']});const _0x5b8d4d=Date[_0x30dd3c(0xe3)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor['httpCodesData'][_0x30dd3c(0xf9)](_0x421459=>_0x421459[_0x30dd3c(0xf3)]>_0x5b8d4d),_0x56ce19[_0x30dd3c(0xf2)](_0x4b999c,_0x1c33fb);},_0x3c5e60();}static async[a1_0x5dcf20(0xdb)](){const _0x3567d7=a1_0x5dcf20;try{RequestMonitor[_0x3567d7(0x10b)]!==Math[_0x3567d7(0x103)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x3567d7(0xf1)][_0x3567d7(0xcc)]({'timestamp':RequestMonitor[_0x3567d7(0x10b)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x3567d7(0x109)]=0x0,RequestMonitor['lastMinute']=Math['floor'](Date['now']()/0x3e8/0x3c)),await fs[_0x3567d7(0xfc)](RequestMonitor[_0x3567d7(0xcf)],JSON['stringify'](RequestMonitor[_0x3567d7(0xf1)],null,0x2)),await fs[_0x3567d7(0xfc)](RequestMonitor['httpCodesStoragePath'],JSON[_0x3567d7(0xf0)](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x407a54){console['error'](_0x3567d7(0xd8),_0x407a54);}}static async['startPeriodicSave'](){const _0x2871cf=a1_0x5dcf20;setInterval(()=>RequestMonitor[_0x2871cf(0xdb)](),0x3c*0x3e8),setInterval(()=>{const _0x55eb74=_0x2871cf;RequestMonitor[_0x55eb74(0x10d)]()['then'](()=>{});},0x3c*0x3e8),RequestMonitor[_0x2871cf(0x10d)]()[_0x2871cf(0xd1)](()=>{});}static async[a1_0x5dcf20(0x10d)](){const _0x4ed5a7=a1_0x5dcf20,_0x4919c3=osu[_0x4ed5a7(0x106)],_0x2dc445=osu[_0x4ed5a7(0xfe)],_0x5998af=osu['netstat'],_0x159166={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x3a3c64=await _0x5998af[_0x4ed5a7(0xde)]();_0x159166[_0x4ed5a7(0xe5)]['inputMb']=_0x3a3c64['total'][_0x4ed5a7(0xfd)],_0x159166[_0x4ed5a7(0xe5)]['outputMb']=_0x3a3c64[_0x4ed5a7(0xe5)]['outputMb'];}catch(_0x322bf9){}let _0x3984a2=0x0;try{_0x3984a2=await _0x4919c3['usage']();}catch(_0x46adbd){console[_0x4ed5a7(0xdd)]('Error\x20getting\x20CPU\x20usage:',_0x46adbd);}const _0x23f13a={'usedMemMb':0x0};try{const _0x4759c6=await _0x2dc445[_0x4ed5a7(0xe6)]();_0x23f13a['usedMemMb']=_0x4759c6[_0x4ed5a7(0xd9)];}catch(_0x31d48d){console[_0x4ed5a7(0xdd)](_0x4ed5a7(0xc9),_0x31d48d);}const _0x1fd9d9=new Date()[_0x4ed5a7(0xc8)]()[_0x4ed5a7(0xee)]()[_0x4ed5a7(0xe9)](0x2,'0')+':'+new Date()[_0x4ed5a7(0xc7)]()[_0x4ed5a7(0xee)]()[_0x4ed5a7(0xe9)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x4ed5a7(0x106)]=RequestMonitor[_0x4ed5a7(0xfa)][_0x4ed5a7(0x106)][_0x4ed5a7(0x108)](-0x3c)[_0x4ed5a7(0xf9)](_0x1c41ea=>_0x1c41ea[_0x4ed5a7(0xce)]!==_0x1fd9d9),RequestMonitor[_0x4ed5a7(0xfa)][_0x4ed5a7(0xd3)]=RequestMonitor[_0x4ed5a7(0xfa)][_0x4ed5a7(0xd3)][_0x4ed5a7(0x108)](-0x3c)[_0x4ed5a7(0xf9)](_0x80b580=>_0x80b580[_0x4ed5a7(0xce)]!==_0x1fd9d9),RequestMonitor[_0x4ed5a7(0xfa)][_0x4ed5a7(0xfb)]=RequestMonitor[_0x4ed5a7(0xfa)][_0x4ed5a7(0xfb)]['slice'](-0x3c)[_0x4ed5a7(0xf9)](_0x1ec55f=>_0x1ec55f[_0x4ed5a7(0xce)]!==_0x1fd9d9),RequestMonitor[_0x4ed5a7(0xfa)][_0x4ed5a7(0x106)][_0x4ed5a7(0xcc)]({'time':_0x1fd9d9,'usage':_0x3984a2}),RequestMonitor['ressourcesUsageStats']['memory'][_0x4ed5a7(0xcc)]({'time':_0x1fd9d9,'usage':(_0x23f13a[_0x4ed5a7(0xd9)]/0x3e8)[_0x4ed5a7(0xe2)](0x2)}),RequestMonitor[_0x4ed5a7(0xfa)][_0x4ed5a7(0xfb)][_0x4ed5a7(0xcc)]({'time':_0x1fd9d9,'usage':{'in':_0x159166[_0x4ed5a7(0xe5)]?.[_0x4ed5a7(0xfd)]??0x0,'out':_0x159166[_0x4ed5a7(0xe5)]?.[_0x4ed5a7(0xc6)]??0x0}});try{await fs[_0x4ed5a7(0xfc)](RequestMonitor['ressourcesUsageStatsPath'],JSON[_0x4ed5a7(0xf0)](RequestMonitor[_0x4ed5a7(0xfa)],null,0x2));}catch(_0x34a3b7){console[_0x4ed5a7(0x10c)]('Error\x20saving\x20monitoring\x20data:',_0x34a3b7);}}static[a1_0x5dcf20(0xca)](){const _0x57d250=a1_0x5dcf20,_0x2ff872=Date[_0x57d250(0xe3)](),_0x2a4766=_0x2ff872-0x3c*0x3c*0x3e8,_0x44b13a=_0x2ff872-0x18*0x3c*0x3c*0x3e8,_0x1b7080=RequestMonitor['rpsData']['filter'](_0x5b540a=>_0x5b540a[_0x57d250(0xf3)]>_0x2a4766),_0x256e8e={'total':RequestMonitor['httpCodesData'][_0x57d250(0xe0)],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x57d250(0x105)](_0x5b6def=>{const _0x21a832=_0x57d250;_0x256e8e[_0x21a832(0xd5)][_0x5b6def['statusCode']]=(_0x256e8e[_0x21a832(0xd5)][_0x5b6def[_0x21a832(0xf4)]]||0x0)+0x1;const _0x517d81=_0x5b6def[_0x21a832(0x10e)]+'\x20'+_0x5b6def['path'];!_0x256e8e[_0x21a832(0x100)][_0x517d81]&&(_0x256e8e[_0x21a832(0x100)][_0x517d81]={'total':0x0,'codes':{}}),_0x256e8e[_0x21a832(0x100)][_0x517d81]['total']++,_0x256e8e[_0x21a832(0x100)][_0x517d81][_0x21a832(0xed)][_0x5b6def[_0x21a832(0xf4)]]=(_0x256e8e[_0x21a832(0x100)][_0x517d81]['codes'][_0x5b6def['statusCode']]||0x0)+0x1;}),{'rps':_0x1b7080,'httpCodes':_0x256e8e,'ressourcesUsageStats':RequestMonitor[_0x57d250(0xfa)]};}}RequestMonitor[a1_0x5dcf20(0xe1)]()[a1_0x5dcf20(0xd1)](()=>{}),RequestMonitor[a1_0x5dcf20(0x104)]();const counter=RequestMonitor;module[a1_0x5dcf20(0x10a)]=counter;