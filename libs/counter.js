const a1_0xe00dc9=a1_0x2e6f;(function(_0x43c6c7,_0x4f20fa){const _0x1a4457=a1_0x2e6f,_0x2afc1f=_0x43c6c7();while(!![]){try{const _0x10c239=-parseInt(_0x1a4457(0x21d))/0x1*(-parseInt(_0x1a4457(0x225))/0x2)+parseInt(_0x1a4457(0x233))/0x3*(-parseInt(_0x1a4457(0x222))/0x4)+parseInt(_0x1a4457(0x1fe))/0x5*(parseInt(_0x1a4457(0x1f9))/0x6)+parseInt(_0x1a4457(0x217))/0x7*(parseInt(_0x1a4457(0x210))/0x8)+-parseInt(_0x1a4457(0x229))/0x9*(parseInt(_0x1a4457(0x206))/0xa)+parseInt(_0x1a4457(0x1f5))/0xb+-parseInt(_0x1a4457(0x204))/0xc;if(_0x10c239===_0x4f20fa)break;else _0x2afc1f['push'](_0x2afc1f['shift']());}catch(_0x69c97d){_0x2afc1f['push'](_0x2afc1f['shift']());}}}(a1_0x1589,0x6113c));function a1_0x1589(){const _0x380c71=['toString','readFile','httpCodesStoragePath','inOut','Error\x20saving\x20monitoring\x20data:','153948SEdCre','Request\x20monitor\x20initialized.','370ZBrLvO','cpu','total','error','utf8','time','network','stringify','path','lastMinute','16JATFKb','httpCodesData','toFixed','cadviewer/settings/http-codes-24h.json','rpsStoragePath','includes','end','1994167VsGjzU','now','ressourcesUsageStatsPath','timestamp','Error\x20getting\x20CPU\x20usage:','Initializing\x20request\x20monitor...','37RrXrgb','padStart','middleware','writeFile','rpsData','223968dbGzQq','push','log','19678BKjLqS','statusCode','parse','cadviewer/settings/ressources-usage-stats.json','183969cOVCCw','currentRequests','memory','netstat','startPeriodicSave','codes','outputMb','filter','info','/metrics','39horBtr','usedMemMb','getUsageRessourcesStatsAndSave','slice','getStats','ressourcesUsageStats','cadviewer/settings/requests-per-minute.json','floor','init','inputMb','byPath','4742936RVWorF','then','byCodes','method','1059378dClxCp','exports','mem','Request\x20monitor\x20middleware','length','15woVKaJ'];a1_0x1589=function(){return _0x380c71;};return a1_0x1589();}const fs=require('fs')['promises'],osu=require('node-os-utils');class RequestMonitor{static [a1_0xe00dc9(0x214)]=a1_0xe00dc9(0x1f0);static [a1_0xe00dc9(0x201)]=a1_0xe00dc9(0x213);static [a1_0xe00dc9(0x219)]=a1_0xe00dc9(0x228);static [a1_0xe00dc9(0x221)]=[];static ['httpCodesData']=[];static [a1_0xe00dc9(0x1ef)]={};static [a1_0xe00dc9(0x20f)]=Math['floor'](Date['now']()/0x3e8/0x3c);static [a1_0xe00dc9(0x22a)]=0x0;static async['init'](){const _0x55c485=a1_0xe00dc9;console[_0x55c485(0x224)](_0x55c485(0x21c));try{const _0x50f10a=await fs[_0x55c485(0x200)](RequestMonitor[_0x55c485(0x214)],_0x55c485(0x20a));RequestMonitor['rpsData']=JSON[_0x55c485(0x227)](_0x50f10a);}catch(_0x43d443){RequestMonitor[_0x55c485(0x221)]=[];}try{const _0x22f135=await fs[_0x55c485(0x200)](RequestMonitor[_0x55c485(0x201)],_0x55c485(0x20a));RequestMonitor[_0x55c485(0x211)]=JSON[_0x55c485(0x227)](_0x22f135);}catch(_0xd04114){RequestMonitor['httpCodesData']=[];}try{const _0x5bf8a0=await fs[_0x55c485(0x200)](RequestMonitor[_0x55c485(0x219)],_0x55c485(0x20a));RequestMonitor['ressourcesUsageStats']=JSON['parse'](_0x5bf8a0),!RequestMonitor[_0x55c485(0x1ef)]['cpu']&&(RequestMonitor[_0x55c485(0x1ef)][_0x55c485(0x207)]=[]),!RequestMonitor[_0x55c485(0x1ef)][_0x55c485(0x22b)]&&(RequestMonitor[_0x55c485(0x1ef)][_0x55c485(0x22b)]=[]),!RequestMonitor[_0x55c485(0x1ef)][_0x55c485(0x20c)]&&(RequestMonitor['ressourcesUsageStats']['network']=[]);}catch(_0x29b24f){RequestMonitor[_0x55c485(0x1ef)]={'cpu':[],'memory':[],'network':[]};}console[_0x55c485(0x224)](_0x55c485(0x205));}static[a1_0xe00dc9(0x21f)](_0x568c1b,_0x13619c,_0x49c166){const _0x32db2e=a1_0xe00dc9;if(_0x568c1b[_0x32db2e(0x20e)][_0x32db2e(0x215)](_0x32db2e(0x232)))return _0x49c166();console['log'](_0x32db2e(0x1fc));let _0x3137cf=Date[_0x32db2e(0x218)](),_0x1b1a5e=Math[_0x32db2e(0x1f1)](_0x3137cf/0x3e8/0x3c);console[_0x32db2e(0x224)]('=======>');const _0x4b9fc0=_0x13619c['end'];_0x13619c[_0x32db2e(0x216)]=(..._0x3294dd)=>{const _0x44e320=_0x32db2e;console[_0x44e320(0x224)](_0x1b1a5e,{'currentMinute':_0x1b1a5e});_0x1b1a5e>RequestMonitor[_0x44e320(0x20f)]&&(RequestMonitor[_0x44e320(0x221)]['push']({'timestamp':RequestMonitor[_0x44e320(0x20f)]*0x3e8*0x3c,'requests':RequestMonitor[_0x44e320(0x22a)]}),RequestMonitor[_0x44e320(0x22a)]=0x0,RequestMonitor['lastMinute']=_0x1b1a5e);RequestMonitor[_0x44e320(0x22a)]++,RequestMonitor[_0x44e320(0x211)][_0x44e320(0x223)]({'timestamp':Date[_0x44e320(0x218)](),'statusCode':_0x13619c['statusCode'],'path':_0x568c1b[_0x44e320(0x20e)],'method':_0x568c1b['method']});const _0x489dde=Date[_0x44e320(0x218)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x44e320(0x211)]=RequestMonitor[_0x44e320(0x211)][_0x44e320(0x230)](_0x468aa3=>_0x468aa3[_0x44e320(0x21a)]>_0x489dde),_0x4b9fc0['apply'](_0x13619c,_0x3294dd);},_0x49c166();}static async['save'](){const _0x94c435=a1_0xe00dc9;try{RequestMonitor[_0x94c435(0x20f)]!==Math['floor'](Date[_0x94c435(0x218)]()/0x3e8/0x3c)&&(RequestMonitor[_0x94c435(0x221)]['push']({'timestamp':RequestMonitor[_0x94c435(0x20f)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x94c435(0x22a)]=0x0,RequestMonitor[_0x94c435(0x20f)]=Math[_0x94c435(0x1f1)](Date[_0x94c435(0x218)]()/0x3e8/0x3c)),await fs[_0x94c435(0x220)](RequestMonitor['rpsStoragePath'],JSON[_0x94c435(0x20d)](RequestMonitor[_0x94c435(0x221)],null,0x2)),await fs[_0x94c435(0x220)](RequestMonitor['httpCodesStoragePath'],JSON[_0x94c435(0x20d)](RequestMonitor[_0x94c435(0x211)],null,0x2));}catch(_0x1d673c){console[_0x94c435(0x209)]('Error\x20saving\x20monitoring\x20data:',_0x1d673c);}}static async[a1_0xe00dc9(0x22d)](){const _0x1264c5=a1_0xe00dc9;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x5aca81=a1_0x2e6f;RequestMonitor[_0x5aca81(0x1ec)]()[_0x5aca81(0x1f6)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x1264c5(0x1ec)]()[_0x1264c5(0x1f6)](()=>{});}static async[a1_0xe00dc9(0x1ec)](){const _0x15b895=a1_0xe00dc9,_0x50e5a2=osu[_0x15b895(0x207)],_0x5f10d1=osu[_0x15b895(0x1fb)],_0x4803a0=osu[_0x15b895(0x22c)],_0x4de384={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x5756e5=await _0x4803a0[_0x15b895(0x202)]();_0x4de384['total'][_0x15b895(0x1f3)]=_0x5756e5['total']['inputMb'],_0x4de384[_0x15b895(0x208)]['outputMb']=_0x5756e5[_0x15b895(0x208)][_0x15b895(0x22f)];}catch(_0x37b865){}let _0x4cce6e=0x0;try{_0x4cce6e=await _0x50e5a2['usage']();}catch(_0x1d6d18){console[_0x15b895(0x224)](_0x15b895(0x21b),_0x1d6d18);}const _0x2af5b8={'usedMemMb':0x0};try{const _0x2f2d87=await _0x5f10d1[_0x15b895(0x231)]();_0x2af5b8[_0x15b895(0x1eb)]=_0x2f2d87['usedMemMb'];}catch(_0x18e689){console[_0x15b895(0x224)]('Error\x20getting\x20memory\x20usage:',_0x18e689);}const _0x5f087c=new Date()['getHours']()[_0x15b895(0x1ff)]()['padStart'](0x2,'0')+':'+new Date()['getMinutes']()['toString']()[_0x15b895(0x21e)](0x2,'0');RequestMonitor['ressourcesUsageStats']['cpu']=RequestMonitor[_0x15b895(0x1ef)][_0x15b895(0x207)][_0x15b895(0x1ed)](-0x3c)['filter'](_0x1fd82a=>_0x1fd82a[_0x15b895(0x20b)]!==_0x5f087c),RequestMonitor[_0x15b895(0x1ef)][_0x15b895(0x22b)]=RequestMonitor['ressourcesUsageStats'][_0x15b895(0x22b)]['slice'](-0x3c)[_0x15b895(0x230)](_0x5c4f28=>_0x5c4f28['time']!==_0x5f087c),RequestMonitor['ressourcesUsageStats']['network']=RequestMonitor[_0x15b895(0x1ef)][_0x15b895(0x20c)][_0x15b895(0x1ed)](-0x3c)[_0x15b895(0x230)](_0x2967ff=>_0x2967ff['time']!==_0x5f087c),RequestMonitor[_0x15b895(0x1ef)][_0x15b895(0x207)][_0x15b895(0x223)]({'time':_0x5f087c,'usage':_0x4cce6e}),RequestMonitor['ressourcesUsageStats']['memory'][_0x15b895(0x223)]({'time':_0x5f087c,'usage':(_0x2af5b8[_0x15b895(0x1eb)]/0x3e8)[_0x15b895(0x212)](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x15b895(0x20c)][_0x15b895(0x223)]({'time':_0x5f087c,'usage':{'in':_0x4de384[_0x15b895(0x208)]?.[_0x15b895(0x1f3)]??0x0,'out':_0x4de384[_0x15b895(0x208)]?.[_0x15b895(0x22f)]??0x0}});try{await fs[_0x15b895(0x220)](RequestMonitor['ressourcesUsageStatsPath'],JSON[_0x15b895(0x20d)](RequestMonitor[_0x15b895(0x1ef)],null,0x2));}catch(_0xe6785b){console['error'](_0x15b895(0x203),_0xe6785b);}}static[a1_0xe00dc9(0x1ee)](){const _0x2a13b7=a1_0xe00dc9,_0x50800d=Date[_0x2a13b7(0x218)](),_0x3b2832=_0x50800d-0x3c*0x3c*0x3e8,_0x19f482=_0x50800d-0x18*0x3c*0x3c*0x3e8,_0x160e9a=RequestMonitor[_0x2a13b7(0x221)]['filter'](_0x3ab79d=>_0x3ab79d[_0x2a13b7(0x21a)]>_0x3b2832),_0x41e0b4={'total':RequestMonitor[_0x2a13b7(0x211)][_0x2a13b7(0x1fd)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x2a13b7(0x211)]['forEach'](_0x145d4c=>{const _0x576979=_0x2a13b7;_0x41e0b4[_0x576979(0x1f7)][_0x145d4c[_0x576979(0x226)]]=(_0x41e0b4[_0x576979(0x1f7)][_0x145d4c[_0x576979(0x226)]]||0x0)+0x1;const _0x72fa6d=_0x145d4c[_0x576979(0x1f8)]+'\x20'+_0x145d4c[_0x576979(0x20e)];!_0x41e0b4['byPath'][_0x72fa6d]&&(_0x41e0b4[_0x576979(0x1f4)][_0x72fa6d]={'total':0x0,'codes':{}}),_0x41e0b4[_0x576979(0x1f4)][_0x72fa6d][_0x576979(0x208)]++,_0x41e0b4[_0x576979(0x1f4)][_0x72fa6d][_0x576979(0x22e)][_0x145d4c[_0x576979(0x226)]]=(_0x41e0b4[_0x576979(0x1f4)][_0x72fa6d][_0x576979(0x22e)][_0x145d4c[_0x576979(0x226)]]||0x0)+0x1;}),{'rps':_0x160e9a,'httpCodes':_0x41e0b4,'ressourcesUsageStats':RequestMonitor[_0x2a13b7(0x1ef)]};}}RequestMonitor[a1_0xe00dc9(0x1f2)]()[a1_0xe00dc9(0x1f6)](()=>{}),RequestMonitor[a1_0xe00dc9(0x22d)]();const counter=RequestMonitor;function a1_0x2e6f(_0x53f85b,_0x50fbb3){const _0x158941=a1_0x1589();return a1_0x2e6f=function(_0x2e6f4b,_0x5356ea){_0x2e6f4b=_0x2e6f4b-0x1eb;let _0x2b6578=_0x158941[_0x2e6f4b];return _0x2b6578;},a1_0x2e6f(_0x53f85b,_0x50fbb3);}module[a1_0xe00dc9(0x1fa)]=counter;