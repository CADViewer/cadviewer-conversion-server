const a1_0x25d2de=a1_0x5099;function a1_0x5099(_0x12fb06,_0x22f1e0){const _0x222362=a1_0x2223();return a1_0x5099=function(_0x50999e,_0x43d0f0){_0x50999e=_0x50999e-0x8d;let _0x4c4365=_0x222362[_0x50999e];return _0x4c4365;},a1_0x5099(_0x12fb06,_0x22f1e0);}(function(_0x38ef8f,_0x3241b6){const _0x1d51cd=a1_0x5099,_0x1e582a=_0x38ef8f();while(!![]){try{const _0x5a8852=parseInt(_0x1d51cd(0xc5))/0x1*(-parseInt(_0x1d51cd(0x9c))/0x2)+parseInt(_0x1d51cd(0x97))/0x3+parseInt(_0x1d51cd(0xc2))/0x4*(-parseInt(_0x1d51cd(0x98))/0x5)+-parseInt(_0x1d51cd(0xbe))/0x6*(-parseInt(_0x1d51cd(0xa3))/0x7)+parseInt(_0x1d51cd(0xd8))/0x8*(-parseInt(_0x1d51cd(0xd1))/0x9)+parseInt(_0x1d51cd(0xad))/0xa*(parseInt(_0x1d51cd(0xb1))/0xb)+parseInt(_0x1d51cd(0xaa))/0xc;if(_0x5a8852===_0x3241b6)break;else _0x1e582a['push'](_0x1e582a['shift']());}catch(_0x436361){_0x1e582a['push'](_0x1e582a['shift']());}}}(a1_0x2223,0x6e098));function a1_0x2223(){const _0x49dc2f=['/metrics','network','6523EpAign','length','statusCode','floor','byCodes','slice','method','httpCodesData','memory','filter','inputMb','byPath','outputMb','6wRKlGH','promises','Error\x20getting\x20CPU\x20usage:','getUsageRessourcesStatsAndSave','353532gttBVt','rpsStoragePath','mem','103DBCHbM','startPeriodicSave','end','save','error','timestamp','Error\x20getting\x20memory\x20usage:','parse','includes','total','push','toFixed','1323396edJMqo','path','stringify','exports','toString','cpu','getStats','40sJpBhu','padStart','forEach','lastMinute','info','init','usedMemMb','codes','cadviewer/settings/ressources-usage-stats.json','cadviewer/settings/requests-per-minute.json','middleware','1066086Wkgojp','15eRkiPv','writeFile','currentRequests','httpCodesStoragePath','16726xyQZgg','ressourcesUsageStatsPath','utf8','usage','ressourcesUsageStats','log','cadviewer/settings/http-codes-24h.json','2339043yKAHBu','netstat','rpsData','getMinutes','now','Initializing\x20request\x20monitor...','Error\x20saving\x20monitoring\x20data:','11142672YBZVCD','then','time','11710IrEPcT','readFile'];a1_0x2223=function(){return _0x49dc2f;};return a1_0x2223();}const fs=require('fs')[a1_0x25d2de(0xbf)],osu=require('node-os-utils');class RequestMonitor{static [a1_0x25d2de(0xc3)]=a1_0x25d2de(0x95);static [a1_0x25d2de(0x9b)]=a1_0x25d2de(0xa2);static [a1_0x25d2de(0x9d)]=a1_0x25d2de(0x94);static ['rpsData']=[];static [a1_0x25d2de(0xb8)]=[];static [a1_0x25d2de(0xa0)]={};static [a1_0x25d2de(0x8f)]=Math[a1_0x25d2de(0xb4)](Date[a1_0x25d2de(0xa7)]()/0x3e8/0x3c);static [a1_0x25d2de(0x9a)]=0x0;static async[a1_0x25d2de(0x91)](){const _0x632295=a1_0x25d2de;console['log'](_0x632295(0xa8));try{const _0x49de96=await fs[_0x632295(0xae)](RequestMonitor[_0x632295(0xc3)],_0x632295(0x9e));RequestMonitor[_0x632295(0xa5)]=JSON[_0x632295(0xcc)](_0x49de96);}catch(_0x182bc2){RequestMonitor[_0x632295(0xa5)]=[];}try{const _0x3f3b5a=await fs[_0x632295(0xae)](RequestMonitor['httpCodesStoragePath'],_0x632295(0x9e));RequestMonitor['httpCodesData']=JSON[_0x632295(0xcc)](_0x3f3b5a);}catch(_0x4a0e59){RequestMonitor[_0x632295(0xb8)]=[];}try{const _0x20323f=await fs[_0x632295(0xae)](RequestMonitor[_0x632295(0x9d)],_0x632295(0x9e));RequestMonitor['ressourcesUsageStats']=JSON[_0x632295(0xcc)](_0x20323f),!RequestMonitor[_0x632295(0xa0)][_0x632295(0xd6)]&&(RequestMonitor[_0x632295(0xa0)][_0x632295(0xd6)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x632295(0xb9)]&&(RequestMonitor[_0x632295(0xa0)][_0x632295(0xb9)]=[]),!RequestMonitor[_0x632295(0xa0)][_0x632295(0xb0)]&&(RequestMonitor[_0x632295(0xa0)][_0x632295(0xb0)]=[]);}catch(_0x904c27){RequestMonitor[_0x632295(0xa0)]={'cpu':[],'memory':[],'network':[]};}console[_0x632295(0xa1)]('Request\x20monitor\x20initialized.');}static[a1_0x25d2de(0x96)](_0x211c18,_0x6170a0,_0x1d4653){const _0x177c64=a1_0x25d2de;if(_0x211c18[_0x177c64(0xd2)][_0x177c64(0xcd)](_0x177c64(0xaf)))return _0x1d4653();console[_0x177c64(0xa1)]('Request\x20monitor\x20middleware');let _0x35adf8=Date[_0x177c64(0xa7)](),_0x549191=Math[_0x177c64(0xb4)](_0x35adf8/0x3e8/0x3c);console['log']('=======>');const _0x361aad=_0x6170a0[_0x177c64(0xc7)];_0x6170a0[_0x177c64(0xc7)]=(..._0x551b29)=>{const _0x2a9afd=_0x177c64;console[_0x2a9afd(0xa1)](_0x549191,{'currentMinute':_0x549191});_0x549191>RequestMonitor[_0x2a9afd(0x8f)]&&(RequestMonitor[_0x2a9afd(0xa5)]['push']({'timestamp':RequestMonitor[_0x2a9afd(0x8f)]*0x3e8*0x3c,'requests':RequestMonitor[_0x2a9afd(0x9a)]}),RequestMonitor[_0x2a9afd(0x9a)]=0x0,RequestMonitor[_0x2a9afd(0x8f)]=_0x549191);RequestMonitor[_0x2a9afd(0x9a)]++,RequestMonitor['httpCodesData'][_0x2a9afd(0xcf)]({'timestamp':Date[_0x2a9afd(0xa7)](),'statusCode':_0x6170a0[_0x2a9afd(0xb3)],'path':_0x211c18[_0x2a9afd(0xd2)],'method':_0x211c18[_0x2a9afd(0xb7)]});const _0x493bef=Date[_0x2a9afd(0xa7)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x2a9afd(0xb8)]=RequestMonitor['httpCodesData'][_0x2a9afd(0xba)](_0x5491e2=>_0x5491e2[_0x2a9afd(0xca)]>_0x493bef),_0x361aad['apply'](_0x6170a0,_0x551b29);},_0x1d4653();}static async['save'](){const _0x340496=a1_0x25d2de;try{RequestMonitor[_0x340496(0x8f)]!==Math['floor'](Date[_0x340496(0xa7)]()/0x3e8/0x3c)&&(RequestMonitor[_0x340496(0xa5)][_0x340496(0xcf)]({'timestamp':RequestMonitor[_0x340496(0x8f)]*0x3e8*0x3c,'requests':RequestMonitor[_0x340496(0x9a)]}),RequestMonitor[_0x340496(0x9a)]=0x0,RequestMonitor['lastMinute']=Math[_0x340496(0xb4)](Date[_0x340496(0xa7)]()/0x3e8/0x3c)),await fs[_0x340496(0x99)](RequestMonitor[_0x340496(0xc3)],JSON[_0x340496(0xd3)](RequestMonitor[_0x340496(0xa5)],null,0x2)),await fs[_0x340496(0x99)](RequestMonitor[_0x340496(0x9b)],JSON[_0x340496(0xd3)](RequestMonitor[_0x340496(0xb8)],null,0x2));}catch(_0x31cf46){console[_0x340496(0xc9)]('Error\x20saving\x20monitoring\x20data:',_0x31cf46);}}static async[a1_0x25d2de(0xc6)](){const _0x4602b4=a1_0x25d2de;setInterval(()=>RequestMonitor[_0x4602b4(0xc8)](),0x3c*0x3e8),setInterval(()=>{const _0x58019b=_0x4602b4;RequestMonitor['getUsageRessourcesStatsAndSave']()[_0x58019b(0xab)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x4602b4(0xc1)]()['then'](()=>{});}static async[a1_0x25d2de(0xc1)](){const _0x3449b4=a1_0x25d2de,_0x5d5025=osu['cpu'],_0x2015e=osu[_0x3449b4(0xc4)],_0x55ede8=osu[_0x3449b4(0xa4)],_0x1b16aa={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x492b58=await _0x55ede8['inOut']();_0x1b16aa['total'][_0x3449b4(0xbb)]=_0x492b58[_0x3449b4(0xce)]['inputMb'],_0x1b16aa['total'][_0x3449b4(0xbd)]=_0x492b58['total'][_0x3449b4(0xbd)];}catch(_0x556ac9){}let _0x3b72f4=0x0;try{_0x3b72f4=await _0x5d5025[_0x3449b4(0x9f)]();}catch(_0x471dca){console[_0x3449b4(0xa1)](_0x3449b4(0xc0),_0x471dca);}const _0x31284c={'usedMemMb':0x0};try{const _0x38ae2f=await _0x2015e[_0x3449b4(0x90)]();_0x31284c[_0x3449b4(0x92)]=_0x38ae2f['usedMemMb'];}catch(_0x186eac){console[_0x3449b4(0xa1)](_0x3449b4(0xcb),_0x186eac);}const _0x44f44a=new Date()['getHours']()[_0x3449b4(0xd5)]()[_0x3449b4(0x8d)](0x2,'0')+':'+new Date()[_0x3449b4(0xa6)]()[_0x3449b4(0xd5)]()[_0x3449b4(0x8d)](0x2,'0');RequestMonitor[_0x3449b4(0xa0)]['cpu']=RequestMonitor[_0x3449b4(0xa0)][_0x3449b4(0xd6)]['slice'](-0x3c)[_0x3449b4(0xba)](_0x1973b7=>_0x1973b7['time']!==_0x44f44a),RequestMonitor[_0x3449b4(0xa0)][_0x3449b4(0xb9)]=RequestMonitor['ressourcesUsageStats'][_0x3449b4(0xb9)]['slice'](-0x3c)[_0x3449b4(0xba)](_0x172088=>_0x172088['time']!==_0x44f44a),RequestMonitor[_0x3449b4(0xa0)][_0x3449b4(0xb0)]=RequestMonitor[_0x3449b4(0xa0)]['network'][_0x3449b4(0xb6)](-0x3c)[_0x3449b4(0xba)](_0x4a18cf=>_0x4a18cf[_0x3449b4(0xac)]!==_0x44f44a),RequestMonitor[_0x3449b4(0xa0)][_0x3449b4(0xd6)]['push']({'time':_0x44f44a,'usage':_0x3b72f4}),RequestMonitor[_0x3449b4(0xa0)][_0x3449b4(0xb9)][_0x3449b4(0xcf)]({'time':_0x44f44a,'usage':(_0x31284c[_0x3449b4(0x92)]/0x3e8)[_0x3449b4(0xd0)](0x2)}),RequestMonitor[_0x3449b4(0xa0)][_0x3449b4(0xb0)][_0x3449b4(0xcf)]({'time':_0x44f44a,'usage':{'in':_0x1b16aa[_0x3449b4(0xce)]?.['inputMb']??0x0,'out':_0x1b16aa[_0x3449b4(0xce)]?.[_0x3449b4(0xbd)]??0x0}});try{await fs[_0x3449b4(0x99)](RequestMonitor[_0x3449b4(0x9d)],JSON['stringify'](RequestMonitor[_0x3449b4(0xa0)],null,0x2));}catch(_0x5f4269){console[_0x3449b4(0xc9)](_0x3449b4(0xa9),_0x5f4269);}}static[a1_0x25d2de(0xd7)](){const _0x3a4cfb=a1_0x25d2de,_0x21720e=Date[_0x3a4cfb(0xa7)](),_0x235509=_0x21720e-0x3c*0x3c*0x3e8,_0x4e350a=_0x21720e-0x18*0x3c*0x3c*0x3e8,_0x149ada=RequestMonitor[_0x3a4cfb(0xa5)][_0x3a4cfb(0xba)](_0x5a20c6=>_0x5a20c6[_0x3a4cfb(0xca)]>_0x235509),_0x30361c={'total':RequestMonitor['httpCodesData'][_0x3a4cfb(0xb2)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x3a4cfb(0xb8)][_0x3a4cfb(0x8e)](_0x49f6b6=>{const _0xd80658=_0x3a4cfb;_0x30361c[_0xd80658(0xb5)][_0x49f6b6[_0xd80658(0xb3)]]=(_0x30361c[_0xd80658(0xb5)][_0x49f6b6[_0xd80658(0xb3)]]||0x0)+0x1;const _0x12f699=_0x49f6b6['method']+'\x20'+_0x49f6b6['path'];!_0x30361c[_0xd80658(0xbc)][_0x12f699]&&(_0x30361c[_0xd80658(0xbc)][_0x12f699]={'total':0x0,'codes':{}}),_0x30361c[_0xd80658(0xbc)][_0x12f699][_0xd80658(0xce)]++,_0x30361c[_0xd80658(0xbc)][_0x12f699][_0xd80658(0x93)][_0x49f6b6[_0xd80658(0xb3)]]=(_0x30361c[_0xd80658(0xbc)][_0x12f699][_0xd80658(0x93)][_0x49f6b6[_0xd80658(0xb3)]]||0x0)+0x1;}),{'rps':_0x149ada,'httpCodes':_0x30361c,'ressourcesUsageStats':RequestMonitor['ressourcesUsageStats']};}}RequestMonitor[a1_0x25d2de(0x91)]()[a1_0x25d2de(0xab)](()=>{}),RequestMonitor[a1_0x25d2de(0xc6)]();const counter=RequestMonitor;module[a1_0x25d2de(0xd4)]=counter;