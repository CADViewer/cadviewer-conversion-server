const a1_0x47a1a9=a1_0x1f25;(function(_0x54c2bc,_0x113c8f){const _0x1a29bd=a1_0x1f25,_0xd75933=_0x54c2bc();while(!![]){try{const _0x365977=-parseInt(_0x1a29bd(0x121))/0x1+parseInt(_0x1a29bd(0x140))/0x2+-parseInt(_0x1a29bd(0x131))/0x3+-parseInt(_0x1a29bd(0x15e))/0x4+-parseInt(_0x1a29bd(0x151))/0x5+-parseInt(_0x1a29bd(0x154))/0x6+parseInt(_0x1a29bd(0x128))/0x7;if(_0x365977===_0x113c8f)break;else _0xd75933['push'](_0xd75933['shift']());}catch(_0x8277f3){_0xd75933['push'](_0xd75933['shift']());}}}(a1_0x1e3a,0xd21eb));function a1_0x1f25(_0x1a6ce0,_0x5b9022){const _0x1e3a8=a1_0x1e3a();return a1_0x1f25=function(_0x1f25c6,_0x44616d){_0x1f25c6=_0x1f25c6-0x120;let _0x563df8=_0x1e3a8[_0x1f25c6];return _0x563df8;},a1_0x1f25(_0x1a6ce0,_0x5b9022);}const fs=require('fs')[a1_0x47a1a9(0x13e)],osu=require(a1_0x47a1a9(0x142));function a1_0x1e3a(){const _0x13c089=['Error\x20getting\x20CPU\x20usage:','now','inOut','toString','556668cHTdwb','httpCodesData','slice','stringify','=======>','filter','save','getHours','cadviewer/settings/requests-per-minute.json','method','length','statusCode','end','promises','outputMb','2223702NNPhmR','apply','node-os-utils','getStats','utf8','cadviewer/settings/ressources-usage-stats.json','memory','path','network','netstat','ressourcesUsageStatsPath','byPath','total','Request\x20monitor\x20initialized.','writeFile','getUsageRessourcesStatsAndSave','padStart','3412080wLeypc','usedMemMb','init','2966388aGIrKO','includes','Initializing\x20request\x20monitor...','httpCodesStoragePath','ressourcesUsageStats','push','parse','forEach','Error\x20getting\x20memory\x20usage:','rpsStoragePath','645008ydjNHD','rpsData','time','currentRequests','Request\x20monitor\x20middleware','error','getMinutes','info','lastMinute','exports','then','1393166AOBWVZ','floor','Error\x20saving\x20monitoring\x20data:','codes','readFile','log','cadviewer/settings/http-codes-24h.json','18659116FmCIzP','inputMb','startPeriodicSave','cpu','byCodes'];a1_0x1e3a=function(){return _0x13c089;};return a1_0x1e3a();}class RequestMonitor{static ['rpsStoragePath']=a1_0x47a1a9(0x139);static [a1_0x47a1a9(0x157)]=a1_0x47a1a9(0x127);static ['ressourcesUsageStatsPath']=a1_0x47a1a9(0x145);static [a1_0x47a1a9(0x15f)]=[];static [a1_0x47a1a9(0x132)]=[];static ['ressourcesUsageStats']={};static [a1_0x47a1a9(0x166)]=Math['floor'](Date[a1_0x47a1a9(0x12e)]()/0x3e8/0x3c);static [a1_0x47a1a9(0x161)]=0x0;static async[a1_0x47a1a9(0x153)](){const _0x1c1307=a1_0x47a1a9;console[_0x1c1307(0x126)](_0x1c1307(0x156));try{const _0xe1770=await fs[_0x1c1307(0x125)](RequestMonitor['rpsStoragePath'],_0x1c1307(0x144));RequestMonitor[_0x1c1307(0x15f)]=JSON['parse'](_0xe1770);}catch(_0x35c560){RequestMonitor['rpsData']=[];}try{const _0x271fc0=await fs[_0x1c1307(0x125)](RequestMonitor[_0x1c1307(0x157)],_0x1c1307(0x144));RequestMonitor[_0x1c1307(0x132)]=JSON[_0x1c1307(0x15a)](_0x271fc0);}catch(_0x23efa6){RequestMonitor[_0x1c1307(0x132)]=[];}try{const _0x5a0ab5=await fs[_0x1c1307(0x125)](RequestMonitor[_0x1c1307(0x14a)],'utf8');RequestMonitor[_0x1c1307(0x158)]=JSON[_0x1c1307(0x15a)](_0x5a0ab5),!RequestMonitor[_0x1c1307(0x158)]['cpu']&&(RequestMonitor[_0x1c1307(0x158)][_0x1c1307(0x12b)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x1c1307(0x146)]&&(RequestMonitor[_0x1c1307(0x158)][_0x1c1307(0x146)]=[]),!RequestMonitor[_0x1c1307(0x158)][_0x1c1307(0x148)]&&(RequestMonitor[_0x1c1307(0x158)][_0x1c1307(0x148)]=[]);}catch(_0x39a735){RequestMonitor[_0x1c1307(0x158)]={'cpu':[],'memory':[],'network':[]};}console[_0x1c1307(0x126)](_0x1c1307(0x14d));}static['middleware'](_0x19205f,_0x29683b,_0x37ff11){const _0x364a7e=a1_0x47a1a9;if(_0x19205f[_0x364a7e(0x147)][_0x364a7e(0x155)]('/metrics'))return _0x37ff11();console['log'](_0x364a7e(0x162));let _0x250120=Date[_0x364a7e(0x12e)](),_0x1331e9=Math[_0x364a7e(0x122)](_0x250120/0x3e8/0x3c);console[_0x364a7e(0x126)](_0x364a7e(0x135));const _0x5c76eb=_0x29683b[_0x364a7e(0x13d)];_0x29683b[_0x364a7e(0x13d)]=(..._0x12d733)=>{const _0x29a782=_0x364a7e;console['log'](_0x1331e9,{'currentMinute':_0x1331e9});_0x1331e9>RequestMonitor[_0x29a782(0x166)]&&(RequestMonitor['rpsData'][_0x29a782(0x159)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x29a782(0x161)]}),RequestMonitor[_0x29a782(0x161)]=0x0,RequestMonitor[_0x29a782(0x166)]=_0x1331e9);RequestMonitor[_0x29a782(0x161)]++,RequestMonitor[_0x29a782(0x132)][_0x29a782(0x159)]({'timestamp':Date[_0x29a782(0x12e)](),'statusCode':_0x29683b[_0x29a782(0x13c)],'path':_0x19205f[_0x29a782(0x147)],'method':_0x19205f[_0x29a782(0x13a)]});const _0x1e5355=Date[_0x29a782(0x12e)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x29a782(0x132)]=RequestMonitor[_0x29a782(0x132)][_0x29a782(0x136)](_0x25bc46=>_0x25bc46['timestamp']>_0x1e5355),_0x5c76eb[_0x29a782(0x141)](_0x29683b,_0x12d733);},_0x37ff11();}static async[a1_0x47a1a9(0x137)](){const _0x383031=a1_0x47a1a9;try{RequestMonitor[_0x383031(0x166)]!==Math[_0x383031(0x122)](Date[_0x383031(0x12e)]()/0x3e8/0x3c)&&(RequestMonitor[_0x383031(0x15f)][_0x383031(0x159)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x383031(0x161)]}),RequestMonitor[_0x383031(0x161)]=0x0,RequestMonitor[_0x383031(0x166)]=Math[_0x383031(0x122)](Date['now']()/0x3e8/0x3c)),await fs[_0x383031(0x14e)](RequestMonitor[_0x383031(0x15d)],JSON[_0x383031(0x134)](RequestMonitor['rpsData'],null,0x2)),await fs[_0x383031(0x14e)](RequestMonitor['httpCodesStoragePath'],JSON[_0x383031(0x134)](RequestMonitor[_0x383031(0x132)],null,0x2));}catch(_0x5bd77c){console[_0x383031(0x163)](_0x383031(0x123),_0x5bd77c);}}static async[a1_0x47a1a9(0x12a)](){const _0x416327=a1_0x47a1a9;setInterval(()=>RequestMonitor[_0x416327(0x137)](),0x3c*0x3e8),setInterval(()=>{const _0x59bc19=_0x416327;RequestMonitor[_0x59bc19(0x14f)]()[_0x59bc19(0x120)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x416327(0x14f)]()[_0x416327(0x120)](()=>{});}static async[a1_0x47a1a9(0x14f)](){const _0x4d546c=a1_0x47a1a9,_0x247cc1=osu['cpu'],_0x4b8b25=osu['mem'],_0x3ed0ca=osu[_0x4d546c(0x149)],_0x288881={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x2d0ee9=await _0x3ed0ca[_0x4d546c(0x12f)]();_0x288881['total'][_0x4d546c(0x129)]=_0x2d0ee9[_0x4d546c(0x14c)]['inputMb'],_0x288881[_0x4d546c(0x14c)]['outputMb']=_0x2d0ee9[_0x4d546c(0x14c)][_0x4d546c(0x13f)];}catch(_0x7274cb){}let _0x1db55d=0x0;try{_0x1db55d=await _0x247cc1['usage']();}catch(_0x2291e3){console['log'](_0x4d546c(0x12d),_0x2291e3);}const _0x1b24bf={'usedMemMb':0x0};try{const _0x10901f=await _0x4b8b25[_0x4d546c(0x165)]();_0x1b24bf[_0x4d546c(0x152)]=_0x10901f[_0x4d546c(0x152)];}catch(_0x5b62e3){console[_0x4d546c(0x126)](_0x4d546c(0x15c),_0x5b62e3);}const _0x17b485=new Date()[_0x4d546c(0x138)]()['toString']()[_0x4d546c(0x150)](0x2,'0')+':'+new Date()[_0x4d546c(0x164)]()[_0x4d546c(0x130)]()['padStart'](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x4d546c(0x12b)]=RequestMonitor[_0x4d546c(0x158)]['cpu'][_0x4d546c(0x133)](-0x3c)[_0x4d546c(0x136)](_0x102455=>_0x102455[_0x4d546c(0x160)]!==_0x17b485),RequestMonitor[_0x4d546c(0x158)][_0x4d546c(0x146)]=RequestMonitor[_0x4d546c(0x158)][_0x4d546c(0x146)]['slice'](-0x3c)['filter'](_0xb2b84a=>_0xb2b84a[_0x4d546c(0x160)]!==_0x17b485),RequestMonitor[_0x4d546c(0x158)][_0x4d546c(0x148)]=RequestMonitor[_0x4d546c(0x158)]['network'][_0x4d546c(0x133)](-0x3c)['filter'](_0x175e93=>_0x175e93['time']!==_0x17b485),RequestMonitor[_0x4d546c(0x158)][_0x4d546c(0x12b)][_0x4d546c(0x159)]({'time':_0x17b485,'usage':_0x1db55d}),RequestMonitor['ressourcesUsageStats'][_0x4d546c(0x146)]['push']({'time':_0x17b485,'usage':(_0x1b24bf[_0x4d546c(0x152)]/0x3e8)['toFixed'](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x4d546c(0x148)][_0x4d546c(0x159)]({'time':_0x17b485,'usage':{'in':_0x288881['total']?.[_0x4d546c(0x129)]??0x0,'out':_0x288881[_0x4d546c(0x14c)]?.[_0x4d546c(0x13f)]??0x0}});try{await fs[_0x4d546c(0x14e)](RequestMonitor[_0x4d546c(0x14a)],JSON[_0x4d546c(0x134)](RequestMonitor[_0x4d546c(0x158)],null,0x2));}catch(_0x593550){console[_0x4d546c(0x163)](_0x4d546c(0x123),_0x593550);}}static[a1_0x47a1a9(0x143)](){const _0xe8b6e6=a1_0x47a1a9,_0x2c1d55=Date[_0xe8b6e6(0x12e)](),_0x246712=_0x2c1d55-0x3c*0x3c*0x3e8,_0x4bd8e6=_0x2c1d55-0x18*0x3c*0x3c*0x3e8,_0x31a300=RequestMonitor[_0xe8b6e6(0x15f)][_0xe8b6e6(0x136)](_0x381073=>_0x381073['timestamp']>_0x246712),_0x1b46d4={'total':RequestMonitor[_0xe8b6e6(0x132)][_0xe8b6e6(0x13b)],'byCodes':{},'byPath':{}};return RequestMonitor[_0xe8b6e6(0x132)][_0xe8b6e6(0x15b)](_0x1298fd=>{const _0xba1337=_0xe8b6e6;_0x1b46d4[_0xba1337(0x12c)][_0x1298fd[_0xba1337(0x13c)]]=(_0x1b46d4[_0xba1337(0x12c)][_0x1298fd[_0xba1337(0x13c)]]||0x0)+0x1;const _0x55cb02=_0x1298fd[_0xba1337(0x13a)]+'\x20'+_0x1298fd[_0xba1337(0x147)];!_0x1b46d4[_0xba1337(0x14b)][_0x55cb02]&&(_0x1b46d4[_0xba1337(0x14b)][_0x55cb02]={'total':0x0,'codes':{}}),_0x1b46d4[_0xba1337(0x14b)][_0x55cb02][_0xba1337(0x14c)]++,_0x1b46d4[_0xba1337(0x14b)][_0x55cb02][_0xba1337(0x124)][_0x1298fd[_0xba1337(0x13c)]]=(_0x1b46d4['byPath'][_0x55cb02]['codes'][_0x1298fd[_0xba1337(0x13c)]]||0x0)+0x1;}),{'rps':_0x31a300,'httpCodes':_0x1b46d4,'ressourcesUsageStats':RequestMonitor[_0xe8b6e6(0x158)]};}}RequestMonitor[a1_0x47a1a9(0x153)]()['then'](()=>{}),RequestMonitor[a1_0x47a1a9(0x12a)]();const counter=RequestMonitor;module[a1_0x47a1a9(0x167)]=counter;