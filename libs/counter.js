function a1_0x26f6(){const _0x55f004=['readFile','86353GoioVc','usage','httpCodesStoragePath','76456SUWPQW','memory','cpu','push','byPath','rpsData','slice','middleware','total','parse','lastMinute','mem','usedMemMb','84mWDEsu','5XZFjaS','8781650fOJqoL','toString','info','apply','inputMb','save','252TYQhom','statusCode','startPeriodicSave','error','now','3641202ULljCK','cadviewer/settings/ressources-usage-stats.json','time','inOut','then','init','timestamp','Initializing\x20request\x20monitor...','outputMb','getUsageRessourcesStatsAndSave','floor','byCodes','9015699zKdZwq','20ItxqrL','rpsStoragePath','getMinutes','end','network','getStats','method','node-os-utils','writeFile','forEach','utf8','Error\x20saving\x20monitoring\x20data:','promises','includes','log','2706214gbzGIS','Error\x20getting\x20memory\x20usage:','length','ressourcesUsageStatsPath','httpCodesData','76792MzqKuE','stringify','filter','Error\x20getting\x20CPU\x20usage:','currentRequests','codes','path','ressourcesUsageStats'];a1_0x26f6=function(){return _0x55f004;};return a1_0x26f6();}const a1_0x50cb21=a1_0x2619;(function(_0x3b792a,_0x3b93c3){const _0x1901cf=a1_0x2619,_0x443a39=_0x3b792a();while(!![]){try{const _0x175fa1=-parseInt(_0x1901cf(0x192))/0x1*(-parseInt(_0x1901cf(0x1bc))/0x2)+parseInt(_0x1901cf(0x1a2))/0x3*(-parseInt(_0x1901cf(0x189))/0x4)+parseInt(_0x1901cf(0x1a3))/0x5*(parseInt(_0x1901cf(0x1af))/0x6)+-parseInt(_0x1901cf(0x184))/0x7+-parseInt(_0x1901cf(0x195))/0x8*(-parseInt(_0x1901cf(0x1aa))/0x9)+-parseInt(_0x1901cf(0x1a4))/0xa+parseInt(_0x1901cf(0x1bb))/0xb;if(_0x175fa1===_0x3b93c3)break;else _0x443a39['push'](_0x443a39['shift']());}catch(_0x5ba52e){_0x443a39['push'](_0x443a39['shift']());}}}(a1_0x26f6,0xb865b));function a1_0x2619(_0x705b9f,_0x30d8a0){const _0x26f633=a1_0x26f6();return a1_0x2619=function(_0x26193a,_0x1c386d){_0x26193a=_0x26193a-0x184;let _0x197e0c=_0x26f633[_0x26193a];return _0x197e0c;},a1_0x2619(_0x705b9f,_0x30d8a0);}const fs=require('fs')[a1_0x50cb21(0x1c8)],osu=require(a1_0x50cb21(0x1c3));class RequestMonitor{static [a1_0x50cb21(0x1bd)]='cadviewer/settings/requests-per-minute.json';static ['httpCodesStoragePath']='cadviewer/settings/http-codes-24h.json';static ['ressourcesUsageStatsPath']=a1_0x50cb21(0x1b0);static [a1_0x50cb21(0x19a)]=[];static [a1_0x50cb21(0x188)]=[];static [a1_0x50cb21(0x190)]={};static [a1_0x50cb21(0x19f)]=Math[a1_0x50cb21(0x1b9)](Date[a1_0x50cb21(0x1ae)]()/0x3e8/0x3c);static [a1_0x50cb21(0x18d)]=0x0;static async[a1_0x50cb21(0x1b4)](){const _0x163b24=a1_0x50cb21;console[_0x163b24(0x1ca)](_0x163b24(0x1b6));try{const _0x2e7002=await fs[_0x163b24(0x191)](RequestMonitor[_0x163b24(0x1bd)],_0x163b24(0x1c6));RequestMonitor[_0x163b24(0x19a)]=JSON[_0x163b24(0x19e)](_0x2e7002);}catch(_0x4b28ba){RequestMonitor[_0x163b24(0x19a)]=[];}try{const _0x3f4774=await fs[_0x163b24(0x191)](RequestMonitor[_0x163b24(0x194)],_0x163b24(0x1c6));RequestMonitor[_0x163b24(0x188)]=JSON[_0x163b24(0x19e)](_0x3f4774);}catch(_0x1d7cf6){RequestMonitor[_0x163b24(0x188)]=[];}try{const _0x2b3f99=await fs['readFile'](RequestMonitor[_0x163b24(0x187)],_0x163b24(0x1c6));RequestMonitor[_0x163b24(0x190)]=JSON[_0x163b24(0x19e)](_0x2b3f99),!RequestMonitor['ressourcesUsageStats'][_0x163b24(0x197)]&&(RequestMonitor[_0x163b24(0x190)][_0x163b24(0x197)]=[]),!RequestMonitor[_0x163b24(0x190)][_0x163b24(0x196)]&&(RequestMonitor[_0x163b24(0x190)][_0x163b24(0x196)]=[]),!RequestMonitor[_0x163b24(0x190)][_0x163b24(0x1c0)]&&(RequestMonitor['ressourcesUsageStats'][_0x163b24(0x1c0)]=[]);}catch(_0x4e717f){RequestMonitor[_0x163b24(0x190)]={'cpu':[],'memory':[],'network':[]};}console[_0x163b24(0x1ca)]('Request\x20monitor\x20initialized.');}static[a1_0x50cb21(0x19c)](_0xe2ab11,_0x5d6d5b,_0x46efa3){const _0x141634=a1_0x50cb21;if(_0xe2ab11[_0x141634(0x18f)][_0x141634(0x1c9)]('/metrics'))return _0x46efa3();console[_0x141634(0x1ca)]('Request\x20monitor\x20middleware');let _0xcd77c5=Date[_0x141634(0x1ae)](),_0x2a58e1=Math[_0x141634(0x1b9)](_0xcd77c5/0x3e8/0x3c);console[_0x141634(0x1ca)]('=======>');const _0x221284=_0x5d6d5b[_0x141634(0x1bf)];_0x5d6d5b[_0x141634(0x1bf)]=(..._0x10fe0c)=>{const _0x46a91d=_0x141634;console[_0x46a91d(0x1ca)](_0x2a58e1,{'currentMinute':_0x2a58e1});_0x2a58e1>RequestMonitor[_0x46a91d(0x19f)]&&(RequestMonitor['rpsData']['push']({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x46a91d(0x18d)]}),RequestMonitor[_0x46a91d(0x18d)]=0x0,RequestMonitor[_0x46a91d(0x19f)]=_0x2a58e1);RequestMonitor[_0x46a91d(0x18d)]++,RequestMonitor[_0x46a91d(0x188)]['push']({'timestamp':Date[_0x46a91d(0x1ae)](),'statusCode':_0x5d6d5b['statusCode'],'path':_0xe2ab11[_0x46a91d(0x18f)],'method':_0xe2ab11[_0x46a91d(0x1c2)]});const _0x2047b3=Date[_0x46a91d(0x1ae)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor[_0x46a91d(0x188)][_0x46a91d(0x18b)](_0x37a96d=>_0x37a96d[_0x46a91d(0x1b5)]>_0x2047b3),_0x221284[_0x46a91d(0x1a7)](_0x5d6d5b,_0x10fe0c);},_0x46efa3();}static async[a1_0x50cb21(0x1a9)](){const _0x5ed8e8=a1_0x50cb21;try{RequestMonitor[_0x5ed8e8(0x19f)]!==Math[_0x5ed8e8(0x1b9)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x5ed8e8(0x19a)][_0x5ed8e8(0x198)]({'timestamp':RequestMonitor[_0x5ed8e8(0x19f)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x5ed8e8(0x18d)]=0x0,RequestMonitor[_0x5ed8e8(0x19f)]=Math[_0x5ed8e8(0x1b9)](Date[_0x5ed8e8(0x1ae)]()/0x3e8/0x3c)),await fs[_0x5ed8e8(0x1c4)](RequestMonitor[_0x5ed8e8(0x1bd)],JSON[_0x5ed8e8(0x18a)](RequestMonitor[_0x5ed8e8(0x19a)],null,0x2)),await fs[_0x5ed8e8(0x1c4)](RequestMonitor['httpCodesStoragePath'],JSON[_0x5ed8e8(0x18a)](RequestMonitor[_0x5ed8e8(0x188)],null,0x2));}catch(_0x472b0e){console[_0x5ed8e8(0x1ad)](_0x5ed8e8(0x1c7),_0x472b0e);}}static async[a1_0x50cb21(0x1ac)](){const _0x14738c=a1_0x50cb21;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x48e944=a1_0x2619;RequestMonitor[_0x48e944(0x1b8)]()['then'](()=>{});},0x3c*0x3e8),RequestMonitor[_0x14738c(0x1b8)]()[_0x14738c(0x1b3)](()=>{});}static async[a1_0x50cb21(0x1b8)](){const _0x35f404=a1_0x50cb21,_0x27ef1e=osu['cpu'],_0xff0903=osu[_0x35f404(0x1a0)],_0x2b8cc4=osu['netstat'],_0x5e73cf={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x2bb23a=await _0x2b8cc4[_0x35f404(0x1b2)]();_0x5e73cf[_0x35f404(0x19d)][_0x35f404(0x1a8)]=_0x2bb23a[_0x35f404(0x19d)][_0x35f404(0x1a8)],_0x5e73cf[_0x35f404(0x19d)]['outputMb']=_0x2bb23a[_0x35f404(0x19d)][_0x35f404(0x1b7)];}catch(_0x36edd8){}let _0x1ca589=0x0;try{_0x1ca589=await _0x27ef1e[_0x35f404(0x193)]();}catch(_0x3ee240){console[_0x35f404(0x1ca)](_0x35f404(0x18c),_0x3ee240);}const _0xbc5446={'usedMemMb':0x0};try{const _0x1d21ef=await _0xff0903[_0x35f404(0x1a6)]();_0xbc5446['usedMemMb']=_0x1d21ef[_0x35f404(0x1a1)];}catch(_0x35c599){console[_0x35f404(0x1ca)](_0x35f404(0x185),_0x35c599);}const _0x368507=new Date()['getHours']()[_0x35f404(0x1a5)]()['padStart'](0x2,'0')+':'+new Date()[_0x35f404(0x1be)]()[_0x35f404(0x1a5)]()['padStart'](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x35f404(0x197)]=RequestMonitor['ressourcesUsageStats']['cpu']['slice'](-0x3c)['filter'](_0xf9872=>_0xf9872[_0x35f404(0x1b1)]!==_0x368507),RequestMonitor[_0x35f404(0x190)][_0x35f404(0x196)]=RequestMonitor['ressourcesUsageStats'][_0x35f404(0x196)][_0x35f404(0x19b)](-0x3c)[_0x35f404(0x18b)](_0x301eeb=>_0x301eeb[_0x35f404(0x1b1)]!==_0x368507),RequestMonitor[_0x35f404(0x190)]['network']=RequestMonitor[_0x35f404(0x190)][_0x35f404(0x1c0)][_0x35f404(0x19b)](-0x3c)[_0x35f404(0x18b)](_0x2d2eb9=>_0x2d2eb9['time']!==_0x368507),RequestMonitor[_0x35f404(0x190)][_0x35f404(0x197)][_0x35f404(0x198)]({'time':_0x368507,'usage':_0x1ca589}),RequestMonitor[_0x35f404(0x190)][_0x35f404(0x196)]['push']({'time':_0x368507,'usage':(_0xbc5446[_0x35f404(0x1a1)]/0x3e8)['toFixed'](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x35f404(0x1c0)]['push']({'time':_0x368507,'usage':{'in':_0x5e73cf[_0x35f404(0x19d)]?.['inputMb']??0x0,'out':_0x5e73cf[_0x35f404(0x19d)]?.[_0x35f404(0x1b7)]??0x0}});try{await fs[_0x35f404(0x1c4)](RequestMonitor[_0x35f404(0x187)],JSON['stringify'](RequestMonitor[_0x35f404(0x190)],null,0x2));}catch(_0x59152d){console[_0x35f404(0x1ad)](_0x35f404(0x1c7),_0x59152d);}}static[a1_0x50cb21(0x1c1)](){const _0x1df6aa=a1_0x50cb21,_0x2ba36b=Date['now'](),_0x252281=_0x2ba36b-0x3c*0x3c*0x3e8,_0x233bc2=_0x2ba36b-0x18*0x3c*0x3c*0x3e8,_0x186a2c=RequestMonitor[_0x1df6aa(0x19a)][_0x1df6aa(0x18b)](_0x24cb0f=>_0x24cb0f[_0x1df6aa(0x1b5)]>_0x252281),_0x348df2={'total':RequestMonitor['httpCodesData'][_0x1df6aa(0x186)],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x1df6aa(0x1c5)](_0x53a7c0=>{const _0x1cb69a=_0x1df6aa;_0x348df2['byCodes'][_0x53a7c0[_0x1cb69a(0x1ab)]]=(_0x348df2[_0x1cb69a(0x1ba)][_0x53a7c0[_0x1cb69a(0x1ab)]]||0x0)+0x1;const _0x3f339b=_0x53a7c0[_0x1cb69a(0x1c2)]+'\x20'+_0x53a7c0[_0x1cb69a(0x18f)];!_0x348df2[_0x1cb69a(0x199)][_0x3f339b]&&(_0x348df2[_0x1cb69a(0x199)][_0x3f339b]={'total':0x0,'codes':{}}),_0x348df2['byPath'][_0x3f339b][_0x1cb69a(0x19d)]++,_0x348df2['byPath'][_0x3f339b]['codes'][_0x53a7c0[_0x1cb69a(0x1ab)]]=(_0x348df2[_0x1cb69a(0x199)][_0x3f339b][_0x1cb69a(0x18e)][_0x53a7c0['statusCode']]||0x0)+0x1;}),{'rps':_0x186a2c,'httpCodes':_0x348df2,'ressourcesUsageStats':RequestMonitor[_0x1df6aa(0x190)]};}}RequestMonitor[a1_0x50cb21(0x1b4)]()['then'](()=>{}),RequestMonitor[a1_0x50cb21(0x1ac)]();const counter=RequestMonitor;module['exports']=counter;