const a1_0x4a553b=a1_0x1841;(function(_0x2dfc6a,_0x4aa6da){const _0x372474=a1_0x1841,_0x2b4d88=_0x2dfc6a();while(!![]){try{const _0x202cf8=-parseInt(_0x372474(0xeb))/0x1*(-parseInt(_0x372474(0xf2))/0x2)+parseInt(_0x372474(0x12e))/0x3*(parseInt(_0x372474(0x101))/0x4)+-parseInt(_0x372474(0x124))/0x5*(-parseInt(_0x372474(0x123))/0x6)+-parseInt(_0x372474(0x130))/0x7+-parseInt(_0x372474(0x110))/0x8+parseInt(_0x372474(0xf0))/0x9+parseInt(_0x372474(0x114))/0xa*(-parseInt(_0x372474(0xf7))/0xb);if(_0x202cf8===_0x4aa6da)break;else _0x2b4d88['push'](_0x2b4d88['shift']());}catch(_0x3a4c68){_0x2b4d88['push'](_0x2b4d88['shift']());}}}(a1_0x1cde,0x9046b));const fs=require('fs')[a1_0x4a553b(0x109)],osu=require('node-os-utils');class RequestMonitor{static [a1_0x4a553b(0x125)]=a1_0x4a553b(0xea);static [a1_0x4a553b(0xfd)]=a1_0x4a553b(0x115);static ['ressourcesUsageStatsPath']=a1_0x4a553b(0xf4);static [a1_0x4a553b(0x10b)]=[];static ['httpCodesData']=[];static [a1_0x4a553b(0xfe)]={};static [a1_0x4a553b(0x12f)]=Math[a1_0x4a553b(0x10d)](Date[a1_0x4a553b(0x106)]()/0x3e8/0x3c);static [a1_0x4a553b(0x111)]=0x0;static async['init'](){const _0x203c7d=a1_0x4a553b;console['log']('Initializing\x20request\x20monitor...');try{const _0x364921=await fs['readFile'](RequestMonitor['rpsStoragePath'],_0x203c7d(0xf1));RequestMonitor['rpsData']=JSON[_0x203c7d(0x11f)](_0x364921);}catch(_0xe31f89){RequestMonitor[_0x203c7d(0x10b)]=[];}try{const _0x5b4823=await fs[_0x203c7d(0x12a)](RequestMonitor[_0x203c7d(0xfd)],_0x203c7d(0xf1));RequestMonitor['httpCodesData']=JSON[_0x203c7d(0x11f)](_0x5b4823);}catch(_0x4423e4){RequestMonitor[_0x203c7d(0x12c)]=[];}try{const _0x4b8749=await fs[_0x203c7d(0x12a)](RequestMonitor['ressourcesUsageStatsPath'],_0x203c7d(0xf1));RequestMonitor[_0x203c7d(0xfe)]=JSON[_0x203c7d(0x11f)](_0x4b8749),!RequestMonitor[_0x203c7d(0xfe)][_0x203c7d(0x102)]&&(RequestMonitor[_0x203c7d(0xfe)][_0x203c7d(0x102)]=[]),!RequestMonitor[_0x203c7d(0xfe)][_0x203c7d(0x10e)]&&(RequestMonitor['ressourcesUsageStats']['memory']=[]),!RequestMonitor['ressourcesUsageStats']['network']&&(RequestMonitor[_0x203c7d(0xfe)][_0x203c7d(0x11d)]=[]);}catch(_0x6b6eb8){RequestMonitor[_0x203c7d(0xfe)]={'cpu':[],'memory':[],'network':[]};}console[_0x203c7d(0xff)]('Request\x20monitor\x20initialized.');}static['middleware'](_0x3db8da,_0x2eca4b,_0x4c7c78){const _0x56ed06=a1_0x4a553b;if(_0x3db8da[_0x56ed06(0xed)][_0x56ed06(0x108)]('/metrics'))return _0x4c7c78();console['log'](_0x56ed06(0xfb));let _0x5291c8=Date['now'](),_0xd4a669=Math[_0x56ed06(0x10d)](_0x5291c8/0x3e8/0x3c);console[_0x56ed06(0xff)](_0x56ed06(0x107));const _0x33f108=_0x2eca4b[_0x56ed06(0xef)];_0x2eca4b[_0x56ed06(0xef)]=(..._0x4614e6)=>{const _0x54efd9=_0x56ed06;console[_0x54efd9(0xff)](_0xd4a669,{'currentMinute':_0xd4a669});_0xd4a669>RequestMonitor[_0x54efd9(0x12f)]&&(RequestMonitor[_0x54efd9(0x10b)][_0x54efd9(0xe9)]({'timestamp':RequestMonitor[_0x54efd9(0x12f)]*0x3e8*0x3c,'requests':RequestMonitor[_0x54efd9(0x111)]}),RequestMonitor[_0x54efd9(0x111)]=0x0,RequestMonitor[_0x54efd9(0x12f)]=_0xd4a669);RequestMonitor[_0x54efd9(0x111)]++,RequestMonitor[_0x54efd9(0x12c)]['push']({'timestamp':Date['now'](),'statusCode':_0x2eca4b['statusCode'],'path':_0x3db8da['path'],'method':_0x3db8da[_0x54efd9(0x121)]});const _0x38db4c=Date[_0x54efd9(0x106)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x54efd9(0x12c)]=RequestMonitor[_0x54efd9(0x12c)][_0x54efd9(0x12b)](_0x1be2fe=>_0x1be2fe[_0x54efd9(0x116)]>_0x38db4c),_0x33f108['apply'](_0x2eca4b,_0x4614e6);},_0x4c7c78();}static async['save'](){const _0x44865c=a1_0x4a553b;try{RequestMonitor[_0x44865c(0x12f)]!==Math['floor'](Date[_0x44865c(0x106)]()/0x3e8/0x3c)&&(RequestMonitor[_0x44865c(0x10b)]['push']({'timestamp':RequestMonitor[_0x44865c(0x12f)]*0x3e8*0x3c,'requests':RequestMonitor[_0x44865c(0x111)]}),RequestMonitor[_0x44865c(0x111)]=0x0,RequestMonitor[_0x44865c(0x12f)]=Math[_0x44865c(0x10d)](Date[_0x44865c(0x106)]()/0x3e8/0x3c)),await fs[_0x44865c(0x128)](RequestMonitor[_0x44865c(0x125)],JSON[_0x44865c(0x117)](RequestMonitor['rpsData'],null,0x2)),await fs['writeFile'](RequestMonitor[_0x44865c(0xfd)],JSON[_0x44865c(0x117)](RequestMonitor[_0x44865c(0x12c)],null,0x2));}catch(_0x1adde1){console[_0x44865c(0x100)](_0x44865c(0x10a),_0x1adde1);}}static async['startPeriodicSave'](){const _0xa1ea72=a1_0x4a553b;setInterval(()=>RequestMonitor[_0xa1ea72(0x10c)](),0x3c*0x3e8),setInterval(()=>{const _0x8443c6=_0xa1ea72;RequestMonitor[_0x8443c6(0x103)]()['then'](()=>{});},0x3c*0x3e8),RequestMonitor[_0xa1ea72(0x103)]()[_0xa1ea72(0x127)](()=>{});}static async['getUsageRessourcesStatsAndSave'](){const _0x1d4254=a1_0x4a553b,_0x3ad89b=osu['cpu'],_0x581d28=osu[_0x1d4254(0x11c)],_0xc94f4=osu[_0x1d4254(0x126)],_0x2f47c1={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x2592a5=await _0xc94f4[_0x1d4254(0xf6)]();_0x2f47c1[_0x1d4254(0x119)][_0x1d4254(0x10f)]=_0x2592a5[_0x1d4254(0x119)][_0x1d4254(0x10f)],_0x2f47c1[_0x1d4254(0x119)]['outputMb']=_0x2592a5[_0x1d4254(0x119)][_0x1d4254(0x120)];}catch(_0x554c07){}let _0x289d75=0x0;try{_0x289d75=await _0x3ad89b['usage']();}catch(_0x28f377){console[_0x1d4254(0xff)]('Error\x20getting\x20CPU\x20usage:',_0x28f377);}const _0x3d2f4a={'usedMemMb':0x0};try{const _0x2a2cb7=await _0x581d28[_0x1d4254(0xf8)]();_0x3d2f4a[_0x1d4254(0x11a)]=_0x2a2cb7[_0x1d4254(0x11a)];}catch(_0x5e6368){console[_0x1d4254(0xff)]('Error\x20getting\x20memory\x20usage:',_0x5e6368);}const _0x41763c=new Date()[_0x1d4254(0x11b)]()[_0x1d4254(0x12d)]()[_0x1d4254(0xf9)](0x2,'0')+':'+new Date()[_0x1d4254(0x104)]()[_0x1d4254(0x12d)]()['padStart'](0x2,'0');RequestMonitor[_0x1d4254(0xfe)][_0x1d4254(0x102)]=RequestMonitor[_0x1d4254(0xfe)][_0x1d4254(0x102)][_0x1d4254(0xf3)](-0x3c)[_0x1d4254(0x12b)](_0xad897=>_0xad897['time']!==_0x41763c),RequestMonitor[_0x1d4254(0xfe)]['memory']=RequestMonitor[_0x1d4254(0xfe)][_0x1d4254(0x10e)][_0x1d4254(0xf3)](-0x3c)[_0x1d4254(0x12b)](_0x3e70a0=>_0x3e70a0[_0x1d4254(0x113)]!==_0x41763c),RequestMonitor[_0x1d4254(0xfe)][_0x1d4254(0x11d)]=RequestMonitor[_0x1d4254(0xfe)][_0x1d4254(0x11d)][_0x1d4254(0xf3)](-0x3c)[_0x1d4254(0x12b)](_0x5f4e2a=>_0x5f4e2a['time']!==_0x41763c),RequestMonitor[_0x1d4254(0xfe)]['cpu'][_0x1d4254(0xe9)]({'time':_0x41763c,'usage':_0x289d75}),RequestMonitor[_0x1d4254(0xfe)][_0x1d4254(0x10e)][_0x1d4254(0xe9)]({'time':_0x41763c,'usage':(_0x3d2f4a['usedMemMb']/0x3e8)[_0x1d4254(0x122)](0x2)}),RequestMonitor[_0x1d4254(0xfe)][_0x1d4254(0x11d)][_0x1d4254(0xe9)]({'time':_0x41763c,'usage':{'in':_0x2f47c1[_0x1d4254(0x119)]?.[_0x1d4254(0x10f)]??0x0,'out':_0x2f47c1[_0x1d4254(0x119)]?.['outputMb']??0x0}});try{await fs[_0x1d4254(0x128)](RequestMonitor['ressourcesUsageStatsPath'],JSON[_0x1d4254(0x117)](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x606fe1){console[_0x1d4254(0x100)](_0x1d4254(0x10a),_0x606fe1);}}static[a1_0x4a553b(0x112)](){const _0x14c169=a1_0x4a553b,_0x1ac8ba=Date[_0x14c169(0x106)](),_0x15df30=_0x1ac8ba-0x3c*0x3c*0x3e8,_0x121175=_0x1ac8ba-0x18*0x3c*0x3c*0x3e8,_0x4a7cc9=RequestMonitor[_0x14c169(0x10b)][_0x14c169(0x12b)](_0x57d2c4=>_0x57d2c4['timestamp']>_0x15df30),_0x45af56={'total':RequestMonitor['httpCodesData'][_0x14c169(0xfa)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x14c169(0x12c)][_0x14c169(0x129)](_0x2f197a=>{const _0x39036b=_0x14c169;_0x45af56['byCodes'][_0x2f197a['statusCode']]=(_0x45af56[_0x39036b(0x105)][_0x2f197a[_0x39036b(0xee)]]||0x0)+0x1;const _0x3ef59f=_0x2f197a[_0x39036b(0x121)]+'\x20'+_0x2f197a['path'];!_0x45af56['byPath'][_0x3ef59f]&&(_0x45af56[_0x39036b(0x11e)][_0x3ef59f]={'total':0x0,'codes':{}}),_0x45af56[_0x39036b(0x11e)][_0x3ef59f]['total']++,_0x45af56[_0x39036b(0x11e)][_0x3ef59f]['codes'][_0x2f197a[_0x39036b(0xee)]]=(_0x45af56[_0x39036b(0x11e)][_0x3ef59f][_0x39036b(0xfc)][_0x2f197a[_0x39036b(0xee)]]||0x0)+0x1;}),{'rps':_0x4a7cc9,'httpCodes':_0x45af56,'ressourcesUsageStats':RequestMonitor[_0x14c169(0xfe)]};}}RequestMonitor[a1_0x4a553b(0x118)]()[a1_0x4a553b(0x127)](()=>{}),RequestMonitor[a1_0x4a553b(0xec)]();function a1_0x1841(_0x3fa979,_0x36bd8f){const _0x1cde60=a1_0x1cde();return a1_0x1841=function(_0x1841e1,_0x2e27d6){_0x1841e1=_0x1841e1-0xe9;let _0xbbba47=_0x1cde60[_0x1841e1];return _0xbbba47;},a1_0x1841(_0x3fa979,_0x36bd8f);}function a1_0x1cde(){const _0x456aea=['save','floor','memory','inputMb','638488DmoGaG','currentRequests','getStats','time','10cvfIOL','cadviewer/settings/http-codes-24h.json','timestamp','stringify','init','total','usedMemMb','getHours','mem','network','byPath','parse','outputMb','method','toFixed','330AsQJRa','101945qfkXUB','rpsStoragePath','netstat','then','writeFile','forEach','readFile','filter','httpCodesData','toString','15Chvyao','lastMinute','6466159jlDwLD','push','cadviewer/settings/requests-per-minute.json','1eVYpzK','startPeriodicSave','path','statusCode','end','6287679FGLqMs','utf8','625286TpUAiF','slice','cadviewer/settings/ressources-usage-stats.json','exports','inOut','18585941lEcjyG','info','padStart','length','Request\x20monitor\x20middleware','codes','httpCodesStoragePath','ressourcesUsageStats','log','error','921172zGABIN','cpu','getUsageRessourcesStatsAndSave','getMinutes','byCodes','now','=======>','includes','promises','Error\x20saving\x20monitoring\x20data:','rpsData'];a1_0x1cde=function(){return _0x456aea;};return a1_0x1cde();}const counter=RequestMonitor;module[a1_0x4a553b(0xf5)]=counter;