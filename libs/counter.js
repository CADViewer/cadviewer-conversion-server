const a1_0x591422=a1_0x3df2;function a1_0x3df2(_0x1d7b7e,_0x216f58){const _0x49ed87=a1_0x49ed();return a1_0x3df2=function(_0x3df2e3,_0x48a2e7){_0x3df2e3=_0x3df2e3-0x1e7;let _0xc76b3c=_0x49ed87[_0x3df2e3];return _0xc76b3c;},a1_0x3df2(_0x1d7b7e,_0x216f58);}function a1_0x49ed(){const _0x269a9f=['readFile','utf8','floor','cadviewer/settings/requests-per-minute.json','node-os-utils','Initializing\x20request\x20monitor...','mem','network','376SWZXQy','/metrics','netstat','10242zUlNFR','usage','getMinutes','2McdClZ','inputMb','getStats','method','rpsStoragePath','push','stringify','12ZPDIXE','then','421076zONyOg','rpsData','11bTKvbx','444pFfIRj','includes','byCodes','httpCodesStoragePath','path','outputMb','inOut','ressourcesUsageStats','cadviewer/settings/http-codes-24h.json','middleware','writeFile','15505tHzHcW','statusCode','memory','getUsageRessourcesStatsAndSave','234962XUGIIv','promises','Error\x20getting\x20CPU\x20usage:','cpu','httpCodesData','error','cadviewer/settings/ressources-usage-stats.json','timestamp','save','info','init','total','parse','byPath','log','end','3414894hJehWi','Error\x20getting\x20memory\x20usage:','toFixed','Request\x20monitor\x20middleware','toString','codes','startPeriodicSave','4013090UfcFiR','ressourcesUsageStatsPath','padStart','18561384lcglOM','filter','now','lastMinute','usedMemMb','Request\x20monitor\x20initialized.','time','currentRequests','Error\x20saving\x20monitoring\x20data:'];a1_0x49ed=function(){return _0x269a9f;};return a1_0x49ed();}(function(_0x4d8572,_0x4cf627){const _0x554e47=a1_0x3df2,_0x2a3440=_0x4d8572();while(!![]){try{const _0x354016=-parseInt(_0x554e47(0x21e))/0x1*(-parseInt(_0x554e47(0x203))/0x2)+-parseInt(_0x554e47(0x20a))/0x3*(parseInt(_0x554e47(0x20c))/0x4)+parseInt(_0x554e47(0x21a))/0x5*(-parseInt(_0x554e47(0x20f))/0x6)+-parseInt(_0x554e47(0x22e))/0x7+-parseInt(_0x554e47(0x1fd))/0x8*(-parseInt(_0x554e47(0x200))/0x9)+parseInt(_0x554e47(0x1e9))/0xa*(-parseInt(_0x554e47(0x20e))/0xb)+parseInt(_0x554e47(0x1ec))/0xc;if(_0x354016===_0x4cf627)break;else _0x2a3440['push'](_0x2a3440['shift']());}catch(_0x2f5335){_0x2a3440['push'](_0x2a3440['shift']());}}}(a1_0x49ed,0x48269));const fs=require('fs')[a1_0x591422(0x21f)],osu=require(a1_0x591422(0x1f9));class RequestMonitor{static [a1_0x591422(0x207)]=a1_0x591422(0x1f8);static [a1_0x591422(0x212)]=a1_0x591422(0x217);static ['ressourcesUsageStatsPath']=a1_0x591422(0x224);static [a1_0x591422(0x20d)]=[];static [a1_0x591422(0x222)]=[];static [a1_0x591422(0x216)]={};static [a1_0x591422(0x1ef)]=Math[a1_0x591422(0x1f7)](Date['now']()/0x3e8/0x3c);static [a1_0x591422(0x1f3)]=0x0;static async['init'](){const _0x306023=a1_0x591422;console[_0x306023(0x22c)](_0x306023(0x1fa));try{const _0x467480=await fs[_0x306023(0x1f5)](RequestMonitor[_0x306023(0x207)],_0x306023(0x1f6));RequestMonitor[_0x306023(0x20d)]=JSON['parse'](_0x467480);}catch(_0x1a9289){RequestMonitor[_0x306023(0x20d)]=[];}try{const _0xdd1a3f=await fs[_0x306023(0x1f5)](RequestMonitor[_0x306023(0x212)],'utf8');RequestMonitor['httpCodesData']=JSON[_0x306023(0x22a)](_0xdd1a3f);}catch(_0x5962f2){RequestMonitor[_0x306023(0x222)]=[];}try{const _0x218508=await fs[_0x306023(0x1f5)](RequestMonitor[_0x306023(0x1ea)],_0x306023(0x1f6));RequestMonitor[_0x306023(0x216)]=JSON[_0x306023(0x22a)](_0x218508),!RequestMonitor[_0x306023(0x216)][_0x306023(0x221)]&&(RequestMonitor[_0x306023(0x216)][_0x306023(0x221)]=[]),!RequestMonitor[_0x306023(0x216)][_0x306023(0x21c)]&&(RequestMonitor[_0x306023(0x216)][_0x306023(0x21c)]=[]),!RequestMonitor[_0x306023(0x216)]['network']&&(RequestMonitor[_0x306023(0x216)][_0x306023(0x1fc)]=[]);}catch(_0x3bad73){RequestMonitor[_0x306023(0x216)]={'cpu':[],'memory':[],'network':[]};}console[_0x306023(0x22c)](_0x306023(0x1f1));}static[a1_0x591422(0x218)](_0x3c04dd,_0x347af5,_0x5838f9){const _0x3bcf36=a1_0x591422;if(_0x3c04dd[_0x3bcf36(0x213)][_0x3bcf36(0x210)](_0x3bcf36(0x1fe)))return _0x5838f9();console[_0x3bcf36(0x22c)](_0x3bcf36(0x231));let _0x3dfbf0=Date[_0x3bcf36(0x1ee)](),_0x22c40a=Math[_0x3bcf36(0x1f7)](_0x3dfbf0/0x3e8/0x3c);console[_0x3bcf36(0x22c)]('=======>');const _0x2c5e5b=_0x347af5[_0x3bcf36(0x22d)];_0x347af5[_0x3bcf36(0x22d)]=(..._0x29b0fb)=>{const _0x109fc2=_0x3bcf36;console['log'](_0x22c40a,{'currentMinute':_0x22c40a});_0x22c40a>RequestMonitor[_0x109fc2(0x1ef)]&&(RequestMonitor[_0x109fc2(0x20d)]['push']({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x109fc2(0x1f3)]}),RequestMonitor[_0x109fc2(0x1f3)]=0x0,RequestMonitor[_0x109fc2(0x1ef)]=_0x22c40a);RequestMonitor[_0x109fc2(0x1f3)]++,RequestMonitor[_0x109fc2(0x222)][_0x109fc2(0x208)]({'timestamp':Date['now'](),'statusCode':_0x347af5[_0x109fc2(0x21b)],'path':_0x3c04dd['path'],'method':_0x3c04dd[_0x109fc2(0x206)]});const _0x10764f=Date[_0x109fc2(0x1ee)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x109fc2(0x222)]=RequestMonitor[_0x109fc2(0x222)][_0x109fc2(0x1ed)](_0x1f6e16=>_0x1f6e16['timestamp']>_0x10764f),_0x2c5e5b['apply'](_0x347af5,_0x29b0fb);},_0x5838f9();}static async['save'](){const _0x122017=a1_0x591422;try{RequestMonitor[_0x122017(0x1ef)]!==Math[_0x122017(0x1f7)](Date[_0x122017(0x1ee)]()/0x3e8/0x3c)&&(RequestMonitor[_0x122017(0x20d)]['push']({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x122017(0x1f3)]=0x0,RequestMonitor[_0x122017(0x1ef)]=Math[_0x122017(0x1f7)](Date[_0x122017(0x1ee)]()/0x3e8/0x3c)),await fs[_0x122017(0x219)](RequestMonitor['rpsStoragePath'],JSON[_0x122017(0x209)](RequestMonitor['rpsData'],null,0x2)),await fs[_0x122017(0x219)](RequestMonitor[_0x122017(0x212)],JSON[_0x122017(0x209)](RequestMonitor[_0x122017(0x222)],null,0x2));}catch(_0x4a81f2){console[_0x122017(0x223)](_0x122017(0x1f4),_0x4a81f2);}}static async[a1_0x591422(0x1e8)](){const _0x2a6ea5=a1_0x591422;setInterval(()=>RequestMonitor[_0x2a6ea5(0x226)](),0x3c*0x3e8),setInterval(()=>{const _0x49a017=_0x2a6ea5;RequestMonitor[_0x49a017(0x21d)]()[_0x49a017(0x20b)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x2a6ea5(0x21d)]()[_0x2a6ea5(0x20b)](()=>{});}static async[a1_0x591422(0x21d)](){const _0x25f230=a1_0x591422,_0x4a5ae0=osu[_0x25f230(0x221)],_0x4f78c2=osu[_0x25f230(0x1fb)],_0x4b2553=osu[_0x25f230(0x1ff)],_0x409a26={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x291810=await _0x4b2553[_0x25f230(0x215)]();_0x409a26[_0x25f230(0x229)]['inputMb']=_0x291810['total'][_0x25f230(0x204)],_0x409a26[_0x25f230(0x229)][_0x25f230(0x214)]=_0x291810[_0x25f230(0x229)][_0x25f230(0x214)];}catch(_0x583abc){}let _0x3d4ae9=0x0;try{_0x3d4ae9=await _0x4a5ae0[_0x25f230(0x201)]();}catch(_0x107bb3){console[_0x25f230(0x22c)](_0x25f230(0x220),_0x107bb3);}const _0x356542={'usedMemMb':0x0};try{const _0x3dc17e=await _0x4f78c2[_0x25f230(0x227)]();_0x356542[_0x25f230(0x1f0)]=_0x3dc17e[_0x25f230(0x1f0)];}catch(_0x3951f0){console[_0x25f230(0x22c)](_0x25f230(0x22f),_0x3951f0);}const _0x8f27d=new Date()['getHours']()[_0x25f230(0x232)]()[_0x25f230(0x1eb)](0x2,'0')+':'+new Date()[_0x25f230(0x202)]()[_0x25f230(0x232)]()['padStart'](0x2,'0');RequestMonitor[_0x25f230(0x216)][_0x25f230(0x221)]=RequestMonitor[_0x25f230(0x216)][_0x25f230(0x221)]['slice'](-0x3c)[_0x25f230(0x1ed)](_0xd5dd5=>_0xd5dd5[_0x25f230(0x1f2)]!==_0x8f27d),RequestMonitor[_0x25f230(0x216)][_0x25f230(0x21c)]=RequestMonitor[_0x25f230(0x216)][_0x25f230(0x21c)]['slice'](-0x3c)['filter'](_0x3fcb2d=>_0x3fcb2d[_0x25f230(0x1f2)]!==_0x8f27d),RequestMonitor[_0x25f230(0x216)][_0x25f230(0x1fc)]=RequestMonitor['ressourcesUsageStats'][_0x25f230(0x1fc)]['slice'](-0x3c)['filter'](_0x6362c3=>_0x6362c3[_0x25f230(0x1f2)]!==_0x8f27d),RequestMonitor[_0x25f230(0x216)]['cpu'][_0x25f230(0x208)]({'time':_0x8f27d,'usage':_0x3d4ae9}),RequestMonitor[_0x25f230(0x216)][_0x25f230(0x21c)]['push']({'time':_0x8f27d,'usage':(_0x356542[_0x25f230(0x1f0)]/0x3e8)[_0x25f230(0x230)](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x25f230(0x1fc)][_0x25f230(0x208)]({'time':_0x8f27d,'usage':{'in':_0x409a26[_0x25f230(0x229)]?.[_0x25f230(0x204)]??0x0,'out':_0x409a26[_0x25f230(0x229)]?.[_0x25f230(0x214)]??0x0}});try{await fs[_0x25f230(0x219)](RequestMonitor[_0x25f230(0x1ea)],JSON['stringify'](RequestMonitor[_0x25f230(0x216)],null,0x2));}catch(_0x32e078){console[_0x25f230(0x223)]('Error\x20saving\x20monitoring\x20data:',_0x32e078);}}static[a1_0x591422(0x205)](){const _0x363c0d=a1_0x591422,_0x10d653=Date[_0x363c0d(0x1ee)](),_0x4a9c43=_0x10d653-0x3c*0x3c*0x3e8,_0x131300=_0x10d653-0x18*0x3c*0x3c*0x3e8,_0x1d859e=RequestMonitor[_0x363c0d(0x20d)][_0x363c0d(0x1ed)](_0x2db758=>_0x2db758[_0x363c0d(0x225)]>_0x4a9c43),_0x25e8a0={'total':RequestMonitor[_0x363c0d(0x222)]['length'],'byCodes':{},'byPath':{}};return RequestMonitor[_0x363c0d(0x222)]['forEach'](_0x5776d8=>{const _0x1aaab7=_0x363c0d;_0x25e8a0[_0x1aaab7(0x211)][_0x5776d8[_0x1aaab7(0x21b)]]=(_0x25e8a0[_0x1aaab7(0x211)][_0x5776d8['statusCode']]||0x0)+0x1;const _0x3f9919=_0x5776d8[_0x1aaab7(0x206)]+'\x20'+_0x5776d8[_0x1aaab7(0x213)];!_0x25e8a0[_0x1aaab7(0x22b)][_0x3f9919]&&(_0x25e8a0[_0x1aaab7(0x22b)][_0x3f9919]={'total':0x0,'codes':{}}),_0x25e8a0['byPath'][_0x3f9919][_0x1aaab7(0x229)]++,_0x25e8a0['byPath'][_0x3f9919][_0x1aaab7(0x1e7)][_0x5776d8['statusCode']]=(_0x25e8a0[_0x1aaab7(0x22b)][_0x3f9919][_0x1aaab7(0x1e7)][_0x5776d8[_0x1aaab7(0x21b)]]||0x0)+0x1;}),{'rps':_0x1d859e,'httpCodes':_0x25e8a0,'ressourcesUsageStats':RequestMonitor[_0x363c0d(0x216)]};}}RequestMonitor[a1_0x591422(0x228)]()[a1_0x591422(0x20b)](()=>{}),RequestMonitor[a1_0x591422(0x1e8)]();const counter=RequestMonitor;module['exports']=counter;