const a1_0x3dadaf=a1_0x4446;(function(_0x271c19,_0x2b6971){const _0x5daa06=a1_0x4446,_0x13d026=_0x271c19();while(!![]){try{const _0x988252=parseInt(_0x5daa06(0x187))/0x1+parseInt(_0x5daa06(0x157))/0x2*(parseInt(_0x5daa06(0x194))/0x3)+-parseInt(_0x5daa06(0x18c))/0x4+parseInt(_0x5daa06(0x17f))/0x5+-parseInt(_0x5daa06(0x177))/0x6*(parseInt(_0x5daa06(0x15e))/0x7)+-parseInt(_0x5daa06(0x15c))/0x8+-parseInt(_0x5daa06(0x169))/0x9*(-parseInt(_0x5daa06(0x172))/0xa);if(_0x988252===_0x2b6971)break;else _0x13d026['push'](_0x13d026['shift']());}catch(_0x3bb629){_0x13d026['push'](_0x13d026['shift']());}}}(a1_0x3465,0x89fbd));function a1_0x4446(_0x7e21e,_0x24cacd){const _0x346555=a1_0x3465();return a1_0x4446=function(_0x4446b2,_0x39b156){_0x4446b2=_0x4446b2-0x150;let _0x5c68cd=_0x346555[_0x4446b2];return _0x5c68cd;},a1_0x4446(_0x7e21e,_0x24cacd);}const fs=require('fs')[a1_0x3dadaf(0x161)],osu=require(a1_0x3dadaf(0x175));function a1_0x3465(){const _0x11ddd3=['getMinutes','httpCodesStoragePath','9towIVi','currentRequests','byCodes','cadviewer/settings/requests-per-minute.json','Request\x20monitor\x20middleware','stringify','path','usage','push','2297220SGPxjQ','timestamp','inputMb','node-os-utils','time','18XMpupl','rpsData','length','init','now','cpu','Error\x20saving\x20monitoring\x20data:','filter','2818370tQwlKf','usedMemMb','info','Error\x20getting\x20memory\x20usage:','outputMb','inOut','getUsageRessourcesStatsAndSave','getHours','1000327LWESit','byPath','rpsStoragePath','ressourcesUsageStats','then','2893312gTfkZp','cadviewer/settings/http-codes-24h.json','codes','toFixed','utf8','httpCodesData','statusCode','floor','352398yVsRvB','slice','/metrics','network','lastMinute','Initializing\x20request\x20monitor...','memory','forEach','writeFile','exports','ressourcesUsageStatsPath','log','4bcCpnL','includes','error','apply','save','2490536KlrTDR','total','1000601GnIVfa','getStats','startPeriodicSave','promises','readFile','=======>','toString','Request\x20monitor\x20initialized.','parse'];a1_0x3465=function(){return _0x11ddd3;};return a1_0x3465();}class RequestMonitor{static [a1_0x3dadaf(0x189)]=a1_0x3dadaf(0x16c);static [a1_0x3dadaf(0x168)]=a1_0x3dadaf(0x18d);static ['ressourcesUsageStatsPath']='cadviewer/settings/ressources-usage-stats.json';static [a1_0x3dadaf(0x178)]=[];static ['httpCodesData']=[];static ['ressourcesUsageStats']={};static [a1_0x3dadaf(0x198)]=Math[a1_0x3dadaf(0x193)](Date[a1_0x3dadaf(0x17b)]()/0x3e8/0x3c);static [a1_0x3dadaf(0x16a)]=0x0;static async['init'](){const _0x5b9c78=a1_0x3dadaf;console[_0x5b9c78(0x156)](_0x5b9c78(0x150));try{const _0x5e8642=await fs[_0x5b9c78(0x162)](RequestMonitor[_0x5b9c78(0x189)],_0x5b9c78(0x190));RequestMonitor[_0x5b9c78(0x178)]=JSON['parse'](_0x5e8642);}catch(_0xf16ba0){RequestMonitor[_0x5b9c78(0x178)]=[];}try{const _0x499065=await fs[_0x5b9c78(0x162)](RequestMonitor[_0x5b9c78(0x168)],_0x5b9c78(0x190));RequestMonitor[_0x5b9c78(0x191)]=JSON[_0x5b9c78(0x166)](_0x499065);}catch(_0x1f1c2d){RequestMonitor['httpCodesData']=[];}try{const _0x4acc51=await fs[_0x5b9c78(0x162)](RequestMonitor['ressourcesUsageStatsPath'],_0x5b9c78(0x190));RequestMonitor[_0x5b9c78(0x18a)]=JSON[_0x5b9c78(0x166)](_0x4acc51),!RequestMonitor[_0x5b9c78(0x18a)][_0x5b9c78(0x17c)]&&(RequestMonitor[_0x5b9c78(0x18a)][_0x5b9c78(0x17c)]=[]),!RequestMonitor[_0x5b9c78(0x18a)]['memory']&&(RequestMonitor[_0x5b9c78(0x18a)]['memory']=[]),!RequestMonitor['ressourcesUsageStats']['network']&&(RequestMonitor[_0x5b9c78(0x18a)][_0x5b9c78(0x197)]=[]);}catch(_0x77fef){RequestMonitor[_0x5b9c78(0x18a)]={'cpu':[],'memory':[],'network':[]};}console[_0x5b9c78(0x156)](_0x5b9c78(0x165));}static['middleware'](_0x2a11fc,_0x1bff00,_0x214f87){const _0x41f2da=a1_0x3dadaf;if(_0x2a11fc[_0x41f2da(0x16f)][_0x41f2da(0x158)](_0x41f2da(0x196)))return _0x214f87();console[_0x41f2da(0x156)](_0x41f2da(0x16d));let _0x486738=Date['now'](),_0x4ecd89=Math['floor'](_0x486738/0x3e8/0x3c);console[_0x41f2da(0x156)](_0x41f2da(0x163));const _0x2ada7a=_0x1bff00['end'];_0x1bff00['end']=(..._0x1d4430)=>{const _0x4c12a8=_0x41f2da;console[_0x4c12a8(0x156)](_0x4ecd89,{'currentMinute':_0x4ecd89});_0x4ecd89>RequestMonitor[_0x4c12a8(0x198)]&&(RequestMonitor[_0x4c12a8(0x178)][_0x4c12a8(0x171)]({'timestamp':RequestMonitor[_0x4c12a8(0x198)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x4c12a8(0x16a)]=0x0,RequestMonitor[_0x4c12a8(0x198)]=_0x4ecd89);RequestMonitor['currentRequests']++,RequestMonitor['httpCodesData'][_0x4c12a8(0x171)]({'timestamp':Date['now'](),'statusCode':_0x1bff00[_0x4c12a8(0x192)],'path':_0x2a11fc[_0x4c12a8(0x16f)],'method':_0x2a11fc['method']});const _0x50efdf=Date[_0x4c12a8(0x17b)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x4c12a8(0x191)]=RequestMonitor[_0x4c12a8(0x191)][_0x4c12a8(0x17e)](_0x22ac87=>_0x22ac87['timestamp']>_0x50efdf),_0x2ada7a[_0x4c12a8(0x15a)](_0x1bff00,_0x1d4430);},_0x214f87();}static async['save'](){const _0x4cfc82=a1_0x3dadaf;try{RequestMonitor[_0x4cfc82(0x198)]!==Math[_0x4cfc82(0x193)](Date[_0x4cfc82(0x17b)]()/0x3e8/0x3c)&&(RequestMonitor[_0x4cfc82(0x178)][_0x4cfc82(0x171)]({'timestamp':RequestMonitor[_0x4cfc82(0x198)]*0x3e8*0x3c,'requests':RequestMonitor[_0x4cfc82(0x16a)]}),RequestMonitor[_0x4cfc82(0x16a)]=0x0,RequestMonitor['lastMinute']=Math[_0x4cfc82(0x193)](Date[_0x4cfc82(0x17b)]()/0x3e8/0x3c)),await fs[_0x4cfc82(0x153)](RequestMonitor[_0x4cfc82(0x189)],JSON[_0x4cfc82(0x16e)](RequestMonitor[_0x4cfc82(0x178)],null,0x2)),await fs['writeFile'](RequestMonitor['httpCodesStoragePath'],JSON[_0x4cfc82(0x16e)](RequestMonitor[_0x4cfc82(0x191)],null,0x2));}catch(_0x75994e){console[_0x4cfc82(0x159)](_0x4cfc82(0x17d),_0x75994e);}}static async[a1_0x3dadaf(0x160)](){const _0x21f2c6=a1_0x3dadaf;setInterval(()=>RequestMonitor[_0x21f2c6(0x15b)](),0x3c*0x3e8),setInterval(()=>{const _0x2599ab=_0x21f2c6;RequestMonitor[_0x2599ab(0x185)]()['then'](()=>{});},0x3c*0x3e8),RequestMonitor[_0x21f2c6(0x185)]()[_0x21f2c6(0x18b)](()=>{});}static async[a1_0x3dadaf(0x185)](){const _0x211c25=a1_0x3dadaf,_0x3af406=osu[_0x211c25(0x17c)],_0x46e192=osu['mem'],_0x26e414=osu['netstat'],_0x19c388={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x14060c=await _0x26e414[_0x211c25(0x184)]();_0x19c388[_0x211c25(0x15d)][_0x211c25(0x174)]=_0x14060c['total']['inputMb'],_0x19c388[_0x211c25(0x15d)]['outputMb']=_0x14060c[_0x211c25(0x15d)][_0x211c25(0x183)];}catch(_0x50ece3){}let _0x39c978=0x0;try{_0x39c978=await _0x3af406[_0x211c25(0x170)]();}catch(_0x45cd01){console[_0x211c25(0x156)]('Error\x20getting\x20CPU\x20usage:',_0x45cd01);}const _0x226cfc={'usedMemMb':0x0};try{const _0x37e068=await _0x46e192[_0x211c25(0x181)]();_0x226cfc[_0x211c25(0x180)]=_0x37e068['usedMemMb'];}catch(_0x2dc45c){console['log'](_0x211c25(0x182),_0x2dc45c);}const _0x20bb65=new Date()[_0x211c25(0x186)]()[_0x211c25(0x164)]()['padStart'](0x2,'0')+':'+new Date()[_0x211c25(0x167)]()['toString']()['padStart'](0x2,'0');RequestMonitor[_0x211c25(0x18a)]['cpu']=RequestMonitor[_0x211c25(0x18a)][_0x211c25(0x17c)][_0x211c25(0x195)](-0x3c)['filter'](_0xea396b=>_0xea396b[_0x211c25(0x176)]!==_0x20bb65),RequestMonitor[_0x211c25(0x18a)][_0x211c25(0x151)]=RequestMonitor['ressourcesUsageStats'][_0x211c25(0x151)]['slice'](-0x3c)[_0x211c25(0x17e)](_0x56c2e5=>_0x56c2e5[_0x211c25(0x176)]!==_0x20bb65),RequestMonitor[_0x211c25(0x18a)][_0x211c25(0x197)]=RequestMonitor['ressourcesUsageStats'][_0x211c25(0x197)][_0x211c25(0x195)](-0x3c)[_0x211c25(0x17e)](_0x59579f=>_0x59579f[_0x211c25(0x176)]!==_0x20bb65),RequestMonitor['ressourcesUsageStats'][_0x211c25(0x17c)][_0x211c25(0x171)]({'time':_0x20bb65,'usage':_0x39c978}),RequestMonitor[_0x211c25(0x18a)]['memory'][_0x211c25(0x171)]({'time':_0x20bb65,'usage':(_0x226cfc[_0x211c25(0x180)]/0x3e8)[_0x211c25(0x18f)](0x2)}),RequestMonitor[_0x211c25(0x18a)][_0x211c25(0x197)][_0x211c25(0x171)]({'time':_0x20bb65,'usage':{'in':_0x19c388[_0x211c25(0x15d)]?.['inputMb']??0x0,'out':_0x19c388[_0x211c25(0x15d)]?.[_0x211c25(0x183)]??0x0}});try{await fs['writeFile'](RequestMonitor[_0x211c25(0x155)],JSON[_0x211c25(0x16e)](RequestMonitor[_0x211c25(0x18a)],null,0x2));}catch(_0x1ac6ac){console[_0x211c25(0x159)]('Error\x20saving\x20monitoring\x20data:',_0x1ac6ac);}}static[a1_0x3dadaf(0x15f)](){const _0x57cc1b=a1_0x3dadaf,_0x222f0a=Date['now'](),_0x4f8faa=_0x222f0a-0x3c*0x3c*0x3e8,_0x440240=_0x222f0a-0x18*0x3c*0x3c*0x3e8,_0x12365f=RequestMonitor[_0x57cc1b(0x178)][_0x57cc1b(0x17e)](_0x37dfb1=>_0x37dfb1[_0x57cc1b(0x173)]>_0x4f8faa),_0xc8c5b={'total':RequestMonitor['httpCodesData'][_0x57cc1b(0x179)],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x57cc1b(0x152)](_0x513681=>{const _0x474497=_0x57cc1b;_0xc8c5b[_0x474497(0x16b)][_0x513681[_0x474497(0x192)]]=(_0xc8c5b[_0x474497(0x16b)][_0x513681[_0x474497(0x192)]]||0x0)+0x1;const _0x73c384=_0x513681['method']+'\x20'+_0x513681[_0x474497(0x16f)];!_0xc8c5b['byPath'][_0x73c384]&&(_0xc8c5b['byPath'][_0x73c384]={'total':0x0,'codes':{}}),_0xc8c5b[_0x474497(0x188)][_0x73c384][_0x474497(0x15d)]++,_0xc8c5b[_0x474497(0x188)][_0x73c384]['codes'][_0x513681[_0x474497(0x192)]]=(_0xc8c5b['byPath'][_0x73c384][_0x474497(0x18e)][_0x513681[_0x474497(0x192)]]||0x0)+0x1;}),{'rps':_0x12365f,'httpCodes':_0xc8c5b,'ressourcesUsageStats':RequestMonitor[_0x57cc1b(0x18a)]};}}RequestMonitor[a1_0x3dadaf(0x17a)]()['then'](()=>{}),RequestMonitor[a1_0x3dadaf(0x160)]();const counter=RequestMonitor;module[a1_0x3dadaf(0x154)]=counter;