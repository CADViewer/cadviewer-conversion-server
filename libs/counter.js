const a1_0x1260f7=a1_0x506a;(function(_0x15208b,_0x9f4ed7){const _0xbc743c=a1_0x506a,_0x5a4382=_0x15208b();while(!![]){try{const _0x2415b3=parseInt(_0xbc743c(0xfc))/0x1+parseInt(_0xbc743c(0xcc))/0x2*(parseInt(_0xbc743c(0xcd))/0x3)+-parseInt(_0xbc743c(0x110))/0x4*(-parseInt(_0xbc743c(0xf8))/0x5)+parseInt(_0xbc743c(0xdd))/0x6+parseInt(_0xbc743c(0x109))/0x7*(parseInt(_0xbc743c(0xf7))/0x8)+-parseInt(_0xbc743c(0xe5))/0x9*(parseInt(_0xbc743c(0xe3))/0xa)+-parseInt(_0xbc743c(0xfd))/0xb*(parseInt(_0xbc743c(0x107))/0xc);if(_0x2415b3===_0x9f4ed7)break;else _0x5a4382['push'](_0x5a4382['shift']());}catch(_0x1dd0da){_0x5a4382['push'](_0x5a4382['shift']());}}}(a1_0x5b21,0x2dac1));const fs=require('fs')[a1_0x1260f7(0xcf)],osu=require('node-os-utils');class RequestMonitor{static [a1_0x1260f7(0x10c)]=a1_0x1260f7(0x115);static [a1_0x1260f7(0xfe)]='cadviewer/settings/http-codes-24h.json';static ['ressourcesUsageStatsPath']=a1_0x1260f7(0xe1);static [a1_0x1260f7(0x104)]=[];static [a1_0x1260f7(0xda)]=[];static ['ressourcesUsageStats']={};static ['lastMinute']=Math[a1_0x1260f7(0xd5)](Date['now']()/0x3e8/0x3c);static [a1_0x1260f7(0x116)]=0x0;static async[a1_0x1260f7(0xff)](){const _0x5e82c8=a1_0x1260f7;console[_0x5e82c8(0xd7)](_0x5e82c8(0xf4));try{const _0x4eee72=await fs[_0x5e82c8(0xef)](RequestMonitor[_0x5e82c8(0x10c)],'utf8');RequestMonitor[_0x5e82c8(0x104)]=JSON['parse'](_0x4eee72);}catch(_0x2f21af){RequestMonitor[_0x5e82c8(0x104)]=[];}try{const _0x586e3b=await fs['readFile'](RequestMonitor[_0x5e82c8(0xfe)],_0x5e82c8(0x108));RequestMonitor['httpCodesData']=JSON[_0x5e82c8(0xee)](_0x586e3b);}catch(_0x51ba3e){RequestMonitor[_0x5e82c8(0xda)]=[];}try{const _0x438556=await fs[_0x5e82c8(0xef)](RequestMonitor[_0x5e82c8(0xfb)],_0x5e82c8(0x108));RequestMonitor['ressourcesUsageStats']=JSON[_0x5e82c8(0xee)](_0x438556),!RequestMonitor['ressourcesUsageStats'][_0x5e82c8(0xe2)]&&(RequestMonitor[_0x5e82c8(0xd0)][_0x5e82c8(0xe2)]=[]),!RequestMonitor[_0x5e82c8(0xd0)][_0x5e82c8(0xe4)]&&(RequestMonitor[_0x5e82c8(0xd0)][_0x5e82c8(0xe4)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x5e82c8(0xed)]&&(RequestMonitor[_0x5e82c8(0xd0)][_0x5e82c8(0xed)]=[]);}catch(_0xdf3cf3){RequestMonitor[_0x5e82c8(0xd0)]={'cpu':[],'memory':[],'network':[]};}console['log'](_0x5e82c8(0xf0));}static[a1_0x1260f7(0x111)](_0x4a48d1,_0x4b7118,_0x14a34d){const _0x117e2d=a1_0x1260f7;if(_0x4a48d1[_0x117e2d(0xce)][_0x117e2d(0x100)]('/metrics'))return _0x14a34d();console[_0x117e2d(0xd7)]('Request\x20monitor\x20middleware');let _0x5897fc=Date[_0x117e2d(0xca)](),_0x250be1=Math[_0x117e2d(0xd5)](_0x5897fc/0x3e8/0x3c);console[_0x117e2d(0xd7)](_0x117e2d(0x10d));const _0x1130af=_0x4b7118['end'];_0x4b7118[_0x117e2d(0xe7)]=(..._0x5dcc71)=>{const _0x204dc0=_0x117e2d;console[_0x204dc0(0xd7)](_0x250be1,{'currentMinute':_0x250be1});_0x250be1>RequestMonitor['lastMinute']&&(RequestMonitor[_0x204dc0(0x104)][_0x204dc0(0xe8)]({'timestamp':RequestMonitor[_0x204dc0(0xeb)]*0x3e8*0x3c,'requests':RequestMonitor[_0x204dc0(0x116)]}),RequestMonitor[_0x204dc0(0x116)]=0x0,RequestMonitor[_0x204dc0(0xeb)]=_0x250be1);RequestMonitor[_0x204dc0(0x116)]++,RequestMonitor[_0x204dc0(0xda)][_0x204dc0(0xe8)]({'timestamp':Date[_0x204dc0(0xca)](),'statusCode':_0x4b7118[_0x204dc0(0x114)],'path':_0x4a48d1[_0x204dc0(0xce)],'method':_0x4a48d1[_0x204dc0(0xde)]});const _0x2b8f16=Date[_0x204dc0(0xca)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor[_0x204dc0(0xda)][_0x204dc0(0xea)](_0x1dd416=>_0x1dd416[_0x204dc0(0xf6)]>_0x2b8f16),_0x1130af[_0x204dc0(0xdc)](_0x4b7118,_0x5dcc71);},_0x14a34d();}static async[a1_0x1260f7(0xe6)](){const _0x2194f9=a1_0x1260f7;try{RequestMonitor['lastMinute']!==Math[_0x2194f9(0xd5)](Date[_0x2194f9(0xca)]()/0x3e8/0x3c)&&(RequestMonitor['rpsData'][_0x2194f9(0xe8)]({'timestamp':RequestMonitor[_0x2194f9(0xeb)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x2194f9(0x116)]=0x0,RequestMonitor[_0x2194f9(0xeb)]=Math[_0x2194f9(0xd5)](Date['now']()/0x3e8/0x3c)),await fs[_0x2194f9(0xf3)](RequestMonitor[_0x2194f9(0x10c)],JSON[_0x2194f9(0x103)](RequestMonitor['rpsData'],null,0x2)),await fs[_0x2194f9(0xf3)](RequestMonitor[_0x2194f9(0xfe)],JSON[_0x2194f9(0x103)](RequestMonitor[_0x2194f9(0xda)],null,0x2));}catch(_0x1dac86){console[_0x2194f9(0xf1)](_0x2194f9(0x10b),_0x1dac86);}}static async[a1_0x1260f7(0xec)](){const _0x2d1aa3=a1_0x1260f7;setInterval(()=>RequestMonitor[_0x2d1aa3(0xe6)](),0x3c*0x3e8),setInterval(()=>{const _0x5ecd57=_0x2d1aa3;RequestMonitor[_0x5ecd57(0x10e)]()[_0x5ecd57(0xd6)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x2d1aa3(0x10e)]()[_0x2d1aa3(0xd6)](()=>{});}static async[a1_0x1260f7(0x10e)](){const _0x35b99f=a1_0x1260f7,_0x32b4c3=osu[_0x35b99f(0xe2)],_0x8aa8c2=osu[_0x35b99f(0x106)],_0x547a87=osu[_0x35b99f(0x112)],_0x4347eb={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x22342f=await _0x547a87['inOut']();_0x4347eb[_0x35b99f(0xdf)][_0x35b99f(0xd2)]=_0x22342f['total'][_0x35b99f(0xd2)],_0x4347eb['total'][_0x35b99f(0x10f)]=_0x22342f[_0x35b99f(0xdf)][_0x35b99f(0x10f)];}catch(_0x43e812){}let _0xbc8a45=0x0;try{_0xbc8a45=await _0x32b4c3[_0x35b99f(0x102)]();}catch(_0x127c13){console[_0x35b99f(0xd7)](_0x35b99f(0xf9),_0x127c13);}const _0x3f7d58={'usedMemMb':0x0};try{const _0x33bf06=await _0x8aa8c2[_0x35b99f(0xd8)]();_0x3f7d58[_0x35b99f(0xe9)]=_0x33bf06[_0x35b99f(0xe9)];}catch(_0x2410b1){console[_0x35b99f(0xd7)]('Error\x20getting\x20memory\x20usage:',_0x2410b1);}const _0x53ed30=new Date()[_0x35b99f(0x101)]()[_0x35b99f(0xfa)]()['padStart'](0x2,'0')+':'+new Date()[_0x35b99f(0xd3)]()[_0x35b99f(0xfa)]()[_0x35b99f(0xd1)](0x2,'0');RequestMonitor[_0x35b99f(0xd0)]['cpu']=RequestMonitor['ressourcesUsageStats'][_0x35b99f(0xe2)]['slice'](-0x3c)['filter'](_0x37cbd8=>_0x37cbd8[_0x35b99f(0xd9)]!==_0x53ed30),RequestMonitor[_0x35b99f(0xd0)][_0x35b99f(0xe4)]=RequestMonitor['ressourcesUsageStats'][_0x35b99f(0xe4)][_0x35b99f(0xdb)](-0x3c)[_0x35b99f(0xea)](_0x255430=>_0x255430[_0x35b99f(0xd9)]!==_0x53ed30),RequestMonitor[_0x35b99f(0xd0)][_0x35b99f(0xed)]=RequestMonitor[_0x35b99f(0xd0)][_0x35b99f(0xed)][_0x35b99f(0xdb)](-0x3c)[_0x35b99f(0xea)](_0x367bf3=>_0x367bf3[_0x35b99f(0xd9)]!==_0x53ed30),RequestMonitor[_0x35b99f(0xd0)][_0x35b99f(0xe2)]['push']({'time':_0x53ed30,'usage':_0xbc8a45}),RequestMonitor['ressourcesUsageStats'][_0x35b99f(0xe4)]['push']({'time':_0x53ed30,'usage':(_0x3f7d58[_0x35b99f(0xe9)]/0x3e8)[_0x35b99f(0x10a)](0x2)}),RequestMonitor[_0x35b99f(0xd0)][_0x35b99f(0xed)]['push']({'time':_0x53ed30,'usage':{'in':_0x4347eb[_0x35b99f(0xdf)]?.[_0x35b99f(0xd2)]??0x0,'out':_0x4347eb[_0x35b99f(0xdf)]?.[_0x35b99f(0x10f)]??0x0}});try{await fs[_0x35b99f(0xf3)](RequestMonitor[_0x35b99f(0xfb)],JSON[_0x35b99f(0x103)](RequestMonitor[_0x35b99f(0xd0)],null,0x2));}catch(_0x3d7742){console[_0x35b99f(0xf1)]('Error\x20saving\x20monitoring\x20data:',_0x3d7742);}}static[a1_0x1260f7(0xf2)](){const _0x1ce88e=a1_0x1260f7,_0x43a521=Date[_0x1ce88e(0xca)](),_0xdba5e0=_0x43a521-0x3c*0x3c*0x3e8,_0x4b9818=_0x43a521-0x18*0x3c*0x3c*0x3e8,_0x19b9d4=RequestMonitor[_0x1ce88e(0x104)][_0x1ce88e(0xea)](_0x1688cc=>_0x1688cc[_0x1ce88e(0xf6)]>_0xdba5e0),_0x4bb60c={'total':RequestMonitor[_0x1ce88e(0xda)][_0x1ce88e(0x105)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x1ce88e(0xda)][_0x1ce88e(0x113)](_0x1843af=>{const _0x3ff812=_0x1ce88e;_0x4bb60c[_0x3ff812(0xf5)][_0x1843af[_0x3ff812(0x114)]]=(_0x4bb60c['byCodes'][_0x1843af[_0x3ff812(0x114)]]||0x0)+0x1;const _0xd3d8f4=_0x1843af['method']+'\x20'+_0x1843af[_0x3ff812(0xce)];!_0x4bb60c[_0x3ff812(0xd4)][_0xd3d8f4]&&(_0x4bb60c[_0x3ff812(0xd4)][_0xd3d8f4]={'total':0x0,'codes':{}}),_0x4bb60c[_0x3ff812(0xd4)][_0xd3d8f4][_0x3ff812(0xdf)]++,_0x4bb60c[_0x3ff812(0xd4)][_0xd3d8f4]['codes'][_0x1843af['statusCode']]=(_0x4bb60c['byPath'][_0xd3d8f4][_0x3ff812(0xcb)][_0x1843af[_0x3ff812(0x114)]]||0x0)+0x1;}),{'rps':_0x19b9d4,'httpCodes':_0x4bb60c,'ressourcesUsageStats':RequestMonitor[_0x1ce88e(0xd0)]};}}RequestMonitor[a1_0x1260f7(0xff)]()[a1_0x1260f7(0xd6)](()=>{}),RequestMonitor['startPeriodicSave']();const counter=RequestMonitor;function a1_0x506a(_0xe5c7bd,_0x3e951e){const _0x5b216e=a1_0x5b21();return a1_0x506a=function(_0x506a6a,_0x5018a9){_0x506a6a=_0x506a6a-0xca;let _0x4177a4=_0x5b216e[_0x506a6a];return _0x4177a4;},a1_0x506a(_0xe5c7bd,_0x3e951e);}module[a1_0x1260f7(0xe0)]=counter;function a1_0x5b21(){const _0x4533b2=['statusCode','cadviewer/settings/requests-per-minute.json','currentRequests','now','codes','2wEYuMG','539967LqyeeK','path','promises','ressourcesUsageStats','padStart','inputMb','getMinutes','byPath','floor','then','log','info','time','httpCodesData','slice','apply','80292EMBxFq','method','total','exports','cadviewer/settings/ressources-usage-stats.json','cpu','2730CkVdxO','memory','4365myADNY','save','end','push','usedMemMb','filter','lastMinute','startPeriodicSave','network','parse','readFile','Request\x20monitor\x20initialized.','error','getStats','writeFile','Initializing\x20request\x20monitor...','byCodes','timestamp','2183928VlAcaQ','1073395fAJGit','Error\x20getting\x20CPU\x20usage:','toString','ressourcesUsageStatsPath','149169MnPrOK','22GfEelA','httpCodesStoragePath','init','includes','getHours','usage','stringify','rpsData','length','mem','3064392mNPcFT','utf8','7HEcveY','toFixed','Error\x20saving\x20monitoring\x20data:','rpsStoragePath','=======>','getUsageRessourcesStatsAndSave','outputMb','4oeAyxs','middleware','netstat','forEach'];a1_0x5b21=function(){return _0x4533b2;};return a1_0x5b21();}