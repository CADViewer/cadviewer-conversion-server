const a1_0x49b1a2=a1_0x42df;function a1_0x42df(_0x509f63,_0x46851d){const _0x28cfc1=a1_0x28cf();return a1_0x42df=function(_0x42dfbb,_0x4a5fd5){_0x42dfbb=_0x42dfbb-0xf9;let _0x1b8f78=_0x28cfc1[_0x42dfbb];return _0x1b8f78;},a1_0x42df(_0x509f63,_0x46851d);}function a1_0x28cf(){const _0x2f7a08=['13HQvOHL','push','utf8','158230KTXliT','Error\x20getting\x20CPU\x20usage:','httpCodesData','toString','33826lUSmSV','promises','log','startPeriodicSave','34corlLH','getHours','ressourcesUsageStats','codes','cpu','error','inOut','114CRFdef','info','netstat','padStart','ressourcesUsageStatsPath','=======>','/metrics','memory','3ghKNdg','usedMemMb','mem','getUsageRessourcesStatsAndSave','middleware','2956572HsMrdG','time','toFixed','slice','writeFile','Error\x20getting\x20memory\x20usage:','inputMb','apply','save','path','rpsData','statusCode','filter','outputMb','init','end','network','floor','byCodes','1516921cOlQwS','forEach','total','rpsStoragePath','lastMinute','parse','Request\x20monitor\x20initialized.','cadviewer/settings/requests-per-minute.json','currentRequests','stringify','byPath','228IWosEW','16TTvCkR','readFile','length','getMinutes','Initializing\x20request\x20monitor...','now','26221874kRksQQ','exports','299002wFjqyJ','getStats','then','Error\x20saving\x20monitoring\x20data:','cadviewer/settings/ressources-usage-stats.json','603TEEzXe','64730znoPJK','httpCodesStoragePath','usage','timestamp','method'];a1_0x28cf=function(){return _0x2f7a08;};return a1_0x28cf();}(function(_0x1a87b6,_0x5e8af2){const _0x4a25c2=a1_0x42df,_0x34eabe=_0x1a87b6();while(!![]){try{const _0xb42fe5=parseInt(_0x4a25c2(0x13c))/0x1*(-parseInt(_0x4a25c2(0x138))/0x2)+-parseInt(_0x4a25c2(0xfa))/0x3*(-parseInt(_0x4a25c2(0xff))/0x4)+parseInt(_0x4a25c2(0x12c))/0x5*(parseInt(_0x4a25c2(0x143))/0x6)+-parseInt(_0x4a25c2(0x112))/0x7*(-parseInt(_0x4a25c2(0x11e))/0x8)+parseInt(_0x4a25c2(0x12b))/0x9*(parseInt(_0x4a25c2(0x134))/0xa)+parseInt(_0x4a25c2(0x126))/0xb*(parseInt(_0x4a25c2(0x11d))/0xc)+-parseInt(_0x4a25c2(0x131))/0xd*(parseInt(_0x4a25c2(0x124))/0xe);if(_0xb42fe5===_0x5e8af2)break;else _0x34eabe['push'](_0x34eabe['shift']());}catch(_0x35dc8f){_0x34eabe['push'](_0x34eabe['shift']());}}}(a1_0x28cf,0x85911));const fs=require('fs')[a1_0x49b1a2(0x139)],osu=require('node-os-utils');class RequestMonitor{static ['rpsStoragePath']=a1_0x49b1a2(0x119);static ['httpCodesStoragePath']='cadviewer/settings/http-codes-24h.json';static [a1_0x49b1a2(0x147)]=a1_0x49b1a2(0x12a);static [a1_0x49b1a2(0x109)]=[];static [a1_0x49b1a2(0x136)]=[];static ['ressourcesUsageStats']={};static ['lastMinute']=Math[a1_0x49b1a2(0x110)](Date['now']()/0x3e8/0x3c);static [a1_0x49b1a2(0x11a)]=0x0;static async[a1_0x49b1a2(0x10d)](){const _0x1a23fc=a1_0x49b1a2;console[_0x1a23fc(0x13a)](_0x1a23fc(0x122));try{const _0x182ddb=await fs[_0x1a23fc(0x11f)](RequestMonitor['rpsStoragePath'],'utf8');RequestMonitor[_0x1a23fc(0x109)]=JSON['parse'](_0x182ddb);}catch(_0x3dc18f){RequestMonitor[_0x1a23fc(0x109)]=[];}try{const _0x3801f0=await fs[_0x1a23fc(0x11f)](RequestMonitor[_0x1a23fc(0x12d)],_0x1a23fc(0x133));RequestMonitor[_0x1a23fc(0x136)]=JSON['parse'](_0x3801f0);}catch(_0x13abfd){RequestMonitor[_0x1a23fc(0x136)]=[];}try{const _0x4a26ab=await fs[_0x1a23fc(0x11f)](RequestMonitor[_0x1a23fc(0x147)],_0x1a23fc(0x133));RequestMonitor[_0x1a23fc(0x13e)]=JSON[_0x1a23fc(0x117)](_0x4a26ab),!RequestMonitor['ressourcesUsageStats'][_0x1a23fc(0x140)]&&(RequestMonitor[_0x1a23fc(0x13e)][_0x1a23fc(0x140)]=[]),!RequestMonitor[_0x1a23fc(0x13e)]['memory']&&(RequestMonitor[_0x1a23fc(0x13e)][_0x1a23fc(0xf9)]=[]),!RequestMonitor[_0x1a23fc(0x13e)]['network']&&(RequestMonitor[_0x1a23fc(0x13e)][_0x1a23fc(0x10f)]=[]);}catch(_0x4cae04){RequestMonitor['ressourcesUsageStats']={'cpu':[],'memory':[],'network':[]};}console[_0x1a23fc(0x13a)](_0x1a23fc(0x118));}static[a1_0x49b1a2(0xfe)](_0xd39c31,_0x565bfd,_0x5ef960){const _0xbe060a=a1_0x49b1a2;if(_0xd39c31[_0xbe060a(0x108)]['includes'](_0xbe060a(0x149)))return _0x5ef960();console[_0xbe060a(0x13a)]('Request\x20monitor\x20middleware');let _0x4d7285=Date[_0xbe060a(0x123)](),_0x5e64a=Math[_0xbe060a(0x110)](_0x4d7285/0x3e8/0x3c);console[_0xbe060a(0x13a)](_0xbe060a(0x148));const _0x21b434=_0x565bfd[_0xbe060a(0x10e)];_0x565bfd['end']=(..._0x40d1db)=>{const _0x4fa79d=_0xbe060a;console[_0x4fa79d(0x13a)](_0x5e64a,{'currentMinute':_0x5e64a});_0x5e64a>RequestMonitor[_0x4fa79d(0x116)]&&(RequestMonitor['rpsData'][_0x4fa79d(0x132)]({'timestamp':RequestMonitor[_0x4fa79d(0x116)]*0x3e8*0x3c,'requests':RequestMonitor[_0x4fa79d(0x11a)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x4fa79d(0x116)]=_0x5e64a);RequestMonitor[_0x4fa79d(0x11a)]++,RequestMonitor[_0x4fa79d(0x136)]['push']({'timestamp':Date['now'](),'statusCode':_0x565bfd[_0x4fa79d(0x10a)],'path':_0xd39c31[_0x4fa79d(0x108)],'method':_0xd39c31[_0x4fa79d(0x130)]});const _0x1594cb=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x4fa79d(0x136)]=RequestMonitor[_0x4fa79d(0x136)]['filter'](_0x4fdf29=>_0x4fdf29[_0x4fa79d(0x12f)]>_0x1594cb),_0x21b434[_0x4fa79d(0x106)](_0x565bfd,_0x40d1db);},_0x5ef960();}static async[a1_0x49b1a2(0x107)](){const _0x40a09f=a1_0x49b1a2;try{RequestMonitor[_0x40a09f(0x116)]!==Math[_0x40a09f(0x110)](Date[_0x40a09f(0x123)]()/0x3e8/0x3c)&&(RequestMonitor[_0x40a09f(0x109)][_0x40a09f(0x132)]({'timestamp':RequestMonitor[_0x40a09f(0x116)]*0x3e8*0x3c,'requests':RequestMonitor[_0x40a09f(0x11a)]}),RequestMonitor[_0x40a09f(0x11a)]=0x0,RequestMonitor[_0x40a09f(0x116)]=Math[_0x40a09f(0x110)](Date['now']()/0x3e8/0x3c)),await fs[_0x40a09f(0x103)](RequestMonitor[_0x40a09f(0x115)],JSON[_0x40a09f(0x11b)](RequestMonitor[_0x40a09f(0x109)],null,0x2)),await fs[_0x40a09f(0x103)](RequestMonitor['httpCodesStoragePath'],JSON['stringify'](RequestMonitor[_0x40a09f(0x136)],null,0x2));}catch(_0x2bccdb){console['error']('Error\x20saving\x20monitoring\x20data:',_0x2bccdb);}}static async[a1_0x49b1a2(0x13b)](){const _0x2ea568=a1_0x49b1a2;setInterval(()=>RequestMonitor[_0x2ea568(0x107)](),0x3c*0x3e8),setInterval(()=>{const _0x40ce0c=_0x2ea568;RequestMonitor['getUsageRessourcesStatsAndSave']()[_0x40ce0c(0x128)](()=>{});},0x3c*0x3e8),RequestMonitor['getUsageRessourcesStatsAndSave']()['then'](()=>{});}static async[a1_0x49b1a2(0xfd)](){const _0x40620a=a1_0x49b1a2,_0xc2d02=osu[_0x40620a(0x140)],_0x4c5300=osu[_0x40620a(0xfc)],_0x29a2f4=osu[_0x40620a(0x145)],_0x1977af={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x4cd91b=await _0x29a2f4[_0x40620a(0x142)]();_0x1977af[_0x40620a(0x114)]['inputMb']=_0x4cd91b[_0x40620a(0x114)][_0x40620a(0x105)],_0x1977af['total'][_0x40620a(0x10c)]=_0x4cd91b[_0x40620a(0x114)][_0x40620a(0x10c)];}catch(_0x3999c4){}let _0x176f8c=0x0;try{_0x176f8c=await _0xc2d02[_0x40620a(0x12e)]();}catch(_0x24d4d5){console[_0x40620a(0x13a)](_0x40620a(0x135),_0x24d4d5);}const _0x216d15={'usedMemMb':0x0};try{const _0x34e176=await _0x4c5300[_0x40620a(0x144)]();_0x216d15[_0x40620a(0xfb)]=_0x34e176[_0x40620a(0xfb)];}catch(_0x4ddba9){console[_0x40620a(0x13a)](_0x40620a(0x104),_0x4ddba9);}const _0x3a335f=new Date()[_0x40620a(0x13d)]()['toString']()[_0x40620a(0x146)](0x2,'0')+':'+new Date()[_0x40620a(0x121)]()[_0x40620a(0x137)]()['padStart'](0x2,'0');RequestMonitor[_0x40620a(0x13e)]['cpu']=RequestMonitor['ressourcesUsageStats'][_0x40620a(0x140)]['slice'](-0x3c)[_0x40620a(0x10b)](_0x25f35a=>_0x25f35a[_0x40620a(0x100)]!==_0x3a335f),RequestMonitor['ressourcesUsageStats'][_0x40620a(0xf9)]=RequestMonitor['ressourcesUsageStats'][_0x40620a(0xf9)][_0x40620a(0x102)](-0x3c)[_0x40620a(0x10b)](_0xd53f7a=>_0xd53f7a[_0x40620a(0x100)]!==_0x3a335f),RequestMonitor[_0x40620a(0x13e)]['network']=RequestMonitor[_0x40620a(0x13e)][_0x40620a(0x10f)][_0x40620a(0x102)](-0x3c)[_0x40620a(0x10b)](_0x35a03=>_0x35a03[_0x40620a(0x100)]!==_0x3a335f),RequestMonitor[_0x40620a(0x13e)][_0x40620a(0x140)]['push']({'time':_0x3a335f,'usage':_0x176f8c}),RequestMonitor[_0x40620a(0x13e)][_0x40620a(0xf9)][_0x40620a(0x132)]({'time':_0x3a335f,'usage':(_0x216d15[_0x40620a(0xfb)]/0x3e8)[_0x40620a(0x101)](0x2)}),RequestMonitor[_0x40620a(0x13e)][_0x40620a(0x10f)][_0x40620a(0x132)]({'time':_0x3a335f,'usage':{'in':_0x1977af['total']?.['inputMb']??0x0,'out':_0x1977af[_0x40620a(0x114)]?.['outputMb']??0x0}});try{await fs[_0x40620a(0x103)](RequestMonitor[_0x40620a(0x147)],JSON[_0x40620a(0x11b)](RequestMonitor[_0x40620a(0x13e)],null,0x2));}catch(_0x4c88bd){console[_0x40620a(0x141)](_0x40620a(0x129),_0x4c88bd);}}static[a1_0x49b1a2(0x127)](){const _0x37a21f=a1_0x49b1a2,_0x304859=Date[_0x37a21f(0x123)](),_0x2457e3=_0x304859-0x3c*0x3c*0x3e8,_0x3911b1=_0x304859-0x18*0x3c*0x3c*0x3e8,_0x53ed31=RequestMonitor[_0x37a21f(0x109)]['filter'](_0x432c2b=>_0x432c2b[_0x37a21f(0x12f)]>_0x2457e3),_0x542532={'total':RequestMonitor[_0x37a21f(0x136)][_0x37a21f(0x120)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x37a21f(0x136)][_0x37a21f(0x113)](_0x13f402=>{const _0xd5dc22=_0x37a21f;_0x542532[_0xd5dc22(0x111)][_0x13f402['statusCode']]=(_0x542532['byCodes'][_0x13f402[_0xd5dc22(0x10a)]]||0x0)+0x1;const _0x1c2e12=_0x13f402[_0xd5dc22(0x130)]+'\x20'+_0x13f402[_0xd5dc22(0x108)];!_0x542532[_0xd5dc22(0x11c)][_0x1c2e12]&&(_0x542532['byPath'][_0x1c2e12]={'total':0x0,'codes':{}}),_0x542532['byPath'][_0x1c2e12][_0xd5dc22(0x114)]++,_0x542532[_0xd5dc22(0x11c)][_0x1c2e12][_0xd5dc22(0x13f)][_0x13f402[_0xd5dc22(0x10a)]]=(_0x542532[_0xd5dc22(0x11c)][_0x1c2e12][_0xd5dc22(0x13f)][_0x13f402[_0xd5dc22(0x10a)]]||0x0)+0x1;}),{'rps':_0x53ed31,'httpCodes':_0x542532,'ressourcesUsageStats':RequestMonitor['ressourcesUsageStats']};}}RequestMonitor[a1_0x49b1a2(0x10d)]()[a1_0x49b1a2(0x128)](()=>{}),RequestMonitor[a1_0x49b1a2(0x13b)]();const counter=RequestMonitor;module[a1_0x49b1a2(0x125)]=counter;