function a1_0x4e40(_0x3efd98,_0x2f0f48){const _0x3cd154=a1_0x3cd1();return a1_0x4e40=function(_0x4e4048,_0x1ff7aa){_0x4e4048=_0x4e4048-0x1d1;let _0x188a13=_0x3cd154[_0x4e4048];return _0x188a13;},a1_0x4e40(_0x3efd98,_0x2f0f48);}const a1_0x3b2e1c=a1_0x4e40;(function(_0x4ea33f,_0x416c6f){const _0x77cddc=a1_0x4e40,_0x145669=_0x4ea33f();while(!![]){try{const _0xf8f3b9=-parseInt(_0x77cddc(0x1e6))/0x1+parseInt(_0x77cddc(0x206))/0x2*(parseInt(_0x77cddc(0x200))/0x3)+parseInt(_0x77cddc(0x20d))/0x4+parseInt(_0x77cddc(0x1f6))/0x5+-parseInt(_0x77cddc(0x204))/0x6+parseInt(_0x77cddc(0x1d7))/0x7*(parseInt(_0x77cddc(0x208))/0x8)+parseInt(_0x77cddc(0x1fd))/0x9;if(_0xf8f3b9===_0x416c6f)break;else _0x145669['push'](_0x145669['shift']());}catch(_0x31effb){_0x145669['push'](_0x145669['shift']());}}}(a1_0x3cd1,0x3fae6));function a1_0x3cd1(){const _0x34a1e9=['rpsData','byPath','getHours','then','inOut','getUsageRessourcesStatsAndSave','floor','122161rssIfu','getMinutes','includes','writeFile','info','network','lastMinute','byCodes','toString','httpCodesData','forEach','end','netstat','outputMb','readFile','filter','145285YARott','log','httpCodesStoragePath','Error\x20saving\x20monitoring\x20data:','memory','Request\x20monitor\x20initialized.','push','1524213NefQpq','apply','init','61875ySrbRr','middleware','time','Error\x20getting\x20memory\x20usage:','1752552xnkRmn','usedMemMb','2nQNeKc','currentRequests','72PZNBSf','rpsStoragePath','cadviewer/settings/ressources-usage-stats.json','now','length','515176gRUWjy','node-os-utils','path','method','timestamp','ressourcesUsageStatsPath','statusCode','total','save','getStats','cpu','ressourcesUsageStats','stringify','254534EjwaSz','utf8','codes','padStart','parse','slice','promises','inputMb'];a1_0x3cd1=function(){return _0x34a1e9;};return a1_0x3cd1();}const fs=require('fs')[a1_0x3b2e1c(0x1dd)],osu=require(a1_0x3b2e1c(0x20e));class RequestMonitor{static [a1_0x3b2e1c(0x209)]='cadviewer/settings/requests-per-minute.json';static [a1_0x3b2e1c(0x1f8)]='cadviewer/settings/http-codes-24h.json';static ['ressourcesUsageStatsPath']=a1_0x3b2e1c(0x20a);static [a1_0x3b2e1c(0x1df)]=[];static [a1_0x3b2e1c(0x1ef)]=[];static [a1_0x3b2e1c(0x1d5)]={};static ['lastMinute']=Math['floor'](Date[a1_0x3b2e1c(0x20b)]()/0x3e8/0x3c);static ['currentRequests']=0x0;static async[a1_0x3b2e1c(0x1ff)](){const _0x49b1bb=a1_0x3b2e1c;console['log']('Initializing\x20request\x20monitor...');try{const _0x31e4e3=await fs[_0x49b1bb(0x1f4)](RequestMonitor[_0x49b1bb(0x209)],'utf8');RequestMonitor[_0x49b1bb(0x1df)]=JSON[_0x49b1bb(0x1db)](_0x31e4e3);}catch(_0xa65c39){RequestMonitor['rpsData']=[];}try{const _0x3c7fe3=await fs[_0x49b1bb(0x1f4)](RequestMonitor[_0x49b1bb(0x1f8)],_0x49b1bb(0x1d8));RequestMonitor[_0x49b1bb(0x1ef)]=JSON['parse'](_0x3c7fe3);}catch(_0x412ac5){RequestMonitor[_0x49b1bb(0x1ef)]=[];}try{const _0x1b6a8f=await fs[_0x49b1bb(0x1f4)](RequestMonitor[_0x49b1bb(0x212)],_0x49b1bb(0x1d8));RequestMonitor[_0x49b1bb(0x1d5)]=JSON[_0x49b1bb(0x1db)](_0x1b6a8f),!RequestMonitor['ressourcesUsageStats']['cpu']&&(RequestMonitor['ressourcesUsageStats'][_0x49b1bb(0x1d4)]=[]),!RequestMonitor[_0x49b1bb(0x1d5)][_0x49b1bb(0x1fa)]&&(RequestMonitor[_0x49b1bb(0x1d5)][_0x49b1bb(0x1fa)]=[]),!RequestMonitor[_0x49b1bb(0x1d5)]['network']&&(RequestMonitor['ressourcesUsageStats'][_0x49b1bb(0x1eb)]=[]);}catch(_0x49adf8){RequestMonitor[_0x49b1bb(0x1d5)]={'cpu':[],'memory':[],'network':[]};}console[_0x49b1bb(0x1f7)](_0x49b1bb(0x1fb));}static[a1_0x3b2e1c(0x201)](_0x2a64a2,_0x1451da,_0x4cd50d){const _0x3af559=a1_0x3b2e1c;if(_0x2a64a2[_0x3af559(0x20f)][_0x3af559(0x1e8)]('/metrics'))return _0x4cd50d();console[_0x3af559(0x1f7)]('Request\x20monitor\x20middleware');let _0x92caf6=Date[_0x3af559(0x20b)](),_0x574dcb=Math[_0x3af559(0x1e5)](_0x92caf6/0x3e8/0x3c);console[_0x3af559(0x1f7)]('=======>');const _0x7b451b=_0x1451da[_0x3af559(0x1f1)];_0x1451da[_0x3af559(0x1f1)]=(..._0x57e757)=>{const _0x2a348c=_0x3af559;console['log'](_0x574dcb,{'currentMinute':_0x574dcb});_0x574dcb>RequestMonitor[_0x2a348c(0x1ec)]&&(RequestMonitor[_0x2a348c(0x1df)][_0x2a348c(0x1fc)]({'timestamp':RequestMonitor[_0x2a348c(0x1ec)]*0x3e8*0x3c,'requests':RequestMonitor[_0x2a348c(0x207)]}),RequestMonitor[_0x2a348c(0x207)]=0x0,RequestMonitor[_0x2a348c(0x1ec)]=_0x574dcb);RequestMonitor[_0x2a348c(0x207)]++,RequestMonitor['httpCodesData'][_0x2a348c(0x1fc)]({'timestamp':Date[_0x2a348c(0x20b)](),'statusCode':_0x1451da[_0x2a348c(0x213)],'path':_0x2a64a2[_0x2a348c(0x20f)],'method':_0x2a64a2[_0x2a348c(0x210)]});const _0x896eba=Date[_0x2a348c(0x20b)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x2a348c(0x1ef)]=RequestMonitor[_0x2a348c(0x1ef)][_0x2a348c(0x1f5)](_0x44c4e7=>_0x44c4e7[_0x2a348c(0x211)]>_0x896eba),_0x7b451b[_0x2a348c(0x1fe)](_0x1451da,_0x57e757);},_0x4cd50d();}static async[a1_0x3b2e1c(0x1d2)](){const _0xd108f3=a1_0x3b2e1c;try{RequestMonitor['lastMinute']!==Math[_0xd108f3(0x1e5)](Date[_0xd108f3(0x20b)]()/0x3e8/0x3c)&&(RequestMonitor[_0xd108f3(0x1df)][_0xd108f3(0x1fc)]({'timestamp':RequestMonitor[_0xd108f3(0x1ec)]*0x3e8*0x3c,'requests':RequestMonitor[_0xd108f3(0x207)]}),RequestMonitor[_0xd108f3(0x207)]=0x0,RequestMonitor[_0xd108f3(0x1ec)]=Math[_0xd108f3(0x1e5)](Date['now']()/0x3e8/0x3c)),await fs['writeFile'](RequestMonitor[_0xd108f3(0x209)],JSON[_0xd108f3(0x1d6)](RequestMonitor[_0xd108f3(0x1df)],null,0x2)),await fs['writeFile'](RequestMonitor['httpCodesStoragePath'],JSON[_0xd108f3(0x1d6)](RequestMonitor['httpCodesData'],null,0x2));}catch(_0x3aeceb){console['error'](_0xd108f3(0x1f9),_0x3aeceb);}}static async['startPeriodicSave'](){const _0x4851e4=a1_0x3b2e1c;setInterval(()=>RequestMonitor[_0x4851e4(0x1d2)](),0x3c*0x3e8),setInterval(()=>{const _0x5b9e21=_0x4851e4;RequestMonitor[_0x5b9e21(0x1e4)]()[_0x5b9e21(0x1e2)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x4851e4(0x1e4)]()[_0x4851e4(0x1e2)](()=>{});}static async[a1_0x3b2e1c(0x1e4)](){const _0x248f29=a1_0x3b2e1c,_0x3d3103=osu[_0x248f29(0x1d4)],_0x5cc580=osu['mem'],_0x2ca1c3=osu[_0x248f29(0x1f2)],_0x2f25d3={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x599ebd=await _0x2ca1c3[_0x248f29(0x1e3)]();_0x2f25d3['total'][_0x248f29(0x1de)]=_0x599ebd[_0x248f29(0x1d1)][_0x248f29(0x1de)],_0x2f25d3['total'][_0x248f29(0x1f3)]=_0x599ebd['total'][_0x248f29(0x1f3)];}catch(_0x392d78){}let _0xf8f2a9=0x0;try{_0xf8f2a9=await _0x3d3103['usage']();}catch(_0x345af1){console['log']('Error\x20getting\x20CPU\x20usage:',_0x345af1);}const _0x565519={'usedMemMb':0x0};try{const _0x3eff7b=await _0x5cc580[_0x248f29(0x1ea)]();_0x565519[_0x248f29(0x205)]=_0x3eff7b['usedMemMb'];}catch(_0x26128d){console[_0x248f29(0x1f7)](_0x248f29(0x203),_0x26128d);}const _0x339085=new Date()[_0x248f29(0x1e1)]()[_0x248f29(0x1ee)]()[_0x248f29(0x1da)](0x2,'0')+':'+new Date()[_0x248f29(0x1e7)]()[_0x248f29(0x1ee)]()[_0x248f29(0x1da)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x248f29(0x1d4)]=RequestMonitor[_0x248f29(0x1d5)]['cpu']['slice'](-0x3c)[_0x248f29(0x1f5)](_0x49d2c2=>_0x49d2c2[_0x248f29(0x202)]!==_0x339085),RequestMonitor[_0x248f29(0x1d5)]['memory']=RequestMonitor[_0x248f29(0x1d5)][_0x248f29(0x1fa)][_0x248f29(0x1dc)](-0x3c)[_0x248f29(0x1f5)](_0x1be406=>_0x1be406[_0x248f29(0x202)]!==_0x339085),RequestMonitor['ressourcesUsageStats'][_0x248f29(0x1eb)]=RequestMonitor['ressourcesUsageStats'][_0x248f29(0x1eb)][_0x248f29(0x1dc)](-0x3c)[_0x248f29(0x1f5)](_0x1bf0bb=>_0x1bf0bb['time']!==_0x339085),RequestMonitor[_0x248f29(0x1d5)][_0x248f29(0x1d4)][_0x248f29(0x1fc)]({'time':_0x339085,'usage':_0xf8f2a9}),RequestMonitor[_0x248f29(0x1d5)][_0x248f29(0x1fa)]['push']({'time':_0x339085,'usage':(_0x565519['usedMemMb']/0x3e8)['toFixed'](0x2)}),RequestMonitor['ressourcesUsageStats'][_0x248f29(0x1eb)][_0x248f29(0x1fc)]({'time':_0x339085,'usage':{'in':_0x2f25d3[_0x248f29(0x1d1)]?.[_0x248f29(0x1de)]??0x0,'out':_0x2f25d3['total']?.[_0x248f29(0x1f3)]??0x0}});try{await fs[_0x248f29(0x1e9)](RequestMonitor[_0x248f29(0x212)],JSON[_0x248f29(0x1d6)](RequestMonitor[_0x248f29(0x1d5)],null,0x2));}catch(_0x9f23c8){console['error'](_0x248f29(0x1f9),_0x9f23c8);}}static[a1_0x3b2e1c(0x1d3)](){const _0x1a5f96=a1_0x3b2e1c,_0x2c7eb0=Date[_0x1a5f96(0x20b)](),_0x41f514=_0x2c7eb0-0x3c*0x3c*0x3e8,_0x42e873=_0x2c7eb0-0x18*0x3c*0x3c*0x3e8,_0x14ce64=RequestMonitor[_0x1a5f96(0x1df)][_0x1a5f96(0x1f5)](_0x2bcda2=>_0x2bcda2[_0x1a5f96(0x211)]>_0x41f514),_0x1f3cae={'total':RequestMonitor[_0x1a5f96(0x1ef)][_0x1a5f96(0x20c)],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x1a5f96(0x1f0)](_0x1eba00=>{const _0x3c80a8=_0x1a5f96;_0x1f3cae[_0x3c80a8(0x1ed)][_0x1eba00['statusCode']]=(_0x1f3cae['byCodes'][_0x1eba00[_0x3c80a8(0x213)]]||0x0)+0x1;const _0x1e44f2=_0x1eba00[_0x3c80a8(0x210)]+'\x20'+_0x1eba00[_0x3c80a8(0x20f)];!_0x1f3cae['byPath'][_0x1e44f2]&&(_0x1f3cae[_0x3c80a8(0x1e0)][_0x1e44f2]={'total':0x0,'codes':{}}),_0x1f3cae['byPath'][_0x1e44f2]['total']++,_0x1f3cae[_0x3c80a8(0x1e0)][_0x1e44f2][_0x3c80a8(0x1d9)][_0x1eba00[_0x3c80a8(0x213)]]=(_0x1f3cae['byPath'][_0x1e44f2]['codes'][_0x1eba00['statusCode']]||0x0)+0x1;}),{'rps':_0x14ce64,'httpCodes':_0x1f3cae,'ressourcesUsageStats':RequestMonitor[_0x1a5f96(0x1d5)]};}}RequestMonitor[a1_0x3b2e1c(0x1ff)]()[a1_0x3b2e1c(0x1e2)](()=>{}),RequestMonitor['startPeriodicSave']();const counter=RequestMonitor;module['exports']=counter;