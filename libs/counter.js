const a2_0x5708a6=a2_0xf92b;(function(_0x1cae10,_0x1fb84c){const _0x2dabf8=a2_0xf92b,_0x2e9d4c=_0x1cae10();while(!![]){try{const _0x589baa=-parseInt(_0x2dabf8(0x88))/0x1*(parseInt(_0x2dabf8(0x9a))/0x2)+-parseInt(_0x2dabf8(0xbc))/0x3+parseInt(_0x2dabf8(0xbd))/0x4+-parseInt(_0x2dabf8(0xad))/0x5+parseInt(_0x2dabf8(0x9b))/0x6+-parseInt(_0x2dabf8(0x7f))/0x7*(parseInt(_0x2dabf8(0x89))/0x8)+parseInt(_0x2dabf8(0x96))/0x9;if(_0x589baa===_0x1fb84c)break;else _0x2e9d4c['push'](_0x2e9d4c['shift']());}catch(_0x4ba268){_0x2e9d4c['push'](_0x2e9d4c['shift']());}}}(a2_0x43a8,0xd86de));function a2_0xf92b(_0x46721e,_0x21cad7){const _0x43a862=a2_0x43a8();return a2_0xf92b=function(_0xf92b97,_0x2b0c9b){_0xf92b97=_0xf92b97-0x78;let _0xc8c471=_0x43a862[_0xf92b97];return _0xc8c471;},a2_0xf92b(_0x46721e,_0x21cad7);}const fs=require('fs')[a2_0x5708a6(0xab)],osu=require(a2_0x5708a6(0x79));function a2_0x43a8(){const _0x3b5b2d=['includes','readFile','10265967QNUkTc','Error\x20getting\x20memory\x20usage:','cpu','statusCode','1335130AxkKSB','6156270nhRfjJ','outputMb','usage','memory','cadviewer/settings/ressources-usage-stats.json','getStats','getHours','network','ressourcesUsageStats','init','time','Error\x20getting\x20CPU\x20usage:','middleware','padStart','error','netstat','promises','inOut','3118210UzmUOF','filter','end','forEach','path','log','toFixed','push','total','byPath','usedMemMb','lastMinute','currentRequests','cadviewer/settings/requests-per-minute.json','httpCodesData','151203dGhHJD','1702836MNmnDw','getMinutes','apply','getUsageRessourcesStatsAndSave','length','mem','timestamp','node-os-utils','rpsData','toString','exports','Error\x20saving\x20monitoring\x20data:','utf8','52045xcRIWh','then','Initializing\x20request\x20monitor...','byCodes','slice','now','floor','codes','rpsStoragePath','1abmeHu','392uhyvej','method','writeFile','ressourcesUsageStatsPath','=======>','startPeriodicSave','inputMb','parse','httpCodesStoragePath','stringify','save'];a2_0x43a8=function(){return _0x3b5b2d;};return a2_0x43a8();}class RequestMonitor{static [a2_0x5708a6(0x87)]=a2_0x5708a6(0xba);static [a2_0x5708a6(0x91)]='cadviewer/settings/http-codes-24h.json';static ['ressourcesUsageStatsPath']=a2_0x5708a6(0x9f);static [a2_0x5708a6(0x7a)]=[];static [a2_0x5708a6(0xbb)]=[];static [a2_0x5708a6(0xa3)]={};static [a2_0x5708a6(0xb8)]=Math[a2_0x5708a6(0x85)](Date[a2_0x5708a6(0x84)]()/0x3e8/0x3c);static [a2_0x5708a6(0xb9)]=0x0;static async[a2_0x5708a6(0xa4)](){const _0x38e154=a2_0x5708a6;console[_0x38e154(0xb2)](_0x38e154(0x81));try{const _0x977172=await fs[_0x38e154(0x95)](RequestMonitor[_0x38e154(0x87)],_0x38e154(0x7e));RequestMonitor[_0x38e154(0x7a)]=JSON[_0x38e154(0x90)](_0x977172);}catch(_0x250de3){RequestMonitor[_0x38e154(0x7a)]=[];}try{const _0x277fc6=await fs[_0x38e154(0x95)](RequestMonitor[_0x38e154(0x91)],_0x38e154(0x7e));RequestMonitor[_0x38e154(0xbb)]=JSON[_0x38e154(0x90)](_0x277fc6);}catch(_0x539c44){RequestMonitor[_0x38e154(0xbb)]=[];}try{const _0x6ea151=await fs[_0x38e154(0x95)](RequestMonitor[_0x38e154(0x8c)],'utf8');RequestMonitor[_0x38e154(0xa3)]=JSON[_0x38e154(0x90)](_0x6ea151),!RequestMonitor['ressourcesUsageStats'][_0x38e154(0x98)]&&(RequestMonitor['ressourcesUsageStats'][_0x38e154(0x98)]=[]),!RequestMonitor['ressourcesUsageStats']['memory']&&(RequestMonitor['ressourcesUsageStats'][_0x38e154(0x9e)]=[]),!RequestMonitor[_0x38e154(0xa3)][_0x38e154(0xa2)]&&(RequestMonitor['ressourcesUsageStats']['network']=[]);}catch(_0x1c2ab9){RequestMonitor[_0x38e154(0xa3)]={'cpu':[],'memory':[],'network':[]};}console['log']('Request\x20monitor\x20initialized.');}static[a2_0x5708a6(0xa7)](_0x54fffd,_0x35e93e,_0x2ad07f){const _0x5577ec=a2_0x5708a6;if(_0x54fffd[_0x5577ec(0xb1)][_0x5577ec(0x94)]('/metrics'))return _0x2ad07f();console[_0x5577ec(0xb2)]('Request\x20monitor\x20middleware');let _0x1d52fa=Date[_0x5577ec(0x84)](),_0xed88fd=Math[_0x5577ec(0x85)](_0x1d52fa/0x3e8/0x3c);console[_0x5577ec(0xb2)](_0x5577ec(0x8d));const _0x3a6ff7=_0x35e93e[_0x5577ec(0xaf)];_0x35e93e[_0x5577ec(0xaf)]=(..._0x4bf0f4)=>{const _0x5a0284=_0x5577ec;console['log'](_0xed88fd,{'currentMinute':_0xed88fd});_0xed88fd>RequestMonitor[_0x5a0284(0xb8)]&&(RequestMonitor[_0x5a0284(0x7a)]['push']({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x5a0284(0xb9)]}),RequestMonitor[_0x5a0284(0xb9)]=0x0,RequestMonitor[_0x5a0284(0xb8)]=_0xed88fd);RequestMonitor[_0x5a0284(0xb9)]++,RequestMonitor['httpCodesData'][_0x5a0284(0xb4)]({'timestamp':Date['now'](),'statusCode':_0x35e93e[_0x5a0284(0x99)],'path':_0x54fffd[_0x5a0284(0xb1)],'method':_0x54fffd[_0x5a0284(0x8a)]});const _0x1e6886=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x5a0284(0xbb)]=RequestMonitor[_0x5a0284(0xbb)][_0x5a0284(0xae)](_0x220bc7=>_0x220bc7[_0x5a0284(0x78)]>_0x1e6886),_0x3a6ff7[_0x5a0284(0xbf)](_0x35e93e,_0x4bf0f4);},_0x2ad07f();}static async['save'](){const _0x4613f0=a2_0x5708a6;try{RequestMonitor[_0x4613f0(0xb8)]!==Math[_0x4613f0(0x85)](Date[_0x4613f0(0x84)]()/0x3e8/0x3c)&&(RequestMonitor[_0x4613f0(0x7a)]['push']({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x4613f0(0xb9)]}),RequestMonitor[_0x4613f0(0xb9)]=0x0,RequestMonitor['lastMinute']=Math[_0x4613f0(0x85)](Date[_0x4613f0(0x84)]()/0x3e8/0x3c)),await fs['writeFile'](RequestMonitor['rpsStoragePath'],JSON[_0x4613f0(0x92)](RequestMonitor[_0x4613f0(0x7a)],null,0x2)),await fs[_0x4613f0(0x8b)](RequestMonitor['httpCodesStoragePath'],JSON[_0x4613f0(0x92)](RequestMonitor[_0x4613f0(0xbb)],null,0x2));}catch(_0x2d4ae2){console[_0x4613f0(0xa9)](_0x4613f0(0x7d),_0x2d4ae2);}}static async['startPeriodicSave'](){const _0x28a228=a2_0x5708a6;setInterval(()=>RequestMonitor[_0x28a228(0x93)](),0x3c*0x3e8),setInterval(()=>{const _0x1290ff=_0x28a228;RequestMonitor[_0x1290ff(0xc0)]()[_0x1290ff(0x80)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x28a228(0xc0)]()['then'](()=>{});}static async[a2_0x5708a6(0xc0)](){const _0x592bda=a2_0x5708a6,_0x486ee7=osu[_0x592bda(0x98)],_0xe1a76a=osu[_0x592bda(0xc2)],_0x5c6696=osu[_0x592bda(0xaa)],_0x527ab5={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x52334c=await _0x5c6696[_0x592bda(0xac)]();_0x527ab5['total'][_0x592bda(0x8f)]=_0x52334c[_0x592bda(0xb5)][_0x592bda(0x8f)],_0x527ab5[_0x592bda(0xb5)][_0x592bda(0x9c)]=_0x52334c[_0x592bda(0xb5)][_0x592bda(0x9c)];}catch(_0x12a0e1){}let _0x44c5f4=0x0;try{_0x44c5f4=await _0x486ee7[_0x592bda(0x9d)]();}catch(_0x26ae46){console[_0x592bda(0xb2)](_0x592bda(0xa6),_0x26ae46);}const _0x53c15d={'usedMemMb':0x0};try{const _0x853825=await _0xe1a76a['info']();_0x53c15d[_0x592bda(0xb7)]=_0x853825[_0x592bda(0xb7)];}catch(_0x43b284){console[_0x592bda(0xb2)](_0x592bda(0x97),_0x43b284);}const _0x4bff19=new Date()[_0x592bda(0xa1)]()[_0x592bda(0x7b)]()[_0x592bda(0xa8)](0x2,'0')+':'+new Date()[_0x592bda(0xbe)]()[_0x592bda(0x7b)]()[_0x592bda(0xa8)](0x2,'0');RequestMonitor[_0x592bda(0xa3)][_0x592bda(0x98)]=RequestMonitor[_0x592bda(0xa3)][_0x592bda(0x98)][_0x592bda(0x83)](-0x3c)[_0x592bda(0xae)](_0x366f0f=>_0x366f0f['time']!==_0x4bff19),RequestMonitor[_0x592bda(0xa3)][_0x592bda(0x9e)]=RequestMonitor['ressourcesUsageStats']['memory'][_0x592bda(0x83)](-0x3c)[_0x592bda(0xae)](_0x166e9a=>_0x166e9a[_0x592bda(0xa5)]!==_0x4bff19),RequestMonitor[_0x592bda(0xa3)][_0x592bda(0xa2)]=RequestMonitor[_0x592bda(0xa3)][_0x592bda(0xa2)][_0x592bda(0x83)](-0x3c)[_0x592bda(0xae)](_0x14224c=>_0x14224c[_0x592bda(0xa5)]!==_0x4bff19),RequestMonitor[_0x592bda(0xa3)][_0x592bda(0x98)][_0x592bda(0xb4)]({'time':_0x4bff19,'usage':_0x44c5f4}),RequestMonitor[_0x592bda(0xa3)][_0x592bda(0x9e)][_0x592bda(0xb4)]({'time':_0x4bff19,'usage':(_0x53c15d['usedMemMb']/0x3e8)[_0x592bda(0xb3)](0x2)}),RequestMonitor[_0x592bda(0xa3)][_0x592bda(0xa2)][_0x592bda(0xb4)]({'time':_0x4bff19,'usage':{'in':_0x527ab5[_0x592bda(0xb5)]?.[_0x592bda(0x8f)]??0x0,'out':_0x527ab5[_0x592bda(0xb5)]?.['outputMb']??0x0}});try{await fs[_0x592bda(0x8b)](RequestMonitor[_0x592bda(0x8c)],JSON[_0x592bda(0x92)](RequestMonitor[_0x592bda(0xa3)],null,0x2));}catch(_0x5685f7){console['error'](_0x592bda(0x7d),_0x5685f7);}}static[a2_0x5708a6(0xa0)](){const _0x184175=a2_0x5708a6,_0x25a246=Date[_0x184175(0x84)](),_0xb8ca92=_0x25a246-0x3c*0x3c*0x3e8,_0x314332=_0x25a246-0x18*0x3c*0x3c*0x3e8,_0x399301=RequestMonitor[_0x184175(0x7a)][_0x184175(0xae)](_0x15a0de=>_0x15a0de[_0x184175(0x78)]>_0xb8ca92),_0x3c5c2b={'total':RequestMonitor[_0x184175(0xbb)][_0x184175(0xc1)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x184175(0xbb)][_0x184175(0xb0)](_0x4e7b13=>{const _0x323a65=_0x184175;_0x3c5c2b[_0x323a65(0x82)][_0x4e7b13['statusCode']]=(_0x3c5c2b['byCodes'][_0x4e7b13[_0x323a65(0x99)]]||0x0)+0x1;const _0x161ff1=_0x4e7b13[_0x323a65(0x8a)]+'\x20'+_0x4e7b13['path'];!_0x3c5c2b[_0x323a65(0xb6)][_0x161ff1]&&(_0x3c5c2b[_0x323a65(0xb6)][_0x161ff1]={'total':0x0,'codes':{}}),_0x3c5c2b[_0x323a65(0xb6)][_0x161ff1][_0x323a65(0xb5)]++,_0x3c5c2b[_0x323a65(0xb6)][_0x161ff1][_0x323a65(0x86)][_0x4e7b13['statusCode']]=(_0x3c5c2b['byPath'][_0x161ff1][_0x323a65(0x86)][_0x4e7b13['statusCode']]||0x0)+0x1;}),{'rps':_0x399301,'httpCodes':_0x3c5c2b,'ressourcesUsageStats':RequestMonitor[_0x184175(0xa3)]};}}RequestMonitor['init']()['then'](()=>{}),RequestMonitor[a2_0x5708a6(0x8e)]();const counter=RequestMonitor;module[a2_0x5708a6(0x7c)]=counter;