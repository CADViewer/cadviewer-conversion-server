const a1_0x47257b=a1_0x3387;function a1_0x3387(_0x395222,_0x363e0c){const _0x1a33b8=a1_0x1a33();return a1_0x3387=function(_0x338720,_0x2af04b){_0x338720=_0x338720-0x8b;let _0x3eb8f6=_0x1a33b8[_0x338720];return _0x3eb8f6;},a1_0x3387(_0x395222,_0x363e0c);}(function(_0xc346f6,_0x474464){const _0x100492=a1_0x3387,_0x4f085c=_0xc346f6();while(!![]){try{const _0x280a64=-parseInt(_0x100492(0x95))/0x1*(parseInt(_0x100492(0xc5))/0x2)+-parseInt(_0x100492(0xd0))/0x3+-parseInt(_0x100492(0xb8))/0x4*(-parseInt(_0x100492(0xab))/0x5)+-parseInt(_0x100492(0xa3))/0x6+parseInt(_0x100492(0xbf))/0x7*(parseInt(_0x100492(0x8f))/0x8)+-parseInt(_0x100492(0x98))/0x9+parseInt(_0x100492(0x90))/0xa*(parseInt(_0x100492(0xbe))/0xb);if(_0x280a64===_0x474464)break;else _0x4f085c['push'](_0x4f085c['shift']());}catch(_0xdf752a){_0x4f085c['push'](_0x4f085c['shift']());}}}(a1_0x1a33,0xd0381));const fs=require('fs')[a1_0x47257b(0x9b)],osu=require(a1_0x47257b(0xcd));function a1_0x1a33(){const _0x17d9d8=['save','12741282tQoBji','Error\x20getting\x20memory\x20usage:','Request\x20monitor\x20middleware','promises','total','padStart','Error\x20getting\x20CPU\x20usage:','time','inputMb','init','now','4615044ITwPUF','mem','end','lastMinute','includes','Request\x20monitor\x20initialized.','slice','info','1356310hicMRh','path','ressourcesUsageStatsPath','ressourcesUsageStats','Initializing\x20request\x20monitor...','floor','timestamp','memory','error','filter','utf8','toFixed','middleware','12lZgcyq','then','cadviewer/settings/requests-per-minute.json','stringify','startPeriodicSave','push','723855rGkird','469FuNQSd','getUsageRessourcesStatsAndSave','method','httpCodesData','readFile','currentRequests','2jfjOFL','apply','codes','cadviewer/settings/http-codes-24h.json','cpu','usedMemMb','httpCodesStoragePath','getHours','node-os-utils','length','netstat','4311945xhFZQz','writeFile','rpsStoragePath','parse','network','=======>','byPath','Error\x20saving\x20monitoring\x20data:','statusCode','log','toString','28592MuhyFH','730xmxwtG','byCodes','outputMb','rpsData','usage','1381957gZJlGK','forEach'];a1_0x1a33=function(){return _0x17d9d8;};return a1_0x1a33();}class RequestMonitor{static [a1_0x47257b(0xd2)]=a1_0x47257b(0xba);static [a1_0x47257b(0xcb)]=a1_0x47257b(0xc8);static [a1_0x47257b(0xad)]='cadviewer/settings/ressources-usage-stats.json';static [a1_0x47257b(0x93)]=[];static [a1_0x47257b(0xc2)]=[];static [a1_0x47257b(0xae)]={};static [a1_0x47257b(0xa6)]=Math[a1_0x47257b(0xb0)](Date[a1_0x47257b(0xa2)]()/0x3e8/0x3c);static [a1_0x47257b(0xc4)]=0x0;static async[a1_0x47257b(0xa1)](){const _0x4a5080=a1_0x47257b;console[_0x4a5080(0x8d)](_0x4a5080(0xaf));try{const _0x5cbb4f=await fs[_0x4a5080(0xc3)](RequestMonitor[_0x4a5080(0xd2)],_0x4a5080(0xb5));RequestMonitor[_0x4a5080(0x93)]=JSON['parse'](_0x5cbb4f);}catch(_0xcbcd94){RequestMonitor['rpsData']=[];}try{const _0x25af6b=await fs[_0x4a5080(0xc3)](RequestMonitor[_0x4a5080(0xcb)],_0x4a5080(0xb5));RequestMonitor[_0x4a5080(0xc2)]=JSON[_0x4a5080(0xd3)](_0x25af6b);}catch(_0xe52eee){RequestMonitor[_0x4a5080(0xc2)]=[];}try{const _0xf7f5a0=await fs[_0x4a5080(0xc3)](RequestMonitor[_0x4a5080(0xad)],_0x4a5080(0xb5));RequestMonitor[_0x4a5080(0xae)]=JSON['parse'](_0xf7f5a0),!RequestMonitor[_0x4a5080(0xae)][_0x4a5080(0xc9)]&&(RequestMonitor[_0x4a5080(0xae)][_0x4a5080(0xc9)]=[]),!RequestMonitor[_0x4a5080(0xae)][_0x4a5080(0xb2)]&&(RequestMonitor['ressourcesUsageStats']['memory']=[]),!RequestMonitor['ressourcesUsageStats']['network']&&(RequestMonitor[_0x4a5080(0xae)]['network']=[]);}catch(_0x3d12fc){RequestMonitor[_0x4a5080(0xae)]={'cpu':[],'memory':[],'network':[]};}console[_0x4a5080(0x8d)](_0x4a5080(0xa8));}static[a1_0x47257b(0xb7)](_0x270bb9,_0x314f5c,_0x28ca37){const _0x4795d1=a1_0x47257b;if(_0x270bb9[_0x4795d1(0xac)][_0x4795d1(0xa7)]('/metrics'))return _0x28ca37();console[_0x4795d1(0x8d)](_0x4795d1(0x9a));let _0x4ace59=Date[_0x4795d1(0xa2)](),_0x12b98b=Math[_0x4795d1(0xb0)](_0x4ace59/0x3e8/0x3c);console['log'](_0x4795d1(0xd5));const _0x5255f6=_0x314f5c[_0x4795d1(0xa5)];_0x314f5c[_0x4795d1(0xa5)]=(..._0x196b27)=>{const _0x2a283d=_0x4795d1;console[_0x2a283d(0x8d)](_0x12b98b,{'currentMinute':_0x12b98b});_0x12b98b>RequestMonitor[_0x2a283d(0xa6)]&&(RequestMonitor[_0x2a283d(0x93)][_0x2a283d(0xbd)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor[_0x2a283d(0xc4)]}),RequestMonitor[_0x2a283d(0xc4)]=0x0,RequestMonitor[_0x2a283d(0xa6)]=_0x12b98b);RequestMonitor[_0x2a283d(0xc4)]++,RequestMonitor[_0x2a283d(0xc2)][_0x2a283d(0xbd)]({'timestamp':Date['now'](),'statusCode':_0x314f5c[_0x2a283d(0x8c)],'path':_0x270bb9['path'],'method':_0x270bb9['method']});const _0x1d2900=Date[_0x2a283d(0xa2)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor[_0x2a283d(0xc2)]['filter'](_0x4cdff7=>_0x4cdff7[_0x2a283d(0xb1)]>_0x1d2900),_0x5255f6[_0x2a283d(0xc6)](_0x314f5c,_0x196b27);},_0x28ca37();}static async[a1_0x47257b(0x97)](){const _0x52ed4b=a1_0x47257b;try{RequestMonitor['lastMinute']!==Math[_0x52ed4b(0xb0)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor['rpsData'][_0x52ed4b(0xbd)]({'timestamp':RequestMonitor[_0x52ed4b(0xa6)]*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x52ed4b(0xa6)]=Math[_0x52ed4b(0xb0)](Date[_0x52ed4b(0xa2)]()/0x3e8/0x3c)),await fs[_0x52ed4b(0xd1)](RequestMonitor[_0x52ed4b(0xd2)],JSON[_0x52ed4b(0xbb)](RequestMonitor[_0x52ed4b(0x93)],null,0x2)),await fs[_0x52ed4b(0xd1)](RequestMonitor[_0x52ed4b(0xcb)],JSON['stringify'](RequestMonitor[_0x52ed4b(0xc2)],null,0x2));}catch(_0x29eb70){console[_0x52ed4b(0xb3)](_0x52ed4b(0x8b),_0x29eb70);}}static async[a1_0x47257b(0xbc)](){const _0x3d7c37=a1_0x47257b;setInterval(()=>RequestMonitor[_0x3d7c37(0x97)](),0x3c*0x3e8),setInterval(()=>{RequestMonitor['getUsageRessourcesStatsAndSave']()['then'](()=>{});},0x3c*0x3e8),RequestMonitor[_0x3d7c37(0xc0)]()[_0x3d7c37(0xb9)](()=>{});}static async[a1_0x47257b(0xc0)](){const _0x91fd93=a1_0x47257b,_0x51fc9c=osu[_0x91fd93(0xc9)],_0x46c4af=osu[_0x91fd93(0xa4)],_0x376feb=osu[_0x91fd93(0xcf)],_0x5f457b={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x77b594=await _0x376feb['inOut']();_0x5f457b[_0x91fd93(0x9c)][_0x91fd93(0xa0)]=_0x77b594[_0x91fd93(0x9c)][_0x91fd93(0xa0)],_0x5f457b[_0x91fd93(0x9c)][_0x91fd93(0x92)]=_0x77b594[_0x91fd93(0x9c)]['outputMb'];}catch(_0x23e8df){}let _0x40b46d=0x0;try{_0x40b46d=await _0x51fc9c[_0x91fd93(0x94)]();}catch(_0x9600fe){console[_0x91fd93(0x8d)](_0x91fd93(0x9e),_0x9600fe);}const _0x39b5d0={'usedMemMb':0x0};try{const _0x22f841=await _0x46c4af[_0x91fd93(0xaa)]();_0x39b5d0[_0x91fd93(0xca)]=_0x22f841[_0x91fd93(0xca)];}catch(_0x583d4a){console[_0x91fd93(0x8d)](_0x91fd93(0x99),_0x583d4a);}const _0x3b1d2b=new Date()[_0x91fd93(0xcc)]()[_0x91fd93(0x8e)]()[_0x91fd93(0x9d)](0x2,'0')+':'+new Date()['getMinutes']()[_0x91fd93(0x8e)]()[_0x91fd93(0x9d)](0x2,'0');RequestMonitor[_0x91fd93(0xae)][_0x91fd93(0xc9)]=RequestMonitor[_0x91fd93(0xae)][_0x91fd93(0xc9)]['slice'](-0x3c)['filter'](_0x373cd6=>_0x373cd6[_0x91fd93(0x9f)]!==_0x3b1d2b),RequestMonitor[_0x91fd93(0xae)]['memory']=RequestMonitor[_0x91fd93(0xae)][_0x91fd93(0xb2)][_0x91fd93(0xa9)](-0x3c)[_0x91fd93(0xb4)](_0x2c0eae=>_0x2c0eae[_0x91fd93(0x9f)]!==_0x3b1d2b),RequestMonitor[_0x91fd93(0xae)]['network']=RequestMonitor[_0x91fd93(0xae)][_0x91fd93(0xd4)][_0x91fd93(0xa9)](-0x3c)[_0x91fd93(0xb4)](_0x354325=>_0x354325[_0x91fd93(0x9f)]!==_0x3b1d2b),RequestMonitor[_0x91fd93(0xae)][_0x91fd93(0xc9)]['push']({'time':_0x3b1d2b,'usage':_0x40b46d}),RequestMonitor[_0x91fd93(0xae)][_0x91fd93(0xb2)]['push']({'time':_0x3b1d2b,'usage':(_0x39b5d0['usedMemMb']/0x3e8)[_0x91fd93(0xb6)](0x2)}),RequestMonitor[_0x91fd93(0xae)][_0x91fd93(0xd4)][_0x91fd93(0xbd)]({'time':_0x3b1d2b,'usage':{'in':_0x5f457b['total']?.[_0x91fd93(0xa0)]??0x0,'out':_0x5f457b[_0x91fd93(0x9c)]?.[_0x91fd93(0x92)]??0x0}});try{await fs[_0x91fd93(0xd1)](RequestMonitor[_0x91fd93(0xad)],JSON[_0x91fd93(0xbb)](RequestMonitor[_0x91fd93(0xae)],null,0x2));}catch(_0x1c292d){console[_0x91fd93(0xb3)](_0x91fd93(0x8b),_0x1c292d);}}static['getStats'](){const _0x45979e=a1_0x47257b,_0x419689=Date[_0x45979e(0xa2)](),_0x1d2692=_0x419689-0x3c*0x3c*0x3e8,_0x4bcd7f=_0x419689-0x18*0x3c*0x3c*0x3e8,_0xbe826b=RequestMonitor['rpsData'][_0x45979e(0xb4)](_0x54eea3=>_0x54eea3[_0x45979e(0xb1)]>_0x1d2692),_0x6a88a={'total':RequestMonitor[_0x45979e(0xc2)][_0x45979e(0xce)],'byCodes':{},'byPath':{}};return RequestMonitor['httpCodesData'][_0x45979e(0x96)](_0x2bf83c=>{const _0x103336=_0x45979e;_0x6a88a[_0x103336(0x91)][_0x2bf83c['statusCode']]=(_0x6a88a['byCodes'][_0x2bf83c['statusCode']]||0x0)+0x1;const _0x53d19f=_0x2bf83c[_0x103336(0xc1)]+'\x20'+_0x2bf83c[_0x103336(0xac)];!_0x6a88a['byPath'][_0x53d19f]&&(_0x6a88a[_0x103336(0xd6)][_0x53d19f]={'total':0x0,'codes':{}}),_0x6a88a[_0x103336(0xd6)][_0x53d19f][_0x103336(0x9c)]++,_0x6a88a[_0x103336(0xd6)][_0x53d19f][_0x103336(0xc7)][_0x2bf83c[_0x103336(0x8c)]]=(_0x6a88a[_0x103336(0xd6)][_0x53d19f][_0x103336(0xc7)][_0x2bf83c['statusCode']]||0x0)+0x1;}),{'rps':_0xbe826b,'httpCodes':_0x6a88a,'ressourcesUsageStats':RequestMonitor[_0x45979e(0xae)]};}}RequestMonitor[a1_0x47257b(0xa1)]()[a1_0x47257b(0xb9)](()=>{}),RequestMonitor[a1_0x47257b(0xbc)]();const counter=RequestMonitor;module['exports']=counter;