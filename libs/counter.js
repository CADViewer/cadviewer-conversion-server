function a1_0x3a24(_0x2449ad,_0x17f0c0){const _0x58af63=a1_0x58af();return a1_0x3a24=function(_0x3a24cf,_0x2e6f24){_0x3a24cf=_0x3a24cf-0x8e;let _0x133053=_0x58af63[_0x3a24cf];return _0x133053;},a1_0x3a24(_0x2449ad,_0x17f0c0);}function a1_0x58af(){const _0x4c8968=['floor','rpsData','lastMinute','padStart','ressourcesUsageStats','init','675284pouNPQ','9DOgKXQ','getHours','220268CBQQWS','801330ROnijd','then','memory','statusCode','21076280oJweIo','cpu','rpsStoragePath','utf8','info','40108VzuAgY','Error\x20saving\x20monitoring\x20data:','ressourcesUsageStatsPath','currentRequests','codes','slice','Request\x20monitor\x20initialized.','now','promises','cadviewer/settings/requests-per-minute.json','writeFile','time','byPath','getMinutes','Error\x20getting\x20memory\x20usage:','Initializing\x20request\x20monitor...','total','startPeriodicSave','207pVNGTI','usedMemMb','httpCodesData','path','timestamp','=======>','network','Request\x20monitor\x20middleware','stringify','push','apply','middleware','error','method','50488iQXcPu','outputMb','mem','httpCodesStoragePath','length','30OPaHQJ','netstat','byCodes','toString','getUsageRessourcesStatsAndSave','getStats','includes','forEach','13084925CTpkDN','readFile','log','inputMb','inOut','filter','end'];a1_0x58af=function(){return _0x4c8968;};return a1_0x58af();}const a1_0x3fc14a=a1_0x3a24;(function(_0x345fbd,_0x107968){const _0x498284=a1_0x3a24,_0x366cd8=_0x345fbd();while(!![]){try{const _0x2e939d=parseInt(_0x498284(0xbd))/0x1+-parseInt(_0x498284(0xb3))/0x2*(-parseInt(_0x498284(0xb1))/0x3)+parseInt(_0x498284(0xb0))/0x4+-parseInt(_0x498284(0xb4))/0x5*(-parseInt(_0x498284(0x9b))/0x6)+parseInt(_0x498284(0xa3))/0x7+parseInt(_0x498284(0x96))/0x8*(-parseInt(_0x498284(0xcf))/0x9)+-parseInt(_0x498284(0xb8))/0xa;if(_0x2e939d===_0x107968)break;else _0x366cd8['push'](_0x366cd8['shift']());}catch(_0x30848c){_0x366cd8['push'](_0x366cd8['shift']());}}}(a1_0x58af,0xe9ae3));const fs=require('fs')[a1_0x3fc14a(0xc5)],osu=require('node-os-utils');class RequestMonitor{static [a1_0x3fc14a(0xba)]=a1_0x3fc14a(0xc6);static [a1_0x3fc14a(0x99)]='cadviewer/settings/http-codes-24h.json';static ['ressourcesUsageStatsPath']='cadviewer/settings/ressources-usage-stats.json';static [a1_0x3fc14a(0xab)]=[];static [a1_0x3fc14a(0xd1)]=[];static [a1_0x3fc14a(0xae)]={};static [a1_0x3fc14a(0xac)]=Math[a1_0x3fc14a(0xaa)](Date[a1_0x3fc14a(0xc4)]()/0x3e8/0x3c);static ['currentRequests']=0x0;static async['init'](){const _0x111f90=a1_0x3fc14a;console[_0x111f90(0xa5)](_0x111f90(0xcc));try{const _0x2e67d0=await fs[_0x111f90(0xa4)](RequestMonitor[_0x111f90(0xba)],'utf8');RequestMonitor['rpsData']=JSON['parse'](_0x2e67d0);}catch(_0x4375e3){RequestMonitor[_0x111f90(0xab)]=[];}try{const _0x108930=await fs[_0x111f90(0xa4)](RequestMonitor[_0x111f90(0x99)],_0x111f90(0xbb));RequestMonitor[_0x111f90(0xd1)]=JSON['parse'](_0x108930);}catch(_0x16dfef){RequestMonitor[_0x111f90(0xd1)]=[];}try{const _0x593a7c=await fs[_0x111f90(0xa4)](RequestMonitor['ressourcesUsageStatsPath'],_0x111f90(0xbb));RequestMonitor[_0x111f90(0xae)]=JSON['parse'](_0x593a7c),!RequestMonitor[_0x111f90(0xae)]['cpu']&&(RequestMonitor[_0x111f90(0xae)][_0x111f90(0xb9)]=[]),!RequestMonitor['ressourcesUsageStats'][_0x111f90(0xb6)]&&(RequestMonitor[_0x111f90(0xae)]['memory']=[]),!RequestMonitor[_0x111f90(0xae)][_0x111f90(0x8e)]&&(RequestMonitor[_0x111f90(0xae)][_0x111f90(0x8e)]=[]);}catch(_0x4bf840){RequestMonitor[_0x111f90(0xae)]={'cpu':[],'memory':[],'network':[]};}console[_0x111f90(0xa5)](_0x111f90(0xc3));}static[a1_0x3fc14a(0x93)](_0x3ceab1,_0x1ae9f6,_0x1ce2ef){const _0x1cf6c9=a1_0x3fc14a;if(_0x3ceab1[_0x1cf6c9(0xd2)][_0x1cf6c9(0xa1)]('/metrics'))return _0x1ce2ef();console[_0x1cf6c9(0xa5)](_0x1cf6c9(0x8f));let _0x40f904=Date[_0x1cf6c9(0xc4)](),_0x2799fb=Math[_0x1cf6c9(0xaa)](_0x40f904/0x3e8/0x3c);console[_0x1cf6c9(0xa5)](_0x1cf6c9(0xd4));const _0x5e9d2c=_0x1ae9f6[_0x1cf6c9(0xa9)];_0x1ae9f6[_0x1cf6c9(0xa9)]=(..._0x5e4ca6)=>{const _0x12754a=_0x1cf6c9;console[_0x12754a(0xa5)](_0x2799fb,{'currentMinute':_0x2799fb});_0x2799fb>RequestMonitor['lastMinute']&&(RequestMonitor[_0x12754a(0xab)][_0x12754a(0x91)]({'timestamp':RequestMonitor[_0x12754a(0xac)]*0x3e8*0x3c,'requests':RequestMonitor[_0x12754a(0xc0)]}),RequestMonitor[_0x12754a(0xc0)]=0x0,RequestMonitor[_0x12754a(0xac)]=_0x2799fb);RequestMonitor[_0x12754a(0xc0)]++,RequestMonitor['httpCodesData']['push']({'timestamp':Date[_0x12754a(0xc4)](),'statusCode':_0x1ae9f6[_0x12754a(0xb7)],'path':_0x3ceab1[_0x12754a(0xd2)],'method':_0x3ceab1[_0x12754a(0x95)]});const _0x3371b3=Date['now']()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor['httpCodesData']=RequestMonitor[_0x12754a(0xd1)][_0x12754a(0xa8)](_0x3edfcf=>_0x3edfcf[_0x12754a(0xd3)]>_0x3371b3),_0x5e9d2c[_0x12754a(0x92)](_0x1ae9f6,_0x5e4ca6);},_0x1ce2ef();}static async['save'](){const _0x11648b=a1_0x3fc14a;try{RequestMonitor[_0x11648b(0xac)]!==Math[_0x11648b(0xaa)](Date[_0x11648b(0xc4)]()/0x3e8/0x3c)&&(RequestMonitor['rpsData']['push']({'timestamp':RequestMonitor[_0x11648b(0xac)]*0x3e8*0x3c,'requests':RequestMonitor[_0x11648b(0xc0)]}),RequestMonitor[_0x11648b(0xc0)]=0x0,RequestMonitor[_0x11648b(0xac)]=Math['floor'](Date['now']()/0x3e8/0x3c)),await fs[_0x11648b(0xc7)](RequestMonitor['rpsStoragePath'],JSON[_0x11648b(0x90)](RequestMonitor['rpsData'],null,0x2)),await fs[_0x11648b(0xc7)](RequestMonitor[_0x11648b(0x99)],JSON[_0x11648b(0x90)](RequestMonitor[_0x11648b(0xd1)],null,0x2));}catch(_0x2686fb){console['error'](_0x11648b(0xbe),_0x2686fb);}}static async['startPeriodicSave'](){const _0x33620e=a1_0x3fc14a;setInterval(()=>RequestMonitor['save'](),0x3c*0x3e8),setInterval(()=>{const _0x45561c=a1_0x3a24;RequestMonitor[_0x45561c(0x9f)]()[_0x45561c(0xb5)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x33620e(0x9f)]()[_0x33620e(0xb5)](()=>{});}static async[a1_0x3fc14a(0x9f)](){const _0x513694=a1_0x3fc14a,_0x800521=osu[_0x513694(0xb9)],_0x413701=osu[_0x513694(0x98)],_0x52585e=osu[_0x513694(0x9c)],_0x1ff600={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0xb8fb9=await _0x52585e[_0x513694(0xa7)]();_0x1ff600[_0x513694(0xcd)][_0x513694(0xa6)]=_0xb8fb9[_0x513694(0xcd)]['inputMb'],_0x1ff600['total'][_0x513694(0x97)]=_0xb8fb9[_0x513694(0xcd)][_0x513694(0x97)];}catch(_0x22cf33){}let _0x592644=0x0;try{_0x592644=await _0x800521['usage']();}catch(_0x5a3c49){console[_0x513694(0xa5)]('Error\x20getting\x20CPU\x20usage:',_0x5a3c49);}const _0x5e87af={'usedMemMb':0x0};try{const _0x31e969=await _0x413701[_0x513694(0xbc)]();_0x5e87af[_0x513694(0xd0)]=_0x31e969[_0x513694(0xd0)];}catch(_0x5aa6b3){console[_0x513694(0xa5)](_0x513694(0xcb),_0x5aa6b3);}const _0x1cc2ee=new Date()[_0x513694(0xb2)]()[_0x513694(0x9e)]()[_0x513694(0xad)](0x2,'0')+':'+new Date()[_0x513694(0xca)]()['toString']()['padStart'](0x2,'0');RequestMonitor[_0x513694(0xae)]['cpu']=RequestMonitor[_0x513694(0xae)][_0x513694(0xb9)][_0x513694(0xc2)](-0x3c)[_0x513694(0xa8)](_0x148ea2=>_0x148ea2[_0x513694(0xc8)]!==_0x1cc2ee),RequestMonitor[_0x513694(0xae)][_0x513694(0xb6)]=RequestMonitor[_0x513694(0xae)]['memory'][_0x513694(0xc2)](-0x3c)[_0x513694(0xa8)](_0x5ce5c0=>_0x5ce5c0['time']!==_0x1cc2ee),RequestMonitor[_0x513694(0xae)][_0x513694(0x8e)]=RequestMonitor['ressourcesUsageStats'][_0x513694(0x8e)][_0x513694(0xc2)](-0x3c)[_0x513694(0xa8)](_0x53d157=>_0x53d157[_0x513694(0xc8)]!==_0x1cc2ee),RequestMonitor['ressourcesUsageStats'][_0x513694(0xb9)][_0x513694(0x91)]({'time':_0x1cc2ee,'usage':_0x592644}),RequestMonitor[_0x513694(0xae)][_0x513694(0xb6)][_0x513694(0x91)]({'time':_0x1cc2ee,'usage':(_0x5e87af[_0x513694(0xd0)]/0x3e8)['toFixed'](0x2)}),RequestMonitor[_0x513694(0xae)][_0x513694(0x8e)][_0x513694(0x91)]({'time':_0x1cc2ee,'usage':{'in':_0x1ff600[_0x513694(0xcd)]?.['inputMb']??0x0,'out':_0x1ff600[_0x513694(0xcd)]?.[_0x513694(0x97)]??0x0}});try{await fs[_0x513694(0xc7)](RequestMonitor[_0x513694(0xbf)],JSON['stringify'](RequestMonitor[_0x513694(0xae)],null,0x2));}catch(_0x526db7){console[_0x513694(0x94)](_0x513694(0xbe),_0x526db7);}}static[a1_0x3fc14a(0xa0)](){const _0x570650=a1_0x3fc14a,_0x2b926d=Date[_0x570650(0xc4)](),_0x5c14cf=_0x2b926d-0x3c*0x3c*0x3e8,_0x4bf8ca=_0x2b926d-0x18*0x3c*0x3c*0x3e8,_0x870735=RequestMonitor['rpsData'][_0x570650(0xa8)](_0x2c0a1e=>_0x2c0a1e[_0x570650(0xd3)]>_0x5c14cf),_0x533177={'total':RequestMonitor[_0x570650(0xd1)][_0x570650(0x9a)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x570650(0xd1)][_0x570650(0xa2)](_0x5d8e7a=>{const _0x30f935=_0x570650;_0x533177[_0x30f935(0x9d)][_0x5d8e7a[_0x30f935(0xb7)]]=(_0x533177[_0x30f935(0x9d)][_0x5d8e7a[_0x30f935(0xb7)]]||0x0)+0x1;const _0x346064=_0x5d8e7a[_0x30f935(0x95)]+'\x20'+_0x5d8e7a[_0x30f935(0xd2)];!_0x533177[_0x30f935(0xc9)][_0x346064]&&(_0x533177[_0x30f935(0xc9)][_0x346064]={'total':0x0,'codes':{}}),_0x533177[_0x30f935(0xc9)][_0x346064][_0x30f935(0xcd)]++,_0x533177[_0x30f935(0xc9)][_0x346064][_0x30f935(0xc1)][_0x5d8e7a[_0x30f935(0xb7)]]=(_0x533177[_0x30f935(0xc9)][_0x346064][_0x30f935(0xc1)][_0x5d8e7a[_0x30f935(0xb7)]]||0x0)+0x1;}),{'rps':_0x870735,'httpCodes':_0x533177,'ressourcesUsageStats':RequestMonitor[_0x570650(0xae)]};}}RequestMonitor[a1_0x3fc14a(0xaf)]()['then'](()=>{}),RequestMonitor[a1_0x3fc14a(0xce)]();const counter=RequestMonitor;module['exports']=counter;