const a1_0xb55cc2=a1_0x512f;(function(_0x8e7837,_0x51f6e3){const _0x11e433=a1_0x512f,_0x494e16=_0x8e7837();while(!![]){try{const _0x4ad024=-parseInt(_0x11e433(0x7a))/0x1*(parseInt(_0x11e433(0xb3))/0x2)+-parseInt(_0x11e433(0x9a))/0x3*(-parseInt(_0x11e433(0x8f))/0x4)+-parseInt(_0x11e433(0xae))/0x5+-parseInt(_0x11e433(0xb7))/0x6+parseInt(_0x11e433(0xa6))/0x7*(-parseInt(_0x11e433(0xa3))/0x8)+parseInt(_0x11e433(0x9d))/0x9+-parseInt(_0x11e433(0xaf))/0xa*(-parseInt(_0x11e433(0x80))/0xb);if(_0x4ad024===_0x51f6e3)break;else _0x494e16['push'](_0x494e16['shift']());}catch(_0x3e3e11){_0x494e16['push'](_0x494e16['shift']());}}}(a1_0x50a7,0x56bb5));const fs=require('fs')['promises'],osu=require(a1_0xb55cc2(0x7c));function a1_0x50a7(){const _0x2f27de=['741006RIfdiN','total','end','time','mem','ressourcesUsageStatsPath','32AQfLcq','error','statusCode','1098790OoXfqa','byPath','cpu','codes','getMinutes','ressourcesUsageStats','parse','forEach','2877450BUylbT','10928690AqZOBy','currentRequests','slice','info','9242pTjYtz','Error\x20saving\x20monitoring\x20data:','filter','padStart','2839236XyGRlQ','timestamp','cadviewer/settings/ressources-usage-stats.json','utf8','readFile','floor','startPeriodicSave','writeFile','79hJcrUC','log','node-os-utils','network','getUsageRessourcesStatsAndSave','byCodes','22fcJXdf','toString','memory','httpCodesData','apply','=======>','Error\x20getting\x20CPU\x20usage:','init','lastMinute','cadviewer/settings/requests-per-minute.json','rpsStoragePath','inputMb','then','getHours','now','2656HLYIvI','usedMemMb','outputMb','stringify','/metrics','push','middleware','rpsData','exports','getStats','save','582jAJeJo','inOut','path'];a1_0x50a7=function(){return _0x2f27de;};return a1_0x50a7();}class RequestMonitor{static [a1_0xb55cc2(0x8a)]=a1_0xb55cc2(0x89);static ['httpCodesStoragePath']='cadviewer/settings/http-codes-24h.json';static [a1_0xb55cc2(0xa2)]=a1_0xb55cc2(0xb9);static [a1_0xb55cc2(0x96)]=[];static ['httpCodesData']=[];static ['ressourcesUsageStats']={};static ['lastMinute']=Math[a1_0xb55cc2(0x77)](Date[a1_0xb55cc2(0x8e)]()/0x3e8/0x3c);static [a1_0xb55cc2(0xb0)]=0x0;static async[a1_0xb55cc2(0x87)](){const _0x4aeaba=a1_0xb55cc2;console[_0x4aeaba(0x7b)]('Initializing\x20request\x20monitor...');try{const _0x3eae15=await fs[_0x4aeaba(0x76)](RequestMonitor[_0x4aeaba(0x8a)],_0x4aeaba(0x75));RequestMonitor[_0x4aeaba(0x96)]=JSON['parse'](_0x3eae15);}catch(_0xe2bace){RequestMonitor[_0x4aeaba(0x96)]=[];}try{const _0x17e135=await fs[_0x4aeaba(0x76)](RequestMonitor['httpCodesStoragePath'],'utf8');RequestMonitor['httpCodesData']=JSON[_0x4aeaba(0xac)](_0x17e135);}catch(_0x47eb09){RequestMonitor[_0x4aeaba(0x83)]=[];}try{const _0x3eda23=await fs[_0x4aeaba(0x76)](RequestMonitor['ressourcesUsageStatsPath'],'utf8');RequestMonitor[_0x4aeaba(0xab)]=JSON['parse'](_0x3eda23),!RequestMonitor['ressourcesUsageStats'][_0x4aeaba(0xa8)]&&(RequestMonitor['ressourcesUsageStats'][_0x4aeaba(0xa8)]=[]),!RequestMonitor[_0x4aeaba(0xab)]['memory']&&(RequestMonitor[_0x4aeaba(0xab)][_0x4aeaba(0x82)]=[]),!RequestMonitor[_0x4aeaba(0xab)][_0x4aeaba(0x7d)]&&(RequestMonitor['ressourcesUsageStats']['network']=[]);}catch(_0x2035a6){RequestMonitor[_0x4aeaba(0xab)]={'cpu':[],'memory':[],'network':[]};}console[_0x4aeaba(0x7b)]('Request\x20monitor\x20initialized.');}static[a1_0xb55cc2(0x95)](_0x337a80,_0x58668f,_0x30ec06){const _0x4d82fe=a1_0xb55cc2;if(_0x337a80[_0x4d82fe(0x9c)]['includes'](_0x4d82fe(0x93)))return _0x30ec06();console[_0x4d82fe(0x7b)]('Request\x20monitor\x20middleware');let _0xa754e0=Date['now'](),_0x126f56=Math[_0x4d82fe(0x77)](_0xa754e0/0x3e8/0x3c);console['log'](_0x4d82fe(0x85));const _0x4d51d0=_0x58668f[_0x4d82fe(0x9f)];_0x58668f[_0x4d82fe(0x9f)]=(..._0x5265eb)=>{const _0x14d73c=_0x4d82fe;console[_0x14d73c(0x7b)](_0x126f56,{'currentMinute':_0x126f56});_0x126f56>RequestMonitor['lastMinute']&&(RequestMonitor[_0x14d73c(0x96)][_0x14d73c(0x94)]({'timestamp':RequestMonitor[_0x14d73c(0x88)]*0x3e8*0x3c,'requests':RequestMonitor[_0x14d73c(0xb0)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor['lastMinute']=_0x126f56);RequestMonitor[_0x14d73c(0xb0)]++,RequestMonitor[_0x14d73c(0x83)][_0x14d73c(0x94)]({'timestamp':Date[_0x14d73c(0x8e)](),'statusCode':_0x58668f[_0x14d73c(0xa5)],'path':_0x337a80[_0x14d73c(0x9c)],'method':_0x337a80['method']});const _0x3a0aba=Date[_0x14d73c(0x8e)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x14d73c(0x83)]=RequestMonitor['httpCodesData']['filter'](_0x36caaa=>_0x36caaa[_0x14d73c(0xb8)]>_0x3a0aba),_0x4d51d0[_0x14d73c(0x84)](_0x58668f,_0x5265eb);},_0x30ec06();}static async['save'](){const _0x48eee2=a1_0xb55cc2;try{RequestMonitor[_0x48eee2(0x88)]!==Math['floor'](Date[_0x48eee2(0x8e)]()/0x3e8/0x3c)&&(RequestMonitor[_0x48eee2(0x96)][_0x48eee2(0x94)]({'timestamp':RequestMonitor['lastMinute']*0x3e8*0x3c,'requests':RequestMonitor['currentRequests']}),RequestMonitor[_0x48eee2(0xb0)]=0x0,RequestMonitor[_0x48eee2(0x88)]=Math[_0x48eee2(0x77)](Date['now']()/0x3e8/0x3c)),await fs['writeFile'](RequestMonitor[_0x48eee2(0x8a)],JSON[_0x48eee2(0x92)](RequestMonitor[_0x48eee2(0x96)],null,0x2)),await fs['writeFile'](RequestMonitor['httpCodesStoragePath'],JSON[_0x48eee2(0x92)](RequestMonitor[_0x48eee2(0x83)],null,0x2));}catch(_0x1df49c){console['error'](_0x48eee2(0xb4),_0x1df49c);}}static async[a1_0xb55cc2(0x78)](){const _0x52b924=a1_0xb55cc2;setInterval(()=>RequestMonitor[_0x52b924(0x99)](),0x3c*0x3e8),setInterval(()=>{const _0x5c0ada=_0x52b924;RequestMonitor[_0x5c0ada(0x7e)]()[_0x5c0ada(0x8c)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x52b924(0x7e)]()[_0x52b924(0x8c)](()=>{});}static async['getUsageRessourcesStatsAndSave'](){const _0x34ccb2=a1_0xb55cc2,_0x159a3f=osu[_0x34ccb2(0xa8)],_0x2615f0=osu[_0x34ccb2(0xa1)],_0x58f2eb=osu['netstat'],_0x25af8f={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x390338=await _0x58f2eb[_0x34ccb2(0x9b)]();_0x25af8f['total']['inputMb']=_0x390338[_0x34ccb2(0x9e)]['inputMb'],_0x25af8f[_0x34ccb2(0x9e)]['outputMb']=_0x390338[_0x34ccb2(0x9e)][_0x34ccb2(0x91)];}catch(_0x50777f){}let _0x4c85ac=0x0;try{_0x4c85ac=await _0x159a3f['usage']();}catch(_0x279986){console[_0x34ccb2(0x7b)](_0x34ccb2(0x86),_0x279986);}const _0x28cefa={'usedMemMb':0x0};try{const _0x19bde1=await _0x2615f0[_0x34ccb2(0xb2)]();_0x28cefa[_0x34ccb2(0x90)]=_0x19bde1[_0x34ccb2(0x90)];}catch(_0xa1b1cd){console[_0x34ccb2(0x7b)]('Error\x20getting\x20memory\x20usage:',_0xa1b1cd);}const _0x3ecc5b=new Date()[_0x34ccb2(0x8d)]()[_0x34ccb2(0x81)]()[_0x34ccb2(0xb6)](0x2,'0')+':'+new Date()[_0x34ccb2(0xaa)]()[_0x34ccb2(0x81)]()[_0x34ccb2(0xb6)](0x2,'0');RequestMonitor['ressourcesUsageStats'][_0x34ccb2(0xa8)]=RequestMonitor[_0x34ccb2(0xab)]['cpu'][_0x34ccb2(0xb1)](-0x3c)['filter'](_0x478c5b=>_0x478c5b[_0x34ccb2(0xa0)]!==_0x3ecc5b),RequestMonitor[_0x34ccb2(0xab)]['memory']=RequestMonitor[_0x34ccb2(0xab)][_0x34ccb2(0x82)][_0x34ccb2(0xb1)](-0x3c)[_0x34ccb2(0xb5)](_0x4d68ae=>_0x4d68ae['time']!==_0x3ecc5b),RequestMonitor[_0x34ccb2(0xab)][_0x34ccb2(0x7d)]=RequestMonitor['ressourcesUsageStats']['network'][_0x34ccb2(0xb1)](-0x3c)['filter'](_0x10acc6=>_0x10acc6['time']!==_0x3ecc5b),RequestMonitor[_0x34ccb2(0xab)][_0x34ccb2(0xa8)][_0x34ccb2(0x94)]({'time':_0x3ecc5b,'usage':_0x4c85ac}),RequestMonitor['ressourcesUsageStats'][_0x34ccb2(0x82)][_0x34ccb2(0x94)]({'time':_0x3ecc5b,'usage':(_0x28cefa['usedMemMb']/0x3e8)['toFixed'](0x2)}),RequestMonitor[_0x34ccb2(0xab)][_0x34ccb2(0x7d)]['push']({'time':_0x3ecc5b,'usage':{'in':_0x25af8f[_0x34ccb2(0x9e)]?.[_0x34ccb2(0x8b)]??0x0,'out':_0x25af8f['total']?.[_0x34ccb2(0x91)]??0x0}});try{await fs[_0x34ccb2(0x79)](RequestMonitor['ressourcesUsageStatsPath'],JSON['stringify'](RequestMonitor['ressourcesUsageStats'],null,0x2));}catch(_0x125c62){console[_0x34ccb2(0xa4)]('Error\x20saving\x20monitoring\x20data:',_0x125c62);}}static[a1_0xb55cc2(0x98)](){const _0x540476=a1_0xb55cc2,_0x71b714=Date[_0x540476(0x8e)](),_0xbd29d2=_0x71b714-0x3c*0x3c*0x3e8,_0x105f72=_0x71b714-0x18*0x3c*0x3c*0x3e8,_0x202db6=RequestMonitor[_0x540476(0x96)][_0x540476(0xb5)](_0x11c786=>_0x11c786[_0x540476(0xb8)]>_0xbd29d2),_0x4e15a4={'total':RequestMonitor[_0x540476(0x83)]['length'],'byCodes':{},'byPath':{}};return RequestMonitor[_0x540476(0x83)][_0x540476(0xad)](_0x5d0aed=>{const _0x3a81e8=_0x540476;_0x4e15a4[_0x3a81e8(0x7f)][_0x5d0aed[_0x3a81e8(0xa5)]]=(_0x4e15a4[_0x3a81e8(0x7f)][_0x5d0aed[_0x3a81e8(0xa5)]]||0x0)+0x1;const _0x3aac68=_0x5d0aed['method']+'\x20'+_0x5d0aed[_0x3a81e8(0x9c)];!_0x4e15a4[_0x3a81e8(0xa7)][_0x3aac68]&&(_0x4e15a4[_0x3a81e8(0xa7)][_0x3aac68]={'total':0x0,'codes':{}}),_0x4e15a4[_0x3a81e8(0xa7)][_0x3aac68]['total']++,_0x4e15a4[_0x3a81e8(0xa7)][_0x3aac68]['codes'][_0x5d0aed[_0x3a81e8(0xa5)]]=(_0x4e15a4['byPath'][_0x3aac68][_0x3a81e8(0xa9)][_0x5d0aed[_0x3a81e8(0xa5)]]||0x0)+0x1;}),{'rps':_0x202db6,'httpCodes':_0x4e15a4,'ressourcesUsageStats':RequestMonitor[_0x540476(0xab)]};}}RequestMonitor[a1_0xb55cc2(0x87)]()['then'](()=>{}),RequestMonitor['startPeriodicSave']();function a1_0x512f(_0x2fb9c5,_0x340adf){const _0x50a7b8=a1_0x50a7();return a1_0x512f=function(_0x512f24,_0x48cf2b){_0x512f24=_0x512f24-0x75;let _0x9bd4b2=_0x50a7b8[_0x512f24];return _0x9bd4b2;},a1_0x512f(_0x2fb9c5,_0x340adf);}const counter=RequestMonitor;module[a1_0xb55cc2(0x97)]=counter;