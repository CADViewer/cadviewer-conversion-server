const a1_0x4ec79f=a1_0x334b;function a1_0x334b(_0x583905,_0x34e0f8){const _0x1d63cc=a1_0x1d63();return a1_0x334b=function(_0x334bc5,_0x105016){_0x334bc5=_0x334bc5-0x9d;let _0x13bc0b=_0x1d63cc[_0x334bc5];return _0x13bc0b;},a1_0x334b(_0x583905,_0x34e0f8);}(function(_0x4f8aa7,_0x4fcf22){const _0x65f261=a1_0x334b,_0x168ca2=_0x4f8aa7();while(!![]){try{const _0x552e71=-parseInt(_0x65f261(0xdf))/0x1*(parseInt(_0x65f261(0xc7))/0x2)+parseInt(_0x65f261(0xdd))/0x3*(-parseInt(_0x65f261(0xac))/0x4)+-parseInt(_0x65f261(0xbd))/0x5*(parseInt(_0x65f261(0xe4))/0x6)+parseInt(_0x65f261(0xb7))/0x7+-parseInt(_0x65f261(0xbe))/0x8*(parseInt(_0x65f261(0xb6))/0x9)+-parseInt(_0x65f261(0xe1))/0xa+parseInt(_0x65f261(0xba))/0xb;if(_0x552e71===_0x4fcf22)break;else _0x168ca2['push'](_0x168ca2['shift']());}catch(_0x59a140){_0x168ca2['push'](_0x168ca2['shift']());}}}(a1_0x1d63,0xb736a));const fs=require('fs')[a1_0x4ec79f(0xde)],osu=require(a1_0x4ec79f(0x9f));class RequestMonitor{static [a1_0x4ec79f(0xa3)]=a1_0x4ec79f(0xad);static ['httpCodesStoragePath']=a1_0x4ec79f(0xda);static [a1_0x4ec79f(0xa8)]=a1_0x4ec79f(0xcd);static [a1_0x4ec79f(0xaf)]=[];static [a1_0x4ec79f(0xe2)]=[];static ['ressourcesUsageStats']={};static ['lastMinute']=Math[a1_0x4ec79f(0xd3)](Date[a1_0x4ec79f(0xcc)]()/0x3e8/0x3c);static [a1_0x4ec79f(0xd1)]=0x0;static async[a1_0x4ec79f(0xb5)](){const _0x21255d=a1_0x4ec79f;console['log'](_0x21255d(0xa5));try{const _0xbf9708=await fs[_0x21255d(0xab)](RequestMonitor['rpsStoragePath'],_0x21255d(0xc8));RequestMonitor[_0x21255d(0xaf)]=JSON['parse'](_0xbf9708);}catch(_0x546b69){RequestMonitor[_0x21255d(0xaf)]=[];}try{const _0x110797=await fs[_0x21255d(0xab)](RequestMonitor[_0x21255d(0xd9)],'utf8');RequestMonitor[_0x21255d(0xe2)]=JSON[_0x21255d(0xd6)](_0x110797);}catch(_0x4c613b){RequestMonitor[_0x21255d(0xe2)]=[];}try{const _0x49842e=await fs[_0x21255d(0xab)](RequestMonitor[_0x21255d(0xa8)],_0x21255d(0xc8));RequestMonitor['ressourcesUsageStats']=JSON[_0x21255d(0xd6)](_0x49842e),!RequestMonitor['ressourcesUsageStats'][_0x21255d(0xb3)]&&(RequestMonitor[_0x21255d(0xbc)][_0x21255d(0xb3)]=[]),!RequestMonitor[_0x21255d(0xbc)][_0x21255d(0xb1)]&&(RequestMonitor[_0x21255d(0xbc)]['memory']=[]),!RequestMonitor[_0x21255d(0xbc)]['network']&&(RequestMonitor['ressourcesUsageStats'][_0x21255d(0xb2)]=[]);}catch(_0x54e33c){RequestMonitor[_0x21255d(0xbc)]={'cpu':[],'memory':[],'network':[]};}console[_0x21255d(0xb8)](_0x21255d(0xe9));}static[a1_0x4ec79f(0xe6)](_0xb30513,_0xec978a,_0x4da89d){const _0x14502b=a1_0x4ec79f;if(_0xb30513[_0x14502b(0xd4)][_0x14502b(0xcf)](_0x14502b(0xa7)))return _0x4da89d();console['log']('Request\x20monitor\x20middleware');let _0x122f8b=Date[_0x14502b(0xcc)](),_0x4c37d1=Math[_0x14502b(0xd3)](_0x122f8b/0x3e8/0x3c);console[_0x14502b(0xb8)](_0x14502b(0xc3));const _0x38d0a1=_0xec978a[_0x14502b(0xc1)];_0xec978a[_0x14502b(0xc1)]=(..._0x46551f)=>{const _0x1890f2=_0x14502b;console[_0x1890f2(0xb8)](_0x4c37d1,{'currentMinute':_0x4c37d1});_0x4c37d1>RequestMonitor['lastMinute']&&(RequestMonitor[_0x1890f2(0xaf)][_0x1890f2(0xd2)]({'timestamp':RequestMonitor[_0x1890f2(0xc0)]*0x3e8*0x3c,'requests':RequestMonitor[_0x1890f2(0xd1)]}),RequestMonitor[_0x1890f2(0xd1)]=0x0,RequestMonitor['lastMinute']=_0x4c37d1);RequestMonitor[_0x1890f2(0xd1)]++,RequestMonitor[_0x1890f2(0xe2)]['push']({'timestamp':Date[_0x1890f2(0xcc)](),'statusCode':_0xec978a[_0x1890f2(0xbf)],'path':_0xb30513[_0x1890f2(0xd4)],'method':_0xb30513[_0x1890f2(0xc2)]});const _0x18709f=Date[_0x1890f2(0xcc)]()-0x18*0x3c*0x3c*0x3e8;return RequestMonitor[_0x1890f2(0xe2)]=RequestMonitor[_0x1890f2(0xe2)]['filter'](_0x588f83=>_0x588f83[_0x1890f2(0xa0)]>_0x18709f),_0x38d0a1[_0x1890f2(0xe5)](_0xec978a,_0x46551f);},_0x4da89d();}static async['save'](){const _0x2e2dc2=a1_0x4ec79f;try{RequestMonitor['lastMinute']!==Math[_0x2e2dc2(0xd3)](Date['now']()/0x3e8/0x3c)&&(RequestMonitor[_0x2e2dc2(0xaf)]['push']({'timestamp':RequestMonitor[_0x2e2dc2(0xc0)]*0x3e8*0x3c,'requests':RequestMonitor[_0x2e2dc2(0xd1)]}),RequestMonitor['currentRequests']=0x0,RequestMonitor[_0x2e2dc2(0xc0)]=Math[_0x2e2dc2(0xd3)](Date[_0x2e2dc2(0xcc)]()/0x3e8/0x3c)),await fs[_0x2e2dc2(0xd5)](RequestMonitor[_0x2e2dc2(0xa3)],JSON[_0x2e2dc2(0xe7)](RequestMonitor[_0x2e2dc2(0xaf)],null,0x2)),await fs['writeFile'](RequestMonitor['httpCodesStoragePath'],JSON[_0x2e2dc2(0xe7)](RequestMonitor[_0x2e2dc2(0xe2)],null,0x2));}catch(_0x5ae507){console[_0x2e2dc2(0xd8)](_0x2e2dc2(0xa6),_0x5ae507);}}static async[a1_0x4ec79f(0xdb)](){const _0x11d5c5=a1_0x4ec79f;setInterval(()=>RequestMonitor[_0x11d5c5(0xc9)](),0x3c*0x3e8),setInterval(()=>{const _0x5529ab=_0x11d5c5;RequestMonitor[_0x5529ab(0xa2)]()[_0x5529ab(0xea)](()=>{});},0x3c*0x3e8),RequestMonitor[_0x11d5c5(0xa2)]()[_0x11d5c5(0xea)](()=>{});}static async[a1_0x4ec79f(0xa2)](){const _0x256a7d=a1_0x4ec79f,_0xb0f4b3=osu[_0x256a7d(0xb3)],_0x213aec=osu['mem'],_0x5afe66=osu[_0x256a7d(0xaa)],_0x4a0cc5={'total':{'inputMb':0x0,'outputMb':0x0}};try{const _0x1a7d74=await _0x5afe66[_0x256a7d(0xb4)]();_0x4a0cc5[_0x256a7d(0xbb)][_0x256a7d(0xdc)]=_0x1a7d74[_0x256a7d(0xbb)][_0x256a7d(0xdc)],_0x4a0cc5[_0x256a7d(0xbb)][_0x256a7d(0x9d)]=_0x1a7d74['total'][_0x256a7d(0x9d)];}catch(_0x5527c1){}let _0x224034=0x0;try{_0x224034=await _0xb0f4b3['usage']();}catch(_0x8a7b62){console[_0x256a7d(0xb8)](_0x256a7d(0xb9),_0x8a7b62);}const _0x165859={'usedMemMb':0x0};try{const _0x31cef0=await _0x213aec[_0x256a7d(0xa1)]();_0x165859['usedMemMb']=_0x31cef0[_0x256a7d(0xc5)];}catch(_0x83f74){console[_0x256a7d(0xb8)](_0x256a7d(0xe0),_0x83f74);}const _0x156ccd=new Date()[_0x256a7d(0xa4)]()[_0x256a7d(0xce)]()[_0x256a7d(0xc4)](0x2,'0')+':'+new Date()[_0x256a7d(0xe3)]()['toString']()['padStart'](0x2,'0');RequestMonitor[_0x256a7d(0xbc)]['cpu']=RequestMonitor['ressourcesUsageStats'][_0x256a7d(0xb3)][_0x256a7d(0xc6)](-0x3c)[_0x256a7d(0xb0)](_0x5c4627=>_0x5c4627['time']!==_0x156ccd),RequestMonitor[_0x256a7d(0xbc)]['memory']=RequestMonitor[_0x256a7d(0xbc)]['memory'][_0x256a7d(0xc6)](-0x3c)[_0x256a7d(0xb0)](_0xa687ae=>_0xa687ae[_0x256a7d(0xae)]!==_0x156ccd),RequestMonitor[_0x256a7d(0xbc)][_0x256a7d(0xb2)]=RequestMonitor[_0x256a7d(0xbc)]['network']['slice'](-0x3c)[_0x256a7d(0xb0)](_0x1ba2b7=>_0x1ba2b7[_0x256a7d(0xae)]!==_0x156ccd),RequestMonitor[_0x256a7d(0xbc)][_0x256a7d(0xb3)][_0x256a7d(0xd2)]({'time':_0x156ccd,'usage':_0x224034}),RequestMonitor[_0x256a7d(0xbc)]['memory'][_0x256a7d(0xd2)]({'time':_0x156ccd,'usage':(_0x165859[_0x256a7d(0xc5)]/0x3e8)[_0x256a7d(0xcb)](0x2)}),RequestMonitor[_0x256a7d(0xbc)][_0x256a7d(0xb2)]['push']({'time':_0x156ccd,'usage':{'in':_0x4a0cc5[_0x256a7d(0xbb)]?.[_0x256a7d(0xdc)]??0x0,'out':_0x4a0cc5[_0x256a7d(0xbb)]?.[_0x256a7d(0x9d)]??0x0}});try{await fs[_0x256a7d(0xd5)](RequestMonitor['ressourcesUsageStatsPath'],JSON[_0x256a7d(0xe7)](RequestMonitor[_0x256a7d(0xbc)],null,0x2));}catch(_0x674a35){console[_0x256a7d(0xd8)](_0x256a7d(0xa6),_0x674a35);}}static[a1_0x4ec79f(0xd7)](){const _0x22908f=a1_0x4ec79f,_0x5e0443=Date[_0x22908f(0xcc)](),_0x545cee=_0x5e0443-0x3c*0x3c*0x3e8,_0x1eb324=_0x5e0443-0x18*0x3c*0x3c*0x3e8,_0x5b2bb5=RequestMonitor[_0x22908f(0xaf)]['filter'](_0x34bd39=>_0x34bd39[_0x22908f(0xa0)]>_0x545cee),_0x3f90a3={'total':RequestMonitor[_0x22908f(0xe2)][_0x22908f(0xca)],'byCodes':{},'byPath':{}};return RequestMonitor[_0x22908f(0xe2)][_0x22908f(0x9e)](_0x577b42=>{const _0x337807=_0x22908f;_0x3f90a3['byCodes'][_0x577b42['statusCode']]=(_0x3f90a3[_0x337807(0xa9)][_0x577b42[_0x337807(0xbf)]]||0x0)+0x1;const _0x46658a=_0x577b42[_0x337807(0xc2)]+'\x20'+_0x577b42['path'];!_0x3f90a3['byPath'][_0x46658a]&&(_0x3f90a3['byPath'][_0x46658a]={'total':0x0,'codes':{}}),_0x3f90a3[_0x337807(0xd0)][_0x46658a][_0x337807(0xbb)]++,_0x3f90a3[_0x337807(0xd0)][_0x46658a]['codes'][_0x577b42[_0x337807(0xbf)]]=(_0x3f90a3[_0x337807(0xd0)][_0x46658a][_0x337807(0xe8)][_0x577b42['statusCode']]||0x0)+0x1;}),{'rps':_0x5b2bb5,'httpCodes':_0x3f90a3,'ressourcesUsageStats':RequestMonitor[_0x22908f(0xbc)]};}}function a1_0x1d63(){const _0x951e64=['getStats','error','httpCodesStoragePath','cadviewer/settings/http-codes-24h.json','startPeriodicSave','inputMb','9327HoFYls','promises','220003aIHpLX','Error\x20getting\x20memory\x20usage:','194780BSWroN','httpCodesData','getMinutes','12lMsTig','apply','middleware','stringify','codes','Request\x20monitor\x20initialized.','then','outputMb','forEach','node-os-utils','timestamp','info','getUsageRessourcesStatsAndSave','rpsStoragePath','getHours','Initializing\x20request\x20monitor...','Error\x20saving\x20monitoring\x20data:','/metrics','ressourcesUsageStatsPath','byCodes','netstat','readFile','476ojbbwE','cadviewer/settings/requests-per-minute.json','time','rpsData','filter','memory','network','cpu','inOut','init','9cLaRSk','2475585InLrJT','log','Error\x20getting\x20CPU\x20usage:','32275408aJUqDR','total','ressourcesUsageStats','3535935qZzAJk','2348096pzBLwX','statusCode','lastMinute','end','method','=======>','padStart','usedMemMb','slice','4XyOUqo','utf8','save','length','toFixed','now','cadviewer/settings/ressources-usage-stats.json','toString','includes','byPath','currentRequests','push','floor','path','writeFile','parse'];a1_0x1d63=function(){return _0x951e64;};return a1_0x1d63();}RequestMonitor[a1_0x4ec79f(0xb5)]()[a1_0x4ec79f(0xea)](()=>{}),RequestMonitor[a1_0x4ec79f(0xdb)]();const counter=RequestMonitor;module['exports']=counter;